(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Caret = exports.CARET = void 0;
var views = require("./wml/caret");
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
///classNames:begin
exports.CARET = 'ww-caret';
/**
 * Caret
 */
var Caret = /** @class */ (function (_super) {
    __extends(Caret, _super);
    function Caret() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: {
                id: (_this.attrs.ww && _this.attrs.ww.id) ? _this.attrs.ww.id : '',
                className: util_1.concat(exports.CARET, (_this.attrs.ww && _this.attrs.ww.className) ?
                    _this.attrs.ww.className : '')
            }
        };
        return _this;
    }
    return Caret;
}(wml_1.Component));
exports.Caret = Caret;

},{"../../util":143,"./wml/caret":2,"@quenk/wml":153}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('span', { 'id': __context.values.root.id, 'class': __context.values.root.className }, []);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],3:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Close = exports.CLOSE = void 0;
var views = require("./wml/close");
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
///classNames:begin
exports.CLOSE = 'ww-close';
/**
 * Close
 */
var Close = /** @class */ (function (_super) {
    __extends(Close, _super);
    function Close() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            id: (_this.attrs.ww && _this.attrs.ww.id) ?
                _this.attrs.ww.id : '',
            className: util_1.concat(exports.CLOSE, (_this.attrs.ww && _this.attrs.ww.className) ?
                _this.attrs.ww.className : ''),
            onClick: (_this.attrs.ww && _this.attrs.ww.onClick) ?
                _this.attrs.ww.onClick : function () { }
        };
        return _this;
    }
    return Close;
}(wml_1.Component));
exports.Close = Close;

},{"../../util":143,"./wml/close":4,"@quenk/wml":153}],4:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('span', { 'id': __context.values.id, 'class': __context.values.className, 'onclick': __context.values.onClick }, [
                __document.createTextNode('Ã—')
            ]);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],5:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Embed = exports.EMBED = void 0;
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
var __1 = require("../../");
var embed_1 = require("./wml/embed");
///classNames:begin
exports.EMBED = 'ww-embed';
/**
 * Embed
 */
var Embed = /** @class */ (function (_super) {
    __extends(Embed, _super);
    function Embed() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new embed_1.Main(_this);
        _this.values = {
            wml: {
                id: 'embed'
            },
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.EMBED, __1.getClassName(_this.attrs)),
        };
        return _this;
    }
    return Embed;
}(wml_1.Component));
exports.Embed = Embed;

},{"../../":104,"../../util":143,"./wml/embed":6,"@quenk/wml":153}],6:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],7:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Link = exports.LinkClickedEvent = exports.LINK = void 0;
var wml = require("@quenk/wml");
var views = require("./wml/link");
var util_1 = require("../../util");
var active_1 = require("../state/active");
///classNames:begin
/**
 * LINK
 */
exports.LINK = 'ww-link';
/**
 * LinkClickedEvent indicates an Link has been clicked.
 */
var LinkClickedEvent = /** @class */ (function () {
    function LinkClickedEvent(name, href) {
        this.name = name;
        this.href = href;
    }
    return LinkClickedEvent;
}());
exports.LinkClickedEvent = LinkClickedEvent;
/**
 * Link generates an <a> element.
 */
var Link = /** @class */ (function (_super) {
    __extends(Link, _super);
    function Link() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        /**
         * name assigned to this Link.
         */
        _this.name = (_this.attrs.ww && _this.attrs.ww.name) ?
            _this.attrs.ww.name : '';
        /**
         * title assigned to this Link.
         */
        _this.title = (_this.attrs.ww && _this.attrs.ww.title) ?
            _this.attrs.ww.title : '';
        /**
         * href assigned to this Link
         */
        _this.href = (_this.attrs.ww && _this.attrs.ww.href) ?
            _this.attrs.ww.href : '';
        _this.values = {
            a: {
                id: (_this.attrs.ww && _this.attrs.ww.id) ?
                    _this.attrs.ww.id : '',
                disabled: (_this.attrs.ww && _this.attrs.ww.disabled) ?
                    _this.attrs.ww.disabled : null,
                className: util_1.concat(exports.LINK, (_this.attrs.ww && _this.attrs.ww.className) ?
                    _this.attrs.ww.className : '', (_this.attrs.ww && _this.attrs.ww.active) ?
                    active_1.ACTIVE : ''),
                title: (_this.attrs.ww && _this.attrs.ww.title) ?
                    _this.attrs.ww.title : null,
                name: (_this.attrs.ww && _this.attrs.ww.name) ?
                    _this.attrs.ww.name : null,
                href: (_this.attrs.ww && _this.attrs.ww.href) ?
                    _this.attrs.ww.href : '#',
                active: (_this.attrs.ww && _this.attrs.ww.active) ?
                    _this.attrs.ww.active : false,
                //TODO: move to dom lib
                content: (_this.attrs.ww && _this.attrs.ww.text) ?
                    [document.createTextNode(_this.attrs.ww.text)] :
                    _this.children,
                clicked: function (e) {
                    if (_this.attrs.ww) {
                        var _a = _this.attrs.ww, name_1 = _a.name, href = _a.href, onClick = _a.onClick;
                        if (!href)
                            e.preventDefault();
                        if (onClick)
                            onClick(new LinkClickedEvent(name_1, href));
                    }
                }
            }
        };
        return _this;
    }
    /**
      * activate this nav list Item.
      */
    Link.prototype.activate = function () {
        var m = util_1.getById(this.view, this.values.a.id);
        if (m.isJust()) {
            var e = m.get();
            e.classList.remove(active_1.ACTIVE);
            e.classList.add(active_1.ACTIVE);
        }
        return this;
    };
    /**
     * deactivate this nav list item.
     */
    Link.prototype.deactivate = function () {
        var m = util_1.getById(this.view, this.values.a.id);
        if (m.isJust())
            m.get().classList.remove(active_1.ACTIVE);
        return this;
    };
    return Link;
}(wml.Component));
exports.Link = Link;

},{"../../util":143,"../state/active":17,"./wml/link":8,"@quenk/wml":153}],8:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('a', { 'id': __context.values.a.id, 'class': __context.values.a.className, 'href': __context.values.a.href, 'title': __context.values.a.title, 'disabled': __context.values.a.disabled, 'onclick': __context.values.a.clicked }, __spreadArrays((__context.values.a.content)));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],9:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Description = exports.Media = exports.MediaDescription = exports.MEDIA_DESCRIPTION_DESCRIPTION = exports.MEDIA_DESCRIPTION_MEDIA = exports.MEDIA_DESCRIPTION = void 0;
var views = require("./wml/media-description");
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
var __1 = require("../../");
///classNames:begin
exports.MEDIA_DESCRIPTION = 'ww-media-description';
exports.MEDIA_DESCRIPTION_MEDIA = 'ww-media-description__media';
exports.MEDIA_DESCRIPTION_DESCRIPTION = 'ww-media-description__description';
/**
 * MediaDescription
 */
var MediaDescription = /** @class */ (function (_super) {
    __extends(MediaDescription, _super);
    function MediaDescription() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.MediaDescription(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.MEDIA_DESCRIPTION, __1.getClassName(_this.attrs))
        };
        return _this;
    }
    return MediaDescription;
}(wml_1.Component));
exports.MediaDescription = MediaDescription;
/**
 * Media
 */
var Media = /** @class */ (function (_super) {
    __extends(Media, _super);
    function Media() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Media(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.MEDIA_DESCRIPTION_MEDIA, __1.getClassName(_this.attrs))
        };
        return _this;
    }
    return Media;
}(wml_1.Component));
exports.Media = Media;
/**
 * Description
 */
var Description = /** @class */ (function (_super) {
    __extends(Description, _super);
    function Description() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Description(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.MEDIA_DESCRIPTION_DESCRIPTION, __1.getClassName(_this.attrs))
        };
        return _this;
    }
    return Description;
}(wml_1.Component));
exports.Description = Description;

},{"../../":104,"../../util":143,"./wml/media-description":10,"@quenk/wml":153}],10:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Description = exports.Media = exports.MediaDescription = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var MediaDescription = /** @class */ (function () {
    function MediaDescription(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    MediaDescription.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    MediaDescription.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    MediaDescription.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    MediaDescription.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    MediaDescription.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    MediaDescription.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    MediaDescription.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    MediaDescription.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return MediaDescription;
}());
exports.MediaDescription = MediaDescription;
;
var Media = /** @class */ (function () {
    function Media(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    Media.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Media.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Media.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Media.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Media.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Media.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Media.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Media.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Media;
}());
exports.Media = Media;
;
var Description = /** @class */ (function () {
    function Description(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    Description.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Description.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Description.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Description.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Description.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Description.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Description.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Description.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Description;
}());
exports.Description = Description;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],11:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.MenuIcon = exports.MENU_ICON_DASH = exports.MENU_ICON = void 0;
var views = require("./wml/menu-icon");
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
///classNames:begin
exports.MENU_ICON = 'ww-menu-icon';
exports.MENU_ICON_DASH = 'ww-menu-icon__dash';
/**
 * MenuIcon provides a css implement icon normally used
 * to toggle a side menu.
 */
var MenuIcon = /** @class */ (function (_super) {
    __extends(MenuIcon, _super);
    function MenuIcon() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: {
                id: (_this.attrs.ww && _this.attrs.ww.id) ?
                    _this.attrs.ww.id : '',
                className: util_1.concat(exports.MENU_ICON, (_this.attrs.ww && _this.attrs.ww.id) ?
                    _this.attrs.ww.id : '')
            },
            dash: {
                id: 'dash',
                class: exports.MENU_ICON_DASH
            }
        };
        return _this;
    }
    return MenuIcon;
}(wml_1.Component));
exports.MenuIcon = MenuIcon;

},{"../../util":143,"./wml/menu-icon":12,"@quenk/wml":153}],12:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('span', { 'id': __context.values.root.id, 'class': __context.values.root.className }, [
                __this.node('span', { 'class': __context.values.dash.class }, []),
                __this.node('span', { 'class': __context.values.dash.class }, []),
                __this.node('span', { 'class': __context.values.dash.class }, [])
            ]);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],13:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getBlockClassName = exports.BOTTOM = exports.MIDDLE = exports.HORIZONTAL = exports.RIGHT = exports.LEFT = exports.JUSTIFIED = exports.CLEARFIX = exports.BLOCK = exports.POSITIONED = exports.PUSHABLE = exports.VERTICAL = void 0;
///classNames:begin
/**
 * VERTICAL indicates an element is vertical rendererd.
 */
exports.VERTICAL = '-vertical';
/**
 * PUSHABLE indicates an element supports being pushed
 * and can have styles added to it around the concept.
 */
exports.PUSHABLE = '-pushable';
/**
 * POSITIONED indicates an element is positioned and responds
 * to the left,right etc. properties.
 */
exports.POSITIONED = '-positioned';
/**
 * BLOCK indicates an element should be block displayed.
 */
exports.BLOCK = '-block';
/**
 * CLEARFIX hack.
 */
exports.CLEARFIX = '-clearfix';
/**
 * JUSTIFIED content.
 */
exports.JUSTIFIED = '-justified';
/**
 * LEFT indicates content floated or positioned to the left.
 */
exports.LEFT = '-left';
/**
 * RIGHT indicates content floated or positioned to the right.
 */
exports.RIGHT = '-right';
/**
 * HORIZONTAL indicates a horizontal alignment.
 */
exports.HORIZONTAL = '-horizontal';
exports.MIDDLE = '-middle';
exports.BOTTOM = '-bottom';
///classNames:end
/**
 * getBlockClassName provides the __BLOCK__ class name if the attribute
 * value is set to true.
 */
exports.getBlockClassName = function (attrs) {
    return (attrs.ww && (attrs.ww.block === true)) ? exports.BLOCK : '';
};

},{}],14:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Overlay = exports.OVERLAY = void 0;
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
var __1 = require("../../");
var overlay_1 = require("./wml/overlay");
///classNames:begin
exports.OVERLAY = 'ww-overlay';
/**
 * Overlay
 */
var Overlay = /** @class */ (function (_super) {
    __extends(Overlay, _super);
    function Overlay() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new overlay_1.Main(_this);
        _this.values = {
            wml: {
                id: 'root'
            },
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.OVERLAY, __1.getClassName(_this.attrs)),
            onclick: function () {
                if (_this.attrs.ww && _this.attrs.ww.onClick)
                    _this.attrs.ww.onClick();
            }
        };
        return _this;
    }
    /**
     * close the overlay.
     */
    Overlay.prototype.close = function () {
        var mO = util_1.getById(this.view, this.values.wml.id);
        if (mO.isJust()) {
            var n = mO.get();
            if (n.parentNode)
                n.parentNode.removeChild(n);
        }
    };
    return Overlay;
}(wml_1.Component));
exports.Overlay = Overlay;

},{"../../":104,"../../util":143,"./wml/overlay":15,"@quenk/wml":153}],15:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.wml.id }, 'id': __context.values.id, 'class': __context.values.className, 'onclick': __context.values.onclick }, []);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],16:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getSizeClassName = exports.Size = exports.EXTRA_LARGE = exports.LARGE = exports.MEDIUM = exports.SMALL = exports.EXTRA_SMALL = void 0;
///classNames:begin
exports.EXTRA_SMALL = '-extra-small';
exports.SMALL = '-small';
exports.MEDIUM = '-medium';
exports.LARGE = '-large';
exports.EXTRA_LARGE = '-extra-large';
///classNames:end
/**
 * Size
 */
var Size;
(function (Size) {
    Size["ExtraSmall"] = "extra-small";
    Size["Small"] = "small";
    Size["Medium"] = "medium";
    Size["Large"] = "large";
    Size["ExtraLarge"] = "extra-large";
})(Size = exports.Size || (exports.Size = {}));
/**
 * getSizeClassName
 */
exports.getSizeClassName = function (s) {
    if (s === Size.ExtraSmall)
        return exports.EXTRA_SMALL;
    else if (s === Size.Small)
        return exports.SMALL;
    else if (s === Size.Medium)
        return exports.MEDIUM;
    else if (s === Size.Large)
        return exports.LARGE;
    else if (s === Size.ExtraLarge)
        return exports.EXTRA_LARGE;
    return '';
};

},{}],17:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.isActive = exports.deactivate = exports.activate = exports.ACTIVE = void 0;
var util_1 = require("../../util");
///classNames:begin
/**
 * ACTIVE
 */
exports.ACTIVE = '-active';
/**
 * activate helper.
 *
 * Adds the ACTIVE class.
 */
exports.activate = function (view, id) {
    return util_1.getById(view, id)
        .map(function (e) {
        e.classList.remove(exports.ACTIVE);
        e.classList.add(exports.ACTIVE);
    });
};
/**
 * deactivate helper.
 *
 * Removes the ACTIVE class.
 */
exports.deactivate = function (view, id) {
    return util_1.getById(view, id)
        .map(function (e) { return e.classList.remove(exports.ACTIVE); });
};
/**
 * isActive helpder
 *
 * Queries whether the ACTIVE class is present.
 */
exports.isActive = function (view, id) {
    return util_1.getById(view, id)
        .map(function (e) { return e.classList.contains(exports.ACTIVE); })
        .orJust(function () { return false; })
        .get();
};

},{"../../util":143}],18:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DISABLED = void 0;
///classNames:begin
/**
 * DISABLED
 */
exports.DISABLED = '-disabled';
///classNames:end

},{}],19:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.toggle = exports.show = exports.hide = exports.isHidden = exports.HIDDEN = void 0;
var util_1 = require("../../util");
///classNames:begin
/**
 * HIDDEN means an element should not be visible but not removed
 * from the DOM.
 */
exports.HIDDEN = '-ww-hidden';
/**
 * isHidden helper.
 *
 * Retrieves an HTMLElement by id and checks whether
 * it has the hidden class attached.
 */
exports.isHidden = function (view, id) {
    var m = view.findById(id);
    if (m.isNothing()) {
        util_1.warnMissing(view, id);
        return true;
    }
    else {
        return m.get().classList.contains(exports.HIDDEN);
    }
};
/**
 * hide helper.
 *
 * Attempts to add HIDDEN to the target elements class name.
 */
exports.hide = function (view, id) {
    var m = view.findById(id);
    if (m.isNothing()) {
        return util_1.warnMissing(view, id);
    }
    else {
        var e = m.get();
        e.classList.remove(exports.HIDDEN);
        e.classList.add(exports.HIDDEN);
    }
};
/**
 * show helper.
 *
 * Attempts to remove the HIDDEN class name from the target element.
 */
exports.show = function (view, id) {
    var m = view.findById(id);
    if (m.isNothing()) {
        return util_1.warnMissing(view, id);
    }
    else {
        m.get().classList.remove(exports.HIDDEN);
    }
};
/**
 * toggle helper.
 *
 * Attempts to toggle the HIDDEN class name from the target element
 * classList.
 */
exports.toggle = function (view, id) {
    var m = view.findById(id);
    if (m.isNothing()) {
        return util_1.warnMissing(view, id);
    }
    else {
        m.get().classList.toggle(exports.HIDDEN);
    }
};

},{"../../util":143}],20:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getStyleClassName = exports.styles = exports.Style = exports.OUTLINE = exports.ERROR = exports.WARNING = exports.INFO = exports.SUCCESS = exports.PRIMARY = exports.DEFAULT = void 0;
///classNames:begin
/**
 * DEFAULT style.
 */
exports.DEFAULT = '-default';
/**
 * PRIMARY style.
 */
exports.PRIMARY = '-primary';
/**
 * SUCCESS style.
 */
exports.SUCCESS = '-success';
/**
 * INFO style.
 */
exports.INFO = '-info';
/**
 * WARNING style.
 */
exports.WARNING = '-warning';
/**
 * ERROR style.
 */
exports.ERROR = '-error';
/**
 * OUTLINE style.
 */
exports.OUTLINE = '-outline';
///classNames:end
/**
 * Style enum.
 */
var Style;
(function (Style) {
    Style["Default"] = "default";
    Style["Primary"] = "primary";
    Style["Success"] = "success";
    Style["Info"] = "info";
    Style["Warning"] = "warning";
    Style["Error"] = "error";
})(Style = exports.Style || (exports.Style = {}));
exports.styles = [
    Style.Default,
    Style.Success,
    Style.Info,
    Style.Warning,
    Style.Error
];
/**
 * getStyleClassName
 */
exports.getStyleClassName = function (s) {
    switch (s) {
        case Style.Default:
            return exports.DEFAULT;
        case Style.Primary:
            return exports.PRIMARY;
        case Style.Success:
            return exports.SUCCESS;
        case Style.Info:
            return exports.INFO;
        case Style.Warning:
            return exports.WARNING;
        case Style.Error:
            return exports.ERROR;
    }
    return exports.DEFAULT;
};

},{}],21:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Tag = exports.TAG = exports.Style = void 0;
var dom_1 = require("@quenk/wml/lib/dom");
var wml_1 = require("@quenk/wml");
var style_1 = require("../../content/style");
Object.defineProperty(exports, "Style", { enumerable: true, get: function () { return style_1.Style; } });
var util_1 = require("../../util");
var __1 = require("../../");
var tag_1 = require("./wml/tag");
///classNames:begin
exports.TAG = 'ww-tag';
/**
 * Tag
 */
var Tag = /** @class */ (function (_super) {
    __extends(Tag, _super);
    function Tag() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new tag_1.Main(_this);
        _this.values = {
            wml: {
                id: 'tag'
            },
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.TAG, __1.getClassName(_this.attrs), (_this.attrs.ww && _this.attrs.ww.style) ?
                style_1.getStyleClassName(_this.attrs.ww.style) :
                style_1.DEFAULT),
            onclick: function (_) {
                if (_this.attrs.ww && _this.attrs.ww.onClick)
                    _this.attrs.ww.onClick();
            },
            content: (_this.attrs.ww && _this.attrs.ww.text) ?
                [dom_1.text(_this.attrs.ww.text)] : _this.children
        };
        return _this;
    }
    return Tag;
}(wml_1.Component));
exports.Tag = Tag;

},{"../../":104,"../../content/style":20,"../../util":143,"./wml/tag":22,"@quenk/wml":153,"@quenk/wml/lib/dom":152}],22:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('span', { wml: { 'id': __context.values.wml.id }, 'id': __context.values.id, 'class': __context.values.className, 'onclick': __context.values.onclick }, __spreadArrays((__context.values.content)));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],23:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Caption = exports.Thumbnail = exports.THUMBNAIL_CAPTION = exports.THUMBNAIL = void 0;
var views = require("./wml/thumbnail");
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
var __1 = require("../../");
///classNames:begin
exports.THUMBNAIL = 'ww-thumbnail';
exports.THUMBNAIL_CAPTION = 'ww-thumbnail__caption';
/**
 * Thumbnail
 */
var Thumbnail = /** @class */ (function (_super) {
    __extends(Thumbnail, _super);
    function Thumbnail() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = (_this.attrs.ww && _this.attrs.ww.href) ?
            new views.Anchor(_this) : new views.Thumbnail(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.THUMBNAIL, __1.getClassName(_this.attrs)),
            href: (_this.attrs.ww && _this.attrs.ww.href) ?
                _this.attrs.ww.href : '',
            onclick: function (e) {
                if (_this.attrs.ww && _this.attrs.ww.onClick) {
                    e.preventDefault();
                    _this.attrs.ww.onClick();
                }
            }
        };
        return _this;
    }
    return Thumbnail;
}(wml_1.Component));
exports.Thumbnail = Thumbnail;
/**
 * Caption
 */
var Caption = /** @class */ (function (_super) {
    __extends(Caption, _super);
    function Caption() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Caption(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.THUMBNAIL_CAPTION, __1.getClassName(_this.attrs))
        };
        return _this;
    }
    return Caption;
}(wml_1.Component));
exports.Caption = Caption;

},{"../../":104,"../../util":143,"./wml/thumbnail":24,"@quenk/wml":153}],24:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Caption = exports.Anchor = exports.Thumbnail = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Thumbnail = /** @class */ (function () {
    function Thumbnail(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.id, 'class': __context.values.className, 'onclick': __context.values.onclick }, __spreadArrays((__context.children)));
        };
    }
    Thumbnail.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Thumbnail.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Thumbnail.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Thumbnail.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Thumbnail.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Thumbnail.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Thumbnail.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Thumbnail.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Thumbnail;
}());
exports.Thumbnail = Thumbnail;
;
var Anchor = /** @class */ (function () {
    function Anchor(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('a', { 'id': __context.values.id, 'class': __context.values.className, 'href': __context.values.href, 'onclick': __context.values.onclick }, __spreadArrays((__context.children)));
        };
    }
    Anchor.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Anchor.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Anchor.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Anchor.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Anchor.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Anchor.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Anchor.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Anchor.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Anchor;
}());
exports.Anchor = Anchor;
;
var Caption = /** @class */ (function () {
    function Caption(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    Caption.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Caption.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Caption.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Caption.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Caption.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Caption.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Caption.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Caption.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Caption;
}());
exports.Caption = Caption;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],25:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.ButtonGroup = exports.BUTTON_GROUP_COMPAT = exports.BUTTON_GROUP_BUTTON = exports.BUTTON_GROUP = void 0;
var views = require("./wml/button-group");
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
var toolbar_1 = require("../toolbar");
var __1 = require("../../");
///classNames:begin
exports.BUTTON_GROUP = 'ww-button-group';
exports.BUTTON_GROUP_BUTTON = 'ww-button-group__button';
exports.BUTTON_GROUP_COMPAT = 'ww-button-group-compat';
/**
 * ButtonGroup groups multiple buttons into one element.
 */
var ButtonGroup = /** @class */ (function (_super) {
    __extends(ButtonGroup, _super);
    function ButtonGroup() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: {
                id: __1.getId(_this.attrs),
                className: util_1.concat(exports.BUTTON_GROUP, toolbar_1.TOOLBAR_COMPAT, __1.getClassName(_this.attrs))
            }
        };
        return _this;
    }
    return ButtonGroup;
}(wml_1.Component));
exports.ButtonGroup = ButtonGroup;

},{"../../":104,"../../util":143,"../toolbar":83,"./wml/button-group":26,"@quenk/wml":153}],26:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.root.id, 'class': __context.values.root.className }, __spreadArrays((__context.children)));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],27:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.MultiButtonSelect = exports.ButtonSelect = exports.MultiButtonSection = exports.ButtonSection = exports.ButtonSelectValues = exports.ButtonChangedEvent = exports.BUTTON_SELECT_OPTION = exports.BUTTON_SELECT = void 0;
var util_1 = require("../../util");
var __1 = require("../../");
var __2 = require("../");
var button_select_1 = require("./wml/button-select");
///className:begin
exports.BUTTON_SELECT = 'ww-button-select';
exports.BUTTON_SELECT_OPTION = 'ww-button-select__option';
/**
 * ButtonChangedEvent
 */
var ButtonChangedEvent = /** @class */ (function (_super) {
    __extends(ButtonChangedEvent, _super);
    function ButtonChangedEvent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return ButtonChangedEvent;
}(__2.Event));
exports.ButtonChangedEvent = ButtonChangedEvent;
/**
 * @private
 */
var ButtonSelectValues = /** @class */ (function () {
    function ButtonSelectValues(ref, button) {
        this.ref = ref;
        this.button = button;
        this.id = __1.getId(this.ref.attrs);
        this.className = util_1.concat(exports.BUTTON_SELECT, __1.getClassName(this.ref.attrs));
    }
    return ButtonSelectValues;
}());
exports.ButtonSelectValues = ButtonSelectValues;
/**
 * @private
 */
var ButtonSection = /** @class */ (function () {
    function ButtonSection(ref, onClick) {
        var _this = this;
        this.ref = ref;
        this.onClick = onClick;
        this.current = getCurrent(this.ref.attrs);
        this.selected = [];
        this.options = (this.ref.attrs.ww && this.ref.attrs.ww.options) ?
            this.ref.attrs.ww.options : [];
        this.isActive = function (n) { return _this.ref.values.button.current === n; };
        this.getClassNames = function (n) {
            return util_1.concat(exports.BUTTON_SELECT_OPTION, _this.ref.values.button.options[n].className);
        };
    }
    return ButtonSection;
}());
exports.ButtonSection = ButtonSection;
/**
 * @private
 */
var MultiButtonSection = /** @class */ (function (_super) {
    __extends(MultiButtonSection, _super);
    function MultiButtonSection(ref, onClick) {
        var _this = _super.call(this, ref, onClick) || this;
        _this.ref = ref;
        _this.onClick = onClick;
        _this.selected = getSelected(_this.ref);
        _this.isActive = function (n) { return _this.ref.values.button.selected.indexOf(n) > -1; };
        return _this;
    }
    return MultiButtonSection;
}(ButtonSection));
exports.MultiButtonSection = MultiButtonSection;
/**
 * ButtonSelect
 */
var ButtonSelect = /** @class */ (function (_super) {
    __extends(ButtonSelect, _super);
    function ButtonSelect() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new button_select_1.ButtonSelectView(_this);
        _this.values = new ButtonSelectValues(_this, new ButtonSection(_this, function (idx) {
            _this.values.button.current = idx;
            if ((_this.attrs.ww && _this.attrs.ww.onChange))
                _this.attrs.ww.onChange(new ButtonChangedEvent(_this.attrs.ww.name, _this.values.button.options[idx].value));
            _this.view.invalidate();
        }));
        return _this;
    }
    return ButtonSelect;
}(__2.AbstractControl));
exports.ButtonSelect = ButtonSelect;
/**
 * MultiButtonSelect
 */
var MultiButtonSelect = /** @class */ (function (_super) {
    __extends(MultiButtonSelect, _super);
    function MultiButtonSelect() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new button_select_1.ButtonSelectView(_this);
        _this.values = new ButtonSelectValues(_this, new MultiButtonSection(_this, function (n) {
            var selected = _this.values.button.selected;
            var pos = selected.indexOf(n);
            if (pos > -1)
                selected.splice(pos, 1);
            else
                selected.push(n);
            if (_this.attrs.ww && _this.attrs.ww.onChange)
                _this.attrs.ww.onChange(new ButtonChangedEvent(_this.attrs.ww.name, selected.map(function (n) { return _this.values.button.options[n].value; })));
            _this.view.invalidate();
        }));
        return _this;
    }
    return MultiButtonSelect;
}(__2.AbstractControl));
exports.MultiButtonSelect = MultiButtonSelect;
var getCurrent = function (attrs) {
    if ((attrs.ww != null) &&
        (attrs.ww.value != null) &&
        (attrs.ww.options != null)) {
        return attrs.ww.options.reduce(function (p, c, k) {
            return c.value ===
                attrs.ww.value ? k : p;
        }, -1);
    }
    return -1;
};
var getSelected = function (that) {
    if (that.attrs &&
        that.attrs.ww &&
        that.attrs.ww.value &&
        that.attrs.ww.options) {
        var _a = that.attrs.ww, value = _a.value, options_1 = _a.options;
        return value.map(function (v) { return options_1.reduce(function (p, c, i) {
            return (p > -1) ? p : (c.value === v) ? i : p;
        }, -1); });
    }
    else {
        return [];
    }
};

},{"../":54,"../../":104,"../../util":143,"./wml/button-select":28}],28:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ButtonSelectView = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var button_group_1 = require("../../button-group");
;
var button_1 = require("../../button");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
;
var ButtonSelectView = /** @class */ (function () {
    function ButtonSelectView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new button_group_1.ButtonGroup({ ww: { 'id': __context.values.id, 'className': __context.values.className } }, __spreadArrays(__forIn(__context.values.button.options, function (opt, idx, _$$all) {
                return ([
                    __this.widget(new button_1.Button({ ww: { 'className': __context.values.button.getClassNames(idx), 'active': __context.values.button.isActive(idx), 'onClick': function () { return __context.values.button.onClick(idx); }, 'text': opt.text } }, []), { ww: { 'className': __context.values.button.getClassNames(idx), 'active': __context.values.button.isActive(idx), 'onClick': function () { return __context.values.button.onClick(idx); }, 'text': opt.text } })
                ]);
            }, function () { return ([]); }))), { ww: { 'id': __context.values.id, 'className': __context.values.className } });
        };
    }
    ButtonSelectView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    ButtonSelectView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    ButtonSelectView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    ButtonSelectView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    ButtonSelectView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    ButtonSelectView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    ButtonSelectView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    ButtonSelectView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return ButtonSelectView;
}());
exports.ButtonSelectView = ButtonSelectView;

},{"../../button":29,"../../button-group":25,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],29:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Button = exports.ButtonClickedEvent = exports.BUTTON = exports.Style = void 0;
var views = require("./wml/button");
var dom_1 = require("@quenk/wml/lib/dom");
var toolbar_1 = require("../toolbar");
var active_1 = require("../../content/state/active");
var orientation_1 = require("../../content/orientation");
var style_1 = require("../../content/style");
Object.defineProperty(exports, "Style", { enumerable: true, get: function () { return style_1.Style; } });
var size_1 = require("../../content/size");
var util_1 = require("../../util");
var __1 = require("../../");
var __2 = require("../");
///classNames:begin
exports.BUTTON = 'ww-button';
;
/**
 * ButtonClickedEvent
 */
var ButtonClickedEvent = /** @class */ (function (_super) {
    __extends(ButtonClickedEvent, _super);
    function ButtonClickedEvent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return ButtonClickedEvent;
}(__2.Event));
exports.ButtonClickedEvent = ButtonClickedEvent;
/**
 * Button is an improvement over HTMLButtionElement
 */
var Button = /** @class */ (function (_super) {
    __extends(Button, _super);
    function Button() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = (_this.attrs.ww && _this.attrs.ww.anchor) ?
            new views.AnchorView(_this) : new views.ButtonView(_this);
        _this.values = {
            button: {
                wml: {
                    id: 'button'
                },
                id: __1.getId(_this.attrs),
                className: util_1.concat(exports.BUTTON, __1.getClassName(_this.attrs), toolbar_1.TOOLBAR_COMPAT, (_this.attrs.ww && _this.attrs.ww.style) ?
                    style_1.getStyleClassName(_this.attrs.ww.style) :
                    style_1.DEFAULT, (_this.attrs.ww && _this.attrs.ww.size) ?
                    size_1.getSizeClassName(_this.attrs.ww.size) : '', (_this.attrs.ww && _this.attrs.ww.outline) ?
                    style_1.OUTLINE : '', (_this.attrs.ww && _this.attrs.ww.block) ?
                    orientation_1.BLOCK : '', (_this.attrs.ww && _this.attrs.ww.active) ?
                    active_1.ACTIVE : ''),
                type: (_this.attrs.ww && _this.attrs.ww.type) ?
                    _this.attrs.ww.type : 'button',
                name: (_this.attrs.ww && _this.attrs.ww.name) ? _this.attrs.ww.name : '',
                disabled: (_this.attrs.ww && _this.attrs.ww.disabled) ? true : null,
                anchor: (_this.attrs.ww && _this.attrs.ww.anchor) ?
                    _this.attrs.ww.anchor : false,
                onclick: function (e) {
                    e.preventDefault();
                    _this.attrs.ww &&
                        _this.attrs.ww.onClick &&
                        _this.attrs.ww.onClick(new ButtonClickedEvent((_this.attrs.ww && _this.attrs.ww.name) ?
                            _this.attrs.ww.name : '', _this.attrs.ww.value));
                },
                content: function () { return (_this.attrs.ww && _this.attrs.ww.text) ?
                    [dom_1.text(_this.attrs.ww.text)] : _this.children; }
            }
        };
        return _this;
    }
    /**
     * disable this button.
     */
    Button.prototype.disable = function () {
        util_1.getById(this.view, this.values.button.wml.id)
            .map(function (b) { return b.setAttribute('disabled', 'disabled'); });
    };
    /**
     * enable this button.
     */
    Button.prototype.enable = function () {
        util_1.getById(this.view, this.values.button.wml.id)
            .map(function (b) { return b.removeAttribute('disabled'); });
    };
    /**
     * toggle the disabled state of this button.
     */
    Button.prototype.toggle = function () {
        var _this = this;
        util_1.getById(this.view, this.values.button.wml.id)
            .map(function (b) { return b.hasAttribute('disabled') ?
            _this.enable() : _this.disable(); });
    };
    return Button;
}(__2.AbstractControl));
exports.Button = Button;

},{"../":54,"../../":104,"../../content/orientation":13,"../../content/size":16,"../../content/state/active":17,"../../content/style":20,"../../util":143,"../toolbar":83,"./wml/button":30,"@quenk/wml/lib/dom":152}],30:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.AnchorView = exports.ButtonView = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var ButtonView = /** @class */ (function () {
    function ButtonView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('button', { wml: { 'id': __context.values.button.wml.id }, 'id': __context.values.button.id, 'type': __context.values.button.type, 'name': __context.values.button.name, 'disabled': __context.values.button.disabled, 'class': __context.values.button.className, 'onclick': __context.values.button.onclick }, __spreadArrays((__context.values.button.content())));
        };
    }
    ButtonView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    ButtonView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    ButtonView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    ButtonView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    ButtonView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    ButtonView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    ButtonView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    ButtonView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return ButtonView;
}());
exports.ButtonView = ButtonView;
;
var AnchorView = /** @class */ (function () {
    function AnchorView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('a', { wml: { 'id': __context.values.button.wml.id }, 'id': __context.values.button.id, 'type': __context.values.button.type, 'href': '#', 'name': __context.values.button.name, 'disabled': __context.values.button.disabled, 'class': __context.values.button.className, 'onclick': __context.values.button.onclick }, __spreadArrays((__context.values.button.content())));
        };
    }
    AnchorView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    AnchorView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    AnchorView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    AnchorView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    AnchorView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    AnchorView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    AnchorView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    AnchorView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return AnchorView;
}());
exports.AnchorView = AnchorView;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],31:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Checkbox = exports.CheckChangedEvent = exports.CHECKBOX = void 0;
var checkbox_1 = require("./wml/checkbox");
var util_1 = require("../../util");
var __1 = require("../");
var __2 = require("../../");
///classNames:begin
exports.CHECKBOX = 'ww-checkbox';
/**
 * CheckChangedEvent signals the user has changed the checkbox state.
 */
var CheckChangedEvent = /** @class */ (function (_super) {
    __extends(CheckChangedEvent, _super);
    function CheckChangedEvent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return CheckChangedEvent;
}(__1.Event));
exports.CheckChangedEvent = CheckChangedEvent;
/**
 * Checkbox control.
 *
 * This is an alternative to the native checkbox that can be styled.
 */
var Checkbox = /** @class */ (function (_super) {
    __extends(Checkbox, _super);
    function Checkbox() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new checkbox_1.Main(_this);
        _this.values = {
            root: {
                id: __2.getId(_this.attrs),
                className: util_1.concat(exports.CHECKBOX, __2.getClassName(_this.attrs))
            },
            input: {
                name: __1.getName(_this.attrs),
                value: (_this.attrs.ww && _this.attrs.ww.value) ?
                    _this.attrs.ww.value : null,
                onChange: function () {
                    _this.values.input.value = (!_this.values.input.value) || null;
                    if (_this.attrs.ww && _this.attrs.ww.onChange)
                        _this.attrs.ww.onChange(new CheckChangedEvent(_this.values.input.name, _this.values.input.value || false));
                }
            }
        };
        return _this;
    }
    return Checkbox;
}(__1.AbstractControl));
exports.Checkbox = Checkbox;

},{"../":54,"../../":104,"../../util":143,"./wml/checkbox":32}],32:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('span', { 'id': __context.values.root.id, 'class': __context.values.root.className }, [
                __this.node('label', {}, __spreadArrays([
                    __this.node('input', { 'type': 'checkbox', 'name': __context.values.input.name, 'checked': __context.values.input.value, 'onchange': __context.values.input.onChange }, [])
                ], (__context.children)))
            ]);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],33:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.CloseButton = exports.CLOSE_BUTTON = void 0;
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
var __1 = require("../../");
var close_button_1 = require("./wml/close-button");
///classNames:begin
exports.CLOSE_BUTTON = 'ww-close-button';
;
/**
 * CloseButton used to display the "x" on dialogs etc.
 */
var CloseButton = /** @class */ (function (_super) {
    __extends(CloseButton, _super);
    function CloseButton() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new close_button_1.Main(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.CLOSE_BUTTON, __1.getClassName(_this.attrs)),
            wml: {
                id: 'close-button'
            },
            onclick: function () {
                if (_this.attrs.ww && _this.attrs.ww.onClick)
                    _this.attrs.ww.onClick();
            }
        };
        return _this;
    }
    return CloseButton;
}(wml_1.Component));
exports.CloseButton = CloseButton;

},{"../../":104,"../../util":143,"./wml/close-button":34,"@quenk/wml":153}],34:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var close_1 = require("../../../content/close");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('button', { 'id': __context.values.id, 'class': __context.values.className, 'onclick': __context.values.onclick }, [
                __this.widget(new close_1.Close({}, []), {})
            ]);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../content/close":3,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],35:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DateField = exports.DateChangedEvent = exports.Format = exports.usFormats = exports.commonFormats = exports.iso8601Formats = exports.YESTERDAY = exports.NOW = exports.TODAY = exports.DELAY = exports.VALUE_FORMAT = exports.DEFAULT_INPUT_DISPLAY = exports.DEFAULT_INPUT_PLACEHOLDER = exports.DEFAULT_INPUT_FORMAT = exports.DATE_FIELD_INPUT = exports.DATE_FIELD = void 0;
var views = require("./wml/date-field");
var moment = require("moment");
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var util_1 = require("../../util");
var feedback_1 = require("../feedback");
var form_1 = require("../form");
var __1 = require("../../");
var __2 = require("../");
var orientation_1 = require("../../content/orientation");
///classNames:begin
exports.DATE_FIELD = 'ww-date-field';
exports.DATE_FIELD_INPUT = 'ww-date-field__input';
///classNames:end
exports.DEFAULT_INPUT_FORMAT = moment.ISO_8601;
exports.DEFAULT_INPUT_PLACEHOLDER = 'YYYY-MM-DD';
exports.DEFAULT_INPUT_DISPLAY = 'YYYY-MM-DD';
exports.VALUE_FORMAT = 'YYYY-MM-DD';
exports.DELAY = 200;
exports.TODAY = 'today';
exports.NOW = 'now';
exports.YESTERDAY = 'yesterday';
exports.iso8601Formats = [
    'YYYY-MM-DD',
    'YYYY-MM-D',
    'YYYY-M-DD',
    'YYYY-M-D',
    'YY-MM-DD',
    'YY-MM-D',
    'YY-M-DD',
    'YY-M-D',
    'YYYY/MM/DD',
    'YYYY/MM/D',
    'YYYY/M/DD',
    'YYYY/M/D',
    'YY/MM/DD',
    'YY/MM/D',
    'YY/M/DD',
    'YY/M/D',
    'YYYY MM DD',
    'YYYY MM D',
    'YYYY M DD',
    'YYYY M D',
    'YY MM DD',
    'YY MM D',
    'YY M DD',
    'YY M D',
    'YYYYMMDD',
    'YYYYMMD',
    'YYYYMDD',
    'YYYYMD',
    'YYMMDD',
    'YYMMD',
    'YYMDD',
    'YYMD',
];
exports.commonFormats = [
    'DD-MM-YYYY',
    'D-MM-YYYY',
    'DD-M-YYYY',
    'D-M-YYYY',
    'DD-MM-YY',
    'D-MM-YY',
    'DD-M-YY',
    'D-M-YY',
    'DD/MM/YYYY',
    'D/MM/YYYY',
    'DD/M/YYYY',
    'D/M/YYYY',
    'DD/MM/YY',
    'D/MM/YY',
    'DD/M/YY',
    'D/M/YY',
    'DD MM YYYY',
    'D MM YYYY',
    'DD M YYYY',
    'D M YYYY',
    'DD MM YY',
    'D MM YY',
    'DD M YY',
    'D M YY',
    'DDMMYYYY',
    'DMMYYYY',
    'DDMYYYY',
    'DMYYYY',
    'DDMMYY',
    'DMMYY',
    'DDMYY',
    'DMYY',
];
exports.usFormats = [
    'MM-DD-YYYY',
    'MM-D-YYYY',
    'M-DD-YYYY',
    'M-D-YYYY',
    'MM-DD-YY',
    'MM-D-YY',
    'M-DD-YY',
    'M-D-YY',
    'MM/DD/YYYY',
    'MM/D/YYYY',
    'M/DD/YYYY',
    'M/D/YYYY',
    'MM/DD/YY',
    'MM/D/YY',
    'M/DD/YY',
    'M/D/YY',
    'MM DD YYYY',
    'MM D YYYY',
    'M DD YYYY',
    'M D YYYY',
    'MM DD YY',
    'MM D YY',
    'M DD YY',
    'M D YY',
    'MMDDYYYY',
    'MMDYYYY',
    'MDDYYYY',
    'MDYYYY',
    'MMDDYY',
    'MMDYY',
    'MDDYY',
    'MDYY',
];
/**
 * Format is used to determine what format input should be parsed as.
 */
var Format;
(function (Format) {
    Format[Format["ISO8601"] = 1] = "ISO8601";
    Format[Format["COMMON"] = 2] = "COMMON";
    Format[Format["USA"] = 3] = "USA";
})(Format = exports.Format || (exports.Format = {}));
/**
 * DateChangedEvent is generated when a valid date has been entered.
 *
 * The value is a truncated ISO8601 string consisting of the date part alone.
 */
var DateChangedEvent = /** @class */ (function (_super) {
    __extends(DateChangedEvent, _super);
    function DateChangedEvent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return DateChangedEvent;
}(__2.Event));
exports.DateChangedEvent = DateChangedEvent;
/**
 * DateField provides a text field for entering dates.
 *
 * It will only fire change events when the date input matches one
 * of the 3 format sets (ISO8601,Common,US).
 *
 * If the user removes focus and the entry is not valid, it will be ignored
 * and no change event will be fired. Once a valid date has been entered,
 * the value displayed can be formated using the format specified in the
 * "display" attribute. This does not affect the actual value provided
 * to onChange handlers.
 */
var DateField = /** @class */ (function (_super) {
    __extends(DateField, _super);
    function DateField() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: {
                wml: { id: 'root' },
                id: __1.getId(_this.attrs),
                className: util_1.concat(exports.DATE_FIELD, __1.getClassName(_this.attrs), orientation_1.getBlockClassName(_this.attrs), feedback_1.getValidityClassName(_this.attrs)),
            },
            control: {
                wml: { id: 'input' },
                id: __1.getId(_this.attrs)
            },
            label: {
                id: (_this.attrs.ww && _this.attrs.ww.name) || '',
                text: (_this.attrs.ww && _this.attrs.ww.label) || ''
            },
            messages: {
                wml: {
                    id: 'messages'
                },
                text: feedback_1.getMessage(_this.attrs)
            },
            input: {
                wml: { id: 'input' },
                className: exports.DATE_FIELD_INPUT,
                name: __2.getName(_this.attrs),
                format: getFormat(_this.attrs),
                placeholder: getPlaceholder(_this.attrs),
                display: getDisplay(_this.attrs),
                moment: ((_this.attrs.ww && _this.attrs.ww.value) ?
                    maybe_1.just(parseDate(getValue(_this.attrs), getFormat(_this.attrs))) :
                    maybe_1.nothing()),
                value: function () { return (_this.values.input.moment.isJust() &&
                    _this.values.input.moment.get().isValid()) ?
                    _this.values.input.moment.get().format(_this.values.input.display) : ''; },
                disabled: (_this.attrs.ww && _this.attrs.ww.disabled === true) ?
                    true : null,
                onfocus: function (e) {
                    e.target.select();
                },
                oninput: function (e) {
                    e.target.oninput = null;
                    _this.values.input.onkeyup(e);
                },
                onkeyup: util_1.debounce(function (e) {
                    var value = e.target.value;
                    if (value === '') {
                        _this.values.input.moment = maybe_1.nothing();
                        _this.fireChange();
                    }
                    else {
                        var m = parseDate(value, _this.values.input.format);
                        if (m.isValid()) {
                            _this.values.input.moment = maybe_1.just(m);
                            _this.fireChange();
                        }
                    }
                }, exports.DELAY),
                onblur: function () {
                    _this.view.invalidate();
                }
            }
        };
        return _this;
    }
    /**
     * @private
     */
    DateField.prototype.fireChange = function () {
        if (this.attrs.ww && this.attrs.ww.onChange) {
            var name_1 = this.attrs.ww.name || '';
            if (this.values.input.moment.isJust()) {
                var m = this.values.input.moment.get();
                if (m.isValid())
                    this.attrs.ww.onChange(new DateChangedEvent(name_1, m.format(exports.VALUE_FORMAT)));
            }
            else {
                this.attrs.ww.onChange(new DateChangedEvent(name_1, undefined));
            }
        }
    };
    DateField.prototype.setMessage = function (msg) {
        this.values.messages.text = msg;
        form_1.setMessage(this.view, this.values.messages.wml.id, msg);
        return this;
    };
    DateField.prototype.removeMessage = function () {
        this.values.messages.text = '';
        form_1.removeMessage(this.view, this.values.messages.wml.id);
        return this;
    };
    return DateField;
}(form_1.AbstractFormControl));
exports.DateField = DateField;
var parseDate = function (d, formats) {
    var str = d.toLowerCase();
    if ((str === exports.TODAY) || (str === exports.NOW)) {
        return moment.utc();
    }
    else if (str === exports.YESTERDAY) {
        return moment.utc().subtract(1, 'd');
    }
    else {
        return moment.utc(d, __spreadArrays(formats, [moment.ISO_8601]), true);
    }
};
var getValue = function (attrs) {
    return (attrs.ww && attrs.ww.value) ? attrs.ww.value : '';
};
var getFormat = function (attrs) {
    if (attrs.ww && attrs.ww.format) {
        switch (attrs.ww.format) {
            case 2:
                return exports.commonFormats;
            case 3:
                return exports.usFormats;
            default:
                break;
        }
    }
    return exports.iso8601Formats;
};
var getPlaceholder = function (attrs) {
    if (attrs.ww && attrs.ww.placeholder)
        return attrs.ww.placeholder;
    if (attrs.ww && attrs.ww.format) {
        switch (attrs.ww.format) {
            case 2:
                return 'DD-MM-YYYY';
            case 3:
                return 'MM-DD-YYYY';
            default:
                return 'YYYY-MM-DD';
        }
    }
    return 'YYYY-MM-DD';
};
var getDisplay = function (attrs) {
    return (attrs.ww && attrs.ww.display) ? attrs.ww.display : exports.DEFAULT_INPUT_DISPLAY;
};

},{"../":54,"../../":104,"../../content/orientation":13,"../../util":143,"../feedback":45,"../form":51,"./wml/date-field":36,"@quenk/noni/lib/data/maybe":147,"moment":154}],36:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var label_1 = require("../../label");
;
var help_1 = require("../../help");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.root.id, 'class': __context.values.root.className }, [
                __this.widget(new label_1.Label({ ww: { 'for': __context.values.root.id, 'text': __context.values.label.text } }, []), { ww: { 'for': __context.values.root.id, 'text': __context.values.label.text } }),
                __this.node('input', { wml: { 'id': __context.values.input.wml.id }, 'name': __context.values.input.wml.id, 'onfocus': __context.values.input.onfocus, 'oninput': __context.values.input.oninput, 'onkeyup': __context.values.input.onkeyup, 'onblur': __context.values.input.onblur, 'value': __context.values.input.value(), 'disabled': __context.values.input.disabled, 'class': __context.values.input.className, 'placeholder': __context.values.input.placeholder }, []),
                __this.widget(new help_1.Help({ wml: { 'id': __context.values.messages.wml.id }, ww: { 'text': __context.values.messages.text } }, []), { wml: { 'id': __context.values.messages.wml.id }, ww: { 'text': __context.values.messages.text } })
            ]);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../help":52,"../../label":57,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],37:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.DisplayField = exports.DISPLAY_FIELD_CONTENT = exports.DISPLAY_FIELD = exports.Style = void 0;
var wml_1 = require("@quenk/wml");
var toolbar_1 = require("../toolbar");
var orientation_1 = require("../../content/orientation");
var disabled_1 = require("../../content/state/disabled");
var style_1 = require("../../content/style");
Object.defineProperty(exports, "Style", { enumerable: true, get: function () { return style_1.Style; } });
var size_1 = require("../../content/size");
var util_1 = require("../../util");
var __1 = require("../../");
var display_field_1 = require("./wml/display-field");
///classNames:begin
exports.DISPLAY_FIELD = 'ww-display-field';
exports.DISPLAY_FIELD_CONTENT = 'ww-display-field__content';
;
/**
 * DisplayField is used to display a value in a text field like box.
 */
var DisplayField = /** @class */ (function (_super) {
    __extends(DisplayField, _super);
    function DisplayField() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new display_field_1.Main(_this);
        _this.values = {
            wml: {
                id: 'display'
            },
            id: __1.getId(_this.attrs),
            disabled: (_this.attrs.ww && _this.attrs.ww.disabled) ?
                _this.attrs.ww.disabled : false,
            className: util_1.concat(exports.DISPLAY_FIELD, __1.getClassName(_this.attrs), toolbar_1.TOOLBAR_COMPAT, (_this.attrs.ww && _this.attrs.ww.style) ?
                style_1.getStyleClassName(_this.attrs.ww.style) :
                style_1.DEFAULT, (_this.attrs.ww && _this.attrs.ww.size) ?
                size_1.getSizeClassName(_this.attrs.ww.size) : '', (_this.attrs.ww && _this.attrs.ww.block) ?
                orientation_1.BLOCK : '', (_this.attrs.ww && _this.attrs.ww.disabled) ?
                disabled_1.DISABLED : ''),
            onclick: function (e) {
                e.stopPropagation(); //prevent a bug when used with ResultsMenu
                if (_this.attrs.ww &&
                    _this.attrs.ww.onClick &&
                    (!_this.values.disabled))
                    _this.attrs.ww.onClick();
            },
            content: {
                className: exports.DISPLAY_FIELD_CONTENT
            }
        };
        return _this;
    }
    return DisplayField;
}(wml_1.Component));
exports.DisplayField = DisplayField;

},{"../../":104,"../../content/orientation":13,"../../content/size":16,"../../content/state/disabled":18,"../../content/style":20,"../../util":143,"../toolbar":83,"./wml/display-field":38,"@quenk/wml":153}],38:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.id, 'class': __context.values.className, 'onclick': __context.values.onclick }, [
                __this.node('div', { 'class': __context.values.content.className }, __spreadArrays((__context.children)))
            ]);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],39:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.DropDown = exports.DROP_DOWN_CONTENT = exports.DROP_DOWN_TOGGLE = exports.DROP_DOWN = void 0;
var views = require("./wml/drop-down");
var hidden = require("../../content/state/hidden");
var style = require("../../content/style");
var wml_1 = require("@quenk/wml");
var button_group_1 = require("../button-group");
var util_1 = require("../../util");
var __1 = require("../../");
///classNames:begin
exports.DROP_DOWN = 'ww-drop-down-menu';
exports.DROP_DOWN_TOGGLE = 'ww-drop-down-menu__toggle';
exports.DROP_DOWN_CONTENT = 'ww-drop-down__content';
/**
 * DropDown provides a component for displaying a pop up menu.
 *
 *    +--------+
 *    |  Menu  |
 *    +--------+
 *    +-------------------------+
 *    |                         |
 *    | ----------------------- |
 *    |                         |
 *    | ----------------------- |
 *    |                         |
 *    | ----------------------- |
 *    |                         |
 *    +-------------------------+
 */
var DropDown = /** @class */ (function (_super) {
    __extends(DropDown, _super);
    function DropDown() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: {
                wml: {
                    id: 'root'
                },
                id: __1.getId(_this.attrs),
                className: util_1.concat(exports.DROP_DOWN, button_group_1.BUTTON_GROUP_COMPAT, __1.getClassName(_this.attrs))
            },
            button: {
                text: (_this.attrs.ww && _this.attrs.ww.buttonText) ?
                    _this.attrs.ww.buttonText : '',
                anchor: (_this.attrs.ww && _this.attrs.ww.anchor) ?
                    _this.attrs.ww.anchor : false,
                className: util_1.concat(exports.DROP_DOWN_TOGGLE, style.DEFAULT, (_this.attrs.ww && _this.attrs.ww.buttonClassName) ?
                    _this.attrs.ww.buttonClassName : ''),
                disabled: (_this.attrs.ww && _this.attrs.ww.disabled) ?
                    _this.attrs.ww.disabled : undefined,
                template: function () {
                    return (_this.attrs.ww && _this.attrs.ww.buttonTemplate) ?
                        _this.attrs.ww.buttonTemplate : views.button;
                },
                onClick: function () {
                    var mayRoot = util_1.getById(_this.view, _this.values.root.wml.id);
                    if (mayRoot.isJust()) {
                        var e = mayRoot.get();
                        if (_this.values.content.autoClose) {
                            var hide = _this.values.content.hide;
                            //intercept clicks on button and content sections
                            for (var i = 0; i < e.children.length; i++) {
                                //prevent doubling up handlers.
                                e.children[i]
                                    .removeEventListener('click', hide);
                                e.children[i].addEventListener('click', hide);
                            }
                        }
                        _this.toggle();
                        window.addEventListener('click', _this);
                    }
                }
            },
            content: {
                wml: {
                    id: 'content'
                },
                className: util_1.concat(exports.DROP_DOWN_CONTENT, hidden.HIDDEN),
                autoClose: (_this.attrs.ww && _this.attrs.ww.autoClose === false) ?
                    false : true,
                render: function () { return _this.children; },
                hide: function () { return _this.hide(); }
            }
        };
        return _this;
    }
    DropDown.prototype.isHidden = function () {
        return hidden.isHidden(this.view, this.values.content.wml.id);
    };
    DropDown.prototype.hide = function () {
        hidden.hide(this.view, this.values.content.wml.id);
        return this;
    };
    DropDown.prototype.show = function () {
        hidden.show(this.view, this.values.content.wml.id);
        return this;
    };
    DropDown.prototype.toggle = function () {
        hidden.toggle(this.view, this.values.content.wml.id);
        return this;
    };
    DropDown.prototype.handleEvent = function (e) {
        var _this = this;
        util_1.getById(this.view, this.values.root.wml.id)
            .map(function (root) {
            if (!document.body.contains(root))
                document.removeEventListener('click', _this);
            if ((!root.contains(e.target)))
                _this.hide();
        });
    };
    return DropDown;
}(wml_1.Component));
exports.DropDown = DropDown;

},{"../../":104,"../../content/state/hidden":19,"../../content/style":20,"../../util":143,"../button-group":25,"./wml/drop-down":40,"@quenk/wml":153}],40:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = exports.button = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var button_1 = require("../../button");
;
var caret_1 = require("../../../content/caret");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
exports.button = function (d) { return function (__this) {
    return [
        __this.widget(new button_1.Button({ ww: { 'className': d.values.button.className, 'anchor': d.values.button.anchor, 'disabled': d.values.button.disabled, 'onClick': d.values.button.onClick } }, [
            text((d.values.button.text + ' ')),
            __this.widget(new caret_1.Caret({}, []), {})
        ]), { ww: { 'className': d.values.button.className, 'anchor': d.values.button.anchor, 'disabled': d.values.button.disabled, 'onClick': d.values.button.onClick } })
    ];
}; };
;
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.root.wml.id }, 'class': __context.values.root.className }, __spreadArrays((__context.values.button.template()(__context)(__this)), [
                __this.node('div', { wml: { 'id': __context.values.content.wml.id }, 'class': __context.values.content.className }, __spreadArrays((__context.values.content.render())))
            ]));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../content/caret":1,"../../button":29,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],41:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.DropListField = exports.DROP_LIST_FIELD = exports.ItemChangedEvent = void 0;
var util_1 = require("../../util");
var feedback_1 = require("../feedback");
var select_1 = require("../select");
Object.defineProperty(exports, "ItemChangedEvent", { enumerable: true, get: function () { return select_1.ItemChangedEvent; } });
var form_1 = require("../form");
var __1 = require("../../");
var __2 = require("../");
var drop_list_field_1 = require("./wml/drop-list-field");
///classNames:begin
exports.DROP_LIST_FIELD = 'ww-drop-list-field';
/**
 * DropListField
 */
var DropListField = /** @class */ (function (_super) {
    __extends(DropListField, _super);
    function DropListField() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new drop_list_field_1.Main(_this);
        _this.values = {
            root: {
                wml: {
                    id: 'root'
                },
                id: __1.getId(_this.attrs),
                className: util_1.concat(exports.DROP_LIST_FIELD, __1.getClassName(_this.attrs), feedback_1.getValidityClassName(_this.attrs))
            },
            messages: {
                wml: {
                    id: 'message'
                },
                text: feedback_1.getMessage(_this.attrs)
            },
            label: {
                id: __2.getName(_this.attrs),
                text: form_1.getLabel(_this.attrs)
            },
            control: {
                wml: {
                    id: 'control'
                },
                name: __2.getName(_this.attrs),
                className: feedback_1.getValidityClassName(_this.attrs),
                block: true,
                placeholder: (_this.attrs.ww && _this.attrs.ww.placeholder),
                disabled: (_this.attrs.ww && _this.attrs.ww.disabled),
                value: (_this.attrs.ww && _this.attrs.ww.value),
                options: (_this.attrs.ww && _this.attrs.ww.options) ?
                    _this.attrs.ww.options : [],
                stringifier: _this.attrs.ww && _this.attrs.ww.stringifier,
                itemTemplate: (_this.attrs.ww && _this.attrs.ww.itemTemplate) ?
                    _this.attrs.ww.itemTemplate : undefined,
                noItemsTemplate: (_this.attrs.ww && _this.attrs.ww.noItemsTemplate) ?
                    _this.attrs.ww.noItemsTemplate : undefined,
                onSelect: function (e) {
                    if (_this.attrs.ww && _this.attrs.ww.onChange)
                        _this.attrs.ww.onChange(new select_1.ItemChangedEvent(e.name, e.value));
                },
            }
        };
        return _this;
    }
    DropListField.prototype.setMessage = function (msg) {
        getHelp(this).map(function (h) { return h.setMessage(msg); });
        return this;
    };
    DropListField.prototype.removeMessage = function () {
        getHelp(this).map(function (h) { return h.removeMessage(); });
        return this;
    };
    return DropListField;
}(form_1.AbstractFormControl));
exports.DropListField = DropListField;
var getHelp = function (t) {
    return util_1.getById(t.view, t.values.messages.wml.id);
};

},{"../":54,"../../":104,"../../util":143,"../feedback":45,"../form":51,"../select":67,"./wml/drop-list-field":42}],42:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var label_1 = require("../../label");
;
var help_1 = require("../../help");
;
var drop_list_1 = require("../../drop-list");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.root.wml.id }, 'id': __context.values.root.id, 'class': __context.values.root.className }, [
                __this.widget(new label_1.Label({ ww: { 'for': __context.values.root.id, 'text': __context.values.label.text } }, []), { ww: { 'for': __context.values.root.id, 'text': __context.values.label.text } }),
                __this.widget(new drop_list_1.DropList({ ww: { 'className': __context.values.control.className, 'name': __context.values.control.name, 'placeholder': __context.values.control.placeholder, 'disabled': __context.values.control.disabled, 'block': __context.values.control.block, 'value': __context.values.control.value, 'options': __context.values.control.options, 'onSelect': __context.values.control.onSelect, 'noItemsTemplate': __context.values.control.noItemsTemplate, 'itemTemplate': __context.values.control.itemTemplate, 'stringifier': __context.values.control.stringifier } }, []), { ww: { 'className': __context.values.control.className, 'name': __context.values.control.name, 'placeholder': __context.values.control.placeholder, 'disabled': __context.values.control.disabled, 'block': __context.values.control.block, 'value': __context.values.control.value, 'options': __context.values.control.options, 'onSelect': __context.values.control.onSelect, 'noItemsTemplate': __context.values.control.noItemsTemplate, 'itemTemplate': __context.values.control.itemTemplate, 'stringifier': __context.values.control.stringifier } }),
                __this.widget(new help_1.Help({ wml: { 'id': __context.values.messages.wml.id }, ww: { 'text': __context.values.messages.text } }, []), { wml: { 'id': __context.values.messages.wml.id }, ww: { 'text': __context.values.messages.text } })
            ]);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../drop-list":43,"../../help":52,"../../label":57,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],43:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.DropList = exports.DROP_LIST = exports.ItemSelectedEvent = void 0;
var views = require("./wml/drop-list");
var util_1 = require("../../util");
var size_1 = require("../../content/size");
var orientation_1 = require("../../content/orientation");
var results_menu_1 = require("../results-menu");
Object.defineProperty(exports, "ItemSelectedEvent", { enumerable: true, get: function () { return results_menu_1.ItemSelectedEvent; } });
var search_1 = require("../search");
var __1 = require("../../");
var __2 = require("../");
///classNames:begin
exports.DROP_LIST = 'ww-drop-list';
/**
 * DropList provides a control for making a selection from a list of choices.
 */
var DropList = /** @class */ (function (_super) {
    __extends(DropList, _super);
    function DropList() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.DROP_LIST, __1.getClassName(_this.attrs), (_this.attrs.ww && _this.attrs.ww.size) ?
                size_1.getSizeClassName(_this.attrs.ww.size) : '', (_this.attrs.ww && _this.attrs.ww.block) ?
                orientation_1.BLOCK : ''),
            name: __2.getName(_this.attrs),
            value: (_this.attrs.ww && _this.attrs.ww.value),
            control: {
                wml: {
                    id: 'drop-list'
                }
            },
            messages: {
                wml: {
                    id: 'messages'
                }
            },
            display: {
                disabled: (_this.attrs.ww && _this.attrs.ww.disabled),
                placeholder: function () {
                    if (_this.attrs.ww) {
                        if (_this.attrs.ww.options && _this.values.value)
                            return getCurrent(_this.attrs.ww.options, _this.values.value);
                        return _this.attrs.ww.placeholder || 'Select one';
                    }
                },
                onClick: function () {
                    _this.toggle();
                }
            },
            menu: {
                wml: {
                    id: 'menu'
                },
                name: (_this.attrs.ww && _this.attrs.ww.name) ?
                    _this.attrs.ww.name : '',
                block: (_this.attrs.ww && _this.attrs.ww.block) ?
                    _this.attrs.ww.block : false,
                hidden: true,
                results: (_this.attrs.ww && _this.attrs.ww.options) ?
                    _this.attrs.ww.options : [],
                onSelect: function (e) {
                    if (_this.attrs.ww && _this.attrs.ww.onSelect)
                        _this.attrs.ww.onSelect(new results_menu_1.ItemSelectedEvent(e.name, e.value.value));
                    _this.values.value = e.value.value;
                    _this.view.invalidate();
                },
                itemTemplate: (_this.attrs.ww && _this.attrs.ww.itemTemplate) ?
                    _this.attrs.ww.itemTemplate : undefined,
                noItemsTemplate: (_this.attrs.ww && _this.attrs.ww.noItemsTemplate) ?
                    _this.attrs.ww.noItemsTemplate : undefined,
                stringifier: (_this.attrs.ww && _this.attrs.ww.stringifier) ?
                    _this.attrs.ww.stringifier : function (v) { return v.label; }
            }
        };
        return _this;
    }
    /**
     * update changes the options available in the list.
     *
     * The view will be invalidated.
     */
    DropList.prototype.update = function (options) {
        this.values.menu.results = options;
        this.view.invalidate();
        return this;
    };
    /**
     * open the results menu.
     */
    DropList.prototype.open = function () {
        search_1.openMenu(this.view, this.values.menu.wml.id);
        return this;
    };
    /**
     * close the results menu.
     */
    DropList.prototype.close = function () {
        search_1.closeMenu(this.view, this.values.menu.wml.id);
        return this;
    };
    /**
     * toggle the results menu.
     */
    DropList.prototype.toggle = function () {
        search_1.toggleMenu(this.view, this.values.menu.wml.id);
        return this;
    };
    return DropList;
}(__2.AbstractControl));
exports.DropList = DropList;
var getCurrent = function (opts, value, text) {
    if (text === void 0) { text = 'Select one'; }
    return opts.reduce(function (p, c) { return c.value === value ? c.label : p; }, text);
};

},{"../":54,"../../":104,"../../content/orientation":13,"../../content/size":16,"../../util":143,"../results-menu":63,"../search":65,"./wml/drop-list":44}],44:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var caret_1 = require("../../../content/caret");
;
var results_menu_1 = require("../../results-menu");
;
var display_field_1 = require("../../display-field");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.id, 'class': __context.values.className }, [
                __this.widget(new display_field_1.DisplayField({ ww: { 'onClick': __context.values.display.onClick, 'disabled': __context.values.display.disabled } }, [
                    text(__context.values.display.placeholder()),
                    __this.widget(new caret_1.Caret({}, []), {})
                ]), { ww: { 'onClick': __context.values.display.onClick, 'disabled': __context.values.display.disabled } }),
                __this.widget(new results_menu_1.ResultsMenu({ wml: { 'id': __context.values.menu.wml.id }, ww: { 'block': __context.values.menu.block, 'name': __context.values.menu.name, 'hidden': __context.values.menu.hidden, 'results': __context.values.menu.results, 'onSelect': __context.values.menu.onSelect, 'noItemsTemplate': __context.values.menu.noItemsTemplate, 'itemTemplate': __context.values.menu.itemTemplate, 'stringifier': __context.values.menu.stringifier } }, []), { wml: { 'id': __context.values.menu.wml.id }, ww: { 'block': __context.values.menu.block, 'name': __context.values.menu.name, 'hidden': __context.values.menu.hidden, 'results': __context.values.menu.results, 'onSelect': __context.values.menu.onSelect, 'noItemsTemplate': __context.values.menu.noItemsTemplate, 'itemTemplate': __context.values.menu.itemTemplate, 'stringifier': __context.values.menu.stringifier } })
            ]);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../content/caret":1,"../../display-field":37,"../../results-menu":63,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],45:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.validationState2ClassName = exports.getMessage = exports.getValidityClassName = exports.getValidationState = exports.removeValidationState = exports.setValidationState = exports.removeMessage = exports.setMessage = exports.AbstractFeedbackControl = exports.ValidationState = void 0;
var style = require("../content/style");
var util_1 = require("../util");
var control_1 = require("../control");
/**
 * ValidationState
 */
var ValidationState;
(function (ValidationState) {
    ValidationState["Neutral"] = "neutral";
    ValidationState["Error"] = "error";
    ValidationState["Success"] = "success";
    ValidationState["Warning"] = "warning";
})(ValidationState = exports.ValidationState || (exports.ValidationState = {}));
/**
 * AbstractFeedbackControl
 *
 * Provides a default implementaion of the interface methods.
 */
var AbstractFeedbackControl = /** @class */ (function (_super) {
    __extends(AbstractFeedbackControl, _super);
    function AbstractFeedbackControl() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    AbstractFeedbackControl.prototype.setMessage = function (msg) {
        exports.setMessage(this.view, this.values.messages.wml.id, msg);
        return this;
    };
    AbstractFeedbackControl.prototype.removeMessage = function () {
        exports.removeMessage(this.view, this.values.messages.wml.id);
        return this;
    };
    AbstractFeedbackControl.prototype.setValidationState = function (state) {
        exports.setValidationState(this.view, this.values.control.wml.id, state);
        return this;
    };
    AbstractFeedbackControl.prototype.removeValidationState = function () {
        exports.removeValidationState(this.view, this.values.control.wml.id);
        return this;
    };
    AbstractFeedbackControl.prototype.getValidationState = function () {
        return exports.getValidationState(this.view, this.values.control.wml.id);
    };
    return AbstractFeedbackControl;
}(control_1.AbstractControl));
exports.AbstractFeedbackControl = AbstractFeedbackControl;
/**
 * setMessage helper.
 */
exports.setMessage = function (view, id, msg) {
    return util_1.getById(view, id)
        .map(function (messages) {
        var node = document.createTextNode(msg);
        while (messages.lastChild)
            messages.removeChild(messages.lastChild);
        messages.appendChild(node);
    });
};
/**
 * removeMessage
 */
exports.removeMessage = function (view, id) {
    return util_1.getById(view, id)
        .map(function (messages) {
        while (messages.lastChild)
            messages.removeChild(messages.lastChild);
    });
};
/**
 * setValidationState helper.
 */
exports.setValidationState = function (view, id, state) {
    exports.removeValidationState(view, id);
    if (state !== ValidationState.Neutral)
        util_1.getById(view, id)
            .map(function (e) { return e.classList.add(exports.validationState2ClassName(state)); });
};
/**
 * removeValidationState helper.
 */
exports.removeValidationState = function (view, id) {
    util_1.getById(view, id)
        .map(function (h) {
        h.classList.remove(style.SUCCESS);
        h.classList.remove(style.ERROR);
        h.classList.remove(style.WARNING);
    });
};
/**
 * getValidationState calculates the ValidationState of an HTMLElement
 * (identified by id) by analysing its class list.
 */
exports.getValidationState = function (view, id) {
    return util_1.getById(view, id)
        .map(function (h) {
        if (h.classList.contains(style.SUCCESS))
            return ValidationState.Success;
        else if (h.classList.contains(style.WARNING))
            return ValidationState.Warning;
        else if (h.classList.contains(style.ERROR))
            return ValidationState.Error;
        else
            return ValidationState.Neutral;
    })
        .get();
};
/**
 * getValidityClassName provides the applicable style class by checking
 * the validity properties of FeedbackControAttrs.
 */
exports.getValidityClassName = function (attrs) {
    if (attrs.ww) {
        if (attrs.ww.error && (attrs.ww.error != ''))
            return style.ERROR;
        if (attrs.ww.warning && (attrs.ww.warning != ''))
            return style.WARNING;
        if (attrs.ww.success && (attrs.ww.success != ''))
            return style.SUCCESS;
    }
    return '';
};
/**
 * getMessage
 */
exports.getMessage = function (attrs) {
    if (attrs.ww) {
        if (attrs.ww.error && (attrs.ww.error != ''))
            return attrs.ww.error;
        if (attrs.ww.warning && (attrs.ww.warning != ''))
            return attrs.ww.warning;
        if (attrs.ww.success && (attrs.ww.success != ''))
            return attrs.ww.success;
        if (attrs.ww.message && (attrs.ww.message != ''))
            return attrs.ww.message;
    }
    return '';
};
/**
 * validationState2ClassName transforms a ValidationState into
 * the corresponding class name (if any).
 */
exports.validationState2ClassName = function (state) {
    if (state === ValidationState.Success)
        return style.SUCCESS;
    else if (state === ValidationState.Warning)
        return style.WARNING;
    else if (state === ValidationState.Error)
        return style.ERROR;
    else
        return '';
};

},{"../content/style":20,"../control":54,"../util":143}],46:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.list2Array = exports.FileInput = exports.FileChangedEvent = exports.FILE_INPUT = void 0;
var util_1 = require("../../util");
var __1 = require("../../");
var __2 = require("../");
var file_input_1 = require("./wml/file-input");
///classNames:begin
exports.FILE_INPUT = 'ww-file-input';
/**
 * FileChangedEvent is fired when
 */
var FileChangedEvent = /** @class */ (function (_super) {
    __extends(FileChangedEvent, _super);
    function FileChangedEvent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return FileChangedEvent;
}(__2.Event));
exports.FileChangedEvent = FileChangedEvent;
/**
 * FileInput provides a surface for file selection.
 *
 * It supports drag and drop of the files as input.
 */
var FileInput = /** @class */ (function (_super) {
    __extends(FileInput, _super);
    function FileInput() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new file_input_1.FileInputView(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.FILE_INPUT, __1.getClassName(_this.attrs)),
            name: __2.getName(_this.attrs),
            accept: (_this.attrs.ww && _this.attrs.ww.accept) ?
                _this.attrs.ww.accept : '',
            multiple: (_this.attrs.ww && _this.attrs.ww.multiple) ?
                _this.attrs.ww.multiple : undefined,
            change: function (e) {
                var input = e.target;
                if ((input.files != null) &&
                    (input.files.length > 0) &&
                    _this.attrs.ww &&
                    _this.attrs.ww.onChange) {
                    _this.attrs.ww.onChange(new FileChangedEvent(input.name, exports.list2Array(input.files)));
                }
            }
        };
        return _this;
    }
    return FileInput;
}(__2.AbstractControl));
exports.FileInput = FileInput;
/**
 * list2Array converts a FileList into a plain array of files.
 */
exports.list2Array = function (list) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret[i] = list[i];
    return ret;
};

},{"../":54,"../../":104,"../../util":143,"./wml/file-input":47}],47:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FileInputView = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var FileInputView = /** @class */ (function () {
    function FileInputView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('input', { 'id': __context.values.id, 'class': __context.values.className, 'name': __context.values.name, 'type': 'file', 'accept': __context.values.accept, 'onchange': __context.values.change, 'multiple': __context.values.multiple }, []);
        };
    }
    FileInputView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    FileInputView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    FileInputView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    FileInputView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    FileInputView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    FileInputView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    FileInputView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    FileInputView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return FileInputView;
}());
exports.FileInputView = FileInputView;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],48:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.FileUploadSurface = exports.FILE_UPLOAD_SURFACE_TEXT = exports.FILE_UPLOAD_SURFACE_INPUT = exports.FILE_UPLOAD_SURFACE = exports.INSTRUCTION_TEXT = exports.FileChangedEvent = void 0;
var util_1 = require("../../util");
var file_input_1 = require("../file-input");
Object.defineProperty(exports, "FileChangedEvent", { enumerable: true, get: function () { return file_input_1.FileChangedEvent; } });
var __1 = require("../../");
var __2 = require("../");
var file_upload_surface_1 = require("./wml/file-upload-surface");
exports.INSTRUCTION_TEXT = 'Choose a file';
///classNames:begin
exports.FILE_UPLOAD_SURFACE = 'ww-file-upload-surface';
exports.FILE_UPLOAD_SURFACE_INPUT = 'ww-file-upload-surface__input';
exports.FILE_UPLOAD_SURFACE_TEXT = 'ww-file-upload-surface__text';
/**
 * FileUploadSurface provides a surface for file selection.
 *
 * It supports drag and drop of the files as input.
 */
var FileUploadSurface = /** @class */ (function (_super) {
    __extends(FileUploadSurface, _super);
    function FileUploadSurface() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new file_upload_surface_1.FileUploadSurfaceView(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.FILE_UPLOAD_SURFACE, __1.getClassName(_this.attrs)),
            stop: function (e) {
                e.stopPropagation();
                e.preventDefault();
            },
            drop: function (e) {
                e.stopPropagation();
                e.preventDefault();
                var name = (_this.attrs.ww && _this.attrs.ww.name) ?
                    _this.attrs.ww.name : '';
                if (e.dataTransfer && e.dataTransfer.files.length > 0)
                    _this.values.input.onChange(new file_input_1.FileChangedEvent(name, file_input_1.list2Array(e.dataTransfer.files)));
            },
            input: {
                className: exports.FILE_UPLOAD_SURFACE_INPUT,
                name: __2.getName(_this.attrs),
                accept: (_this.attrs.ww && _this.attrs.ww.accept) ?
                    _this.attrs.ww.accept : '',
                multiple: (_this.attrs.ww && _this.attrs.ww.multiple) ?
                    _this.attrs.ww.multiple : undefined,
                onChange: function (e) {
                    _this.values.text.value = e.value[0].name;
                    if (_this.attrs.ww && _this.attrs.ww.onChange)
                        _this.attrs.ww.onChange(e);
                    _this.view.invalidate();
                }
            },
            text: {
                className: exports.FILE_UPLOAD_SURFACE_TEXT,
                value: (_this.attrs.ww && _this.attrs.ww.text) ?
                    _this.attrs.ww.text : exports.INSTRUCTION_TEXT
            }
        };
        return _this;
    }
    return FileUploadSurface;
}(__2.AbstractControl));
exports.FileUploadSurface = FileUploadSurface;

},{"../":54,"../../":104,"../../util":143,"../file-input":46,"./wml/file-upload-surface":49}],49:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FileUploadSurfaceView = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var file_input_1 = require("../../file-input");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var FileUploadSurfaceView = /** @class */ (function () {
    function FileUploadSurfaceView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.id, 'class': __context.values.className, 'ondragenter': __context.values.stop, 'ondragover': __context.values.stop, 'ondrop': __context.values.drop }, [
                __this.widget(new file_input_1.FileInput({ ww: { 'className': __context.values.input.className, 'name': __context.values.input.name, 'accept': __context.values.input.accept, 'multiple': __context.values.input.multiple, 'onChange': __context.values.input.onChange } }, []), { ww: { 'className': __context.values.input.className, 'name': __context.values.input.name, 'accept': __context.values.input.accept, 'multiple': __context.values.input.multiple, 'onChange': __context.values.input.onChange } }),
                __this.node('div', { 'class': __context.values.text.className }, [
                    __this.node('h3', {}, [
                        text(__context.values.text.value)
                    ])
                ])
            ]);
        };
    }
    FileUploadSurfaceView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    FileUploadSurfaceView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    FileUploadSurfaceView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    FileUploadSurfaceView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    FileUploadSurfaceView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    FileUploadSurfaceView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    FileUploadSurfaceView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    FileUploadSurfaceView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return FileUploadSurfaceView;
}());
exports.FileUploadSurfaceView = FileUploadSurfaceView;

},{"../../file-input":46,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],50:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.focus = exports.FocusLostEvent = exports.FocusGainedEvent = void 0;
var util_1 = require("../util");
/**
 * FocusGainedEvent
 */
var FocusGainedEvent = /** @class */ (function () {
    function FocusGainedEvent(name) {
        this.name = name;
    }
    return FocusGainedEvent;
}());
exports.FocusGainedEvent = FocusGainedEvent;
/**
 * FocusLostEvent
 */
var FocusLostEvent = /** @class */ (function () {
    function FocusLostEvent(name) {
        this.name = name;
    }
    return FocusLostEvent;
}());
exports.FocusLostEvent = FocusLostEvent;
/**
 * focus DOM helper.
 */
exports.focus = function (view, id) {
    util_1.getById(view, id)
        .map(function (e) { return e.focus(); });
};

},{"../util":143}],51:[function(require,module,exports){
"use strict";
/**
 * The form module deals with controls specifically for accepting user input.
 */
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.removeMessage = exports.setMessage = exports.getLabel = exports.AbstractFormControl = void 0;
var util_1 = require("../util");
var feedback_1 = require("./feedback");
/**
 * AbstractFormControl provides a base implementation of a
 * FormControl.
 */
var AbstractFormControl = /** @class */ (function (_super) {
    __extends(AbstractFormControl, _super);
    function AbstractFormControl() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return AbstractFormControl;
}(feedback_1.AbstractFeedbackControl));
exports.AbstractFormControl = AbstractFormControl;
/**
 * getLabel extracts the label value from FromControlAttrs.
 */
exports.getLabel = function (attrs) { return (attrs.ww && attrs.ww.label) ? attrs.ww.label : ''; };
/**
 * setMessage helper.
 *
 * Sets the message on the Help widget.
 */
exports.setMessage = function (view, id, msg) {
    util_1.getById(view, id).map(function (h) { h.setMessage(msg); });
};
/**
 * removeMessage helper.
 *
 * Removes the message from the Help widget.
 */
exports.removeMessage = function (view, id) {
    util_1.getById(view, id).map(function (h) { h.removeMessage(); });
};

},{"../util":143,"./feedback":45}],52:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Help = exports.HELP = void 0;
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
var feedback_1 = require("../feedback");
var __1 = require("../../");
var help_1 = require("./wml/help");
///classNames:begin
exports.HELP = 'ww-help';
/**
 * Help
 */
var Help = /** @class */ (function (_super) {
    __extends(Help, _super);
    function Help() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new help_1.Main(_this);
        _this.values = {
            help: {
                wml: {
                    id: 'help'
                },
                id: (_this.attrs.ww && _this.attrs.ww.id) ?
                    _this.attrs.ww.id : '',
                className: util_1.concat(exports.HELP, __1.getClassName(_this.attrs)),
                text: (_this.attrs.ww && _this.attrs.ww.text) ?
                    [document.createTextNode(_this.attrs.ww.text)] : _this.children
            }
        };
        return _this;
    }
    Help.prototype.setMessage = function (msg) {
        feedback_1.setMessage(this.view, this.values.help.wml.id, msg);
        return this;
    };
    Help.prototype.removeMessage = function () {
        feedback_1.removeMessage(this.view, this.values.help.wml.id);
        return this;
    };
    return Help;
}(wml_1.Component));
exports.Help = Help;

},{"../../":104,"../../util":143,"../feedback":45,"./wml/help":53,"@quenk/wml":153}],53:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('span', { wml: { 'id': __context.values.help.wml.id }, 'id': __context.values.help.id, 'class': __context.values.help.className }, __spreadArrays((__context.values.help.text)));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],54:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.getValue = exports.getDisabled = exports.getName = exports.AbstractControl = exports.Event = void 0;
/**
 * This module provides the parent interfaces for most of the
 * widgets considered 'controls'.
 *
 * Controls allow users to manipulate the state of an application
 * by interacting with widgets on screen. In simpler terms,
 * they are the widgets that accept user input or trigger
 * reactions when the user manipulates them.
 *
 * Generally, we use a streaming based workflow, that is
 * as the user preforms a supported action and event is generated
 * each and every time and some handler is applied to the event.
 */
/** @imports */
var wml_1 = require("@quenk/wml");
var maybe_1 = require("@quenk/noni/lib/data/maybe");
/**
 * Event is the parent class of all events generated by controls.
 */
var Event = /** @class */ (function () {
    function Event(name, value) {
        this.name = name;
        this.value = value;
    }
    return Event;
}());
exports.Event = Event;
/**
 * AbstractControl implements the methods of the Control interface.
 */
var AbstractControl = /** @class */ (function (_super) {
    __extends(AbstractControl, _super);
    function AbstractControl() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return AbstractControl;
}(wml_1.Component));
exports.AbstractControl = AbstractControl;
/**
 * getName
 */
exports.getName = function (attrs) {
    return (attrs.ww && attrs.ww.name) ? attrs.ww.name : '';
};
/**
 * getDisabled
 */
exports.getDisabled = function (attrs) {
    return (attrs.ww && attrs.ww.disabled) ? attrs.ww.disabled : undefined;
};
/**
 * getValue
 */
exports.getValue = function (attrs) {
    return (attrs.ww && attrs.ww.value) ? maybe_1.just(attrs.ww.value) : maybe_1.nothing();
};

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml":153}],55:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.AddOn = exports.InputGroup = exports.INPUT_GROUP_BUTTON_ADDON = exports.INPUT_GROUP_ADDON = exports.INPUT_GROUP = void 0;
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
var __1 = require("../../");
var input_group_1 = require("./wml/input-group");
///classNames:begin
exports.INPUT_GROUP = 'ww-input-group';
exports.INPUT_GROUP_ADDON = 'ww-input-group__addon';
exports.INPUT_GROUP_BUTTON_ADDON = 'ww-input-group__button-addon';
/**
 * InputGroup allows an input to be wrapped together with other controls to
 * appear as one.
 *
 * This is useful for creating inputs that may have related fields that should
 * be modified when changed. For example, entering an amount and currency in the
 * same place.
 *
 *  +--------------------------------+
 *  | TTD ^ | 5000.00                |
 *  +--------------------------------+
 */
var InputGroup = /** @class */ (function (_super) {
    __extends(InputGroup, _super);
    function InputGroup() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new input_group_1.InputGroupView(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.INPUT_GROUP, __1.getClassName(_this.attrs)),
        };
        return _this;
    }
    return InputGroup;
}(wml_1.Component));
exports.InputGroup = InputGroup;
/**
 * AddOn is used to attach the extra text or control to the input.
 */
var AddOn = /** @class */ (function (_super) {
    __extends(AddOn, _super);
    function AddOn() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new input_group_1.AddOnView(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(_this.attrs.button ?
                exports.INPUT_GROUP_BUTTON_ADDON :
                exports.INPUT_GROUP_ADDON, __1.getClassName(_this.attrs)),
        };
        return _this;
    }
    return AddOn;
}(wml_1.Component));
exports.AddOn = AddOn;

},{"../../":104,"../../util":143,"./wml/input-group":56,"@quenk/wml":153}],56:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.AddOnView = exports.InputGroupView = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var InputGroupView = /** @class */ (function () {
    function InputGroupView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    InputGroupView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    InputGroupView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    InputGroupView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    InputGroupView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    InputGroupView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    InputGroupView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    InputGroupView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    InputGroupView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return InputGroupView;
}());
exports.InputGroupView = InputGroupView;
;
var AddOnView = /** @class */ (function () {
    function AddOnView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    AddOnView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    AddOnView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    AddOnView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    AddOnView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    AddOnView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    AddOnView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    AddOnView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    AddOnView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return AddOnView;
}());
exports.AddOnView = AddOnView;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],57:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Label = exports.LABEL = void 0;
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
var __1 = require("../../");
var label_1 = require("./wml/label");
///classNames:begin
exports.LABEL = 'ww-label';
/**
 * Label
 */
var Label = /** @class */ (function (_super) {
    __extends(Label, _super);
    function Label() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new label_1.Main(_this);
        _this.values = {
            label: {
                className: util_1.concat(exports.LABEL, __1.getClassName(_this.attrs)),
                for: (_this.attrs.ww && _this.attrs.ww.for) ?
                    _this.attrs.ww.for : '',
                text: (_this.attrs.ww && _this.attrs.ww.text) ?
                    [document.createTextNode(_this.attrs.ww.text)] : _this.children
            }
        };
        return _this;
    }
    return Label;
}(wml_1.Component));
exports.Label = Label;

},{"../../":104,"../../util":143,"./wml/label":58,"@quenk/wml":153}],58:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('label', { 'for': __context.values.label.for, 'class': __context.values.label.className }, __spreadArrays((__context.values.label.text)));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],59:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.MultiSelect = exports.ItemsChangedEvent = exports.DEFAULT_FONT_INCREMENT = exports.DEFAULT_INPUT_WIDTH = exports.MULTI_SELECT_TAG = exports.MULTI_SELECT_INPUT = exports.MULTI_SELECT_CONTENT = exports.MULTI_SELECT = exports.TermChangedEvent = void 0;
var views = require("./wml/multi-select");
var orientation_1 = require("../../content/orientation");
var form_1 = require("../form");
var search_1 = require("../search");
Object.defineProperty(exports, "TermChangedEvent", { enumerable: true, get: function () { return search_1.TermChangedEvent; } });
var util_1 = require("../../util");
var __1 = require("../../");
var __2 = require("../");
var feedback_1 = require("../feedback");
var active_1 = require("../../content/state/active");
var disabled_1 = require("../../content/state/disabled");
///classNames:begin
exports.MULTI_SELECT = 'ww-multi-select';
exports.MULTI_SELECT_CONTENT = 'ww-multi-select__content';
exports.MULTI_SELECT_INPUT = 'ww-multi-select__input';
exports.MULTI_SELECT_TAG = 'ww-multi-select__tag';
///classNames:end
exports.DEFAULT_INPUT_WIDTH = 50;
exports.DEFAULT_FONT_INCREMENT = 7;
/**
 * ItemsChangedEvent
 */
var ItemsChangedEvent = /** @class */ (function (_super) {
    __extends(ItemsChangedEvent, _super);
    function ItemsChangedEvent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return ItemsChangedEvent;
}(__2.Event));
exports.ItemsChangedEvent = ItemsChangedEvent;
/**
 * MultiSelect
 */
var MultiSelect = /** @class */ (function (_super) {
    __extends(MultiSelect, _super);
    function MultiSelect() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: {
                wml: {
                    id: 'root'
                },
                disabled: (_this.attrs.ww && _this.attrs.ww.disabled) ?
                    _this.attrs.ww.disabled : false,
                id: __1.getId(_this.attrs),
                className: util_1.concat(exports.MULTI_SELECT, __1.getClassName(_this.attrs), feedback_1.getValidityClassName(_this.attrs), orientation_1.getBlockClassName(_this.attrs), (_this.attrs.ww && _this.attrs.ww.disabled) ?
                    disabled_1.DISABLED : '')
            },
            control: {
                wml: {
                    id: 'root'
                }
            },
            label: {
                wml: {
                    id: 'label'
                },
                text: form_1.getLabel(_this.attrs)
            },
            search: {
                wml: {
                    id: 'search'
                },
                block: _this.attrs.ww && _this.attrs.ww.block || undefined,
                itemTemplate: (_this.attrs.ww && _this.attrs.ww.itemTemplate) ?
                    _this.attrs.ww.itemTemplate : undefined,
                noItemsTemplate: (_this.attrs.ww && _this.attrs.ww.noItemsTemplate) ?
                    _this.attrs.ww.noItemsTemplate : undefined,
                onSearch: function (evt) {
                    if (_this.attrs.ww && _this.attrs.ww.onSearch)
                        _this.attrs.ww.onSearch(evt);
                },
                onSelect: function (_a) {
                    var value = _a.value;
                    _this.push(value);
                    _this.fireChange();
                    _this.redraw();
                }
            },
            messages: {
                wml: {
                    id: 'message'
                },
                text: feedback_1.getMessage(_this.attrs)
            },
            content: {
                className: exports.MULTI_SELECT_CONTENT,
                onfocus: function () { return _this.focus(); }
            },
            tags: {
                className: util_1.concat(exports.MULTI_SELECT_TAG, feedback_1.getValidityClassName(_this.attrs)),
                value: (_this.attrs.ww && _this.attrs.ww.value) ?
                    _this.attrs.ww.value : [],
                disabled: (_this.attrs.ww && _this.attrs.ww.disabled) ?
                    _this.attrs.ww.disabled : false,
                has: function () { return _this.values.tags.value.length > 0; },
                getText: (_this.attrs.ww && _this.attrs.ww.stringifier) ?
                    _this.attrs.ww.stringifier : function (v) { return String(v); },
                onDismiss: function (e) {
                    var idx = Number(e.name);
                    _this.values.tags.value.splice(idx, 1);
                    _this.fireChange();
                    _this.redraw();
                }
            },
            input: {
                wml: {
                    id: 'input'
                },
                className: exports.MULTI_SELECT_INPUT,
                name: __2.getName(_this.attrs),
                inputWidth: (_this.attrs.ww && _this.attrs.ww.inputWidth) ?
                    _this.attrs.ww.inputWidth : exports.DEFAULT_INPUT_WIDTH,
                fontIncrement: (_this.attrs.ww && _this.attrs.ww.fontIncrement) ?
                    _this.attrs.ww.fontIncrement : exports.DEFAULT_FONT_INCREMENT,
                disabled: (_this.attrs.ww && _this.attrs.ww.disabled) ?
                    _this.attrs.ww.disabled : undefined,
                onSearch: function (e) {
                    if (!_this.values.root.disabled) {
                        _this.grow(e.value.length + 1);
                        if (_this.attrs.ww && _this.attrs.ww.onSearch)
                            _this.attrs.ww.onSearch(e);
                    }
                }
            },
            menu: {
                wml: { id: 'menu' },
                name: __2.getName(_this.attrs),
                block: true,
                onSelect: function (e) {
                    _this.close();
                    _this.values.tags.value.push(e.value);
                    _this.fireChange();
                    _this.redraw();
                },
                itemTemplate: (_this.attrs.ww && _this.attrs.ww.itemTemplate) ?
                    _this.attrs.ww.itemTemplate : undefined,
                noItemsTemplate: (_this.attrs.ww && _this.attrs.ww.noItemsTemplate) ?
                    _this.attrs.ww.noItemsTemplate : undefined,
                stringifier: (_this.attrs.ww && _this.attrs.ww.stringifier) ?
                    _this.attrs.ww.stringifier : undefined
            }
        };
        return _this;
    }
    /**
     * @private
     */
    MultiSelect.prototype.fireChange = function () {
        if (this.attrs.ww && this.attrs.ww.onChange)
            this.attrs.ww.onChange(new ItemsChangedEvent(__2.getName(this.attrs), this.values.tags.value.slice()));
    };
    /**
     * @private
     */
    MultiSelect.prototype.grow = function (n) {
        var mInput = util_1.getById(this.view, this.values.input.wml.id);
        if (mInput.isNothing())
            return;
        var i = mInput.get();
        var mDom = util_1.getById(i.view, i.values.wml.id);
        if (mDom.isNothing())
            return;
        var dom = mDom.get();
        dom.style.width = n * this.values.input.fontIncrement + "px";
    };
    /**
     * @private
     */
    MultiSelect.prototype.redraw = function () {
        this.view.invalidate();
        this.focus();
        return this;
    };
    MultiSelect.prototype.setMessage = function (msg) {
        form_1.setMessage(this.view, this.values.messages.wml.id, msg);
        return this;
    };
    MultiSelect.prototype.removeMessage = function () {
        form_1.removeMessage(this.view, this.values.messages.wml.id);
        return this;
    };
    MultiSelect.prototype.update = function (results) {
        search_1.updateMenu(this.view, this.values.menu.wml.id, results);
        return this;
    };
    MultiSelect.prototype.open = function () {
        search_1.openMenu(this.view, this.values.menu.wml.id);
        return this;
    };
    MultiSelect.prototype.close = function () {
        search_1.closeMenu(this.view, this.values.menu.wml.id);
        return this;
    };
    MultiSelect.prototype.focus = function () {
        getInput(this).map(function (i) { return i.focus(); });
        getRoot(this).map(function (e) { return e.classList.add(active_1.ACTIVE); });
        return this;
    };
    /**
     * push a value onto the end of the internal stack.
     */
    MultiSelect.prototype.push = function (value) {
        this.values.tags.value.push(value);
        this.fireChange();
        return this;
    };
    return MultiSelect;
}(form_1.AbstractFormControl));
exports.MultiSelect = MultiSelect;
var getInput = function (m) {
    return util_1.getById(m.view, m.values.input.wml.id);
};
var getRoot = function (m) {
    return util_1.getById(m.view, m.values.root.wml.id);
};

},{"../":54,"../../":104,"../../content/orientation":13,"../../content/state/active":17,"../../content/state/disabled":18,"../../util":143,"../feedback":45,"../form":51,"../search":65,"./wml/multi-select":60}],60:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var label_1 = require("../../label");
;
var help_1 = require("../../help");
;
var tag_1 = require("../../tag");
;
var search_1 = require("../../search");
;
var results_menu_1 = require("../../results-menu");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.root.id, 'class': __context.values.root.className }, [
                __this.widget(new label_1.Label({ ww: { 'for': __context.values.root.id, 'text': __context.values.label.text } }, []), { ww: { 'for': __context.values.root.id, 'text': __context.values.label.text } }),
                __this.node('div', { 'onclick': __context.values.content.onfocus, 'class': __context.values.content.className }, __spreadArrays(((__context.values.tags.has()) ?
                    (function () { return (__spreadArrays(__forIn(__context.values.tags.value, function (value, idx, _$$all) {
                        return ([
                            __this.widget(new tag_1.Tag({ ww: { 'name': String(idx), 'text': __context.values.tags.getText(value), 'disabled': __context.values.tags.disabled, 'className': __context.values.tags.className, 'onDismiss': __context.values.tags.onDismiss } }, []), { ww: { 'name': String(idx), 'text': __context.values.tags.getText(value), 'disabled': __context.values.tags.disabled, 'className': __context.values.tags.className, 'onDismiss': __context.values.tags.onDismiss } })
                        ]);
                    }, function () { return ([]); }))); })() :
                    (function () { return ([
                        text('')
                    ]); })()), [
                    __this.widget(new search_1.Input({ wml: { 'id': __context.values.input.wml.id }, ww: { 'className': __context.values.input.className, 'name': __context.values.input.name, 'disabled': __context.values.input.disabled, 'onSearch': __context.values.input.onSearch } }, []), { wml: { 'id': __context.values.input.wml.id }, ww: { 'className': __context.values.input.className, 'name': __context.values.input.name, 'disabled': __context.values.input.disabled, 'onSearch': __context.values.input.onSearch } })
                ])),
                __this.widget(new results_menu_1.ResultsMenu({ wml: { 'id': __context.values.menu.wml.id }, ww: { 'block': __context.values.menu.block, 'hidden': true, 'onSelect': __context.values.menu.onSelect, 'noItemsTemplate': __context.values.menu.noItemsTemplate, 'itemTemplate': __context.values.menu.itemTemplate, 'stringifier': __context.values.menu.stringifier } }, []), { wml: { 'id': __context.values.menu.wml.id }, ww: { 'block': __context.values.menu.block, 'hidden': true, 'onSelect': __context.values.menu.onSelect, 'noItemsTemplate': __context.values.menu.noItemsTemplate, 'itemTemplate': __context.values.menu.itemTemplate, 'stringifier': __context.values.menu.stringifier } }),
                __this.widget(new help_1.Help({ wml: { 'id': __context.values.messages.wml.id }, ww: { 'text': __context.values.messages.text } }, []), { wml: { 'id': __context.values.messages.wml.id }, ww: { 'text': __context.values.messages.text } })
            ]);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../help":52,"../../label":57,"../../results-menu":63,"../../search":65,"../../tag":77,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],61:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Paginator = exports.PositionViewContext = exports.PageChangedEvent = exports.PAGINATOR_LAST = exports.PAGINATOR_NEXT = exports.PAGINATOR_POSITION = exports.PAGINATOR_PREVIOUS = exports.PAGINATOR_FIRST = exports.PAGINATOR = void 0;
var wml_1 = require("@quenk/wml");
var timer_1 = require("@quenk/noni/lib/control/timer");
var disabled_1 = require("../../content/state/disabled");
var util_1 = require("../../util");
var __1 = require("../../");
var __2 = require("../");
var paginator_1 = require("./wml/paginator");
///classNames:begin
exports.PAGINATOR = 'ww-paginator';
exports.PAGINATOR_FIRST = 'ww-paginator__first';
exports.PAGINATOR_PREVIOUS = 'ww-paginator__previous';
exports.PAGINATOR_POSITION = 'ww-paginator__position';
exports.PAGINATOR_NEXT = 'ww-paginator__next';
exports.PAGINATOR_LAST = 'ww-paginator__last';
/**
 * PageChangedEvent indicating the current page has been changed.
 */
var PageChangedEvent = /** @class */ (function (_super) {
    __extends(PageChangedEvent, _super);
    function PageChangedEvent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return PageChangedEvent;
}(__2.Event));
exports.PageChangedEvent = PageChangedEvent;
/**
 * PositionViewContext contains the info needed to render the positon part of
 * the paginator.
 */
var PositionViewContext = /** @class */ (function () {
    function PositionViewContext(className, current, total, onChange) {
        this.className = className;
        this.current = current;
        this.total = total;
        this.onChange = onChange;
    }
    return PositionViewContext;
}());
exports.PositionViewContext = PositionViewContext;
/**
 * Paginator provides a control for navigating paged data, results, view etc.
 */
var Paginator = /** @class */ (function (_super) {
    __extends(Paginator, _super);
    function Paginator() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new paginator_1.PaginatorView(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.PAGINATOR, __1.getClassName(_this.attrs)),
            current: {
                value: (_this.attrs.ww && _this.attrs.ww.current) ?
                    _this.attrs.ww.current : 1,
            },
            total: (_this.attrs.ww && _this.attrs.ww.total) ?
                _this.attrs.ww.total : 1,
            first: {
                className: exports.PAGINATOR_FIRST,
                isDisabled: function () { return (_this.values.current.value <= 1); },
                onclick: function (e) {
                    e.preventDefault();
                    _this.values.current.value = 1;
                    _this.fire();
                }
            },
            previous: {
                className: exports.PAGINATOR_PREVIOUS,
                isDisabled: function () { return (_this.values.current.value <= 1); },
                onclick: function (e) {
                    e.preventDefault();
                    _this.values.current.value = _this.values.current.value - 1;
                    _this.fire();
                }
            },
            position: {
                className: exports.PAGINATOR_POSITION,
                view: function () {
                    var ctx = new PositionViewContext(_this.values.position.className, _this.values.current.value, _this.values.total, timer_1.debounce(function (e) {
                        var n = Number(e.value);
                        if ((n > 0) && (n <= _this.values.total)) {
                            _this.values.current.value = n;
                            _this.fire();
                        }
                    }, 5000));
                    return ((_this.attrs.ww && _this.attrs.ww.positionView) ?
                        _this.attrs.ww.positionView(ctx) :
                        new paginator_1.PositionView(ctx)).render();
                }
            },
            next: {
                className: exports.PAGINATOR_NEXT,
                isDisabled: function () { return (_this.values.current.value >= _this.values.total); },
                onclick: function (e) {
                    e.preventDefault();
                    _this.values.current.value = _this.values.current.value + 1;
                    _this.fire();
                }
            },
            last: {
                className: exports.PAGINATOR_LAST,
                isDisabled: function () { return (_this.values.current.value >= _this.values.total); },
                onclick: function (e) {
                    e.preventDefault();
                    _this.values.current.value = _this.values.total;
                    _this.fire();
                }
            },
            disabled: {
                className: disabled_1.DISABLED
            }
        };
        return _this;
    }
    /**
     * @private
     */
    Paginator.prototype.fire = function () {
        if (this.attrs.ww && this.attrs.ww.onChange)
            this.attrs.ww.onChange(new PageChangedEvent(this.attrs.ww.name || '', this.values.current.value));
        this.view.invalidate();
    };
    return Paginator;
}(wml_1.Component));
exports.Paginator = Paginator;

},{"../":54,"../../":104,"../../content/state/disabled":18,"../../util":143,"./wml/paginator":62,"@quenk/noni/lib/control/timer":144,"@quenk/wml":153}],62:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.PaginatorView = exports.PositionView = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var text_input_1 = require("../../text-input");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var PositionView = /** @class */ (function () {
    function PositionView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('li', { 'class': __context.className }, [
                __this.node('span', {}, [
                    __document.createTextNode('Page '),
                    __this.widget(new text_input_1.TextInput({ ww: { 'type': 'number', 'match': '[0-9]', 'value': String(__context.current), 'onChange': __context.onChange } }, []), { ww: { 'type': 'number', 'match': '[0-9]', 'value': String(__context.current), 'onChange': __context.onChange } }),
                    __document.createTextNode(' of '),
                    text(__context.total)
                ])
            ]);
        };
    }
    PositionView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    PositionView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    PositionView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    PositionView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    PositionView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    PositionView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    PositionView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    PositionView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return PositionView;
}());
exports.PositionView = PositionView;
;
var PaginatorView = /** @class */ (function () {
    function PaginatorView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('ul', { 'id': __context.values.id, 'class': __context.values.className }, [
                __this.node('li', { 'class': __context.values.first.className }, __spreadArrays(((__context.values.first.isDisabled()) ?
                    (function () { return ([
                        __this.node('span', { 'class': __context.values.disabled.className }, [])
                    ]); })() :
                    (function () { return ([
                        __this.node('a', { 'href': '#', 'onclick': __context.values.first.onclick }, [])
                    ]); })()))),
                __this.node('li', { 'class': __context.values.previous.className }, __spreadArrays(((__context.values.previous.isDisabled()) ?
                    (function () { return ([
                        __this.node('span', { 'class': __context.values.disabled.className }, [])
                    ]); })() :
                    (function () { return ([
                        __this.node('a', { 'href': '#', 'onclick': __context.values.previous.onclick }, [])
                    ]); })()))),
                __context.values.position.view(),
                __this.node('li', { 'class': __context.values.next.className }, __spreadArrays(((__context.values.next.isDisabled()) ?
                    (function () { return ([
                        __this.node('span', { 'class': __context.values.disabled.className }, [])
                    ]); })() :
                    (function () { return ([
                        __this.node('a', { 'href': '#', 'onclick': __context.values.next.onclick }, [])
                    ]); })()))),
                __this.node('li', { 'class': __context.values.last.className }, __spreadArrays(((__context.values.last.isDisabled()) ?
                    (function () { return ([
                        __this.node('span', { 'class': __context.values.disabled.className }, [])
                    ]); })() :
                    (function () { return ([
                        __this.node('a', { 'href': '#', 'onclick': __context.values.last.onclick }, [])
                    ]); })())))
            ]);
        };
    }
    PaginatorView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    PaginatorView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    PaginatorView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    PaginatorView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    PaginatorView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    PaginatorView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    PaginatorView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    PaginatorView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return PaginatorView;
}());
exports.PaginatorView = PaginatorView;

},{"../../text-input":81,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],63:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.ResultsMenu = exports.ItemSelectedEvent = exports.RESULTS_MENU = void 0;
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var wml_1 = require("@quenk/wml");
var __1 = require("../../");
var util_1 = require("../../util");
var __2 = require("../");
var results_menu_1 = require("./wml/results-menu");
///classNames:begin
exports.RESULTS_MENU = 'ww-results-menu';
/**
 * ItemSelectedEvent
 */
var ItemSelectedEvent = /** @class */ (function (_super) {
    __extends(ItemSelectedEvent, _super);
    function ItemSelectedEvent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return ItemSelectedEvent;
}(__2.Event));
exports.ItemSelectedEvent = ItemSelectedEvent;
/**
 * ResultsMenu used to display results in select styled controls.
 */
var ResultsMenu = /** @class */ (function (_super) {
    __extends(ResultsMenu, _super);
    function ResultsMenu() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new results_menu_1.Main(_this);
        _this.values = {
            wml: {
                id: 'menu'
            },
            tree: maybe_1.nothing(),
            results: (_this.attrs.ww && _this.attrs.ww.results) ?
                _this.attrs.ww.results : [],
            name: (_this.attrs.ww && _this.attrs.ww.name) ?
                _this.attrs.ww.name : '',
            className: util_1.concat(exports.RESULTS_MENU, __1.getClassName(_this.attrs)),
            block: (_this.attrs.ww && _this.attrs.ww.block) ?
                _this.attrs.ww.block : false,
            hidden: (_this.attrs.ww && _this.attrs.ww.hidden) ?
                _this.attrs.ww.hidden : false,
            item: {
                stringifier: (_this.attrs.ww && _this.attrs.ww.stringifier) ?
                    _this.attrs.ww.stringifier : function (v) { return Object.toString.call(v); },
                click: function (index) {
                    if (_this.attrs.ww && _this.attrs.ww.onSelect)
                        _this.attrs.ww.onSelect(new ItemSelectedEvent(_this.attrs.ww && _this.attrs.ww.name || '', _this.values.results[index]));
                },
                template: (_this.attrs.ww && _this.attrs.ww.itemTemplate) ?
                    _this.attrs.ww.itemTemplate :
                    function (option, index) {
                        return results_menu_1.itemTemplate(_this, option, index);
                    },
                noItemsTemplate: function () {
                    return (_this.attrs.ww && _this.attrs.ww.noItemsTemplate) ?
                        _this.attrs.ww.noItemsTemplate : results_menu_1.noItemsTemplate();
                },
            }
        };
        return _this;
    }
    ResultsMenu.prototype.open = function () {
        util_1.getById(this.view, this.values.wml.id)
            .map(function (m) { return m.show(); });
        this.values.hidden = false;
        if (this.attrs.ww && this.attrs.ww.onOpen)
            this.attrs.ww.onOpen();
        return this;
    };
    ResultsMenu.prototype.close = function () {
        util_1.getById(this.view, this.values.wml.id)
            .map(function (m) { return m.hide(); });
        this.values.hidden = true;
        if (this.attrs.ww && this.attrs.ww.onClose)
            this.attrs.ww.onClose();
        return this;
    };
    ResultsMenu.prototype.toggle = function () {
        util_1.getById(this.view, this.values.wml.id)
            .map(function (m) { return m.toggle(); });
        this.values.hidden = !this.values.hidden;
        if (this.values.hidden === true &&
            this.attrs.ww &&
            this.attrs.ww.onClose)
            this.attrs.ww.onClose();
        else if (this.values.hidden === false &&
            this.attrs.ww &&
            this.attrs.ww.onOpen)
            this.attrs.ww.onOpen();
        return this;
    };
    ResultsMenu.prototype.handleEvent = function (e) {
        if (this.values.tree.isJust()) {
            var root = this.values.tree.get();
            if (!document.body.contains(root))
                document.removeEventListener('click', this);
            if ((!root.contains(e.target)))
                this.close();
        }
    };
    /**
     * update will cause the menu to be displayed.
     */
    ResultsMenu.prototype.update = function (results) {
        this.values.results = results;
        this.values.hidden = false;
        this.view.invalidate();
        return this;
    };
    ResultsMenu.prototype.render = function () {
        this.values.tree = maybe_1.just(this.view.render());
        window.removeEventListener('click', this);
        window.addEventListener('click', this);
        return this.values.tree.get();
    };
    return ResultsMenu;
}(wml_1.Component));
exports.ResultsMenu = ResultsMenu;

},{"../":54,"../../":104,"../../util":143,"./wml/results-menu":64,"@quenk/noni/lib/data/maybe":147,"@quenk/wml":153}],64:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = exports.noItemsTemplate = exports.itemTemplate = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var link_1 = require("../../../content/link");
;
var menu_1 = require("../../../menu/menu");
;
var item_1 = require("../../../menu/item");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
exports.itemTemplate = function (r, option, _index) { return function (__this) {
    return [
        text(r.values.item.stringifier(option))
    ];
}; };
;
exports.noItemsTemplate = function () { return function (__this) {
    return [
        __this.node('b', {}, [
            __document.createTextNode('No results to display.')
        ])
    ];
}; };
;
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new menu_1.Menu({ wml: { 'id': __context.values.wml.id }, ww: { 'className': __context.values.className, 'block': __context.values.block, 'hidden': __context.values.hidden } }, __spreadArrays(__forIn(__context.values.results, function (result, index, _$$all) {
                return ([
                    __this.widget(new item_1.Item({ ww: { 'name': ('' + index) } }, [
                        __this.widget(new link_1.Link({ ww: { 'onClick': function () { return __context.values.item.click(index); } } }, __spreadArrays((__context.values.item.template(result, index)(__this)))), { ww: { 'onClick': function () { return __context.values.item.click(index); } } })
                    ]), { ww: { 'name': ('' + index) } })
                ]);
            }, function () { return (__spreadArrays((__context.values.item.noItemsTemplate()(__this)))); }))), { wml: { 'id': __context.values.wml.id }, ww: { 'className': __context.values.className, 'block': __context.values.block, 'hidden': __context.values.hidden } });
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../content/link":7,"../../../menu/item":136,"../../../menu/menu":138,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],65:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.toggleMenu = exports.closeMenu = exports.openMenu = exports.updateMenu = exports.Search = exports.Input = exports.EscapeEvent = exports.FocusLostEvent = exports.FocusGainedEvent = exports.TermChangedEvent = exports.SEARCH_INPUT = exports.SEARCH = exports.ESCAPE = exports.ItemSelectedEvent = void 0;
var views = require("./wml/search");
var timer_1 = require("@quenk/noni/lib/control/timer");
var orientation_1 = require("../../content/orientation");
var util_1 = require("../../util");
var results_menu_1 = require("../results-menu");
Object.defineProperty(exports, "ItemSelectedEvent", { enumerable: true, get: function () { return results_menu_1.ItemSelectedEvent; } });
var __1 = require("../../");
var __2 = require("../");
/**
 * ESCAPE key code.
 */
exports.ESCAPE = 27;
///classNames:begin
exports.SEARCH = 'ww-search';
exports.SEARCH_INPUT = 'ww-search__input';
/**
 * TermChangedEvent signals the search term has changed.
 */
var TermChangedEvent = /** @class */ (function (_super) {
    __extends(TermChangedEvent, _super);
    function TermChangedEvent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return TermChangedEvent;
}(__2.Event));
exports.TermChangedEvent = TermChangedEvent;
/**
 * FocusGainedEvent signals the user as given focus to the control.
 */
var FocusGainedEvent = /** @class */ (function () {
    function FocusGainedEvent(name) {
        this.name = name;
    }
    return FocusGainedEvent;
}());
exports.FocusGainedEvent = FocusGainedEvent;
/**
 * FocusLostEvent signals the user has removed focus from the control.
 */
var FocusLostEvent = /** @class */ (function () {
    function FocusLostEvent(name) {
        this.name = name;
    }
    return FocusLostEvent;
}());
exports.FocusLostEvent = FocusLostEvent;
/**
 * EscapeEvent signals the user has pressed the escape key while typing.
 */
var EscapeEvent = /** @class */ (function () {
    function EscapeEvent(name) {
        this.name = name;
    }
    return EscapeEvent;
}());
exports.EscapeEvent = EscapeEvent;
/**
 * Input provides the input part of a Search control.
 *
 * This is here mostly for code re-use.
 */
var Input = /** @class */ (function (_super) {
    __extends(Input, _super);
    function Input() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.InputView(_this);
        _this.values = {
            wml: { id: 'root' },
            className: util_1.concat(exports.SEARCH_INPUT, __1.getClassName(_this.attrs)),
            placeholder: (_this.attrs.ww && _this.attrs.ww.placeholder) ?
                _this.attrs.ww.placeholder : '',
            readOnly: (_this.attrs.ww && _this.attrs.ww.readOnly) || undefined,
            disabled: (_this.attrs.ww && _this.attrs.ww.disabled) || undefined,
            autocomplete: 'do not enable please',
            autofocus: (_this.attrs.ww && _this.attrs.ww.autofocus) ?
                true : undefined,
            size: String((_this.attrs.ww && _this.attrs.ww.size) ?
                _this.attrs.ww.size : 20),
            value: (_this.attrs.ww && _this.attrs.ww.value) ?
                _this.attrs.ww.value : '',
            onfocus: function (e) {
                var target = e.target;
                if (_this.attrs.ww && _this.attrs.ww.onFocus)
                    _this.attrs.ww.onFocus(new FocusGainedEvent(_this.attrs.ww && _this.attrs.ww.name || ''));
                target.value = target.value;
            },
            onkeyup: function (e) {
                if (e.keyCode === exports.ESCAPE) {
                    if (_this.attrs.ww && _this.attrs.ww.onEscape)
                        _this.attrs.ww.onEscape(new EscapeEvent(_this.attrs.ww.name || ''));
                }
                else {
                    _this.fireSearch(e);
                }
            },
            oninput: function (e) {
                //For compatability reasons
                e.target.oninput = null;
                _this.values.onkeyup(e);
            },
            onblur: function () {
                if (_this.attrs.ww && _this.attrs.ww.onBlur)
                    _this.attrs.ww.onBlur(new FocusLostEvent(_this.attrs.ww && _this.attrs.ww.name || ''));
            }
        };
        return _this;
    }
    Input.prototype.fireSearch = function (e) {
        if (this.attrs.ww && this.attrs.ww.onSearch) {
            var name_1 = '' + this.attrs.ww.name;
            var value = e.target.value;
            this.attrs.ww.onSearch(new TermChangedEvent(name_1, value));
        }
    };
    Input.prototype.rendered = function () {
        if (this.values.autofocus === true)
            this.focus();
    };
    /**
     * focus steals user focus to the Input.
     */
    Input.prototype.focus = function () {
        var _this = this;
        timer_1.tick(function () { return getInput(_this).map(function (i) { return i.focus(); }); });
        return this;
    };
    /**
     * setSize sets the size of the input.
     */
    Input.prototype.setSize = function (n) {
        this.values.size = String(n);
        getInput(this).map(function (i) { return i.setAttribute('size', String(n)); });
        return this;
    };
    /**
     * getSize returns the size of the (internally tracked) size
     * of the Input.
     */
    Input.prototype.getSize = function () {
        return Number(this.values.size);
    };
    return Input;
}(__2.AbstractControl));
exports.Input = Input;
/**
 * Search provides an input that can be used in the ui for a search engine.
 */
var Search = /** @class */ (function (_super) {
    __extends(Search, _super);
    function Search() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: {
                wml: {
                    id: 'root'
                },
                id: __1.getId(_this.attrs),
                className: util_1.concat(exports.SEARCH, __1.getClassName(_this.attrs), orientation_1.getBlockClassName(_this.attrs))
            },
            input: {
                wml: {
                    id: 'input'
                },
                name: __2.getName(_this.attrs),
                placeholder: (_this.attrs.ww && _this.attrs.ww.placeholder) ?
                    _this.attrs.ww.placeholder : '',
                autofocus: (_this.attrs.ww && _this.attrs.ww.autofocus) ?
                    true : undefined,
                readOnly: (_this.attrs.ww && _this.attrs.ww.readOnly) || undefined,
                disabled: (_this.attrs.ww && _this.attrs.ww.disabled) || undefined,
                value: (_this.attrs.ww && _this.attrs.ww.term) ?
                    _this.attrs.ww.term :
                    (_this.attrs.ww &&
                        _this.attrs.ww.stringifier &&
                        _this.attrs.ww.value) ?
                        _this.attrs.ww.stringifier(_this.attrs.ww.value) : '',
                onFocus: _this.attrs.ww && _this.attrs.ww.onFocus || undefined,
                onSearch: (_this.attrs.ww && _this.attrs.ww.onSearch) ?
                    _this.attrs.ww.onSearch : undefined,
                onEscape: function () { return _this.close(); },
                onBlur: (_this.attrs.ww && _this.attrs.ww.onBlur) ?
                    _this.attrs.ww.onBlur : undefined
            },
            menu: {
                wml: {
                    id: 'menu'
                },
                name: (_this.attrs.ww && _this.attrs.ww.name) ?
                    _this.attrs.ww.name : '',
                block: (_this.attrs.ww && _this.attrs.ww.block) ?
                    _this.attrs.ww.block : false,
                onSelect: function (e) {
                    _this.close();
                    if (_this.attrs.ww && _this.attrs.ww.onSelect)
                        _this.attrs.ww.onSelect(e);
                },
                itemTemplate: (_this.attrs.ww && _this.attrs.ww.itemTemplate) ?
                    _this.attrs.ww.itemTemplate : undefined,
                noItemsTemplate: (_this.attrs.ww && _this.attrs.ww.noItemsTemplate) ?
                    _this.attrs.ww.noItemsTemplate : undefined,
                stringifier: (_this.attrs.ww && _this.attrs.ww.stringifier) ?
                    _this.attrs.ww.stringifier : undefined
            }
        };
        return _this;
    }
    Search.prototype.set = function (value) {
        util_1.getById(this.view, this.values.root.wml.id)
            .map(function (e) { e.value = value; });
        return this;
    };
    /**
     * focus gives focus to the input.
     */
    Search.prototype.focus = function () {
        util_1.getById(this.view, this.values.input.wml.id)
            .map(function (i) { return i.focus(); });
        return this;
    };
    /**
     * update the Select with new item options to
     * present to the user.
     */
    Search.prototype.update = function (results) {
        exports.updateMenu(this.view, this.values.menu.wml.id, results);
        return this;
    };
    /**
     * open the results menu.
     */
    Search.prototype.open = function () {
        exports.openMenu(this.view, this.values.menu.wml.id);
        return this;
    };
    /**
     * close the results menu.
     */
    Search.prototype.close = function () {
        exports.closeMenu(this.view, this.values.menu.wml.id);
        return this;
    };
    return Search;
}(__2.AbstractControl));
exports.Search = Search;
var getInput = function (i) {
    return util_1.getById(i.view, i.values.wml.id);
};
/**
 * updateMenu will cause the menu to be displayed with new items.
 */
exports.updateMenu = function (view, id, results) {
    var mMenu = util_1.getById(view, id);
    if (mMenu.isJust())
        mMenu.get().update(results);
};
/**
 * openMenu will cause the menu to be displayed with whatever contents
 * were previously set.
 */
exports.openMenu = function (view, id) {
    util_1.getById(view, id)
        .map(function (m) { return m.open(); });
};
/**
 * closeMenu will cause the menu to no longer be displayed.
 */
exports.closeMenu = function (view, id) {
    util_1.getById(view, id)
        .map(function (m) { return m.close(); });
};
/**
 * toggleMenu
 */
exports.toggleMenu = function (view, id) {
    util_1.getById(view, id)
        .map(function (m) { return m.toggle(); });
};

},{"../":54,"../../":104,"../../content/orientation":13,"../../util":143,"../results-menu":63,"./wml/search":66,"@quenk/noni/lib/control/timer":144}],66:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = exports.InputView = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var results_menu_1 = require("../../results-menu");
;
var __1 = require("../");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var InputView = /** @class */ (function () {
    function InputView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('input', { wml: { 'id': __context.values.wml.id }, 'class': __context.values.className, 'onkeyup': __context.values.onkeyup, 'oninput': __context.values.oninput, 'onfocus': __context.values.onfocus, 'onblur': __context.values.onblur, 'autofocus': __context.values.autofocus, 'autocomplete': __context.values.autocomplete, 'size': __context.values.size, 'placeholder': __context.values.placeholder, 'readOnly': __context.values.readOnly, 'disabled': __context.values.disabled, 'value': __context.values.value }, []);
        };
    }
    InputView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    InputView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    InputView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    InputView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    InputView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    InputView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    InputView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    InputView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return InputView;
}());
exports.InputView = InputView;
;
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.root.wml.id }, 'id': __context.values.root.id, 'class': __context.values.root.className }, [
                __this.widget(new __1.Input({ wml: { 'id': __context.values.input.wml.id }, ww: { 'name': __context.values.input.name, 'autofocus': __context.values.input.autofocus, 'onFocus': __context.values.input.onFocus, 'onSearch': __context.values.input.onSearch, 'onEscape': __context.values.input.onEscape, 'onBlur': __context.values.input.onBlur, 'placeholder': __context.values.input.placeholder, 'readOnly': __context.values.input.readOnly, 'disabled': __context.values.input.disabled, 'value': __context.values.input.value } }, []), { wml: { 'id': __context.values.input.wml.id }, ww: { 'name': __context.values.input.name, 'autofocus': __context.values.input.autofocus, 'onFocus': __context.values.input.onFocus, 'onSearch': __context.values.input.onSearch, 'onEscape': __context.values.input.onEscape, 'onBlur': __context.values.input.onBlur, 'placeholder': __context.values.input.placeholder, 'readOnly': __context.values.input.readOnly, 'disabled': __context.values.input.disabled, 'value': __context.values.input.value } }),
                __this.widget(new results_menu_1.ResultsMenu({ wml: { 'id': __context.values.menu.wml.id }, ww: { 'hidden': true, 'block': __context.values.menu.block, 'onSelect': __context.values.menu.onSelect, 'noItemsTemplate': __context.values.menu.noItemsTemplate, 'itemTemplate': __context.values.menu.itemTemplate, 'stringifier': __context.values.menu.stringifier } }, []), { wml: { 'id': __context.values.menu.wml.id }, ww: { 'hidden': true, 'block': __context.values.menu.block, 'onSelect': __context.values.menu.onSelect, 'noItemsTemplate': __context.values.menu.noItemsTemplate, 'itemTemplate': __context.values.menu.itemTemplate, 'stringifier': __context.values.menu.stringifier } })
            ]);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../":65,"../../results-menu":63,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],67:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.update = exports.close = exports.open = exports.Select = exports.SearchSection = exports.InputSection = exports.LabelSection = exports.MessagesSection = exports.ControlSection = exports.RootSection = exports.ItemUnsetEvent = exports.ItemChangedEvent = exports.SELECT = exports.ItemSelectedEvent = exports.TermChangedEvent = void 0;
var views = require("./wml/select");
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var orientation_1 = require("../../content/orientation");
var util_1 = require("../../util");
var feedback_1 = require("../feedback");
var form_1 = require("../form");
var __1 = require("../../");
var __2 = require("../");
var search_1 = require("../search");
Object.defineProperty(exports, "TermChangedEvent", { enumerable: true, get: function () { return search_1.TermChangedEvent; } });
Object.defineProperty(exports, "ItemSelectedEvent", { enumerable: true, get: function () { return search_1.ItemSelectedEvent; } });
///classNames:begin
exports.SELECT = 'ww-select';
/**
 * ItemChangedEvent
 */
var ItemChangedEvent = /** @class */ (function (_super) {
    __extends(ItemChangedEvent, _super);
    function ItemChangedEvent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return ItemChangedEvent;
}(__2.Event));
exports.ItemChangedEvent = ItemChangedEvent;
/**
 * ItemUnsetEvent
 */
var ItemUnsetEvent = /** @class */ (function (_super) {
    __extends(ItemUnsetEvent, _super);
    function ItemUnsetEvent(name) {
        var _this = _super.call(this, name, undefined) || this;
        _this.name = name;
        return _this;
    }
    return ItemUnsetEvent;
}(__2.Event));
exports.ItemUnsetEvent = ItemUnsetEvent;
/**
 * RootSection
 */
var RootSection = /** @class */ (function () {
    function RootSection(attrs) {
        this.attrs = attrs;
        this.wml = { id: 'root' };
        this.id = __1.getId(this.attrs);
        this.className = util_1.concat(exports.SELECT, __1.getClassName(this.attrs), feedback_1.getValidityClassName(this.attrs), orientation_1.getBlockClassName(this.attrs));
    }
    return RootSection;
}());
exports.RootSection = RootSection;
/**
 * ControlSection
 */
var ControlSection = /** @class */ (function () {
    function ControlSection() {
        this.wml = { id: 'root' };
    }
    return ControlSection;
}());
exports.ControlSection = ControlSection;
/**
 * MessagesSection
 */
var MessagesSection = /** @class */ (function () {
    function MessagesSection(attrs) {
        this.attrs = attrs;
        this.wml = { id: 'message' };
        this.text = feedback_1.getMessage(this.attrs);
    }
    return MessagesSection;
}());
exports.MessagesSection = MessagesSection;
/**
 * LabelSection
 */
var LabelSection = /** @class */ (function () {
    function LabelSection(attrs) {
        this.attrs = attrs;
        this.id = __2.getName(this.attrs);
        this.text = form_1.getLabel(this.attrs);
    }
    return LabelSection;
}());
exports.LabelSection = LabelSection;
/**
 * InputSection
 */
var InputSection = /** @class */ (function () {
    function InputSection(attrs) {
        this.attrs = attrs;
        this.wml = { id: 'input' };
    }
    return InputSection;
}());
exports.InputSection = InputSection;
/**
 * SearchSection
 */
var SearchSection = /** @class */ (function () {
    function SearchSection(attrs, close, onSelect) {
        this.attrs = attrs;
        this.close = close;
        this.onSelect = onSelect;
        this.wml = { id: 'search' };
        this.name = __2.getName(this.attrs);
        this.className = (this.attrs.ww && this.attrs.ww.inputClassName) ?
            this.attrs.ww.inputClassName : '';
        this.placeholder = (this.attrs.ww && this.attrs.ww.placeholder) ?
            this.attrs.ww.placeholder : '';
        this.block = (this.attrs.ww && this.attrs.ww.block) ?
            this.attrs.ww.block : false;
        this.value = (this.attrs.ww && this.attrs.ww.value) ?
            this.attrs.ww.value : undefined;
        this.readOnly = (this.attrs.ww && this.attrs.ww.readOnly);
        this.disabled = (this.attrs.ww && this.attrs.ww.disabled);
        this.itemTemplate = (this.attrs.ww && this.attrs.ww.itemTemplate) ?
            this.attrs.ww.itemTemplate : undefined;
        this.noItemsTemplate = (this.attrs.ww && this.attrs.ww.noItemsTemplate) ?
            this.attrs.ww.noItemsTemplate : undefined;
        this.stringifier = (this.attrs.ww && this.attrs.ww.stringifier) ?
            this.attrs.ww.stringifier : undefined;
        this.onSearch = (this.attrs.ww && this.attrs.ww.onSearch) ?
            this.attrs.ww.onSearch : function () { };
    }
    return SearchSection;
}());
exports.SearchSection = SearchSection;
/**
 * Select provides an control for selecting an item from a
 * list.
 */
var Select = /** @class */ (function (_super) {
    __extends(Select, _super);
    function Select() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: new RootSection(_this.attrs),
            control: new ControlSection(),
            messages: new MessagesSection(_this.attrs),
            label: new LabelSection(_this.attrs),
            input: new InputSection(_this.attrs),
            search: new SearchSection(_this.attrs, function () { return _this.close(); }, function (e) {
                _this.close();
                _this.values.tag.value = maybe_1.just(e.value);
                if (_this.attrs.ww && _this.attrs.ww.onChange)
                    _this.attrs.ww.onChange(new ItemChangedEvent('' + _this.attrs.ww.name, e.value));
                _this.view.invalidate();
            }),
            tag: {
                className: feedback_1.getValidityClassName(_this.attrs),
                value: ((_this.attrs.ww &&
                    (_this.attrs.ww.value != undefined)) ?
                    maybe_1.just(_this.attrs.ww.value) : maybe_1.nothing()),
                disabled: (_this.attrs.ww && _this.attrs.ww.disabled) ?
                    _this.attrs.ww.disabled : false,
                isSet: function () { return _this.values.tag.value.isJust(); },
                getText: function () {
                    if (_this.attrs.ww && _this.attrs.ww.stringifier)
                        return _this.attrs.ww.stringifier(_this.values.tag.value.get());
                    return '';
                },
                dismiss: function () {
                    _this.values.tag.value = maybe_1.nothing();
                    if (_this.attrs.ww && _this.attrs.ww.onUnset)
                        _this.attrs.ww.onUnset(new ItemUnsetEvent(_this.attrs.ww.name + ''));
                    _this.view.invalidate();
                }
            }
        };
        return _this;
    }
    Select.prototype.open = function () {
        exports.open(this.view, this.values.search.wml.id);
        return this;
    };
    Select.prototype.close = function () {
        exports.close(this.view, this.values.search.wml.id);
        return this;
    };
    Select.prototype.setMessage = function (msg) {
        this.values.messages.text = msg;
        form_1.setMessage(this.view, this.values.messages.wml.id, msg);
        return this;
    };
    Select.prototype.removeMessage = function () {
        this.values.messages.text = '';
        form_1.removeMessage(this.view, this.values.messages.wml.id);
        return this;
    };
    /**
     * update the Select with new item options to
     * present to the user.
     */
    Select.prototype.update = function (results) {
        exports.update(this.view, this.values.search.wml.id, results);
        return this;
    };
    return Select;
}(form_1.AbstractFormControl));
exports.Select = Select;
/**
 * open helper.
 *
 * Invokes the open method on the Search widget.
 */
exports.open = function (view, id) {
    util_1.getById(view, id)
        .map(function (m) { return m.open(); });
};
/**
 * close helper.
 *
 * Invokes the close method on the Search widget.
 */
exports.close = function (view, id) {
    util_1.getById(view, id)
        .map(function (m) { return m.close(); });
};
/**
 * update helper.
 *
 * Invokes the update method on the Search widget.
 */
exports.update = function (view, id, results) {
    var mSearch = util_1.getById(view, id);
    if (mSearch.isJust())
        mSearch.get().update(results);
};

},{"../":54,"../../":104,"../../content/orientation":13,"../../util":143,"../feedback":45,"../form":51,"../search":65,"./wml/select":68,"@quenk/noni/lib/data/maybe":147}],68:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var search_1 = require("../../search");
;
var label_1 = require("../../label");
;
var help_1 = require("../../help");
;
var tag_1 = require("../../tag");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.root.id, 'class': __context.values.root.className }, __spreadArrays([
                __this.widget(new label_1.Label({ ww: { 'for': __context.values.root.id, 'text': __context.values.label.text } }, []), { ww: { 'for': __context.values.root.id, 'text': __context.values.label.text } })
            ], ((__context.values.tag.isSet()) ?
                (function () { return ([
                    __this.widget(new tag_1.Tag({ ww: { 'text': __context.values.tag.getText(), 'className': __context.values.tag.className, 'disabled': __context.values.tag.disabled, 'onDismiss': __context.values.tag.dismiss } }, []), { ww: { 'text': __context.values.tag.getText(), 'className': __context.values.tag.className, 'disabled': __context.values.tag.disabled, 'onDismiss': __context.values.tag.dismiss } })
                ]); })() :
                (function () { return ([
                    __this.widget(new search_1.Search({ wml: { 'id': __context.values.search.wml.id }, ww: { 'name': __context.values.search.name, 'className': __context.values.search.className, 'block': __context.values.search.block, 'placeholder': __context.values.search.placeholder, 'readOnly': __context.values.search.readOnly, 'disabled': __context.values.search.disabled, 'itemTemplate': __context.values.search.itemTemplate, 'noItemsTemplate': __context.values.search.noItemsTemplate, 'stringifier': __context.values.search.stringifier, 'onSearch': __context.values.search.onSearch, 'onSelect': __context.values.search.onSelect } }, []), { wml: { 'id': __context.values.search.wml.id }, ww: { 'name': __context.values.search.name, 'className': __context.values.search.className, 'block': __context.values.search.block, 'placeholder': __context.values.search.placeholder, 'readOnly': __context.values.search.readOnly, 'disabled': __context.values.search.disabled, 'itemTemplate': __context.values.search.itemTemplate, 'noItemsTemplate': __context.values.search.noItemsTemplate, 'stringifier': __context.values.search.stringifier, 'onSearch': __context.values.search.onSearch, 'onSelect': __context.values.search.onSelect } })
                ]); })()), [
                __this.widget(new help_1.Help({ wml: { 'id': __context.values.messages.wml.id }, ww: { 'text': __context.values.messages.text } }, []), { wml: { 'id': __context.values.messages.wml.id }, ww: { 'text': __context.values.messages.text } })
            ]));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../help":52,"../../label":57,"../../search":65,"../../tag":77,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],69:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.StackSelect = exports.ItemsChangedEvent = exports.STACK_SELECT = exports.TermChangedEvent = void 0;
var views = require("./wml/stack-select");
var orientation_1 = require("../../content/orientation");
var form_1 = require("../form");
var search_1 = require("../search");
Object.defineProperty(exports, "TermChangedEvent", { enumerable: true, get: function () { return search_1.TermChangedEvent; } });
var select_1 = require("../select");
var util_1 = require("../../util");
var __1 = require("../../");
var __2 = require("../");
var feedback_1 = require("../feedback");
///classNames:begin
exports.STACK_SELECT = 'ww-stack-select';
/**
 * ItemsChangedEvent
 */
var ItemsChangedEvent = /** @class */ (function (_super) {
    __extends(ItemsChangedEvent, _super);
    function ItemsChangedEvent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return ItemsChangedEvent;
}(__2.Event));
exports.ItemsChangedEvent = ItemsChangedEvent;
/**
 * StackSelect provides a control for allowing a user to select
 * multiple items from a list.
 *
 * It use a stack to display the selected items.
 *
 *     +=========================+
 *     |  <select>               |
 *     +=========================+
 *     +-------------------------+
 *     |   <item>              x |
 *     +-------------------------+
 *     +-------------------------+
 *     |   <item>              x |
 *     +-------------------------+
 *     +-------------------------+
 *     |   <item>              x |
 *     +-------------------------+
 */
var StackSelect = /** @class */ (function (_super) {
    __extends(StackSelect, _super);
    function StackSelect() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: {
                wml: {
                    id: 'root'
                },
                id: __1.getId(_this.attrs),
                className: util_1.concat(exports.STACK_SELECT, __1.getClassName(_this.attrs), feedback_1.getValidityClassName(_this.attrs), (_this.attrs.ww && _this.attrs.ww.block) ? orientation_1.BLOCK : ''),
                dir: (_this.attrs.ww && _this.attrs.ww.dir) ?
                    _this.attrs.ww.dir : 1
            },
            control: {
                wml: {
                    id: 'root'
                }
            },
            label: {
                wml: {
                    id: 'label'
                },
                text: form_1.getLabel(_this.attrs)
            },
            search: {
                wml: {
                    id: 'search'
                },
                name: (_this.attrs.ww && _this.attrs.ww.name) ?
                    _this.attrs.ww.name : '',
                value: undefined,
                block: true,
                disabled: (_this.attrs.ww && _this.attrs.ww.disabled) ?
                    _this.attrs.ww.disabled : false,
                placeholder: (_this.attrs.ww && _this.attrs.ww.placeholder) || '',
                onSearch: function (evt) {
                    if (_this.attrs.ww && _this.attrs.ww.onSearch)
                        _this.attrs.ww.onSearch(evt);
                },
                onSelect: function (_a) {
                    var value = _a.value;
                    return _this.push(value);
                }
            },
            messages: {
                wml: {
                    id: 'message'
                },
                text: feedback_1.getMessage(_this.attrs)
            },
            stack: {
                wml: {
                    id: 'stack'
                },
                name: __2.getName(_this.attrs),
                disabled: (_this.attrs.ww && _this.attrs.ww.disabled) ?
                    _this.attrs.ww.disabled : false,
                value: (_this.attrs.ww && _this.attrs.ww.value) ?
                    _this.attrs.ww.value : [],
                decorator: (_this.attrs.ww && _this.attrs.ww.stringifier) ?
                    _this.attrs.ww.stringifier : function (v) { return String(v); },
                onChange: function (e) {
                    if (_this.attrs.ww && _this.attrs.ww.onChange)
                        _this.attrs.ww.onChange(e);
                }
            }
        };
        return _this;
    }
    StackSelect.prototype.setMessage = function (msg) {
        form_1.setMessage(this.view, this.values.messages.wml.id, msg);
        return this;
    };
    StackSelect.prototype.removeMessage = function () {
        form_1.removeMessage(this.view, this.values.messages.wml.id);
        return this;
    };
    /**
     * update the list of available options displayed to the user.
     */
    StackSelect.prototype.update = function (list) {
        select_1.update(this.view, this.values.search.wml.id, list);
        return this;
    };
    /**
     * push a value onto the stack.
     */
    StackSelect.prototype.push = function (v) {
        this
            .view
            .findById(this.values.stack.wml.id)
            .map(function (s) { return s.push(v); });
        return this;
    };
    return StackSelect;
}(form_1.AbstractFormControl));
exports.StackSelect = StackSelect;

},{"../":54,"../../":104,"../../content/orientation":13,"../../util":143,"../feedback":45,"../form":51,"../search":65,"../select":67,"./wml/stack-select":70}],70:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var search_1 = require("../../search");
;
var stack_1 = require("../../stack");
;
var label_1 = require("../../label");
;
var help_1 = require("../../help");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.root.id, 'class': __context.values.root.className }, __spreadArrays((((__context.values.root.dir === -1)) ?
                (function () { return ([
                    __this.widget(new label_1.Label({ ww: { 'for': __context.values.root.id, 'text': __context.values.label.text } }, []), { ww: { 'for': __context.values.root.id, 'text': __context.values.label.text } }),
                    __this.widget(new search_1.Search({ wml: { 'id': __context.values.search.wml.id }, ww: { 'name': __context.values.search.name, 'value': __context.values.search.value, 'block': __context.values.search.block, 'disabled': __context.values.search.disabled, 'stringifier': __context.values.stack.decorator, 'placeholder': __context.values.search.placeholder, 'onSearch': __context.values.search.onSearch, 'onSelect': __context.values.search.onSelect } }, []), { wml: { 'id': __context.values.search.wml.id }, ww: { 'name': __context.values.search.name, 'value': __context.values.search.value, 'block': __context.values.search.block, 'disabled': __context.values.search.disabled, 'stringifier': __context.values.stack.decorator, 'placeholder': __context.values.search.placeholder, 'onSearch': __context.values.search.onSearch, 'onSelect': __context.values.search.onSelect } }),
                    __this.widget(new stack_1.Stack({ wml: { 'id': __context.values.stack.wml.id }, ww: { 'name': __context.values.stack.name, 'value': __context.values.stack.value, 'disabled': __context.values.stack.disabled, 'decorator': __context.values.stack.decorator, 'onChange': __context.values.stack.onChange } }, []), { wml: { 'id': __context.values.stack.wml.id }, ww: { 'name': __context.values.stack.name, 'value': __context.values.stack.value, 'disabled': __context.values.stack.disabled, 'decorator': __context.values.stack.decorator, 'onChange': __context.values.stack.onChange } }),
                    __this.widget(new help_1.Help({ wml: { 'id': __context.values.messages.wml.id }, ww: { 'text': __context.values.messages.text } }, []), { wml: { 'id': __context.values.messages.wml.id }, ww: { 'text': __context.values.messages.text } })
                ]); })() :
                (function () { return ([
                    __this.widget(new label_1.Label({ ww: { 'for': __context.values.root.id, 'text': __context.values.label.text } }, []), { ww: { 'for': __context.values.root.id, 'text': __context.values.label.text } }),
                    __this.widget(new stack_1.Stack({ wml: { 'id': __context.values.stack.wml.id }, ww: { 'name': __context.values.stack.name, 'value': __context.values.stack.value, 'decorator': __context.values.stack.decorator, 'onChange': __context.values.stack.onChange } }, []), { wml: { 'id': __context.values.stack.wml.id }, ww: { 'name': __context.values.stack.name, 'value': __context.values.stack.value, 'decorator': __context.values.stack.decorator, 'onChange': __context.values.stack.onChange } }),
                    __this.widget(new search_1.Search({ wml: { 'id': __context.values.search.wml.id }, ww: { 'name': __context.values.search.name, 'value': __context.values.search.value, 'block': __context.values.search.block, 'stringifier': __context.values.stack.decorator, 'onSearch': __context.values.search.onSearch, 'onSelect': __context.values.search.onSelect } }, []), { wml: { 'id': __context.values.search.wml.id }, ww: { 'name': __context.values.search.name, 'value': __context.values.search.value, 'block': __context.values.search.block, 'stringifier': __context.values.stack.decorator, 'onSearch': __context.values.search.onSearch, 'onSelect': __context.values.search.onSelect } }),
                    __this.widget(new help_1.Help({ wml: { 'id': __context.values.messages.wml.id }, ww: { 'text': __context.values.messages.text } }, []), { wml: { 'id': __context.values.messages.wml.id }, ww: { 'text': __context.values.messages.text } })
                ]); })())));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../help":52,"../../label":57,"../../search":65,"../../stack":71,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],71:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Stack = exports.StackChangedEvent = exports.STACK_CLOSE_BUTTON = exports.STACK_ELEMENT_CONTENT = exports.STACK_ELEMENT = exports.STACK = void 0;
var views = require("./wml/stack");
var dom_1 = require("@quenk/wml/lib/dom");
var util_1 = require("../../util");
var __1 = require("../../");
var __2 = require("../");
///classNames:begin
exports.STACK = 'ww-stack';
exports.STACK_ELEMENT = 'ww-stack__element';
exports.STACK_ELEMENT_CONTENT = 'ww-stack__element__content';
exports.STACK_CLOSE_BUTTON = 'ww-stack__button';
/**
 * StackChangedEvent is generated when the user removes an item from the stack.
 */
var StackChangedEvent = /** @class */ (function (_super) {
    __extends(StackChangedEvent, _super);
    function StackChangedEvent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return StackChangedEvent;
}(__2.Event));
exports.StackChangedEvent = StackChangedEvent;
/**
 * Stack displays a list of items that can be modified
 * by releasing one or more at a time.
 */
var Stack = /** @class */ (function (_super) {
    __extends(Stack, _super);
    function Stack() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: {
                id: __1.getId(_this.attrs),
                className: util_1.concat(exports.STACK, __1.getClassName(_this.attrs)),
                disabled: (_this.attrs.ww && _this.attrs.ww.disabled) ?
                    _this.attrs.ww.disabled : false,
                value: (_this.attrs.ww && _this.attrs.ww.value) ?
                    _this.attrs.ww.value : [],
                fire: function () {
                    if (!_this.values.root.disabled) {
                        if (_this.attrs.ww && _this.attrs.ww.onChange)
                            _this.attrs.ww.onChange(new StackChangedEvent(_this.attrs.ww.name, _this.values.root.value.slice()));
                        _this.view.invalidate();
                    }
                }
            },
            element: {
                className: exports.STACK_ELEMENT,
                template: function (v, idx) {
                    return (_this.attrs.ww && _this.attrs.ww.elementTemplate) ?
                        _this.attrs.ww.elementTemplate(_this)(v)(idx)(_this.view) :
                        views.content(_this, v, idx)(_this.view);
                },
                content: {
                    className: exports.STACK_ELEMENT_CONTENT
                },
                close: function (index) { return function () {
                    _this.values.root.value.splice(Number(index), 1);
                    _this.values.root.fire();
                }; },
                decorator: function (v) {
                    return dom_1.text((_this.attrs.ww && _this.attrs.ww.decorator) ?
                        _this.attrs.ww.decorator(v) : v + '');
                }
            },
            close: {
                className: exports.STACK_CLOSE_BUTTON
            }
        };
        return _this;
    }
    /**
     * push a new member onto the stack.
     */
    Stack.prototype.push = function (value) {
        this.values.root.value.push(value);
        this.values.root.fire();
        return this;
    };
    return Stack;
}(__2.AbstractControl));
exports.Stack = Stack;

},{"../":54,"../../":104,"../../util":143,"./wml/stack":72,"@quenk/wml/lib/dom":152}],72:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = exports.content = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
exports.content = function (s, v, _) { return function (__this) {
    return [
        __this.node('div', { 'class': s.values.element.content.className }, [
            s.values.element.decorator(v)
        ])
    ];
}; };
;
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('ul', { 'id': __context.values.root.id, 'class': __context.values.root.className }, __spreadArrays(__forIn(__context.values.root.value, function (v, index, _$$all) {
                return ([
                    __this.node('li', { 'class': __context.values.element.className }, __spreadArrays((__context.values.element.template(v, index)), (((__context.values.root.disabled === false)) ?
                        (function () { return ([
                            __this.node('button', { 'class': __context.values.close.className, 'onclick': __context.values.element.close(index) }, [
                                __document.createTextNode('Ã—')
                            ])
                        ]); })() :
                        (function () { return ([]); })())))
                ]);
            }, function () { return ([]); })));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],73:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Switch = exports.SwitchChangedEvent = exports.SWITCH_SLIDER = exports.SWITCH = void 0;
var util_1 = require("../../util");
var __1 = require("../../");
var __2 = require("../");
var switch_1 = require("./wml/switch");
///classNames:begin
exports.SWITCH = 'ww-switch';
exports.SWITCH_SLIDER = 'ww-switch__slider';
/**
 * SwitchChangedEvent signals the user has changed the switch.
 */
var SwitchChangedEvent = /** @class */ (function (_super) {
    __extends(SwitchChangedEvent, _super);
    function SwitchChangedEvent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return SwitchChangedEvent;
}(__2.Event));
exports.SwitchChangedEvent = SwitchChangedEvent;
/**
 * Switch allows the user to select between one or two values.
 */
var Switch = /** @class */ (function (_super) {
    __extends(Switch, _super);
    function Switch() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new switch_1.Main(_this);
        _this.values = {
            root: {
                id: __1.getId(_this.attrs),
                className: util_1.concat(exports.SWITCH, __1.getClassName(_this.attrs))
            },
            slider: {
                className: exports.SWITCH_SLIDER
            },
            input: {
                name: __2.getName(_this.attrs),
                value: (_this.attrs.ww && _this.attrs.ww.value) ?
                    _this.attrs.ww.value : false,
                checked: function () { return _this.values.input.value ? true : undefined; },
                disabled: __2.getDisabled(_this.attrs),
                onChange: function () {
                    _this.values.input.value = (!_this.values.input.value);
                    if ((_this.attrs.ww && _this.attrs.ww.onChange))
                        _this.attrs.ww.onChange(new SwitchChangedEvent(_this.values.input.name, _this.values.input.value));
                }
            }
        };
        return _this;
    }
    return Switch;
}(__2.AbstractControl));
exports.Switch = Switch;

},{"../":54,"../../":104,"../../util":143,"./wml/switch":74}],74:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('label', { 'id': __context.values.root.id, 'class': __context.values.root.className }, [
                __this.node('input', { 'type': 'checkbox', 'name': __context.values.input.name, 'checked': __context.values.input.checked(), 'disabled': __context.values.input.disabled, 'onchange': __context.values.input.onChange }, []),
                __this.node('div', { 'class': __context.values.slider.className }, [])
            ]);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],75:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.TabBar = exports.Tab = exports.TabClickedEvent = exports.TAB_BAR = exports.TAB = void 0;
var views = require("./wml/tab-bar");
var dom_1 = require("@quenk/wml/lib/dom");
var wml_1 = require("@quenk/wml");
var active_1 = require("../../content/state/active");
var orientation_1 = require("../../content/orientation");
var util_1 = require("../../util");
var __1 = require("../../");
var __2 = require("../");
///classNames:begin
/**
 * TAB
 */
exports.TAB = 'ww-tab';
/**
 * TAB_BAR
 */
exports.TAB_BAR = 'ww-tab-bar';
/**
 * TabClickedEvent is fired when a user clicks on a tab.
 *
 * It contains information about the tab that was clicked.
 */
var TabClickedEvent = /** @class */ (function (_super) {
    __extends(TabClickedEvent, _super);
    function TabClickedEvent(name) {
        var _this = _super.call(this, name, name) || this;
        _this.name = name;
        return _this;
    }
    return TabClickedEvent;
}(__2.Event));
exports.TabClickedEvent = TabClickedEvent;
/**
 * Tab provides a single tab item.
 *
 * When a tab is clicked, it attempts to remove the active class from
 * it's siblings and apply it to itself. Therefore the sibling of a
 * tab should always be a Tab.
 */
var Tab = /** @class */ (function (_super) {
    __extends(Tab, _super);
    function Tab() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Tab(_this);
        _this.values = {
            root: {
                wml: {
                    id: 'root'
                },
                id: __1.getId(_this.attrs),
                className: util_1.concat(exports.TAB, __1.getClassName(_this.attrs), (_this.attrs.ww && _this.attrs.ww.active) ? active_1.ACTIVE : ''),
            },
            a: {
                wml: {
                    id: 'link'
                },
                content: (_this.attrs.ww && _this.attrs.ww.text) ?
                    [dom_1.text(_this.attrs.ww.text)] : _this.children,
                clicked: function (e) {
                    e.preventDefault();
                    var maybeRoot = util_1.getById(_this.view, _this.values.root.wml.id);
                    if (maybeRoot.isNothing())
                        return;
                    var root = maybeRoot.get();
                    var parent = root.parentNode;
                    var sibs = parent.children;
                    for (var i = 0; i < sibs.length; i++)
                        sibs[i].classList.remove(active_1.ACTIVE);
                    root.classList.add(active_1.ACTIVE);
                    if (_this.attrs.ww && _this.attrs.ww.onClick)
                        _this.attrs.ww.onClick(new TabClickedEvent("" + _this.attrs.ww.name));
                }
            }
        };
        return _this;
    }
    /**
     * click this Tab
     */
    Tab.prototype.click = function () {
        util_1.getById(this.view, this.values.root.wml.id)
            .map(function (e) { return e.click(); });
        return this;
    };
    return Tab;
}(__2.AbstractControl));
exports.Tab = Tab;
/**
 * TabBar acts as a parent container for a group of Tab.
 *
 * Use it to create a tabbed navigation or view for main layout,
 * sub views or forms etc.
 */
var TabBar = /** @class */ (function (_super) {
    __extends(TabBar, _super);
    function TabBar() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.TabBar(_this);
        _this.values = {
            root: {
                id: __1.getId(_this.attrs),
                className: util_1.concat(exports.TAB_BAR, __1.getClassName(_this.attrs), (_this.attrs.ww && _this.attrs.ww.justify) ? orientation_1.JUSTIFIED : '')
            }
        };
        return _this;
    }
    return TabBar;
}(wml_1.Component));
exports.TabBar = TabBar;

},{"../":54,"../../":104,"../../content/orientation":13,"../../content/state/active":17,"../../util":143,"./wml/tab-bar":76,"@quenk/wml":153,"@quenk/wml/lib/dom":152}],76:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Tab = exports.TabBar = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var TabBar = /** @class */ (function () {
    function TabBar(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('ul', { 'id': __context.values.root.id, 'class': __context.values.root.className }, __spreadArrays((__context.children)));
        };
    }
    TabBar.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    TabBar.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    TabBar.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    TabBar.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    TabBar.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    TabBar.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    TabBar.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    TabBar.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return TabBar;
}());
exports.TabBar = TabBar;
;
var Tab = /** @class */ (function () {
    function Tab(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('li', { wml: { 'id': __context.values.root.wml.id }, 'id': __context.values.root.id, 'class': __context.values.root.className }, [
                __this.node('a', { wml: { 'id': __context.values.a.wml.id }, 'href': '#', 'onclick': __context.values.a.clicked }, __spreadArrays((__context.values.a.content)))
            ]);
        };
    }
    Tab.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Tab.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Tab.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Tab.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Tab.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Tab.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Tab.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Tab.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Tab;
}());
exports.Tab = Tab;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],77:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Tag = exports.DismissEvent = exports.TAG_CONTROL_DISMISS = exports.TAG_CONTROL_TEXT = exports.TAG_CONTROL = void 0;
var style_1 = require("../../content/style");
var util_1 = require("../../util");
var __1 = require("../../");
var __2 = require("../");
var tag_1 = require("./wml/tag");
///classNames:begin
exports.TAG_CONTROL = 'ww-tag-control';
exports.TAG_CONTROL_TEXT = 'ww-tag-control__text';
exports.TAG_CONTROL_DISMISS = 'ww-tag-control__dismiss';
/**
 * DismissEvent is generated when the close button us clicked.
 */
var DismissEvent = /** @class */ (function (_super) {
    __extends(DismissEvent, _super);
    function DismissEvent(name) {
        var _this = _super.call(this, name, undefined) || this;
        _this.name = name;
        return _this;
    }
    return DismissEvent;
}(__2.Event));
exports.DismissEvent = DismissEvent;
/**
 * Tag displays some text in a dismissable tag.
 *
 * The difference between this Tag and the one from the content
 * module is that this one is primarily meant to be used as a control
 * or as part of a more complicated control.
 */
var Tag = /** @class */ (function (_super) {
    __extends(Tag, _super);
    function Tag() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new tag_1.Main(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.TAG_CONTROL, __1.getClassName(_this.attrs)),
            style: (_this.attrs.ww && _this.attrs.ww.style) ?
                _this.attrs.ww.style : style_1.Style.Default,
            disabled: (_this.attrs.ww && _this.attrs.ww.disabled) ?
                _this.attrs.ww.disabled : false,
            text: {
                className: exports.TAG_CONTROL_TEXT,
                value: (_this.attrs.ww && _this.attrs.ww.text) ?
                    _this.attrs.ww.text : undefined,
            },
            dismiss: {
                className: exports.TAG_CONTROL_DISMISS,
                onClick: function () {
                    if (_this.attrs.ww && _this.attrs.ww.onDismiss)
                        _this.attrs.ww.onDismiss(new DismissEvent(_this.attrs.ww && _this.attrs.ww.name || ''));
                }
            }
        };
        return _this;
    }
    return Tag;
}(__2.AbstractControl));
exports.Tag = Tag;

},{"../":54,"../../":104,"../../content/style":20,"../../util":143,"./wml/tag":78}],78:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var t = require("../../../content/tag");
;
var close_1 = require("../../../content/close");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new t.Tag({ ww: { 'id': __context.values.id, 'className': __context.values.className, 'style': __context.values.style } }, __spreadArrays((((__context.values.text.value !== '')) ?
                (function () { return ([
                    __this.node('span', { 'class': __context.values.text.className }, [
                        text(__context.values.text.value)
                    ])
                ]); })() :
                (function () { return ([
                    text('')
                ]); })()), (__context.children), (((__context.values.disabled !== true)) ?
                (function () { return ([
                    __this.widget(new close_1.Close({ ww: { 'className': __context.values.dismiss.className, 'onClick': __context.values.dismiss.onClick } }, []), { ww: { 'className': __context.values.dismiss.className, 'onClick': __context.values.dismiss.onClick } })
                ]); })() :
                (function () { return ([]); })()))), { ww: { 'id': __context.values.id, 'className': __context.values.className, 'style': __context.values.style } });
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../content/close":3,"../../../content/tag":21,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],79:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.TextField = exports.TEXT_FIELD = exports.TextChangedEvent = void 0;
var views = require("./wml/text-field");
var util_1 = require("../../util");
var feedback_1 = require("../feedback");
var form_1 = require("../form");
var text_input_1 = require("../text-input");
Object.defineProperty(exports, "TextChangedEvent", { enumerable: true, get: function () { return text_input_1.TextChangedEvent; } });
var __1 = require("../../");
var __2 = require("../");
///classNames:begin
exports.TEXT_FIELD = 'ww-text-field';
/**
 * TextField provides a wrapped native text input control.
 */
var TextField = /** @class */ (function (_super) {
    __extends(TextField, _super);
    function TextField() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: {
                wml: {
                    id: 'root'
                },
                className: util_1.concat(exports.TEXT_FIELD, __1.getClassName(_this.attrs), feedback_1.getValidityClassName(_this.attrs))
            },
            messages: {
                wml: {
                    id: 'message'
                },
                text: feedback_1.getMessage(_this.attrs)
            },
            label: {
                id: __2.getName(_this.attrs),
                text: form_1.getLabel(_this.attrs)
            },
            control: {
                wml: {
                    id: 'root'
                },
                id: __1.getId(_this.attrs),
                name: __2.getName(_this.attrs),
                type: (_this.attrs.ww && _this.attrs.ww.type) ?
                    _this.attrs.ww.type : 'text',
                min: (_this.attrs.ww && _this.attrs.ww.min) ?
                    _this.attrs.ww.min : undefined,
                max: (_this.attrs.ww && _this.attrs.ww.max) ?
                    _this.attrs.ww.max : undefined,
                focus: (_this.attrs.ww && _this.attrs.ww.focus) ?
                    _this.attrs.ww.focus : undefined,
                placeholder: (_this.attrs.ww && _this.attrs.ww.placeholder) ?
                    _this.attrs.ww.placeholder : '',
                match: (_this.attrs.ww && _this.attrs.ww.match) ?
                    _this.attrs.ww.match : undefined,
                length: (_this.attrs.ww && _this.attrs.ww.length) ?
                    _this.attrs.ww.length : undefined,
                value: (_this.attrs.ww && _this.attrs.ww.value) ?
                    _this.attrs.ww.value : '',
                disabled: (_this.attrs.ww && _this.attrs.ww.disabled) ? true : undefined,
                readOnly: (_this.attrs.ww && _this.attrs.ww.readOnly) ?
                    true : undefined,
                rows: (_this.attrs.ww && _this.attrs.ww.rows) ?
                    _this.attrs.ww.rows : 1,
                oninput: (_this.attrs.ww && _this.attrs.ww.onChange) ?
                    oninput(_this) : function () { },
                onChange: (_this.attrs.ww && _this.attrs.ww.onChange) ?
                    _this.attrs.ww.onChange : function () { }
            }
        };
        return _this;
    }
    TextField.prototype.setMessage = function (msg) {
        getHelp(this).map(function (h) { return h.setMessage(msg); });
        return this;
    };
    TextField.prototype.removeMessage = function () {
        getHelp(this).map(function (h) { return h.removeMessage(); });
        return this;
    };
    return TextField;
}(form_1.AbstractFormControl));
exports.TextField = TextField;
var getHelp = function (t) {
    return util_1.getById(t.view, t.values.messages.wml.id);
};
var oninput = function (f) { return function (e) {
    if (f.attrs.ww && f.attrs.ww && f.attrs.ww.onChange)
        f.attrs.ww.onChange(new text_input_1.TextChangedEvent((f.attrs.ww && f.attrs.ww.name) ?
            f.attrs.ww.name : '', e.target.value));
}; };

},{"../":54,"../../":104,"../../util":143,"../feedback":45,"../form":51,"../text-input":81,"./wml/text-field":80}],80:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var label_1 = require("../../label");
;
var help_1 = require("../../help");
;
var text_input_1 = require("../../text-input");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.root.wml.id }, 'class': __context.values.root.className }, [
                __this.widget(new label_1.Label({ ww: { 'for': __context.values.control.id, 'text': __context.values.label.text } }, []), { ww: { 'for': __context.values.control.id, 'text': __context.values.label.text } }),
                __this.widget(new text_input_1.TextInput({ ww: { 'id': __context.values.control.id, 'name': __context.values.control.name, 'focus': __context.values.control.focus, 'placeholder': __context.values.control.placeholder, 'onChange': __context.values.control.onChange, 'block': true, 'type': __context.values.control.type, 'min': __context.values.control.min, 'max': __context.values.control.max, 'match': __context.values.control.match, 'length': __context.values.control.length, 'value': __context.values.control.value, 'rows': __context.values.control.rows, 'disabled': __context.values.control.disabled, 'readOnly': __context.values.control.readOnly } }, []), { ww: { 'id': __context.values.control.id, 'name': __context.values.control.name, 'focus': __context.values.control.focus, 'placeholder': __context.values.control.placeholder, 'onChange': __context.values.control.onChange, 'block': true, 'type': __context.values.control.type, 'min': __context.values.control.min, 'max': __context.values.control.max, 'match': __context.values.control.match, 'length': __context.values.control.length, 'value': __context.values.control.value, 'rows': __context.values.control.rows, 'disabled': __context.values.control.disabled, 'readOnly': __context.values.control.readOnly } }),
                __this.widget(new help_1.Help({ wml: { 'id': __context.values.messages.wml.id }, ww: { 'text': __context.values.messages.text } }, []), { wml: { 'id': __context.values.messages.wml.id }, ww: { 'text': __context.values.messages.text } })
            ]);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../help":52,"../../label":57,"../../text-input":81,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],81:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.TextInput = exports.TextChangedEvent = exports.TEXT_INPUT = void 0;
var views = require("./wml/text-input");
var timer_1 = require("@quenk/noni/lib/control/timer");
var util_1 = require("../../util");
var orientation_1 = require("../../content/orientation");
var size_1 = require("../../content/size");
var focus_1 = require("../focus");
var __1 = require("../../");
var __2 = require("../");
///classNames:begin
exports.TEXT_INPUT = 'ww-text-input';
/**
 * TextChangedEvent
 */
var TextChangedEvent = /** @class */ (function (_super) {
    __extends(TextChangedEvent, _super);
    function TextChangedEvent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return TextChangedEvent;
}(__2.Event));
exports.TextChangedEvent = TextChangedEvent;
/**
 * TextInput provides some extra styling to the native input.
 */
var TextInput = /** @class */ (function (_super) {
    __extends(TextInput, _super);
    function TextInput() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = (_this.attrs.ww && _this.attrs.ww.rows && _this.attrs.ww.rows > 1) ?
            new views.Textarea(_this) : new views.Input(_this);
        _this.values = {
            control: {
                wml: {
                    id: 'root'
                }
            },
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.TEXT_INPUT, __1.getClassName(_this.attrs), (_this.attrs.ww && _this.attrs.ww.size) ?
                size_1.getSizeClassName(_this.attrs.ww.size) : '', (_this.attrs.ww && _this.attrs.ww.block) ?
                orientation_1.BLOCK : ''),
            name: __2.getName(_this.attrs),
            type: (_this.attrs.ww && _this.attrs.ww.type) ?
                _this.attrs.ww.type : 'text',
            min: (_this.attrs.ww && _this.attrs.ww.min) ?
                String(_this.attrs.ww.min) : null,
            max: (_this.attrs.ww && _this.attrs.ww.max) ?
                String(_this.attrs.ww.max) : null,
            match: new RegExp((_this.attrs.ww && _this.attrs.ww.match) ?
                _this.attrs.ww.match : '.'),
            length: (_this.attrs.ww && _this.attrs.ww.length) ?
                _this.attrs.ww.length : Infinity,
            placeholder: (_this.attrs.ww && _this.attrs.ww.placeholder) ?
                _this.attrs.ww.placeholder : '',
            value: (_this.attrs.ww && _this.attrs.ww.value) ?
                _this.attrs.ww.value : '',
            rows: String((_this.attrs.ww && _this.attrs.ww.rows) ?
                _this.attrs.ww.rows : 1),
            disabled: (_this.attrs.ww && _this.attrs.ww.disabled === true) ?
                true : null,
            readOnly: (_this.attrs.ww && _this.attrs.ww.readOnly === true) ?
                true : null,
            onkeydown: function (e) {
                if (e.key.length === 1) {
                    var value = e.target.value || '';
                    if ((!_this.values.match.test(e.key)) ||
                        (value.length > _this.values.length))
                        e.preventDefault();
                }
            },
            oninput: dispatchInput(_this),
            autofocus: (_this.attrs.ww && _this.attrs.ww.focus) ? true : undefined,
            onfocus: function () {
                if (_this.attrs.ww && _this.attrs.ww.onFocusGained)
                    _this.attrs.ww.onFocusGained(new focus_1.FocusGainedEvent(__2.getName(_this.attrs)));
            },
            onblur: function () {
                if (_this.attrs.ww && _this.attrs.ww.onFocusLost)
                    _this.attrs.ww.onFocusLost(new focus_1.FocusLostEvent(__2.getName(_this.attrs)));
            }
        };
        return _this;
    }
    TextInput.prototype.rendered = function () {
        if (this.values.autofocus === true)
            this.focus();
    };
    TextInput.prototype.focus = function () {
        var _this = this;
        return timer_1.tick(function () { return focus_1.focus(_this.view, _this.values.control.wml.id); });
    };
    return TextInput;
}(__2.AbstractControl));
exports.TextInput = TextInput;
/**
 * dispatchInput when the user inputs some text.
 */
var dispatchInput = function (i) { return function (e) {
    if (i.attrs.ww && i.attrs.ww.onChange)
        i.attrs.ww.onChange(new TextChangedEvent((i.attrs && i.attrs.ww.name) ?
            i.attrs.ww.name : '', e.target.value));
}; };

},{"../":54,"../../":104,"../../content/orientation":13,"../../content/size":16,"../../util":143,"../focus":50,"./wml/text-input":82,"@quenk/noni/lib/control/timer":144}],82:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Input = exports.Textarea = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Textarea = /** @class */ (function () {
    function Textarea(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('textarea', { wml: { 'id': __context.values.control.wml.id }, 'id': __context.values.id, 'name': __context.values.name, 'placeholder': __context.values.placeholder, 'oninput': __context.values.oninput, 'value': __context.values.value, 'disabled': __context.values.disabled, 'readonly': __context.values.readOnly, 'rows': __context.values.rows, 'class': __context.values.className }, [
                document.createTextNode(__context.values.value)
            ]);
        };
    }
    Textarea.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Textarea.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Textarea.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Textarea.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Textarea.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Textarea.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Textarea.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Textarea.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Textarea;
}());
exports.Textarea = Textarea;
;
var Input = /** @class */ (function () {
    function Input(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('input', { wml: { 'id': __context.values.control.wml.id }, 'id': __context.values.id, 'name': __context.values.name, 'type': __context.values.type, 'min': __context.values.min, 'max': __context.values.max, 'placeholder': __context.values.placeholder, 'oninput': __context.values.oninput, 'onkeydown': __context.values.onkeydown, 'autofocus': __context.values.autofocus, 'value': __context.values.value, 'disabled': __context.values.disabled, 'readonly': __context.values.readOnly, 'class': __context.values.className }, []);
        };
    }
    Input.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Input.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Input.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Input.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Input.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Input.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Input.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Input.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Input;
}());
exports.Input = Input;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],83:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Toolbar = exports.TOOLBAR_COMPAT = exports.TOOLBAR = void 0;
var views = require("./wml/toolbar");
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
var __1 = require("../../");
///classNames:begin
exports.TOOLBAR = 'ww-toolbar';
exports.TOOLBAR_COMPAT = '-toolbar-compat';
/**
 * Toolbar provides a widget for grouping related controls into a
 * single row.
 */
var Toolbar = /** @class */ (function (_super) {
    __extends(Toolbar, _super);
    function Toolbar() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: {
                id: __1.getId(_this.attrs),
                className: util_1.concat(exports.TOOLBAR, __1.getClassName(_this.attrs))
            }
        };
        return _this;
    }
    return Toolbar;
}(wml_1.Component));
exports.Toolbar = Toolbar;

},{"../../":104,"../../util":143,"./wml/toolbar":84,"@quenk/wml":153}],84:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.root.id, 'class': __context.values.root.className }, __spreadArrays((__context.children)));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],85:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Typeahead = exports.TYPEAHEAD = exports.ItemSelectedEvent = exports.TextChangedEvent = exports.TermChangedEvent = void 0;
var views = require("./wml/typeahead");
var util_1 = require("../../util");
var form_1 = require("../form");
var search_1 = require("../search");
Object.defineProperty(exports, "TermChangedEvent", { enumerable: true, get: function () { return search_1.TermChangedEvent; } });
var text_field_1 = require("../text-field");
Object.defineProperty(exports, "TextChangedEvent", { enumerable: true, get: function () { return text_field_1.TextChangedEvent; } });
var select_1 = require("../select");
Object.defineProperty(exports, "ItemSelectedEvent", { enumerable: true, get: function () { return select_1.ItemSelectedEvent; } });
///classNames:begin
exports.TYPEAHEAD = 'ww-typeahead';
/**
 * Typeahead provides an text input field that can suggests values
 * as the user types.
 */
var Typeahead = /** @class */ (function (_super) {
    __extends(Typeahead, _super);
    function Typeahead() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: new select_1.RootSection(_this.attrs),
            control: new select_1.ControlSection(),
            messages: new select_1.MessagesSection(_this.attrs),
            label: new select_1.LabelSection(_this.attrs),
            search: new select_1.SearchSection(_this.attrs, function () { return _this.close(); }, function (e) {
                _this.close();
                var mSearch = util_1.getById(_this.view, _this.values.search.wml.id);
                if (mSearch.isJust()) {
                    var s = mSearch.get();
                    var str = (_this.values.search.stringifier) ?
                        _this.values.search.stringifier(e.value) : e.value + '';
                    s.set(str);
                    if (_this.attrs.ww && _this.attrs.ww.onChange)
                        _this.attrs.ww.onChange(new text_field_1.TextChangedEvent('' + _this.attrs.ww.name, str));
                }
            })
        };
        return _this;
    }
    Typeahead.prototype.open = function () {
        select_1.open(this.view, this.values.search.wml.id);
        return this;
    };
    Typeahead.prototype.close = function () {
        select_1.close(this.view, this.values.search.wml.id);
        return this;
    };
    Typeahead.prototype.setMessage = function (msg) {
        this.values.messages.text = msg;
        form_1.setMessage(this.view, this.values.messages.wml.id, msg);
        return this;
    };
    Typeahead.prototype.removeMessage = function () {
        this.values.messages.text = '';
        form_1.removeMessage(this.view, this.values.messages.wml.id);
        return this;
    };
    Typeahead.prototype.update = function (results) {
        select_1.update(this.view, this.values.search.wml.id, results);
        return this;
    };
    return Typeahead;
}(form_1.AbstractFormControl));
exports.Typeahead = Typeahead;

},{"../../util":143,"../form":51,"../search":65,"../select":67,"../text-field":79,"./wml/typeahead":86}],86:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var search_1 = require("../../search");
;
var label_1 = require("../../label");
;
var help_1 = require("../../help");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.root.id, 'class': __context.values.root.className }, [
                __this.widget(new label_1.Label({ ww: { 'for': __context.values.root.id, 'text': __context.values.label.text } }, []), { ww: { 'for': __context.values.root.id, 'text': __context.values.label.text } }),
                __this.widget(new search_1.Search({ wml: { 'id': __context.values.search.wml.id }, ww: { 'name': __context.values.search.name, 'className': __context.values.search.className, 'block': __context.values.search.block, 'disabled': __context.values.search.disabled, 'placeholder': __context.values.search.placeholder, 'readOnly': __context.values.search.readOnly, 'itemTemplate': __context.values.search.itemTemplate, 'noItemsTemplate': __context.values.search.noItemsTemplate, 'stringifier': __context.values.search.stringifier, 'onSearch': __context.values.search.onSearch, 'onSelect': __context.values.search.onSelect } }, []), { wml: { 'id': __context.values.search.wml.id }, ww: { 'name': __context.values.search.name, 'className': __context.values.search.className, 'block': __context.values.search.block, 'disabled': __context.values.search.disabled, 'placeholder': __context.values.search.placeholder, 'readOnly': __context.values.search.readOnly, 'itemTemplate': __context.values.search.itemTemplate, 'noItemsTemplate': __context.values.search.noItemsTemplate, 'stringifier': __context.values.search.stringifier, 'onSearch': __context.values.search.onSearch, 'onSelect': __context.values.search.onSelect } }),
                __this.widget(new help_1.Help({ wml: { 'id': __context.values.messages.wml.id }, ww: { 'text': __context.values.messages.text } }, []), { wml: { 'id': __context.values.messages.wml.id }, ww: { 'text': __context.values.messages.text } })
            ]);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../help":52,"../../label":57,"../../search":65,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],87:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.PropertyList = exports.DataCtx = exports.PROPERTY_LIST = void 0;
var wml_1 = require("@quenk/wml");
var path_1 = require("@quenk/noni/lib/data/record/path");
var util_1 = require("../../util");
var __1 = require("../../");
var property_list_1 = require("./wml/property-list");
///classNames:begin
exports.PROPERTY_LIST = 'ww-property-list';
/**
 * DataCtx
 */
var DataCtx = /** @class */ (function () {
    function DataCtx(data, name, value, format) {
        this.data = data;
        this.name = name;
        this.value = value;
        this.format = format;
    }
    return DataCtx;
}());
exports.DataCtx = DataCtx;
/**
 * PropertyList generates a description list using the properties of
 * an object.
 */
var PropertyList = /** @class */ (function (_super) {
    __extends(PropertyList, _super);
    function PropertyList() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new property_list_1.PropertyListView(_this);
        _this.values = {
            root: {
                className: util_1.concat(exports.PROPERTY_LIST, __1.getClassName(_this.attrs))
            },
            fields: ((_this.attrs.ww && _this.attrs.ww.fields) ?
                _this.attrs.ww.fields : []),
            data: {
                value: ((_this.attrs.ww && _this.attrs.ww.data) ?
                    _this.attrs.ww.data : {}),
                get: function (f) {
                    var mData = path_1.get(f.name, _this.values.data.value);
                    if (mData.isNothing())
                        return new property_list_1.NothingView({}).render();
                    var d = mData.get();
                    var fmt = (f.format) ? f.format : function (c) { return '' + c; };
                    var ctx = new DataCtx(d, f.name, _this.values.data.value, fmt);
                    if (f.dataFragment)
                        return f.dataFragment(ctx).render();
                    else
                        return new property_list_1.DataView(ctx).render();
                }
            }
        };
        return _this;
    }
    /**
     * setData to be displayed.
     */
    PropertyList.prototype.setData = function (data) {
        this.values.data.value = data;
        this.view.invalidate();
        return this;
    };
    return PropertyList;
}(wml_1.Component));
exports.PropertyList = PropertyList;

},{"../../":104,"../../util":143,"./wml/property-list":88,"@quenk/noni/lib/data/record/path":149,"@quenk/wml":153}],88:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.PropertyListView = exports.DataView = exports.NothingView = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
;
var description_list_1 = require("../../../layout/description-list");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var NothingView = /** @class */ (function () {
    function NothingView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new description_list_1.Data({}, []), {});
        };
    }
    NothingView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    NothingView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    NothingView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    NothingView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    NothingView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    NothingView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    NothingView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    NothingView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return NothingView;
}());
exports.NothingView = NothingView;
;
var DataView = /** @class */ (function () {
    function DataView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new description_list_1.Data({}, [
                text(__context.format(__context.data))
            ]), {});
        };
    }
    DataView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    DataView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    DataView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    DataView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    DataView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    DataView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    DataView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    DataView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return DataView;
}());
exports.DataView = DataView;
;
var PropertyListView = /** @class */ (function () {
    function PropertyListView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new description_list_1.DescriptionList({ ww: { 'className': __context.values.root.className } }, __spreadArrays(__forIn(__context.values.fields, function (field, _$$i, _$$all) {
                return ([
                    __this.widget(new description_list_1.Title({}, [
                        text(field.heading)
                    ]), {}),
                    __context.values.data.get(field)
                ]);
            }, function () { return ([]); }))), { ww: { 'className': __context.values.root.className } });
        };
    }
    PropertyListView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    PropertyListView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    PropertyListView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    PropertyListView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    PropertyListView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    PropertyListView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    PropertyListView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    PropertyListView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return PropertyListView;
}());
exports.PropertyListView = PropertyListView;

},{"../../../layout/description-list":109,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],89:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.sortById = exports.SortRequest = void 0;
var path_1 = require("@quenk/noni/lib/data/record/path");
var sort_1 = require("@quenk/noni/lib/data/array/sort");
/**
 * SortRequest contains the info needed to preform a sort.
 */
var SortRequest = /** @class */ (function () {
    function SortRequest(column, data, key) {
        this.column = column;
        this.data = data;
        this.key = key;
    }
    return SortRequest;
}());
exports.SortRequest = SortRequest;
/**
 * sortById sorts a dataset by a column using the columns id.
 *
 * Data is only sorted by one column at a time.
 */
exports.sortById = function (cols, key, data, id) {
    var spec = cols[id];
    var current = data[0], original = data[1];
    if (spec === undefined)
        return [current, key];
    if (!spec.sort)
        return [current, key];
    if (key[0] === id) {
        return [current.reverse(), [key[0], key[1] * -1]];
    }
    else {
        var strategy = getSortStrategy(spec.sort);
        var alias = spec.alias ? spec.alias : spec.name;
        return [doSort(original.slice(), strategy, alias), [id, -1]];
    }
};
var getSortStrategy = function (s) {
    if (typeof s === 'function')
        return s;
    if (s === 'date')
        return sort_1.date;
    if (s === 'number')
        return sort_1.number;
    if (s === 'string')
        return sort_1.string;
    return sort_1.natural;
};
var doSort = function (data, s, alias) {
    return data.sort(function (a, b) { return s(getAny(alias, a), getAny(alias, b)); });
};
var getAny = function (path, src) {
    return path_1.getDefault(path, src, undefined);
};

},{"@quenk/noni/lib/data/array/sort":146,"@quenk/noni/lib/data/record/path":149}],90:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DataChangedEvent = exports.CellClickedEvent = exports.HeadingClickedEvent = void 0;
/**
 * HeadingClickedEvent is triggered when the user clicks on
 * one of the column headings.
 */
var HeadingClickedEvent = /** @class */ (function () {
    function HeadingClickedEvent(column) {
        this.column = column;
    }
    return HeadingClickedEvent;
}());
exports.HeadingClickedEvent = HeadingClickedEvent;
/**
 * CellClickedEvent triggered when a cell is clicked on.
 */
var CellClickedEvent = /** @class */ (function () {
    function CellClickedEvent(column, row) {
        this.column = column;
        this.row = row;
    }
    return CellClickedEvent;
}());
exports.CellClickedEvent = CellClickedEvent;
/**
 * DataChangedEvent generated when the internal representation of the data
 * changes.
 */
var DataChangedEvent = /** @class */ (function () {
    function DataChangedEvent(name, data, key) {
        this.name = name;
        this.data = data;
        this.key = key;
    }
    return DataChangedEvent;
}());
exports.DataChangedEvent = DataChangedEvent;

},{}],91:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.DataTable = exports.NewCellContext = exports.NewBodyContext = exports.NewHeadingContext = exports.NewHeadContext = exports.DESC = exports.ASC = exports.DATA_TABLE_CELL = exports.DATA_TABLE_BODY = exports.DATA_TABLE_HEADING = exports.DATA_TABLE_HEAD = exports.DATA_TABLE = exports.HeadingClickedEvent = exports.CellClickedEvent = exports.DataChangedEvent = exports.SortRequest = void 0;
var views = require("./wml/table");
var wml_1 = require("@quenk/wml");
var array_1 = require("@quenk/noni/lib/data/array");
var path_1 = require("@quenk/noni/lib/data/record/path");
var util_1 = require("../../util");
var __1 = require("../../");
var sort_1 = require("./column/sort");
Object.defineProperty(exports, "SortRequest", { enumerable: true, get: function () { return sort_1.SortRequest; } });
var event_1 = require("./event");
Object.defineProperty(exports, "DataChangedEvent", { enumerable: true, get: function () { return event_1.DataChangedEvent; } });
Object.defineProperty(exports, "CellClickedEvent", { enumerable: true, get: function () { return event_1.CellClickedEvent; } });
Object.defineProperty(exports, "HeadingClickedEvent", { enumerable: true, get: function () { return event_1.HeadingClickedEvent; } });
var range_1 = require("./range");
///classNames:begin
exports.DATA_TABLE = 'ww-data-table';
exports.DATA_TABLE_HEAD = 'ww-data-table__head';
exports.DATA_TABLE_HEADING = 'ww-data-table__heading';
exports.DATA_TABLE_BODY = 'ww-data-table__body';
exports.DATA_TABLE_CELL = 'ww-data-table__cell';
exports.ASC = '-asc';
exports.DESC = '-desc';
/**
 * NewHeadContext
 */
var NewHeadContext = /** @class */ (function () {
    function NewHeadContext(table) {
        var _this = this;
        this.table = table;
        this.className = util_1.concat(exports.DATA_TABLE_HEAD, (this.table.attrs.ww && this.table.attrs.ww.headClassName || ''));
        this.columns = this.table.values.columns;
        this.data = this.table.values.dataset[0];
        this.heading = function (c, i) {
            return getHeadingView(_this.table, new NewHeadingContext(_this.table, _this, c, i), c).render();
        };
    }
    return NewHeadContext;
}());
exports.NewHeadContext = NewHeadContext;
/**
 * NewHeadingContext
 */
var NewHeadingContext = /** @class */ (function () {
    function NewHeadingContext(table, headContext, column, index) {
        var _this = this;
        this.table = table;
        this.headContext = headContext;
        this.column = column;
        this.index = index;
        this.className = util_1.concat(exports.DATA_TABLE_HEADING, (this.table.attrs.ww && this.table.attrs.ww.headingClassName || ''), this.column.headingClassName, getSortClassName(this.table.values.sortKey, this.index));
        this.onclick = function (_) {
            if (_this.column.sort)
                _this.table.values.sort(_this.index);
            if (_this.column.onHeadingClicked)
                _this.column.onHeadingClicked(new event_1.HeadingClickedEvent(_this.index));
            if (_this.table.attrs.ww && _this.table.attrs.ww.onHeadingClicked)
                _this.table.attrs.ww.onHeadingClicked(new event_1.HeadingClickedEvent(_this.index));
        };
    }
    return NewHeadingContext;
}());
exports.NewHeadingContext = NewHeadingContext;
/**
 * NewBodyContext
 */
var NewBodyContext = /** @class */ (function () {
    function NewBodyContext(table) {
        var _this = this;
        this.table = table;
        this.className = util_1.concat(exports.DATA_TABLE_BODY, (this.table.attrs.ww && this.table.attrs.ww.bodyClassName || ''));
        this.columns = this.table.values.columns;
        this.data = this.table.values.dataset[0];
        this.cell = function (c, id, row) {
            return getCellView(_this.table, new NewCellContext(_this.table, _this, c, id, row), c).render();
        };
    }
    return NewBodyContext;
}());
exports.NewBodyContext = NewBodyContext;
/**
 * NewCellContext
 */
var NewCellContext = /** @class */ (function () {
    function NewCellContext(table, bodyContext, spec, column, row) {
        var _this = this;
        this.table = table;
        this.bodyContext = bodyContext;
        this.spec = spec;
        this.column = column;
        this.row = row;
        this.id = cellId(this.column, this.row);
        this.className = util_1.concat(exports.DATA_TABLE_CELL, (this.table.attrs.ww && this.table.attrs.ww.cellClassName || ''), this.spec.cellClassName, getSortClassName(this.table.values.sortKey, this.column));
        this.value = path_1.unsafeGet(this.spec.name, this.table.values.dataset[0][this.row]);
        this.datum = this.table.values.dataset[0][this.row];
        this.format = this.spec.format ?
            this.spec.format :
            function (c) { return String(c == null ? '' : c); };
        this.onclick = function () {
            if (_this.spec.onCellClicked)
                _this.spec.onCellClicked(new event_1.CellClickedEvent(_this.column, _this.row));
            if (_this.table.attrs.ww && _this.table.attrs.ww.onCellClicked)
                _this.table.attrs.ww.onCellClicked(new event_1.CellClickedEvent(_this.column, _this.row));
        };
    }
    return NewCellContext;
}());
exports.NewCellContext = NewCellContext;
/**
 * DataTable can be used for displaying sortable
 * tabular data.
 */
var DataTable = /** @class */ (function (_super) {
    __extends(DataTable, _super);
    function DataTable() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.theadView = new views.EmptyView({});
        _this.tbodyView = new views.EmptyView({});
        _this.values = {
            wml: { id: 'table' },
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.DATA_TABLE, __1.getClassName(_this.attrs)),
            name: (_this.attrs.ww && _this.attrs.ww.name || ''),
            sortable: (_this.attrs.ww && (_this.attrs.ww.sortable != null)) ?
                _this.attrs.ww.sortable : true,
            sortKey: ((_this.attrs.ww && _this.attrs.ww.sortKey) ?
                _this.attrs.ww.sortKey : [-1, 1]),
            sort: function (col) {
                if (_this.values.sortable)
                    _this.sort(col);
            },
            dataset: ((_this.attrs.ww && _this.attrs.ww.data) ?
                [_this.attrs.ww.data.slice(), _this.attrs.ww.data.slice()] :
                [[], []]),
            columns: (_this.attrs.ww && _this.attrs.ww.columns) ?
                _this.attrs.ww.columns : [],
            thead: function () {
                _this.theadView = getHeadView(_this, new NewHeadContext(_this));
                return _this.theadView.render();
            },
            tbody: function () {
                _this.tbodyView = getBodyView(_this, new NewBodyContext(_this));
                return _this.tbodyView.render();
            }
        };
        return _this;
    }
    /**
     * @private
     */
    DataTable.prototype.fireChange = function () {
        if (this.attrs.ww && this.attrs.ww.onChange)
            this.attrs.ww.onChange(new event_1.DataChangedEvent(this.values.name, this.values.dataset[0].slice(), this.values.sortKey.slice()));
    };
    /**
     * update the data displayed with a new data.
     */
    DataTable.prototype.update = function (data) {
        this.values.dataset = [data.slice(), data.slice()];
        this.view.invalidate();
        this.fireChange();
        return this;
    };
    /**
     * updateWithSortKey is like update but will set the sort key as well.
     */
    DataTable.prototype.updateWithSortKey = function (data, key) {
        this.values.sortKey = key;
        this.update(data);
        return this;
    };
    /**
     * sort the table data by the column id specified.
     *
     * The data can only be sorted by one column at a time and that column
     * must specify the "sort" key.
     *
     * This method causes a repaint.
     */
    DataTable.prototype.sort = function (id) {
        var _a = this.values, sortKey = _a.sortKey, dataset = _a.dataset;
        var del = getSortDelegate(this);
        var _b = del(new sort_1.SortRequest(id, dataset[1], sortKey)), data = _b[0], key = _b[1];
        this.values.dataset[0] = data;
        this.values.sortKey = key;
        this.view.invalidate();
        this.fireChange();
        return this;
    };
    /**
     * getRow returns a Range of HTMLTableCellElements for the row
     * that matches the provided id.
     *
     * If no rows are found by that id, the Range will be empty.
     * In order for this method to work the body view MUST include
     * the wml:id on each <tr> element that represents a row of data.
     */
    DataTable.prototype.getRow = function (row) {
        var mTr = util_1.getById(this.tbodyView, "" + row);
        if (mTr.isNothing())
            return new range_1.RangeInstance([]);
        var tr = mTr.get();
        return new range_1.RangeInstance(array_1.make(tr.cells.length, function (n) { return tr.cells[n]; }));
    };
    /**
     * getCell provides a Range containing a cell located at the
     * intersection of the column and row.
     */
    DataTable.prototype.getCell = function (column, row) {
        var cells = this.getRow(row).cells;
        if (!cells[column])
            return new range_1.RangeInstance([]);
        return new range_1.RangeInstance([cells[column]]);
    };
    return DataTable;
}(wml_1.Component));
exports.DataTable = DataTable;
var getHeadView = function (table, ctx) {
    return (table.attrs.ww && table.attrs.ww.headFragment) ?
        table.attrs.ww.headFragment(ctx) : new views.HeadView(ctx);
};
var getHeadingView = function (table, ctx, c) {
    return c.headingFragment ? c.headingFragment(ctx) :
        (table.attrs.ww && table.attrs.ww.headingFragment) ?
            table.attrs.ww.headingFragment(ctx) : new views.HeadingView(ctx);
};
var getBodyView = function (table, ctx) {
    return (table.attrs.ww && table.attrs.ww.bodyFragment) ?
        table.attrs.ww.bodyFragment(ctx) :
        new views.BodyView(ctx);
};
var getCellView = function (table, ctx, c) {
    return c.cellFragment ? c.cellFragment(ctx) :
        (table.attrs.ww && table.attrs.ww.cellFragment) ?
            table.attrs.ww.cellFragment(ctx) :
            new views.CellView(ctx);
};
var getSortDelegate = function (table) {
    return (table.attrs.ww && table.attrs.ww.sortDelegate) ?
        table.attrs.ww.sortDelegate :
        function (r) { return sort_1.sortById(table.values.columns, r.key, [table.values.dataset[0], r.data], r.column); };
};
var getSortClassName = function (key, index) {
    return (key[0] === index) ? (key[1] === 1) ? exports.ASC : exports.DESC : '';
};
var cellId = function (column, row) { return column + "," + row; };

},{"../../":104,"../../util":143,"./column/sort":89,"./event":90,"./range":92,"./wml/table":93,"@quenk/noni/lib/data/array":145,"@quenk/noni/lib/data/record/path":149,"@quenk/wml":153}],92:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RangeInstance = void 0;
/**
 * RangeInstance
 */
var RangeInstance = /** @class */ (function () {
    function RangeInstance(cells) {
        this.cells = cells;
    }
    return RangeInstance;
}());
exports.RangeInstance = RangeInstance;

},{}],93:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = exports.CellView = exports.BodyView = exports.HeadingView = exports.HeadView = exports.EmptyView = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
;
var table_1 = require("../../../layout/table");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var EmptyView = /** @class */ (function () {
    function EmptyView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', {}, []);
        };
    }
    EmptyView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    EmptyView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    EmptyView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    EmptyView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    EmptyView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    EmptyView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    EmptyView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    EmptyView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return EmptyView;
}());
exports.EmptyView = EmptyView;
;
var HeadView = /** @class */ (function () {
    function HeadView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('thead', { 'class': __context.className }, [
                __this.node('tr', {}, __spreadArrays(__forIn(__context.columns, function (col, idx, _$$all) {
                    return ([
                        __context.heading(col, idx)
                    ]);
                }, function () { return ([]); })))
            ]);
        };
    }
    HeadView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    HeadView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    HeadView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    HeadView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    HeadView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    HeadView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    HeadView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    HeadView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return HeadView;
}());
exports.HeadView = HeadView;
;
var HeadingView = /** @class */ (function () {
    function HeadingView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('th', { 'class': __context.className, 'onclick': __context.onclick }, [
                text(__context.column.heading)
            ]);
        };
    }
    HeadingView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    HeadingView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    HeadingView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    HeadingView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    HeadingView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    HeadingView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    HeadingView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    HeadingView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return HeadingView;
}());
exports.HeadingView = HeadingView;
;
var BodyView = /** @class */ (function () {
    function BodyView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('tbody', { 'class': __context.className }, __spreadArrays(__forIn(__context.data, function (_, row, _$$all) {
                return ([
                    __this.node('tr', { wml: { 'id': String(row) } }, __spreadArrays(__forIn(__context.columns, function (col, idx, _$$all) {
                        return ([
                            __context.cell(col, idx, row)
                        ]);
                    }, function () { return ([]); })))
                ]);
            }, function () { return ([]); })));
        };
    }
    BodyView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    BodyView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    BodyView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    BodyView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    BodyView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    BodyView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    BodyView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    BodyView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return BodyView;
}());
exports.BodyView = BodyView;
;
var CellView = /** @class */ (function () {
    function CellView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('td', { wml: { 'id': __context.id }, 'class': __context.className, 'onclick': __context.onclick }, [
                text(__context.format(__context.value))
            ]);
        };
    }
    CellView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    CellView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    CellView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    CellView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    CellView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    CellView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    CellView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    CellView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return CellView;
}());
exports.CellView = CellView;
;
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new table_1.TableLayout({ wml: { 'id': __context.values.wml.id }, ww: { 'id': __context.values.id, 'className': __context.values.className } }, [
                __context.values.thead(),
                __context.values.tbody()
            ]), { wml: { 'id': __context.values.wml.id }, ww: { 'id': __context.values.id, 'className': __context.values.className } });
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../layout/table":128,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],94:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Alert = exports.ALERT = exports.Style = void 0;
var dom_1 = require("@quenk/wml/lib/dom");
var wml_1 = require("@quenk/wml");
var style_1 = require("../../content/style");
Object.defineProperty(exports, "Style", { enumerable: true, get: function () { return style_1.Style; } });
var util_1 = require("../../util");
var __1 = require("../../");
var alert_1 = require("./wml/alert");
///classNames:begin
exports.ALERT = 'ww-alert';
/**
 * Alert is used for displaying important messages to users.
 */
var Alert = /** @class */ (function (_super) {
    __extends(Alert, _super);
    function Alert() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new alert_1.Main(_this);
        _this.values = {
            wml: {
                id: 'alert'
            },
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.ALERT, __1.getClassName(_this.attrs), (_this.attrs.ww && _this.attrs.ww.style) ?
                style_1.getStyleClassName(_this.attrs.ww.style) :
                style_1.DEFAULT),
            closable: (_this.attrs.ww && _this.attrs.ww.closable) ?
                _this.attrs.ww.closable : false,
            content: (_this.attrs.ww && _this.attrs.ww.text) ?
                [dom_1.text(_this.attrs.ww.text)] : _this.children
        };
        return _this;
    }
    /**
     * close the alert.
     */
    Alert.prototype.close = function () {
        var mRoot = util_1.getById(this.view, this.values.wml.id);
        if (mRoot.isJust()) {
            var root = mRoot.get();
            if (root.parentNode)
                root.parentNode.removeChild(root);
        }
    };
    return Alert;
}(wml_1.Component));
exports.Alert = Alert;

},{"../../":104,"../../content/style":20,"../../util":143,"./wml/alert":95,"@quenk/wml":153,"@quenk/wml/lib/dom":152}],95:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var close_1 = require("../../../content/close");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.wml.id }, 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.values.content), ((__context.values.closable) ?
                (function () { return ([
                    __this.widget(new close_1.Close({ ww: { 'onClick': function () { return __context.close(); } } }, []), { ww: { 'onClick': function () { return __context.close(); } } })
                ]); })() :
                (function () { return ([
                    text('')
                ]); })())));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../content/close":3,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],96:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Confirm = exports.Primary = exports.CONFIRM_YES = exports.CONFIRM_NO = exports.CONFIRM = void 0;
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
var __1 = require("../../");
var prompt_1 = require("../prompt");
var confirm_1 = require("./wml/confirm");
///classNames:begin
exports.CONFIRM = 'ww-confirm';
exports.CONFIRM_NO = 'ww-confirm__no';
exports.CONFIRM_YES = 'ww-prompt__yes';
///classNames:end
/**
 * Primary indicates whether the yes or no button should be highlighted.
 */
var Primary;
(function (Primary) {
    Primary["No"] = "no";
    Primary["Yes"] = "yes";
})(Primary = exports.Primary || (exports.Primary = {}));
/**
 * Confirm displays a dialog for confirming an action.
 */
var Confirm = /** @class */ (function (_super) {
    __extends(Confirm, _super);
    function Confirm() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new confirm_1.Main(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.CONFIRM, __1.getClassName(_this.attrs)),
            wml: {
                id: 'modal'
            },
            header: {
                title: (_this.attrs.ww && _this.attrs.ww.title) ?
                    _this.attrs.ww.title : ''
            },
            footer: {
                no: {
                    text: (_this.attrs.ww && _this.attrs.ww.noText) ?
                        _this.attrs.ww.noText : 'No',
                    className: util_1.concat(exports.CONFIRM_NO, (_this.attrs.ww &&
                        _this.attrs.ww.primary &&
                        _this.attrs.ww.primary === Primary.No) ? '-primary' : ''),
                    onClick: function () {
                        if (_this.attrs.ww && _this.attrs.ww.onNo)
                            _this.attrs.ww.onNo();
                        _this.close();
                    }
                },
                yes: {
                    text: (_this.attrs.ww && _this.attrs.ww.yesText) ?
                        _this.attrs.ww.yesText : 'Yes',
                    wml: {
                        id: 'yes'
                    },
                    className: util_1.concat(exports.CONFIRM_YES, (_this.attrs.ww &&
                        _this.attrs.ww.primary &&
                        _this.attrs.ww.primary === Primary.No) ? '' : '-primary'),
                    onClick: function () {
                        if (_this.attrs.ww && _this.attrs.ww.onYes)
                            _this.attrs.ww.onYes();
                        _this.close();
                    }
                }
            }
        };
        return _this;
    }
    Confirm.prototype.close = function () {
        prompt_1.close(this.view, this.values.wml.id);
        return this;
    };
    return Confirm;
}(wml_1.Component));
exports.Confirm = Confirm;

},{"../../":104,"../../util":143,"../prompt":102,"./wml/confirm":97,"@quenk/wml":153}],97:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var button_1 = require("../../../control/button");
;
var close_button_1 = require("../../../control/close-button");
;
var modal_1 = require("../../modal");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new modal_1.Modal({ wml: { 'id': __context.values.wml.id }, ww: { 'className': __context.values.className } }, [
                __this.widget(new modal_1.ModalHeader({}, [
                    __this.widget(new close_button_1.CloseButton({ ww: { 'onClick': __context.values.footer.no.onClick } }, []), { ww: { 'onClick': __context.values.footer.no.onClick } }),
                    text(__context.values.header.title)
                ]), {}),
                __this.widget(new modal_1.ModalBody({}, __spreadArrays((__context.children))), {}),
                __this.widget(new modal_1.ModalFooter({}, [
                    __this.widget(new button_1.Button({ ww: { 'text': __context.values.footer.no.text, 'className': __context.values.footer.no.className, 'onClick': __context.values.footer.no.onClick } }, []), { ww: { 'text': __context.values.footer.no.text, 'className': __context.values.footer.no.className, 'onClick': __context.values.footer.no.onClick } }),
                    __this.widget(new button_1.Button({ ww: { 'text': __context.values.footer.yes.text, 'className': __context.values.footer.yes.className, 'onClick': __context.values.footer.yes.onClick } }, []), { ww: { 'text': __context.values.footer.yes.text, 'className': __context.values.footer.yes.className, 'onClick': __context.values.footer.yes.onClick } })
                ]), {})
            ]), { wml: { 'id': __context.values.wml.id }, ww: { 'className': __context.values.className } });
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../control/button":29,"../../../control/close-button":33,"../../modal":100,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],98:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Inform = exports.INFORM_OK = exports.INFORM = void 0;
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
var __1 = require("../../");
var prompt_1 = require("../prompt");
var inform_1 = require("./wml/inform");
///classNames:begin
exports.INFORM = 'ww-inform';
exports.INFORM_OK = 'ww-inform__ok';
/**
 * Inform displays a message to the user.
 */
var Inform = /** @class */ (function (_super) {
    __extends(Inform, _super);
    function Inform() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new inform_1.Main(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.INFORM, __1.getClassName(_this.attrs)),
            wml: {
                id: 'modal'
            },
            header: {
                title: (_this.attrs.ww && _this.attrs.ww.title) ?
                    _this.attrs.ww.title : ''
            },
            footer: {
                ok: {
                    text: (_this.attrs.ww && _this.attrs.ww.buttonText) ?
                        _this.attrs.ww.buttonText : 'Ok',
                    wml: {
                        id: 'ok'
                    },
                    className: util_1.concat(exports.INFORM_OK, '-primary'),
                    onClick: function () {
                        if (_this.attrs.ww && _this.attrs.ww.onClose)
                            _this.attrs.ww.onClose();
                        _this.close();
                    }
                }
            }
        };
        return _this;
    }
    Inform.prototype.close = function () {
        prompt_1.close(this.view, this.values.wml.id);
        return this;
    };
    return Inform;
}(wml_1.Component));
exports.Inform = Inform;

},{"../../":104,"../../util":143,"../prompt":102,"./wml/inform":99,"@quenk/wml":153}],99:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var button_1 = require("../../../control/button");
;
var close_button_1 = require("../../../control/close-button");
;
var modal_1 = require("../../modal");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new modal_1.Modal({ wml: { 'id': __context.values.wml.id }, ww: { 'className': __context.values.className } }, [
                __this.widget(new modal_1.ModalHeader({}, [
                    __this.widget(new close_button_1.CloseButton({ ww: { 'onClick': __context.values.footer.ok.onClick } }, []), { ww: { 'onClick': __context.values.footer.ok.onClick } }),
                    text(__context.values.header.title)
                ]), {}),
                __this.widget(new modal_1.ModalBody({}, __spreadArrays((__context.children))), {}),
                __this.widget(new modal_1.ModalFooter({}, [
                    __this.widget(new button_1.Button({ ww: { 'text': __context.values.footer.ok.text, 'className': __context.values.footer.ok.className, 'onClick': __context.values.footer.ok.onClick } }, []), { ww: { 'text': __context.values.footer.ok.text, 'className': __context.values.footer.ok.className, 'onClick': __context.values.footer.ok.onClick } })
                ]), {})
            ]), { wml: { 'id': __context.values.wml.id }, ww: { 'className': __context.values.className } });
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../control/button":29,"../../../control/close-button":33,"../../modal":100,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],100:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.ModalFooter = exports.ModalBody = exports.ModalHeader = exports.Modal = exports.MODAL_FOOTER = exports.MODAL_BODY = exports.MODAL_HEADER = exports.MODAL_CONTENT = exports.MODAL_POSITION = exports.MODAL = void 0;
var views = require("./wml/modal");
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
var __1 = require("../../");
var layout_1 = require("../../layout");
///classNames:begin
exports.MODAL = 'ww-modal';
exports.MODAL_POSITION = 'ww-modal__position';
exports.MODAL_CONTENT = 'ww-modal__content';
exports.MODAL_HEADER = 'ww-modal__header';
exports.MODAL_BODY = 'ww-modal__body';
exports.MODAL_FOOTER = 'ww-modal__footer';
/**
 * Modal
 */
var Modal = /** @class */ (function (_super) {
    __extends(Modal, _super);
    function Modal() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Modal(_this);
        _this.values = {
            wml: {
                id: 'root'
            },
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.MODAL, __1.getClassName(_this.attrs)),
            content: {
                className: exports.MODAL_CONTENT
            },
            position: {
                className: exports.MODAL_POSITION
            }
        };
        return _this;
    }
    /**
     * close the modal.
     */
    Modal.prototype.close = function () {
        var mO = util_1.getById(this.view, this.values.wml.id);
        if (mO.isJust()) {
            var n = mO.get();
            if (n.parentNode)
                n.parentNode.removeChild(n);
        }
    };
    return Modal;
}(wml_1.Component));
exports.Modal = Modal;
/**
 * ModalHeader
 */
var ModalHeader = /** @class */ (function (_super) {
    __extends(ModalHeader, _super);
    function ModalHeader() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.ModalHeader(_this);
        _this.values = {
            wml: {
                id: 'root'
            },
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.MODAL_HEADER, __1.getClassName(_this.attrs)),
            content: { wml: { id: 'root' } }
        };
        return _this;
    }
    return ModalHeader;
}(layout_1.AbstractLayout));
exports.ModalHeader = ModalHeader;
/**
 * ModalBodyAttrs
 */
var ModalBody = /** @class */ (function (_super) {
    __extends(ModalBody, _super);
    function ModalBody() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.ModalBody(_this);
        _this.values = {
            wml: {
                id: 'root'
            },
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.MODAL_BODY, __1.getClassName(_this.attrs)),
            content: { wml: { id: 'root' } }
        };
        return _this;
    }
    return ModalBody;
}(layout_1.AbstractLayout));
exports.ModalBody = ModalBody;
/**
 * ModalFooter
 */
var ModalFooter = /** @class */ (function (_super) {
    __extends(ModalFooter, _super);
    function ModalFooter() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.ModalFooter(_this);
        _this.values = {
            wml: {
                id: 'root'
            },
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.MODAL_FOOTER, __1.getClassName(_this.attrs)),
            content: { wml: { id: 'root' } }
        };
        return _this;
    }
    return ModalFooter;
}(wml_1.Component));
exports.ModalFooter = ModalFooter;

},{"../../":104,"../../layout":117,"../../util":143,"./wml/modal":101,"@quenk/wml":153}],101:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ModalFooter = exports.ModalBody = exports.ModalHeader = exports.Modal = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Modal = /** @class */ (function () {
    function Modal(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.wml.id }, 'id': __context.values.id, 'class': __context.values.className }, [
                __this.node('div', { 'class': __context.values.position.className }, [
                    __this.node('div', { 'class': __context.values.content.className }, __spreadArrays((__context.children)))
                ])
            ]);
        };
    }
    Modal.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Modal.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Modal.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Modal.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Modal.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Modal.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Modal.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Modal.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Modal;
}());
exports.Modal = Modal;
;
var ModalHeader = /** @class */ (function () {
    function ModalHeader(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.wml.id }, 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    ModalHeader.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    ModalHeader.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    ModalHeader.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    ModalHeader.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    ModalHeader.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    ModalHeader.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    ModalHeader.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    ModalHeader.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return ModalHeader;
}());
exports.ModalHeader = ModalHeader;
;
var ModalBody = /** @class */ (function () {
    function ModalBody(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.wml.id }, 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    ModalBody.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    ModalBody.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    ModalBody.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    ModalBody.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    ModalBody.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    ModalBody.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    ModalBody.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    ModalBody.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return ModalBody;
}());
exports.ModalBody = ModalBody;
;
var ModalFooter = /** @class */ (function () {
    function ModalFooter(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.wml.id }, 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    ModalFooter.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    ModalFooter.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    ModalFooter.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    ModalFooter.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    ModalFooter.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    ModalFooter.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    ModalFooter.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    ModalFooter.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return ModalFooter;
}());
exports.ModalFooter = ModalFooter;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],102:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.close = exports.Prompt = exports.PROMPT_SAVE = exports.PROMPT_CLOSE = exports.PROMPT = void 0;
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
var __1 = require("../../");
var prompt_1 = require("./wml/prompt");
///classNames:begin
exports.PROMPT = 'ww-prompt';
exports.PROMPT_CLOSE = 'ww-prompt__close';
exports.PROMPT_SAVE = 'ww-prompt__save';
/**
 * Prompt displays a dialog to the user suitable for collecting data
 * input.
 */
var Prompt = /** @class */ (function (_super) {
    __extends(Prompt, _super);
    function Prompt() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new prompt_1.Main(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.PROMPT, __1.getClassName(_this.attrs)),
            wml: {
                id: 'modal'
            },
            header: {
                title: (_this.attrs.ww && _this.attrs.ww.title) ?
                    _this.attrs.ww.title : ''
            },
            footer: {
                close: {
                    text: (_this.attrs.ww && _this.attrs.ww.closeText) ?
                        _this.attrs.ww.closeText : 'Close',
                    className: exports.PROMPT_CLOSE,
                    onClick: function () {
                        if (_this.attrs.ww && _this.attrs.ww.onCancel)
                            _this.attrs.ww.onCancel();
                        _this.close();
                    }
                },
                save: {
                    text: (_this.attrs.ww && _this.attrs.ww.saveText) ?
                        _this.attrs.ww.saveText : 'Save',
                    wml: {
                        id: 'save'
                    },
                    className: util_1.concat('-primary', exports.PROMPT_SAVE),
                    disabled: (_this.attrs.ww && _this.attrs.ww.disabled) ?
                        true : false,
                    onClick: function () {
                        if (_this.attrs.ww && _this.attrs.ww.onSave)
                            _this.attrs.ww.onSave();
                        _this.close();
                    }
                }
            }
        };
        return _this;
    }
    Prompt.prototype.close = function () {
        exports.close(this.view, this.values.wml.id);
        return this;
    };
    /**
     * enable saving.
     */
    Prompt.prototype.enable = function () {
        getSave(this).map(function (b) { return b.enable(); });
        return this;
    };
    /**
     * disable saving.
     */
    Prompt.prototype.disable = function () {
        getSave(this).map(function (b) { return b.disable(); });
        return this;
    };
    return Prompt;
}(wml_1.Component));
exports.Prompt = Prompt;
var getSave = function (p) {
    return util_1.getById(p.view, p.values.footer.save.wml.id);
};
/**
 * close the Modal in a view.
 */
exports.close = function (view, id) {
    return util_1.getById(view, id).map(function (m) { return m.close(); });
};

},{"../../":104,"../../util":143,"./wml/prompt":103,"@quenk/wml":153}],103:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var button_1 = require("../../../control/button");
;
var close_button_1 = require("../../../control/close-button");
;
var modal_1 = require("../../modal");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new modal_1.Modal({ wml: { 'id': __context.values.wml.id }, ww: { 'className': __context.values.className } }, [
                __this.widget(new modal_1.ModalHeader({}, [
                    __this.widget(new close_button_1.CloseButton({ ww: { 'onClick': __context.values.footer.close.onClick } }, []), { ww: { 'onClick': __context.values.footer.close.onClick } }),
                    text(__context.values.header.title)
                ]), {}),
                __this.widget(new modal_1.ModalBody({}, __spreadArrays((__context.children))), {}),
                __this.widget(new modal_1.ModalFooter({}, [
                    __this.widget(new button_1.Button({ ww: { 'text': __context.values.footer.close.text, 'className': __context.values.footer.close.className, 'onClick': __context.values.footer.close.onClick } }, []), { ww: { 'text': __context.values.footer.close.text, 'className': __context.values.footer.close.className, 'onClick': __context.values.footer.close.onClick } }),
                    __this.widget(new button_1.Button({ ww: { 'text': __context.values.footer.save.text, 'className': __context.values.footer.save.className, 'disabled': __context.values.footer.save.disabled, 'onClick': __context.values.footer.save.onClick } }, []), { ww: { 'text': __context.values.footer.save.text, 'className': __context.values.footer.save.className, 'disabled': __context.values.footer.save.disabled, 'onClick': __context.values.footer.save.onClick } })
                ]), {})
            ]), { wml: { 'id': __context.values.wml.id }, ww: { 'className': __context.values.className } });
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../control/button":29,"../../../control/close-button":33,"../../modal":100,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],104:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getClassName = exports.getId = void 0;
/**
 * getId from a widget's passed attributes.
 */
exports.getId = function (attrs) {
    return (attrs.ww && attrs.ww.id) ? attrs.ww.id : '';
};
/**
 * getClassName from a widget's passed attributes.
 */
exports.getClassName = function (attrs) {
    var asHtmlAttrs = attrs;
    var asWidgetAttrs = attrs.ww;
    return asHtmlAttrs.className ||
        (asWidgetAttrs && asWidgetAttrs.className) || '';
};

},{}],105:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.ActionBar = exports.ACTION_BAR_CONTENT = exports.ACTION_BAR = void 0;
var orientation = require("../../content/orientation");
var __1 = require("../..");
var util_1 = require("../../util");
var __2 = require("../");
var action_bar_1 = require("./wml/action-bar");
///classNames:begin
/**
 * ACTION_BAR class name. for the ActionBar root.
 */
exports.ACTION_BAR = 'ww-action-bar';
/**
 * ACTION_BAR_CONTENT class name.
 */
exports.ACTION_BAR_CONTENT = 'ww-action-bar__content';
/**
 * ActionBar provides a bar across the screen that can be
 * used as a toolbar, navigation menu or something simillar.
 */
var ActionBar = /** @class */ (function (_super) {
    __extends(ActionBar, _super);
    function ActionBar() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new action_bar_1.Main(_this);
        _this.values = {
            root: {
                wml: {
                    id: 'root',
                },
                id: (_this.attrs.ww && _this.attrs.ww.id) ?
                    _this.attrs.ww.id : '',
                className: util_1.concat(exports.ACTION_BAR, __2.LAYOUT, orientation.POSITIONED, __1.getClassName(_this.attrs))
            },
            content: {
                wml: {
                    id: 'content'
                },
                class: exports.ACTION_BAR_CONTENT
            }
        };
        return _this;
    }
    return ActionBar;
}(__2.AbstractLayout));
exports.ActionBar = ActionBar;

},{"../":117,"../..":104,"../../content/orientation":13,"../../util":143,"./wml/action-bar":106}],106:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.root.wml.id }, 'id': __context.values.root.id, 'class': __context.values.root.className }, [
                __this.node('div', { wml: { 'id': __context.values.content.wml.id }, 'class': __context.values.content.class }, __spreadArrays((__context.children)))
            ]);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],107:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Callout = exports.CALLOUT = exports.Style = void 0;
var wml_1 = require("@quenk/wml");
var style_1 = require("../../content/style");
Object.defineProperty(exports, "Style", { enumerable: true, get: function () { return style_1.Style; } });
var util_1 = require("../../util");
var __1 = require("../../");
var callout_1 = require("./wml/callout");
///classNames:begin
exports.CALLOUT = 'ww-callout';
/**
 * Callout
 */
var Callout = /** @class */ (function (_super) {
    __extends(Callout, _super);
    function Callout() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new callout_1.Main(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.CALLOUT, __1.getClassName(_this.attrs), (_this.attrs.ww && _this.attrs.ww.style) ?
                style_1.getStyleClassName(_this.attrs.ww.style) :
                style_1.DEFAULT)
        };
        return _this;
    }
    return Callout;
}(wml_1.Component));
exports.Callout = Callout;

},{"../../":104,"../../content/style":20,"../../util":143,"./wml/callout":108,"@quenk/wml":153}],108:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],109:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Data = exports.Title = exports.DescriptionList = exports.DESCRIPTION_LIST_DATA = exports.DESCRIPTION_LIST_TITLE = exports.DESCRIPTION_LIST = void 0;
var views = require("./wml/description-list");
var wml_1 = require("@quenk/wml");
var orientation_1 = require("../../content/orientation");
var util_1 = require("../../util");
var __1 = require("../../");
///classNames:begin
exports.DESCRIPTION_LIST = 'ww-description-list';
exports.DESCRIPTION_LIST_TITLE = 'ww-description-list__title';
exports.DESCRIPTION_LIST_DATA = 'ww-description-list__data';
/**
 * DescriptionList layout.
 */
var DescriptionList = /** @class */ (function (_super) {
    __extends(DescriptionList, _super);
    function DescriptionList() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.DescriptionList(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.DESCRIPTION_LIST, __1.getClassName(_this.attrs), (_this.attrs.ww && _this.attrs.ww.horizontal) ? orientation_1.HORIZONTAL : '')
        };
        return _this;
    }
    return DescriptionList;
}(wml_1.Component));
exports.DescriptionList = DescriptionList;
/**
 * Title
 */
var Title = /** @class */ (function (_super) {
    __extends(Title, _super);
    function Title() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Title(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.DESCRIPTION_LIST_TITLE, __1.getClassName(_this.attrs))
        };
        return _this;
    }
    return Title;
}(wml_1.Component));
exports.Title = Title;
/**
 * Data
 */
var Data = /** @class */ (function (_super) {
    __extends(Data, _super);
    function Data() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Data(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.DESCRIPTION_LIST_DATA, __1.getClassName(_this.attrs))
        };
        return _this;
    }
    return Data;
}(wml_1.Component));
exports.Data = Data;

},{"../../":104,"../../content/orientation":13,"../../util":143,"./wml/description-list":110,"@quenk/wml":153}],110:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Data = exports.Title = exports.DescriptionList = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var DescriptionList = /** @class */ (function () {
    function DescriptionList(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('dl', { 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    DescriptionList.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    DescriptionList.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    DescriptionList.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    DescriptionList.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    DescriptionList.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    DescriptionList.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    DescriptionList.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    DescriptionList.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return DescriptionList;
}());
exports.DescriptionList = DescriptionList;
;
var Title = /** @class */ (function () {
    function Title(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('dt', { 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    Title.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Title.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Title.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Title.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Title.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Title.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Title.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Title.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Title;
}());
exports.Title = Title;
;
var Data = /** @class */ (function () {
    function Data(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('dd', { 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    Data.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Data.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Data.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Data.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Data.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Data.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Data.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Data.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Data;
}());
exports.Data = Data;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],111:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.DrawerLayout = exports.DRAWER_LAYOUT = void 0;
var views = require("./wml/drawer");
var wml_1 = require("@quenk/wml");
var hidden_1 = require("../../content/state/hidden");
var util_1 = require("../../util");
var __1 = require("../");
///classNames:begin
/**
 * DRAWER_LAYOUT
 */
exports.DRAWER_LAYOUT = 'ww-drawer-layout';
;
/**
 * DrawerLayout provides a 1 column application layout with a drawer that can
 * be shown or hidden upon requests.
 *
 * The drawer takes up most of the screen on mobile and about roughly 1/6 - 1/8
 * on a desktop (not fact checked yet).
 *
 *  Mobile:
 *  +---------------------------------------------------------------------+
 *  |                                            |                        |
 *  |                                            |                        |
 *  |                                            |                        |
 *  |   <drawer>                                 |                        |
 *  |                                            |                        |
 *  |                                            |                        |
 *  |                                            |                        |
 *  |                                            |                        |
 *  |                                            |                        |
 *  |                                            |                        |
 *  |                                            |                        |
 *  |                                            |                        |
 *  |                                            |                        |
 *  |                                            |                        |
 *  +---------------------------------------------------------------------+
 *
 *  Desktop:
 *  +---------------------------------------------------------------------+
 *  |             |                                                       |
 *  |             |                                                       |
 *  |             |                                                       |
 *  |             |                                                       |
 *  |             |                                                       |
 *  |   <drawer>  |                                                       |
 *  |             |                                                       |
 *  |             |                                                       |
 *  |             |                                                       |
 *  |             |                                                       |
 *  |             |                                                       |
 *  |             |                                                       |
 *  |             |                                                       |
 *  |             |                                                       |
 *  |             |                                                       |
 *  +---------------------------------------------------------------------+
 */
var DrawerLayout = /** @class */ (function (_super) {
    __extends(DrawerLayout, _super);
    function DrawerLayout() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.DrawerLayout(_this);
        /**
         * values is a hash of values used in the template.
         */
        _this.values = {
            root: {
                wml: {
                    id: 'layout'
                },
                id: _this.attrs.ww && _this.attrs.ww.id,
                className: util_1.concat(exports.DRAWER_LAYOUT, __1.LAYOUT, (_this.attrs.ww && _this.attrs.ww.className) ?
                    _this.attrs.ww.className : '')
            },
            drawer: {
                wml: {
                    id: 'drawer'
                },
                hidden: (_this.attrs.ww && _this.attrs.ww.drawerHidden) ?
                    _this.attrs.ww.drawerHidden : false,
                content: (_this.attrs.ww && _this.attrs.ww.drawerContent) ?
                    _this.attrs.ww.drawerContent : []
            },
            content: {
                id: 'content',
                value: _this.children
            }
        };
        return _this;
    }
    DrawerLayout.prototype.isHidden = function () {
        var m = getDrawer(this);
        if (m.isNothing())
            return true;
        return m.get().isHidden();
    };
    DrawerLayout.prototype.hide = function () {
        var m = getDrawer(this);
        if (m.isJust()) {
            m.get().hide();
            hidden_1.hide(this.view, this.values.root.wml.id);
        }
        return this;
    };
    DrawerLayout.prototype.show = function () {
        var m = getDrawer(this);
        if (m.isJust()) {
            m.get().show();
            hidden_1.show(this.view, this.values.root.wml.id);
        }
        return this;
    };
    DrawerLayout.prototype.toggle = function () {
        var m = getDrawer(this);
        if (m.isJust()) {
            m.get().toggle();
            hidden_1.toggle(this.view, this.values.root.wml.id);
        }
        return this;
    };
    DrawerLayout.prototype.setContent = function (c) {
        this.values.content.value = c;
        this.view.invalidate();
        return this;
    };
    DrawerLayout.prototype.removeContent = function () {
        this.values.content.value = [];
        return this;
    };
    return DrawerLayout;
}(wml_1.Component));
exports.DrawerLayout = DrawerLayout;
var getDrawer = function (dl) {
    var m = dl.view.findById(dl.values.drawer.wml.id);
    if (m.isNothing())
        util_1.warnMissing(dl.view, dl.values.drawer.wml.id);
    return m;
};

},{"../":117,"../../content/state/hidden":19,"../../util":143,"./wml/drawer":112,"@quenk/wml":153}],112:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DrawerLayout = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var drawer_1 = require("../../../menu/drawer");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var DrawerLayout = /** @class */ (function () {
    function DrawerLayout(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.root.wml.id }, 'id': __context.values.root.id, 'class': __context.values.root.className }, __spreadArrays([
                __this.widget(new drawer_1.Drawer({ wml: { 'id': __context.values.drawer.wml.id }, ww: { 'hidden': __context.values.drawer.hidden, 'content': __context.values.drawer.content } }, []), { wml: { 'id': __context.values.drawer.wml.id }, ww: { 'hidden': __context.values.drawer.hidden, 'content': __context.values.drawer.content } })
            ], (__context.values.content.value)));
        };
    }
    DrawerLayout.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    DrawerLayout.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    DrawerLayout.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    DrawerLayout.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    DrawerLayout.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    DrawerLayout.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    DrawerLayout.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    DrawerLayout.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return DrawerLayout;
}());
exports.DrawerLayout = DrawerLayout;

},{"../../../menu/drawer":132,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],113:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Column = exports.Row = exports.GridLayout = exports.GRID_LAYOUT_COLUMN = exports.GRID_LAYOUT_ROW = exports.GRID_LAYOUT = void 0;
var views = require("./wml/grid");
var util_1 = require("../../util");
var __1 = require("../");
///classNames:begin
exports.GRID_LAYOUT = 'ww-grid-layout';
exports.GRID_LAYOUT_ROW = 'ww-grid-layout__row';
exports.GRID_LAYOUT_COLUMN = 'ww-grid-layout__column';
;
/**
 * GridLayout
 */
var GridLayout = /** @class */ (function (_super) {
    __extends(GridLayout, _super);
    function GridLayout() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.GridLayout(_this);
        _this.values = {
            content: {
                id: _this.attrs.ww && _this.attrs.ww.id,
                wml: {
                    id: 'root',
                },
                className: function () {
                    var c = (_this.attrs.ww && _this.attrs.ww.className) ?
                        _this.attrs.ww.className : '';
                    return util_1.concat(exports.GRID_LAYOUT, __1.LAYOUT, c);
                }
            }
        };
        return _this;
    }
    return GridLayout;
}(__1.AbstractLayout));
exports.GridLayout = GridLayout;
/**
 * Row
 */
var Row = /** @class */ (function (_super) {
    __extends(Row, _super);
    function Row() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Row(_this);
        _this.values = {
            content: {
                id: _this.attrs.ww && _this.attrs.ww.id,
                wml: {
                    id: 'row',
                },
                className: function () {
                    var c = (_this.attrs.ww && _this.attrs.ww.className) ?
                        _this.attrs.ww.className : '';
                    return util_1.concat(exports.GRID_LAYOUT_ROW, c);
                }
            }
        };
        return _this;
    }
    return Row;
}(__1.AbstractLayout));
exports.Row = Row;
/**
 * Column
 */
var Column = /** @class */ (function (_super) {
    __extends(Column, _super);
    function Column() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Column(_this);
        _this.values = {
            content: {
                id: _this.attrs.ww && _this.attrs.ww.id,
                wml: {
                    id: 'column'
                },
                className: function () {
                    if (_this.attrs.ww != null) {
                        return util_1.concat(exports.GRID_LAYOUT_COLUMN, _this.attrs.ww.span ?
                            "-span" + _this.attrs.ww.span :
                            '-span12', _this.attrs.ww.offset ?
                            "-offset" + _this.attrs.ww.offset :
                            '', _this.attrs.ww.className);
                    }
                    else {
                        return util_1.concat(exports.GRID_LAYOUT_COLUMN, '-span12');
                    }
                }
            }
        };
        return _this;
    }
    return Column;
}(__1.AbstractLayout));
exports.Column = Column;

},{"../":117,"../../util":143,"./wml/grid":114}],114:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Column = exports.Row = exports.GridLayout = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var GridLayout = /** @class */ (function () {
    function GridLayout(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.content.wml.id }, 'id': __context.values.content.id, 'class': __context.values.content.className() }, __spreadArrays((__context.children)));
        };
    }
    GridLayout.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    GridLayout.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    GridLayout.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    GridLayout.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    GridLayout.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    GridLayout.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    GridLayout.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    GridLayout.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return GridLayout;
}());
exports.GridLayout = GridLayout;
;
var Row = /** @class */ (function () {
    function Row(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.content.wml.id }, 'id': __context.values.content.id, 'class': __context.values.content.className() }, __spreadArrays((__context.children)));
        };
    }
    Row.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Row.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Row.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Row.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Row.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Row.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Row.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Row.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Row;
}());
exports.Row = Row;
;
var Column = /** @class */ (function () {
    function Column(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.content.wml.id }, 'id': __context.values.content.id, 'class': __context.values.content.className() }, __spreadArrays((__context.children)));
        };
    }
    Column.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Column.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Column.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Column.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Column.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Column.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Column.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Column.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Column;
}());
exports.Column = Column;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],115:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.HorizontalLayout = exports.HorizontalLayoutOrientation = exports.HORIZONTAL_LAYOUT = void 0;
var wml = require("@quenk/wml");
var views = require("./wml/horizontal");
var orientation_1 = require("../../content/orientation");
var util_1 = require("../../util");
var __1 = require("../../");
///classNames:begin
exports.HORIZONTAL_LAYOUT = 'ww-horizontal-layout';
///classNames:end
/**
 * HorizontalLayoutOrientation
 */
var HorizontalLayoutOrientation;
(function (HorizontalLayoutOrientation) {
    HorizontalLayoutOrientation["Left"] = "left";
    HorizontalLayoutOrientation["Right"] = "right";
})(HorizontalLayoutOrientation = exports.HorizontalLayoutOrientation || (exports.HorizontalLayoutOrientation = {}));
/**
 * HorizontalLayout uses the css flexbox to provide a container
 * where all items are laid out in a single row.
 */
var HorizontalLayout = /** @class */ (function (_super) {
    __extends(HorizontalLayout, _super);
    function HorizontalLayout() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: {
                id: (_this.attrs.ww && _this.attrs.ww.id) ? _this.attrs.ww.id : '',
                className: util_1.concat(exports.HORIZONTAL_LAYOUT, __1.getClassName(_this.attrs), getOrientation(_this.attrs))
            }
        };
        return _this;
    }
    return HorizontalLayout;
}(wml.Component));
exports.HorizontalLayout = HorizontalLayout;
var getOrientation = function (attrs) {
    return (attrs.ww && attrs.ww.orientation) ?
        attrs.ww.orientation === HorizontalLayoutOrientation.Right ?
            orientation_1.RIGHT : orientation_1.LEFT : '';
};

},{"../../":104,"../../content/orientation":13,"../../util":143,"./wml/horizontal":116,"@quenk/wml":153}],116:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'class': __context.values.root.className }, __spreadArrays((__context.children)));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],117:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.doRemoveContent = exports.doSetContent = exports.AbstractLayout = exports.LAYOUT = void 0;
var wml_1 = require("@quenk/wml");
var util_1 = require("../util");
///classNames:begin
exports.LAYOUT = '-layout';
/**
 * AbstractLayout provides an implementation of Layout.
 */
var AbstractLayout = /** @class */ (function (_super) {
    __extends(AbstractLayout, _super);
    function AbstractLayout() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    AbstractLayout.prototype.setContent = function (c) {
        exports.doSetContent(this.view, this.values.content.wml.id, c);
        return this;
    };
    AbstractLayout.prototype.removeContent = function () {
        exports.doRemoveContent(this.view, this.values.content.wml.id);
        return this;
    };
    return AbstractLayout;
}(wml_1.Component));
exports.AbstractLayout = AbstractLayout;
/**
 * doSetContent on a Node found in a view.
 */
exports.doSetContent = function (view, id, content) {
    var maybeRoot = view.findById(id);
    if (maybeRoot.isNothing())
        return util_1.warnMissing(view, id);
    var n = maybeRoot.get();
    while (n.firstChild)
        n.removeChild(n.firstChild);
    for (var i = 0; i < content.length; i++)
        n.appendChild(content[i]);
};
/**
 * doRemoveContent from a View.
 */
exports.doRemoveContent = function (view, id) {
    var maybeNode = view.findById(id);
    if (maybeNode.isNothing())
        return util_1.warnMissing(view, id);
    var n = maybeNode.get();
    while (n.firstChild)
        n.removeChild(n.firstChild);
};

},{"../util":143,"@quenk/wml":153}],118:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.ListLayout = exports.ListLayoutItem = exports.LIST_LAYOUT_ITEM = exports.LIST_LAYOUT = void 0;
var views = require("./wml/list");
var util_1 = require("../../util");
var active_1 = require("../../content/state/active");
var __1 = require("../");
///classNames:begin
exports.LIST_LAYOUT = 'ww-list-layout';
exports.LIST_LAYOUT_ITEM = 'ww-list-layout__item';
/**
 * ListLayoutItem
 */
var ListLayoutItem = /** @class */ (function (_super) {
    __extends(ListLayoutItem, _super);
    function ListLayoutItem() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.ListLayoutItem(_this);
        _this.values = {
            content: {
                wml: {
                    id: 'item'
                },
                id: (_this.attrs.ww && _this.attrs.ww.id) ? _this.attrs.ww.id : '',
                className: util_1.concat(exports.LIST_LAYOUT_ITEM, (_this.attrs.ww && _this.attrs.ww.active) ? active_1.ACTIVE : ''),
                name: (_this.attrs.ww && _this.attrs.ww.name) ? _this.attrs.ww.name : '',
                onclick: function () {
                    if (_this.attrs.ww && _this.attrs.ww.onClick)
                        _this.attrs.ww.onClick(_this.attrs.ww &&
                            _this.attrs.ww.name || '');
                }
            }
        };
        return _this;
    }
    ListLayoutItem.prototype.isActive = function () {
        return active_1.isActive(this.view, this.values.content.wml.id);
    };
    ListLayoutItem.prototype.activate = function () {
        active_1.activate(this.view, this.values.content.wml.id);
        return this;
    };
    ListLayoutItem.prototype.deactivate = function () {
        active_1.deactivate(this.view, this.values.content.wml.id);
        return this;
    };
    ListLayoutItem.prototype.toggleActive = function () {
        if (this.isActive())
            this.deactivate();
        else
            this.activate();
        return this;
    };
    return ListLayoutItem;
}(__1.AbstractLayout));
exports.ListLayoutItem = ListLayoutItem;
/**
 * ListLayout is used to create a vertical list of content.
 *
 * Children must be ListGroupItems.
 */
var ListLayout = /** @class */ (function (_super) {
    __extends(ListLayout, _super);
    function ListLayout() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.ListLayout(_this);
        _this.values = {
            content: {
                wml: {
                    id: 'list'
                },
                id: _this.attrs.ww && _this.attrs.ww.id,
                className: util_1.concat(exports.LIST_LAYOUT, __1.LAYOUT, (_this.attrs.ww && _this.attrs.ww.className) ?
                    _this.attrs.ww.className : '')
            }
        };
        return _this;
    }
    return ListLayout;
}(__1.AbstractLayout));
exports.ListLayout = ListLayout;

},{"../":117,"../../content/state/active":17,"../../util":143,"./wml/list":119}],119:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ListLayout = exports.ListLayoutItem = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var ListLayoutItem = /** @class */ (function () {
    function ListLayoutItem(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('li', { wml: { 'id': __context.values.content.wml.id }, 'id': __context.values.content.id, 'class': __context.values.content.className, 'onclick': __context.values.content.onclick }, __spreadArrays((__context.children)));
        };
    }
    ListLayoutItem.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    ListLayoutItem.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    ListLayoutItem.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    ListLayoutItem.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    ListLayoutItem.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    ListLayoutItem.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    ListLayoutItem.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    ListLayoutItem.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return ListLayoutItem;
}());
exports.ListLayoutItem = ListLayoutItem;
;
var ListLayout = /** @class */ (function () {
    function ListLayout(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('ul', { wml: { 'id': __context.values.content.wml.id }, 'id': __context.values.content.id, 'class': __context.values.content.className }, __spreadArrays((__context.children)));
        };
    }
    ListLayout.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    ListLayout.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    ListLayout.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    ListLayout.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    ListLayout.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    ListLayout.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    ListLayout.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    ListLayout.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return ListLayout;
}());
exports.ListLayout = ListLayout;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],120:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.MainLayout = exports.MAIN_LAYOUT = void 0;
var views = require("./wml/main");
var util_1 = require("../../util");
var __1 = require("../");
///classNames:begin
exports.MAIN_LAYOUT = 'ww-main-layout';
/**
 * MainLayout provides a container for the main content of an application.
 */
var MainLayout = /** @class */ (function (_super) {
    __extends(MainLayout, _super);
    function MainLayout() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            content: {
                wml: {
                    id: 'main'
                },
                id: (_this.attrs && _this.attrs.ww) ? _this.attrs.ww.id : '',
                className: util_1.concat(exports.MAIN_LAYOUT, __1.LAYOUT, (_this.attrs && _this.attrs.ww) ?
                    _this.attrs.ww.className : '')
            }
        };
        return _this;
    }
    return MainLayout;
}(__1.AbstractLayout));
exports.MainLayout = MainLayout;

},{"../":117,"../../util":143,"./wml/main":121}],121:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.content.wml.id }, 'id': __context.values.content.id, 'class': __context.values.content.className }, __spreadArrays((__context.children)));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],122:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.MeterBar = exports.Meter = exports.METER_BAR = exports.METER = void 0;
var views = require("./wml/meter");
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
var __1 = require("../../");
///classNames:begin
exports.METER = 'ww-meter';
exports.METER_BAR = 'ww-meter__bar';
/**
 * Meter
 */
var Meter = /** @class */ (function (_super) {
    __extends(Meter, _super);
    function Meter() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Meter(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.METER, __1.getClassName(_this.attrs))
        };
        return _this;
    }
    return Meter;
}(wml_1.Component));
exports.Meter = Meter;
/**
 * MeterBar
 */
var MeterBar = /** @class */ (function (_super) {
    __extends(MeterBar, _super);
    function MeterBar() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.MeterBar(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.METER_BAR, __1.getClassName(_this.attrs)),
            value: (_this.attrs.ww && _this.attrs.ww.value) ?
                _this.attrs.ww.value : 0,
            color: (_this.attrs.ww && _this.attrs.ww.color) ?
                _this.attrs.ww.color : '',
            style: function () {
                var list = [];
                if (_this.values.color)
                    list.push("background-color:" + _this.values.color);
                if (_this.values.value)
                    list.push("width:" + _this.values.value + "%");
                return list.join(';');
            }
        };
        return _this;
    }
    /**
     * setValue sets the value of the MeterBar.
     */
    MeterBar.prototype.setValue = function (value) {
        this.values.value = value;
        this.view.invalidate();
        return this;
    };
    /**
     * increase the value by the specified amount.
     */
    MeterBar.prototype.increase = function (value) {
        this.values.value = this.values.value + value;
        this.view.invalidate();
        return this;
    };
    /**
     * decrease the value by the specified amount.
     */
    MeterBar.prototype.decrease = function (value) {
        this.values.value = this.values.value - value;
        this.view.invalidate();
        return this;
    };
    /**
     * setColor of the MeterBar.
     */
    MeterBar.prototype.setColor = function (color) {
        this.values.color = color;
        this.view.invalidate();
        return this;
    };
    return MeterBar;
}(wml_1.Component));
exports.MeterBar = MeterBar;

},{"../../":104,"../../util":143,"./wml/meter":123,"@quenk/wml":153}],123:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MeterBar = exports.Meter = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Meter = /** @class */ (function () {
    function Meter(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    Meter.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Meter.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Meter.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Meter.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Meter.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Meter.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Meter.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Meter.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Meter;
}());
exports.Meter = Meter;
;
var MeterBar = /** @class */ (function () {
    function MeterBar(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.id, 'class': __context.values.className, 'style': __context.values.style() }, []);
        };
    }
    MeterBar.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    MeterBar.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    MeterBar.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    MeterBar.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    MeterBar.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    MeterBar.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    MeterBar.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    MeterBar.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return MeterBar;
}());
exports.MeterBar = MeterBar;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],124:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.PanelFooter = exports.PanelBody = exports.PanelHeader = exports.Panel = exports.PANEL_FOOTER = exports.PANEL_BODY = exports.PANEL_HEADER = exports.PANEL = void 0;
var style = require("../../content/style");
var views = require("./wml/panel");
var util_1 = require("../../util");
var __1 = require("..");
///classNames:begin
/**
 * PANEL wrapper class.
 */
exports.PANEL = 'ww-panel';
/**
 * PANEL_HEADER class name.
 */
exports.PANEL_HEADER = 'ww-panel__header';
/**
 * PANEL_BODY class name.
 */
exports.PANEL_BODY = 'ww-panel__body';
/**
 * PANEL_FOOTER class name.
 */
exports.PANEL_FOOTER = 'ww-panel__footer';
/**
 * Panel provides a rectangular container for visually seperating
 * content by context.
 */
var Panel = /** @class */ (function (_super) {
    __extends(Panel, _super);
    function Panel() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Panel(_this);
        /**
         * values
         */
        _this.values = {
            /**
             * root values.
             */
            content: {
                id: _this.attrs.ww && _this.attrs.ww.id,
                wml: {
                    id: 'panel',
                },
                className: util_1.concat(exports.PANEL, __1.LAYOUT, (_this.attrs.ww && _this.attrs.ww.style) ?
                    "-" + _this.attrs.ww.style : style.DEFAULT, _this.attrs.ww && _this.attrs.ww.className ?
                    _this.attrs.ww.className : '')
            }
        };
        return _this;
    }
    return Panel;
}(__1.AbstractLayout));
exports.Panel = Panel;
/**
 * PanelHeader
 */
var PanelHeader = /** @class */ (function (_super) {
    __extends(PanelHeader, _super);
    function PanelHeader() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.PanelHeader(_this);
        /**
         * values
         */
        _this.values = {
            content: {
                wml: {
                    id: 'header'
                },
                id: _this.attrs.ww && _this.attrs.ww.id,
                className: util_1.concat(exports.PANEL_HEADER, __1.LAYOUT, _this.attrs.ww && _this.attrs.ww.className ?
                    _this.attrs.ww.className : '')
            }
        };
        return _this;
    }
    return PanelHeader;
}(__1.AbstractLayout));
exports.PanelHeader = PanelHeader;
/**
 * PanelBody
 */
var PanelBody = /** @class */ (function (_super) {
    __extends(PanelBody, _super);
    function PanelBody() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.PanelBody(_this);
        /**
         * values
         */
        _this.values = {
            content: {
                wml: {
                    id: 'body'
                },
                id: _this.attrs.ww && _this.attrs.ww.id,
                className: util_1.concat(exports.PANEL_BODY, __1.LAYOUT, _this.attrs.ww && _this.attrs.ww.className ?
                    _this.attrs.ww.className : '')
            }
        };
        return _this;
    }
    return PanelBody;
}(__1.AbstractLayout));
exports.PanelBody = PanelBody;
/**
 * PanelFooter
 */
var PanelFooter = /** @class */ (function (_super) {
    __extends(PanelFooter, _super);
    function PanelFooter() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.PanelFooter(_this);
        /**
         * values
         */
        _this.values = {
            content: {
                wml: {
                    id: 'footer'
                },
                id: _this.attrs.ww && _this.attrs.ww.id,
                className: util_1.concat(exports.PANEL_FOOTER, __1.LAYOUT, _this.attrs.ww && _this.attrs.ww.className ?
                    _this.attrs.ww.className : '')
            }
        };
        return _this;
    }
    return PanelFooter;
}(__1.AbstractLayout));
exports.PanelFooter = PanelFooter;

},{"..":117,"../../content/style":20,"../../util":143,"./wml/panel":125}],125:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.PanelFooter = exports.PanelBody = exports.PanelHeader = exports.Panel = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Panel = /** @class */ (function () {
    function Panel(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.content.id }, 'class': __context.values.content.className }, __spreadArrays((__context.children)));
        };
    }
    Panel.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Panel.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Panel.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Panel.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Panel.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Panel.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Panel.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Panel.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Panel;
}());
exports.Panel = Panel;
;
var PanelHeader = /** @class */ (function () {
    function PanelHeader(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.content.id }, 'class': __context.values.content.className }, __spreadArrays((__context.children)));
        };
    }
    PanelHeader.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    PanelHeader.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    PanelHeader.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    PanelHeader.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    PanelHeader.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    PanelHeader.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    PanelHeader.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    PanelHeader.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return PanelHeader;
}());
exports.PanelHeader = PanelHeader;
;
var PanelBody = /** @class */ (function () {
    function PanelBody(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.content.id }, 'class': __context.values.content.className }, __spreadArrays((__context.children)));
        };
    }
    PanelBody.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    PanelBody.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    PanelBody.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    PanelBody.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    PanelBody.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    PanelBody.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    PanelBody.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    PanelBody.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return PanelBody;
}());
exports.PanelBody = PanelBody;
;
var PanelFooter = /** @class */ (function () {
    function PanelFooter(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.content.id }, 'class': __context.values.content.className }, __spreadArrays((__context.children)));
        };
    }
    PanelFooter.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    PanelFooter.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    PanelFooter.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    PanelFooter.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    PanelFooter.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    PanelFooter.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    PanelFooter.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    PanelFooter.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return PanelFooter;
}());
exports.PanelFooter = PanelFooter;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],126:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.TabLayout = exports.TAB_LAYOUT = void 0;
var views = require("./wml/tab");
var wml_1 = require("@quenk/wml");
var dom_1 = require("@quenk/wml/lib/dom");
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var util_1 = require("../../util");
var __1 = require("../../");
var __2 = require("../");
///classNames:begin
exports.TAB_LAYOUT = 'ww-tab-layout';
/**
 * TabLayout provides a layout whose displayed content can be changed via tabs.
 *
 * ----------------------------------------------------------------------------
 * |                                                                          |
 * | Tab1  |  Tab2  | Tab2                                                    |
 * |                                                                          |
 * ----------------------------------------------------------------------------
 * |                                                                          |
 * |                                                                          |
 * |                             <Content>                                    |
 * |                                                                          |
 * |                                                                          |
 * |                                                                          |
 * |                                                                          |
 * |__________________________________________________________________________|
 */
var TabLayout = /** @class */ (function (_super) {
    __extends(TabLayout, _super);
    function TabLayout() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: {
                id: __1.getId(_this.attrs),
                className: util_1.concat(exports.TAB_LAYOUT, __2.LAYOUT, __1.getClassName(_this.attrs)),
                content: function () {
                    if ((_this.attrs.ww && _this.attrs.ww.active)) {
                        var maybeActive = maybe_1.fromNullable(_this.values.tabs.data[_this.attrs.ww.active]);
                        if (maybeActive.isJust())
                            return maybeActive
                                .get()
                                .contentFun(_this)(_this.view);
                    }
                    return _this.children;
                }
            },
            tabs: {
                current: (_this.attrs.ww && _this.attrs.ww.active) ?
                    _this.attrs.ww.active : '',
                data: (_this.attrs.ww && _this.attrs.ww.tabs) ?
                    _this.attrs.ww.tabs : {},
                content: function (t) {
                    if (t.tabFun)
                        return t.tabFun(_this)(_this.view);
                    if (t.text)
                        return [dom_1.text(t.text)];
                    return [];
                },
                onClick: function (e) {
                    if (_this.values.tabs.current !== e.name)
                        _this.values.tabs.current = e.name;
                    var tab = maybe_1.fromNullable(_this.values.tabs.data[e.name]).get();
                    _this.values.root.content = function () {
                        return tab.contentFun(_this)(_this.view);
                    };
                    _this.view.invalidate();
                }
            }
        };
        return _this;
    }
    TabLayout.prototype.setContent = function (c) {
        this.values.root.content = function () { return c; };
        this.view.invalidate();
        return this;
    };
    TabLayout.prototype.removeContent = function () {
        this.values.root.content = function () { return []; };
        this.view.invalidate();
        return this;
    };
    return TabLayout;
}(wml_1.Component));
exports.TabLayout = TabLayout;

},{"../":117,"../../":104,"../../util":143,"./wml/tab":127,"@quenk/noni/lib/data/maybe":147,"@quenk/wml":153,"@quenk/wml/lib/dom":152}],127:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var tab_bar_1 = require("../../../control/tab-bar");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.root.id, 'class': __context.values.root.className }, __spreadArrays([
                __this.widget(new tab_bar_1.TabBar({}, __spreadArrays(__forOf(__context.values.tabs.data, function (tab, name, _$$all) {
                    return ([
                        __this.widget(new tab_bar_1.Tab({ ww: { 'name': name, 'active': (__context.values.tabs.current === name), 'onClick': __context.values.tabs.onClick } }, __spreadArrays((__context.values.tabs.content(tab)))), { ww: { 'name': name, 'active': (__context.values.tabs.current === name), 'onClick': __context.values.tabs.onClick } })
                    ]);
                }, function () { return ([]); }))), {})
            ], (__context.values.root.content())));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../control/tab-bar":75,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],128:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.TableLayout = exports.TableWindow = exports.TableCell = exports.TableHeading = exports.TableRow = exports.TableFooter = exports.TableBody = exports.TableHeader = exports.HOVERABLE = exports.ALTERNATE = exports.COMPACT = exports.BORDERED = exports.TABLE_WINDOW = exports.TABLE_LAYOUT = exports.TABLE_CELL = exports.TABLE_HEADING = exports.TABLE_ROW = exports.TABLE_FOOTER = exports.TABLE_BODY = exports.TABLE_HEADER = void 0;
var views = require("./wml/table");
var wml_1 = require("@quenk/wml");
var util_1 = require("../../util");
var __1 = require("../../");
///classNames:begin
exports.TABLE_HEADER = 'ww-table-layout__header';
exports.TABLE_BODY = 'ww-table-layout__body';
exports.TABLE_FOOTER = 'ww-table-layout__footer';
exports.TABLE_ROW = 'ww-table-layout__row';
exports.TABLE_HEADING = 'ww-table-layout _heading';
exports.TABLE_CELL = 'ww-table-layout__cell';
exports.TABLE_LAYOUT = 'ww-table-layout';
exports.TABLE_WINDOW = 'ww-table-window';
exports.BORDERED = '-bordered';
exports.COMPACT = '-compact';
exports.ALTERNATE = '-alternate';
exports.HOVERABLE = '-hoverable';
/**
 * TableHeader (<thead>)
 */
var TableHeader = /** @class */ (function (_super) {
    __extends(TableHeader, _super);
    function TableHeader() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.TableHeader(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.TABLE_HEADER, __1.getClassName(_this.attrs))
        };
        return _this;
    }
    return TableHeader;
}(wml_1.Component));
exports.TableHeader = TableHeader;
/**
 * TableBody
 */
var TableBody = /** @class */ (function (_super) {
    __extends(TableBody, _super);
    function TableBody() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.TableBody(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.TABLE_BODY, __1.getClassName(_this.attrs))
        };
        return _this;
    }
    return TableBody;
}(wml_1.Component));
exports.TableBody = TableBody;
/**
 * TableFooter
 */
var TableFooter = /** @class */ (function (_super) {
    __extends(TableFooter, _super);
    function TableFooter() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.TableFooter(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.TABLE_FOOTER, __1.getClassName(_this.attrs))
        };
        return _this;
    }
    return TableFooter;
}(wml_1.Component));
exports.TableFooter = TableFooter;
/**
 * TableRow
 */
var TableRow = /** @class */ (function (_super) {
    __extends(TableRow, _super);
    function TableRow() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.TableRow(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.TABLE_ROW, __1.getClassName(_this.attrs)),
            onclick: (_this.attrs.ww && _this.attrs.ww.onclick) ?
                _this.attrs.ww.onclick : undefined
        };
        return _this;
    }
    return TableRow;
}(wml_1.Component));
exports.TableRow = TableRow;
/**
 * TableHeading
 */
var TableHeading = /** @class */ (function (_super) {
    __extends(TableHeading, _super);
    function TableHeading() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.TableHeading(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.TABLE_HEADING, __1.getClassName(_this.attrs)),
            onclick: (_this.attrs.ww && _this.attrs.ww.onclick) ?
                _this.attrs.ww.onclick : undefined
        };
        return _this;
    }
    return TableHeading;
}(wml_1.Component));
exports.TableHeading = TableHeading;
/**
 * TableCell
 */
var TableCell = /** @class */ (function (_super) {
    __extends(TableCell, _super);
    function TableCell() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.TableCell(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.TABLE_CELL, __1.getClassName(_this.attrs)),
            colspan: (_this.attrs.ww && _this.attrs.ww.colspan) ?
                _this.attrs.ww.colspan : 1,
            rowspan: (_this.attrs.ww && _this.attrs.ww.rowspan) ?
                _this.attrs.ww.rowspan : 1,
            onclick: (_this.attrs.ww && _this.attrs.ww.onclick) ?
                _this.attrs.ww.onclick : undefined
        };
        return _this;
    }
    return TableCell;
}(wml_1.Component));
exports.TableCell = TableCell;
/**
 * TableWindow allows a TableLayout to be scrolled on smaller screens.
 */
var TableWindow = /** @class */ (function (_super) {
    __extends(TableWindow, _super);
    function TableWindow() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.TableWindow(_this);
        _this.values = {
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.TABLE_WINDOW, __1.getClassName(_this.attrs))
        };
        return _this;
    }
    return TableWindow;
}(wml_1.Component));
exports.TableWindow = TableWindow;
/**
 * TableLayout provides a <table> based layout.
 */
var TableLayout = /** @class */ (function (_super) {
    __extends(TableLayout, _super);
    function TableLayout() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.TableLayout(_this);
        _this.values = {
            wml: {
                id: 'table'
            },
            id: __1.getId(_this.attrs),
            className: util_1.concat(exports.TABLE_LAYOUT, __1.getClassName(_this.attrs), (_this.attrs.ww && _this.attrs.ww.alternate) ? exports.ALTERNATE : '', (_this.attrs.ww && _this.attrs.ww.bordered) ? exports.BORDERED : '', (_this.attrs.ww && _this.attrs.ww.compact) ? exports.COMPACT : '', (_this.attrs.ww && _this.attrs.ww.hoverable) ? exports.HOVERABLE : ''),
        };
        return _this;
    }
    return TableLayout;
}(wml_1.Component));
exports.TableLayout = TableLayout;

},{"../../":104,"../../util":143,"./wml/table":129,"@quenk/wml":153}],129:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.TableLayout = exports.TableWindow = exports.TableCell = exports.TableHeading = exports.TableRow = exports.TableFooter = exports.TableBody = exports.TableHeader = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var TableHeader = /** @class */ (function () {
    function TableHeader(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('thead', { 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    TableHeader.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    TableHeader.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    TableHeader.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    TableHeader.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    TableHeader.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    TableHeader.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    TableHeader.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    TableHeader.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return TableHeader;
}());
exports.TableHeader = TableHeader;
;
var TableBody = /** @class */ (function () {
    function TableBody(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('tbody', { 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    TableBody.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    TableBody.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    TableBody.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    TableBody.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    TableBody.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    TableBody.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    TableBody.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    TableBody.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return TableBody;
}());
exports.TableBody = TableBody;
;
var TableFooter = /** @class */ (function () {
    function TableFooter(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('tfoot', { 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    TableFooter.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    TableFooter.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    TableFooter.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    TableFooter.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    TableFooter.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    TableFooter.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    TableFooter.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    TableFooter.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return TableFooter;
}());
exports.TableFooter = TableFooter;
;
var TableRow = /** @class */ (function () {
    function TableRow(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('tr', { 'id': __context.values.id, 'class': __context.values.className, 'onclick': __context.values.onclick }, __spreadArrays((__context.children)));
        };
    }
    TableRow.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    TableRow.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    TableRow.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    TableRow.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    TableRow.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    TableRow.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    TableRow.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    TableRow.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return TableRow;
}());
exports.TableRow = TableRow;
;
var TableHeading = /** @class */ (function () {
    function TableHeading(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('th', { 'id': __context.values.id, 'class': __context.values.className, 'onclick': __context.values.onclick }, __spreadArrays((__context.children)));
        };
    }
    TableHeading.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    TableHeading.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    TableHeading.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    TableHeading.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    TableHeading.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    TableHeading.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    TableHeading.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    TableHeading.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return TableHeading;
}());
exports.TableHeading = TableHeading;
;
var TableCell = /** @class */ (function () {
    function TableCell(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('td', { 'id': __context.values.id, 'class': __context.values.className, 'colspan': String(__context.values.colspan), 'rowspan': String(__context.values.rowspan), 'onclick': __context.values.onclick }, __spreadArrays((__context.children)));
        };
    }
    TableCell.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    TableCell.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    TableCell.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    TableCell.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    TableCell.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    TableCell.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    TableCell.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    TableCell.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return TableCell;
}());
exports.TableCell = TableCell;
;
var TableWindow = /** @class */ (function () {
    function TableWindow(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    TableWindow.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    TableWindow.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    TableWindow.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    TableWindow.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    TableWindow.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    TableWindow.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    TableWindow.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    TableWindow.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return TableWindow;
}());
exports.TableWindow = TableWindow;
;
var TableLayout = /** @class */ (function () {
    function TableLayout(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('table', { 'id': __context.values.id, 'class': __context.values.className }, __spreadArrays((__context.children)));
        };
    }
    TableLayout.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    TableLayout.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    TableLayout.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    TableLayout.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    TableLayout.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    TableLayout.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    TableLayout.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    TableLayout.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return TableLayout;
}());
exports.TableLayout = TableLayout;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],130:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Well = exports.WELL = void 0;
var util_1 = require("../../util");
var __1 = require("..");
var well_1 = require("./wml/well");
///classNames:begin
exports.WELL = 'ww-well';
/**
 * Well provides a rectangular container for visually seperating
 * content by context.
 */
var Well = /** @class */ (function (_super) {
    __extends(Well, _super);
    function Well() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new well_1.WellView(_this);
        _this.values = {
            /**
             * root values.
             */
            content: {
                id: _this.attrs.ww && _this.attrs.ww.id,
                wml: {
                    id: 'well',
                },
                className: util_1.concat(exports.WELL, __1.LAYOUT, _this.attrs.ww && _this.attrs.ww.className ?
                    _this.attrs.ww.className : '')
            }
        };
        return _this;
    }
    return Well;
}(__1.AbstractLayout));
exports.Well = Well;

},{"..":117,"../../util":143,"./wml/well":131}],131:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.WellView = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var WellView = /** @class */ (function () {
    function WellView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.content.id }, 'class': __context.values.content.className }, __spreadArrays((__context.children)));
        };
    }
    WellView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    WellView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    WellView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    WellView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    WellView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    WellView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    WellView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    WellView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return WellView;
}());
exports.WellView = WellView;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],132:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Drawer = exports.DRAWER_CONTENT = exports.DRAWER = void 0;
var hidden_1 = require("../../content/state/hidden");
var layout_1 = require("../../layout");
var util_1 = require("../../util");
var drawer_1 = require("./wml/drawer");
///classNames:begin
exports.DRAWER = 'ww-drawer';
exports.DRAWER_CONTENT = 'ww-drawer__content';
/**
 * Drawer provides a widget for displaying navigation and other sidebar content.
 *
 * It's api allows for toggling between hidden and shown states as well as
 * querying the current state.
 *
 * This widget's style intentionally gives it a high z-index so that it appears
 * in-front  of other content. Adjust the respective style variables to change.
 */
var Drawer = /** @class */ (function (_super) {
    __extends(Drawer, _super);
    function Drawer() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new drawer_1.Main(_this);
        _this.values = {
            root: {
                id: _this.attrs.ww && _this.attrs.ww.id,
                className: util_1.concat(exports.DRAWER, (_this.attrs.ww && _this.attrs.ww.hidden) ?
                    hidden_1.HIDDEN : ''),
                wml: {
                    id: 'root'
                }
            },
            content: {
                wml: {
                    id: 'content'
                },
                className: exports.DRAWER_CONTENT,
                value: (_this.attrs.ww && _this.attrs.ww.content) ?
                    _this.attrs.ww.content : _this.children
            }
        };
        return _this;
    }
    Drawer.prototype.isHidden = function () {
        return hidden_1.isHidden(this.view, this.values.root.wml.id);
    };
    Drawer.prototype.hide = function () {
        hidden_1.hide(this.view, this.values.root.wml.id);
        return this;
    };
    Drawer.prototype.show = function () {
        hidden_1.show(this.view, this.values.root.wml.id);
        return this;
    };
    Drawer.prototype.toggle = function () {
        hidden_1.toggle(this.view, this.values.root.wml.id);
        return this;
    };
    return Drawer;
}(layout_1.AbstractLayout));
exports.Drawer = Drawer;

},{"../../content/state/hidden":19,"../../layout":117,"../../util":143,"./wml/drawer":133}],133:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('div', { wml: { 'id': __context.values.root.wml.id }, 'id': __context.values.root.id, 'class': __context.values.root.className }, [
                __this.node('div', { wml: { 'id': __context.values.content.wml.id }, 'class': __context.values.content.className }, __spreadArrays((__context.values.content.value)))
            ]);
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],134:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.MenuHeader = exports.MENU_HEADER = void 0;
var wml = require("@quenk/wml");
var views = require("./wml/header");
var util_1 = require("../../util");
///classNames:begin
/**
 * MENU_HEADER
 */
exports.MENU_HEADER = 'ww-menu-header';
/**
 * MenuHeader can be used to display non-clickable heading text in a nav menu.
 */
var MenuHeader = /** @class */ (function (_super) {
    __extends(MenuHeader, _super);
    function MenuHeader() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            span: {
                id: (_this.attrs.ww && _this.attrs.ww.id) ? _this.attrs.ww.id : '',
                className: util_1.concat(exports.MENU_HEADER, (_this.attrs.ww && _this.attrs.ww.className) ?
                    _this.attrs.ww.className : '')
            },
            text: (_this.attrs.ww && _this.attrs.ww.text) ?
                [document.createTextNode(_this.attrs.ww.text)] : _this.children
        };
        return _this;
    }
    return MenuHeader;
}(wml.Component));
exports.MenuHeader = MenuHeader;

},{"../../util":143,"./wml/header":135,"@quenk/wml":153}],135:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('span', { 'id': __context.values.span.id, 'class': __context.values.span.className }, __spreadArrays((__context.values.text)));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],136:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Item = exports.ItemClickedEvent = exports.DIVIDER = exports.ITEM = void 0;
var wml = require("@quenk/wml");
var views = require("./wml/item");
var active_1 = require("../../content/state/active");
var active_2 = require("../../content/state/active");
var util_1 = require("../../util");
///classNames:begin
exports.ITEM = 'ww-menu-item';
exports.DIVIDER = '-divider';
/**
 * ItemClickedEvent is fired when the user clicks on an item in
 * a nav list.
 */
var ItemClickedEvent = /** @class */ (function () {
    function ItemClickedEvent(name) {
        this.name = name;
    }
    return ItemClickedEvent;
}());
exports.ItemClickedEvent = ItemClickedEvent;
/**
 * Item wraps content in a navigation list.
 *
 * Items should not have any siblings that are not other Items.
 */
var Item = /** @class */ (function (_super) {
    __extends(Item, _super);
    function Item() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: {
                wml: {
                    id: 'root'
                },
                id: (_this.attrs.ww && _this.attrs.ww.id) ? _this.attrs.ww.id : '',
                className: util_1.concat(exports.ITEM, (_this.attrs.ww && _this.attrs.ww.active) ? active_2.ACTIVE : '', (_this.attrs.ww && _this.attrs.ww.divider) ? exports.DIVIDER : ''),
                content: {
                    render: function () {
                        if (_this.attrs.ww && _this.attrs.ww.divider)
                            return [];
                        else if (_this.attrs.ww && _this.attrs.ww.text)
                            return [document.createTextNode(_this.attrs.ww.text)];
                        else
                            return _this.children;
                    }
                }
            }
        };
        return _this;
    }
    Item.prototype.activate = function () {
        active_1.activate(this.view, this.values.root.wml.id);
        return this;
    };
    Item.prototype.deactivate = function () {
        active_1.deactivate(this.view, this.values.root.wml.id);
        return this;
    };
    return Item;
}(wml.Component));
exports.Item = Item;

},{"../../content/state/active":17,"../../util":143,"./wml/item":137,"@quenk/wml":153}],137:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('li', { wml: { 'id': __context.values.root.wml.id }, 'id': __context.values.root.id, 'class': __context.values.root.className }, __spreadArrays((__context.values.root.content.render())));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],138:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Menu = exports.HeaderItem = exports.CONTENT_MODE = exports.NAV_MODE = exports.MENU_HEADER_ITEM = exports.MENU = void 0;
var hidden = require("../../content/state/hidden");
var headerViews = require("./wml/header");
var wml_1 = require("@quenk/wml");
var dom_1 = require("@quenk/wml/lib/dom");
var util_1 = require("../../util");
var orientation_1 = require("../../content/orientation");
var __1 = require("../../");
var menu_1 = require("./wml/menu");
///classNames:begin
exports.MENU = 'ww-menu';
exports.MENU_HEADER_ITEM = 'ww-menu__header-item';
///classNames:end
exports.NAV_MODE = 'nav';
exports.CONTENT_MODE = 'content';
/**
 * HeaderItem
 */
var HeaderItem = /** @class */ (function (_super) {
    __extends(HeaderItem, _super);
    function HeaderItem() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new headerViews.Main(_this);
        _this.values = {
            root: {
                className: util_1.concat(exports.MENU_HEADER_ITEM, __1.getClassName(_this.attrs)),
                content: (_this.attrs.ww && _this.attrs.ww.text) ?
                    [dom_1.text(_this.attrs.ww.text)] : _this.children
            }
        };
        return _this;
    }
    return HeaderItem;
}(wml_1.Component));
exports.HeaderItem = HeaderItem;
/**
 * Menu provides a DOM container for rendering
 * a dropdown style menu.
 */
var Menu = /** @class */ (function (_super) {
    __extends(Menu, _super);
    function Menu() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new menu_1.Main(_this);
        _this.values = {
            root: {
                wml: {
                    id: 'root'
                },
                id: __1.getId(_this.attrs),
                className: util_1.concat(exports.MENU, __1.getClassName(_this.attrs), (_this.attrs.ww && _this.attrs.ww.hidden) ? hidden.HIDDEN : '', (_this.attrs.ww && _this.attrs.ww.block) ? orientation_1.BLOCK : '')
            },
            menu: {
                id: 'menu'
            },
            content: function () { return _this.children; }
        };
        return _this;
    }
    Menu.prototype.isHidden = function () {
        return hidden.isHidden(this.view, this.values.root.wml.id);
    };
    Menu.prototype.hide = function () {
        hidden.hide(this.view, this.values.root.wml.id);
        return this;
    };
    Menu.prototype.show = function () {
        hidden.show(this.view, this.values.root.wml.id);
        return this;
    };
    Menu.prototype.toggle = function () {
        hidden.toggle(this.view, this.values.root.wml.id);
        return this;
    };
    Menu.prototype.setContent = function (content) {
        this.values.content = function () { return content; };
        this.view.invalidate();
        this.show();
        return this;
    };
    return Menu;
}(wml_1.Component));
exports.Menu = Menu;

},{"../../":104,"../../content/orientation":13,"../../content/state/hidden":19,"../../util":143,"./wml/header":139,"./wml/menu":140,"@quenk/wml":153,"@quenk/wml/lib/dom":152}],139:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('li', { 'class': __context.values.root.className }, __spreadArrays((__context.values.root.content)));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],140:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('ul', { wml: { 'id': __context.values.root.wml.id }, 'id': __context.values.root.id, 'class': __context.values.root.className }, __spreadArrays((__context.values.content())));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],141:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Nav = exports.NAV = void 0;
var wml = require("@quenk/wml");
var util = require("../../util");
var views = require("./wml/nav");
var orientation_1 = require("../../content/orientation");
var item_1 = require("../item");
Object.defineProperty(exports, "Item", { enumerable: true, get: function () { return item_1.Item; } });
var link_1 = require("../../content/link");
Object.defineProperty(exports, "Link", { enumerable: true, get: function () { return link_1.Link; } });
///classNames:begin
/**
 * NAV
 */
exports.NAV = 'ww-nav';
/**
 * Nav provides styling for displaying a list of anchor links.
 */
var Nav = /** @class */ (function (_super) {
    __extends(Nav, _super);
    function Nav() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            root: {
                id: (_this.attrs.ww && _this.attrs.ww.id) ? _this.attrs.ww.id : '',
                className: util.concat(exports.NAV, (_this.attrs.ww && _this.attrs.ww.className) ?
                    _this.attrs.ww.className : '', (_this.attrs.ww && _this.attrs.ww.vertical) ?
                    orientation_1.VERTICAL : '')
            }
        };
        return _this;
    }
    return Nav;
}(wml.Component));
exports.Nav = Nav;

},{"../../content/link":7,"../../content/orientation":13,"../../util":143,"../item":136,"./wml/nav":142,"@quenk/wml":153}],142:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('ul', { 'id': __context.values.root.id, 'class': __context.values.root.className }, __spreadArrays((__context.children)));
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],143:[function(require,module,exports){
"use strict";
/**
 * This module provides utility functions and constants used
 * through out the wml-widgets module.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.debounce = exports.replaceContent = exports.noop = exports.concat = exports.combine = exports.warnMissing = exports.getById = void 0;
/**
 * getById retreives an WMLElement from a view by its id.
 *
 * If the WMLElement is not found a warning is logged to console.
 */
exports.getById = function (view, id) {
    var m = view.findById(id);
    if (m.isNothing()) {
        exports.warnMissing(view, id);
    }
    return m;
};
/**
 * warn via console that an element is missing.
 */
exports.warnMissing = function (view, id) {
    console.warn('The view ', view, " does not have an id \"" + id + "\"!");
};
/**
 * combine the members of an array into one string.
 */
exports.combine = function (str, joiner) {
    if (joiner === void 0) { joiner = ' '; }
    return str.filter(function (s) { return ((s != null) || s != ''); }).join(joiner);
};
/**
 * concat joins various strings together to form an html class attribute value.
 *
 * Removes empty strings, null and undefined values.
 */
exports.concat = function () {
    var str = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        str[_i] = arguments[_i];
    }
    return str.filter(function (s) { return ((s == null) || (s == '')) ? false : true; })
        .map(function (s) { return s.trim(); }).join(' ');
};
/**
 * noop
 */
exports.noop = function () { };
/**
 * replaceContent
 */
exports.replaceContent = function (r, node) {
    while (node.lastChild)
        node.removeChild(node.lastChild);
    node.appendChild(r.render());
};
/**
 * debounce a function so that it is only called once after
 * a period of time.
 */
exports.debounce = function (f, delay) {
    var timer = -1;
    return delay === 0 ? f : function (a) {
        if (timer === -1) {
            timer = window.setTimeout(function () { return f(a); }, delay);
        }
        else {
            clearTimeout(timer);
            timer = window.setTimeout(function () { return f(a); }, delay);
        }
    };
};

},{}],144:[function(require,module,exports){
(function (process){(function (){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.throttle = exports.debounce = exports.tick = void 0;
/**
 * tick runs a function in the "next tick" using process.nextTick in node
 * or setTimeout(f, 0) elsewhere.
 */
var tick = function (f) { return (typeof window == 'undefined') ?
    setTimeout(f, 0) :
    process.nextTick(f); };
exports.tick = tick;
/**
 * debounce delays the application of a function until the specified time
 * has passed.
 *
 * If multiple attempts to apply the function have occured, then each attempt
 * will restart the delay process. The function will only ever be applied once
 * after the delay, using the value of the final attempt for application.
 */
var debounce = function (f, delay) {
    var id = -1;
    return function (a) {
        if (id === -1) {
            id = setTimeout(function () { return f(a); }, delay);
        }
        else {
            clearTimeout(id);
            id = setTimeout(function () { return f(a); }, delay);
        }
    };
};
exports.debounce = debounce;
/**
 * throttle limits the application of a function to occur only one within the
 * specified duration.
 *
 * The first application will execute immediately subsequent applications
 * will be ignored until the duration has passed.
 */
var throttle = function (f, duration) {
    var wait = false;
    return function (a) {
        if (wait === false) {
            f(a);
            wait = true;
            setTimeout(function () { return wait = false; }, duration);
        }
    };
};
exports.throttle = throttle;

}).call(this)}).call(this,require('_process'))

},{"_process":155}],145:[function(require,module,exports){
"use strict";
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.compact = exports.flatten = exports.combine = exports.make = exports.removeAt = exports.remove = exports.dedupe = exports.distribute = exports.group = exports.partition = exports.concat = exports.flatMap = exports.map = exports.contains = exports.empty = exports.tail = exports.head = void 0;
/**
 * The array module provides helper functions
 * for working with JS arrays.
 */
var record_1 = require("../record");
var math_1 = require("../../math");
/**
 * head returns the item at index 0 of an array
 */
var head = function (list) { return list[0]; };
exports.head = head;
/**
 * tail returns the last item in an array
 */
var tail = function (list) { return list[list.length - 1]; };
exports.tail = tail;
/**
 * empty indicates whether an array is empty or not.
 */
var empty = function (list) { return (list.length === 0); };
exports.empty = empty;
/**
 * contains indicates whether an element exists in an array.
 */
var contains = function (list, a) { return (list.indexOf(a) > -1); };
exports.contains = contains;
/**
 * map is a curried version of the Array#map method.
 */
var map = function (list) { return function (f) { return list.map(f); }; };
exports.map = map;
/**
 * flatMap allows a function to produce a combined set of arrays from a map
 * operation over each member of a list.
 */
var flatMap = function (list, f) {
    return list.reduce(function (p, c, i) { return p.concat(f(c, i, list)); }, []);
};
exports.flatMap = flatMap;
/**
 * concat concatenates elements to the end of an array without flattening
 * if any of the elements are an array.
 *
 * This function also ignores null and undefined.
 */
var concat = function (list) {
    var items = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        items[_i - 1] = arguments[_i];
    }
    return __spreadArray(__spreadArray([], list, true), items.filter(function (item) { return item != null; }), true);
};
exports.concat = concat;
/**
 * partition an array into two using a partitioning function.
 *
 * The first array contains values that return true and the second false.
 */
var partition = function (list, f) { return (0, exports.empty)(list) ?
    [[], []] :
    list.reduce(function (_a, c, i) {
        var yes = _a[0], no = _a[1];
        return (f(c, i, list) ?
            [(0, exports.concat)(yes, c), no] :
            [yes, (0, exports.concat)(no, c)]);
    }, [[], []]); };
exports.partition = partition;
/**
 * group the elements of an array into a Record where each property
 * is an array of elements assigned to it's property name.
 */
var group = function (list, f) {
    return list.reduce(function (p, c, i) {
        var _a;
        var g = f(c, i, list);
        return (0, record_1.merge)(p, (_a = {},
            _a[g] = Array.isArray(p[g]) ?
                (0, exports.concat)(p[g], c) : [c],
            _a));
    }, {});
};
exports.group = group;
/**
 * distribute breaks an array into an array of equally (approximate) sized
 * smaller arrays.
 */
var distribute = function (list, size) {
    var r = list.reduce(function (p, c, i) {
        return (0, math_1.isMultipleOf)(size, i + 1) ?
            [(0, exports.concat)(p[0], (0, exports.concat)(p[1], c)), []] :
            [p[0], (0, exports.concat)(p[1], c)];
    }, [[], []]);
    return (r[1].length === 0) ? r[0] : (0, exports.concat)(r[0], r[1]);
};
exports.distribute = distribute;
/**
 * dedupe an array by filtering out elements
 * that appear twice.
 */
var dedupe = function (list) {
    return list.filter(function (e, i, l) { return l.indexOf(e) === i; });
};
exports.dedupe = dedupe;
/**
 * remove an element from an array returning a new copy with the element
 * removed.
 */
var remove = function (list, target) {
    var idx = list.indexOf(target);
    if (idx === -1) {
        return list.slice();
    }
    else {
        var a = list.slice();
        a.splice(idx, 1);
        return a;
    }
};
exports.remove = remove;
/**
 * removeAt removes an element at the specified index returning a copy
 * of the original array with the element removed.
 */
var removeAt = function (list, idx) {
    if ((list.length > idx) && (idx > -1)) {
        var a = list.slice();
        a.splice(idx, 1);
        return a;
    }
    else {
        return list.slice();
    }
};
exports.removeAt = removeAt;
/**
 * make an array of elements of a given size using a function to provide
 * each element.
 *
 * The function receives the index number for each step.
 */
var make = function (size, f) {
    var a = new Array(size);
    for (var i = 0; i < size; i++)
        a[i] = f(i);
    return a;
};
exports.make = make;
/**
 * combine a list of of lists into one list.
 */
var combine = function (list) {
    return list.reduce(function (p, c) { return p.concat(c); }, []);
};
exports.combine = combine;
/**
 * flatten a list of items that may be multi-dimensional.
 *
 * This function may not be stack safe.
 */
var flatten = function (list) {
    return list.reduce(function (p, c) {
        return p.concat(Array.isArray(c) ? (0, exports.flatten)(c) : c);
    }, []);
};
exports.flatten = flatten;
/**
 * compact removes any occurences of null or undefined in the list.
 */
var compact = function (list) {
    return list.filter(function (v) { return (v != null); });
};
exports.compact = compact;

},{"../../math":151,"../record":148}],146:[function(require,module,exports){
"use strict";
/**
 * Useful functions for sorting data in an array.
 *
 * The functions are expected to be passed to Array#sort.
 * Defaults to ascending order unless specified otherwise.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.natural = exports.number = exports.string = exports.date = void 0;
/**
 * date sorts two strings representing dates.
 *
 * The dates are passed to the date constructor.
 */
var date = function (a, b) {
    var na = new Date(a).getTime();
    var nb = new Date(b).getTime();
    return na > nb ? -1 : na < nb ? 1 : 0;
};
exports.date = date;
/**
 * string sorts two strings by first lower casing them.
 */
var string = function (a, b) {
    var la = String(a).replace(/\s+/, '').toLowerCase();
    var lb = String(b).replace(/\s+/, '').toLowerCase();
    return (la > lb) ? -1 : (la < lb) ? 1 : 0;
};
exports.string = string;
/**
 * number sort
 */
var number = function (a, b) {
    var na = parseFloat(a);
    var nb = parseFloat(b);
    na = (isNaN(a)) ? -Infinity : a;
    nb = (isNaN(b)) ? -Infinity : b;
    return (na > nb) ? -1 : (na < nb) ? 1 : 0;
};
exports.number = number;
/**
 * natural sort impelmentation.
 */
var natural = function (a, b) {
    if (a === void 0) { a = ''; }
    if (b === void 0) { b = ''; }
    var reA = /[^a-zA-Z]/g;
    var reN = /[^0-9]/g;
    var aInt = parseInt(a, 10);
    var bInt = parseInt(b, 10);
    if (isNaN(aInt) && isNaN(bInt)) {
        var aA = String(a).replace(reA, '');
        var bA = String(b).replace(reA, '');
        if (aA === bA) {
            var aN = parseInt(String(a).replace(reN, ''), 10);
            var bN = parseInt(String(b).replace(reN, ''), 10);
            return aN === bN ? 0 : aN > bN ? -1 : 1;
        }
        else {
            return aA > bA ? -1 : 1;
        }
    }
    else if (isNaN(aInt)) { //A is not an Int
        return -1; //to make alphanumeric sort first return -1 here
    }
    else if (isNaN(bInt)) { //B is not an Int
        return 1; //to make alphanumeric sort first return 1 here
    }
    else {
        return aInt > bInt ? -1 : 1;
    }
};
exports.natural = natural;

},{}],147:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.fromNaN = exports.fromNumber = exports.fromBoolean = exports.fromString = exports.fromObject = exports.fromArray = exports.fromNullable = exports.just = exports.nothing = exports.of = exports.Just = exports.Nothing = void 0;
/**
 * Nothing represents the absence of a usable value.
 */
var Nothing = /** @class */ (function () {
    function Nothing() {
    }
    /**
     * map simply returns a Nothing<A>
     */
    Nothing.prototype.map = function (_) {
        return new Nothing();
    };
    /**
     * ap allows for a function wrapped in a Just to apply
     * to value present in this Just.
     */
    Nothing.prototype.ap = function (_) {
        return new Nothing();
    };
    /**
     * of wraps a value in a Just.
     */
    Nothing.prototype.of = function (a) {
        return new Just(a);
    };
    /**
     * chain simply returns a Nothing<A>.
     */
    Nothing.prototype.chain = function (_) {
        return new Nothing();
    };
    /**
     * alt will prefer whatever Maybe instance provided.
     */
    Nothing.prototype.alt = function (a) {
        return a;
    };
    /**
     * empty provides a default Maybe.
     * Maybe.empty() = new Nothing()
     */
    Nothing.prototype.empty = function () {
        return new Nothing();
    };
    /**
     * extend returns a Nothing<A>.
     */
    Nothing.prototype.extend = function (_) {
        return new Nothing();
    };
    /**
     * eq returns true if compared to another Nothing instance.
     */
    Nothing.prototype.eq = function (m) {
        return m instanceof Nothing;
    };
    /**
     * orJust converts a Nothing<A> to a Just
     * using the value from the provided function.
     */
    Nothing.prototype.orJust = function (f) {
        return new Just(f());
    };
    /**
     * orElse allows an alternative Maybe value
     * to be provided since this one is Nothing<A>.
     */
    Nothing.prototype.orElse = function (f) {
        return f();
    };
    Nothing.prototype.isNothing = function () {
        return true;
    };
    Nothing.prototype.isJust = function () {
        return false;
    };
    /**
     * get throws an error because there
     * is nothing here to get.
     */
    Nothing.prototype.get = function () {
        throw new TypeError('Cannot get a value from Nothing!');
    };
    return Nothing;
}());
exports.Nothing = Nothing;
/**
 * Just represents the presence of a usable value.
 */
var Just = /** @class */ (function () {
    function Just(value) {
        this.value = value;
    }
    /**
     * map over the value present in the Just.
     */
    Just.prototype.map = function (f) {
        return new Just(f(this.value));
    };
    /**
     * ap allows for a function wrapped in a Just to apply
     * to value present in this Just.
     */
    Just.prototype.ap = function (mb) {
        var _this = this;
        return mb.map(function (f) { return f(_this.value); });
    };
    /**
     * of wraps a value in a Just.
     */
    Just.prototype.of = function (a) {
        return new Just(a);
    };
    /**
     * chain allows the sequencing of functions that return a Maybe.
     */
    Just.prototype.chain = function (f) {
        return f(this.value);
    };
    /**
     * alt will prefer the first Just encountered (this).
     */
    Just.prototype.alt = function (_) {
        return this;
    };
    /**
     * empty provides a default Maybe.
     * Maybe.empty() = new Nothing()
     */
    Just.prototype.empty = function () {
        return new Nothing();
    };
    /**
     * extend allows sequencing of Maybes with
     * functions that unwrap into non Maybe types.
     */
    Just.prototype.extend = function (f) {
        return new Just(f(this));
    };
    /**
     * eq tests the value of two Justs.
     */
    Just.prototype.eq = function (m) {
        return ((m instanceof Just) && (m.value === this.value));
    };
    /**
     * orJust returns this Just.
     */
    Just.prototype.orJust = function (_) {
        return this;
    };
    /**
     * orElse returns this Just
     */
    Just.prototype.orElse = function (_) {
        return this;
    };
    Just.prototype.isNothing = function () {
        return false;
    };
    Just.prototype.isJust = function () {
        return true;
    };
    /**
     * get the value of this Just.
     */
    Just.prototype.get = function () {
        return this.value;
    };
    return Just;
}());
exports.Just = Just;
/**
 * of
 */
var of = function (a) { return new Just(a); };
exports.of = of;
/**
 * nothing convenience constructor
 */
var nothing = function () { return new Nothing(); };
exports.nothing = nothing;
/**
 * just convenience constructor
 */
var just = function (a) { return new Just(a); };
exports.just = just;
/**
 * fromNullable constructs a Maybe from a value that may be null.
 */
var fromNullable = function (a) { return a == null ?
    new Nothing() : new Just(a); };
exports.fromNullable = fromNullable;
/**
 * fromArray checks an array to see if it's empty
 *
 * Returns [[Nothing]] if it is, [[Just]] otherwise.
 */
var fromArray = function (a) {
    return (a.length === 0) ? new Nothing() : new Just(a);
};
exports.fromArray = fromArray;
/**
 * fromObject uses Object.keys to turn see if an object
 * has any own properties.
 */
var fromObject = function (o) {
    return Object.keys(o).length === 0 ? new Nothing() : new Just(o);
};
exports.fromObject = fromObject;
/**
 * fromString constructs Nothing<A> if the string is empty or Just<A> otherwise.
 */
var fromString = function (s) {
    return (s === '') ? new Nothing() : new Just(s);
};
exports.fromString = fromString;
/**
 * fromBoolean constructs Nothing if b is false, Just<A> otherwise
 */
var fromBoolean = function (b) {
    return (b === false) ? new Nothing() : new Just(b);
};
exports.fromBoolean = fromBoolean;
/**
 * fromNumber constructs Nothing if n is 0 Just<A> otherwise.
 */
var fromNumber = function (n) {
    return (n === 0) ? new Nothing() : new Just(n);
};
exports.fromNumber = fromNumber;
/**
 * fromNaN constructs Nothing if a value is not a number or
 * Just<A> otherwise.
 */
var fromNaN = function (n) {
    return isNaN(n) ? new Nothing() : new Just(n);
};
exports.fromNaN = fromNaN;

},{}],148:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.pickValue = exports.pickKey = exports.make = exports.rcompact = exports.compact = exports.isBadKey = exports.set = exports.every = exports.some = exports.empty = exports.count = exports.clone = exports.hasKey = exports.values = exports.group = exports.partition = exports.exclude = exports.rmerge5 = exports.rmerge4 = exports.rmerge3 = exports.rmerge = exports.merge5 = exports.merge4 = exports.merge3 = exports.merge = exports.filter = exports.reduce = exports.forEach = exports.mapTo = exports.map = exports.keys = exports.isRecord = exports.assign = exports.badKeys = void 0;
/**
 * The record module provides functions for treating ES objects as records.
 *
 * Some of the functions provided here are not type safe and may result in
 * runtime errors if not used carefully.
 */
var array_1 = require("../array");
var type_1 = require("../type");
var maybe_1 = require("../maybe");
/**
 * badKeys is a list of keys we don't want to copy around between objects.
 *
 * Mostly due to prototype pollution but who knows what other keys may become
 * a problem as the language matures.
 */
exports.badKeys = ['__proto__'];
/**
 * assign is an Object.assign polyfill.
 *
 * It is used internally and should probably not be used directly elsewhere.
 */
function assign(target) {
    var _varArgs = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        _varArgs[_i - 1] = arguments[_i];
    }
    var to = Object(target);
    for (var index = 1; index < arguments.length; index++) {
        var nextSource = arguments[index];
        if (nextSource != null)
            for (var nextKey in nextSource)
                // Avoid bugs when hasOwnProperty is shadowed
                if (Object.prototype.hasOwnProperty.call(nextSource, nextKey))
                    (0, exports.set)(to, nextKey, nextSource[nextKey]);
    }
    return to;
}
exports.assign = assign;
/**
 * isRecord tests whether a value is a record.
 *
 * To be a Record, a value must be an object and:
 * 1. must not be null
 * 2. must not be an Array
 * 2. must not be an instance of Date
 * 3. must not be an instance of RegExp
 */
var isRecord = function (value) {
    return (typeof value === 'object') &&
        (value != null) &&
        (!Array.isArray(value)) &&
        (!(value instanceof Date)) &&
        (!(value instanceof RegExp));
};
exports.isRecord = isRecord;
/**
 * keys is an Object.keys shortcut.
 */
var keys = function (obj) { return Object.keys(obj); };
exports.keys = keys;
/**
 * map over a Record's properties producing a new record.
 *
 * The order of keys processed is not guaranteed.
 */
var map = function (rec, f) {
    return (0, exports.keys)(rec)
        .reduce(function (p, k) { return (0, exports.merge)(p, (0, exports.set)({}, k, f(rec[k], k, rec))); }, {});
};
exports.map = map;
/**
 * mapTo an array the properties of the provided Record.
 *
 * The elements of the array are the result of applying the function provided
 * to each property. The order of elements is not guaranteed.
 */
var mapTo = function (rec, f) {
    return (0, exports.keys)(rec).map(function (k) { return f(rec[k], k, rec); });
};
exports.mapTo = mapTo;
/**
 * forEach is similar to map only the result of each function call is not kept.
 *
 * The order of keys processed is not guaranteed.
 */
var forEach = function (rec, f) {
    return (0, exports.keys)(rec).forEach(function (k) { return f(rec[k], k, rec); });
};
exports.forEach = forEach;
/**
 * reduce a Record's keys to a single value.
 *
 * The initial value (accum) must be supplied to avoid errors when
 * there are no properties on the Record. The order of keys processed is
 * not guaranteed.
 */
var reduce = function (rec, accum, f) {
    return (0, exports.keys)(rec).reduce(function (p, k) { return f(p, rec[k], k); }, accum);
};
exports.reduce = reduce;
/**
 * filter the keys of a Record using a filter function.
 */
var filter = function (rec, f) {
    return (0, exports.keys)(rec)
        .reduce(function (p, k) { return f(rec[k], k, rec) ?
        (0, exports.merge)(p, (0, exports.set)({}, k, rec[k])) : p; }, {});
};
exports.filter = filter;
/**
 * merge two objects (shallow) into one new object.
 *
 * The return value's type is the product of the two objects provided.
 */
var merge = function (left, right) { return assign({}, left, right); };
exports.merge = merge;
/**
 * merge3
 */
var merge3 = function (a, b, c) { return assign({}, a, b, c); };
exports.merge3 = merge3;
/**
 * merge4
 */
var merge4 = function (a, b, c, d) {
    return assign({}, a, b, c, d);
};
exports.merge4 = merge4;
/**
 * merge5
 */
var merge5 = function (a, b, c, d, e) {
    return assign({}, a, b, c, d, e);
};
exports.merge5 = merge5;
/**
 * rmerge merges 2 records recursively.
 *
 * This function may violate type safety.
 */
var rmerge = function (left, right) {
    return (0, exports.reduce)(right, left, deepMerge);
};
exports.rmerge = rmerge;
/**
 * rmerge3
 */
var rmerge3 = function (r, s, t) {
    return [s, t]
        .reduce(function (p, c) {
        return (0, exports.reduce)(c, (p), deepMerge);
    }, r);
};
exports.rmerge3 = rmerge3;
/**
 * rmerge4
 */
var rmerge4 = function (r, s, t, u) {
    return [s, t, u]
        .reduce(function (p, c) {
        return (0, exports.reduce)(c, (p), deepMerge);
    }, r);
};
exports.rmerge4 = rmerge4;
/**
 * rmerge5
 */
var rmerge5 = function (r, s, t, u, v) {
    return [s, t, u, v]
        .reduce(function (p, c) {
        return (0, exports.reduce)(c, (p), deepMerge);
    }, r);
};
exports.rmerge5 = rmerge5;
var deepMerge = function (pre, curr, key) {
    return (0, exports.isRecord)(curr) ?
        (0, exports.merge)(pre, (0, exports.set)({}, key, (0, exports.isRecord)(pre[key]) ?
            (0, exports.rmerge)(pre[key], curr) :
            (0, exports.merge)({}, curr))) :
        (0, exports.merge)(pre, (0, exports.set)({}, key, curr));
};
/**
 * exclude removes the specified properties from a Record.
 */
var exclude = function (rec, keys) {
    var list = Array.isArray(keys) ? keys : [keys];
    return (0, exports.reduce)(rec, {}, function (p, c, k) {
        return list.indexOf(k) > -1 ? p : (0, exports.merge)(p, (0, exports.set)({}, k, c));
    });
};
exports.exclude = exclude;
/**
 * partition a Record into two sub-records using a PartitionFunc function.
 *
 * This function produces an array where the first element is a Record
 * of values that return true and the second, false.
 */
var partition = function (r, f) {
    return (0, exports.reduce)(r, [{}, {}], function (_a, c, k) {
        var yes = _a[0], no = _a[1];
        return f(c, k, r) ?
            [(0, exports.merge)(yes, (0, exports.set)({}, k, c)), no] :
            [yes, (0, exports.merge)(no, (0, exports.set)({}, k, c))];
    });
};
exports.partition = partition;
/**
 * group the properties of a Record into another Record using a GroupFunc
 * function.
 */
var group = function (rec, f) {
    return (0, exports.reduce)(rec, {}, function (prev, curr, key) {
        var category = f(curr, key, rec);
        var value = (0, exports.isRecord)(prev[category]) ?
            (0, exports.merge)(prev[category], (0, exports.set)({}, key, curr)) :
            (0, exports.set)({}, key, curr);
        return (0, exports.merge)(prev, (0, exports.set)({}, category, value));
    });
};
exports.group = group;
/**
 * values returns a shallow array of the values of a record.
 */
var values = function (r) {
    return (0, exports.reduce)(r, [], function (p, c) { return (0, array_1.concat)(p, c); });
};
exports.values = values;
/**
 * hasKey indicates whether a Record has a given key.
 */
var hasKey = function (r, key) {
    return Object.hasOwnProperty.call(r, key);
};
exports.hasKey = hasKey;
/**
 * clone a Record.
 *
 * Breaks references and deep clones arrays.
 * This function should only be used on Records or objects that
 * are not class instances. This function may violate type safety.
 */
var clone = function (r) {
    return (0, exports.reduce)(r, {}, function (p, c, k) { (0, exports.set)(p, k, _clone(c)); return p; });
};
exports.clone = clone;
var _clone = function (a) {
    if ((0, type_1.isArray)(a))
        return a.map(_clone);
    else if ((0, exports.isRecord)(a))
        return (0, exports.clone)(a);
    else
        return a;
};
/**
 * count how many properties exist on the record.
 */
var count = function (r) { return (0, exports.keys)(r).length; };
exports.count = count;
/**
 * empty tests whether the object has any properties or not.
 */
var empty = function (r) { return (0, exports.count)(r) === 0; };
exports.empty = empty;
/**
 * some tests whether at least one property of a Record passes the
 * test implemented by the provided function.
 */
var some = function (o, f) {
    return (0, exports.keys)(o).some(function (k) { return f(o[k], k, o); });
};
exports.some = some;
/**
 * every tests whether each property of a Record passes the
 * test implemented by the provided function.
 */
var every = function (o, f) {
    return (0, exports.keys)(o).every(function (k) { return f(o[k], k, o); });
};
exports.every = every;
/**
 * set the value of a key on a Record ignoring problematic keys.
 *
 * This function exists to avoid unintentionally setting problem keys such
 * as __proto__ on an object.
 *
 * Even though this function mutates the provided record, it should be used
 * as though it does not.
 *
 * Don't:
 * set(obj, key, value);
 *
 * Do:
 * obj = set(obj, key, value);
 */
var set = function (r, k, value) {
    if (!(0, exports.isBadKey)(k))
        r[k] = value;
    return r;
};
exports.set = set;
/**
 * isBadKey tests whether a key is problematic (Like __proto__).
 */
var isBadKey = function (key) {
    return exports.badKeys.indexOf(key) !== -1;
};
exports.isBadKey = isBadKey;
/**
 * compact a Record by removing any properties that == null.
 */
var compact = function (rec) {
    var result = {};
    for (var key in rec)
        if (rec.hasOwnProperty(key))
            if (rec[key] != null)
                result = (0, exports.set)(result, key, rec[key]);
    return result;
};
exports.compact = compact;
/**
 * rcompact recursively compacts a Record.
 */
var rcompact = function (rec) {
    return (0, exports.compact)((0, exports.map)(rec, function (val) { return (0, exports.isRecord)(val) ? (0, exports.rcompact)(val) : val; }));
};
exports.rcompact = rcompact;
/**
 * make creates a new instance of a Record optionally using the provided
 * value as an initializer.
 *
 * This function is intended to assist with curbing prototype pollution by
 * configuring a setter for __proto__ that ignores changes.
 */
var make = function (init) {
    if (init === void 0) { init = {}; }
    var rec = {};
    Object.defineProperty(rec, '__proto__', {
        configurable: false,
        enumerable: false,
        set: function () { }
    });
    for (var key in init)
        if (init.hasOwnProperty(key))
            rec[key] = init[key];
    return rec;
};
exports.make = make;
/**
 * pickKey selects the value of the first property in a Record that passes the
 * provided test.
 */
var pickKey = function (rec, test) {
    return (0, exports.reduce)(rec, (0, maybe_1.nothing)(), function (p, c, k) {
        return p.isJust() ? p : test(c, k, rec) ? (0, maybe_1.just)(k) : p;
    });
};
exports.pickKey = pickKey;
/**
 * pickValue selects the value of the first property in a Record that passes the
 * provided test.
 */
var pickValue = function (rec, test) {
    return (0, exports.reduce)(rec, (0, maybe_1.nothing)(), function (p, c, k) {
        return p.isJust() ? p : test(c, k, rec) ? (0, maybe_1.just)(c) : p;
    });
};
exports.pickValue = pickValue;

},{"../array":145,"../maybe":147,"../type":150}],149:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.project = exports.unflatten = exports.flatten = exports.unescapeRecord = exports.escapeRecord = exports.unescape = exports.escape = exports.set = exports.getString = exports.getDefault = exports.get = exports.unsafeGet = exports.tokenize = void 0;
/**
 * This module provides a syntax and associated functions for
 * getting and setting values on ES objects easily.
 *
 * Given a path, a value can either be retrieved or set on an object.
 *
 * The path syntax follows typical ES dot notation, bracket notation or a mixture
 * of both.
 *
 * Note that quotes are not used when describing a path via bracket notation.
 *
 * If you need to use a dot or square brackets in your paths, prefix them with
 * the "\" (backslash) character.
 */
/** imports **/
var maybe_1 = require("../maybe");
var _1 = require("./");
var TOKEN_DOT = '.';
var TOKEN_BRACKET_LEFT = '[';
var TOKEN_BRACKET_RIGHT = ']';
var TOKEN_ESCAPE = '\\';
/**
 * tokenize a path into a list of sequential property names.
 */
var tokenize = function (str) {
    var i = 0;
    var buf = '';
    var curr = '';
    var next = '';
    var tokens = [];
    while (i < str.length) {
        curr = str[i];
        next = str[i + 1];
        if (curr === TOKEN_ESCAPE) {
            //escape sequence
            buf = "" + buf + next;
            i++;
        }
        else if (curr === TOKEN_DOT) {
            if (buf !== '')
                tokens.push(buf); //recognize a path and push a new token
            buf = '';
        }
        else if ((curr === TOKEN_BRACKET_LEFT) &&
            next === TOKEN_BRACKET_RIGHT) {
            //intercept empty bracket paths
            i++;
        }
        else if (curr === TOKEN_BRACKET_LEFT) {
            var bracketBuf = '';
            var firstDot = -1;
            var firstDotBuf = '';
            i++;
            while (true) {
                //everything between brackets is treated as a path
                //if no closing bracket is found, we back track to the first dot
                //if there is no dot the whole buffer is treated as a path
                curr = str[i];
                next = str[i + 1];
                if ((curr === TOKEN_BRACKET_RIGHT) &&
                    (next === TOKEN_BRACKET_RIGHT)) {
                    //escaped right bracket
                    bracketBuf = "" + bracketBuf + TOKEN_BRACKET_RIGHT;
                    i++;
                }
                else if (curr === TOKEN_BRACKET_RIGHT) {
                    //successfully tokenized the path
                    if (buf !== '')
                        tokens.push(buf); //save the previous path
                    tokens.push(bracketBuf); //save the current path
                    buf = '';
                    break;
                }
                else if (curr == null) {
                    //no closing bracket found and we ran out of string to search
                    if (firstDot !== -1) {
                        //backtrack to the first dot encountered
                        i = firstDot;
                        //save the paths so far
                        tokens.push("" + buf + TOKEN_BRACKET_LEFT + firstDotBuf);
                        buf = '';
                        break;
                    }
                    else {
                        //else if no dots were found treat the current buffer
                        // and rest of the string as part of one path.
                        buf = "" + buf + TOKEN_BRACKET_LEFT + bracketBuf;
                        break;
                    }
                }
                if ((curr === TOKEN_DOT) && (firstDot === -1)) {
                    //take note of the location and tokens between 
                    //the opening bracket and first dot.
                    //If there is no closing bracket, we use this info to
                    //lex properly.
                    firstDot = i;
                    firstDotBuf = bracketBuf;
                }
                bracketBuf = "" + bracketBuf + curr;
                i++;
            }
        }
        else {
            buf = "" + buf + curr;
        }
        i++;
    }
    if ((buf.length > 0))
        tokens.push(buf);
    return tokens;
};
exports.tokenize = tokenize;
/**
 * unsafeGet retrieves a value at the specified path
 * on any ES object.
 *
 * This function does not check if getting the value succeeded or not.
 */
var unsafeGet = function (path, src) {
    if (src == null)
        return undefined;
    var toks = (0, exports.tokenize)(path);
    var head = src[toks.shift()];
    return toks.reduce(function (p, c) { return (p == null) ? p : p[c]; }, head);
};
exports.unsafeGet = unsafeGet;
/**
 * get a value from a Record given its path safely.
 */
var get = function (path, src) {
    return (0, maybe_1.fromNullable)((0, exports.unsafeGet)(path, src));
};
exports.get = get;
/**
 * getDefault is like get but takes a default value to return if
 * the path is not found.
 */
var getDefault = function (path, src, def) {
    return (0, exports.get)(path, src).orJust(function () { return def; }).get();
};
exports.getDefault = getDefault;
/**
 * getString casts the resulting value to a string.
 *
 * An empty string is provided if the path is not found.
 */
var getString = function (path, src) {
    return (0, exports.get)(path, src).map(function (v) { return String(v); }).orJust(function () { return ''; }).get();
};
exports.getString = getString;
/**
 * set sets a value on an object given a path.
 */
var set = function (p, v, r) {
    var toks = (0, exports.tokenize)(p);
    return _set(r, v, toks);
};
exports.set = set;
var _set = function (r, value, toks) {
    var o;
    if (toks.length === 0)
        return value;
    o = (0, _1.isRecord)(r) ? (0, _1.clone)(r) : {};
    o = (0, _1.set)(o, toks[0], _set(o[toks[0]], value, toks.slice(1)));
    return o;
};
/**
 * escape a path so that occurences of dots are not interpreted as paths.
 *
 * This function escapes dots and dots only.
 */
var escape = function (p) {
    var i = 0;
    var buf = '';
    var curr = '';
    while (i < p.length) {
        curr = p[i];
        if ((curr === TOKEN_ESCAPE) || (curr === TOKEN_DOT))
            buf = "" + buf + TOKEN_ESCAPE + curr;
        else
            buf = "" + buf + curr;
        i++;
    }
    return buf;
};
exports.escape = escape;
/**
 * unescape a path that has been previously escaped.
 */
var unescape = function (p) {
    var i = 0;
    var curr = '';
    var next = '';
    var buf = '';
    while (i < p.length) {
        curr = p[i];
        next = p[i + 1];
        if (curr === TOKEN_ESCAPE) {
            buf = "" + buf + next;
            i++;
        }
        else {
            buf = "" + buf + curr;
        }
        i++;
    }
    return buf;
};
exports.unescape = unescape;
/**
 * escapeRecord escapes each property of a record recursively.
 */
var escapeRecord = function (r) {
    return (0, _1.reduce)(r, {}, function (p, c, k) {
        if (typeof c === 'object')
            p = (0, _1.set)(p, (0, exports.escape)(k), (0, exports.escapeRecord)(c));
        else
            p = (0, _1.set)(p, (0, exports.escape)(k), c);
        return p;
    });
};
exports.escapeRecord = escapeRecord;
/**
 * unescapeRecord unescapes each property of a record recursively.
 */
var unescapeRecord = function (r) {
    return (0, _1.reduce)(r, {}, function (p, c, k) {
        if ((0, _1.isRecord)(c))
            p = (0, _1.set)(p, (0, exports.unescape)(k), (0, exports.unescapeRecord)(c));
        else
            p = (0, _1.set)(p, (0, exports.unescape)(k), c);
        return p;
    });
};
exports.unescapeRecord = unescapeRecord;
/**
 * flatten an object into a Record where each key is a path to a non-complex
 * value or array.
 *
 * If any of the paths contain dots, they will be escaped.
 */
var flatten = function (r) {
    return (flatImpl('')({})(r));
};
exports.flatten = flatten;
var flatImpl = function (pfix) { return function (prev) {
    return function (r) {
        return (0, _1.reduce)(r, prev, function (p, c, k) { return (0, _1.isRecord)(c) ?
            (flatImpl(prefix(pfix, k))(p)(c)) :
            (0, _1.merge)(p, (0, _1.set)({}, prefix(pfix, k), c)); });
    };
}; };
var prefix = function (pfix, key) { return (pfix === '') ?
    (0, exports.escape)(key) : pfix + "." + (0, exports.escape)(key); };
/**
 * unflatten a flattened Record so that any nested paths are expanded
 * to their full representation.
 */
var unflatten = function (r) {
    return (0, _1.reduce)(r, {}, function (p, c, k) { return (0, exports.set)(k, c, p); });
};
exports.unflatten = unflatten;
/**
 * project a Record according to the field specification given.
 *
 * Only properties that appear in the spec and set to true will be retained.
 * This function may violate type safety and may leave undefined holes in the
 * result.
 */
var project = function (spec, rec) {
    return (0, _1.reduce)(spec, {}, function (p, c, k) {
        return (c === true) ? (0, exports.set)(k, (0, exports.unsafeGet)(k, rec), p) : p;
    });
};
exports.project = project;

},{"../maybe":147,"./":148}],150:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.toString = exports.show = exports.test = exports.is = exports.isPrim = exports.isFunction = exports.isBoolean = exports.isNumber = exports.isString = exports.isArray = exports.isObject = exports.Any = void 0;
var prims = ['string', 'number', 'boolean'];
/**
 * Any is a class used to represent typescript's "any" type.
 */
var Any = /** @class */ (function () {
    function Any() {
    }
    return Any;
}());
exports.Any = Any;
/**
 * isObject test.
 *
 * Does not consider an Array an object.
 */
var isObject = function (value) {
    return (typeof value === 'object') && (!(0, exports.isArray)(value));
};
exports.isObject = isObject;
/**
 * isArray test.
 */
exports.isArray = Array.isArray;
/**
 * isString test.
 */
var isString = function (value) {
    return typeof value === 'string';
};
exports.isString = isString;
/**
 * isNumber test.
 */
var isNumber = function (value) {
    return (typeof value === 'number') && (!isNaN(value));
};
exports.isNumber = isNumber;
/**
 * isBoolean test.
 */
var isBoolean = function (value) {
    return typeof value === 'boolean';
};
exports.isBoolean = isBoolean;
/**
 * isFunction test.
 */
var isFunction = function (value) {
    return typeof value === 'function';
};
exports.isFunction = isFunction;
/**
 * isPrim test.
 */
var isPrim = function (value) {
    return !((0, exports.isObject)(value) ||
        (0, exports.isArray)(value) ||
        (0, exports.isFunction)(value));
};
exports.isPrim = isPrim;
/**
 * is performs a typeof of check on a type.
 */
var is = function (expected) { return function (value) {
    return typeof (value) === expected;
}; };
exports.is = is;
/**
 * test whether a value conforms to some pattern.
 *
 * This function is made available mainly for a crude pattern matching
 * machinery that works as followss:
 * string   -> Matches on the value of the string.
 * number   -> Matches on the value of the number.
 * boolean  -> Matches on the value of the boolean.
 * object   -> Each key of the object is matched on the value, all must match.
 * function -> Treated as a constructor and results in an instanceof check or
 *             for String,Number and Boolean, this uses the typeof check. If
 *             the function is RegExp then we uses the RegExp.test function
 *             instead.
 */
var test = function (value, t) {
    if ((prims.indexOf(typeof t) > -1) && (value === t))
        return true;
    else if ((typeof t === 'function') &&
        (((t === String) && (typeof value === 'string')) ||
            ((t === Number) && (typeof value === 'number')) ||
            ((t === Boolean) && (typeof value === 'boolean')) ||
            ((t === Array) && (Array.isArray(value))) ||
            (t === Any) ||
            (value instanceof t)))
        return true;
    else if ((t instanceof RegExp) &&
        ((typeof value === 'string') &&
            t.test(value)))
        return true;
    else if ((typeof t === 'object') && (typeof value === 'object'))
        return Object
            .keys(t)
            .every(function (k) { return Object.hasOwnProperty.call(value, k) ?
            (0, exports.test)(value[k], t[k]) : false; });
    return false;
};
exports.test = test;
/**
 * show the type of a value.
 *
 * Note: This may crash if the value is an
 * object literal with recursive references.
 */
var show = function (value) {
    if (typeof value === 'object') {
        if (Array.isArray(value))
            return "[" + value.map(exports.show) + "];";
        else if (value.constructor !== Object)
            return (value.constructor.name ||
                value.constructor);
        else
            return JSON.stringify(value);
    }
    else {
        return '' + value;
    }
};
exports.show = show;
/**
 * toString casts a value to a string.
 *
 * If the value is null or undefined an empty string is returned instead of
 * the default.
 */
var toString = function (val) {
    return (val == null) ? '' : String(val);
};
exports.toString = toString;

},{}],151:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.round = exports.isMultipleOf = void 0;
/**
 * isMultipleOf tests whether the Integer 'y' is a multiple of x.
 */
var isMultipleOf = function (x, y) { return ((y % x) === 0); };
exports.isMultipleOf = isMultipleOf;
/**
 * round a number "x" to "n" places (n defaults to 0 places).
 *
 * This uses the Math.round(x * n) / n method however we take into
 * consideration the Math.round(1.005 * 100) / 100 === 1 issue by use of an
 * offset:
 *
 * sign * (round((abs(x) * 10^n) + (1 / 10^n+1)) / 10^n)
 *
 * Where:
 *
 * sign is the sign of x
 * round is Math.round
 * abs is Math.abs
 * (1 / 10^n+1) is the offset.
 *
 * The offset is only used if n is more than zero. The absolute value of x
 * is used in the calculation to avoid JavaScript idiosyncracies when rounding
 * 0.5:
 * (Math.round((1.005 * 100)+0.001) / 100) === 1.01
 *
 * whereas
 * (Math.round((-1.005 * 100)+0.001) / 100) === -1
 *
 * See the description [here]( https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/round)
 * for more details.
 *
 */
var round = function (x, n) {
    if (n === void 0) { n = 0; }
    var exp = Math.pow(10, n);
    var sign = x >= 0 ? 1 : -1;
    var offset = (n > 0) ? (1 / (Math.pow(10, n + 1))) : 0;
    return sign * (Math.round((Math.abs(x) * exp) + offset) / exp);
};
exports.round = round;

},{}],152:[function(require,module,exports){
(function (global){(function (){
"use strict";
/**
 * This module provides functions used in templates to generate supported DOM
 * nodes.
 *
 * The idea here is to provide an abstraction over DOM construction so
 * we can detect whether we are in a browser or elsewhere and adjust to
 * suite.
 */
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.createElement = exports.unsafe = exports.text = exports.createUnsafeTextNode = exports.createTextNode = exports.escapeHTML = exports.escapeAttrValue = exports.escapeAttrs = exports.isBrowser = exports.WMLDOMElement = exports.WMLDOMText = exports.WMLDOMNode = exports.WMLNodeList = void 0;
var record_1 = require("@quenk/noni/lib/data/record");
var type_1 = require("@quenk/noni/lib/data/type");
// Declared so isBrowser works on node.js.
var window = global;
var document = global.document;
var DOCTYPE = '<!DOCTYPE html>';
var ATTR_ESC_MAP = {
    '&': '\\u0026',
    '>': '\\u003e',
    '<': '\\u003c',
    '"': '\\u0022',
    '=': '\\u003d',
    '\u005c': '\\u005c',
    '\u2028': '\\u2028',
    '\u2029': '\\u2029'
};
var attrsEscRegex = new RegExp("[" + record_1.mapTo(ATTR_ESC_MAP, function (_, k) { return k; }) + "]", 'g');
var HTML_ENT_MAP = {
    '"': '&quot;',
    '&': '&amp;',
    '\'': '&apos;',
    '<': '&lt;',
    '>': '&gt;'
};
var htmlEscRegex = new RegExp("[" + record_1.mapTo(HTML_ENT_MAP, function (_, k) { return k; }) + "]", 'g');
var voidElements = [
    'area',
    'base',
    'br',
    'col',
    'command',
    'embed',
    'hr',
    'img',
    'input',
    'keygen',
    'link',
    'meta',
    'param',
    'source',
    'track',
    'wbr'
];
/**
 * WMLNodeList implementation.
 * @private
 */
var WMLNodeList = /** @class */ (function () {
    function WMLNodeList() {
        this.length = 0;
    }
    WMLNodeList.prototype.item = function () {
        return null;
    };
    WMLNodeList.prototype.forEach = function () { };
    return WMLNodeList;
}());
exports.WMLNodeList = WMLNodeList;
/**
 * WMLDOMNode implements the properties and methods of the DOM Node interface to
 * allow a fake DOM to be built in server side code.
 *
 * Most of the methods and properties cannot be relied on and should not be
 * used.
 */
var WMLDOMNode = /** @class */ (function () {
    function WMLDOMNode(nodeName, nodeType) {
        this.nodeName = nodeName;
        this.nodeType = nodeType;
        this.ATTRIBUTE_NODE = -1;
        this.CDATA_SECTION_NODE = -1;
        this.COMMENT_NODE = -1;
        this.DOCUMENT_FRAGMENT_NODE = -1;
        this.DOCUMENT_NODE = -1;
        this.DOCUMENT_POSITION_CONTAINED_BY = -1;
        this.DOCUMENT_POSITION_CONTAINS = -1;
        this.DOCUMENT_POSITION_DISCONNECTED = -1;
        this.DOCUMENT_POSITION_FOLLOWING = -1;
        this.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC = -1;
        this.DOCUMENT_POSITION_PRECEDING = -1;
        this.DOCUMENT_TYPE_NODE = -1;
        this.ELEMENT_NODE = -1;
        this.ENTITY_NODE = -1;
        this.ENTITY_REFERENCE_NODE = -1;
        this.NOTATION_NODE = -1;
        this.PROCESSING_INSTRUCTION_NODE = -1;
        this.TEXT_NODE = -1;
        this.baseURI = '';
        this.childNodes = new WMLNodeList();
        this.firstChild = null;
        this.isConnected = false;
        this.lastChild = null;
        this.namespaceURI = null;
        this.nextSibling = null;
        this.nodeValue = null;
        this.ownerDocument = null;
        this.parentElement = null;
        this.parentNode = null;
        this.previousSibling = null;
    }
    Object.defineProperty(WMLDOMNode.prototype, "textContent", {
        get: function () {
            return '';
        },
        enumerable: false,
        configurable: true
    });
    WMLDOMNode.prototype.addEventListener = function () { };
    WMLDOMNode.prototype.dispatchEvent = function () {
        return false;
    };
    WMLDOMNode.prototype.removeEventListener = function () { };
    WMLDOMNode.prototype.appendChild = function (newChild) {
        return newChild;
    };
    WMLDOMNode.prototype.cloneNode = function () {
        return this;
    };
    WMLDOMNode.prototype.compareDocumentPosition = function () {
        return 0;
    };
    WMLDOMNode.prototype.contains = function () {
        return false;
    };
    WMLDOMNode.prototype.getRootNode = function () {
        return this;
    };
    WMLDOMNode.prototype.hasChildNodes = function () {
        return false;
    };
    WMLDOMNode.prototype.insertBefore = function (newChild) {
        return newChild;
    };
    WMLDOMNode.prototype.isDefaultNamespace = function () {
        return false;
    };
    WMLDOMNode.prototype.isEqualNode = function () {
        return false;
    };
    WMLDOMNode.prototype.isSameNode = function () {
        return false;
    };
    WMLDOMNode.prototype.lookupNamespaceURI = function () {
        return null;
    };
    WMLDOMNode.prototype.lookupPrefix = function () {
        return null;
    };
    WMLDOMNode.prototype.normalize = function () { };
    WMLDOMNode.prototype.remove = function () { };
    WMLDOMNode.prototype.before = function () { };
    WMLDOMNode.prototype.after = function () { };
    WMLDOMNode.prototype.replaceWith = function () { };
    WMLDOMNode.prototype.removeChild = function (oldChild) {
        return oldChild;
    };
    WMLDOMNode.prototype.replaceChild = function (_, oldChild) {
        return oldChild;
    };
    return WMLDOMNode;
}());
exports.WMLDOMNode = WMLDOMNode;
/**
 * WMLDOMText is used to represent Text nodes on the server side.
 * @private
 */
var WMLDOMText = /** @class */ (function (_super) {
    __extends(WMLDOMText, _super);
    function WMLDOMText(value, escape) {
        if (escape === void 0) { escape = true; }
        var _this = _super.call(this, '#text', -1) || this;
        _this.value = value;
        _this.escape = escape;
        return _this;
    }
    Object.defineProperty(WMLDOMText.prototype, "textContent", {
        get: function () {
            return this.escape ? exports.escapeHTML(this.value) : this.value;
        },
        enumerable: false,
        configurable: true
    });
    return WMLDOMText;
}(WMLDOMNode));
exports.WMLDOMText = WMLDOMText;
/**
 * WMLDOMElement is used to represent Element nodes on the server side.
 * @private
 */
var WMLDOMElement = /** @class */ (function (_super) {
    __extends(WMLDOMElement, _super);
    function WMLDOMElement(tag, attrs, children) {
        if (children === void 0) { children = []; }
        var _this = _super.call(this, tag, -1) || this;
        _this.tag = tag;
        _this.attrs = attrs;
        _this.children = children;
        return _this;
    }
    Object.defineProperty(WMLDOMElement.prototype, "innerHTML", {
        get: function () {
            return this.children.map(function (c) { return (c.nodeName === '#text') ?
                c.textContent :
                c.outerHTML; }).join('');
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(WMLDOMElement.prototype, "outerHTML", {
        get: function () {
            var tag = this.tag;
            var content = this.innerHTML;
            var attrs = record_1.mapTo(exports.escapeAttrs(this.attrs), function (value, name) { return !value ?
                name : name + "=\"" + value + "\""; }).join(' ');
            attrs = (attrs.trim() != '') ? " " + attrs : '';
            var open = "<" + tag + attrs + ">";
            if (tag === "html")
                open = "" + DOCTYPE + open;
            return (voidElements.indexOf(tag) > -1) ?
                open : "" + open + content + "</" + tag + ">";
        },
        enumerable: false,
        configurable: true
    });
    WMLDOMElement.prototype.setAttribute = function (key, value) {
        this.attrs[key] = value;
    };
    WMLDOMElement.prototype.appendChild = function (newChild) {
        this.children.push(newChild);
        return newChild;
    };
    return WMLDOMElement;
}(WMLDOMNode));
exports.WMLDOMElement = WMLDOMElement;
/**
 * isBrowser is set to true if we detect a window and document global variable.
 */
exports.isBrowser = ((window != null) && (document != null));
/**
 * escapeAttrs escapes each key value pair of a WMLDOMAttrs.
 */
var escapeAttrs = function (attrs) { return record_1.map(attrs, function (value) {
    return type_1.isFunction(value) ? value :
        (value instanceof WMLDOMText) ? value.textContent :
            exports.escapeAttrValue(String(value));
}); };
exports.escapeAttrs = escapeAttrs;
/**
 * escapeAttrValue for safe browser display.
 */
var escapeAttrValue = function (value) {
    return value.replace(attrsEscRegex, function (hit) { return ATTR_ESC_MAP[hit]; });
};
exports.escapeAttrValue = escapeAttrValue;
/**
 * escapeHTML for safe browser display.
 */
var escapeHTML = function (value) {
    return value.replace(htmlEscRegex, function (hit) { return HTML_ENT_MAP[hit]; });
};
exports.escapeHTML = escapeHTML;
/**
 * createTextNode wrapper.
 */
var createTextNode = function (txt) {
    var str = String((txt == null) ? '' : txt);
    return exports.isBrowser ? document.createTextNode(str) : new WMLDOMText(str);
};
exports.createTextNode = createTextNode;
exports.text = exports.createTextNode;
/**
 * createUnsafeTextNode allows raw strings to be output without escaping.
 *
 * This only works on the server side.
 */
var createUnsafeTextNode = function (txt) {
    var str = String((txt == null) ? '' : txt);
    return exports.isBrowser ? document.createTextNode(str) : new WMLDOMText(str, false);
};
exports.createUnsafeTextNode = createUnsafeTextNode;
exports.unsafe = exports.createUnsafeTextNode;
/**
 * createElement wrapper.
 */
var createElement = function (tag, attrs, children) {
    if (attrs === void 0) { attrs = {}; }
    if (children === void 0) { children = []; }
    if (!exports.isBrowser) {
        // XXX: The whole Element interface is not implemented but on server
        // side we are only interested in setAttribute.
        return new WMLDOMElement(tag, attrs, children);
    }
    else {
        var e_1 = document.createElement(tag);
        record_1.forEach(attrs, function (value, key) {
            if (typeof value === 'function') {
                e_1[key] = value;
            }
            else if (typeof value === 'string') {
                // prevent setting things like disabled=""
                if (value !== '')
                    e_1.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e_1.setAttribute(key, '');
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    e_1.appendChild(document.createTextNode('' + c));
                case 'object':
                    e_1.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        return e_1;
    }
};
exports.createElement = createElement;

}).call(this)}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"@quenk/noni/lib/data/record":148,"@quenk/noni/lib/data/type":150}],153:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.renderAsNode = exports.Component = void 0;
/**
 * Component is an abstract Widget implementation
 * that can be used instead of manually implementing the whole interface.
 */
var Component = /** @class */ (function () {
    /**
     * @param {A} attrs is the attributes this Component excepts.
     * @param {Content[]} children is an array of content for Component.
     */
    function Component(attrs, children) {
        this.attrs = attrs;
        this.children = children;
    }
    Component.prototype.rendered = function () { };
    Component.prototype.removed = function () { };
    Component.prototype.render = function () { return this.view.render(); };
    return Component;
}());
exports.Component = Component;
;
/**
 * renderAsNode content from a Renderable.
 *
 * This function unsafely assumes the Renderable always returns DOM content.
 */
var renderAsNode = function (r) {
    return r.render();
};
exports.renderAsNode = renderAsNode;

},{}],154:[function(require,module,exports){
//! moment.js
//! version : 2.29.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com

;(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
    typeof define === 'function' && define.amd ? define(factory) :
    global.moment = factory()
}(this, (function () { 'use strict';

    var hookCallback;

    function hooks() {
        return hookCallback.apply(null, arguments);
    }

    // This is done to register the method called with moment()
    // without creating circular dependencies.
    function setHookCallback(callback) {
        hookCallback = callback;
    }

    function isArray(input) {
        return (
            input instanceof Array ||
            Object.prototype.toString.call(input) === '[object Array]'
        );
    }

    function isObject(input) {
        // IE8 will treat undefined and null as object if it wasn't for
        // input != null
        return (
            input != null &&
            Object.prototype.toString.call(input) === '[object Object]'
        );
    }

    function hasOwnProp(a, b) {
        return Object.prototype.hasOwnProperty.call(a, b);
    }

    function isObjectEmpty(obj) {
        if (Object.getOwnPropertyNames) {
            return Object.getOwnPropertyNames(obj).length === 0;
        } else {
            var k;
            for (k in obj) {
                if (hasOwnProp(obj, k)) {
                    return false;
                }
            }
            return true;
        }
    }

    function isUndefined(input) {
        return input === void 0;
    }

    function isNumber(input) {
        return (
            typeof input === 'number' ||
            Object.prototype.toString.call(input) === '[object Number]'
        );
    }

    function isDate(input) {
        return (
            input instanceof Date ||
            Object.prototype.toString.call(input) === '[object Date]'
        );
    }

    function map(arr, fn) {
        var res = [],
            i;
        for (i = 0; i < arr.length; ++i) {
            res.push(fn(arr[i], i));
        }
        return res;
    }

    function extend(a, b) {
        for (var i in b) {
            if (hasOwnProp(b, i)) {
                a[i] = b[i];
            }
        }

        if (hasOwnProp(b, 'toString')) {
            a.toString = b.toString;
        }

        if (hasOwnProp(b, 'valueOf')) {
            a.valueOf = b.valueOf;
        }

        return a;
    }

    function createUTC(input, format, locale, strict) {
        return createLocalOrUTC(input, format, locale, strict, true).utc();
    }

    function defaultParsingFlags() {
        // We need to deep clone this object.
        return {
            empty: false,
            unusedTokens: [],
            unusedInput: [],
            overflow: -2,
            charsLeftOver: 0,
            nullInput: false,
            invalidEra: null,
            invalidMonth: null,
            invalidFormat: false,
            userInvalidated: false,
            iso: false,
            parsedDateParts: [],
            era: null,
            meridiem: null,
            rfc2822: false,
            weekdayMismatch: false,
        };
    }

    function getParsingFlags(m) {
        if (m._pf == null) {
            m._pf = defaultParsingFlags();
        }
        return m._pf;
    }

    var some;
    if (Array.prototype.some) {
        some = Array.prototype.some;
    } else {
        some = function (fun) {
            var t = Object(this),
                len = t.length >>> 0,
                i;

            for (i = 0; i < len; i++) {
                if (i in t && fun.call(this, t[i], i, t)) {
                    return true;
                }
            }

            return false;
        };
    }

    function isValid(m) {
        if (m._isValid == null) {
            var flags = getParsingFlags(m),
                parsedParts = some.call(flags.parsedDateParts, function (i) {
                    return i != null;
                }),
                isNowValid =
                    !isNaN(m._d.getTime()) &&
                    flags.overflow < 0 &&
                    !flags.empty &&
                    !flags.invalidEra &&
                    !flags.invalidMonth &&
                    !flags.invalidWeekday &&
                    !flags.weekdayMismatch &&
                    !flags.nullInput &&
                    !flags.invalidFormat &&
                    !flags.userInvalidated &&
                    (!flags.meridiem || (flags.meridiem && parsedParts));

            if (m._strict) {
                isNowValid =
                    isNowValid &&
                    flags.charsLeftOver === 0 &&
                    flags.unusedTokens.length === 0 &&
                    flags.bigHour === undefined;
            }

            if (Object.isFrozen == null || !Object.isFrozen(m)) {
                m._isValid = isNowValid;
            } else {
                return isNowValid;
            }
        }
        return m._isValid;
    }

    function createInvalid(flags) {
        var m = createUTC(NaN);
        if (flags != null) {
            extend(getParsingFlags(m), flags);
        } else {
            getParsingFlags(m).userInvalidated = true;
        }

        return m;
    }

    // Plugins that add properties should also add the key here (null value),
    // so we can properly clone ourselves.
    var momentProperties = (hooks.momentProperties = []),
        updateInProgress = false;

    function copyConfig(to, from) {
        var i, prop, val;

        if (!isUndefined(from._isAMomentObject)) {
            to._isAMomentObject = from._isAMomentObject;
        }
        if (!isUndefined(from._i)) {
            to._i = from._i;
        }
        if (!isUndefined(from._f)) {
            to._f = from._f;
        }
        if (!isUndefined(from._l)) {
            to._l = from._l;
        }
        if (!isUndefined(from._strict)) {
            to._strict = from._strict;
        }
        if (!isUndefined(from._tzm)) {
            to._tzm = from._tzm;
        }
        if (!isUndefined(from._isUTC)) {
            to._isUTC = from._isUTC;
        }
        if (!isUndefined(from._offset)) {
            to._offset = from._offset;
        }
        if (!isUndefined(from._pf)) {
            to._pf = getParsingFlags(from);
        }
        if (!isUndefined(from._locale)) {
            to._locale = from._locale;
        }

        if (momentProperties.length > 0) {
            for (i = 0; i < momentProperties.length; i++) {
                prop = momentProperties[i];
                val = from[prop];
                if (!isUndefined(val)) {
                    to[prop] = val;
                }
            }
        }

        return to;
    }

    // Moment prototype object
    function Moment(config) {
        copyConfig(this, config);
        this._d = new Date(config._d != null ? config._d.getTime() : NaN);
        if (!this.isValid()) {
            this._d = new Date(NaN);
        }
        // Prevent infinite loop in case updateOffset creates new moment
        // objects.
        if (updateInProgress === false) {
            updateInProgress = true;
            hooks.updateOffset(this);
            updateInProgress = false;
        }
    }

    function isMoment(obj) {
        return (
            obj instanceof Moment || (obj != null && obj._isAMomentObject != null)
        );
    }

    function warn(msg) {
        if (
            hooks.suppressDeprecationWarnings === false &&
            typeof console !== 'undefined' &&
            console.warn
        ) {
            console.warn('Deprecation warning: ' + msg);
        }
    }

    function deprecate(msg, fn) {
        var firstTime = true;

        return extend(function () {
            if (hooks.deprecationHandler != null) {
                hooks.deprecationHandler(null, msg);
            }
            if (firstTime) {
                var args = [],
                    arg,
                    i,
                    key;
                for (i = 0; i < arguments.length; i++) {
                    arg = '';
                    if (typeof arguments[i] === 'object') {
                        arg += '\n[' + i + '] ';
                        for (key in arguments[0]) {
                            if (hasOwnProp(arguments[0], key)) {
                                arg += key + ': ' + arguments[0][key] + ', ';
                            }
                        }
                        arg = arg.slice(0, -2); // Remove trailing comma and space
                    } else {
                        arg = arguments[i];
                    }
                    args.push(arg);
                }
                warn(
                    msg +
                        '\nArguments: ' +
                        Array.prototype.slice.call(args).join('') +
                        '\n' +
                        new Error().stack
                );
                firstTime = false;
            }
            return fn.apply(this, arguments);
        }, fn);
    }

    var deprecations = {};

    function deprecateSimple(name, msg) {
        if (hooks.deprecationHandler != null) {
            hooks.deprecationHandler(name, msg);
        }
        if (!deprecations[name]) {
            warn(msg);
            deprecations[name] = true;
        }
    }

    hooks.suppressDeprecationWarnings = false;
    hooks.deprecationHandler = null;

    function isFunction(input) {
        return (
            (typeof Function !== 'undefined' && input instanceof Function) ||
            Object.prototype.toString.call(input) === '[object Function]'
        );
    }

    function set(config) {
        var prop, i;
        for (i in config) {
            if (hasOwnProp(config, i)) {
                prop = config[i];
                if (isFunction(prop)) {
                    this[i] = prop;
                } else {
                    this['_' + i] = prop;
                }
            }
        }
        this._config = config;
        // Lenient ordinal parsing accepts just a number in addition to
        // number + (possibly) stuff coming from _dayOfMonthOrdinalParse.
        // TODO: Remove "ordinalParse" fallback in next major release.
        this._dayOfMonthOrdinalParseLenient = new RegExp(
            (this._dayOfMonthOrdinalParse.source || this._ordinalParse.source) +
                '|' +
                /\d{1,2}/.source
        );
    }

    function mergeConfigs(parentConfig, childConfig) {
        var res = extend({}, parentConfig),
            prop;
        for (prop in childConfig) {
            if (hasOwnProp(childConfig, prop)) {
                if (isObject(parentConfig[prop]) && isObject(childConfig[prop])) {
                    res[prop] = {};
                    extend(res[prop], parentConfig[prop]);
                    extend(res[prop], childConfig[prop]);
                } else if (childConfig[prop] != null) {
                    res[prop] = childConfig[prop];
                } else {
                    delete res[prop];
                }
            }
        }
        for (prop in parentConfig) {
            if (
                hasOwnProp(parentConfig, prop) &&
                !hasOwnProp(childConfig, prop) &&
                isObject(parentConfig[prop])
            ) {
                // make sure changes to properties don't modify parent config
                res[prop] = extend({}, res[prop]);
            }
        }
        return res;
    }

    function Locale(config) {
        if (config != null) {
            this.set(config);
        }
    }

    var keys;

    if (Object.keys) {
        keys = Object.keys;
    } else {
        keys = function (obj) {
            var i,
                res = [];
            for (i in obj) {
                if (hasOwnProp(obj, i)) {
                    res.push(i);
                }
            }
            return res;
        };
    }

    var defaultCalendar = {
        sameDay: '[Today at] LT',
        nextDay: '[Tomorrow at] LT',
        nextWeek: 'dddd [at] LT',
        lastDay: '[Yesterday at] LT',
        lastWeek: '[Last] dddd [at] LT',
        sameElse: 'L',
    };

    function calendar(key, mom, now) {
        var output = this._calendar[key] || this._calendar['sameElse'];
        return isFunction(output) ? output.call(mom, now) : output;
    }

    function zeroFill(number, targetLength, forceSign) {
        var absNumber = '' + Math.abs(number),
            zerosToFill = targetLength - absNumber.length,
            sign = number >= 0;
        return (
            (sign ? (forceSign ? '+' : '') : '-') +
            Math.pow(10, Math.max(0, zerosToFill)).toString().substr(1) +
            absNumber
        );
    }

    var formattingTokens = /(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,
        localFormattingTokens = /(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,
        formatFunctions = {},
        formatTokenFunctions = {};

    // token:    'M'
    // padded:   ['MM', 2]
    // ordinal:  'Mo'
    // callback: function () { this.month() + 1 }
    function addFormatToken(token, padded, ordinal, callback) {
        var func = callback;
        if (typeof callback === 'string') {
            func = function () {
                return this[callback]();
            };
        }
        if (token) {
            formatTokenFunctions[token] = func;
        }
        if (padded) {
            formatTokenFunctions[padded[0]] = function () {
                return zeroFill(func.apply(this, arguments), padded[1], padded[2]);
            };
        }
        if (ordinal) {
            formatTokenFunctions[ordinal] = function () {
                return this.localeData().ordinal(
                    func.apply(this, arguments),
                    token
                );
            };
        }
    }

    function removeFormattingTokens(input) {
        if (input.match(/\[[\s\S]/)) {
            return input.replace(/^\[|\]$/g, '');
        }
        return input.replace(/\\/g, '');
    }

    function makeFormatFunction(format) {
        var array = format.match(formattingTokens),
            i,
            length;

        for (i = 0, length = array.length; i < length; i++) {
            if (formatTokenFunctions[array[i]]) {
                array[i] = formatTokenFunctions[array[i]];
            } else {
                array[i] = removeFormattingTokens(array[i]);
            }
        }

        return function (mom) {
            var output = '',
                i;
            for (i = 0; i < length; i++) {
                output += isFunction(array[i])
                    ? array[i].call(mom, format)
                    : array[i];
            }
            return output;
        };
    }

    // format date using native date object
    function formatMoment(m, format) {
        if (!m.isValid()) {
            return m.localeData().invalidDate();
        }

        format = expandFormat(format, m.localeData());
        formatFunctions[format] =
            formatFunctions[format] || makeFormatFunction(format);

        return formatFunctions[format](m);
    }

    function expandFormat(format, locale) {
        var i = 5;

        function replaceLongDateFormatTokens(input) {
            return locale.longDateFormat(input) || input;
        }

        localFormattingTokens.lastIndex = 0;
        while (i >= 0 && localFormattingTokens.test(format)) {
            format = format.replace(
                localFormattingTokens,
                replaceLongDateFormatTokens
            );
            localFormattingTokens.lastIndex = 0;
            i -= 1;
        }

        return format;
    }

    var defaultLongDateFormat = {
        LTS: 'h:mm:ss A',
        LT: 'h:mm A',
        L: 'MM/DD/YYYY',
        LL: 'MMMM D, YYYY',
        LLL: 'MMMM D, YYYY h:mm A',
        LLLL: 'dddd, MMMM D, YYYY h:mm A',
    };

    function longDateFormat(key) {
        var format = this._longDateFormat[key],
            formatUpper = this._longDateFormat[key.toUpperCase()];

        if (format || !formatUpper) {
            return format;
        }

        this._longDateFormat[key] = formatUpper
            .match(formattingTokens)
            .map(function (tok) {
                if (
                    tok === 'MMMM' ||
                    tok === 'MM' ||
                    tok === 'DD' ||
                    tok === 'dddd'
                ) {
                    return tok.slice(1);
                }
                return tok;
            })
            .join('');

        return this._longDateFormat[key];
    }

    var defaultInvalidDate = 'Invalid date';

    function invalidDate() {
        return this._invalidDate;
    }

    var defaultOrdinal = '%d',
        defaultDayOfMonthOrdinalParse = /\d{1,2}/;

    function ordinal(number) {
        return this._ordinal.replace('%d', number);
    }

    var defaultRelativeTime = {
        future: 'in %s',
        past: '%s ago',
        s: 'a few seconds',
        ss: '%d seconds',
        m: 'a minute',
        mm: '%d minutes',
        h: 'an hour',
        hh: '%d hours',
        d: 'a day',
        dd: '%d days',
        w: 'a week',
        ww: '%d weeks',
        M: 'a month',
        MM: '%d months',
        y: 'a year',
        yy: '%d years',
    };

    function relativeTime(number, withoutSuffix, string, isFuture) {
        var output = this._relativeTime[string];
        return isFunction(output)
            ? output(number, withoutSuffix, string, isFuture)
            : output.replace(/%d/i, number);
    }

    function pastFuture(diff, output) {
        var format = this._relativeTime[diff > 0 ? 'future' : 'past'];
        return isFunction(format) ? format(output) : format.replace(/%s/i, output);
    }

    var aliases = {};

    function addUnitAlias(unit, shorthand) {
        var lowerCase = unit.toLowerCase();
        aliases[lowerCase] = aliases[lowerCase + 's'] = aliases[shorthand] = unit;
    }

    function normalizeUnits(units) {
        return typeof units === 'string'
            ? aliases[units] || aliases[units.toLowerCase()]
            : undefined;
    }

    function normalizeObjectUnits(inputObject) {
        var normalizedInput = {},
            normalizedProp,
            prop;

        for (prop in inputObject) {
            if (hasOwnProp(inputObject, prop)) {
                normalizedProp = normalizeUnits(prop);
                if (normalizedProp) {
                    normalizedInput[normalizedProp] = inputObject[prop];
                }
            }
        }

        return normalizedInput;
    }

    var priorities = {};

    function addUnitPriority(unit, priority) {
        priorities[unit] = priority;
    }

    function getPrioritizedUnits(unitsObj) {
        var units = [],
            u;
        for (u in unitsObj) {
            if (hasOwnProp(unitsObj, u)) {
                units.push({ unit: u, priority: priorities[u] });
            }
        }
        units.sort(function (a, b) {
            return a.priority - b.priority;
        });
        return units;
    }

    function isLeapYear(year) {
        return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
    }

    function absFloor(number) {
        if (number < 0) {
            // -0 -> 0
            return Math.ceil(number) || 0;
        } else {
            return Math.floor(number);
        }
    }

    function toInt(argumentForCoercion) {
        var coercedNumber = +argumentForCoercion,
            value = 0;

        if (coercedNumber !== 0 && isFinite(coercedNumber)) {
            value = absFloor(coercedNumber);
        }

        return value;
    }

    function makeGetSet(unit, keepTime) {
        return function (value) {
            if (value != null) {
                set$1(this, unit, value);
                hooks.updateOffset(this, keepTime);
                return this;
            } else {
                return get(this, unit);
            }
        };
    }

    function get(mom, unit) {
        return mom.isValid()
            ? mom._d['get' + (mom._isUTC ? 'UTC' : '') + unit]()
            : NaN;
    }

    function set$1(mom, unit, value) {
        if (mom.isValid() && !isNaN(value)) {
            if (
                unit === 'FullYear' &&
                isLeapYear(mom.year()) &&
                mom.month() === 1 &&
                mom.date() === 29
            ) {
                value = toInt(value);
                mom._d['set' + (mom._isUTC ? 'UTC' : '') + unit](
                    value,
                    mom.month(),
                    daysInMonth(value, mom.month())
                );
            } else {
                mom._d['set' + (mom._isUTC ? 'UTC' : '') + unit](value);
            }
        }
    }

    // MOMENTS

    function stringGet(units) {
        units = normalizeUnits(units);
        if (isFunction(this[units])) {
            return this[units]();
        }
        return this;
    }

    function stringSet(units, value) {
        if (typeof units === 'object') {
            units = normalizeObjectUnits(units);
            var prioritized = getPrioritizedUnits(units),
                i;
            for (i = 0; i < prioritized.length; i++) {
                this[prioritized[i].unit](units[prioritized[i].unit]);
            }
        } else {
            units = normalizeUnits(units);
            if (isFunction(this[units])) {
                return this[units](value);
            }
        }
        return this;
    }

    var match1 = /\d/, //       0 - 9
        match2 = /\d\d/, //      00 - 99
        match3 = /\d{3}/, //     000 - 999
        match4 = /\d{4}/, //    0000 - 9999
        match6 = /[+-]?\d{6}/, // -999999 - 999999
        match1to2 = /\d\d?/, //       0 - 99
        match3to4 = /\d\d\d\d?/, //     999 - 9999
        match5to6 = /\d\d\d\d\d\d?/, //   99999 - 999999
        match1to3 = /\d{1,3}/, //       0 - 999
        match1to4 = /\d{1,4}/, //       0 - 9999
        match1to6 = /[+-]?\d{1,6}/, // -999999 - 999999
        matchUnsigned = /\d+/, //       0 - inf
        matchSigned = /[+-]?\d+/, //    -inf - inf
        matchOffset = /Z|[+-]\d\d:?\d\d/gi, // +00:00 -00:00 +0000 -0000 or Z
        matchShortOffset = /Z|[+-]\d\d(?::?\d\d)?/gi, // +00 -00 +00:00 -00:00 +0000 -0000 or Z
        matchTimestamp = /[+-]?\d+(\.\d{1,3})?/, // 123456789 123456789.123
        // any word (or two) characters or numbers including two/three word month in arabic.
        // includes scottish gaelic two word and hyphenated months
        matchWord = /[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,
        regexes;

    regexes = {};

    function addRegexToken(token, regex, strictRegex) {
        regexes[token] = isFunction(regex)
            ? regex
            : function (isStrict, localeData) {
                  return isStrict && strictRegex ? strictRegex : regex;
              };
    }

    function getParseRegexForToken(token, config) {
        if (!hasOwnProp(regexes, token)) {
            return new RegExp(unescapeFormat(token));
        }

        return regexes[token](config._strict, config._locale);
    }

    // Code from http://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript
    function unescapeFormat(s) {
        return regexEscape(
            s
                .replace('\\', '')
                .replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g, function (
                    matched,
                    p1,
                    p2,
                    p3,
                    p4
                ) {
                    return p1 || p2 || p3 || p4;
                })
        );
    }

    function regexEscape(s) {
        return s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
    }

    var tokens = {};

    function addParseToken(token, callback) {
        var i,
            func = callback;
        if (typeof token === 'string') {
            token = [token];
        }
        if (isNumber(callback)) {
            func = function (input, array) {
                array[callback] = toInt(input);
            };
        }
        for (i = 0; i < token.length; i++) {
            tokens[token[i]] = func;
        }
    }

    function addWeekParseToken(token, callback) {
        addParseToken(token, function (input, array, config, token) {
            config._w = config._w || {};
            callback(input, config._w, config, token);
        });
    }

    function addTimeToArrayFromToken(token, input, config) {
        if (input != null && hasOwnProp(tokens, token)) {
            tokens[token](input, config._a, config, token);
        }
    }

    var YEAR = 0,
        MONTH = 1,
        DATE = 2,
        HOUR = 3,
        MINUTE = 4,
        SECOND = 5,
        MILLISECOND = 6,
        WEEK = 7,
        WEEKDAY = 8;

    function mod(n, x) {
        return ((n % x) + x) % x;
    }

    var indexOf;

    if (Array.prototype.indexOf) {
        indexOf = Array.prototype.indexOf;
    } else {
        indexOf = function (o) {
            // I know
            var i;
            for (i = 0; i < this.length; ++i) {
                if (this[i] === o) {
                    return i;
                }
            }
            return -1;
        };
    }

    function daysInMonth(year, month) {
        if (isNaN(year) || isNaN(month)) {
            return NaN;
        }
        var modMonth = mod(month, 12);
        year += (month - modMonth) / 12;
        return modMonth === 1
            ? isLeapYear(year)
                ? 29
                : 28
            : 31 - ((modMonth % 7) % 2);
    }

    // FORMATTING

    addFormatToken('M', ['MM', 2], 'Mo', function () {
        return this.month() + 1;
    });

    addFormatToken('MMM', 0, 0, function (format) {
        return this.localeData().monthsShort(this, format);
    });

    addFormatToken('MMMM', 0, 0, function (format) {
        return this.localeData().months(this, format);
    });

    // ALIASES

    addUnitAlias('month', 'M');

    // PRIORITY

    addUnitPriority('month', 8);

    // PARSING

    addRegexToken('M', match1to2);
    addRegexToken('MM', match1to2, match2);
    addRegexToken('MMM', function (isStrict, locale) {
        return locale.monthsShortRegex(isStrict);
    });
    addRegexToken('MMMM', function (isStrict, locale) {
        return locale.monthsRegex(isStrict);
    });

    addParseToken(['M', 'MM'], function (input, array) {
        array[MONTH] = toInt(input) - 1;
    });

    addParseToken(['MMM', 'MMMM'], function (input, array, config, token) {
        var month = config._locale.monthsParse(input, token, config._strict);
        // if we didn't find a month name, mark the date as invalid.
        if (month != null) {
            array[MONTH] = month;
        } else {
            getParsingFlags(config).invalidMonth = input;
        }
    });

    // LOCALES

    var defaultLocaleMonths = 'January_February_March_April_May_June_July_August_September_October_November_December'.split(
            '_'
        ),
        defaultLocaleMonthsShort = 'Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec'.split(
            '_'
        ),
        MONTHS_IN_FORMAT = /D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,
        defaultMonthsShortRegex = matchWord,
        defaultMonthsRegex = matchWord;

    function localeMonths(m, format) {
        if (!m) {
            return isArray(this._months)
                ? this._months
                : this._months['standalone'];
        }
        return isArray(this._months)
            ? this._months[m.month()]
            : this._months[
                  (this._months.isFormat || MONTHS_IN_FORMAT).test(format)
                      ? 'format'
                      : 'standalone'
              ][m.month()];
    }

    function localeMonthsShort(m, format) {
        if (!m) {
            return isArray(this._monthsShort)
                ? this._monthsShort
                : this._monthsShort['standalone'];
        }
        return isArray(this._monthsShort)
            ? this._monthsShort[m.month()]
            : this._monthsShort[
                  MONTHS_IN_FORMAT.test(format) ? 'format' : 'standalone'
              ][m.month()];
    }

    function handleStrictParse(monthName, format, strict) {
        var i,
            ii,
            mom,
            llc = monthName.toLocaleLowerCase();
        if (!this._monthsParse) {
            // this is not used
            this._monthsParse = [];
            this._longMonthsParse = [];
            this._shortMonthsParse = [];
            for (i = 0; i < 12; ++i) {
                mom = createUTC([2000, i]);
                this._shortMonthsParse[i] = this.monthsShort(
                    mom,
                    ''
                ).toLocaleLowerCase();
                this._longMonthsParse[i] = this.months(mom, '').toLocaleLowerCase();
            }
        }

        if (strict) {
            if (format === 'MMM') {
                ii = indexOf.call(this._shortMonthsParse, llc);
                return ii !== -1 ? ii : null;
            } else {
                ii = indexOf.call(this._longMonthsParse, llc);
                return ii !== -1 ? ii : null;
            }
        } else {
            if (format === 'MMM') {
                ii = indexOf.call(this._shortMonthsParse, llc);
                if (ii !== -1) {
                    return ii;
                }
                ii = indexOf.call(this._longMonthsParse, llc);
                return ii !== -1 ? ii : null;
            } else {
                ii = indexOf.call(this._longMonthsParse, llc);
                if (ii !== -1) {
                    return ii;
                }
                ii = indexOf.call(this._shortMonthsParse, llc);
                return ii !== -1 ? ii : null;
            }
        }
    }

    function localeMonthsParse(monthName, format, strict) {
        var i, mom, regex;

        if (this._monthsParseExact) {
            return handleStrictParse.call(this, monthName, format, strict);
        }

        if (!this._monthsParse) {
            this._monthsParse = [];
            this._longMonthsParse = [];
            this._shortMonthsParse = [];
        }

        // TODO: add sorting
        // Sorting makes sure if one month (or abbr) is a prefix of another
        // see sorting in computeMonthsParse
        for (i = 0; i < 12; i++) {
            // make the regex if we don't have it already
            mom = createUTC([2000, i]);
            if (strict && !this._longMonthsParse[i]) {
                this._longMonthsParse[i] = new RegExp(
                    '^' + this.months(mom, '').replace('.', '') + '$',
                    'i'
                );
                this._shortMonthsParse[i] = new RegExp(
                    '^' + this.monthsShort(mom, '').replace('.', '') + '$',
                    'i'
                );
            }
            if (!strict && !this._monthsParse[i]) {
                regex =
                    '^' + this.months(mom, '') + '|^' + this.monthsShort(mom, '');
                this._monthsParse[i] = new RegExp(regex.replace('.', ''), 'i');
            }
            // test the regex
            if (
                strict &&
                format === 'MMMM' &&
                this._longMonthsParse[i].test(monthName)
            ) {
                return i;
            } else if (
                strict &&
                format === 'MMM' &&
                this._shortMonthsParse[i].test(monthName)
            ) {
                return i;
            } else if (!strict && this._monthsParse[i].test(monthName)) {
                return i;
            }
        }
    }

    // MOMENTS

    function setMonth(mom, value) {
        var dayOfMonth;

        if (!mom.isValid()) {
            // No op
            return mom;
        }

        if (typeof value === 'string') {
            if (/^\d+$/.test(value)) {
                value = toInt(value);
            } else {
                value = mom.localeData().monthsParse(value);
                // TODO: Another silent failure?
                if (!isNumber(value)) {
                    return mom;
                }
            }
        }

        dayOfMonth = Math.min(mom.date(), daysInMonth(mom.year(), value));
        mom._d['set' + (mom._isUTC ? 'UTC' : '') + 'Month'](value, dayOfMonth);
        return mom;
    }

    function getSetMonth(value) {
        if (value != null) {
            setMonth(this, value);
            hooks.updateOffset(this, true);
            return this;
        } else {
            return get(this, 'Month');
        }
    }

    function getDaysInMonth() {
        return daysInMonth(this.year(), this.month());
    }

    function monthsShortRegex(isStrict) {
        if (this._monthsParseExact) {
            if (!hasOwnProp(this, '_monthsRegex')) {
                computeMonthsParse.call(this);
            }
            if (isStrict) {
                return this._monthsShortStrictRegex;
            } else {
                return this._monthsShortRegex;
            }
        } else {
            if (!hasOwnProp(this, '_monthsShortRegex')) {
                this._monthsShortRegex = defaultMonthsShortRegex;
            }
            return this._monthsShortStrictRegex && isStrict
                ? this._monthsShortStrictRegex
                : this._monthsShortRegex;
        }
    }

    function monthsRegex(isStrict) {
        if (this._monthsParseExact) {
            if (!hasOwnProp(this, '_monthsRegex')) {
                computeMonthsParse.call(this);
            }
            if (isStrict) {
                return this._monthsStrictRegex;
            } else {
                return this._monthsRegex;
            }
        } else {
            if (!hasOwnProp(this, '_monthsRegex')) {
                this._monthsRegex = defaultMonthsRegex;
            }
            return this._monthsStrictRegex && isStrict
                ? this._monthsStrictRegex
                : this._monthsRegex;
        }
    }

    function computeMonthsParse() {
        function cmpLenRev(a, b) {
            return b.length - a.length;
        }

        var shortPieces = [],
            longPieces = [],
            mixedPieces = [],
            i,
            mom;
        for (i = 0; i < 12; i++) {
            // make the regex if we don't have it already
            mom = createUTC([2000, i]);
            shortPieces.push(this.monthsShort(mom, ''));
            longPieces.push(this.months(mom, ''));
            mixedPieces.push(this.months(mom, ''));
            mixedPieces.push(this.monthsShort(mom, ''));
        }
        // Sorting makes sure if one month (or abbr) is a prefix of another it
        // will match the longer piece.
        shortPieces.sort(cmpLenRev);
        longPieces.sort(cmpLenRev);
        mixedPieces.sort(cmpLenRev);
        for (i = 0; i < 12; i++) {
            shortPieces[i] = regexEscape(shortPieces[i]);
            longPieces[i] = regexEscape(longPieces[i]);
        }
        for (i = 0; i < 24; i++) {
            mixedPieces[i] = regexEscape(mixedPieces[i]);
        }

        this._monthsRegex = new RegExp('^(' + mixedPieces.join('|') + ')', 'i');
        this._monthsShortRegex = this._monthsRegex;
        this._monthsStrictRegex = new RegExp(
            '^(' + longPieces.join('|') + ')',
            'i'
        );
        this._monthsShortStrictRegex = new RegExp(
            '^(' + shortPieces.join('|') + ')',
            'i'
        );
    }

    // FORMATTING

    addFormatToken('Y', 0, 0, function () {
        var y = this.year();
        return y <= 9999 ? zeroFill(y, 4) : '+' + y;
    });

    addFormatToken(0, ['YY', 2], 0, function () {
        return this.year() % 100;
    });

    addFormatToken(0, ['YYYY', 4], 0, 'year');
    addFormatToken(0, ['YYYYY', 5], 0, 'year');
    addFormatToken(0, ['YYYYYY', 6, true], 0, 'year');

    // ALIASES

    addUnitAlias('year', 'y');

    // PRIORITIES

    addUnitPriority('year', 1);

    // PARSING

    addRegexToken('Y', matchSigned);
    addRegexToken('YY', match1to2, match2);
    addRegexToken('YYYY', match1to4, match4);
    addRegexToken('YYYYY', match1to6, match6);
    addRegexToken('YYYYYY', match1to6, match6);

    addParseToken(['YYYYY', 'YYYYYY'], YEAR);
    addParseToken('YYYY', function (input, array) {
        array[YEAR] =
            input.length === 2 ? hooks.parseTwoDigitYear(input) : toInt(input);
    });
    addParseToken('YY', function (input, array) {
        array[YEAR] = hooks.parseTwoDigitYear(input);
    });
    addParseToken('Y', function (input, array) {
        array[YEAR] = parseInt(input, 10);
    });

    // HELPERS

    function daysInYear(year) {
        return isLeapYear(year) ? 366 : 365;
    }

    // HOOKS

    hooks.parseTwoDigitYear = function (input) {
        return toInt(input) + (toInt(input) > 68 ? 1900 : 2000);
    };

    // MOMENTS

    var getSetYear = makeGetSet('FullYear', true);

    function getIsLeapYear() {
        return isLeapYear(this.year());
    }

    function createDate(y, m, d, h, M, s, ms) {
        // can't just apply() to create a date:
        // https://stackoverflow.com/q/181348
        var date;
        // the date constructor remaps years 0-99 to 1900-1999
        if (y < 100 && y >= 0) {
            // preserve leap years using a full 400 year cycle, then reset
            date = new Date(y + 400, m, d, h, M, s, ms);
            if (isFinite(date.getFullYear())) {
                date.setFullYear(y);
            }
        } else {
            date = new Date(y, m, d, h, M, s, ms);
        }

        return date;
    }

    function createUTCDate(y) {
        var date, args;
        // the Date.UTC function remaps years 0-99 to 1900-1999
        if (y < 100 && y >= 0) {
            args = Array.prototype.slice.call(arguments);
            // preserve leap years using a full 400 year cycle, then reset
            args[0] = y + 400;
            date = new Date(Date.UTC.apply(null, args));
            if (isFinite(date.getUTCFullYear())) {
                date.setUTCFullYear(y);
            }
        } else {
            date = new Date(Date.UTC.apply(null, arguments));
        }

        return date;
    }

    // start-of-first-week - start-of-year
    function firstWeekOffset(year, dow, doy) {
        var // first-week day -- which january is always in the first week (4 for iso, 1 for other)
            fwd = 7 + dow - doy,
            // first-week day local weekday -- which local weekday is fwd
            fwdlw = (7 + createUTCDate(year, 0, fwd).getUTCDay() - dow) % 7;

        return -fwdlw + fwd - 1;
    }

    // https://en.wikipedia.org/wiki/ISO_week_date#Calculating_a_date_given_the_year.2C_week_number_and_weekday
    function dayOfYearFromWeeks(year, week, weekday, dow, doy) {
        var localWeekday = (7 + weekday - dow) % 7,
            weekOffset = firstWeekOffset(year, dow, doy),
            dayOfYear = 1 + 7 * (week - 1) + localWeekday + weekOffset,
            resYear,
            resDayOfYear;

        if (dayOfYear <= 0) {
            resYear = year - 1;
            resDayOfYear = daysInYear(resYear) + dayOfYear;
        } else if (dayOfYear > daysInYear(year)) {
            resYear = year + 1;
            resDayOfYear = dayOfYear - daysInYear(year);
        } else {
            resYear = year;
            resDayOfYear = dayOfYear;
        }

        return {
            year: resYear,
            dayOfYear: resDayOfYear,
        };
    }

    function weekOfYear(mom, dow, doy) {
        var weekOffset = firstWeekOffset(mom.year(), dow, doy),
            week = Math.floor((mom.dayOfYear() - weekOffset - 1) / 7) + 1,
            resWeek,
            resYear;

        if (week < 1) {
            resYear = mom.year() - 1;
            resWeek = week + weeksInYear(resYear, dow, doy);
        } else if (week > weeksInYear(mom.year(), dow, doy)) {
            resWeek = week - weeksInYear(mom.year(), dow, doy);
            resYear = mom.year() + 1;
        } else {
            resYear = mom.year();
            resWeek = week;
        }

        return {
            week: resWeek,
            year: resYear,
        };
    }

    function weeksInYear(year, dow, doy) {
        var weekOffset = firstWeekOffset(year, dow, doy),
            weekOffsetNext = firstWeekOffset(year + 1, dow, doy);
        return (daysInYear(year) - weekOffset + weekOffsetNext) / 7;
    }

    // FORMATTING

    addFormatToken('w', ['ww', 2], 'wo', 'week');
    addFormatToken('W', ['WW', 2], 'Wo', 'isoWeek');

    // ALIASES

    addUnitAlias('week', 'w');
    addUnitAlias('isoWeek', 'W');

    // PRIORITIES

    addUnitPriority('week', 5);
    addUnitPriority('isoWeek', 5);

    // PARSING

    addRegexToken('w', match1to2);
    addRegexToken('ww', match1to2, match2);
    addRegexToken('W', match1to2);
    addRegexToken('WW', match1to2, match2);

    addWeekParseToken(['w', 'ww', 'W', 'WW'], function (
        input,
        week,
        config,
        token
    ) {
        week[token.substr(0, 1)] = toInt(input);
    });

    // HELPERS

    // LOCALES

    function localeWeek(mom) {
        return weekOfYear(mom, this._week.dow, this._week.doy).week;
    }

    var defaultLocaleWeek = {
        dow: 0, // Sunday is the first day of the week.
        doy: 6, // The week that contains Jan 6th is the first week of the year.
    };

    function localeFirstDayOfWeek() {
        return this._week.dow;
    }

    function localeFirstDayOfYear() {
        return this._week.doy;
    }

    // MOMENTS

    function getSetWeek(input) {
        var week = this.localeData().week(this);
        return input == null ? week : this.add((input - week) * 7, 'd');
    }

    function getSetISOWeek(input) {
        var week = weekOfYear(this, 1, 4).week;
        return input == null ? week : this.add((input - week) * 7, 'd');
    }

    // FORMATTING

    addFormatToken('d', 0, 'do', 'day');

    addFormatToken('dd', 0, 0, function (format) {
        return this.localeData().weekdaysMin(this, format);
    });

    addFormatToken('ddd', 0, 0, function (format) {
        return this.localeData().weekdaysShort(this, format);
    });

    addFormatToken('dddd', 0, 0, function (format) {
        return this.localeData().weekdays(this, format);
    });

    addFormatToken('e', 0, 0, 'weekday');
    addFormatToken('E', 0, 0, 'isoWeekday');

    // ALIASES

    addUnitAlias('day', 'd');
    addUnitAlias('weekday', 'e');
    addUnitAlias('isoWeekday', 'E');

    // PRIORITY
    addUnitPriority('day', 11);
    addUnitPriority('weekday', 11);
    addUnitPriority('isoWeekday', 11);

    // PARSING

    addRegexToken('d', match1to2);
    addRegexToken('e', match1to2);
    addRegexToken('E', match1to2);
    addRegexToken('dd', function (isStrict, locale) {
        return locale.weekdaysMinRegex(isStrict);
    });
    addRegexToken('ddd', function (isStrict, locale) {
        return locale.weekdaysShortRegex(isStrict);
    });
    addRegexToken('dddd', function (isStrict, locale) {
        return locale.weekdaysRegex(isStrict);
    });

    addWeekParseToken(['dd', 'ddd', 'dddd'], function (input, week, config, token) {
        var weekday = config._locale.weekdaysParse(input, token, config._strict);
        // if we didn't get a weekday name, mark the date as invalid
        if (weekday != null) {
            week.d = weekday;
        } else {
            getParsingFlags(config).invalidWeekday = input;
        }
    });

    addWeekParseToken(['d', 'e', 'E'], function (input, week, config, token) {
        week[token] = toInt(input);
    });

    // HELPERS

    function parseWeekday(input, locale) {
        if (typeof input !== 'string') {
            return input;
        }

        if (!isNaN(input)) {
            return parseInt(input, 10);
        }

        input = locale.weekdaysParse(input);
        if (typeof input === 'number') {
            return input;
        }

        return null;
    }

    function parseIsoWeekday(input, locale) {
        if (typeof input === 'string') {
            return locale.weekdaysParse(input) % 7 || 7;
        }
        return isNaN(input) ? null : input;
    }

    // LOCALES
    function shiftWeekdays(ws, n) {
        return ws.slice(n, 7).concat(ws.slice(0, n));
    }

    var defaultLocaleWeekdays = 'Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday'.split(
            '_'
        ),
        defaultLocaleWeekdaysShort = 'Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_'),
        defaultLocaleWeekdaysMin = 'Su_Mo_Tu_We_Th_Fr_Sa'.split('_'),
        defaultWeekdaysRegex = matchWord,
        defaultWeekdaysShortRegex = matchWord,
        defaultWeekdaysMinRegex = matchWord;

    function localeWeekdays(m, format) {
        var weekdays = isArray(this._weekdays)
            ? this._weekdays
            : this._weekdays[
                  m && m !== true && this._weekdays.isFormat.test(format)
                      ? 'format'
                      : 'standalone'
              ];
        return m === true
            ? shiftWeekdays(weekdays, this._week.dow)
            : m
            ? weekdays[m.day()]
            : weekdays;
    }

    function localeWeekdaysShort(m) {
        return m === true
            ? shiftWeekdays(this._weekdaysShort, this._week.dow)
            : m
            ? this._weekdaysShort[m.day()]
            : this._weekdaysShort;
    }

    function localeWeekdaysMin(m) {
        return m === true
            ? shiftWeekdays(this._weekdaysMin, this._week.dow)
            : m
            ? this._weekdaysMin[m.day()]
            : this._weekdaysMin;
    }

    function handleStrictParse$1(weekdayName, format, strict) {
        var i,
            ii,
            mom,
            llc = weekdayName.toLocaleLowerCase();
        if (!this._weekdaysParse) {
            this._weekdaysParse = [];
            this._shortWeekdaysParse = [];
            this._minWeekdaysParse = [];

            for (i = 0; i < 7; ++i) {
                mom = createUTC([2000, 1]).day(i);
                this._minWeekdaysParse[i] = this.weekdaysMin(
                    mom,
                    ''
                ).toLocaleLowerCase();
                this._shortWeekdaysParse[i] = this.weekdaysShort(
                    mom,
                    ''
                ).toLocaleLowerCase();
                this._weekdaysParse[i] = this.weekdays(mom, '').toLocaleLowerCase();
            }
        }

        if (strict) {
            if (format === 'dddd') {
                ii = indexOf.call(this._weekdaysParse, llc);
                return ii !== -1 ? ii : null;
            } else if (format === 'ddd') {
                ii = indexOf.call(this._shortWeekdaysParse, llc);
                return ii !== -1 ? ii : null;
            } else {
                ii = indexOf.call(this._minWeekdaysParse, llc);
                return ii !== -1 ? ii : null;
            }
        } else {
            if (format === 'dddd') {
                ii = indexOf.call(this._weekdaysParse, llc);
                if (ii !== -1) {
                    return ii;
                }
                ii = indexOf.call(this._shortWeekdaysParse, llc);
                if (ii !== -1) {
                    return ii;
                }
                ii = indexOf.call(this._minWeekdaysParse, llc);
                return ii !== -1 ? ii : null;
            } else if (format === 'ddd') {
                ii = indexOf.call(this._shortWeekdaysParse, llc);
                if (ii !== -1) {
                    return ii;
                }
                ii = indexOf.call(this._weekdaysParse, llc);
                if (ii !== -1) {
                    return ii;
                }
                ii = indexOf.call(this._minWeekdaysParse, llc);
                return ii !== -1 ? ii : null;
            } else {
                ii = indexOf.call(this._minWeekdaysParse, llc);
                if (ii !== -1) {
                    return ii;
                }
                ii = indexOf.call(this._weekdaysParse, llc);
                if (ii !== -1) {
                    return ii;
                }
                ii = indexOf.call(this._shortWeekdaysParse, llc);
                return ii !== -1 ? ii : null;
            }
        }
    }

    function localeWeekdaysParse(weekdayName, format, strict) {
        var i, mom, regex;

        if (this._weekdaysParseExact) {
            return handleStrictParse$1.call(this, weekdayName, format, strict);
        }

        if (!this._weekdaysParse) {
            this._weekdaysParse = [];
            this._minWeekdaysParse = [];
            this._shortWeekdaysParse = [];
            this._fullWeekdaysParse = [];
        }

        for (i = 0; i < 7; i++) {
            // make the regex if we don't have it already

            mom = createUTC([2000, 1]).day(i);
            if (strict && !this._fullWeekdaysParse[i]) {
                this._fullWeekdaysParse[i] = new RegExp(
                    '^' + this.weekdays(mom, '').replace('.', '\\.?') + '$',
                    'i'
                );
                this._shortWeekdaysParse[i] = new RegExp(
                    '^' + this.weekdaysShort(mom, '').replace('.', '\\.?') + '$',
                    'i'
                );
                this._minWeekdaysParse[i] = new RegExp(
                    '^' + this.weekdaysMin(mom, '').replace('.', '\\.?') + '$',
                    'i'
                );
            }
            if (!this._weekdaysParse[i]) {
                regex =
                    '^' +
                    this.weekdays(mom, '') +
                    '|^' +
                    this.weekdaysShort(mom, '') +
                    '|^' +
                    this.weekdaysMin(mom, '');
                this._weekdaysParse[i] = new RegExp(regex.replace('.', ''), 'i');
            }
            // test the regex
            if (
                strict &&
                format === 'dddd' &&
                this._fullWeekdaysParse[i].test(weekdayName)
            ) {
                return i;
            } else if (
                strict &&
                format === 'ddd' &&
                this._shortWeekdaysParse[i].test(weekdayName)
            ) {
                return i;
            } else if (
                strict &&
                format === 'dd' &&
                this._minWeekdaysParse[i].test(weekdayName)
            ) {
                return i;
            } else if (!strict && this._weekdaysParse[i].test(weekdayName)) {
                return i;
            }
        }
    }

    // MOMENTS

    function getSetDayOfWeek(input) {
        if (!this.isValid()) {
            return input != null ? this : NaN;
        }
        var day = this._isUTC ? this._d.getUTCDay() : this._d.getDay();
        if (input != null) {
            input = parseWeekday(input, this.localeData());
            return this.add(input - day, 'd');
        } else {
            return day;
        }
    }

    function getSetLocaleDayOfWeek(input) {
        if (!this.isValid()) {
            return input != null ? this : NaN;
        }
        var weekday = (this.day() + 7 - this.localeData()._week.dow) % 7;
        return input == null ? weekday : this.add(input - weekday, 'd');
    }

    function getSetISODayOfWeek(input) {
        if (!this.isValid()) {
            return input != null ? this : NaN;
        }

        // behaves the same as moment#day except
        // as a getter, returns 7 instead of 0 (1-7 range instead of 0-6)
        // as a setter, sunday should belong to the previous week.

        if (input != null) {
            var weekday = parseIsoWeekday(input, this.localeData());
            return this.day(this.day() % 7 ? weekday : weekday - 7);
        } else {
            return this.day() || 7;
        }
    }

    function weekdaysRegex(isStrict) {
        if (this._weekdaysParseExact) {
            if (!hasOwnProp(this, '_weekdaysRegex')) {
                computeWeekdaysParse.call(this);
            }
            if (isStrict) {
                return this._weekdaysStrictRegex;
            } else {
                return this._weekdaysRegex;
            }
        } else {
            if (!hasOwnProp(this, '_weekdaysRegex')) {
                this._weekdaysRegex = defaultWeekdaysRegex;
            }
            return this._weekdaysStrictRegex && isStrict
                ? this._weekdaysStrictRegex
                : this._weekdaysRegex;
        }
    }

    function weekdaysShortRegex(isStrict) {
        if (this._weekdaysParseExact) {
            if (!hasOwnProp(this, '_weekdaysRegex')) {
                computeWeekdaysParse.call(this);
            }
            if (isStrict) {
                return this._weekdaysShortStrictRegex;
            } else {
                return this._weekdaysShortRegex;
            }
        } else {
            if (!hasOwnProp(this, '_weekdaysShortRegex')) {
                this._weekdaysShortRegex = defaultWeekdaysShortRegex;
            }
            return this._weekdaysShortStrictRegex && isStrict
                ? this._weekdaysShortStrictRegex
                : this._weekdaysShortRegex;
        }
    }

    function weekdaysMinRegex(isStrict) {
        if (this._weekdaysParseExact) {
            if (!hasOwnProp(this, '_weekdaysRegex')) {
                computeWeekdaysParse.call(this);
            }
            if (isStrict) {
                return this._weekdaysMinStrictRegex;
            } else {
                return this._weekdaysMinRegex;
            }
        } else {
            if (!hasOwnProp(this, '_weekdaysMinRegex')) {
                this._weekdaysMinRegex = defaultWeekdaysMinRegex;
            }
            return this._weekdaysMinStrictRegex && isStrict
                ? this._weekdaysMinStrictRegex
                : this._weekdaysMinRegex;
        }
    }

    function computeWeekdaysParse() {
        function cmpLenRev(a, b) {
            return b.length - a.length;
        }

        var minPieces = [],
            shortPieces = [],
            longPieces = [],
            mixedPieces = [],
            i,
            mom,
            minp,
            shortp,
            longp;
        for (i = 0; i < 7; i++) {
            // make the regex if we don't have it already
            mom = createUTC([2000, 1]).day(i);
            minp = regexEscape(this.weekdaysMin(mom, ''));
            shortp = regexEscape(this.weekdaysShort(mom, ''));
            longp = regexEscape(this.weekdays(mom, ''));
            minPieces.push(minp);
            shortPieces.push(shortp);
            longPieces.push(longp);
            mixedPieces.push(minp);
            mixedPieces.push(shortp);
            mixedPieces.push(longp);
        }
        // Sorting makes sure if one weekday (or abbr) is a prefix of another it
        // will match the longer piece.
        minPieces.sort(cmpLenRev);
        shortPieces.sort(cmpLenRev);
        longPieces.sort(cmpLenRev);
        mixedPieces.sort(cmpLenRev);

        this._weekdaysRegex = new RegExp('^(' + mixedPieces.join('|') + ')', 'i');
        this._weekdaysShortRegex = this._weekdaysRegex;
        this._weekdaysMinRegex = this._weekdaysRegex;

        this._weekdaysStrictRegex = new RegExp(
            '^(' + longPieces.join('|') + ')',
            'i'
        );
        this._weekdaysShortStrictRegex = new RegExp(
            '^(' + shortPieces.join('|') + ')',
            'i'
        );
        this._weekdaysMinStrictRegex = new RegExp(
            '^(' + minPieces.join('|') + ')',
            'i'
        );
    }

    // FORMATTING

    function hFormat() {
        return this.hours() % 12 || 12;
    }

    function kFormat() {
        return this.hours() || 24;
    }

    addFormatToken('H', ['HH', 2], 0, 'hour');
    addFormatToken('h', ['hh', 2], 0, hFormat);
    addFormatToken('k', ['kk', 2], 0, kFormat);

    addFormatToken('hmm', 0, 0, function () {
        return '' + hFormat.apply(this) + zeroFill(this.minutes(), 2);
    });

    addFormatToken('hmmss', 0, 0, function () {
        return (
            '' +
            hFormat.apply(this) +
            zeroFill(this.minutes(), 2) +
            zeroFill(this.seconds(), 2)
        );
    });

    addFormatToken('Hmm', 0, 0, function () {
        return '' + this.hours() + zeroFill(this.minutes(), 2);
    });

    addFormatToken('Hmmss', 0, 0, function () {
        return (
            '' +
            this.hours() +
            zeroFill(this.minutes(), 2) +
            zeroFill(this.seconds(), 2)
        );
    });

    function meridiem(token, lowercase) {
        addFormatToken(token, 0, 0, function () {
            return this.localeData().meridiem(
                this.hours(),
                this.minutes(),
                lowercase
            );
        });
    }

    meridiem('a', true);
    meridiem('A', false);

    // ALIASES

    addUnitAlias('hour', 'h');

    // PRIORITY
    addUnitPriority('hour', 13);

    // PARSING

    function matchMeridiem(isStrict, locale) {
        return locale._meridiemParse;
    }

    addRegexToken('a', matchMeridiem);
    addRegexToken('A', matchMeridiem);
    addRegexToken('H', match1to2);
    addRegexToken('h', match1to2);
    addRegexToken('k', match1to2);
    addRegexToken('HH', match1to2, match2);
    addRegexToken('hh', match1to2, match2);
    addRegexToken('kk', match1to2, match2);

    addRegexToken('hmm', match3to4);
    addRegexToken('hmmss', match5to6);
    addRegexToken('Hmm', match3to4);
    addRegexToken('Hmmss', match5to6);

    addParseToken(['H', 'HH'], HOUR);
    addParseToken(['k', 'kk'], function (input, array, config) {
        var kInput = toInt(input);
        array[HOUR] = kInput === 24 ? 0 : kInput;
    });
    addParseToken(['a', 'A'], function (input, array, config) {
        config._isPm = config._locale.isPM(input);
        config._meridiem = input;
    });
    addParseToken(['h', 'hh'], function (input, array, config) {
        array[HOUR] = toInt(input);
        getParsingFlags(config).bigHour = true;
    });
    addParseToken('hmm', function (input, array, config) {
        var pos = input.length - 2;
        array[HOUR] = toInt(input.substr(0, pos));
        array[MINUTE] = toInt(input.substr(pos));
        getParsingFlags(config).bigHour = true;
    });
    addParseToken('hmmss', function (input, array, config) {
        var pos1 = input.length - 4,
            pos2 = input.length - 2;
        array[HOUR] = toInt(input.substr(0, pos1));
        array[MINUTE] = toInt(input.substr(pos1, 2));
        array[SECOND] = toInt(input.substr(pos2));
        getParsingFlags(config).bigHour = true;
    });
    addParseToken('Hmm', function (input, array, config) {
        var pos = input.length - 2;
        array[HOUR] = toInt(input.substr(0, pos));
        array[MINUTE] = toInt(input.substr(pos));
    });
    addParseToken('Hmmss', function (input, array, config) {
        var pos1 = input.length - 4,
            pos2 = input.length - 2;
        array[HOUR] = toInt(input.substr(0, pos1));
        array[MINUTE] = toInt(input.substr(pos1, 2));
        array[SECOND] = toInt(input.substr(pos2));
    });

    // LOCALES

    function localeIsPM(input) {
        // IE8 Quirks Mode & IE7 Standards Mode do not allow accessing strings like arrays
        // Using charAt should be more compatible.
        return (input + '').toLowerCase().charAt(0) === 'p';
    }

    var defaultLocaleMeridiemParse = /[ap]\.?m?\.?/i,
        // Setting the hour should keep the time, because the user explicitly
        // specified which hour they want. So trying to maintain the same hour (in
        // a new timezone) makes sense. Adding/subtracting hours does not follow
        // this rule.
        getSetHour = makeGetSet('Hours', true);

    function localeMeridiem(hours, minutes, isLower) {
        if (hours > 11) {
            return isLower ? 'pm' : 'PM';
        } else {
            return isLower ? 'am' : 'AM';
        }
    }

    var baseConfig = {
        calendar: defaultCalendar,
        longDateFormat: defaultLongDateFormat,
        invalidDate: defaultInvalidDate,
        ordinal: defaultOrdinal,
        dayOfMonthOrdinalParse: defaultDayOfMonthOrdinalParse,
        relativeTime: defaultRelativeTime,

        months: defaultLocaleMonths,
        monthsShort: defaultLocaleMonthsShort,

        week: defaultLocaleWeek,

        weekdays: defaultLocaleWeekdays,
        weekdaysMin: defaultLocaleWeekdaysMin,
        weekdaysShort: defaultLocaleWeekdaysShort,

        meridiemParse: defaultLocaleMeridiemParse,
    };

    // internal storage for locale config files
    var locales = {},
        localeFamilies = {},
        globalLocale;

    function commonPrefix(arr1, arr2) {
        var i,
            minl = Math.min(arr1.length, arr2.length);
        for (i = 0; i < minl; i += 1) {
            if (arr1[i] !== arr2[i]) {
                return i;
            }
        }
        return minl;
    }

    function normalizeLocale(key) {
        return key ? key.toLowerCase().replace('_', '-') : key;
    }

    // pick the locale from the array
    // try ['en-au', 'en-gb'] as 'en-au', 'en-gb', 'en', as in move through the list trying each
    // substring from most specific to least, but move to the next array item if it's a more specific variant than the current root
    function chooseLocale(names) {
        var i = 0,
            j,
            next,
            locale,
            split;

        while (i < names.length) {
            split = normalizeLocale(names[i]).split('-');
            j = split.length;
            next = normalizeLocale(names[i + 1]);
            next = next ? next.split('-') : null;
            while (j > 0) {
                locale = loadLocale(split.slice(0, j).join('-'));
                if (locale) {
                    return locale;
                }
                if (
                    next &&
                    next.length >= j &&
                    commonPrefix(split, next) >= j - 1
                ) {
                    //the next array item is better than a shallower substring of this one
                    break;
                }
                j--;
            }
            i++;
        }
        return globalLocale;
    }

    function loadLocale(name) {
        var oldLocale = null,
            aliasedRequire;
        // TODO: Find a better way to register and load all the locales in Node
        if (
            locales[name] === undefined &&
            typeof module !== 'undefined' &&
            module &&
            module.exports
        ) {
            try {
                oldLocale = globalLocale._abbr;
                aliasedRequire = require;
                aliasedRequire('./locale/' + name);
                getSetGlobalLocale(oldLocale);
            } catch (e) {
                // mark as not found to avoid repeating expensive file require call causing high CPU
                // when trying to find en-US, en_US, en-us for every format call
                locales[name] = null; // null means not found
            }
        }
        return locales[name];
    }

    // This function will load locale and then set the global locale.  If
    // no arguments are passed in, it will simply return the current global
    // locale key.
    function getSetGlobalLocale(key, values) {
        var data;
        if (key) {
            if (isUndefined(values)) {
                data = getLocale(key);
            } else {
                data = defineLocale(key, values);
            }

            if (data) {
                // moment.duration._locale = moment._locale = data;
                globalLocale = data;
            } else {
                if (typeof console !== 'undefined' && console.warn) {
                    //warn user if arguments are passed but the locale could not be set
                    console.warn(
                        'Locale ' + key + ' not found. Did you forget to load it?'
                    );
                }
            }
        }

        return globalLocale._abbr;
    }

    function defineLocale(name, config) {
        if (config !== null) {
            var locale,
                parentConfig = baseConfig;
            config.abbr = name;
            if (locales[name] != null) {
                deprecateSimple(
                    'defineLocaleOverride',
                    'use moment.updateLocale(localeName, config) to change ' +
                        'an existing locale. moment.defineLocale(localeName, ' +
                        'config) should only be used for creating a new locale ' +
                        'See http://momentjs.com/guides/#/warnings/define-locale/ for more info.'
                );
                parentConfig = locales[name]._config;
            } else if (config.parentLocale != null) {
                if (locales[config.parentLocale] != null) {
                    parentConfig = locales[config.parentLocale]._config;
                } else {
                    locale = loadLocale(config.parentLocale);
                    if (locale != null) {
                        parentConfig = locale._config;
                    } else {
                        if (!localeFamilies[config.parentLocale]) {
                            localeFamilies[config.parentLocale] = [];
                        }
                        localeFamilies[config.parentLocale].push({
                            name: name,
                            config: config,
                        });
                        return null;
                    }
                }
            }
            locales[name] = new Locale(mergeConfigs(parentConfig, config));

            if (localeFamilies[name]) {
                localeFamilies[name].forEach(function (x) {
                    defineLocale(x.name, x.config);
                });
            }

            // backwards compat for now: also set the locale
            // make sure we set the locale AFTER all child locales have been
            // created, so we won't end up with the child locale set.
            getSetGlobalLocale(name);

            return locales[name];
        } else {
            // useful for testing
            delete locales[name];
            return null;
        }
    }

    function updateLocale(name, config) {
        if (config != null) {
            var locale,
                tmpLocale,
                parentConfig = baseConfig;

            if (locales[name] != null && locales[name].parentLocale != null) {
                // Update existing child locale in-place to avoid memory-leaks
                locales[name].set(mergeConfigs(locales[name]._config, config));
            } else {
                // MERGE
                tmpLocale = loadLocale(name);
                if (tmpLocale != null) {
                    parentConfig = tmpLocale._config;
                }
                config = mergeConfigs(parentConfig, config);
                if (tmpLocale == null) {
                    // updateLocale is called for creating a new locale
                    // Set abbr so it will have a name (getters return
                    // undefined otherwise).
                    config.abbr = name;
                }
                locale = new Locale(config);
                locale.parentLocale = locales[name];
                locales[name] = locale;
            }

            // backwards compat for now: also set the locale
            getSetGlobalLocale(name);
        } else {
            // pass null for config to unupdate, useful for tests
            if (locales[name] != null) {
                if (locales[name].parentLocale != null) {
                    locales[name] = locales[name].parentLocale;
                    if (name === getSetGlobalLocale()) {
                        getSetGlobalLocale(name);
                    }
                } else if (locales[name] != null) {
                    delete locales[name];
                }
            }
        }
        return locales[name];
    }

    // returns locale data
    function getLocale(key) {
        var locale;

        if (key && key._locale && key._locale._abbr) {
            key = key._locale._abbr;
        }

        if (!key) {
            return globalLocale;
        }

        if (!isArray(key)) {
            //short-circuit everything else
            locale = loadLocale(key);
            if (locale) {
                return locale;
            }
            key = [key];
        }

        return chooseLocale(key);
    }

    function listLocales() {
        return keys(locales);
    }

    function checkOverflow(m) {
        var overflow,
            a = m._a;

        if (a && getParsingFlags(m).overflow === -2) {
            overflow =
                a[MONTH] < 0 || a[MONTH] > 11
                    ? MONTH
                    : a[DATE] < 1 || a[DATE] > daysInMonth(a[YEAR], a[MONTH])
                    ? DATE
                    : a[HOUR] < 0 ||
                      a[HOUR] > 24 ||
                      (a[HOUR] === 24 &&
                          (a[MINUTE] !== 0 ||
                              a[SECOND] !== 0 ||
                              a[MILLISECOND] !== 0))
                    ? HOUR
                    : a[MINUTE] < 0 || a[MINUTE] > 59
                    ? MINUTE
                    : a[SECOND] < 0 || a[SECOND] > 59
                    ? SECOND
                    : a[MILLISECOND] < 0 || a[MILLISECOND] > 999
                    ? MILLISECOND
                    : -1;

            if (
                getParsingFlags(m)._overflowDayOfYear &&
                (overflow < YEAR || overflow > DATE)
            ) {
                overflow = DATE;
            }
            if (getParsingFlags(m)._overflowWeeks && overflow === -1) {
                overflow = WEEK;
            }
            if (getParsingFlags(m)._overflowWeekday && overflow === -1) {
                overflow = WEEKDAY;
            }

            getParsingFlags(m).overflow = overflow;
        }

        return m;
    }

    // iso 8601 regex
    // 0000-00-00 0000-W00 or 0000-W00-0 + T + 00 or 00:00 or 00:00:00 or 00:00:00.000 + +00:00 or +0000 or +00)
    var extendedIsoRegex = /^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,
        basicIsoRegex = /^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,
        tzRegex = /Z|[+-]\d\d(?::?\d\d)?/,
        isoDates = [
            ['YYYYYY-MM-DD', /[+-]\d{6}-\d\d-\d\d/],
            ['YYYY-MM-DD', /\d{4}-\d\d-\d\d/],
            ['GGGG-[W]WW-E', /\d{4}-W\d\d-\d/],
            ['GGGG-[W]WW', /\d{4}-W\d\d/, false],
            ['YYYY-DDD', /\d{4}-\d{3}/],
            ['YYYY-MM', /\d{4}-\d\d/, false],
            ['YYYYYYMMDD', /[+-]\d{10}/],
            ['YYYYMMDD', /\d{8}/],
            ['GGGG[W]WWE', /\d{4}W\d{3}/],
            ['GGGG[W]WW', /\d{4}W\d{2}/, false],
            ['YYYYDDD', /\d{7}/],
            ['YYYYMM', /\d{6}/, false],
            ['YYYY', /\d{4}/, false],
        ],
        // iso time formats and regexes
        isoTimes = [
            ['HH:mm:ss.SSSS', /\d\d:\d\d:\d\d\.\d+/],
            ['HH:mm:ss,SSSS', /\d\d:\d\d:\d\d,\d+/],
            ['HH:mm:ss', /\d\d:\d\d:\d\d/],
            ['HH:mm', /\d\d:\d\d/],
            ['HHmmss.SSSS', /\d\d\d\d\d\d\.\d+/],
            ['HHmmss,SSSS', /\d\d\d\d\d\d,\d+/],
            ['HHmmss', /\d\d\d\d\d\d/],
            ['HHmm', /\d\d\d\d/],
            ['HH', /\d\d/],
        ],
        aspNetJsonRegex = /^\/?Date\((-?\d+)/i,
        // RFC 2822 regex: For details see https://tools.ietf.org/html/rfc2822#section-3.3
        rfc2822 = /^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,
        obsOffsets = {
            UT: 0,
            GMT: 0,
            EDT: -4 * 60,
            EST: -5 * 60,
            CDT: -5 * 60,
            CST: -6 * 60,
            MDT: -6 * 60,
            MST: -7 * 60,
            PDT: -7 * 60,
            PST: -8 * 60,
        };

    // date from iso format
    function configFromISO(config) {
        var i,
            l,
            string = config._i,
            match = extendedIsoRegex.exec(string) || basicIsoRegex.exec(string),
            allowTime,
            dateFormat,
            timeFormat,
            tzFormat;

        if (match) {
            getParsingFlags(config).iso = true;

            for (i = 0, l = isoDates.length; i < l; i++) {
                if (isoDates[i][1].exec(match[1])) {
                    dateFormat = isoDates[i][0];
                    allowTime = isoDates[i][2] !== false;
                    break;
                }
            }
            if (dateFormat == null) {
                config._isValid = false;
                return;
            }
            if (match[3]) {
                for (i = 0, l = isoTimes.length; i < l; i++) {
                    if (isoTimes[i][1].exec(match[3])) {
                        // match[2] should be 'T' or space
                        timeFormat = (match[2] || ' ') + isoTimes[i][0];
                        break;
                    }
                }
                if (timeFormat == null) {
                    config._isValid = false;
                    return;
                }
            }
            if (!allowTime && timeFormat != null) {
                config._isValid = false;
                return;
            }
            if (match[4]) {
                if (tzRegex.exec(match[4])) {
                    tzFormat = 'Z';
                } else {
                    config._isValid = false;
                    return;
                }
            }
            config._f = dateFormat + (timeFormat || '') + (tzFormat || '');
            configFromStringAndFormat(config);
        } else {
            config._isValid = false;
        }
    }

    function extractFromRFC2822Strings(
        yearStr,
        monthStr,
        dayStr,
        hourStr,
        minuteStr,
        secondStr
    ) {
        var result = [
            untruncateYear(yearStr),
            defaultLocaleMonthsShort.indexOf(monthStr),
            parseInt(dayStr, 10),
            parseInt(hourStr, 10),
            parseInt(minuteStr, 10),
        ];

        if (secondStr) {
            result.push(parseInt(secondStr, 10));
        }

        return result;
    }

    function untruncateYear(yearStr) {
        var year = parseInt(yearStr, 10);
        if (year <= 49) {
            return 2000 + year;
        } else if (year <= 999) {
            return 1900 + year;
        }
        return year;
    }

    function preprocessRFC2822(s) {
        // Remove comments and folding whitespace and replace multiple-spaces with a single space
        return s
            .replace(/\([^)]*\)|[\n\t]/g, ' ')
            .replace(/(\s\s+)/g, ' ')
            .replace(/^\s\s*/, '')
            .replace(/\s\s*$/, '');
    }

    function checkWeekday(weekdayStr, parsedInput, config) {
        if (weekdayStr) {
            // TODO: Replace the vanilla JS Date object with an independent day-of-week check.
            var weekdayProvided = defaultLocaleWeekdaysShort.indexOf(weekdayStr),
                weekdayActual = new Date(
                    parsedInput[0],
                    parsedInput[1],
                    parsedInput[2]
                ).getDay();
            if (weekdayProvided !== weekdayActual) {
                getParsingFlags(config).weekdayMismatch = true;
                config._isValid = false;
                return false;
            }
        }
        return true;
    }

    function calculateOffset(obsOffset, militaryOffset, numOffset) {
        if (obsOffset) {
            return obsOffsets[obsOffset];
        } else if (militaryOffset) {
            // the only allowed military tz is Z
            return 0;
        } else {
            var hm = parseInt(numOffset, 10),
                m = hm % 100,
                h = (hm - m) / 100;
            return h * 60 + m;
        }
    }

    // date and time from ref 2822 format
    function configFromRFC2822(config) {
        var match = rfc2822.exec(preprocessRFC2822(config._i)),
            parsedArray;
        if (match) {
            parsedArray = extractFromRFC2822Strings(
                match[4],
                match[3],
                match[2],
                match[5],
                match[6],
                match[7]
            );
            if (!checkWeekday(match[1], parsedArray, config)) {
                return;
            }

            config._a = parsedArray;
            config._tzm = calculateOffset(match[8], match[9], match[10]);

            config._d = createUTCDate.apply(null, config._a);
            config._d.setUTCMinutes(config._d.getUTCMinutes() - config._tzm);

            getParsingFlags(config).rfc2822 = true;
        } else {
            config._isValid = false;
        }
    }

    // date from 1) ASP.NET, 2) ISO, 3) RFC 2822 formats, or 4) optional fallback if parsing isn't strict
    function configFromString(config) {
        var matched = aspNetJsonRegex.exec(config._i);
        if (matched !== null) {
            config._d = new Date(+matched[1]);
            return;
        }

        configFromISO(config);
        if (config._isValid === false) {
            delete config._isValid;
        } else {
            return;
        }

        configFromRFC2822(config);
        if (config._isValid === false) {
            delete config._isValid;
        } else {
            return;
        }

        if (config._strict) {
            config._isValid = false;
        } else {
            // Final attempt, use Input Fallback
            hooks.createFromInputFallback(config);
        }
    }

    hooks.createFromInputFallback = deprecate(
        'value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), ' +
            'which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are ' +
            'discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.',
        function (config) {
            config._d = new Date(config._i + (config._useUTC ? ' UTC' : ''));
        }
    );

    // Pick the first defined of two or three arguments.
    function defaults(a, b, c) {
        if (a != null) {
            return a;
        }
        if (b != null) {
            return b;
        }
        return c;
    }

    function currentDateArray(config) {
        // hooks is actually the exported moment object
        var nowValue = new Date(hooks.now());
        if (config._useUTC) {
            return [
                nowValue.getUTCFullYear(),
                nowValue.getUTCMonth(),
                nowValue.getUTCDate(),
            ];
        }
        return [nowValue.getFullYear(), nowValue.getMonth(), nowValue.getDate()];
    }

    // convert an array to a date.
    // the array should mirror the parameters below
    // note: all values past the year are optional and will default to the lowest possible value.
    // [year, month, day , hour, minute, second, millisecond]
    function configFromArray(config) {
        var i,
            date,
            input = [],
            currentDate,
            expectedWeekday,
            yearToUse;

        if (config._d) {
            return;
        }

        currentDate = currentDateArray(config);

        //compute day of the year from weeks and weekdays
        if (config._w && config._a[DATE] == null && config._a[MONTH] == null) {
            dayOfYearFromWeekInfo(config);
        }

        //if the day of the year is set, figure out what it is
        if (config._dayOfYear != null) {
            yearToUse = defaults(config._a[YEAR], currentDate[YEAR]);

            if (
                config._dayOfYear > daysInYear(yearToUse) ||
                config._dayOfYear === 0
            ) {
                getParsingFlags(config)._overflowDayOfYear = true;
            }

            date = createUTCDate(yearToUse, 0, config._dayOfYear);
            config._a[MONTH] = date.getUTCMonth();
            config._a[DATE] = date.getUTCDate();
        }

        // Default to current date.
        // * if no year, month, day of month are given, default to today
        // * if day of month is given, default month and year
        // * if month is given, default only year
        // * if year is given, don't default anything
        for (i = 0; i < 3 && config._a[i] == null; ++i) {
            config._a[i] = input[i] = currentDate[i];
        }

        // Zero out whatever was not defaulted, including time
        for (; i < 7; i++) {
            config._a[i] = input[i] =
                config._a[i] == null ? (i === 2 ? 1 : 0) : config._a[i];
        }

        // Check for 24:00:00.000
        if (
            config._a[HOUR] === 24 &&
            config._a[MINUTE] === 0 &&
            config._a[SECOND] === 0 &&
            config._a[MILLISECOND] === 0
        ) {
            config._nextDay = true;
            config._a[HOUR] = 0;
        }

        config._d = (config._useUTC ? createUTCDate : createDate).apply(
            null,
            input
        );
        expectedWeekday = config._useUTC
            ? config._d.getUTCDay()
            : config._d.getDay();

        // Apply timezone offset from input. The actual utcOffset can be changed
        // with parseZone.
        if (config._tzm != null) {
            config._d.setUTCMinutes(config._d.getUTCMinutes() - config._tzm);
        }

        if (config._nextDay) {
            config._a[HOUR] = 24;
        }

        // check for mismatching day of week
        if (
            config._w &&
            typeof config._w.d !== 'undefined' &&
            config._w.d !== expectedWeekday
        ) {
            getParsingFlags(config).weekdayMismatch = true;
        }
    }

    function dayOfYearFromWeekInfo(config) {
        var w, weekYear, week, weekday, dow, doy, temp, weekdayOverflow, curWeek;

        w = config._w;
        if (w.GG != null || w.W != null || w.E != null) {
            dow = 1;
            doy = 4;

            // TODO: We need to take the current isoWeekYear, but that depends on
            // how we interpret now (local, utc, fixed offset). So create
            // a now version of current config (take local/utc/offset flags, and
            // create now).
            weekYear = defaults(
                w.GG,
                config._a[YEAR],
                weekOfYear(createLocal(), 1, 4).year
            );
            week = defaults(w.W, 1);
            weekday = defaults(w.E, 1);
            if (weekday < 1 || weekday > 7) {
                weekdayOverflow = true;
            }
        } else {
            dow = config._locale._week.dow;
            doy = config._locale._week.doy;

            curWeek = weekOfYear(createLocal(), dow, doy);

            weekYear = defaults(w.gg, config._a[YEAR], curWeek.year);

            // Default to current week.
            week = defaults(w.w, curWeek.week);

            if (w.d != null) {
                // weekday -- low day numbers are considered next week
                weekday = w.d;
                if (weekday < 0 || weekday > 6) {
                    weekdayOverflow = true;
                }
            } else if (w.e != null) {
                // local weekday -- counting starts from beginning of week
                weekday = w.e + dow;
                if (w.e < 0 || w.e > 6) {
                    weekdayOverflow = true;
                }
            } else {
                // default to beginning of week
                weekday = dow;
            }
        }
        if (week < 1 || week > weeksInYear(weekYear, dow, doy)) {
            getParsingFlags(config)._overflowWeeks = true;
        } else if (weekdayOverflow != null) {
            getParsingFlags(config)._overflowWeekday = true;
        } else {
            temp = dayOfYearFromWeeks(weekYear, week, weekday, dow, doy);
            config._a[YEAR] = temp.year;
            config._dayOfYear = temp.dayOfYear;
        }
    }

    // constant that refers to the ISO standard
    hooks.ISO_8601 = function () {};

    // constant that refers to the RFC 2822 form
    hooks.RFC_2822 = function () {};

    // date from string and format string
    function configFromStringAndFormat(config) {
        // TODO: Move this to another part of the creation flow to prevent circular deps
        if (config._f === hooks.ISO_8601) {
            configFromISO(config);
            return;
        }
        if (config._f === hooks.RFC_2822) {
            configFromRFC2822(config);
            return;
        }
        config._a = [];
        getParsingFlags(config).empty = true;

        // This array is used to make a Date, either with `new Date` or `Date.UTC`
        var string = '' + config._i,
            i,
            parsedInput,
            tokens,
            token,
            skipped,
            stringLength = string.length,
            totalParsedInputLength = 0,
            era;

        tokens =
            expandFormat(config._f, config._locale).match(formattingTokens) || [];

        for (i = 0; i < tokens.length; i++) {
            token = tokens[i];
            parsedInput = (string.match(getParseRegexForToken(token, config)) ||
                [])[0];
            if (parsedInput) {
                skipped = string.substr(0, string.indexOf(parsedInput));
                if (skipped.length > 0) {
                    getParsingFlags(config).unusedInput.push(skipped);
                }
                string = string.slice(
                    string.indexOf(parsedInput) + parsedInput.length
                );
                totalParsedInputLength += parsedInput.length;
            }
            // don't parse if it's not a known token
            if (formatTokenFunctions[token]) {
                if (parsedInput) {
                    getParsingFlags(config).empty = false;
                } else {
                    getParsingFlags(config).unusedTokens.push(token);
                }
                addTimeToArrayFromToken(token, parsedInput, config);
            } else if (config._strict && !parsedInput) {
                getParsingFlags(config).unusedTokens.push(token);
            }
        }

        // add remaining unparsed input length to the string
        getParsingFlags(config).charsLeftOver =
            stringLength - totalParsedInputLength;
        if (string.length > 0) {
            getParsingFlags(config).unusedInput.push(string);
        }

        // clear _12h flag if hour is <= 12
        if (
            config._a[HOUR] <= 12 &&
            getParsingFlags(config).bigHour === true &&
            config._a[HOUR] > 0
        ) {
            getParsingFlags(config).bigHour = undefined;
        }

        getParsingFlags(config).parsedDateParts = config._a.slice(0);
        getParsingFlags(config).meridiem = config._meridiem;
        // handle meridiem
        config._a[HOUR] = meridiemFixWrap(
            config._locale,
            config._a[HOUR],
            config._meridiem
        );

        // handle era
        era = getParsingFlags(config).era;
        if (era !== null) {
            config._a[YEAR] = config._locale.erasConvertYear(era, config._a[YEAR]);
        }

        configFromArray(config);
        checkOverflow(config);
    }

    function meridiemFixWrap(locale, hour, meridiem) {
        var isPm;

        if (meridiem == null) {
            // nothing to do
            return hour;
        }
        if (locale.meridiemHour != null) {
            return locale.meridiemHour(hour, meridiem);
        } else if (locale.isPM != null) {
            // Fallback
            isPm = locale.isPM(meridiem);
            if (isPm && hour < 12) {
                hour += 12;
            }
            if (!isPm && hour === 12) {
                hour = 0;
            }
            return hour;
        } else {
            // this is not supposed to happen
            return hour;
        }
    }

    // date from string and array of format strings
    function configFromStringAndArray(config) {
        var tempConfig,
            bestMoment,
            scoreToBeat,
            i,
            currentScore,
            validFormatFound,
            bestFormatIsValid = false;

        if (config._f.length === 0) {
            getParsingFlags(config).invalidFormat = true;
            config._d = new Date(NaN);
            return;
        }

        for (i = 0; i < config._f.length; i++) {
            currentScore = 0;
            validFormatFound = false;
            tempConfig = copyConfig({}, config);
            if (config._useUTC != null) {
                tempConfig._useUTC = config._useUTC;
            }
            tempConfig._f = config._f[i];
            configFromStringAndFormat(tempConfig);

            if (isValid(tempConfig)) {
                validFormatFound = true;
            }

            // if there is any input that was not parsed add a penalty for that format
            currentScore += getParsingFlags(tempConfig).charsLeftOver;

            //or tokens
            currentScore += getParsingFlags(tempConfig).unusedTokens.length * 10;

            getParsingFlags(tempConfig).score = currentScore;

            if (!bestFormatIsValid) {
                if (
                    scoreToBeat == null ||
                    currentScore < scoreToBeat ||
                    validFormatFound
                ) {
                    scoreToBeat = currentScore;
                    bestMoment = tempConfig;
                    if (validFormatFound) {
                        bestFormatIsValid = true;
                    }
                }
            } else {
                if (currentScore < scoreToBeat) {
                    scoreToBeat = currentScore;
                    bestMoment = tempConfig;
                }
            }
        }

        extend(config, bestMoment || tempConfig);
    }

    function configFromObject(config) {
        if (config._d) {
            return;
        }

        var i = normalizeObjectUnits(config._i),
            dayOrDate = i.day === undefined ? i.date : i.day;
        config._a = map(
            [i.year, i.month, dayOrDate, i.hour, i.minute, i.second, i.millisecond],
            function (obj) {
                return obj && parseInt(obj, 10);
            }
        );

        configFromArray(config);
    }

    function createFromConfig(config) {
        var res = new Moment(checkOverflow(prepareConfig(config)));
        if (res._nextDay) {
            // Adding is smart enough around DST
            res.add(1, 'd');
            res._nextDay = undefined;
        }

        return res;
    }

    function prepareConfig(config) {
        var input = config._i,
            format = config._f;

        config._locale = config._locale || getLocale(config._l);

        if (input === null || (format === undefined && input === '')) {
            return createInvalid({ nullInput: true });
        }

        if (typeof input === 'string') {
            config._i = input = config._locale.preparse(input);
        }

        if (isMoment(input)) {
            return new Moment(checkOverflow(input));
        } else if (isDate(input)) {
            config._d = input;
        } else if (isArray(format)) {
            configFromStringAndArray(config);
        } else if (format) {
            configFromStringAndFormat(config);
        } else {
            configFromInput(config);
        }

        if (!isValid(config)) {
            config._d = null;
        }

        return config;
    }

    function configFromInput(config) {
        var input = config._i;
        if (isUndefined(input)) {
            config._d = new Date(hooks.now());
        } else if (isDate(input)) {
            config._d = new Date(input.valueOf());
        } else if (typeof input === 'string') {
            configFromString(config);
        } else if (isArray(input)) {
            config._a = map(input.slice(0), function (obj) {
                return parseInt(obj, 10);
            });
            configFromArray(config);
        } else if (isObject(input)) {
            configFromObject(config);
        } else if (isNumber(input)) {
            // from milliseconds
            config._d = new Date(input);
        } else {
            hooks.createFromInputFallback(config);
        }
    }

    function createLocalOrUTC(input, format, locale, strict, isUTC) {
        var c = {};

        if (format === true || format === false) {
            strict = format;
            format = undefined;
        }

        if (locale === true || locale === false) {
            strict = locale;
            locale = undefined;
        }

        if (
            (isObject(input) && isObjectEmpty(input)) ||
            (isArray(input) && input.length === 0)
        ) {
            input = undefined;
        }
        // object construction must be done this way.
        // https://github.com/moment/moment/issues/1423
        c._isAMomentObject = true;
        c._useUTC = c._isUTC = isUTC;
        c._l = locale;
        c._i = input;
        c._f = format;
        c._strict = strict;

        return createFromConfig(c);
    }

    function createLocal(input, format, locale, strict) {
        return createLocalOrUTC(input, format, locale, strict, false);
    }

    var prototypeMin = deprecate(
            'moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/',
            function () {
                var other = createLocal.apply(null, arguments);
                if (this.isValid() && other.isValid()) {
                    return other < this ? this : other;
                } else {
                    return createInvalid();
                }
            }
        ),
        prototypeMax = deprecate(
            'moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/',
            function () {
                var other = createLocal.apply(null, arguments);
                if (this.isValid() && other.isValid()) {
                    return other > this ? this : other;
                } else {
                    return createInvalid();
                }
            }
        );

    // Pick a moment m from moments so that m[fn](other) is true for all
    // other. This relies on the function fn to be transitive.
    //
    // moments should either be an array of moment objects or an array, whose
    // first element is an array of moment objects.
    function pickBy(fn, moments) {
        var res, i;
        if (moments.length === 1 && isArray(moments[0])) {
            moments = moments[0];
        }
        if (!moments.length) {
            return createLocal();
        }
        res = moments[0];
        for (i = 1; i < moments.length; ++i) {
            if (!moments[i].isValid() || moments[i][fn](res)) {
                res = moments[i];
            }
        }
        return res;
    }

    // TODO: Use [].sort instead?
    function min() {
        var args = [].slice.call(arguments, 0);

        return pickBy('isBefore', args);
    }

    function max() {
        var args = [].slice.call(arguments, 0);

        return pickBy('isAfter', args);
    }

    var now = function () {
        return Date.now ? Date.now() : +new Date();
    };

    var ordering = [
        'year',
        'quarter',
        'month',
        'week',
        'day',
        'hour',
        'minute',
        'second',
        'millisecond',
    ];

    function isDurationValid(m) {
        var key,
            unitHasDecimal = false,
            i;
        for (key in m) {
            if (
                hasOwnProp(m, key) &&
                !(
                    indexOf.call(ordering, key) !== -1 &&
                    (m[key] == null || !isNaN(m[key]))
                )
            ) {
                return false;
            }
        }

        for (i = 0; i < ordering.length; ++i) {
            if (m[ordering[i]]) {
                if (unitHasDecimal) {
                    return false; // only allow non-integers for smallest unit
                }
                if (parseFloat(m[ordering[i]]) !== toInt(m[ordering[i]])) {
                    unitHasDecimal = true;
                }
            }
        }

        return true;
    }

    function isValid$1() {
        return this._isValid;
    }

    function createInvalid$1() {
        return createDuration(NaN);
    }

    function Duration(duration) {
        var normalizedInput = normalizeObjectUnits(duration),
            years = normalizedInput.year || 0,
            quarters = normalizedInput.quarter || 0,
            months = normalizedInput.month || 0,
            weeks = normalizedInput.week || normalizedInput.isoWeek || 0,
            days = normalizedInput.day || 0,
            hours = normalizedInput.hour || 0,
            minutes = normalizedInput.minute || 0,
            seconds = normalizedInput.second || 0,
            milliseconds = normalizedInput.millisecond || 0;

        this._isValid = isDurationValid(normalizedInput);

        // representation for dateAddRemove
        this._milliseconds =
            +milliseconds +
            seconds * 1e3 + // 1000
            minutes * 6e4 + // 1000 * 60
            hours * 1000 * 60 * 60; //using 1000 * 60 * 60 instead of 36e5 to avoid floating point rounding errors https://github.com/moment/moment/issues/2978
        // Because of dateAddRemove treats 24 hours as different from a
        // day when working around DST, we need to store them separately
        this._days = +days + weeks * 7;
        // It is impossible to translate months into days without knowing
        // which months you are are talking about, so we have to store
        // it separately.
        this._months = +months + quarters * 3 + years * 12;

        this._data = {};

        this._locale = getLocale();

        this._bubble();
    }

    function isDuration(obj) {
        return obj instanceof Duration;
    }

    function absRound(number) {
        if (number < 0) {
            return Math.round(-1 * number) * -1;
        } else {
            return Math.round(number);
        }
    }

    // compare two arrays, return the number of differences
    function compareArrays(array1, array2, dontConvert) {
        var len = Math.min(array1.length, array2.length),
            lengthDiff = Math.abs(array1.length - array2.length),
            diffs = 0,
            i;
        for (i = 0; i < len; i++) {
            if (
                (dontConvert && array1[i] !== array2[i]) ||
                (!dontConvert && toInt(array1[i]) !== toInt(array2[i]))
            ) {
                diffs++;
            }
        }
        return diffs + lengthDiff;
    }

    // FORMATTING

    function offset(token, separator) {
        addFormatToken(token, 0, 0, function () {
            var offset = this.utcOffset(),
                sign = '+';
            if (offset < 0) {
                offset = -offset;
                sign = '-';
            }
            return (
                sign +
                zeroFill(~~(offset / 60), 2) +
                separator +
                zeroFill(~~offset % 60, 2)
            );
        });
    }

    offset('Z', ':');
    offset('ZZ', '');

    // PARSING

    addRegexToken('Z', matchShortOffset);
    addRegexToken('ZZ', matchShortOffset);
    addParseToken(['Z', 'ZZ'], function (input, array, config) {
        config._useUTC = true;
        config._tzm = offsetFromString(matchShortOffset, input);
    });

    // HELPERS

    // timezone chunker
    // '+10:00' > ['10',  '00']
    // '-1530'  > ['-15', '30']
    var chunkOffset = /([\+\-]|\d\d)/gi;

    function offsetFromString(matcher, string) {
        var matches = (string || '').match(matcher),
            chunk,
            parts,
            minutes;

        if (matches === null) {
            return null;
        }

        chunk = matches[matches.length - 1] || [];
        parts = (chunk + '').match(chunkOffset) || ['-', 0, 0];
        minutes = +(parts[1] * 60) + toInt(parts[2]);

        return minutes === 0 ? 0 : parts[0] === '+' ? minutes : -minutes;
    }

    // Return a moment from input, that is local/utc/zone equivalent to model.
    function cloneWithOffset(input, model) {
        var res, diff;
        if (model._isUTC) {
            res = model.clone();
            diff =
                (isMoment(input) || isDate(input)
                    ? input.valueOf()
                    : createLocal(input).valueOf()) - res.valueOf();
            // Use low-level api, because this fn is low-level api.
            res._d.setTime(res._d.valueOf() + diff);
            hooks.updateOffset(res, false);
            return res;
        } else {
            return createLocal(input).local();
        }
    }

    function getDateOffset(m) {
        // On Firefox.24 Date#getTimezoneOffset returns a floating point.
        // https://github.com/moment/moment/pull/1871
        return -Math.round(m._d.getTimezoneOffset());
    }

    // HOOKS

    // This function will be called whenever a moment is mutated.
    // It is intended to keep the offset in sync with the timezone.
    hooks.updateOffset = function () {};

    // MOMENTS

    // keepLocalTime = true means only change the timezone, without
    // affecting the local hour. So 5:31:26 +0300 --[utcOffset(2, true)]-->
    // 5:31:26 +0200 It is possible that 5:31:26 doesn't exist with offset
    // +0200, so we adjust the time as needed, to be valid.
    //
    // Keeping the time actually adds/subtracts (one hour)
    // from the actual represented time. That is why we call updateOffset
    // a second time. In case it wants us to change the offset again
    // _changeInProgress == true case, then we have to adjust, because
    // there is no such time in the given timezone.
    function getSetOffset(input, keepLocalTime, keepMinutes) {
        var offset = this._offset || 0,
            localAdjust;
        if (!this.isValid()) {
            return input != null ? this : NaN;
        }
        if (input != null) {
            if (typeof input === 'string') {
                input = offsetFromString(matchShortOffset, input);
                if (input === null) {
                    return this;
                }
            } else if (Math.abs(input) < 16 && !keepMinutes) {
                input = input * 60;
            }
            if (!this._isUTC && keepLocalTime) {
                localAdjust = getDateOffset(this);
            }
            this._offset = input;
            this._isUTC = true;
            if (localAdjust != null) {
                this.add(localAdjust, 'm');
            }
            if (offset !== input) {
                if (!keepLocalTime || this._changeInProgress) {
                    addSubtract(
                        this,
                        createDuration(input - offset, 'm'),
                        1,
                        false
                    );
                } else if (!this._changeInProgress) {
                    this._changeInProgress = true;
                    hooks.updateOffset(this, true);
                    this._changeInProgress = null;
                }
            }
            return this;
        } else {
            return this._isUTC ? offset : getDateOffset(this);
        }
    }

    function getSetZone(input, keepLocalTime) {
        if (input != null) {
            if (typeof input !== 'string') {
                input = -input;
            }

            this.utcOffset(input, keepLocalTime);

            return this;
        } else {
            return -this.utcOffset();
        }
    }

    function setOffsetToUTC(keepLocalTime) {
        return this.utcOffset(0, keepLocalTime);
    }

    function setOffsetToLocal(keepLocalTime) {
        if (this._isUTC) {
            this.utcOffset(0, keepLocalTime);
            this._isUTC = false;

            if (keepLocalTime) {
                this.subtract(getDateOffset(this), 'm');
            }
        }
        return this;
    }

    function setOffsetToParsedOffset() {
        if (this._tzm != null) {
            this.utcOffset(this._tzm, false, true);
        } else if (typeof this._i === 'string') {
            var tZone = offsetFromString(matchOffset, this._i);
            if (tZone != null) {
                this.utcOffset(tZone);
            } else {
                this.utcOffset(0, true);
            }
        }
        return this;
    }

    function hasAlignedHourOffset(input) {
        if (!this.isValid()) {
            return false;
        }
        input = input ? createLocal(input).utcOffset() : 0;

        return (this.utcOffset() - input) % 60 === 0;
    }

    function isDaylightSavingTime() {
        return (
            this.utcOffset() > this.clone().month(0).utcOffset() ||
            this.utcOffset() > this.clone().month(5).utcOffset()
        );
    }

    function isDaylightSavingTimeShifted() {
        if (!isUndefined(this._isDSTShifted)) {
            return this._isDSTShifted;
        }

        var c = {},
            other;

        copyConfig(c, this);
        c = prepareConfig(c);

        if (c._a) {
            other = c._isUTC ? createUTC(c._a) : createLocal(c._a);
            this._isDSTShifted =
                this.isValid() && compareArrays(c._a, other.toArray()) > 0;
        } else {
            this._isDSTShifted = false;
        }

        return this._isDSTShifted;
    }

    function isLocal() {
        return this.isValid() ? !this._isUTC : false;
    }

    function isUtcOffset() {
        return this.isValid() ? this._isUTC : false;
    }

    function isUtc() {
        return this.isValid() ? this._isUTC && this._offset === 0 : false;
    }

    // ASP.NET json date format regex
    var aspNetRegex = /^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,
        // from http://docs.closure-library.googlecode.com/git/closure_goog_date_date.js.source.html
        // somewhat more in line with 4.4.3.2 2004 spec, but allows decimal anywhere
        // and further modified to allow for strings containing both week and day
        isoRegex = /^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;

    function createDuration(input, key) {
        var duration = input,
            // matching against regexp is expensive, do it on demand
            match = null,
            sign,
            ret,
            diffRes;

        if (isDuration(input)) {
            duration = {
                ms: input._milliseconds,
                d: input._days,
                M: input._months,
            };
        } else if (isNumber(input) || !isNaN(+input)) {
            duration = {};
            if (key) {
                duration[key] = +input;
            } else {
                duration.milliseconds = +input;
            }
        } else if ((match = aspNetRegex.exec(input))) {
            sign = match[1] === '-' ? -1 : 1;
            duration = {
                y: 0,
                d: toInt(match[DATE]) * sign,
                h: toInt(match[HOUR]) * sign,
                m: toInt(match[MINUTE]) * sign,
                s: toInt(match[SECOND]) * sign,
                ms: toInt(absRound(match[MILLISECOND] * 1000)) * sign, // the millisecond decimal point is included in the match
            };
        } else if ((match = isoRegex.exec(input))) {
            sign = match[1] === '-' ? -1 : 1;
            duration = {
                y: parseIso(match[2], sign),
                M: parseIso(match[3], sign),
                w: parseIso(match[4], sign),
                d: parseIso(match[5], sign),
                h: parseIso(match[6], sign),
                m: parseIso(match[7], sign),
                s: parseIso(match[8], sign),
            };
        } else if (duration == null) {
            // checks for null or undefined
            duration = {};
        } else if (
            typeof duration === 'object' &&
            ('from' in duration || 'to' in duration)
        ) {
            diffRes = momentsDifference(
                createLocal(duration.from),
                createLocal(duration.to)
            );

            duration = {};
            duration.ms = diffRes.milliseconds;
            duration.M = diffRes.months;
        }

        ret = new Duration(duration);

        if (isDuration(input) && hasOwnProp(input, '_locale')) {
            ret._locale = input._locale;
        }

        if (isDuration(input) && hasOwnProp(input, '_isValid')) {
            ret._isValid = input._isValid;
        }

        return ret;
    }

    createDuration.fn = Duration.prototype;
    createDuration.invalid = createInvalid$1;

    function parseIso(inp, sign) {
        // We'd normally use ~~inp for this, but unfortunately it also
        // converts floats to ints.
        // inp may be undefined, so careful calling replace on it.
        var res = inp && parseFloat(inp.replace(',', '.'));
        // apply sign while we're at it
        return (isNaN(res) ? 0 : res) * sign;
    }

    function positiveMomentsDifference(base, other) {
        var res = {};

        res.months =
            other.month() - base.month() + (other.year() - base.year()) * 12;
        if (base.clone().add(res.months, 'M').isAfter(other)) {
            --res.months;
        }

        res.milliseconds = +other - +base.clone().add(res.months, 'M');

        return res;
    }

    function momentsDifference(base, other) {
        var res;
        if (!(base.isValid() && other.isValid())) {
            return { milliseconds: 0, months: 0 };
        }

        other = cloneWithOffset(other, base);
        if (base.isBefore(other)) {
            res = positiveMomentsDifference(base, other);
        } else {
            res = positiveMomentsDifference(other, base);
            res.milliseconds = -res.milliseconds;
            res.months = -res.months;
        }

        return res;
    }

    // TODO: remove 'name' arg after deprecation is removed
    function createAdder(direction, name) {
        return function (val, period) {
            var dur, tmp;
            //invert the arguments, but complain about it
            if (period !== null && !isNaN(+period)) {
                deprecateSimple(
                    name,
                    'moment().' +
                        name +
                        '(period, number) is deprecated. Please use moment().' +
                        name +
                        '(number, period). ' +
                        'See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.'
                );
                tmp = val;
                val = period;
                period = tmp;
            }

            dur = createDuration(val, period);
            addSubtract(this, dur, direction);
            return this;
        };
    }

    function addSubtract(mom, duration, isAdding, updateOffset) {
        var milliseconds = duration._milliseconds,
            days = absRound(duration._days),
            months = absRound(duration._months);

        if (!mom.isValid()) {
            // No op
            return;
        }

        updateOffset = updateOffset == null ? true : updateOffset;

        if (months) {
            setMonth(mom, get(mom, 'Month') + months * isAdding);
        }
        if (days) {
            set$1(mom, 'Date', get(mom, 'Date') + days * isAdding);
        }
        if (milliseconds) {
            mom._d.setTime(mom._d.valueOf() + milliseconds * isAdding);
        }
        if (updateOffset) {
            hooks.updateOffset(mom, days || months);
        }
    }

    var add = createAdder(1, 'add'),
        subtract = createAdder(-1, 'subtract');

    function isString(input) {
        return typeof input === 'string' || input instanceof String;
    }

    // type MomentInput = Moment | Date | string | number | (number | string)[] | MomentInputObject | void; // null | undefined
    function isMomentInput(input) {
        return (
            isMoment(input) ||
            isDate(input) ||
            isString(input) ||
            isNumber(input) ||
            isNumberOrStringArray(input) ||
            isMomentInputObject(input) ||
            input === null ||
            input === undefined
        );
    }

    function isMomentInputObject(input) {
        var objectTest = isObject(input) && !isObjectEmpty(input),
            propertyTest = false,
            properties = [
                'years',
                'year',
                'y',
                'months',
                'month',
                'M',
                'days',
                'day',
                'd',
                'dates',
                'date',
                'D',
                'hours',
                'hour',
                'h',
                'minutes',
                'minute',
                'm',
                'seconds',
                'second',
                's',
                'milliseconds',
                'millisecond',
                'ms',
            ],
            i,
            property;

        for (i = 0; i < properties.length; i += 1) {
            property = properties[i];
            propertyTest = propertyTest || hasOwnProp(input, property);
        }

        return objectTest && propertyTest;
    }

    function isNumberOrStringArray(input) {
        var arrayTest = isArray(input),
            dataTypeTest = false;
        if (arrayTest) {
            dataTypeTest =
                input.filter(function (item) {
                    return !isNumber(item) && isString(input);
                }).length === 0;
        }
        return arrayTest && dataTypeTest;
    }

    function isCalendarSpec(input) {
        var objectTest = isObject(input) && !isObjectEmpty(input),
            propertyTest = false,
            properties = [
                'sameDay',
                'nextDay',
                'lastDay',
                'nextWeek',
                'lastWeek',
                'sameElse',
            ],
            i,
            property;

        for (i = 0; i < properties.length; i += 1) {
            property = properties[i];
            propertyTest = propertyTest || hasOwnProp(input, property);
        }

        return objectTest && propertyTest;
    }

    function getCalendarFormat(myMoment, now) {
        var diff = myMoment.diff(now, 'days', true);
        return diff < -6
            ? 'sameElse'
            : diff < -1
            ? 'lastWeek'
            : diff < 0
            ? 'lastDay'
            : diff < 1
            ? 'sameDay'
            : diff < 2
            ? 'nextDay'
            : diff < 7
            ? 'nextWeek'
            : 'sameElse';
    }

    function calendar$1(time, formats) {
        // Support for single parameter, formats only overload to the calendar function
        if (arguments.length === 1) {
            if (!arguments[0]) {
                time = undefined;
                formats = undefined;
            } else if (isMomentInput(arguments[0])) {
                time = arguments[0];
                formats = undefined;
            } else if (isCalendarSpec(arguments[0])) {
                formats = arguments[0];
                time = undefined;
            }
        }
        // We want to compare the start of today, vs this.
        // Getting start-of-today depends on whether we're local/utc/offset or not.
        var now = time || createLocal(),
            sod = cloneWithOffset(now, this).startOf('day'),
            format = hooks.calendarFormat(this, sod) || 'sameElse',
            output =
                formats &&
                (isFunction(formats[format])
                    ? formats[format].call(this, now)
                    : formats[format]);

        return this.format(
            output || this.localeData().calendar(format, this, createLocal(now))
        );
    }

    function clone() {
        return new Moment(this);
    }

    function isAfter(input, units) {
        var localInput = isMoment(input) ? input : createLocal(input);
        if (!(this.isValid() && localInput.isValid())) {
            return false;
        }
        units = normalizeUnits(units) || 'millisecond';
        if (units === 'millisecond') {
            return this.valueOf() > localInput.valueOf();
        } else {
            return localInput.valueOf() < this.clone().startOf(units).valueOf();
        }
    }

    function isBefore(input, units) {
        var localInput = isMoment(input) ? input : createLocal(input);
        if (!(this.isValid() && localInput.isValid())) {
            return false;
        }
        units = normalizeUnits(units) || 'millisecond';
        if (units === 'millisecond') {
            return this.valueOf() < localInput.valueOf();
        } else {
            return this.clone().endOf(units).valueOf() < localInput.valueOf();
        }
    }

    function isBetween(from, to, units, inclusivity) {
        var localFrom = isMoment(from) ? from : createLocal(from),
            localTo = isMoment(to) ? to : createLocal(to);
        if (!(this.isValid() && localFrom.isValid() && localTo.isValid())) {
            return false;
        }
        inclusivity = inclusivity || '()';
        return (
            (inclusivity[0] === '('
                ? this.isAfter(localFrom, units)
                : !this.isBefore(localFrom, units)) &&
            (inclusivity[1] === ')'
                ? this.isBefore(localTo, units)
                : !this.isAfter(localTo, units))
        );
    }

    function isSame(input, units) {
        var localInput = isMoment(input) ? input : createLocal(input),
            inputMs;
        if (!(this.isValid() && localInput.isValid())) {
            return false;
        }
        units = normalizeUnits(units) || 'millisecond';
        if (units === 'millisecond') {
            return this.valueOf() === localInput.valueOf();
        } else {
            inputMs = localInput.valueOf();
            return (
                this.clone().startOf(units).valueOf() <= inputMs &&
                inputMs <= this.clone().endOf(units).valueOf()
            );
        }
    }

    function isSameOrAfter(input, units) {
        return this.isSame(input, units) || this.isAfter(input, units);
    }

    function isSameOrBefore(input, units) {
        return this.isSame(input, units) || this.isBefore(input, units);
    }

    function diff(input, units, asFloat) {
        var that, zoneDelta, output;

        if (!this.isValid()) {
            return NaN;
        }

        that = cloneWithOffset(input, this);

        if (!that.isValid()) {
            return NaN;
        }

        zoneDelta = (that.utcOffset() - this.utcOffset()) * 6e4;

        units = normalizeUnits(units);

        switch (units) {
            case 'year':
                output = monthDiff(this, that) / 12;
                break;
            case 'month':
                output = monthDiff(this, that);
                break;
            case 'quarter':
                output = monthDiff(this, that) / 3;
                break;
            case 'second':
                output = (this - that) / 1e3;
                break; // 1000
            case 'minute':
                output = (this - that) / 6e4;
                break; // 1000 * 60
            case 'hour':
                output = (this - that) / 36e5;
                break; // 1000 * 60 * 60
            case 'day':
                output = (this - that - zoneDelta) / 864e5;
                break; // 1000 * 60 * 60 * 24, negate dst
            case 'week':
                output = (this - that - zoneDelta) / 6048e5;
                break; // 1000 * 60 * 60 * 24 * 7, negate dst
            default:
                output = this - that;
        }

        return asFloat ? output : absFloor(output);
    }

    function monthDiff(a, b) {
        if (a.date() < b.date()) {
            // end-of-month calculations work correct when the start month has more
            // days than the end month.
            return -monthDiff(b, a);
        }
        // difference in months
        var wholeMonthDiff = (b.year() - a.year()) * 12 + (b.month() - a.month()),
            // b is in (anchor - 1 month, anchor + 1 month)
            anchor = a.clone().add(wholeMonthDiff, 'months'),
            anchor2,
            adjust;

        if (b - anchor < 0) {
            anchor2 = a.clone().add(wholeMonthDiff - 1, 'months');
            // linear across the month
            adjust = (b - anchor) / (anchor - anchor2);
        } else {
            anchor2 = a.clone().add(wholeMonthDiff + 1, 'months');
            // linear across the month
            adjust = (b - anchor) / (anchor2 - anchor);
        }

        //check for negative zero, return zero if negative zero
        return -(wholeMonthDiff + adjust) || 0;
    }

    hooks.defaultFormat = 'YYYY-MM-DDTHH:mm:ssZ';
    hooks.defaultFormatUtc = 'YYYY-MM-DDTHH:mm:ss[Z]';

    function toString() {
        return this.clone().locale('en').format('ddd MMM DD YYYY HH:mm:ss [GMT]ZZ');
    }

    function toISOString(keepOffset) {
        if (!this.isValid()) {
            return null;
        }
        var utc = keepOffset !== true,
            m = utc ? this.clone().utc() : this;
        if (m.year() < 0 || m.year() > 9999) {
            return formatMoment(
                m,
                utc
                    ? 'YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]'
                    : 'YYYYYY-MM-DD[T]HH:mm:ss.SSSZ'
            );
        }
        if (isFunction(Date.prototype.toISOString)) {
            // native implementation is ~50x faster, use it when we can
            if (utc) {
                return this.toDate().toISOString();
            } else {
                return new Date(this.valueOf() + this.utcOffset() * 60 * 1000)
                    .toISOString()
                    .replace('Z', formatMoment(m, 'Z'));
            }
        }
        return formatMoment(
            m,
            utc ? 'YYYY-MM-DD[T]HH:mm:ss.SSS[Z]' : 'YYYY-MM-DD[T]HH:mm:ss.SSSZ'
        );
    }

    /**
     * Return a human readable representation of a moment that can
     * also be evaluated to get a new moment which is the same
     *
     * @link https://nodejs.org/dist/latest/docs/api/util.html#util_custom_inspect_function_on_objects
     */
    function inspect() {
        if (!this.isValid()) {
            return 'moment.invalid(/* ' + this._i + ' */)';
        }
        var func = 'moment',
            zone = '',
            prefix,
            year,
            datetime,
            suffix;
        if (!this.isLocal()) {
            func = this.utcOffset() === 0 ? 'moment.utc' : 'moment.parseZone';
            zone = 'Z';
        }
        prefix = '[' + func + '("]';
        year = 0 <= this.year() && this.year() <= 9999 ? 'YYYY' : 'YYYYYY';
        datetime = '-MM-DD[T]HH:mm:ss.SSS';
        suffix = zone + '[")]';

        return this.format(prefix + year + datetime + suffix);
    }

    function format(inputString) {
        if (!inputString) {
            inputString = this.isUtc()
                ? hooks.defaultFormatUtc
                : hooks.defaultFormat;
        }
        var output = formatMoment(this, inputString);
        return this.localeData().postformat(output);
    }

    function from(time, withoutSuffix) {
        if (
            this.isValid() &&
            ((isMoment(time) && time.isValid()) || createLocal(time).isValid())
        ) {
            return createDuration({ to: this, from: time })
                .locale(this.locale())
                .humanize(!withoutSuffix);
        } else {
            return this.localeData().invalidDate();
        }
    }

    function fromNow(withoutSuffix) {
        return this.from(createLocal(), withoutSuffix);
    }

    function to(time, withoutSuffix) {
        if (
            this.isValid() &&
            ((isMoment(time) && time.isValid()) || createLocal(time).isValid())
        ) {
            return createDuration({ from: this, to: time })
                .locale(this.locale())
                .humanize(!withoutSuffix);
        } else {
            return this.localeData().invalidDate();
        }
    }

    function toNow(withoutSuffix) {
        return this.to(createLocal(), withoutSuffix);
    }

    // If passed a locale key, it will set the locale for this
    // instance.  Otherwise, it will return the locale configuration
    // variables for this instance.
    function locale(key) {
        var newLocaleData;

        if (key === undefined) {
            return this._locale._abbr;
        } else {
            newLocaleData = getLocale(key);
            if (newLocaleData != null) {
                this._locale = newLocaleData;
            }
            return this;
        }
    }

    var lang = deprecate(
        'moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.',
        function (key) {
            if (key === undefined) {
                return this.localeData();
            } else {
                return this.locale(key);
            }
        }
    );

    function localeData() {
        return this._locale;
    }

    var MS_PER_SECOND = 1000,
        MS_PER_MINUTE = 60 * MS_PER_SECOND,
        MS_PER_HOUR = 60 * MS_PER_MINUTE,
        MS_PER_400_YEARS = (365 * 400 + 97) * 24 * MS_PER_HOUR;

    // actual modulo - handles negative numbers (for dates before 1970):
    function mod$1(dividend, divisor) {
        return ((dividend % divisor) + divisor) % divisor;
    }

    function localStartOfDate(y, m, d) {
        // the date constructor remaps years 0-99 to 1900-1999
        if (y < 100 && y >= 0) {
            // preserve leap years using a full 400 year cycle, then reset
            return new Date(y + 400, m, d) - MS_PER_400_YEARS;
        } else {
            return new Date(y, m, d).valueOf();
        }
    }

    function utcStartOfDate(y, m, d) {
        // Date.UTC remaps years 0-99 to 1900-1999
        if (y < 100 && y >= 0) {
            // preserve leap years using a full 400 year cycle, then reset
            return Date.UTC(y + 400, m, d) - MS_PER_400_YEARS;
        } else {
            return Date.UTC(y, m, d);
        }
    }

    function startOf(units) {
        var time, startOfDate;
        units = normalizeUnits(units);
        if (units === undefined || units === 'millisecond' || !this.isValid()) {
            return this;
        }

        startOfDate = this._isUTC ? utcStartOfDate : localStartOfDate;

        switch (units) {
            case 'year':
                time = startOfDate(this.year(), 0, 1);
                break;
            case 'quarter':
                time = startOfDate(
                    this.year(),
                    this.month() - (this.month() % 3),
                    1
                );
                break;
            case 'month':
                time = startOfDate(this.year(), this.month(), 1);
                break;
            case 'week':
                time = startOfDate(
                    this.year(),
                    this.month(),
                    this.date() - this.weekday()
                );
                break;
            case 'isoWeek':
                time = startOfDate(
                    this.year(),
                    this.month(),
                    this.date() - (this.isoWeekday() - 1)
                );
                break;
            case 'day':
            case 'date':
                time = startOfDate(this.year(), this.month(), this.date());
                break;
            case 'hour':
                time = this._d.valueOf();
                time -= mod$1(
                    time + (this._isUTC ? 0 : this.utcOffset() * MS_PER_MINUTE),
                    MS_PER_HOUR
                );
                break;
            case 'minute':
                time = this._d.valueOf();
                time -= mod$1(time, MS_PER_MINUTE);
                break;
            case 'second':
                time = this._d.valueOf();
                time -= mod$1(time, MS_PER_SECOND);
                break;
        }

        this._d.setTime(time);
        hooks.updateOffset(this, true);
        return this;
    }

    function endOf(units) {
        var time, startOfDate;
        units = normalizeUnits(units);
        if (units === undefined || units === 'millisecond' || !this.isValid()) {
            return this;
        }

        startOfDate = this._isUTC ? utcStartOfDate : localStartOfDate;

        switch (units) {
            case 'year':
                time = startOfDate(this.year() + 1, 0, 1) - 1;
                break;
            case 'quarter':
                time =
                    startOfDate(
                        this.year(),
                        this.month() - (this.month() % 3) + 3,
                        1
                    ) - 1;
                break;
            case 'month':
                time = startOfDate(this.year(), this.month() + 1, 1) - 1;
                break;
            case 'week':
                time =
                    startOfDate(
                        this.year(),
                        this.month(),
                        this.date() - this.weekday() + 7
                    ) - 1;
                break;
            case 'isoWeek':
                time =
                    startOfDate(
                        this.year(),
                        this.month(),
                        this.date() - (this.isoWeekday() - 1) + 7
                    ) - 1;
                break;
            case 'day':
            case 'date':
                time = startOfDate(this.year(), this.month(), this.date() + 1) - 1;
                break;
            case 'hour':
                time = this._d.valueOf();
                time +=
                    MS_PER_HOUR -
                    mod$1(
                        time + (this._isUTC ? 0 : this.utcOffset() * MS_PER_MINUTE),
                        MS_PER_HOUR
                    ) -
                    1;
                break;
            case 'minute':
                time = this._d.valueOf();
                time += MS_PER_MINUTE - mod$1(time, MS_PER_MINUTE) - 1;
                break;
            case 'second':
                time = this._d.valueOf();
                time += MS_PER_SECOND - mod$1(time, MS_PER_SECOND) - 1;
                break;
        }

        this._d.setTime(time);
        hooks.updateOffset(this, true);
        return this;
    }

    function valueOf() {
        return this._d.valueOf() - (this._offset || 0) * 60000;
    }

    function unix() {
        return Math.floor(this.valueOf() / 1000);
    }

    function toDate() {
        return new Date(this.valueOf());
    }

    function toArray() {
        var m = this;
        return [
            m.year(),
            m.month(),
            m.date(),
            m.hour(),
            m.minute(),
            m.second(),
            m.millisecond(),
        ];
    }

    function toObject() {
        var m = this;
        return {
            years: m.year(),
            months: m.month(),
            date: m.date(),
            hours: m.hours(),
            minutes: m.minutes(),
            seconds: m.seconds(),
            milliseconds: m.milliseconds(),
        };
    }

    function toJSON() {
        // new Date(NaN).toJSON() === null
        return this.isValid() ? this.toISOString() : null;
    }

    function isValid$2() {
        return isValid(this);
    }

    function parsingFlags() {
        return extend({}, getParsingFlags(this));
    }

    function invalidAt() {
        return getParsingFlags(this).overflow;
    }

    function creationData() {
        return {
            input: this._i,
            format: this._f,
            locale: this._locale,
            isUTC: this._isUTC,
            strict: this._strict,
        };
    }

    addFormatToken('N', 0, 0, 'eraAbbr');
    addFormatToken('NN', 0, 0, 'eraAbbr');
    addFormatToken('NNN', 0, 0, 'eraAbbr');
    addFormatToken('NNNN', 0, 0, 'eraName');
    addFormatToken('NNNNN', 0, 0, 'eraNarrow');

    addFormatToken('y', ['y', 1], 'yo', 'eraYear');
    addFormatToken('y', ['yy', 2], 0, 'eraYear');
    addFormatToken('y', ['yyy', 3], 0, 'eraYear');
    addFormatToken('y', ['yyyy', 4], 0, 'eraYear');

    addRegexToken('N', matchEraAbbr);
    addRegexToken('NN', matchEraAbbr);
    addRegexToken('NNN', matchEraAbbr);
    addRegexToken('NNNN', matchEraName);
    addRegexToken('NNNNN', matchEraNarrow);

    addParseToken(['N', 'NN', 'NNN', 'NNNN', 'NNNNN'], function (
        input,
        array,
        config,
        token
    ) {
        var era = config._locale.erasParse(input, token, config._strict);
        if (era) {
            getParsingFlags(config).era = era;
        } else {
            getParsingFlags(config).invalidEra = input;
        }
    });

    addRegexToken('y', matchUnsigned);
    addRegexToken('yy', matchUnsigned);
    addRegexToken('yyy', matchUnsigned);
    addRegexToken('yyyy', matchUnsigned);
    addRegexToken('yo', matchEraYearOrdinal);

    addParseToken(['y', 'yy', 'yyy', 'yyyy'], YEAR);
    addParseToken(['yo'], function (input, array, config, token) {
        var match;
        if (config._locale._eraYearOrdinalRegex) {
            match = input.match(config._locale._eraYearOrdinalRegex);
        }

        if (config._locale.eraYearOrdinalParse) {
            array[YEAR] = config._locale.eraYearOrdinalParse(input, match);
        } else {
            array[YEAR] = parseInt(input, 10);
        }
    });

    function localeEras(m, format) {
        var i,
            l,
            date,
            eras = this._eras || getLocale('en')._eras;
        for (i = 0, l = eras.length; i < l; ++i) {
            switch (typeof eras[i].since) {
                case 'string':
                    // truncate time
                    date = hooks(eras[i].since).startOf('day');
                    eras[i].since = date.valueOf();
                    break;
            }

            switch (typeof eras[i].until) {
                case 'undefined':
                    eras[i].until = +Infinity;
                    break;
                case 'string':
                    // truncate time
                    date = hooks(eras[i].until).startOf('day').valueOf();
                    eras[i].until = date.valueOf();
                    break;
            }
        }
        return eras;
    }

    function localeErasParse(eraName, format, strict) {
        var i,
            l,
            eras = this.eras(),
            name,
            abbr,
            narrow;
        eraName = eraName.toUpperCase();

        for (i = 0, l = eras.length; i < l; ++i) {
            name = eras[i].name.toUpperCase();
            abbr = eras[i].abbr.toUpperCase();
            narrow = eras[i].narrow.toUpperCase();

            if (strict) {
                switch (format) {
                    case 'N':
                    case 'NN':
                    case 'NNN':
                        if (abbr === eraName) {
                            return eras[i];
                        }
                        break;

                    case 'NNNN':
                        if (name === eraName) {
                            return eras[i];
                        }
                        break;

                    case 'NNNNN':
                        if (narrow === eraName) {
                            return eras[i];
                        }
                        break;
                }
            } else if ([name, abbr, narrow].indexOf(eraName) >= 0) {
                return eras[i];
            }
        }
    }

    function localeErasConvertYear(era, year) {
        var dir = era.since <= era.until ? +1 : -1;
        if (year === undefined) {
            return hooks(era.since).year();
        } else {
            return hooks(era.since).year() + (year - era.offset) * dir;
        }
    }

    function getEraName() {
        var i,
            l,
            val,
            eras = this.localeData().eras();
        for (i = 0, l = eras.length; i < l; ++i) {
            // truncate time
            val = this.clone().startOf('day').valueOf();

            if (eras[i].since <= val && val <= eras[i].until) {
                return eras[i].name;
            }
            if (eras[i].until <= val && val <= eras[i].since) {
                return eras[i].name;
            }
        }

        return '';
    }

    function getEraNarrow() {
        var i,
            l,
            val,
            eras = this.localeData().eras();
        for (i = 0, l = eras.length; i < l; ++i) {
            // truncate time
            val = this.clone().startOf('day').valueOf();

            if (eras[i].since <= val && val <= eras[i].until) {
                return eras[i].narrow;
            }
            if (eras[i].until <= val && val <= eras[i].since) {
                return eras[i].narrow;
            }
        }

        return '';
    }

    function getEraAbbr() {
        var i,
            l,
            val,
            eras = this.localeData().eras();
        for (i = 0, l = eras.length; i < l; ++i) {
            // truncate time
            val = this.clone().startOf('day').valueOf();

            if (eras[i].since <= val && val <= eras[i].until) {
                return eras[i].abbr;
            }
            if (eras[i].until <= val && val <= eras[i].since) {
                return eras[i].abbr;
            }
        }

        return '';
    }

    function getEraYear() {
        var i,
            l,
            dir,
            val,
            eras = this.localeData().eras();
        for (i = 0, l = eras.length; i < l; ++i) {
            dir = eras[i].since <= eras[i].until ? +1 : -1;

            // truncate time
            val = this.clone().startOf('day').valueOf();

            if (
                (eras[i].since <= val && val <= eras[i].until) ||
                (eras[i].until <= val && val <= eras[i].since)
            ) {
                return (
                    (this.year() - hooks(eras[i].since).year()) * dir +
                    eras[i].offset
                );
            }
        }

        return this.year();
    }

    function erasNameRegex(isStrict) {
        if (!hasOwnProp(this, '_erasNameRegex')) {
            computeErasParse.call(this);
        }
        return isStrict ? this._erasNameRegex : this._erasRegex;
    }

    function erasAbbrRegex(isStrict) {
        if (!hasOwnProp(this, '_erasAbbrRegex')) {
            computeErasParse.call(this);
        }
        return isStrict ? this._erasAbbrRegex : this._erasRegex;
    }

    function erasNarrowRegex(isStrict) {
        if (!hasOwnProp(this, '_erasNarrowRegex')) {
            computeErasParse.call(this);
        }
        return isStrict ? this._erasNarrowRegex : this._erasRegex;
    }

    function matchEraAbbr(isStrict, locale) {
        return locale.erasAbbrRegex(isStrict);
    }

    function matchEraName(isStrict, locale) {
        return locale.erasNameRegex(isStrict);
    }

    function matchEraNarrow(isStrict, locale) {
        return locale.erasNarrowRegex(isStrict);
    }

    function matchEraYearOrdinal(isStrict, locale) {
        return locale._eraYearOrdinalRegex || matchUnsigned;
    }

    function computeErasParse() {
        var abbrPieces = [],
            namePieces = [],
            narrowPieces = [],
            mixedPieces = [],
            i,
            l,
            eras = this.eras();

        for (i = 0, l = eras.length; i < l; ++i) {
            namePieces.push(regexEscape(eras[i].name));
            abbrPieces.push(regexEscape(eras[i].abbr));
            narrowPieces.push(regexEscape(eras[i].narrow));

            mixedPieces.push(regexEscape(eras[i].name));
            mixedPieces.push(regexEscape(eras[i].abbr));
            mixedPieces.push(regexEscape(eras[i].narrow));
        }

        this._erasRegex = new RegExp('^(' + mixedPieces.join('|') + ')', 'i');
        this._erasNameRegex = new RegExp('^(' + namePieces.join('|') + ')', 'i');
        this._erasAbbrRegex = new RegExp('^(' + abbrPieces.join('|') + ')', 'i');
        this._erasNarrowRegex = new RegExp(
            '^(' + narrowPieces.join('|') + ')',
            'i'
        );
    }

    // FORMATTING

    addFormatToken(0, ['gg', 2], 0, function () {
        return this.weekYear() % 100;
    });

    addFormatToken(0, ['GG', 2], 0, function () {
        return this.isoWeekYear() % 100;
    });

    function addWeekYearFormatToken(token, getter) {
        addFormatToken(0, [token, token.length], 0, getter);
    }

    addWeekYearFormatToken('gggg', 'weekYear');
    addWeekYearFormatToken('ggggg', 'weekYear');
    addWeekYearFormatToken('GGGG', 'isoWeekYear');
    addWeekYearFormatToken('GGGGG', 'isoWeekYear');

    // ALIASES

    addUnitAlias('weekYear', 'gg');
    addUnitAlias('isoWeekYear', 'GG');

    // PRIORITY

    addUnitPriority('weekYear', 1);
    addUnitPriority('isoWeekYear', 1);

    // PARSING

    addRegexToken('G', matchSigned);
    addRegexToken('g', matchSigned);
    addRegexToken('GG', match1to2, match2);
    addRegexToken('gg', match1to2, match2);
    addRegexToken('GGGG', match1to4, match4);
    addRegexToken('gggg', match1to4, match4);
    addRegexToken('GGGGG', match1to6, match6);
    addRegexToken('ggggg', match1to6, match6);

    addWeekParseToken(['gggg', 'ggggg', 'GGGG', 'GGGGG'], function (
        input,
        week,
        config,
        token
    ) {
        week[token.substr(0, 2)] = toInt(input);
    });

    addWeekParseToken(['gg', 'GG'], function (input, week, config, token) {
        week[token] = hooks.parseTwoDigitYear(input);
    });

    // MOMENTS

    function getSetWeekYear(input) {
        return getSetWeekYearHelper.call(
            this,
            input,
            this.week(),
            this.weekday(),
            this.localeData()._week.dow,
            this.localeData()._week.doy
        );
    }

    function getSetISOWeekYear(input) {
        return getSetWeekYearHelper.call(
            this,
            input,
            this.isoWeek(),
            this.isoWeekday(),
            1,
            4
        );
    }

    function getISOWeeksInYear() {
        return weeksInYear(this.year(), 1, 4);
    }

    function getISOWeeksInISOWeekYear() {
        return weeksInYear(this.isoWeekYear(), 1, 4);
    }

    function getWeeksInYear() {
        var weekInfo = this.localeData()._week;
        return weeksInYear(this.year(), weekInfo.dow, weekInfo.doy);
    }

    function getWeeksInWeekYear() {
        var weekInfo = this.localeData()._week;
        return weeksInYear(this.weekYear(), weekInfo.dow, weekInfo.doy);
    }

    function getSetWeekYearHelper(input, week, weekday, dow, doy) {
        var weeksTarget;
        if (input == null) {
            return weekOfYear(this, dow, doy).year;
        } else {
            weeksTarget = weeksInYear(input, dow, doy);
            if (week > weeksTarget) {
                week = weeksTarget;
            }
            return setWeekAll.call(this, input, week, weekday, dow, doy);
        }
    }

    function setWeekAll(weekYear, week, weekday, dow, doy) {
        var dayOfYearData = dayOfYearFromWeeks(weekYear, week, weekday, dow, doy),
            date = createUTCDate(dayOfYearData.year, 0, dayOfYearData.dayOfYear);

        this.year(date.getUTCFullYear());
        this.month(date.getUTCMonth());
        this.date(date.getUTCDate());
        return this;
    }

    // FORMATTING

    addFormatToken('Q', 0, 'Qo', 'quarter');

    // ALIASES

    addUnitAlias('quarter', 'Q');

    // PRIORITY

    addUnitPriority('quarter', 7);

    // PARSING

    addRegexToken('Q', match1);
    addParseToken('Q', function (input, array) {
        array[MONTH] = (toInt(input) - 1) * 3;
    });

    // MOMENTS

    function getSetQuarter(input) {
        return input == null
            ? Math.ceil((this.month() + 1) / 3)
            : this.month((input - 1) * 3 + (this.month() % 3));
    }

    // FORMATTING

    addFormatToken('D', ['DD', 2], 'Do', 'date');

    // ALIASES

    addUnitAlias('date', 'D');

    // PRIORITY
    addUnitPriority('date', 9);

    // PARSING

    addRegexToken('D', match1to2);
    addRegexToken('DD', match1to2, match2);
    addRegexToken('Do', function (isStrict, locale) {
        // TODO: Remove "ordinalParse" fallback in next major release.
        return isStrict
            ? locale._dayOfMonthOrdinalParse || locale._ordinalParse
            : locale._dayOfMonthOrdinalParseLenient;
    });

    addParseToken(['D', 'DD'], DATE);
    addParseToken('Do', function (input, array) {
        array[DATE] = toInt(input.match(match1to2)[0]);
    });

    // MOMENTS

    var getSetDayOfMonth = makeGetSet('Date', true);

    // FORMATTING

    addFormatToken('DDD', ['DDDD', 3], 'DDDo', 'dayOfYear');

    // ALIASES

    addUnitAlias('dayOfYear', 'DDD');

    // PRIORITY
    addUnitPriority('dayOfYear', 4);

    // PARSING

    addRegexToken('DDD', match1to3);
    addRegexToken('DDDD', match3);
    addParseToken(['DDD', 'DDDD'], function (input, array, config) {
        config._dayOfYear = toInt(input);
    });

    // HELPERS

    // MOMENTS

    function getSetDayOfYear(input) {
        var dayOfYear =
            Math.round(
                (this.clone().startOf('day') - this.clone().startOf('year')) / 864e5
            ) + 1;
        return input == null ? dayOfYear : this.add(input - dayOfYear, 'd');
    }

    // FORMATTING

    addFormatToken('m', ['mm', 2], 0, 'minute');

    // ALIASES

    addUnitAlias('minute', 'm');

    // PRIORITY

    addUnitPriority('minute', 14);

    // PARSING

    addRegexToken('m', match1to2);
    addRegexToken('mm', match1to2, match2);
    addParseToken(['m', 'mm'], MINUTE);

    // MOMENTS

    var getSetMinute = makeGetSet('Minutes', false);

    // FORMATTING

    addFormatToken('s', ['ss', 2], 0, 'second');

    // ALIASES

    addUnitAlias('second', 's');

    // PRIORITY

    addUnitPriority('second', 15);

    // PARSING

    addRegexToken('s', match1to2);
    addRegexToken('ss', match1to2, match2);
    addParseToken(['s', 'ss'], SECOND);

    // MOMENTS

    var getSetSecond = makeGetSet('Seconds', false);

    // FORMATTING

    addFormatToken('S', 0, 0, function () {
        return ~~(this.millisecond() / 100);
    });

    addFormatToken(0, ['SS', 2], 0, function () {
        return ~~(this.millisecond() / 10);
    });

    addFormatToken(0, ['SSS', 3], 0, 'millisecond');
    addFormatToken(0, ['SSSS', 4], 0, function () {
        return this.millisecond() * 10;
    });
    addFormatToken(0, ['SSSSS', 5], 0, function () {
        return this.millisecond() * 100;
    });
    addFormatToken(0, ['SSSSSS', 6], 0, function () {
        return this.millisecond() * 1000;
    });
    addFormatToken(0, ['SSSSSSS', 7], 0, function () {
        return this.millisecond() * 10000;
    });
    addFormatToken(0, ['SSSSSSSS', 8], 0, function () {
        return this.millisecond() * 100000;
    });
    addFormatToken(0, ['SSSSSSSSS', 9], 0, function () {
        return this.millisecond() * 1000000;
    });

    // ALIASES

    addUnitAlias('millisecond', 'ms');

    // PRIORITY

    addUnitPriority('millisecond', 16);

    // PARSING

    addRegexToken('S', match1to3, match1);
    addRegexToken('SS', match1to3, match2);
    addRegexToken('SSS', match1to3, match3);

    var token, getSetMillisecond;
    for (token = 'SSSS'; token.length <= 9; token += 'S') {
        addRegexToken(token, matchUnsigned);
    }

    function parseMs(input, array) {
        array[MILLISECOND] = toInt(('0.' + input) * 1000);
    }

    for (token = 'S'; token.length <= 9; token += 'S') {
        addParseToken(token, parseMs);
    }

    getSetMillisecond = makeGetSet('Milliseconds', false);

    // FORMATTING

    addFormatToken('z', 0, 0, 'zoneAbbr');
    addFormatToken('zz', 0, 0, 'zoneName');

    // MOMENTS

    function getZoneAbbr() {
        return this._isUTC ? 'UTC' : '';
    }

    function getZoneName() {
        return this._isUTC ? 'Coordinated Universal Time' : '';
    }

    var proto = Moment.prototype;

    proto.add = add;
    proto.calendar = calendar$1;
    proto.clone = clone;
    proto.diff = diff;
    proto.endOf = endOf;
    proto.format = format;
    proto.from = from;
    proto.fromNow = fromNow;
    proto.to = to;
    proto.toNow = toNow;
    proto.get = stringGet;
    proto.invalidAt = invalidAt;
    proto.isAfter = isAfter;
    proto.isBefore = isBefore;
    proto.isBetween = isBetween;
    proto.isSame = isSame;
    proto.isSameOrAfter = isSameOrAfter;
    proto.isSameOrBefore = isSameOrBefore;
    proto.isValid = isValid$2;
    proto.lang = lang;
    proto.locale = locale;
    proto.localeData = localeData;
    proto.max = prototypeMax;
    proto.min = prototypeMin;
    proto.parsingFlags = parsingFlags;
    proto.set = stringSet;
    proto.startOf = startOf;
    proto.subtract = subtract;
    proto.toArray = toArray;
    proto.toObject = toObject;
    proto.toDate = toDate;
    proto.toISOString = toISOString;
    proto.inspect = inspect;
    if (typeof Symbol !== 'undefined' && Symbol.for != null) {
        proto[Symbol.for('nodejs.util.inspect.custom')] = function () {
            return 'Moment<' + this.format() + '>';
        };
    }
    proto.toJSON = toJSON;
    proto.toString = toString;
    proto.unix = unix;
    proto.valueOf = valueOf;
    proto.creationData = creationData;
    proto.eraName = getEraName;
    proto.eraNarrow = getEraNarrow;
    proto.eraAbbr = getEraAbbr;
    proto.eraYear = getEraYear;
    proto.year = getSetYear;
    proto.isLeapYear = getIsLeapYear;
    proto.weekYear = getSetWeekYear;
    proto.isoWeekYear = getSetISOWeekYear;
    proto.quarter = proto.quarters = getSetQuarter;
    proto.month = getSetMonth;
    proto.daysInMonth = getDaysInMonth;
    proto.week = proto.weeks = getSetWeek;
    proto.isoWeek = proto.isoWeeks = getSetISOWeek;
    proto.weeksInYear = getWeeksInYear;
    proto.weeksInWeekYear = getWeeksInWeekYear;
    proto.isoWeeksInYear = getISOWeeksInYear;
    proto.isoWeeksInISOWeekYear = getISOWeeksInISOWeekYear;
    proto.date = getSetDayOfMonth;
    proto.day = proto.days = getSetDayOfWeek;
    proto.weekday = getSetLocaleDayOfWeek;
    proto.isoWeekday = getSetISODayOfWeek;
    proto.dayOfYear = getSetDayOfYear;
    proto.hour = proto.hours = getSetHour;
    proto.minute = proto.minutes = getSetMinute;
    proto.second = proto.seconds = getSetSecond;
    proto.millisecond = proto.milliseconds = getSetMillisecond;
    proto.utcOffset = getSetOffset;
    proto.utc = setOffsetToUTC;
    proto.local = setOffsetToLocal;
    proto.parseZone = setOffsetToParsedOffset;
    proto.hasAlignedHourOffset = hasAlignedHourOffset;
    proto.isDST = isDaylightSavingTime;
    proto.isLocal = isLocal;
    proto.isUtcOffset = isUtcOffset;
    proto.isUtc = isUtc;
    proto.isUTC = isUtc;
    proto.zoneAbbr = getZoneAbbr;
    proto.zoneName = getZoneName;
    proto.dates = deprecate(
        'dates accessor is deprecated. Use date instead.',
        getSetDayOfMonth
    );
    proto.months = deprecate(
        'months accessor is deprecated. Use month instead',
        getSetMonth
    );
    proto.years = deprecate(
        'years accessor is deprecated. Use year instead',
        getSetYear
    );
    proto.zone = deprecate(
        'moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/',
        getSetZone
    );
    proto.isDSTShifted = deprecate(
        'isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information',
        isDaylightSavingTimeShifted
    );

    function createUnix(input) {
        return createLocal(input * 1000);
    }

    function createInZone() {
        return createLocal.apply(null, arguments).parseZone();
    }

    function preParsePostFormat(string) {
        return string;
    }

    var proto$1 = Locale.prototype;

    proto$1.calendar = calendar;
    proto$1.longDateFormat = longDateFormat;
    proto$1.invalidDate = invalidDate;
    proto$1.ordinal = ordinal;
    proto$1.preparse = preParsePostFormat;
    proto$1.postformat = preParsePostFormat;
    proto$1.relativeTime = relativeTime;
    proto$1.pastFuture = pastFuture;
    proto$1.set = set;
    proto$1.eras = localeEras;
    proto$1.erasParse = localeErasParse;
    proto$1.erasConvertYear = localeErasConvertYear;
    proto$1.erasAbbrRegex = erasAbbrRegex;
    proto$1.erasNameRegex = erasNameRegex;
    proto$1.erasNarrowRegex = erasNarrowRegex;

    proto$1.months = localeMonths;
    proto$1.monthsShort = localeMonthsShort;
    proto$1.monthsParse = localeMonthsParse;
    proto$1.monthsRegex = monthsRegex;
    proto$1.monthsShortRegex = monthsShortRegex;
    proto$1.week = localeWeek;
    proto$1.firstDayOfYear = localeFirstDayOfYear;
    proto$1.firstDayOfWeek = localeFirstDayOfWeek;

    proto$1.weekdays = localeWeekdays;
    proto$1.weekdaysMin = localeWeekdaysMin;
    proto$1.weekdaysShort = localeWeekdaysShort;
    proto$1.weekdaysParse = localeWeekdaysParse;

    proto$1.weekdaysRegex = weekdaysRegex;
    proto$1.weekdaysShortRegex = weekdaysShortRegex;
    proto$1.weekdaysMinRegex = weekdaysMinRegex;

    proto$1.isPM = localeIsPM;
    proto$1.meridiem = localeMeridiem;

    function get$1(format, index, field, setter) {
        var locale = getLocale(),
            utc = createUTC().set(setter, index);
        return locale[field](utc, format);
    }

    function listMonthsImpl(format, index, field) {
        if (isNumber(format)) {
            index = format;
            format = undefined;
        }

        format = format || '';

        if (index != null) {
            return get$1(format, index, field, 'month');
        }

        var i,
            out = [];
        for (i = 0; i < 12; i++) {
            out[i] = get$1(format, i, field, 'month');
        }
        return out;
    }

    // ()
    // (5)
    // (fmt, 5)
    // (fmt)
    // (true)
    // (true, 5)
    // (true, fmt, 5)
    // (true, fmt)
    function listWeekdaysImpl(localeSorted, format, index, field) {
        if (typeof localeSorted === 'boolean') {
            if (isNumber(format)) {
                index = format;
                format = undefined;
            }

            format = format || '';
        } else {
            format = localeSorted;
            index = format;
            localeSorted = false;

            if (isNumber(format)) {
                index = format;
                format = undefined;
            }

            format = format || '';
        }

        var locale = getLocale(),
            shift = localeSorted ? locale._week.dow : 0,
            i,
            out = [];

        if (index != null) {
            return get$1(format, (index + shift) % 7, field, 'day');
        }

        for (i = 0; i < 7; i++) {
            out[i] = get$1(format, (i + shift) % 7, field, 'day');
        }
        return out;
    }

    function listMonths(format, index) {
        return listMonthsImpl(format, index, 'months');
    }

    function listMonthsShort(format, index) {
        return listMonthsImpl(format, index, 'monthsShort');
    }

    function listWeekdays(localeSorted, format, index) {
        return listWeekdaysImpl(localeSorted, format, index, 'weekdays');
    }

    function listWeekdaysShort(localeSorted, format, index) {
        return listWeekdaysImpl(localeSorted, format, index, 'weekdaysShort');
    }

    function listWeekdaysMin(localeSorted, format, index) {
        return listWeekdaysImpl(localeSorted, format, index, 'weekdaysMin');
    }

    getSetGlobalLocale('en', {
        eras: [
            {
                since: '0001-01-01',
                until: +Infinity,
                offset: 1,
                name: 'Anno Domini',
                narrow: 'AD',
                abbr: 'AD',
            },
            {
                since: '0000-12-31',
                until: -Infinity,
                offset: 1,
                name: 'Before Christ',
                narrow: 'BC',
                abbr: 'BC',
            },
        ],
        dayOfMonthOrdinalParse: /\d{1,2}(th|st|nd|rd)/,
        ordinal: function (number) {
            var b = number % 10,
                output =
                    toInt((number % 100) / 10) === 1
                        ? 'th'
                        : b === 1
                        ? 'st'
                        : b === 2
                        ? 'nd'
                        : b === 3
                        ? 'rd'
                        : 'th';
            return number + output;
        },
    });

    // Side effect imports

    hooks.lang = deprecate(
        'moment.lang is deprecated. Use moment.locale instead.',
        getSetGlobalLocale
    );
    hooks.langData = deprecate(
        'moment.langData is deprecated. Use moment.localeData instead.',
        getLocale
    );

    var mathAbs = Math.abs;

    function abs() {
        var data = this._data;

        this._milliseconds = mathAbs(this._milliseconds);
        this._days = mathAbs(this._days);
        this._months = mathAbs(this._months);

        data.milliseconds = mathAbs(data.milliseconds);
        data.seconds = mathAbs(data.seconds);
        data.minutes = mathAbs(data.minutes);
        data.hours = mathAbs(data.hours);
        data.months = mathAbs(data.months);
        data.years = mathAbs(data.years);

        return this;
    }

    function addSubtract$1(duration, input, value, direction) {
        var other = createDuration(input, value);

        duration._milliseconds += direction * other._milliseconds;
        duration._days += direction * other._days;
        duration._months += direction * other._months;

        return duration._bubble();
    }

    // supports only 2.0-style add(1, 's') or add(duration)
    function add$1(input, value) {
        return addSubtract$1(this, input, value, 1);
    }

    // supports only 2.0-style subtract(1, 's') or subtract(duration)
    function subtract$1(input, value) {
        return addSubtract$1(this, input, value, -1);
    }

    function absCeil(number) {
        if (number < 0) {
            return Math.floor(number);
        } else {
            return Math.ceil(number);
        }
    }

    function bubble() {
        var milliseconds = this._milliseconds,
            days = this._days,
            months = this._months,
            data = this._data,
            seconds,
            minutes,
            hours,
            years,
            monthsFromDays;

        // if we have a mix of positive and negative values, bubble down first
        // check: https://github.com/moment/moment/issues/2166
        if (
            !(
                (milliseconds >= 0 && days >= 0 && months >= 0) ||
                (milliseconds <= 0 && days <= 0 && months <= 0)
            )
        ) {
            milliseconds += absCeil(monthsToDays(months) + days) * 864e5;
            days = 0;
            months = 0;
        }

        // The following code bubbles up values, see the tests for
        // examples of what that means.
        data.milliseconds = milliseconds % 1000;

        seconds = absFloor(milliseconds / 1000);
        data.seconds = seconds % 60;

        minutes = absFloor(seconds / 60);
        data.minutes = minutes % 60;

        hours = absFloor(minutes / 60);
        data.hours = hours % 24;

        days += absFloor(hours / 24);

        // convert days to months
        monthsFromDays = absFloor(daysToMonths(days));
        months += monthsFromDays;
        days -= absCeil(monthsToDays(monthsFromDays));

        // 12 months -> 1 year
        years = absFloor(months / 12);
        months %= 12;

        data.days = days;
        data.months = months;
        data.years = years;

        return this;
    }

    function daysToMonths(days) {
        // 400 years have 146097 days (taking into account leap year rules)
        // 400 years have 12 months === 4800
        return (days * 4800) / 146097;
    }

    function monthsToDays(months) {
        // the reverse of daysToMonths
        return (months * 146097) / 4800;
    }

    function as(units) {
        if (!this.isValid()) {
            return NaN;
        }
        var days,
            months,
            milliseconds = this._milliseconds;

        units = normalizeUnits(units);

        if (units === 'month' || units === 'quarter' || units === 'year') {
            days = this._days + milliseconds / 864e5;
            months = this._months + daysToMonths(days);
            switch (units) {
                case 'month':
                    return months;
                case 'quarter':
                    return months / 3;
                case 'year':
                    return months / 12;
            }
        } else {
            // handle milliseconds separately because of floating point math errors (issue #1867)
            days = this._days + Math.round(monthsToDays(this._months));
            switch (units) {
                case 'week':
                    return days / 7 + milliseconds / 6048e5;
                case 'day':
                    return days + milliseconds / 864e5;
                case 'hour':
                    return days * 24 + milliseconds / 36e5;
                case 'minute':
                    return days * 1440 + milliseconds / 6e4;
                case 'second':
                    return days * 86400 + milliseconds / 1000;
                // Math.floor prevents floating point math errors here
                case 'millisecond':
                    return Math.floor(days * 864e5) + milliseconds;
                default:
                    throw new Error('Unknown unit ' + units);
            }
        }
    }

    // TODO: Use this.as('ms')?
    function valueOf$1() {
        if (!this.isValid()) {
            return NaN;
        }
        return (
            this._milliseconds +
            this._days * 864e5 +
            (this._months % 12) * 2592e6 +
            toInt(this._months / 12) * 31536e6
        );
    }

    function makeAs(alias) {
        return function () {
            return this.as(alias);
        };
    }

    var asMilliseconds = makeAs('ms'),
        asSeconds = makeAs('s'),
        asMinutes = makeAs('m'),
        asHours = makeAs('h'),
        asDays = makeAs('d'),
        asWeeks = makeAs('w'),
        asMonths = makeAs('M'),
        asQuarters = makeAs('Q'),
        asYears = makeAs('y');

    function clone$1() {
        return createDuration(this);
    }

    function get$2(units) {
        units = normalizeUnits(units);
        return this.isValid() ? this[units + 's']() : NaN;
    }

    function makeGetter(name) {
        return function () {
            return this.isValid() ? this._data[name] : NaN;
        };
    }

    var milliseconds = makeGetter('milliseconds'),
        seconds = makeGetter('seconds'),
        minutes = makeGetter('minutes'),
        hours = makeGetter('hours'),
        days = makeGetter('days'),
        months = makeGetter('months'),
        years = makeGetter('years');

    function weeks() {
        return absFloor(this.days() / 7);
    }

    var round = Math.round,
        thresholds = {
            ss: 44, // a few seconds to seconds
            s: 45, // seconds to minute
            m: 45, // minutes to hour
            h: 22, // hours to day
            d: 26, // days to month/week
            w: null, // weeks to month
            M: 11, // months to year
        };

    // helper function for moment.fn.from, moment.fn.fromNow, and moment.duration.fn.humanize
    function substituteTimeAgo(string, number, withoutSuffix, isFuture, locale) {
        return locale.relativeTime(number || 1, !!withoutSuffix, string, isFuture);
    }

    function relativeTime$1(posNegDuration, withoutSuffix, thresholds, locale) {
        var duration = createDuration(posNegDuration).abs(),
            seconds = round(duration.as('s')),
            minutes = round(duration.as('m')),
            hours = round(duration.as('h')),
            days = round(duration.as('d')),
            months = round(duration.as('M')),
            weeks = round(duration.as('w')),
            years = round(duration.as('y')),
            a =
                (seconds <= thresholds.ss && ['s', seconds]) ||
                (seconds < thresholds.s && ['ss', seconds]) ||
                (minutes <= 1 && ['m']) ||
                (minutes < thresholds.m && ['mm', minutes]) ||
                (hours <= 1 && ['h']) ||
                (hours < thresholds.h && ['hh', hours]) ||
                (days <= 1 && ['d']) ||
                (days < thresholds.d && ['dd', days]);

        if (thresholds.w != null) {
            a =
                a ||
                (weeks <= 1 && ['w']) ||
                (weeks < thresholds.w && ['ww', weeks]);
        }
        a = a ||
            (months <= 1 && ['M']) ||
            (months < thresholds.M && ['MM', months]) ||
            (years <= 1 && ['y']) || ['yy', years];

        a[2] = withoutSuffix;
        a[3] = +posNegDuration > 0;
        a[4] = locale;
        return substituteTimeAgo.apply(null, a);
    }

    // This function allows you to set the rounding function for relative time strings
    function getSetRelativeTimeRounding(roundingFunction) {
        if (roundingFunction === undefined) {
            return round;
        }
        if (typeof roundingFunction === 'function') {
            round = roundingFunction;
            return true;
        }
        return false;
    }

    // This function allows you to set a threshold for relative time strings
    function getSetRelativeTimeThreshold(threshold, limit) {
        if (thresholds[threshold] === undefined) {
            return false;
        }
        if (limit === undefined) {
            return thresholds[threshold];
        }
        thresholds[threshold] = limit;
        if (threshold === 's') {
            thresholds.ss = limit - 1;
        }
        return true;
    }

    function humanize(argWithSuffix, argThresholds) {
        if (!this.isValid()) {
            return this.localeData().invalidDate();
        }

        var withSuffix = false,
            th = thresholds,
            locale,
            output;

        if (typeof argWithSuffix === 'object') {
            argThresholds = argWithSuffix;
            argWithSuffix = false;
        }
        if (typeof argWithSuffix === 'boolean') {
            withSuffix = argWithSuffix;
        }
        if (typeof argThresholds === 'object') {
            th = Object.assign({}, thresholds, argThresholds);
            if (argThresholds.s != null && argThresholds.ss == null) {
                th.ss = argThresholds.s - 1;
            }
        }

        locale = this.localeData();
        output = relativeTime$1(this, !withSuffix, th, locale);

        if (withSuffix) {
            output = locale.pastFuture(+this, output);
        }

        return locale.postformat(output);
    }

    var abs$1 = Math.abs;

    function sign(x) {
        return (x > 0) - (x < 0) || +x;
    }

    function toISOString$1() {
        // for ISO strings we do not use the normal bubbling rules:
        //  * milliseconds bubble up until they become hours
        //  * days do not bubble at all
        //  * months bubble up until they become years
        // This is because there is no context-free conversion between hours and days
        // (think of clock changes)
        // and also not between days and months (28-31 days per month)
        if (!this.isValid()) {
            return this.localeData().invalidDate();
        }

        var seconds = abs$1(this._milliseconds) / 1000,
            days = abs$1(this._days),
            months = abs$1(this._months),
            minutes,
            hours,
            years,
            s,
            total = this.asSeconds(),
            totalSign,
            ymSign,
            daysSign,
            hmsSign;

        if (!total) {
            // this is the same as C#'s (Noda) and python (isodate)...
            // but not other JS (goog.date)
            return 'P0D';
        }

        // 3600 seconds -> 60 minutes -> 1 hour
        minutes = absFloor(seconds / 60);
        hours = absFloor(minutes / 60);
        seconds %= 60;
        minutes %= 60;

        // 12 months -> 1 year
        years = absFloor(months / 12);
        months %= 12;

        // inspired by https://github.com/dordille/moment-isoduration/blob/master/moment.isoduration.js
        s = seconds ? seconds.toFixed(3).replace(/\.?0+$/, '') : '';

        totalSign = total < 0 ? '-' : '';
        ymSign = sign(this._months) !== sign(total) ? '-' : '';
        daysSign = sign(this._days) !== sign(total) ? '-' : '';
        hmsSign = sign(this._milliseconds) !== sign(total) ? '-' : '';

        return (
            totalSign +
            'P' +
            (years ? ymSign + years + 'Y' : '') +
            (months ? ymSign + months + 'M' : '') +
            (days ? daysSign + days + 'D' : '') +
            (hours || minutes || seconds ? 'T' : '') +
            (hours ? hmsSign + hours + 'H' : '') +
            (minutes ? hmsSign + minutes + 'M' : '') +
            (seconds ? hmsSign + s + 'S' : '')
        );
    }

    var proto$2 = Duration.prototype;

    proto$2.isValid = isValid$1;
    proto$2.abs = abs;
    proto$2.add = add$1;
    proto$2.subtract = subtract$1;
    proto$2.as = as;
    proto$2.asMilliseconds = asMilliseconds;
    proto$2.asSeconds = asSeconds;
    proto$2.asMinutes = asMinutes;
    proto$2.asHours = asHours;
    proto$2.asDays = asDays;
    proto$2.asWeeks = asWeeks;
    proto$2.asMonths = asMonths;
    proto$2.asQuarters = asQuarters;
    proto$2.asYears = asYears;
    proto$2.valueOf = valueOf$1;
    proto$2._bubble = bubble;
    proto$2.clone = clone$1;
    proto$2.get = get$2;
    proto$2.milliseconds = milliseconds;
    proto$2.seconds = seconds;
    proto$2.minutes = minutes;
    proto$2.hours = hours;
    proto$2.days = days;
    proto$2.weeks = weeks;
    proto$2.months = months;
    proto$2.years = years;
    proto$2.humanize = humanize;
    proto$2.toISOString = toISOString$1;
    proto$2.toString = toISOString$1;
    proto$2.toJSON = toISOString$1;
    proto$2.locale = locale;
    proto$2.localeData = localeData;

    proto$2.toIsoString = deprecate(
        'toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)',
        toISOString$1
    );
    proto$2.lang = lang;

    // FORMATTING

    addFormatToken('X', 0, 0, 'unix');
    addFormatToken('x', 0, 0, 'valueOf');

    // PARSING

    addRegexToken('x', matchSigned);
    addRegexToken('X', matchTimestamp);
    addParseToken('X', function (input, array, config) {
        config._d = new Date(parseFloat(input) * 1000);
    });
    addParseToken('x', function (input, array, config) {
        config._d = new Date(toInt(input));
    });

    //! moment.js

    hooks.version = '2.29.1';

    setHookCallback(createLocal);

    hooks.fn = proto;
    hooks.min = min;
    hooks.max = max;
    hooks.now = now;
    hooks.utc = createUTC;
    hooks.unix = createUnix;
    hooks.months = listMonths;
    hooks.isDate = isDate;
    hooks.locale = getSetGlobalLocale;
    hooks.invalid = createInvalid;
    hooks.duration = createDuration;
    hooks.isMoment = isMoment;
    hooks.weekdays = listWeekdays;
    hooks.parseZone = createInZone;
    hooks.localeData = getLocale;
    hooks.isDuration = isDuration;
    hooks.monthsShort = listMonthsShort;
    hooks.weekdaysMin = listWeekdaysMin;
    hooks.defineLocale = defineLocale;
    hooks.updateLocale = updateLocale;
    hooks.locales = listLocales;
    hooks.weekdaysShort = listWeekdaysShort;
    hooks.normalizeUnits = normalizeUnits;
    hooks.relativeTimeRounding = getSetRelativeTimeRounding;
    hooks.relativeTimeThreshold = getSetRelativeTimeThreshold;
    hooks.calendarFormat = getCalendarFormat;
    hooks.prototype = proto;

    // currently HTML5 input type only supports 24-hour formats
    hooks.HTML5_FMT = {
        DATETIME_LOCAL: 'YYYY-MM-DDTHH:mm', // <input type="datetime-local" />
        DATETIME_LOCAL_SECONDS: 'YYYY-MM-DDTHH:mm:ss', // <input type="datetime-local" step="1" />
        DATETIME_LOCAL_MS: 'YYYY-MM-DDTHH:mm:ss.SSS', // <input type="datetime-local" step="0.001" />
        DATE: 'YYYY-MM-DD', // <input type="date" />
        TIME: 'HH:mm', // <input type="time" />
        TIME_SECONDS: 'HH:mm:ss', // <input type="time" step="1" />
        TIME_MS: 'HH:mm:ss.SSS', // <input type="time" step="0.001" />
        WEEK: 'GGGG-[W]WW', // <input type="week" />
        MONTH: 'YYYY-MM', // <input type="month" />
    };

    return hooks;

})));

},{}],155:[function(require,module,exports){
// shim for using process in browser
var process = module.exports = {};

// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.

var cachedSetTimeout;
var cachedClearTimeout;

function defaultSetTimout() {
    throw new Error('setTimeout has not been defined');
}
function defaultClearTimeout () {
    throw new Error('clearTimeout has not been defined');
}
(function () {
    try {
        if (typeof setTimeout === 'function') {
            cachedSetTimeout = setTimeout;
        } else {
            cachedSetTimeout = defaultSetTimout;
        }
    } catch (e) {
        cachedSetTimeout = defaultSetTimout;
    }
    try {
        if (typeof clearTimeout === 'function') {
            cachedClearTimeout = clearTimeout;
        } else {
            cachedClearTimeout = defaultClearTimeout;
        }
    } catch (e) {
        cachedClearTimeout = defaultClearTimeout;
    }
} ())
function runTimeout(fun) {
    if (cachedSetTimeout === setTimeout) {
        //normal enviroments in sane situations
        return setTimeout(fun, 0);
    }
    // if setTimeout wasn't available but was latter defined
    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
        cachedSetTimeout = setTimeout;
        return setTimeout(fun, 0);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedSetTimeout(fun, 0);
    } catch(e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
            return cachedSetTimeout.call(null, fun, 0);
        } catch(e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
            return cachedSetTimeout.call(this, fun, 0);
        }
    }


}
function runClearTimeout(marker) {
    if (cachedClearTimeout === clearTimeout) {
        //normal enviroments in sane situations
        return clearTimeout(marker);
    }
    // if clearTimeout wasn't available but was latter defined
    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
        cachedClearTimeout = clearTimeout;
        return clearTimeout(marker);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedClearTimeout(marker);
    } catch (e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
            return cachedClearTimeout.call(null, marker);
        } catch (e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
            // Some versions of I.E. have different rules for clearTimeout vs setTimeout
            return cachedClearTimeout.call(this, marker);
        }
    }



}
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    if (!draining || !currentQueue) {
        return;
    }
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = runTimeout(cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            if (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    runClearTimeout(timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (queue.length === 1 && !draining) {
        runTimeout(drainQueue);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;
process.prependListener = noop;
process.prependOnceListener = noop;

process.listeners = function (name) { return [] }

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };

},{}],156:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.App = void 0;
var record_1 = require("@quenk/noni/lib/data/record");
var link_1 = require("../../../lib/content/link");
var util_1 = require("../../../lib/util");
var app_1 = require("./wml/app");
var pages_1 = require("./pages");
var pages2Pages = function () {
    var tmp = record_1.group(pages_1.pages, function (_, k) { return k.split('_')[0]; });
    for (var sec in tmp)
        if (tmp.hasOwnProperty(sec)) {
            var newSec = {};
            for (var name_1 in tmp[sec])
                if (tmp[sec].hasOwnProperty(name_1)) {
                    newSec[name_1.split('_')[1]] = tmp[sec][name_1];
                }
            tmp[sec] = newSec;
        }
    return tmp;
};
var pages2Modules = function () {
    return record_1.reduce(pages_1.pages, {}, function (p, c, k) {
        p[k.split('_')[1]] = c;
        return p;
    });
};
/**
 * App displaying all the wml widgets.
 */
var App = /** @class */ (function () {
    function App(root) {
        var _this = this;
        this.root = root;
        this.view = new app_1.Main(this);
        this.content = [];
        this.page = '';
        this.pages = pages2Pages();
        this.modules = pages2Modules();
        this.values = {
            id: {
                layout: 'layout'
            }
        };
        /**
         * navigate is called when the user clicks on a
         * navigation link.
         */
        this.navigate = function (_a) {
            var name = _a.name;
            _this.page = name;
            if (_this.modules.hasOwnProperty(name)) {
                _this.content = [_this.modules[name].view.render()];
                _this.view.invalidate();
            }
        };
        /**
         * toggleDrawer
         */
        this.toggleDrawer = function () {
            util_1.getById(_this.view, _this.values.id.layout)
                .map(function (d) { return d.toggle(); });
        };
    }
    /**
     * run the application.
     */
    App.prototype.run = function () {
        var root = this.root;
        while (root.lastChild)
            root.removeChild(root.lastChild);
        root.appendChild(this.view.render());
        var path = window.location.hash.split('#')[1];
        path = path ? path.split('/').join('') : '';
        this.navigate(new link_1.LinkClickedEvent(path, path));
    };
    App.main = function (root) {
        return new App(root);
    };
    return App;
}());
exports.App = App;
App.main(document.getElementById('app')).run();

},{"../../../lib/content/link":7,"../../../lib/util":143,"./pages":255,"./wml/app":258,"@quenk/noni/lib/data/record":148}],157:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.results = void 0;
exports.results = [
    { label: 'Asus', value: 'Asus' },
    { label: 'MSI', value: 'MSI' },
    { label: 'Gigabyte', value: 'Gigabyte' },
    { label: 'Gigas', value: 'Gigas' },
    { label: 'AsusTek', value: 'AsusTek' },
    { label: 'Asusuga', value: 'Asusuga' },
    { label: 'Qualcomm', value: 'Qualcomm' },
    { label: 'Qualitative', value: 'Qualitatve' },
    { label: 'Kirpalani\'s', value: 'Kirpalani\'s' },
    { label: 'Asunder', value: 'Asunder' }
];

},{}],158:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.EmbedPage = void 0;
var views = require("./wml/embed");
var EmbedPage = /** @class */ (function () {
    function EmbedPage() {
        this.view = new views.Main(this);
        this.values = {
            jojo: 'https://www.youtube.com/embed/1bbr5tMuSnc',
            win: 'https://www.youtube.com/embed/itgSyPxfqoE',
            max: 'https://www.youtube.com/embed/9rrzQSbk9hI',
            allow: 'accelerometer; autoplay; encrypted-media; gyroscope; ' +
                'picture-in-picture'
        };
    }
    return EmbedPage;
}());
exports.EmbedPage = EmbedPage;
exports.default = new EmbedPage();

},{"./wml/embed":159}],159:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var grid_1 = require("../../../../../../lib/layout/grid");
;
var embed_1 = require("../../../../../../lib/content/embed");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.node('h1', {}, [
                    __document.createTextNode('Embed')
                ]),
                __this.widget(new grid_1.GridLayout({}, [
                    __this.widget(new grid_1.Row({}, [
                        __this.widget(new grid_1.Column({ ww: { 'span': 4 } }, [
                            __this.widget(new embed_1.Embed({ ww: { 'className': '-aspect-ratio-16x9' } }, [
                                __this.node('iframe', { 'src': __context.values.jojo, 'allow': __context.values.allow }, [])
                            ]), { ww: { 'className': '-aspect-ratio-16x9' } })
                        ]), { ww: { 'span': 4 } }),
                        __this.widget(new grid_1.Column({ ww: { 'span': 4 } }, [
                            __this.widget(new embed_1.Embed({ ww: { 'className': '-aspect-ratio-4x3' } }, [
                                __this.node('iframe', { 'src': __context.values.win, 'allow': __context.values.allow }, [])
                            ]), { ww: { 'className': '-aspect-ratio-4x3' } })
                        ]), { ww: { 'span': 4 } }),
                        __this.widget(new grid_1.Column({ ww: { 'span': 4 } }, [
                            __this.widget(new embed_1.Embed({ ww: { 'className': '-aspect-ratio-16x9' } }, [
                                __this.node('iframe', { 'src': __context.values.max, 'allow': __context.values.allow }, [])
                            ]), { ww: { 'className': '-aspect-ratio-16x9' } })
                        ]), { ww: { 'span': 4 } })
                    ]), {})
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/content/embed":5,"../../../../../../lib/layout/grid":113,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],160:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MediaDescriptionPage = void 0;
var views = require("./wml/media-description");
var MediaDescriptionPage = /** @class */ (function () {
    function MediaDescriptionPage() {
        this.view = new views.Main(this);
        this.values = {};
    }
    return MediaDescriptionPage;
}());
exports.MediaDescriptionPage = MediaDescriptionPage;
exports.default = new MediaDescriptionPage();

},{"./wml/media-description":161}],161:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var media_description_1 = require("../../../../../../lib/content/media-description");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.node('h1', {}, [
                    __document.createTextNode('Media Description')
                ]),
                __this.widget(new media_description_1.MediaDescription({}, [
                    __this.widget(new media_description_1.Media({}, [
                        __this.node('img', { 'alt': 'placeholder', 'src': 'https://via.placeholder.com/140x100' }, [])
                    ]), {}),
                    __this.widget(new media_description_1.Description({}, [
                        __this.node('h4', {}, [
                            __document.createTextNode('Description')
                        ]),
                        __this.node('p', {}, [
                            __document.createTextNode('Located at the side related to the image on the left.')
                        ])
                    ]), {})
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/content/media-description":9,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],162:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.OverlayPage = void 0;
var views = require("./wml/overlay");
var OverlayPage = /** @class */ (function () {
    function OverlayPage() {
        var _this = this;
        this.view = new views.Main(this);
        this.values = {
            onClick: function () {
                var mO = _this.view.findById('overlay');
                if (mO.isJust())
                    mO.get().close();
            }
        };
    }
    return OverlayPage;
}());
exports.OverlayPage = OverlayPage;
exports.default = new OverlayPage();

},{"./wml/overlay":163}],163:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var overlay_1 = require("../../../../../../lib/content/overlay");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.node('h1', {}, [
                    __document.createTextNode('Overlay')
                ]),
                __this.widget(new overlay_1.Overlay({ wml: { 'id': 'overlay' }, ww: { 'onClick': __context.values.onClick } }, []), { wml: { 'id': 'overlay' }, ww: { 'onClick': __context.values.onClick } })
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/content/overlay":14,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],164:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TagPage = void 0;
var views = require("./wml/tag");
var style_1 = require("../../../../../lib/content/style");
var TagPage = /** @class */ (function () {
    function TagPage() {
        this.view = new views.Main(this);
        this.values = {
            capitalize: function (s) { return "" + s[0].toUpperCase() + s.slice(1); },
            styles: [
                style_1.Style.Default,
                style_1.Style.Primary,
                style_1.Style.Success,
                style_1.Style.Info,
                style_1.Style.Warning,
                style_1.Style.Error
            ]
        };
    }
    return TagPage;
}());
exports.TagPage = TagPage;
exports.default = new TagPage();

},{"../../../../../lib/content/style":20,"./wml/tag":165}],165:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var tag_1 = require("../../../../../../lib/content/tag");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.node('h1', {}, [
                        __document.createTextNode('Tag')
                    ]),
                    __this.node('p', {}, __spreadArrays([
                        __this.node('h2', {}, [
                            __document.createTextNode('Styles')
                        ])
                    ], __forIn(__context.values.styles, function (v, _$$i, _$$all) {
                        return ([
                            __this.widget(new tag_1.Tag({ ww: { 'style': v, 'text': __context.values.capitalize(v) } }, []), { ww: { 'style': v, 'text': __context.values.capitalize(v) } })
                        ]);
                    }, function () { return ([]); })))
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/content/tag":21,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],166:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ThumbnailPage = void 0;
var views = require("./wml/thumbnail");
var ThumbnailPage = /** @class */ (function () {
    function ThumbnailPage() {
        this.view = new views.Main(this);
        this.values = {
            onClick: function () { return alert('You clicked it!'); }
        };
    }
    return ThumbnailPage;
}());
exports.ThumbnailPage = ThumbnailPage;
exports.default = new ThumbnailPage();

},{"./wml/thumbnail":167}],167:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var thumbnail_1 = require("../../../../../../lib/content/thumbnail");
;
var grid_1 = require("../../../../../../lib/layout/grid");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.node('h1', {}, [
                    __document.createTextNode('Thumbnail')
                ]),
                __this.widget(new grid_1.GridLayout({}, [
                    __this.widget(new grid_1.Row({}, [
                        __this.widget(new grid_1.Column({ ww: { 'span': 4 } }, [
                            __this.widget(new thumbnail_1.Thumbnail({}, [
                                __this.node('img', { 'alt': 'placeholder', 'src': 'https://via.placeholder.com/171x180', 'style': 'width:100%;height:100%;display:block' }, [])
                            ]), {})
                        ]), { ww: { 'span': 4 } }),
                        __this.widget(new grid_1.Column({ ww: { 'span': 4 } }, [
                            __this.widget(new thumbnail_1.Thumbnail({ ww: { 'onClick': __context.values.onClick } }, [
                                __this.node('img', { 'alt': 'placeholder', 'src': 'https://via.placeholder.com/171x180', 'style': 'width:100%;height:100%;display:block' }, [])
                            ]), { ww: { 'onClick': __context.values.onClick } })
                        ]), { ww: { 'span': 4 } }),
                        __this.widget(new grid_1.Column({ ww: { 'span': 4 } }, [
                            __this.widget(new thumbnail_1.Thumbnail({ ww: { 'href': '#' } }, [
                                __this.node('img', { 'alt': 'placeholder', 'src': 'https://via.placeholder.com/171x180', 'style': 'width:100%;height:100%;display:block' }, [])
                            ]), { ww: { 'href': '#' } })
                        ]), { ww: { 'span': 4 } })
                    ]), {}),
                    __this.widget(new grid_1.Row({}, [
                        __this.widget(new grid_1.Column({ ww: { 'span': 4 } }, [
                            __this.widget(new thumbnail_1.Thumbnail({}, [
                                __this.node('img', { 'alt': 'placeholder', 'src': 'https://via.placeholder.com/171x180', 'style': 'width:100%;height:100%;display:block' }, []),
                                __this.widget(new thumbnail_1.Caption({}, [
                                    __this.node('h4', {}, [
                                        __document.createTextNode('Caption')
                                    ]),
                                    __this.node('p', {}, [
                                        __document.createTextNode('Describes the thumbnail in minor detail.')
                                    ])
                                ]), {})
                            ]), {})
                        ]), { ww: { 'span': 4 } }),
                        __this.widget(new grid_1.Column({ ww: { 'span': 4 } }, [
                            __this.widget(new thumbnail_1.Thumbnail({ ww: { 'onClick': __context.values.onClick } }, [
                                __this.node('img', { 'alt': 'placeholder', 'src': 'https://via.placeholder.com/171x180', 'style': 'width:100%;height:100%;display:block' }, []),
                                __this.widget(new thumbnail_1.Caption({}, [
                                    __this.node('h4', {}, [
                                        __document.createTextNode('Caption')
                                    ]),
                                    __this.node('p', {}, [
                                        __document.createTextNode('Describes the thumbnail in minor detail.')
                                    ])
                                ]), {})
                            ]), { ww: { 'onClick': __context.values.onClick } })
                        ]), { ww: { 'span': 4 } }),
                        __this.widget(new grid_1.Column({ ww: { 'span': 4 } }, [
                            __this.widget(new thumbnail_1.Thumbnail({ ww: { 'href': '#' } }, [
                                __this.node('img', { 'alt': 'placeholder', 'src': 'https://via.placeholder.com/171x180', 'style': 'width:100%;height:100%;display:block' }, []),
                                __this.widget(new thumbnail_1.Caption({}, [
                                    __this.node('h4', {}, [
                                        __document.createTextNode('Caption')
                                    ]),
                                    __this.node('p', {}, [
                                        __document.createTextNode('Describes the thumbnail in minor detail.')
                                    ])
                                ]), {})
                            ]), { ww: { 'href': '#' } })
                        ]), { ww: { 'span': 4 } })
                    ]), {})
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/content/thumbnail":23,"../../../../../../lib/layout/grid":113,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],168:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ButtonGroupPage = void 0;
var views = require("./wml/button-group");
var ButtonGroupPage = /** @class */ (function () {
    function ButtonGroupPage() {
        this.view = new views.Main(this);
    }
    return ButtonGroupPage;
}());
exports.ButtonGroupPage = ButtonGroupPage;
exports.default = new ButtonGroupPage();

},{"./wml/button-group":169}],169:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var button_1 = require("../../../../../../lib/control/button");
;
var button_group_1 = require("../../../../../../lib/control/button-group");
;
var drop_down_1 = require("../../../../../../lib/control/drop-down");
;
var menu_1 = require("../../../../../../lib/menu/menu");
;
var item_1 = require("../../../../../../lib/menu/item");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.node('p', {}, [
                    __this.widget(new button_group_1.ButtonGroup({}, [
                        __this.widget(new button_1.Button({ ww: { 'text': 'one' } }, []), { ww: { 'text': 'one' } }),
                        __this.widget(new button_1.Button({ ww: { 'text': 'two', 'active': true } }, []), { ww: { 'text': 'two', 'active': true } }),
                        __this.widget(new button_1.Button({ ww: { 'text': 'four' } }, []), { ww: { 'text': 'four' } })
                    ]), {})
                ]),
                __this.node('p', {}, [
                    __this.widget(new button_group_1.ButtonGroup({}, [
                        __this.widget(new button_1.Button({ ww: { 'text': 'one' } }, []), { ww: { 'text': 'one' } }),
                        __this.widget(new button_1.Button({ ww: { 'text': 'two' } }, []), { ww: { 'text': 'two' } }),
                        __this.widget(new button_1.Button({ ww: { 'text': 'four' } }, []), { ww: { 'text': 'four' } })
                    ]), {})
                ]),
                __this.node('p', {}, [
                    __this.widget(new button_group_1.ButtonGroup({}, [
                        __this.widget(new button_1.Button({ ww: { 'text': 'one' } }, []), { ww: { 'text': 'one' } })
                    ]), {})
                ]),
                __this.node('p', {}, [
                    __this.widget(new button_group_1.ButtonGroup({}, [
                        __this.widget(new button_1.Button({ ww: { 'text': 'one' } }, []), { ww: { 'text': 'one' } }),
                        __this.widget(new drop_down_1.DropDown({ ww: { 'buttonText': 'two' } }, [
                            __this.widget(new menu_1.Menu({}, [
                                __this.widget(new item_1.Item({}, [
                                    __this.node('a', { 'href': '#' }, [
                                        __document.createTextNode('Link')
                                    ])
                                ]), {}),
                                __this.widget(new item_1.Item({}, [
                                    __this.node('a', { 'href': '#' }, [
                                        __document.createTextNode('Link')
                                    ])
                                ]), {}),
                                __this.widget(new item_1.Item({}, [
                                    __this.node('a', { 'href': '#' }, [
                                        __document.createTextNode('Link')
                                    ])
                                ]), {})
                            ]), {})
                        ]), { ww: { 'buttonText': 'two' } }),
                        __this.widget(new button_1.Button({ ww: { 'text': 'three' } }, []), { ww: { 'text': 'three' } })
                    ]), {})
                ])
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/button":29,"../../../../../../lib/control/button-group":25,"../../../../../../lib/control/drop-down":39,"../../../../../../lib/menu/item":136,"../../../../../../lib/menu/menu":138,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],170:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ButtonSelectPage = void 0;
var views = require("./wml/button-select");
var ButtonSelectPage = /** @class */ (function () {
    function ButtonSelectPage() {
        var _this = this;
        this.view = new views.Main(this);
        this.values = {
            options: [
                { text: 'Asus', value: 'Asus' },
                { text: 'MSI', value: 'MSI' },
                { text: 'Gigabyte', value: 'Gigabyte' }
            ],
            value: 'MSI',
            values: ['MSI']
        };
        this.onChange = function (_a) {
            var value = _a.value, name = _a.name;
            _this
                .view
                .findById(name + "-content")
                .map(function (e) {
                while (e.lastChild)
                    e.removeChild(e.lastChild);
                e.appendChild(document.createTextNode(String(value)));
            });
        };
        this.onChangeMulti = function (_a) {
            var value = _a.value, name = _a.name;
            _this
                .view
                .findById(name + "-content")
                .map(function (e) {
                while (e.lastChild)
                    e.removeChild(e.lastChild);
                e.appendChild(document.createTextNode(String(value)));
            });
        };
    }
    return ButtonSelectPage;
}());
exports.ButtonSelectPage = ButtonSelectPage;
exports.default = new ButtonSelectPage();

},{"./wml/button-select":171}],171:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var button_select_1 = require("../../../../../../lib/control/button-select");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __document.createTextNode('You selected: '),
                        __this.node('b', { wml: { 'id': 'select-content' } }, [
                            __document.createTextNode('(None)')
                        ]),
                        __document.createTextNode('.')
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new button_select_1.ButtonSelect({ wml: { 'id': 'select' }, ww: { 'name': 'select', 'options': __context.values.options, 'value': __context.values.value, 'onChange': __context.onChange } }, []), { wml: { 'id': 'select' }, ww: { 'name': 'select', 'options': __context.values.options, 'value': __context.values.value, 'onChange': __context.onChange } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __document.createTextNode('You can also use MultiButtonSelect instead: '),
                        __this.node('b', { wml: { 'id': 'multi-content' } }, [
                            __document.createTextNode('(None)')
                        ]),
                        __document.createTextNode('.')
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new button_select_1.MultiButtonSelect({ wml: { 'id': 'multi' }, ww: { 'name': 'multi', 'options': __context.values.options, 'value': __context.values.values, 'onChange': __context.onChangeMulti } }, []), { wml: { 'id': 'multi' }, ww: { 'name': 'multi', 'options': __context.values.options, 'value': __context.values.values, 'onChange': __context.onChangeMulti } })
                    ])
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/button-select":27,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],172:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ButtonPage = void 0;
var views = require("./wml/button");
var style_1 = require("../../../../../lib/content/style");
var size_1 = require("../../../../../lib/content/size");
var ButtonPage = /** @class */ (function () {
    function ButtonPage() {
        this.view = new views.Main(this);
        this.values = {
            capitalize: function (s) { return "" + s[0].toUpperCase() + s.slice(1); },
            styles: [
                style_1.Style.Default,
                style_1.Style.Primary,
                style_1.Style.Success,
                style_1.Style.Info,
                style_1.Style.Warning,
                style_1.Style.Error
            ],
            sizes: [
                size_1.Size.ExtraSmall,
                size_1.Size.Small,
                size_1.Size.Medium,
                size_1.Size.Large,
                size_1.Size.ExtraLarge
            ]
        };
    }
    return ButtonPage;
}());
exports.ButtonPage = ButtonPage;
exports.default = new ButtonPage();

},{"../../../../../lib/content/size":16,"../../../../../lib/content/style":20,"./wml/button":173}],173:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var button_1 = require("../../../../../../lib/control/button");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.node('h1', {}, [
                        __document.createTextNode('Buttons')
                    ]),
                    __this.node('p', {}, __spreadArrays([
                        __this.node('h2', {}, [
                            __document.createTextNode('Style')
                        ])
                    ], __forIn(__context.values.styles, function (v, _$$i, _$$all) {
                        return ([
                            __this.widget(new button_1.Button({ ww: { 'name': v, 'style': v, 'text': __context.values.capitalize(v) } }, []), { ww: { 'name': v, 'style': v, 'text': __context.values.capitalize(v) } })
                        ]);
                    }, function () { return ([]); })))
                ]), {}),
                __this.widget(new demo_1.Demo({}, __spreadArrays([
                    __this.node('h2', {}, [
                        __document.createTextNode('Outline')
                    ])
                ], __forIn(__context.values.styles, function (style, _$$i, _$$all) {
                    return ([
                        __this.widget(new button_1.Button({ ww: { 'style': style, 'outline': true, 'text': __context.values.capitalize(style) } }, []), { ww: { 'style': style, 'outline': true, 'text': __context.values.capitalize(style) } })
                    ]);
                }, function () { return ([]); }))), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, __spreadArrays([
                        __this.node('h2', {}, [
                            __document.createTextNode('Active')
                        ])
                    ], __forIn(__context.values.styles, function (v, _$$i, _$$all) {
                        return ([
                            __this.widget(new button_1.Button({ ww: { 'name': v, 'active': true, 'style': v, 'text': __context.values.capitalize(v) } }, []), { ww: { 'name': v, 'active': true, 'style': v, 'text': __context.values.capitalize(v) } })
                        ]);
                    }, function () { return ([]); })))
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, __spreadArrays([
                        __this.node('h2', {}, [
                            __document.createTextNode('Disabled')
                        ])
                    ], __forIn(__context.values.styles, function (v, _$$i, _$$all) {
                        return ([
                            __this.widget(new button_1.Button({ ww: { 'name': v, 'disabled': true, 'style': v, 'text': __context.values.capitalize(v) } }, []), { ww: { 'name': v, 'disabled': true, 'style': v, 'text': __context.values.capitalize(v) } })
                        ]);
                    }, function () { return ([]); })))
                ]), {}),
                __this.widget(new demo_1.Demo({}, __spreadArrays([
                    __this.node('h2', {}, [
                        __document.createTextNode('Size')
                    ])
                ], __forIn(__context.values.styles, function (style, _$$i, _$$all) {
                    return ([
                        __this.node('p', {}, __spreadArrays(__forIn(__context.values.sizes, function (size, _$$i, _$$all) {
                            return ([
                                __this.widget(new button_1.Button({ ww: { 'name': size, 'style': style, 'size': size, 'text': __context.values.capitalize(size) } }, []), { ww: { 'name': size, 'style': style, 'size': size, 'text': __context.values.capitalize(size) } })
                            ]);
                        }, function () { return ([]); })))
                    ]);
                }, function () { return ([]); }))), {}),
                __this.widget(new demo_1.Demo({}, __spreadArrays([
                    __this.node('h2', {}, [
                        __document.createTextNode('Block')
                    ])
                ], __forIn(__context.values.styles, function (style, _$$i, _$$all) {
                    return ([
                        __this.widget(new button_1.Button({ ww: { 'style': style, 'block': true, 'text': __context.values.capitalize(style) } }, []), { ww: { 'style': style, 'block': true, 'text': __context.values.capitalize(style) } })
                    ]);
                }, function () { return ([]); }))), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/button":29,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],174:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CheckboxPage = void 0;
var views = require("./wml/checkbox");
var CheckboxPage = /** @class */ (function () {
    function CheckboxPage() {
        var _this = this;
        this.view = new views.Main(this);
        this.value = true;
        this.onChange = function (_a) {
            var value = _a.value;
            _this.view.findById('content')
                .map(function (e) {
                while (e.firstChild)
                    e.removeChild(e.firstChild);
                e.appendChild(document.createTextNode(value === true ?
                    'on' :
                    (value === false ? 'off' : 'error')));
            });
        };
    }
    return CheckboxPage;
}());
exports.CheckboxPage = CheckboxPage;
exports.default = new CheckboxPage();

},{"./wml/checkbox":175}],175:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var checkbox_1 = require("../../../../../../lib/control/checkbox");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.node('p', {}, [
                    __document.createTextNode('The checkbox is '),
                    __this.node('b', { wml: { 'id': 'content' } }, [
                        __document.createTextNode('untouched')
                    ]),
                    __document.createTextNode('.')
                ]),
                __this.node('p', {}, [
                    __this.widget(new checkbox_1.Checkbox({ ww: { 'name': 'checkbox', 'onChange': __context.onChange } }, []), { ww: { 'name': 'checkbox', 'onChange': __context.onChange } })
                ])
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/checkbox":31,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],176:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.onChange = exports.DateFieldPage = void 0;
var views = require("./wml/date-field");
var date_field_1 = require("../../../../../lib/control/date-field");
var util_1 = require("../../../../../lib/util");
var DateFieldPage = /** @class */ (function () {
    function DateFieldPage() {
        this.view = new views.Main(this);
        this.values = {
            formats: {
                iso: {
                    id: 'iso',
                    name: 'iso',
                    label: 'ISO8601',
                    format: date_field_1.Format.ISO8601,
                    message: 'ISO8601 date',
                    onChange: exports.onChange(this)
                },
                common: {
                    id: 'common',
                    name: 'common',
                    label: 'Comon',
                    format: date_field_1.Format.COMMON,
                    message: 'Common date',
                    onChange: exports.onChange(this)
                },
                us: {
                    id: 'us',
                    name: 'us',
                    label: 'US',
                    format: date_field_1.Format.USA,
                    message: 'US date',
                    onChange: exports.onChange(this)
                }
            },
            states: {
                success: {
                    id: 'success',
                    name: 'success',
                    label: 'Success',
                    success: 'Success date',
                    warning: undefined,
                    error: undefined,
                    block: false,
                    onChange: exports.onChange(this)
                },
                warning: {
                    id: 'warning',
                    name: 'warning',
                    label: 'Warning',
                    success: undefined,
                    warning: 'Warning date',
                    error: undefined,
                    block: false,
                    onChange: exports.onChange(this)
                },
                error: {
                    id: 'error',
                    name: 'error',
                    label: 'Error',
                    success: undefined,
                    warning: undefined,
                    error: 'Error date',
                    block: false,
                    onChange: exports.onChange(this)
                },
                block: {
                    id: 'block',
                    name: 'block',
                    label: 'Block',
                    success: undefined,
                    warning: undefined,
                    error: undefined,
                    block: true,
                    onChange: exports.onChange(this)
                },
            }
        };
    }
    return DateFieldPage;
}());
exports.DateFieldPage = DateFieldPage;
exports.onChange = function (d) { return function (_a) {
    var name = _a.name, value = _a.value;
    var mDate = util_1.getById(d.view, name);
    if (mDate.isJust()) {
        var d_1 = mDate.get();
        d_1.setMessage("The date is " + value + ".");
    }
}; };
exports.default = new DateFieldPage();

},{"../../../../../lib/control/date-field":35,"../../../../../lib/util":143,"./wml/date-field":177}],177:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var date_field_1 = require("../../../../../../lib/control/date-field");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, __spreadArrays(__forOf(__context.values.formats, function (spec, _$$k, _$$all) {
                return ([
                    __this.widget(new demo_1.Demo({}, [
                        __this.node('p', {}, [
                            __this.widget(new date_field_1.DateField({ wml: { 'id': spec.id }, ww: { 'name': spec.name, 'label': spec.label, 'format': spec.format, 'message': spec.message, 'onChange': spec.onChange } }, []), { wml: { 'id': spec.id }, ww: { 'name': spec.name, 'label': spec.label, 'format': spec.format, 'message': spec.message, 'onChange': spec.onChange } })
                        ])
                    ]), {})
                ]);
            }, function () { return ([]); }), __forOf(__context.values.states, function (spec, _$$k, _$$all) {
                return ([
                    __this.widget(new demo_1.Demo({}, [
                        __this.node('p', {}, [
                            __this.widget(new date_field_1.DateField({ wml: { 'id': spec.id }, ww: { 'name': spec.name, 'label': spec.label, 'success': spec.success, 'warning': spec.warning, 'error': spec.error, 'block': spec.block, 'onChange': spec.onChange } }, []), { wml: { 'id': spec.id }, ww: { 'name': spec.name, 'label': spec.label, 'success': spec.success, 'warning': spec.warning, 'error': spec.error, 'block': spec.block, 'onChange': spec.onChange } })
                        ])
                    ]), {})
                ]);
            }, function () { return ([]); }))), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/date-field":35,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],178:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DisplayFieldPage = void 0;
var views = require("./wml/display-field");
var style_1 = require("../../../../../lib/content/style");
var getStyles = function () { return [
    style_1.Style.Default,
    style_1.Style.Primary,
    style_1.Style.Success,
    style_1.Style.Info,
    style_1.Style.Warning,
    style_1.Style.Error
]; };
var DisplayFieldPage = /** @class */ (function () {
    function DisplayFieldPage() {
        this.view = new views.Main(this);
        this.values = {
            capitalize: function (s) { return "" + s[0].toUpperCase() + s.slice(1); },
            styles: getStyles()
        };
    }
    return DisplayFieldPage;
}());
exports.DisplayFieldPage = DisplayFieldPage;
exports.default = new DisplayFieldPage();

},{"../../../../../lib/content/style":20,"./wml/display-field":179}],179:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var display_field_1 = require("../../../../../../lib/control/display-field");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new display_field_1.DisplayField({}, [
                        __document.createTextNode(' It was a choice.')
                    ]), {})
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new display_field_1.DisplayField({ ww: { 'disabled': true } }, [
                        __document.createTextNode('Disabled')
                    ]), { ww: { 'disabled': true } })
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/display-field":37,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],180:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DropDownPage = void 0;
var views = require("./wml/drop-down");
var DropDownPage = /** @class */ (function () {
    function DropDownPage() {
        this.view = new views.Main(this);
        this.onClick = function (msg) { return function (e) {
            e.preventDefault();
            alert(msg);
        }; };
    }
    return DropDownPage;
}());
exports.DropDownPage = DropDownPage;
exports.default = new DropDownPage();

},{"./wml/drop-down":181}],181:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var drop_down_1 = require("../../../../../../lib/control/drop-down");
;
var menu_1 = require("../../../../../../lib/menu/menu");
;
var item_1 = require("../../../../../../lib/menu/item");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.node('p', {}, [
                    __this.widget(new drop_down_1.DropDown({ ww: { 'buttonText': 'Click Me' } }, [
                        __this.widget(new menu_1.Menu({}, [
                            __this.widget(new item_1.Item({}, [
                                __this.node('a', { 'href': '#', 'onclick': __context.onClick('You clicked one') }, [
                                    __document.createTextNode('One')
                                ])
                            ]), {}),
                            __this.widget(new item_1.Item({}, [
                                __this.node('a', { 'href': '#', 'onclick': __context.onClick('You clicked two') }, [
                                    __document.createTextNode('Two')
                                ])
                            ]), {}),
                            __this.widget(new item_1.Item({}, [
                                __this.node('a', { 'href': '#', 'onclick': __context.onClick('You clicked three') }, [
                                    __document.createTextNode('Three')
                                ])
                            ]), {})
                        ]), {})
                    ]), { ww: { 'buttonText': 'Click Me' } }),
                    __this.widget(new drop_down_1.DropDown({ ww: { 'buttonText': 'Me Too', 'autoClose': false } }, [
                        __this.node('h1', {}, [
                            __document.createTextNode('Any flow content can go here!')
                        ])
                    ]), { ww: { 'buttonText': 'Me Too', 'autoClose': false } }),
                    __this.widget(new drop_down_1.DropDown({ ww: { 'buttonText': 'Can\'t touch this!', 'disabled': true } }, [
                        __this.node('p', {}, [
                            __document.createTextNode('You will never see this!')
                        ])
                    ]), { ww: { 'buttonText': 'Can\'t touch this!', 'disabled': true } }),
                    __this.widget(new drop_down_1.DropDown({ ww: { 'buttonText': 'I am an anchor', 'anchor': true } }, [
                        __this.node('b', {}, [
                            __document.createTextNode('Content')
                        ])
                    ]), { ww: { 'buttonText': 'I am an anchor', 'anchor': true } })
                ])
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/drop-down":39,"../../../../../../lib/menu/item":136,"../../../../../../lib/menu/menu":138,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],182:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DropListFieldPage = void 0;
var views = require("./wml/drop-list-field");
var results_1 = require("../../fixtures/data/results");
var options = results_1.results;
var DropListFieldPage = /** @class */ (function () {
    function DropListFieldPage() {
        this.view = new views.Main(this);
        this.values = {
            normal: {
                id: 'normal',
                name: 'normal',
                label: 'Normal',
                options: options,
                value: results_1.results[2].value,
                onChange: doChange(this)
            },
            success: {
                id: 'success',
                name: 'success',
                label: 'Success',
                options: options,
                message: 'This has a success message.',
                onChange: doChange(this)
            },
            warning: {
                id: 'warning',
                name: 'warning',
                label: 'Warning',
                options: options,
                message: 'This has a warning message.',
                onChange: doChange(this)
            },
            error: {
                id: 'error',
                name: 'error',
                label: 'Error',
                options: options,
                message: 'This has a error message.',
                onChange: doChange(this)
            },
        };
    }
    return DropListFieldPage;
}());
exports.DropListFieldPage = DropListFieldPage;
var doChange = function (page) { return function (_a) {
    var name = _a.name, value = _a.value;
    return page
        .view
        .findById(name)
        .map(function () {
        alert("Selected: " + name + "=" + value);
    });
}; };
exports.default = new DropListFieldPage();

},{"../../fixtures/data/results":157,"./wml/drop-list-field":183}],183:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var drop_list_field_1 = require("../../../../../../lib/control/drop-list-field");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.node('b', {}, [
                        __document.createTextNode('Normal')
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new drop_list_field_1.DropListField({ wml: { 'id': __context.values.normal.name }, ww: { 'name': __context.values.normal.name, 'value': __context.values.normal.value, 'options': __context.values.normal.options, 'onChange': __context.values.normal.onChange } }, []), { wml: { 'id': __context.values.normal.name }, ww: { 'name': __context.values.normal.name, 'value': __context.values.normal.value, 'options': __context.values.normal.options, 'onChange': __context.values.normal.onChange } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('b', {}, [
                        __document.createTextNode('Success')
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new drop_list_field_1.DropListField({ wml: { 'id': __context.values.success.id }, ww: { 'className': '-success', 'name': __context.values.success.name, 'options': __context.values.success.options, 'onChange': __context.values.success.onChange } }, []), { wml: { 'id': __context.values.success.id }, ww: { 'className': '-success', 'name': __context.values.success.name, 'options': __context.values.success.options, 'onChange': __context.values.success.onChange } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('b', {}, [
                        __document.createTextNode('Warning')
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new drop_list_field_1.DropListField({ wml: { 'id': __context.values.warning.id }, ww: { 'className': '-warning', 'name': __context.values.warning.name, 'options': __context.values.warning.options, 'onChange': __context.values.warning.onChange } }, []), { wml: { 'id': __context.values.warning.id }, ww: { 'className': '-warning', 'name': __context.values.warning.name, 'options': __context.values.warning.options, 'onChange': __context.values.warning.onChange } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('b', {}, [
                        __document.createTextNode('Error')
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new drop_list_field_1.DropListField({ wml: { 'id': __context.values.error.id }, ww: { 'className': '-error', 'name': __context.values.error.name, 'options': __context.values.error.options, 'onChange': __context.values.error.onChange } }, []), { wml: { 'id': __context.values.error.id }, ww: { 'className': '-error', 'name': __context.values.error.name, 'options': __context.values.error.options, 'onChange': __context.values.error.onChange } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('b', {}, [
                        __document.createTextNode('Disabled')
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new drop_list_field_1.DropListField({ ww: { 'name': __context.values.normal.name, 'value': __context.values.normal.value, 'options': __context.values.normal.options, 'disabled': true, 'onChange': __context.values.normal.onChange } }, []), { ww: { 'name': __context.values.normal.name, 'value': __context.values.normal.value, 'options': __context.values.normal.options, 'disabled': true, 'onChange': __context.values.normal.onChange } })
                    ])
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/drop-list-field":41,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],184:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DropListPage = void 0;
var views = require("./wml/drop-list");
var results_1 = require("../../fixtures/data/results");
var options = results_1.results;
var DropListPage = /** @class */ (function () {
    function DropListPage() {
        this.view = new views.Main(this);
        this.values = {
            normal: {
                id: 'normal',
                name: 'normal',
                label: 'Normal',
                options: options,
                value: results_1.results[2].value,
                onSelect: doSelect(this)
            },
            block: {
                id: 'block',
                name: 'block',
                label: 'Block',
                options: options,
                onSelect: doSelect(this)
            },
            success: {
                id: 'success',
                name: 'success',
                label: 'Success',
                options: options,
                message: 'This has a success message.',
                onSelect: doSelect(this)
            },
            warning: {
                id: 'warning',
                name: 'warning',
                label: 'Warning',
                options: options,
                message: 'This has a warning message.',
                onSelect: doSelect(this)
            },
            error: {
                id: 'error',
                name: 'error',
                label: 'Error',
                options: options,
                message: 'This has a error message.',
                onSelect: doSelect(this)
            },
        };
    }
    return DropListPage;
}());
exports.DropListPage = DropListPage;
var doSelect = function (page) { return function (_a) {
    var name = _a.name, value = _a.value;
    return page
        .view
        .findById(name)
        .map(function () {
        alert("Selected: " + name + "=" + value);
    });
}; };
exports.default = new DropListPage();

},{"../../fixtures/data/results":157,"./wml/drop-list":185}],185:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var drop_list_1 = require("../../../../../../lib/control/drop-list");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.node('b', {}, [
                        __document.createTextNode('Normal')
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new drop_list_1.DropList({ wml: { 'id': __context.values.normal.name }, ww: { 'name': __context.values.normal.name, 'value': __context.values.normal.value, 'options': __context.values.normal.options, 'onSelect': __context.values.normal.onSelect } }, []), { wml: { 'id': __context.values.normal.name }, ww: { 'name': __context.values.normal.name, 'value': __context.values.normal.value, 'options': __context.values.normal.options, 'onSelect': __context.values.normal.onSelect } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('b', {}, [
                        __document.createTextNode('Success')
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new drop_list_1.DropList({ wml: { 'id': __context.values.success.id }, ww: { 'className': '-success', 'name': __context.values.success.name, 'options': __context.values.success.options, 'onSelect': __context.values.success.onSelect } }, []), { wml: { 'id': __context.values.success.id }, ww: { 'className': '-success', 'name': __context.values.success.name, 'options': __context.values.success.options, 'onSelect': __context.values.success.onSelect } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('b', {}, [
                        __document.createTextNode('Warning')
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new drop_list_1.DropList({ wml: { 'id': __context.values.warning.id }, ww: { 'className': '-warning', 'name': __context.values.warning.name, 'options': __context.values.warning.options, 'onSelect': __context.values.warning.onSelect } }, []), { wml: { 'id': __context.values.warning.id }, ww: { 'className': '-warning', 'name': __context.values.warning.name, 'options': __context.values.warning.options, 'onSelect': __context.values.warning.onSelect } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('b', {}, [
                        __document.createTextNode('Error')
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new drop_list_1.DropList({ wml: { 'id': __context.values.error.id }, ww: { 'className': '-error', 'name': __context.values.error.name, 'options': __context.values.error.options, 'onSelect': __context.values.error.onSelect } }, []), { wml: { 'id': __context.values.error.id }, ww: { 'className': '-error', 'name': __context.values.error.name, 'options': __context.values.error.options, 'onSelect': __context.values.error.onSelect } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.node('b', {}, [
                            __document.createTextNode('Disabled')
                        ]),
                        __this.widget(new drop_list_1.DropList({ ww: { 'name': __context.values.normal.name, 'disabled': true, 'onSelect': __context.values.normal.onSelect } }, []), { ww: { 'name': __context.values.normal.name, 'disabled': true, 'onSelect': __context.values.normal.onSelect } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.node('b', {}, [
                            __document.createTextNode('Block')
                        ]),
                        __this.widget(new drop_list_1.DropList({ wml: { 'id': __context.values.block.id }, ww: { 'className': '-block', 'name': __context.values.block.name, 'block': true, 'onSelect': __context.values.block.onSelect } }, []), { wml: { 'id': __context.values.block.id }, ww: { 'className': '-block', 'name': __context.values.block.name, 'block': true, 'onSelect': __context.values.block.onSelect } })
                    ])
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/drop-list":43,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],186:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FileUploadSurfacePage = void 0;
var views = require("./wml/file-upload-surface");
var FileUploadSurfacePage = /** @class */ (function () {
    function FileUploadSurfacePage() {
        this.view = new views.Main(this);
        this.values = {};
    }
    return FileUploadSurfacePage;
}());
exports.FileUploadSurfacePage = FileUploadSurfacePage;
exports.default = new FileUploadSurfacePage();

},{"./wml/file-upload-surface":187}],187:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var file_upload_surface_1 = require("../../../../../../lib/control/file-upload-surface");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new file_upload_surface_1.FileUploadSurface({}, []), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/file-upload-surface":48,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],188:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.InputGroupPage = void 0;
var views = require("./wml/input-group");
var results_1 = require("../../fixtures/data/results");
var InputGroupPage = /** @class */ (function () {
    function InputGroupPage() {
        this.view = new views.Main(this);
        this.values = {
            dropList: { options: results_1.results }
        };
    }
    return InputGroupPage;
}());
exports.InputGroupPage = InputGroupPage;
exports.default = new InputGroupPage();

},{"../../fixtures/data/results":157,"./wml/input-group":189}],189:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var text_input_1 = require("../../../../../../lib/control/text-input");
;
var input_group_1 = require("../../../../../../lib/control/input-group");
;
var checkbox_1 = require("../../../../../../lib/control/checkbox");
;
var button_1 = require("../../../../../../lib/control/button");
;
var drop_down_1 = require("../../../../../../lib/control/drop-down");
;
var drop_list_1 = require("../../../../../../lib/control/drop-list");
;
var menu_1 = require("../../../../../../lib/menu/menu");
;
var item_1 = require("../../../../../../lib/menu/item");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.widget(new input_group_1.InputGroup({}, [
                            __this.widget(new input_group_1.AddOn({}, [
                                __document.createTextNode('http')
                            ]), {}),
                            __this.widget(new text_input_1.TextInput({}, []), {})
                        ]), {})
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.widget(new input_group_1.InputGroup({}, [
                            __this.widget(new text_input_1.TextInput({}, []), {}),
                            __this.widget(new input_group_1.AddOn({}, [
                                __document.createTextNode('.com')
                            ]), {})
                        ]), {})
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.widget(new input_group_1.InputGroup({}, [
                            __this.widget(new input_group_1.AddOn({}, [
                                __this.widget(new checkbox_1.Checkbox({}, []), {})
                            ]), {}),
                            __this.widget(new text_input_1.TextInput({}, []), {})
                        ]), {})
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.widget(new input_group_1.InputGroup({}, [
                            __this.widget(new text_input_1.TextInput({}, []), {}),
                            __this.widget(new input_group_1.AddOn({}, [
                                __this.widget(new checkbox_1.Checkbox({}, []), {})
                            ]), {})
                        ]), {})
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.widget(new input_group_1.InputGroup({}, [
                            __this.widget(new input_group_1.AddOn({ 'button': true }, [
                                __this.widget(new button_1.Button({ ww: { 'text': 'Find' } }, []), { ww: { 'text': 'Find' } })
                            ]), { 'button': true }),
                            __this.widget(new text_input_1.TextInput({}, []), {})
                        ]), {})
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.widget(new input_group_1.InputGroup({}, [
                            __this.widget(new text_input_1.TextInput({}, []), {}),
                            __this.widget(new input_group_1.AddOn({ 'button': true }, [
                                __this.widget(new button_1.Button({ ww: { 'text': 'Find' } }, []), { ww: { 'text': 'Find' } })
                            ]), { 'button': true })
                        ]), {})
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.widget(new input_group_1.InputGroup({}, [
                            __this.widget(new input_group_1.AddOn({ 'button': true }, [
                                __this.widget(new drop_down_1.DropDown({ ww: { 'buttonText': 'Click Me' } }, [
                                    __this.widget(new menu_1.Menu({}, [
                                        __this.widget(new item_1.Item({}, [
                                            __this.node('a', { 'href': '#' }, [
                                                __document.createTextNode('One')
                                            ])
                                        ]), {}),
                                        __this.widget(new item_1.Item({}, [
                                            __this.node('a', { 'href': '#' }, [
                                                __document.createTextNode('Two')
                                            ])
                                        ]), {}),
                                        __this.widget(new item_1.Item({}, [
                                            __this.node('a', { 'href': '#' }, [
                                                __document.createTextNode('Three')
                                            ])
                                        ]), {})
                                    ]), {})
                                ]), { ww: { 'buttonText': 'Click Me' } })
                            ]), { 'button': true }),
                            __this.widget(new text_input_1.TextInput({}, []), {})
                        ]), {})
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.widget(new input_group_1.InputGroup({}, [
                            __this.widget(new text_input_1.TextInput({}, []), {}),
                            __this.widget(new input_group_1.AddOn({ 'button': true }, [
                                __this.widget(new drop_down_1.DropDown({ ww: { 'buttonText': 'Click Me' } }, [
                                    __this.widget(new menu_1.Menu({}, [
                                        __this.widget(new item_1.Item({}, [
                                            __this.node('a', { 'href': '#' }, [
                                                __document.createTextNode('One')
                                            ])
                                        ]), {}),
                                        __this.widget(new item_1.Item({}, [
                                            __this.node('a', { 'href': '#' }, [
                                                __document.createTextNode('Two')
                                            ])
                                        ]), {}),
                                        __this.widget(new item_1.Item({}, [
                                            __this.node('a', { 'href': '#' }, [
                                                __document.createTextNode('Three')
                                            ])
                                        ]), {})
                                    ]), {})
                                ]), { ww: { 'buttonText': 'Click Me' } })
                            ]), { 'button': true })
                        ]), {})
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.widget(new input_group_1.InputGroup({}, [
                            __this.widget(new input_group_1.AddOn({ 'button': true }, [
                                __this.widget(new drop_list_1.DropList({ ww: { 'options': __context.values.dropList.options } }, []), { ww: { 'options': __context.values.dropList.options } })
                            ]), { 'button': true }),
                            __this.widget(new text_input_1.TextInput({}, []), {})
                        ]), {})
                    ])
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/button":29,"../../../../../../lib/control/checkbox":31,"../../../../../../lib/control/drop-down":39,"../../../../../../lib/control/drop-list":43,"../../../../../../lib/control/input-group":55,"../../../../../../lib/control/text-input":81,"../../../../../../lib/menu/item":136,"../../../../../../lib/menu/menu":138,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],190:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MultiSelectPage = void 0;
var views = require("./wml/multi-select");
var results_1 = require("../../fixtures/data/results");
var MultiSelectPage = /** @class */ (function () {
    function MultiSelectPage() {
        this.view = new views.Main(this);
        this.values = {
            normal: {
                id: 'normal',
                name: 'normal',
                label: 'Normal',
                stringifier: function (r) { return r.value; },
                onSearch: onSearch(this),
                onChange: onChange(this),
            },
            success: {
                id: 'success',
                name: 'success',
                label: 'Success',
                stringifier: function (r) { return r.value; },
                message: 'This has a success message.',
                onSearch: onSearch(this),
                onChange: onChange(this),
            },
            warning: {
                id: 'warning',
                name: 'warning',
                label: 'Warning',
                stringifier: function (r) { return r.value; },
                message: 'This has a warning message.',
                onSearch: onSearch(this),
                onChange: onChange(this),
            },
            error: {
                id: 'error',
                name: 'error',
                label: 'Error',
                stringifier: function (r) { return r.value; },
                message: 'This has a error message.',
                onSearch: onSearch(this),
                onChange: onChange(this),
            },
            block: {
                id: 'block',
                name: 'block',
                label: 'Block',
                stringifier: function (r) { return r.value; },
                onSearch: onSearch(this),
                onChange: onChange(this),
            },
            init: {
                id: 'init',
                name: 'init',
                label: 'Init',
                value: results_1.results,
                stringifier: function (r) { return r.value; },
                onSearch: onSearch(this),
                onChange: onChange(this),
            }
        };
    }
    return MultiSelectPage;
}());
exports.MultiSelectPage = MultiSelectPage;
var onSearch = function (page) { return function (_a) {
    var name = _a.name, value = _a.value;
    return page
        .view
        .findById(name)
        .map(function (s) {
        var hit = results_1.results.filter(function (c) {
            return c.value.toLowerCase().startsWith(value) ? true : false;
        });
        s.update(hit);
    });
}; };
var onChange = function (page) { return function (_a) {
    var name = _a.name, value = _a.value;
    return page
        .view
        .findById(name)
        .map(function (t) {
        t.setMessage("Count: " + value.length);
    });
}; };
exports.default = new MultiSelectPage();

},{"../../fixtures/data/results":157,"./wml/multi-select":191}],191:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var multi_select_1 = require("../../../../../../lib/control/multi-select");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new multi_select_1.MultiSelect({ wml: { 'id': __context.values.normal.id }, ww: { 'name': __context.values.normal.name, 'label': __context.values.normal.label, 'stringifier': __context.values.normal.stringifier, 'onSearch': __context.values.normal.onSearch, 'onChange': __context.values.normal.onChange } }, []), { wml: { 'id': __context.values.normal.id }, ww: { 'name': __context.values.normal.name, 'label': __context.values.normal.label, 'stringifier': __context.values.normal.stringifier, 'onSearch': __context.values.normal.onSearch, 'onChange': __context.values.normal.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new multi_select_1.MultiSelect({ wml: { 'id': __context.values.success.id }, ww: { 'name': __context.values.success.name, 'label': __context.values.success.label, 'success': __context.values.success.message, 'stringifier': __context.values.success.stringifier, 'onSearch': __context.values.success.onSearch, 'onChange': __context.values.success.onChange } }, []), { wml: { 'id': __context.values.success.id }, ww: { 'name': __context.values.success.name, 'label': __context.values.success.label, 'success': __context.values.success.message, 'stringifier': __context.values.success.stringifier, 'onSearch': __context.values.success.onSearch, 'onChange': __context.values.success.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new multi_select_1.MultiSelect({ wml: { 'id': __context.values.warning.id }, ww: { 'name': __context.values.warning.name, 'label': __context.values.warning.label, 'warning': __context.values.warning.message, 'stringifier': __context.values.warning.stringifier, 'onSearch': __context.values.warning.onSearch, 'onChange': __context.values.warning.onChange } }, []), { wml: { 'id': __context.values.warning.id }, ww: { 'name': __context.values.warning.name, 'label': __context.values.warning.label, 'warning': __context.values.warning.message, 'stringifier': __context.values.warning.stringifier, 'onSearch': __context.values.warning.onSearch, 'onChange': __context.values.warning.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new multi_select_1.MultiSelect({ wml: { 'id': __context.values.error.id }, ww: { 'name': __context.values.error.name, 'label': __context.values.error.label, 'error': __context.values.error.message, 'stringifier': __context.values.error.stringifier, 'onSearch': __context.values.error.onSearch, 'onChange': __context.values.error.onChange } }, []), { wml: { 'id': __context.values.error.id }, ww: { 'name': __context.values.error.name, 'label': __context.values.error.label, 'error': __context.values.error.message, 'stringifier': __context.values.error.stringifier, 'onSearch': __context.values.error.onSearch, 'onChange': __context.values.error.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new multi_select_1.MultiSelect({ wml: { 'id': __context.values.block.id }, ww: { 'name': __context.values.block.name, 'label': __context.values.block.label, 'block': true, 'stringifier': __context.values.block.stringifier, 'onSearch': __context.values.block.onSearch, 'onChange': __context.values.block.onChange } }, []), { wml: { 'id': __context.values.block.id }, ww: { 'name': __context.values.block.name, 'label': __context.values.block.label, 'block': true, 'stringifier': __context.values.block.stringifier, 'onSearch': __context.values.block.onSearch, 'onChange': __context.values.block.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new multi_select_1.MultiSelect({ ww: { 'name': __context.values.normal.name, 'label': 'Disabled', 'disabled': true, 'onSearch': __context.values.normal.onSearch, 'onChange': __context.values.normal.onChange } }, []), { ww: { 'name': __context.values.normal.name, 'label': 'Disabled', 'disabled': true, 'onSearch': __context.values.normal.onSearch, 'onChange': __context.values.normal.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new multi_select_1.MultiSelect({ ww: { 'name': __context.values.init.name, 'label': 'Initialized', 'value': __context.values.init.value, 'stringifier': __context.values.init.stringifier, 'onSearch': __context.values.init.onSearch, 'onChange': __context.values.init.onChange } }, []), { ww: { 'name': __context.values.init.name, 'label': 'Initialized', 'value': __context.values.init.value, 'stringifier': __context.values.init.stringifier, 'onSearch': __context.values.init.onSearch, 'onChange': __context.values.init.onChange } })
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/multi-select":59,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],192:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PaginatorPage = void 0;
var views = require("./wml/paginator");
var scenes = [
    'Page 1',
    'Page 2',
    'Page 3',
    'Page 4',
    'Page 5',
    'Page 6',
    'Page 7',
    'Page 8',
    'Page 9',
    'Page 10'
];
var PaginatorPage = /** @class */ (function () {
    function PaginatorPage() {
        var _this = this;
        this.view = new views.Main(this);
        this.values = {
            message: scenes[0],
            current: 1,
            total: scenes.length,
            onChange: function (e) {
                _this.values.message = scenes[e.value - 1];
                _this.values.current = e.value;
                _this.view.invalidate();
            }
        };
    }
    return PaginatorPage;
}());
exports.PaginatorPage = PaginatorPage;
exports.default = new PaginatorPage();

},{"./wml/paginator":193}],193:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var paginator_1 = require("../../../../../../lib/control/paginator");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new paginator_1.Paginator({ ww: { 'total': __context.values.total, 'current': __context.values.current, 'onChange': __context.values.onChange } }, []), { ww: { 'total': __context.values.total, 'current': __context.values.current, 'onChange': __context.values.onChange } }),
                __this.node('p', {}, [
                    text(__context.values.message)
                ])
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/paginator":61,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],194:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SearchPage = void 0;
var views = require("./wml/search");
var results_1 = require("../../fixtures/data/results");
var SearchPage = /** @class */ (function () {
    function SearchPage() {
        this.view = new views.Main(this);
        this.values = {
            id: 'search',
            name: 'search',
            id2: 'search2',
            name2: 'search2',
            stringifier: function (r) { return r.value; },
            onSearch: onSearch(this),
            onSelect: onSelect,
        };
    }
    return SearchPage;
}());
exports.SearchPage = SearchPage;
var onSearch = function (page) { return function (_a) {
    var name = _a.name, value = _a.value;
    return page
        .view
        .findById(name)
        .map(function (s) {
        var hit = results_1.results.filter(function (c) {
            return c.value.toLowerCase().startsWith(value.toLowerCase()) ? true : false;
        });
        s.update(hit);
    });
}; };
var onSelect = function (_a) {
    var value = _a.value;
    return alert("Selected \"" + value.value + "\"");
};
exports.default = new SearchPage();

},{"../../fixtures/data/results":157,"./wml/search":195}],195:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var search_1 = require("../../../../../../lib/control/search");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.widget(new search_1.Search({ wml: { 'id': __context.values.id }, ww: { 'name': __context.values.name, 'stringifier': __context.values.stringifier, 'onSearch': __context.values.onSearch, 'onSelect': __context.values.onSelect } }, []), { wml: { 'id': __context.values.id }, ww: { 'name': __context.values.name, 'stringifier': __context.values.stringifier, 'onSearch': __context.values.onSearch, 'onSelect': __context.values.onSelect } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.widget(new search_1.Search({ wml: { 'id': __context.values.id2 }, ww: { 'name': __context.values.name2, 'block': true, 'stringifier': __context.values.stringifier, 'onSearch': __context.values.onSearch, 'onSelect': __context.values.onSelect } }, []), { wml: { 'id': __context.values.id2 }, ww: { 'name': __context.values.name2, 'block': true, 'stringifier': __context.values.stringifier, 'onSearch': __context.values.onSearch, 'onSelect': __context.values.onSelect } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('h2', {}, [
                        __document.createTextNode(' Disabled ')
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new search_1.Search({ ww: { 'disabled': true, 'stringifier': __context.values.stringifier, 'onSearch': __context.values.onSearch, 'onSelect': __context.values.onSelect } }, []), { ww: { 'disabled': true, 'stringifier': __context.values.stringifier, 'onSearch': __context.values.onSearch, 'onSelect': __context.values.onSelect } })
                    ])
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/search":65,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],196:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SelectPage = void 0;
var views = require("./wml/select");
var results_1 = require("../../fixtures/data/results");
var SelectPage = /** @class */ (function () {
    function SelectPage() {
        this.view = new views.Main(this);
        this.values = {
            normal: {
                id: 'normal',
                name: 'normal',
                label: 'Normal',
                value: results_1.results[2],
                stringifier: function (r) { return r.value; },
                onSearch: doSearch(this),
                onChange: doChange(this),
                onUnset: doUnset(this)
            },
            block: {
                id: 'block',
                name: 'block',
                label: 'Block',
                stringifier: function (r) { return r.value; },
                onSearch: doSearch(this),
                onChange: doChange(this),
                onUnset: doUnset(this)
            },
            success: {
                id: 'success',
                name: 'success',
                label: 'Success',
                stringifier: function (r) { return r.value; },
                message: 'This has a success message.',
                onSearch: doSearch(this),
                onChange: doChange(this),
                onUnset: doUnset(this)
            },
            warning: {
                id: 'warning',
                name: 'warning',
                label: 'Warning',
                stringifier: function (r) { return r.value; },
                message: 'This has a warning message.',
                onSearch: doSearch(this),
                onChange: doChange(this),
                onUnset: doUnset(this)
            },
            error: {
                id: 'error',
                name: 'error',
                label: 'Error',
                stringifier: function (r) { return r.value; },
                message: 'This has a error message.',
                onSearch: doSearch(this),
                onChange: doChange(this),
                onUnset: doUnset(this)
            },
        };
    }
    return SelectPage;
}());
exports.SelectPage = SelectPage;
var doSearch = function (page) { return function (_a) {
    var name = _a.name, value = _a.value;
    return page
        .view
        .findById(name)
        .map(function (s) {
        var hit = results_1.results.filter(function (c) {
            return c.value.toLowerCase().startsWith(value) ? true : false;
        });
        s.update(hit);
    });
}; };
var doChange = function (page) { return function (_a) {
    var name = _a.name, value = _a.value;
    return page
        .view
        .findById(name)
        .map(function (t) {
        t.setMessage("Selected: " + value.value);
    });
}; };
var doUnset = function (page) { return function (_a) {
    var name = _a.name;
    return page
        .view
        .findById(name)
        .map(function (t) {
        t.setMessage('');
    });
}; };
exports.default = new SelectPage();

},{"../../fixtures/data/results":157,"./wml/select":197}],197:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var select_1 = require("../../../../../../lib/control/select");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new select_1.Select({ wml: { 'id': __context.values.normal.id }, ww: { 'name': __context.values.normal.name, 'label': __context.values.normal.label, 'value': __context.values.normal.value, 'stringifier': __context.values.normal.stringifier, 'onSearch': __context.values.normal.onSearch, 'onChange': __context.values.normal.onChange } }, []), { wml: { 'id': __context.values.normal.id }, ww: { 'name': __context.values.normal.name, 'label': __context.values.normal.label, 'value': __context.values.normal.value, 'stringifier': __context.values.normal.stringifier, 'onSearch': __context.values.normal.onSearch, 'onChange': __context.values.normal.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new select_1.Select({ wml: { 'id': __context.values.success.id }, ww: { 'name': __context.values.success.name, 'label': __context.values.success.label, 'success': __context.values.success.message, 'stringifier': __context.values.success.stringifier, 'onSearch': __context.values.success.onSearch, 'onChange': __context.values.success.onChange } }, []), { wml: { 'id': __context.values.success.id }, ww: { 'name': __context.values.success.name, 'label': __context.values.success.label, 'success': __context.values.success.message, 'stringifier': __context.values.success.stringifier, 'onSearch': __context.values.success.onSearch, 'onChange': __context.values.success.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new select_1.Select({ wml: { 'id': __context.values.warning.id }, ww: { 'name': __context.values.warning.name, 'label': __context.values.warning.label, 'warning': __context.values.warning.message, 'stringifier': __context.values.warning.stringifier, 'onSearch': __context.values.warning.onSearch, 'onChange': __context.values.warning.onChange } }, []), { wml: { 'id': __context.values.warning.id }, ww: { 'name': __context.values.warning.name, 'label': __context.values.warning.label, 'warning': __context.values.warning.message, 'stringifier': __context.values.warning.stringifier, 'onSearch': __context.values.warning.onSearch, 'onChange': __context.values.warning.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new select_1.Select({ wml: { 'id': __context.values.error.id }, ww: { 'name': __context.values.error.name, 'label': __context.values.error.label, 'error': __context.values.error.message, 'stringifier': __context.values.error.stringifier, 'onSearch': __context.values.error.onSearch, 'onChange': __context.values.error.onChange } }, []), { wml: { 'id': __context.values.error.id }, ww: { 'name': __context.values.error.name, 'label': __context.values.error.label, 'error': __context.values.error.message, 'stringifier': __context.values.error.stringifier, 'onSearch': __context.values.error.onSearch, 'onChange': __context.values.error.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new select_1.Select({ wml: { 'id': __context.values.block.id }, ww: { 'name': __context.values.block.name, 'label': __context.values.block.label, 'block': true, 'stringifier': __context.values.block.stringifier, 'onSearch': __context.values.block.onSearch, 'onChange': __context.values.block.onChange } }, []), { wml: { 'id': __context.values.block.id }, ww: { 'name': __context.values.block.name, 'label': __context.values.block.label, 'block': true, 'stringifier': __context.values.block.stringifier, 'onSearch': __context.values.block.onSearch, 'onChange': __context.values.block.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new select_1.Select({ ww: { 'name': __context.values.normal.name, 'label': 'Disabled', 'disabled': true, 'stringifier': __context.values.normal.stringifier, 'onSearch': __context.values.normal.onSearch, 'onChange': __context.values.normal.onChange } }, []), { ww: { 'name': __context.values.normal.name, 'label': 'Disabled', 'disabled': true, 'stringifier': __context.values.normal.stringifier, 'onSearch': __context.values.normal.onSearch, 'onChange': __context.values.normal.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new select_1.Select({ ww: { 'name': __context.values.normal.name, 'label': 'Disabled with value', 'value': __context.values.normal.value, 'disabled': true, 'stringifier': __context.values.normal.stringifier, 'onSearch': __context.values.normal.onSearch, 'onChange': __context.values.normal.onChange } }, []), { ww: { 'name': __context.values.normal.name, 'label': 'Disabled with value', 'value': __context.values.normal.value, 'disabled': true, 'stringifier': __context.values.normal.stringifier, 'onSearch': __context.values.normal.onSearch, 'onChange': __context.values.normal.onChange } })
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/select":67,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],198:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.StackSelectPage = void 0;
var views = require("./wml/stack-select");
var results_1 = require("../../fixtures/data/results");
var StackSelectPage = /** @class */ (function () {
    function StackSelectPage() {
        this.view = new views.Main(this);
        this.values = {
            asc: {
                id: 'asc',
                name: 'asc',
                label: 'Ascending',
                value: results_1.results[2],
                stringifier: function (r) { return r.value; },
                onSearch: onSearch(this),
                onChange: onChange(this),
            },
            desc: {
                id: 'desc',
                name: 'desc',
                label: 'Descending',
                stringifier: function (r) { return r.value; },
                onSearch: onSearch(this),
                onChange: onChange(this),
            },
            success: {
                id: 'success',
                name: 'success',
                label: 'Success',
                stringifier: function (r) { return r.value; },
                message: 'This has a success message.',
                onSearch: onSearch(this),
                onChange: onChange(this),
            },
            warning: {
                id: 'warning',
                name: 'warning',
                label: 'Warning',
                stringifier: function (r) { return r.value; },
                message: 'This has a warning message.',
                onSearch: onSearch(this),
                onChange: onChange(this),
            },
            error: {
                id: 'error',
                name: 'error',
                label: 'Error',
                stringifier: function (r) { return r.value; },
                message: 'This has a error message.',
                onSearch: onSearch(this),
                onChange: onChange(this),
            },
        };
    }
    return StackSelectPage;
}());
exports.StackSelectPage = StackSelectPage;
var onSearch = function (page) { return function (_a) {
    var name = _a.name, value = _a.value;
    return page
        .view
        .findById(name)
        .map(function (s) {
        var hit = results_1.results.filter(function (c) {
            return c.value.toLowerCase().startsWith(value) ? true : false;
        });
        s.update(hit);
    });
}; };
var onChange = function (page) { return function (_a) {
    var name = _a.name, value = _a.value;
    return page
        .view
        .findById(name)
        .map(function (t) {
        t.setMessage("Count: " + value.length);
    });
}; };
exports.default = new StackSelectPage();

},{"../../fixtures/data/results":157,"./wml/stack-select":199}],199:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var stack_select_1 = require("../../../../../../lib/control/stack-select");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new stack_select_1.StackSelect({ wml: { 'id': __context.values.asc.id }, ww: { 'name': __context.values.asc.name, 'label': __context.values.asc.label, 'stringifier': __context.values.asc.stringifier, 'onSearch': __context.values.asc.onSearch, 'onChange': __context.values.asc.onChange } }, []), { wml: { 'id': __context.values.asc.id }, ww: { 'name': __context.values.asc.name, 'label': __context.values.asc.label, 'stringifier': __context.values.asc.stringifier, 'onSearch': __context.values.asc.onSearch, 'onChange': __context.values.asc.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new stack_select_1.StackSelect({ wml: { 'id': __context.values.desc.id }, ww: { 'name': __context.values.desc.name, 'label': __context.values.desc.label, 'dir': -1, 'stringifier': __context.values.desc.stringifier, 'onSearch': __context.values.desc.onSearch, 'onChange': __context.values.desc.onChange } }, []), { wml: { 'id': __context.values.desc.id }, ww: { 'name': __context.values.desc.name, 'label': __context.values.desc.label, 'dir': -1, 'stringifier': __context.values.desc.stringifier, 'onSearch': __context.values.desc.onSearch, 'onChange': __context.values.desc.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new stack_select_1.StackSelect({ wml: { 'id': __context.values.success.id }, ww: { 'name': __context.values.success.name, 'label': __context.values.success.label, 'success': __context.values.success.message, 'stringifier': __context.values.success.stringifier, 'onSearch': __context.values.success.onSearch, 'onChange': __context.values.success.onChange } }, []), { wml: { 'id': __context.values.success.id }, ww: { 'name': __context.values.success.name, 'label': __context.values.success.label, 'success': __context.values.success.message, 'stringifier': __context.values.success.stringifier, 'onSearch': __context.values.success.onSearch, 'onChange': __context.values.success.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new stack_select_1.StackSelect({ wml: { 'id': __context.values.warning.id }, ww: { 'name': __context.values.warning.name, 'label': __context.values.warning.label, 'warning': __context.values.warning.message, 'stringifier': __context.values.warning.stringifier, 'onSearch': __context.values.warning.onSearch, 'onChange': __context.values.warning.onChange } }, []), { wml: { 'id': __context.values.warning.id }, ww: { 'name': __context.values.warning.name, 'label': __context.values.warning.label, 'warning': __context.values.warning.message, 'stringifier': __context.values.warning.stringifier, 'onSearch': __context.values.warning.onSearch, 'onChange': __context.values.warning.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new stack_select_1.StackSelect({ wml: { 'id': __context.values.error.id }, ww: { 'name': __context.values.error.name, 'label': __context.values.error.label, 'error': __context.values.error.message, 'stringifier': __context.values.error.stringifier, 'onSearch': __context.values.error.onSearch, 'onChange': __context.values.error.onChange } }, []), { wml: { 'id': __context.values.error.id }, ww: { 'name': __context.values.error.name, 'label': __context.values.error.label, 'error': __context.values.error.message, 'stringifier': __context.values.error.stringifier, 'onSearch': __context.values.error.onSearch, 'onChange': __context.values.error.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new stack_select_1.StackSelect({ ww: { 'name': __context.values.asc.name, 'label': 'Disabled', 'disabled': true, 'stringifier': __context.values.asc.stringifier, 'onSearch': __context.values.asc.onSearch, 'onChange': __context.values.asc.onChange } }, []), { ww: { 'name': __context.values.asc.name, 'label': 'Disabled', 'disabled': true, 'stringifier': __context.values.asc.stringifier, 'onSearch': __context.values.asc.onSearch, 'onChange': __context.values.asc.onChange } })
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/stack-select":69,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],200:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.StackPage = void 0;
var views = require("./wml/stack");
var _getValues = function () { return [
    { label: 'Asus', value: 'Asus' },
    { label: 'MSI', value: 'MSI' },
    { label: 'MSI', value: 'MSI' },
    { label: 'Gigabyte', value: 'Gigabyte' }
]; };
var _getText = function (m) {
    return document.createTextNode(m.map(function (_a) {
        var label = _a.label;
        return label;
    }).join(','));
};
var StackPage = /** @class */ (function () {
    function StackPage() {
        var _this = this;
        this.view = new views.Main(this);
        this.values = {
            values: _getValues(),
            text: _getText(_getValues()),
            decorator: function (m) { return m.label; }
        };
        this.onChange = function (_a) {
            var value = _a.value;
            if (value.length === 0)
                _this.values.values = _getValues();
            _this.values.text = _getText(_this.values.values);
            _this.view.invalidate();
        };
    }
    return StackPage;
}());
exports.StackPage = StackPage;
exports.default = new StackPage();

},{"./wml/stack":201}],201:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var stack_1 = require("../../../../../../lib/control/stack");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.node('p', {}, [
                    __document.createTextNode('Members: '),
                    __this.node('b', { wml: { 'id': 'selected' } }, [
                        __context.values.text
                    ]),
                    __document.createTextNode('.')
                ]),
                __this.node('p', {}, [
                    __this.widget(new stack_1.Stack({ ww: { 'name': 'stack', 'value': __context.values.values, 'decorator': __context.values.decorator, 'onChange': __context.onChange } }, []), { ww: { 'name': 'stack', 'value': __context.values.values, 'decorator': __context.values.decorator, 'onChange': __context.onChange } })
                ]),
                __this.node('p', {}, [
                    __document.createTextNode('Disabled')
                ]),
                __this.node('p', {}, [
                    __this.widget(new stack_1.Stack({ ww: { 'name': 'stack', 'value': __context.values.values, 'disabled': true, 'decorator': __context.values.decorator, 'onChange': __context.onChange } }, []), { ww: { 'name': 'stack', 'value': __context.values.values, 'disabled': true, 'decorator': __context.values.decorator, 'onChange': __context.onChange } })
                ])
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/stack":71,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],202:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SwitchPage = void 0;
var views = require("./wml/switch");
var SwitchPage = /** @class */ (function () {
    function SwitchPage() {
        var _this = this;
        this.view = new views.Main(this);
        this.value = true;
        this.onChange = function (_a) {
            var value = _a.value;
            _this.view.findById('content')
                .map(function (e) {
                while (e.firstChild)
                    e.removeChild(e.firstChild);
                e.appendChild(document.createTextNode(value === true ?
                    'on' :
                    (value === false ? 'off' : 'error')));
            });
        };
    }
    return SwitchPage;
}());
exports.SwitchPage = SwitchPage;
exports.default = new SwitchPage();

},{"./wml/switch":203}],203:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var switch_1 = require("../../../../../../lib/control/switch");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __document.createTextNode('The switch is already set.')
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new switch_1.Switch({ ww: { 'name': 'switch', 'value': true } }, []), { ww: { 'name': 'switch', 'value': true } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __document.createTextNode('The switch is '),
                        __this.node('b', { wml: { 'id': 'content' } }, [
                            __document.createTextNode('untouched')
                        ]),
                        __document.createTextNode('.')
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new switch_1.Switch({ ww: { 'name': 'switch', 'onChange': __context.onChange } }, []), { ww: { 'name': 'switch', 'onChange': __context.onChange } })
                    ])
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/switch":73,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],204:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TabBarPage = void 0;
var views = require("./wml/tab-bar");
var TabBarPage = /** @class */ (function () {
    function TabBarPage() {
        var _this = this;
        this.view = new views.Main(this);
        this.tab = 'First';
        this.content = document.createTextNode('First Tab');
        this.clicked = function (_a) {
            var name = _a.name;
            _this.tab = name;
            _this.content = document.createTextNode(name + " Tab");
            _this.view.invalidate();
        };
    }
    return TabBarPage;
}());
exports.TabBarPage = TabBarPage;
exports.default = new TabBarPage();

},{"./wml/tab-bar":205}],205:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var tab_bar_1 = require("../../../../../../lib/control/tab-bar");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new tab_bar_1.TabBar({}, [
                        __this.widget(new tab_bar_1.Tab({ ww: { 'active': (__context.tab === 'First'), 'text': 'First', 'name': 'First', 'onClick': __context.clicked } }, []), { ww: { 'active': (__context.tab === 'First'), 'text': 'First', 'name': 'First', 'onClick': __context.clicked } }),
                        __this.widget(new tab_bar_1.Tab({ ww: { 'active': (__context.tab === 'Second'), 'text': 'Second', 'name': 'Second', 'onClick': __context.clicked } }, []), { ww: { 'active': (__context.tab === 'Second'), 'text': 'Second', 'name': 'Second', 'onClick': __context.clicked } }),
                        __this.widget(new tab_bar_1.Tab({ ww: { 'active': (__context.tab === 'Third'), 'text': 'Third', 'name': 'Third', 'onClick': __context.clicked } }, []), { ww: { 'active': (__context.tab === 'Third'), 'text': 'Third', 'name': 'Third', 'onClick': __context.clicked } })
                    ]), {})
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new tab_bar_1.TabBar({ ww: { 'justify': true } }, [
                        __this.widget(new tab_bar_1.Tab({ ww: { 'active': (__context.tab === 'First'), 'text': 'First', 'name': 'First', 'onClick': __context.clicked } }, []), { ww: { 'active': (__context.tab === 'First'), 'text': 'First', 'name': 'First', 'onClick': __context.clicked } }),
                        __this.widget(new tab_bar_1.Tab({ ww: { 'active': (__context.tab === 'Second'), 'text': 'Second', 'name': 'Second', 'onClick': __context.clicked } }, []), { ww: { 'active': (__context.tab === 'Second'), 'text': 'Second', 'name': 'Second', 'onClick': __context.clicked } }),
                        __this.widget(new tab_bar_1.Tab({ ww: { 'active': (__context.tab === 'Third'), 'text': 'Third', 'name': 'Third', 'onClick': __context.clicked } }, []), { ww: { 'active': (__context.tab === 'Third'), 'text': 'Third', 'name': 'Third', 'onClick': __context.clicked } })
                    ]), { ww: { 'justify': true } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', { wml: { 'id': 'content' } }, [
                        __context.content
                    ])
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/tab-bar":75,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],206:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TagPage = void 0;
var views = require("./wml/tag");
var style_1 = require("../../../../../lib/content/style");
var getStyles = function () { return [
    style_1.Style.Default,
    style_1.Style.Primary,
    style_1.Style.Success,
    style_1.Style.Info,
    style_1.Style.Warning,
    style_1.Style.Error
]; };
var TagPage = /** @class */ (function () {
    function TagPage() {
        var _this = this;
        this.view = new views.Main(this);
        this.values = {
            capitalize: function (s) { return "" + s[0].toUpperCase() + s.slice(1); },
            styles: getStyles(),
            onDismiss: function (e) {
                var idx = _this.values.styles.indexOf(e.name);
                if (idx > -1)
                    _this.values.styles.splice(idx, 1);
                if (_this.values.styles.length === 0)
                    _this.values.styles = getStyles();
                _this.view.invalidate();
            }
        };
    }
    return TagPage;
}());
exports.TagPage = TagPage;
exports.default = new TagPage();

},{"../../../../../lib/content/style":20,"./wml/tag":207}],207:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var tag_1 = require("../../../../../../lib/control/tag");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.node('h1', {}, [
                        __document.createTextNode('Tag')
                    ]),
                    __this.node('p', {}, __spreadArrays([
                        __this.node('h2', {}, [
                            __document.createTextNode('Styles')
                        ])
                    ], __forIn(__context.values.styles, function (v, _$$i, _$$all) {
                        return ([
                            __this.widget(new tag_1.Tag({ ww: { 'style': v, 'text': __context.values.capitalize(v), 'name': v, 'onDismiss': __context.values.onDismiss } }, []), { ww: { 'style': v, 'text': __context.values.capitalize(v), 'name': v, 'onDismiss': __context.values.onDismiss } })
                        ]);
                    }, function () { return ([]); })))
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/tag":77,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],208:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TextFieldPage = void 0;
var views = require("./wml/text-field");
var feedback_1 = require("../../../../../lib/control/feedback");
var TextFieldPage = /** @class */ (function () {
    function TextFieldPage() {
        var _this = this;
        this.id = 'text';
        this.view = new views.Main(this);
        this.onChange = function (_a) {
            var name = _a.name, value = _a.value;
            var maybeField = _this.view.findById(name);
            if (maybeField.isJust()) {
                var t = maybeField.get();
                switch (value) {
                    case 'neutral':
                        t.setValidationState(feedback_1.ValidationState.Neutral);
                        break;
                    case 'error':
                        t.setValidationState(feedback_1.ValidationState.Error);
                        break;
                    case 'success':
                        t.setValidationState(feedback_1.ValidationState.Success);
                        break;
                    case 'warning':
                        t.setValidationState(feedback_1.ValidationState.Warning);
                        break;
                    default:
                        break;
                }
                t.setMessage("Message: " + value);
            }
        };
    }
    return TextFieldPage;
}());
exports.TextFieldPage = TextFieldPage;
exports.default = new TextFieldPage();

},{"../../../../../lib/control/feedback":45,"./wml/text-field":209}],209:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var text_field_1 = require("../../../../../../lib/control/text-field");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __document.createTextNode('The value of the input is:')
                    ]),
                    __this.node('p', {}, [
                        __this.node('b', { wml: { 'id': 'content' } }, [
                            __document.createTextNode('Nothing')
                        ])
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new text_field_1.TextField({ wml: { 'id': 'text' }, ww: { 'name': 'text', 'message': 'This is the help message', 'focus': true, 'onChange': __context.onChange } }, []), { wml: { 'id': 'text' }, ww: { 'name': 'text', 'message': 'This is the help message', 'focus': true, 'onChange': __context.onChange } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.node('strong', {}, [
                            __document.createTextNode('Success')
                        ])
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new text_field_1.TextField({ wml: { 'id': 'success' }, ww: { 'name': 'success', 'label': 'This is a success label', 'success': 'This textfield has a success', 'onChange': __context.onChange } }, []), { wml: { 'id': 'success' }, ww: { 'name': 'success', 'label': 'This is a success label', 'success': 'This textfield has a success', 'onChange': __context.onChange } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.node('strong', {}, [
                            __document.createTextNode('Warning')
                        ])
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new text_field_1.TextField({ wml: { 'id': 'warning' }, ww: { 'name': 'warning', 'label': 'This is a warning label', 'warning': 'This textfield has a warning.', 'onChange': __context.onChange } }, []), { wml: { 'id': 'warning' }, ww: { 'name': 'warning', 'label': 'This is a warning label', 'warning': 'This textfield has a warning.', 'onChange': __context.onChange } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.node('strong', {}, [
                            __document.createTextNode('Error')
                        ])
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new text_field_1.TextField({ wml: { 'id': 'error' }, ww: { 'name': 'error', 'label': 'This is an error label', 'error': 'This textfield has an error.', 'onChange': __context.onChange } }, []), { wml: { 'id': 'error' }, ww: { 'name': 'error', 'label': 'This is an error label', 'error': 'This textfield has an error.', 'onChange': __context.onChange } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __document.createTextNode('The one uses rows to render a text area:')
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new text_field_1.TextField({ wml: { 'id': 'area' }, ww: { 'name': 'area', 'rows': 5, 'label': 'This is a textarea label', 'onChange': __context.onChange } }, []), { wml: { 'id': 'area' }, ww: { 'name': 'area', 'rows': 5, 'label': 'This is a textarea label', 'onChange': __context.onChange } })
                    ])
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/text-field":79,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],210:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TextInputPage = void 0;
var views = require("./wml/text-input");
var size_1 = require("../../../../../lib/content/size");
var TextInputPage = /** @class */ (function () {
    function TextInputPage() {
        var _this = this;
        this.view = new views.Main(this);
        this.sizes = [
            size_1.Size.ExtraSmall,
            size_1.Size.Small,
            size_1.Size.Medium,
            size_1.Size.Large,
            size_1.Size.ExtraLarge
        ];
        this.content = function () { return document.createTextNode('this'); };
        this.onChange = function (_a) {
            var value = _a.value;
            _this
                .view
                .findById('txt')
                .map(function (h) { return h.innerHTML = value; });
        };
    }
    return TextInputPage;
}());
exports.TextInputPage = TextInputPage;
exports.default = new TextInputPage();

},{"../../../../../lib/content/size":16,"./wml/text-input":211}],211:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var text_input_1 = require("../../../../../../lib/control/text-input");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __document.createTextNode('\u000a      This is a text input: \u000a      '),
                        __this.widget(new text_input_1.TextInput({ ww: { 'match': '[a-zA-Z]', 'length': 20, 'onChange': __context.onChange } }, []), { ww: { 'match': '[a-zA-Z]', 'length': 20, 'onChange': __context.onChange } }),
                        __document.createTextNode('.\u000a    ')
                    ]),
                    __this.node('p', {}, [
                        __document.createTextNode('As you type '),
                        __this.node('b', { wml: { 'id': 'txt' } }, [
                            __document.createTextNode('this')
                        ]),
                        __document.createTextNode(' changes, but only for letters. (20)')
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, __spreadArrays(__forIn(__context.sizes, function (v, _$$i, _$$all) {
                    return ([
                        __this.node('p', {}, [
                            __document.createTextNode('\u000a        Size '),
                            document.createTextNode((v + ' neutral: ')),
                            __this.widget(new text_input_1.TextInput({ ww: { 'onChange': __context.onChange, 'size': v } }, []), { ww: { 'onChange': __context.onChange, 'size': v } })
                        ]),
                        __this.node('p', {}, [
                            __document.createTextNode('\u000a        Size '),
                            document.createTextNode((v + ' error: ')),
                            __this.widget(new text_input_1.TextInput({ ww: { 'onChange': __context.onChange, 'size': v, 'className': '-error' } }, []), { ww: { 'onChange': __context.onChange, 'size': v, 'className': '-error' } })
                        ]),
                        __this.node('p', {}, [
                            __document.createTextNode('\u000a        Size '),
                            document.createTextNode((v + ' warning: ')),
                            __this.widget(new text_input_1.TextInput({ ww: { 'onChange': __context.onChange, 'size': v, 'className': '-warning' } }, []), { ww: { 'onChange': __context.onChange, 'size': v, 'className': '-warning' } })
                        ]),
                        __this.node('p', {}, [
                            __document.createTextNode('\u000a        Size '),
                            document.createTextNode((v + ' success: ')),
                            __this.widget(new text_input_1.TextInput({ ww: { 'onChange': __context.onChange, 'size': v, 'className': '-success' } }, []), { ww: { 'onChange': __context.onChange, 'size': v, 'className': '-success' } })
                        ])
                    ]);
                }, function () { return ([]); }))), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __document.createTextNode('\u000a      Block:\u000a      '),
                        __this.widget(new text_input_1.TextInput({ ww: { 'onChange': __context.onChange, 'block': true } }, []), { ww: { 'onChange': __context.onChange, 'block': true } })
                    ])
                ]), {}),
                __this.node('p', {}, [
                    __document.createTextNode(' Textarea: ')
                ]),
                __this.widget(new demo_1.Demo({}, __spreadArrays(__forIn(__context.sizes, function (v, _$$i, _$$all) {
                    return ([
                        __this.node('p', {}, [
                            __document.createTextNode('\u000a        Size '),
                            document.createTextNode((v + ' neutral: ')),
                            __this.widget(new text_input_1.TextInput({ ww: { 'onChange': __context.onChange, 'rows': 5, 'size': v } }, []), { ww: { 'onChange': __context.onChange, 'rows': 5, 'size': v } })
                        ]),
                        __this.node('p', {}, [
                            __document.createTextNode('\u000a        Size '),
                            document.createTextNode((v + ' error: ')),
                            __this.widget(new text_input_1.TextInput({ ww: { 'onChange': __context.onChange, 'size': v, 'rows': 5, 'className': '-error' } }, []), { ww: { 'onChange': __context.onChange, 'size': v, 'rows': 5, 'className': '-error' } })
                        ]),
                        __this.node('p', {}, [
                            __document.createTextNode('\u000a        Size '),
                            document.createTextNode((v + ' warning: ')),
                            __this.widget(new text_input_1.TextInput({ ww: { 'onChange': __context.onChange, 'size': v, 'rows': 5, 'className': '-warning' } }, []), { ww: { 'onChange': __context.onChange, 'size': v, 'rows': 5, 'className': '-warning' } })
                        ]),
                        __this.node('p', {}, [
                            __document.createTextNode('\u000a        Size '),
                            document.createTextNode((v + ' success: ')),
                            __this.widget(new text_input_1.TextInput({ ww: { 'onChange': __context.onChange, 'size': v, 'rows': 5, 'className': '-success' } }, []), { ww: { 'onChange': __context.onChange, 'size': v, 'rows': 5, 'className': '-success' } })
                        ])
                    ]);
                }, function () { return ([]); }))), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __document.createTextNode('\u000a      Block:\u000a      '),
                        __this.widget(new text_input_1.TextInput({ ww: { 'onChange': __context.onChange, 'block': true, 'rows': 5 } }, []), { ww: { 'onChange': __context.onChange, 'block': true, 'rows': 5 } })
                    ])
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __document.createTextNode('\u000a      Autofocused:\u000a      '),
                        __this.widget(new text_input_1.TextInput({ ww: { 'onChange': __context.onChange, 'focus': true } }, []), { ww: { 'onChange': __context.onChange, 'focus': true } })
                    ])
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/text-input":81,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],212:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ToolbarPage = void 0;
var views = require("./wml/toolbar");
var ToolbarPage = /** @class */ (function () {
    function ToolbarPage() {
        this.view = new views.Main(this);
    }
    return ToolbarPage;
}());
exports.ToolbarPage = ToolbarPage;
exports.default = new ToolbarPage();

},{"./wml/toolbar":213}],213:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var button_1 = require("../../../../../../lib/control/button");
;
var button_group_1 = require("../../../../../../lib/control/button-group");
;
var toolbar_1 = require("../../../../../../lib/control/toolbar");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new toolbar_1.Toolbar({}, [
                    __this.widget(new button_group_1.ButtonGroup({}, [
                        __this.widget(new button_1.Button({ ww: { 'text': 'one' } }, []), { ww: { 'text': 'one' } }),
                        __this.widget(new button_1.Button({ ww: { 'text': 'two' } }, []), { ww: { 'text': 'two' } }),
                        __this.widget(new button_1.Button({ ww: { 'text': 'three' } }, []), { ww: { 'text': 'three' } })
                    ]), {}),
                    __this.widget(new button_group_1.ButtonGroup({}, [
                        __this.widget(new button_1.Button({ ww: { 'text': 'four' } }, []), { ww: { 'text': 'four' } }),
                        __this.widget(new button_1.Button({ ww: { 'text': 'five', 'active': true } }, []), { ww: { 'text': 'five', 'active': true } }),
                        __this.widget(new button_1.Button({ ww: { 'text': 'six' } }, []), { ww: { 'text': 'six' } })
                    ]), {}),
                    __this.widget(new button_group_1.ButtonGroup({}, [
                        __this.widget(new button_1.Button({ ww: { 'text': 'seven' } }, []), { ww: { 'text': 'seven' } }),
                        __this.widget(new button_1.Button({ ww: { 'text': 'eight', 'active': true } }, []), { ww: { 'text': 'eight', 'active': true } }),
                        __this.widget(new button_1.Button({ ww: { 'text': '9' } }, []), { ww: { 'text': '9' } })
                    ]), {})
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/button":29,"../../../../../../lib/control/button-group":25,"../../../../../../lib/control/toolbar":83,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],214:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TypeaheadPage = void 0;
var views = require("./wml/typeahead");
var results = [
    { label: 'Asus', value: 'Asus' },
    { label: 'MSI', value: 'MSI' },
    { label: 'Gigabyte', value: 'Gigabyte' },
    { label: 'Gigas', value: 'Gigas' },
    { label: 'AsusTek', value: 'AsusTek' },
    { label: 'Asusuga', value: 'Asusuga' },
    { label: 'Qualcomm', value: 'Qualcomm' },
    { label: 'Qualitative', value: 'Qualitatve' },
    { label: 'Kirpalani\'s', value: 'Kirpalani\'s' },
    { label: 'Asunder', value: 'Asunder' }
];
var TypeaheadPage = /** @class */ (function () {
    function TypeaheadPage() {
        this.view = new views.Main(this);
        this.values = {
            normal: {
                id: 'normal',
                name: 'normal',
                label: 'Normal',
                value: 'Normal',
                stringifier: function (r) { return r.value; },
                onSearch: doSearch(this),
                onChange: doChange(this)
            },
            block: {
                id: 'block',
                name: 'block',
                label: 'Block',
                stringifier: function (r) { return r.value; },
                onSearch: doSearch(this),
                onChange: doChange(this)
            },
            success: {
                id: 'success',
                name: 'success',
                label: 'Success',
                stringifier: function (r) { return r.value; },
                message: 'This has a success message.',
                onSearch: doSearch(this),
                onChange: doChange(this)
            },
            warning: {
                id: 'warning',
                name: 'warning',
                label: 'Warning',
                stringifier: function (r) { return r.value; },
                message: 'This has a warning message.',
                onSearch: doSearch(this),
                onChange: doChange(this)
            },
            error: {
                id: 'error',
                name: 'error',
                label: 'Error',
                stringifier: function (r) { return r.value; },
                message: 'This has a error message.',
                onSearch: doSearch(this),
                onChange: doChange(this)
            },
        };
    }
    return TypeaheadPage;
}());
exports.TypeaheadPage = TypeaheadPage;
var doSearch = function (page) { return function (_a) {
    var name = _a.name, value = _a.value;
    return page
        .view
        .findById(name)
        .map(function (s) {
        var hit = results.filter(function (c) {
            return c.value.toLowerCase().startsWith(value) ? true : false;
        });
        s.update(hit);
    });
}; };
var doChange = function (page) { return function (_a) {
    var name = _a.name, value = _a.value;
    return page
        .view
        .findById(name)
        .map(function (t) {
        t.setMessage("Selected: " + value);
    });
}; };
exports.default = new TypeaheadPage();

},{"./wml/typeahead":215}],215:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var typeahead_1 = require("../../../../../../lib/control/typeahead");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new typeahead_1.Typeahead({ wml: { 'id': __context.values.normal.id }, ww: { 'name': __context.values.normal.name, 'label': __context.values.normal.label, 'stringifier': __context.values.normal.stringifier, 'onSearch': __context.values.normal.onSearch, 'onChange': __context.values.normal.onChange } }, []), { wml: { 'id': __context.values.normal.id }, ww: { 'name': __context.values.normal.name, 'label': __context.values.normal.label, 'stringifier': __context.values.normal.stringifier, 'onSearch': __context.values.normal.onSearch, 'onChange': __context.values.normal.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new typeahead_1.Typeahead({ wml: { 'id': __context.values.success.id }, ww: { 'name': __context.values.success.name, 'label': __context.values.success.label, 'success': __context.values.success.message, 'stringifier': __context.values.success.stringifier, 'onSearch': __context.values.success.onSearch, 'onChange': __context.values.success.onChange } }, []), { wml: { 'id': __context.values.success.id }, ww: { 'name': __context.values.success.name, 'label': __context.values.success.label, 'success': __context.values.success.message, 'stringifier': __context.values.success.stringifier, 'onSearch': __context.values.success.onSearch, 'onChange': __context.values.success.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new typeahead_1.Typeahead({ wml: { 'id': __context.values.warning.id }, ww: { 'name': __context.values.warning.name, 'label': __context.values.warning.label, 'warning': __context.values.warning.message, 'stringifier': __context.values.warning.stringifier, 'onSearch': __context.values.warning.onSearch, 'onChange': __context.values.warning.onChange } }, []), { wml: { 'id': __context.values.warning.id }, ww: { 'name': __context.values.warning.name, 'label': __context.values.warning.label, 'warning': __context.values.warning.message, 'stringifier': __context.values.warning.stringifier, 'onSearch': __context.values.warning.onSearch, 'onChange': __context.values.warning.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new typeahead_1.Typeahead({ wml: { 'id': __context.values.error.id }, ww: { 'name': __context.values.error.name, 'label': __context.values.error.label, 'error': __context.values.error.message, 'stringifier': __context.values.error.stringifier, 'onSearch': __context.values.error.onSearch, 'onChange': __context.values.error.onChange } }, []), { wml: { 'id': __context.values.error.id }, ww: { 'name': __context.values.error.name, 'label': __context.values.error.label, 'error': __context.values.error.message, 'stringifier': __context.values.error.stringifier, 'onSearch': __context.values.error.onSearch, 'onChange': __context.values.error.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new typeahead_1.Typeahead({ wml: { 'id': __context.values.block.id }, ww: { 'name': __context.values.block.name, 'label': __context.values.block.label, 'block': true, 'stringifier': __context.values.block.stringifier, 'onSearch': __context.values.block.onSearch, 'onChange': __context.values.block.onChange } }, []), { wml: { 'id': __context.values.block.id }, ww: { 'name': __context.values.block.name, 'label': __context.values.block.label, 'block': true, 'stringifier': __context.values.block.stringifier, 'onSearch': __context.values.block.onSearch, 'onChange': __context.values.block.onChange } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new typeahead_1.Typeahead({ ww: { 'name': __context.values.normal.name, 'label': 'Disabled', 'disabled': true, 'stringifier': __context.values.normal.stringifier, 'onSearch': __context.values.normal.onSearch, 'onChange': __context.values.normal.onChange } }, []), { ww: { 'name': __context.values.normal.name, 'label': 'Disabled', 'disabled': true, 'stringifier': __context.values.normal.stringifier, 'onSearch': __context.values.normal.onSearch, 'onChange': __context.values.normal.onChange } })
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/control/typeahead":85,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],216:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.users = void 0;
exports.users = [
    {
        "_id": "59f1334ccc21ff728cf7f3ce",
        "index": 0,
        "guid": "fd94cd52-e7f1-44ab-a74f-05604eee46dd",
        "isActive": false,
        "balance": "$2,849.93",
        "picture": "http://placehold.it/32x32",
        "age": 34,
        "eyeColor": "green",
        "name": "Johns Lewis",
        "gender": "female",
        "company": "PROFLEX",
        "email": "johnslewis@proflex.com",
        "phone": "+1 (925) 409-3400",
        "address": "874 Grove Street, Edgewater, Georgia, 8112",
        "about": "Ex esse dolore et sint sint proident nostrud ut officia. Do nulla mollit dolore ut aute excepteur deserunt laboris ut proident. Ullamco est deserunt ex commodo veniam duis elit excepteur velit ullamco deserunt culpa do est.\r\n",
        "registered": "2015-02-22T10:25:32 +04:00",
        "latitude": 56.278862,
        "longitude": -79.459101,
        "tags": [
            "labore",
            "proident",
            "aliqua",
            "amet",
            "amet",
            "officia",
            "enim"
        ],
        "friends": [
            {
                "id": 0,
                "name": "Mason Noble"
            },
            {
                "id": 1,
                "name": "Coffey Mendez"
            },
            {
                "id": 2,
                "name": "Dionne Cole"
            }
        ],
        "greeting": "Hello, Johns Lewis! You have 5 unread messages.",
        "favoriteFruit": "banana"
    },
    {
        "_id": "59f1334c09dc1bcdc5732491",
        "index": 1,
        "guid": "33255995-0431-4271-9876-37eabc117a7b",
        "isActive": false,
        "balance": "$2,167.40",
        "picture": "http://placehold.it/32x32",
        "age": 23,
        "eyeColor": "blue",
        "name": "Williamson Gregory",
        "gender": "undefined",
        "company": "NETAGY",
        "email": "williamsongregory@netagy.com",
        "phone": "+1 (910) 462-3918",
        "address": "158 Sedgwick Street, Glasgow, Utah, 5498",
        "about": "Excepteur sit nisi et velit. Laboris minim id duis ad qui cupidatat. Est Lorem quis duis Lorem laboris velit laboris non excepteur et velit voluptate qui. Dolore qui anim exercitation veniam incididunt laboris labore. Id minim labore amet sunt excepteur tempor proident.\r\n",
        "registered": "2016-04-25T04:25:24 +04:00",
        "latitude": 54.457833,
        "longitude": 122.803765,
        "tags": [
            "tempor",
            "exercitation",
            "et",
            "elit",
            "ex",
            "cillum",
            "laboris"
        ],
        "friends": [
            {
                "id": 0,
                "name": "Navarro Reeves"
            },
            {
                "id": 1,
                "name": "Stanton Vincent"
            },
            {
                "id": 2,
                "name": "Alexis Guzman"
            }
        ],
        "greeting": "Hello, Williamson Gregory! You have 1 unread messages.",
        "favoriteFruit": "apple"
    },
    {
        "_id": "59f1334c9d799789bc494a3c",
        "index": 2,
        "guid": "158ffa5d-15da-4a9f-a1da-0a48b76b8226",
        "isActive": false,
        "balance": "$1,289.35",
        "picture": "http://placehold.it/32x32",
        "age": 33,
        "eyeColor": "green",
        "name": "Dalton House",
        "gender": "male",
        "company": "EYEWAX",
        "email": "daltonhouse@eyewax.com",
        "phone": "+1 (959) 550-2263",
        "address": "116 Howard Avenue, Rossmore, New York, 6302",
        "about": "Elit eu ipsum pariatur duis mollit ex quis. Amet nulla exercitation laboris minim fugiat tempor in aliqua nisi nostrud aute. Duis minim esse irure irure fugiat sit nulla et tempor nisi cillum proident id adipisicing. Eu elit magna Lorem irure labore. Aliquip id sint veniam adipisicing. Amet eiusmod mollit reprehenderit reprehenderit dolore.\r\n",
        "registered": "2017-02-28T08:53:00 +04:00",
        "latitude": -25.679774,
        "longitude": 29.374781,
        "tags": [
            "qui",
            "cillum",
            "anim",
            "irure",
            "non",
            "commodo",
            "deserunt"
        ],
        "friends": [
            {
                "id": 0,
                "name": "Carmela Wilcox"
            },
            {
                "id": 1,
                "name": "Elba Garza"
            },
            {
                "id": 2,
                "name": "Garrison Church"
            }
        ],
        "greeting": "Hello, Dalton House! You have 1 unread messages.",
        "favoriteFruit": "apple"
    },
    {
        "_id": "59f1334cd1518c3a44d69fff",
        "index": 3,
        "guid": "5109bc50-9a8e-4184-aba0-6740dc00b606",
        "isActive": true,
        "balance": "$3,891.83",
        "picture": "http://placehold.it/32x32",
        "age": 22,
        "eyeColor": "blue",
        "name": "Ray Wilkins",
        "gender": "male",
        "company": "EXPOSA",
        "email": "raywilkins@exposa.com",
        "phone": "+1 (812) 414-3258",
        "address": "837 Bedford Avenue, Harleigh, South Carolina, 2323",
        "about": "Est amet quis eu proident ipsum veniam sit. Irure labore ad consectetur ullamco sit ipsum proident. Ad pariatur irure nisi irure commodo aliquip nisi eu anim irure dolor dolor veniam quis.\r\n",
        "registered": "2015-09-17T04:52:42 +04:00",
        "latitude": 34.354801,
        "longitude": -168.303952,
        "tags": [
            "nisi",
            "laboris",
            "incididunt",
            "amet",
            "aute",
            "quis",
            "mollit"
        ],
        "friends": [
            {
                "id": 0,
                "name": "Olivia Russo"
            },
            {
                "id": 1,
                "name": "Rita Tyler"
            },
            {
                "id": 2,
                "name": "Lorie Walker"
            }
        ],
        "greeting": "Hello, Ray Wilkins! You have 1 unread messages.",
        "favoriteFruit": "strawberry"
    },
    {
        "_id": "59f1334c6901bda003e52fa6",
        "index": 4,
        "guid": "0ab33477-b152-4b12-af35-f5b9254d5c2a",
        "isActive": true,
        "balance": "$3,730.71",
        "picture": "http://placehold.it/32x32",
        "age": 27,
        "eyeColor": "brown",
        "name": "Madden Hatfield",
        "gender": "male",
        "company": "ZOGAK",
        "email": "maddenhatfield@zogak.com",
        "phone": "+1 (832) 552-2294",
        "address": "530 Clermont Avenue, Bethpage, Virgin Islands, 5607",
        "about": "Commodo tempor anim tempor deserunt laboris qui eu reprehenderit consequat. Non laborum ullamco qui proident. Est cupidatat do dolor excepteur est nostrud laborum. Eu excepteur ex commodo aliquip adipisicing excepteur. Et reprehenderit laboris reprehenderit aute ut excepteur deserunt nostrud velit. Ullamco est sit fugiat irure aliqua aliquip proident. Voluptate ad culpa dolor id enim tempor laborum.\r\n",
        "registered": "2016-04-10T03:37:17 +04:00",
        "latitude": 80.888876,
        "longitude": 117.84337,
        "tags": [
            "occaecat",
            "nisi",
            "est",
            "ad",
            "nostrud",
            "eu",
            "dolore"
        ],
        "friends": [
            {
                "id": 0,
                "name": "Vincent Gay"
            },
            {
                "id": 1,
                "name": "Rosario Forbes"
            },
            {
                "id": 2,
                "name": "Baxter Green"
            }
        ],
        "greeting": "Hello, Madden Hatfield! You have 4 unread messages.",
        "favoriteFruit": "banana"
    }
];

},{}],217:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DataTablePage = void 0;
var table_1 = require("./wml/table");
var data_1 = require("./data");
var util_1 = require("../../../../../lib/util");
var columns = [
    { name: 'index', heading: '#', sort: 'yes' },
    { name: 'name', heading: 'Name', sort: 'yes' },
    { name: 'gender', heading: 'Gender', sort: 'yes' },
    { name: 'email', heading: 'Email', sort: 'yes' },
    { name: 'balance', heading: 'Balance', sort: 'yes' },
];
var DataTablePage = /** @class */ (function () {
    function DataTablePage() {
        var _this = this;
        this.view = new table_1.Main(this);
        this.values = {
            id: 'table',
            users: data_1.users,
            columns: columns,
            onCellClicked: function (e) {
                var mDT = util_1.getById(_this.view, _this.values.id);
                if (mDT.isNothing())
                    return;
                var dt = mDT.get();
                dt.getCell(e.column, e.row).cells.forEach(function (c) {
                    c.style.backgroundColor = 'red';
                    c.style.color = '#fff';
                });
            }
        };
    }
    return DataTablePage;
}());
exports.DataTablePage = DataTablePage;
exports.default = new DataTablePage();

},{"../../../../../lib/util":143,"./data":216,"./wml/table":218}],218:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var table_1 = require("../../../../../../lib/data/table");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.node('h3', {}, [
                    __document.createTextNode('Data Table')
                ]),
                __this.widget(new table_1.DataTable({ wml: { 'id': __context.values.id }, ww: { 'sortable': true, 'onCellClicked': __context.values.onCellClicked, 'data': __context.values.users, 'columns': __context.values.columns } }, []), { wml: { 'id': __context.values.id }, ww: { 'sortable': true, 'onCellClicked': __context.values.onCellClicked, 'data': __context.values.users, 'columns': __context.values.columns } })
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/data/table":91,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],219:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PropertyListPage = void 0;
var property_list_1 = require("./wml/property-list");
var data = {
    name: 'London Beta',
    age: '37',
    balance: '5000'
};
var money = function (s) { return "$" + s; };
var dataFragment = function (c) { return new property_list_1.BoldDataView(c); };
var fields = [
    { name: 'name', heading: 'Name', dataFragment: dataFragment },
    { name: 'age', heading: 'age' },
    { name: 'balance', heading: 'Balance', format: money }
];
var PropertyListPage = /** @class */ (function () {
    function PropertyListPage() {
        this.view = new property_list_1.Main(this);
        this.data = data;
        this.fields = fields;
    }
    return PropertyListPage;
}());
exports.PropertyListPage = PropertyListPage;
exports.default = new PropertyListPage();

},{"./wml/property-list":220}],220:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = exports.BoldDataView = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var property_list_1 = require("../../../../../../lib/data/property-list");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var BoldDataView = /** @class */ (function () {
    function BoldDataView(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.node('b', {}, [
                text(__context.data)
            ]);
        };
    }
    BoldDataView.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    BoldDataView.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    BoldDataView.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    BoldDataView.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    BoldDataView.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    BoldDataView.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    BoldDataView.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    BoldDataView.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return BoldDataView;
}());
exports.BoldDataView = BoldDataView;
;
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new property_list_1.PropertyList({ ww: { 'fields': __context.fields, 'data': __context.data } }, []), { ww: { 'fields': __context.fields, 'data': __context.data } })
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/data/property-list":87,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],221:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AlertPage = void 0;
var views = require("./wml/alert");
var style_1 = require("../../../../../lib/content/style");
var AlertPage = /** @class */ (function () {
    function AlertPage() {
        this.view = new views.Main(this);
        this.values = {
            capitalize: function (s) { return "" + s[0].toUpperCase() + s.slice(1); },
            message: 'This is an alert',
            styles: [
                style_1.Style.Default,
                style_1.Style.Primary,
                style_1.Style.Success,
                style_1.Style.Info,
                style_1.Style.Warning,
                style_1.Style.Error
            ]
        };
    }
    return AlertPage;
}());
exports.AlertPage = AlertPage;
exports.default = new AlertPage();

},{"../../../../../lib/content/style":20,"./wml/alert":222}],222:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var alert_1 = require("../../../../../../lib/dialog/alert");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.node('h1', {}, [
                        __document.createTextNode('Alerts')
                    ]),
                    __this.node('p', {}, __spreadArrays([
                        __this.node('h2', {}, [
                            __document.createTextNode('Styles')
                        ])
                    ], __forIn(__context.values.styles, function (v, _$$i, _$$all) {
                        return ([
                            __this.widget(new alert_1.Alert({ ww: { 'style': v, 'closable': true, 'text': __context.values.capitalize(v) } }, []), { ww: { 'style': v, 'closable': true, 'text': __context.values.capitalize(v) } })
                        ]);
                    }, function () { return ([]); })))
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/dialog/alert":94,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],223:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConfirmPage = void 0;
var views = require("./wml/confirm");
var ConfirmPage = /** @class */ (function () {
    function ConfirmPage() {
        var _this = this;
        this.view = new views.Main(this);
        this.v = new views.Open(this);
        this.values = {
            title: 'Confirm a message',
            message: 'Would you like to confirm this message?',
            onYes: function () {
                alert('Message confirmed!');
            },
            onNo: function () {
                alert('Message rejected!');
            },
            open: function () {
                document.body.appendChild(_this.v.render());
            },
            close: function () {
                _this.v.findById('open')
                    .map(function (m) { return m.close(); });
            }
        };
    }
    return ConfirmPage;
}());
exports.ConfirmPage = ConfirmPage;
exports.default = new ConfirmPage();

},{"./wml/confirm":224}],224:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Open = exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var confirm_1 = require("../../../../../../lib/dialog/confirm");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.node('h1', {}, [
                    __document.createTextNode('Confirm')
                ]),
                __this.node('p', {}, [
                    __this.node('button', { 'onclick': __context.values.open }, [
                        __document.createTextNode('Open')
                    ])
                ])
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;
;
var Open = /** @class */ (function () {
    function Open(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new confirm_1.Confirm({ wml: { 'id': 'open' }, ww: { 'title': __context.values.title, 'onNo': __context.values.onNo, 'onYes': __context.values.onYes } }, [
                text(__context.values.message)
            ]), { wml: { 'id': 'open' }, ww: { 'title': __context.values.title, 'onNo': __context.values.onNo, 'onYes': __context.values.onYes } });
        };
    }
    Open.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Open.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Open.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Open.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Open.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Open.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Open.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Open.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Open;
}());
exports.Open = Open;

},{"../../../../../../lib/dialog/confirm":96,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],225:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.InformPage = void 0;
var views = require("./wml/inform");
var InformPage = /** @class */ (function () {
    function InformPage() {
        var _this = this;
        this.view = new views.Main(this);
        this.v = new views.Open(this);
        this.values = {
            title: 'Something happened',
            message: 'Zing! Something you happened!',
            onClose: function () {
                alert('Buh Bye');
            },
            open: function () {
                document.body.appendChild(_this.v.render());
            },
            close: function () {
                _this.v.findById('open')
                    .map(function (m) { return m.close(); });
            }
        };
    }
    return InformPage;
}());
exports.InformPage = InformPage;
exports.default = new InformPage();

},{"./wml/inform":226}],226:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Open = exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var inform_1 = require("../../../../../../lib/dialog/inform");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.node('h1', {}, [
                    __document.createTextNode('Inform')
                ]),
                __this.node('p', {}, [
                    __this.node('button', { 'onclick': __context.values.open }, [
                        __document.createTextNode('Open')
                    ])
                ])
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;
;
var Open = /** @class */ (function () {
    function Open(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new inform_1.Inform({ wml: { 'id': 'open' }, ww: { 'title': __context.values.title, 'onClose': __context.values.onClose } }, [
                text(__context.values.message)
            ]), { wml: { 'id': 'open' }, ww: { 'title': __context.values.title, 'onClose': __context.values.onClose } });
        };
    }
    Open.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Open.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Open.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Open.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Open.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Open.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Open.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Open.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Open;
}());
exports.Open = Open;

},{"../../../../../../lib/dialog/inform":98,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],227:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ModalPage = void 0;
var views = require("./wml/modal");
var ModalPage = /** @class */ (function () {
    function ModalPage() {
        var _this = this;
        this.view = new views.Main(this);
        this.v = new views.Open(this);
        this.values = {
            open: function () {
                document.body.appendChild(_this.v.render());
            },
            close: function () {
                _this.v.findById('open')
                    .map(function (m) { return m.close(); });
            }
        };
    }
    return ModalPage;
}());
exports.ModalPage = ModalPage;
exports.default = new ModalPage();

},{"./wml/modal":228}],228:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Open = exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var modal_1 = require("../../../../../../lib/dialog/modal");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.node('h1', {}, [
                    __document.createTextNode('Modals')
                ]),
                __this.node('p', {}, [
                    __this.node('button', { 'onclick': __context.values.open }, [
                        __document.createTextNode('Open')
                    ])
                ])
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;
;
var Open = /** @class */ (function () {
    function Open(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new modal_1.Modal({ wml: { 'id': 'open' } }, [
                __this.widget(new modal_1.ModalHeader({}, [
                    __document.createTextNode('Open')
                ]), {}),
                __this.widget(new modal_1.ModalBody({}, [
                    __this.node('p', {}, [
                        __document.createTextNode('Click this '),
                        __this.node('button', { 'onclick': __context.values.close }, [
                            __document.createTextNode('button')
                        ]),
                        __document.createTextNode(' to close.')
                    ])
                ]), {}),
                __this.widget(new modal_1.ModalFooter({}, [
                    __this.node('button', { 'onclick': __context.values.close }, [
                        __document.createTextNode('cancel')
                    ])
                ]), {})
            ]), { wml: { 'id': 'open' } });
        };
    }
    Open.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Open.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Open.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Open.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Open.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Open.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Open.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Open.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Open;
}());
exports.Open = Open;

},{"../../../../../../lib/dialog/modal":100,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],229:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PromptPage = void 0;
var views = require("./wml/prompt");
var PromptPage = /** @class */ (function () {
    function PromptPage() {
        var _this = this;
        this.view = new views.Main(this);
        this.v = new views.Open(this);
        this.values = {
            value: 'Click the button bellow to change this text.',
            title: 'Change the text',
            onChange: function (e) { return _this.values.value = e.value; },
            onSave: function () {
                _this.view.invalidate();
            },
            onCancel: function () {
            },
            open: function () {
                document.body.appendChild(_this.v.render());
            },
            close: function () {
                _this.v.findById('open')
                    .map(function (m) { return m.close(); });
            }
        };
    }
    return PromptPage;
}());
exports.PromptPage = PromptPage;
exports.default = new PromptPage();

},{"./wml/prompt":230}],230:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Open = exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var text_field_1 = require("../../../../../../lib/control/text-field");
;
var prompt_1 = require("../../../../../../lib/dialog/prompt");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.node('h1', {}, [
                    __document.createTextNode('Prompt')
                ]),
                __this.node('p', {}, [
                    text(__context.values.value)
                ]),
                __this.node('p', {}, [
                    __this.node('button', { 'onclick': __context.values.open }, [
                        __document.createTextNode('Open')
                    ])
                ])
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;
;
var Open = /** @class */ (function () {
    function Open(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new prompt_1.Prompt({ wml: { 'id': 'open' }, ww: { 'title': __context.values.title, 'onSave': __context.values.onSave, 'onCancel': __context.values.onCancel } }, [
                __this.widget(new text_field_1.TextField({ ww: { 'value': __context.values.value, 'onChange': __context.values.onChange } }, []), { ww: { 'value': __context.values.value, 'onChange': __context.values.onChange } })
            ]), { wml: { 'id': 'open' }, ww: { 'title': __context.values.title, 'onSave': __context.values.onSave, 'onCancel': __context.values.onCancel } });
        };
    }
    Open.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Open.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Open.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Open.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Open.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Open.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Open.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Open.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Open;
}());
exports.Open = Open;

},{"../../../../../../lib/control/text-field":79,"../../../../../../lib/dialog/prompt":102,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],231:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CalloutPage = void 0;
var views = require("./wml/callout");
var style_1 = require("../../../../../lib/content/style");
var CalloutPage = /** @class */ (function () {
    function CalloutPage() {
        this.view = new views.Main(this);
        this.values = {
            capitalize: function (s) { return "" + s[0].toUpperCase() + s.slice(1); },
            styles: [
                style_1.Style.Default,
                style_1.Style.Primary,
                style_1.Style.Success,
                style_1.Style.Info,
                style_1.Style.Warning,
                style_1.Style.Error
            ]
        };
    }
    return CalloutPage;
}());
exports.CalloutPage = CalloutPage;
exports.default = new CalloutPage();

},{"../../../../../lib/content/style":20,"./wml/callout":232}],232:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var callout_1 = require("../../../../../../lib/layout/callout");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.node('h1', {}, [
                        __document.createTextNode('Callout')
                    ]),
                    __this.node('p', {}, __spreadArrays([
                        __this.node('h2', {}, [
                            __document.createTextNode('Styles')
                        ])
                    ], __forIn(__context.values.styles, function (v, _$$i, _$$all) {
                        return ([
                            __this.widget(new callout_1.Callout({ ww: { 'style': v } }, [
                                __document.createTextNode('\u000a\u000a            This is a callout with style on display.\u000a\u000a          ')
                            ]), { ww: { 'style': v } })
                        ]);
                    }, function () { return ([]); })))
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/layout/callout":107,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],233:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DescriptionListPage = void 0;
var description_list_1 = require("./wml/description-list");
var DescriptionListPage = /** @class */ (function () {
    function DescriptionListPage() {
        this.view = new description_list_1.Main(this);
    }
    return DescriptionListPage;
}());
exports.DescriptionListPage = DescriptionListPage;
exports.default = new DescriptionListPage();

},{"./wml/description-list":234}],234:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var description_list_1 = require("../../../../../../lib/layout/description-list");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new description_list_1.DescriptionList({}, [
                        __this.widget(new description_list_1.Title({}, [
                            __document.createTextNode('Phone')
                        ]), {}),
                        __this.widget(new description_list_1.Data({}, [
                            __document.createTextNode('6385532')
                        ]), {}),
                        __this.widget(new description_list_1.Title({}, [
                            __document.createTextNode('Email')
                        ]), {}),
                        __this.widget(new description_list_1.Data({}, [
                            __document.createTextNode('hel@lo.com')
                        ]), {}),
                        __this.widget(new description_list_1.Title({}, [
                            __document.createTextNode('Website')
                        ]), {}),
                        __this.widget(new description_list_1.Data({}, [
                            __document.createTextNode('example.com')
                        ]), {})
                    ]), {})
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new description_list_1.DescriptionList({ ww: { 'horizontal': true } }, [
                        __this.widget(new description_list_1.Title({}, [
                            __document.createTextNode('Phone')
                        ]), {}),
                        __this.widget(new description_list_1.Data({}, [
                            __document.createTextNode('6385532')
                        ]), {}),
                        __this.widget(new description_list_1.Title({}, [
                            __document.createTextNode('Email')
                        ]), {}),
                        __this.widget(new description_list_1.Data({}, [
                            __document.createTextNode('hel@lo.com')
                        ]), {}),
                        __this.widget(new description_list_1.Title({}, [
                            __document.createTextNode('Website')
                        ]), {}),
                        __this.widget(new description_list_1.Data({}, [
                            __document.createTextNode('example.com')
                        ]), {})
                    ]), { ww: { 'horizontal': true } })
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/layout/description-list":109,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],235:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.GridLayoutPage = void 0;
var views = require("./wml/grid");
var GridLayoutPage = /** @class */ (function () {
    function GridLayoutPage() {
        this.view = new views.Main(this);
        this.values = {
            root: {
                className: 'grid-layout-example'
            }
        };
    }
    return GridLayoutPage;
}());
exports.GridLayoutPage = GridLayoutPage;
exports.default = new GridLayoutPage();

},{"./wml/grid":236}],236:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var grid_1 = require("../../../../../../lib/layout/grid");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new grid_1.GridLayout({ ww: { 'className': __context.values.root.className } }, [
                __this.widget(new grid_1.Row({}, [
                    __this.widget(new grid_1.Column({ ww: { 'span': 1 } }, [
                        __document.createTextNode('Span 1')
                    ]), { ww: { 'span': 1 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 1 } }, [
                        __document.createTextNode('Span 1')
                    ]), { ww: { 'span': 1 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 1 } }, [
                        __document.createTextNode('Span 1')
                    ]), { ww: { 'span': 1 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 1 } }, [
                        __document.createTextNode('Span 1')
                    ]), { ww: { 'span': 1 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 1 } }, [
                        __document.createTextNode('Span 1')
                    ]), { ww: { 'span': 1 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 1 } }, [
                        __document.createTextNode('Span 1')
                    ]), { ww: { 'span': 1 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 1 } }, [
                        __document.createTextNode('Span 1')
                    ]), { ww: { 'span': 1 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 1 } }, [
                        __document.createTextNode('Span 1')
                    ]), { ww: { 'span': 1 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 1 } }, [
                        __document.createTextNode('Span 1')
                    ]), { ww: { 'span': 1 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 1 } }, [
                        __document.createTextNode('Span 1')
                    ]), { ww: { 'span': 1 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 1 } }, [
                        __document.createTextNode('Span 1')
                    ]), { ww: { 'span': 1 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 1 } }, [
                        __document.createTextNode('Span 1')
                    ]), { ww: { 'span': 1 } })
                ]), {}),
                __this.widget(new grid_1.Row({}, [
                    __this.widget(new grid_1.Column({ ww: { 'span': 8 } }, [
                        __document.createTextNode('Span 8')
                    ]), { ww: { 'span': 8 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 4 } }, [
                        __document.createTextNode('Span 4')
                    ]), { ww: { 'span': 4 } })
                ]), {}),
                __this.widget(new grid_1.Row({}, [
                    __this.widget(new grid_1.Column({ ww: { 'span': 4 } }, [
                        __document.createTextNode('Span 4')
                    ]), { ww: { 'span': 4 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 4 } }, [
                        __document.createTextNode('Span 4')
                    ]), { ww: { 'span': 4 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 4 } }, [
                        __document.createTextNode('Span 4')
                    ]), { ww: { 'span': 4 } })
                ]), {}),
                __this.widget(new grid_1.Row({}, [
                    __this.widget(new grid_1.Column({ ww: { 'span': 6 } }, [
                        __document.createTextNode('Span 6')
                    ]), { ww: { 'span': 6 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 6 } }, [
                        __document.createTextNode('Span 6')
                    ]), { ww: { 'span': 6 } })
                ]), {}),
                __this.widget(new grid_1.Row({}, [
                    __this.widget(new grid_1.Column({ ww: { 'span': 6 } }, [
                        __document.createTextNode('Span 6')
                    ]), { ww: { 'span': 6 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 6 } }, [
                        __document.createTextNode('Span 6')
                    ]), { ww: { 'span': 6 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 6 } }, [
                        __document.createTextNode('Span 6')
                    ]), { ww: { 'span': 6 } }),
                    __this.widget(new grid_1.Column({ ww: { 'span': 6 } }, [
                        __document.createTextNode('Span 6')
                    ]), { ww: { 'span': 6 } })
                ]), {}),
                __this.widget(new grid_1.Row({}, [
                    __this.widget(new grid_1.Column({ ww: { 'span': 12 } }, [
                        __document.createTextNode('Span 12')
                    ]), { ww: { 'span': 12 } })
                ]), {})
            ]), { ww: { 'className': __context.values.root.className } });
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/layout/grid":113,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],237:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.HorizontalLayoutPage = void 0;
var views = require("./wml/horizontal");
var HorizontalLayoutPage = /** @class */ (function () {
    function HorizontalLayoutPage() {
        this.view = new views.Main(this);
    }
    return HorizontalLayoutPage;
}());
exports.HorizontalLayoutPage = HorizontalLayoutPage;
exports.default = new HorizontalLayoutPage();

},{"./wml/horizontal":238}],238:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var horizontal_1 = require("../../../../../../lib/layout/horizontal");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new horizontal_1.HorizontalLayout({}, [
                        __this.node('textarea', {}, [
                            __document.createTextNode('Area 1')
                        ]),
                        __this.node('textarea', {}, [
                            __document.createTextNode('Area 2')
                        ]),
                        __this.node('textarea', {}, [
                            __document.createTextNode('Area 3')
                        ])
                    ]), {})
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new horizontal_1.HorizontalLayout({ ww: { 'orientation': horizontal_1.HorizontalLayoutOrientation.Left } }, [
                        __document.createTextNode('\u000a      This is oriented to the left.\u000a    ')
                    ]), { ww: { 'orientation': horizontal_1.HorizontalLayoutOrientation.Left } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new horizontal_1.HorizontalLayout({ ww: { 'orientation': horizontal_1.HorizontalLayoutOrientation.Right } }, [
                        __document.createTextNode('\u000a      This is oriented to the right.\u000a    ')
                    ]), { ww: { 'orientation': horizontal_1.HorizontalLayoutOrientation.Right } })
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/layout/horizontal":115,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],239:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ListLayoutPage = void 0;
var list_1 = require("./wml/list");
var ListLayoutPage = /** @class */ (function () {
    function ListLayoutPage() {
        var _this = this;
        this.view = new list_1.Main(this);
        this.items = {
            'This is the first item.': false,
            'This is the second item.': true,
            'This is the third item.': false
        };
        this.click = function (key) {
            return _this
                .view
                .findById(key)
                .map(function (l) { return l.toggleActive(); })
                .orJust(function () { return alert("Cannot find element by id \"" + key + "\"!"); });
        };
    }
    return ListLayoutPage;
}());
exports.ListLayoutPage = ListLayoutPage;
exports.default = new ListLayoutPage();

},{"./wml/list":240}],240:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var list_1 = require("../../../../../../lib/layout/list");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new list_1.ListLayout({}, __spreadArrays(__forOf(__context.items, function (yes, key, _$$all) {
                    return ([
                        __this.widget(new list_1.ListLayoutItem({ wml: { 'id': key }, ww: { 'name': key, 'active': yes, 'onClick': __context.click } }, [
                            __this.node('p', {}, [
                                document.createTextNode(key)
                            ])
                        ]), { wml: { 'id': key }, ww: { 'name': key, 'active': yes, 'onClick': __context.click } })
                    ]);
                }, function () { return ([]); }))), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/layout/list":118,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],241:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MeterPage = void 0;
var views = require("./wml/meter");
var MeterPage = /** @class */ (function () {
    function MeterPage() {
        var _this = this;
        this.view = new views.Main(this);
        this.values = {
            message: 'This is an alert',
            bars: [
                { value: 10, color: 'red' },
                { value: 50, color: 'green' },
                { value: 40, color: 'blue' }
            ],
            inc: function () {
                var m = _this.view.findById('single');
                if (m.isJust())
                    m.get().increase(10);
            },
            dec: function () {
                var m = _this.view.findById('single');
                if (m.isJust())
                    m.get().decrease(10);
            }
        };
    }
    return MeterPage;
}());
exports.MeterPage = MeterPage;
exports.default = new MeterPage();

},{"./wml/meter":242}],242:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var meter_1 = require("../../../../../../lib/layout/meter");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.node('h1', {}, [
                    __document.createTextNode('Meter')
                ]),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('h2', {}, [
                        __document.createTextNode('Single')
                    ]),
                    __this.node('p', {}, [
                        __this.node('button', { 'onclick': __context.values.dec }, [
                            __document.createTextNode('-')
                        ]),
                        __this.node('button', { 'onclick': __context.values.inc }, [
                            __document.createTextNode('+')
                        ])
                    ]),
                    __this.widget(new meter_1.Meter({}, [
                        __this.widget(new meter_1.MeterBar({ wml: { 'id': 'single' }, ww: { 'value': 75, 'color': 'yellow' } }, []), { wml: { 'id': 'single' }, ww: { 'value': 75, 'color': 'yellow' } })
                    ]), {})
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('p', {}, [
                        __this.node('h2', {}, [
                            __document.createTextNode('Combined')
                        ]),
                        __this.widget(new meter_1.Meter({}, __spreadArrays(__forIn(__context.values.bars, function (v, _$$i, _$$all) {
                            return ([
                                __this.widget(new meter_1.MeterBar({ ww: { 'value': v.value, 'color': v.color } }, []), { ww: { 'value': v.value, 'color': v.color } })
                            ]);
                        }, function () { return ([]); }))), {})
                    ])
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/layout/meter":122,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],243:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PanelPage = void 0;
var panel_1 = require("./wml/panel");
var PanelPage = /** @class */ (function () {
    function PanelPage() {
        this.view = new panel_1.Main(this);
    }
    return PanelPage;
}());
exports.PanelPage = PanelPage;
exports.default = new PanelPage();

},{"./wml/panel":244}],244:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var grid_1 = require("../../../../../../lib/layout/grid");
;
var panel_1 = require("../../../../../../lib/layout/panel");
;
var style_1 = require("../../../../../../lib/content/style");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new grid_1.GridLayout({}, __spreadArrays(__forIn(style_1.styles, function (style, _$$i, _$$all) {
                return ([
                    __this.widget(new grid_1.Row({}, [
                        __this.widget(new grid_1.Column({ ww: { 'span': 4 } }, [
                            __this.widget(new panel_1.Panel({ ww: { 'style': style } }, [
                                __this.widget(new panel_1.PanelBody({}, [
                                    __document.createTextNode('\u000a            PanelBody only.\u000a          ')
                                ]), {})
                            ]), { ww: { 'style': style } })
                        ]), { ww: { 'span': 4 } }),
                        __this.widget(new grid_1.Column({ ww: { 'span': 4 } }, [
                            __this.widget(new panel_1.Panel({ ww: { 'style': style } }, [
                                __this.widget(new panel_1.PanelHeader({}, [
                                    __document.createTextNode('\u000a            With PanelHeader\u000a          ')
                                ]), {}),
                                __this.widget(new panel_1.PanelBody({}, [
                                    __document.createTextNode('\u000a            Lorem impsum dilium net set.\u000a          ')
                                ]), {})
                            ]), { ww: { 'style': style } })
                        ]), { ww: { 'span': 4 } }),
                        __this.widget(new grid_1.Column({ ww: { 'span': 4 } }, [
                            __this.widget(new panel_1.Panel({ ww: { 'style': style } }, [
                                __this.widget(new panel_1.PanelHeader({}, [
                                    __document.createTextNode('With PanelFooter')
                                ]), {}),
                                __this.widget(new panel_1.PanelBody({}, [
                                    __document.createTextNode('Lorem impsum dilium net set.')
                                ]), {}),
                                __this.widget(new panel_1.PanelFooter({}, [
                                    __document.createTextNode('Meh foot.')
                                ]), {})
                            ]), { ww: { 'style': style } })
                        ]), { ww: { 'span': 4 } })
                    ]), {})
                ]);
            }, function () { return ([]); }))), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/content/style":20,"../../../../../../lib/layout/grid":113,"../../../../../../lib/layout/panel":124,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],245:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TabLayoutPage = void 0;
var views = require("./wml/tab");
var TabLayoutPage = /** @class */ (function () {
    function TabLayoutPage() {
        this.view = new views.Main(this);
        this.tabs = {
            first: {
                text: 'First',
                contentFun: views.firstTab
            },
            second: {
                text: 'Second',
                contentFun: views.secondTab
            },
            third: {
                text: 'Third',
                contentFun: views.thirdTab
            }
        };
    }
    return TabLayoutPage;
}());
exports.TabLayoutPage = TabLayoutPage;
exports.default = new TabLayoutPage();

},{"./wml/tab":246}],246:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = exports.thirdTab = exports.secondTab = exports.firstTab = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var tab_1 = require("../../../../../../lib/layout/tab");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
exports.firstTab = function (_) { return function (__this) {
    return [
        __this.node('p', {}, [
            __document.createTextNode('Click a tab to change content.')
        ])
    ];
}; };
;
exports.secondTab = function (_) { return function (__this) {
    return [
        __this.node('p', {}, [
            __document.createTextNode('Second tab.')
        ])
    ];
}; };
;
exports.thirdTab = function (_) { return function (__this) {
    return [
        __this.node('p', {}, [
            __document.createTextNode('Third tab.')
        ])
    ];
}; };
;
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new tab_1.TabLayout({ ww: { 'tabs': __context.tabs, 'active': 'first' } }, [
                    __this.node('p', {}, [
                        __document.createTextNode('Click a tab to change content.')
                    ])
                ]), { ww: { 'tabs': __context.tabs, 'active': 'first' } })
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/layout/tab":126,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],247:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TableLayoutPage = void 0;
var table_1 = require("./wml/table");
var TableLayoutPage = /** @class */ (function () {
    function TableLayoutPage() {
        this.view = new table_1.Main(this);
    }
    return TableLayoutPage;
}());
exports.TableLayoutPage = TableLayoutPage;
exports.default = new TableLayoutPage();

},{"./wml/table":248}],248:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = exports.content = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var table_1 = require("../../../../../../lib/layout/table");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
exports.content = function () { return function (__this) {
    return [
        __this.widget(new table_1.TableHeader({}, [
            __this.widget(new table_1.TableRow({}, [
                __this.widget(new table_1.TableHeading({}, [
                    __document.createTextNode('Name')
                ]), {}),
                __this.widget(new table_1.TableHeading({}, [
                    __document.createTextNode('Email')
                ]), {}),
                __this.widget(new table_1.TableHeading({}, [
                    __document.createTextNode('Balance')
                ]), {}),
                __this.widget(new table_1.TableHeading({}, [
                    __document.createTextNode('Username')
                ]), {}),
                __this.widget(new table_1.TableHeading({}, [
                    __document.createTextNode('Status')
                ]), {})
            ]), {})
        ]), {}),
        __this.widget(new table_1.TableBody({}, [
            __this.widget(new table_1.TableRow({}, [
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('Length Wise')
                ]), {}),
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('lw@theemailplace.com')
                ]), {}),
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('$5000')
                ]), {}),
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('lw')
                ]), {}),
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('Active')
                ]), {})
            ]), {}),
            __this.widget(new table_1.TableRow({}, [
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('First Chance')
                ]), {}),
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('fchacne@live.tt')
                ]), {}),
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('$1.00')
                ]), {}),
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('chance')
                ]), {}),
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('Inactive')
                ]), {})
            ]), {}),
            __this.widget(new table_1.TableRow({}, [
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('Du Pear')
                ]), {}),
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('dupear@gmail.com')
                ]), {}),
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('$10,000.00')
                ]), {}),
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('pearboy')
                ]), {}),
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('Active')
                ]), {})
            ]), {}),
            __this.widget(new table_1.TableRow({}, [
                __this.widget(new table_1.TableCell({ ww: { 'rowspan': 2, 'colspan': 5 } }, [
                    __document.createTextNode('This spans 2 rows 5 columns.')
                ]), { ww: { 'rowspan': 2, 'colspan': 5 } })
            ]), {})
        ]), {}),
        __this.widget(new table_1.TableFooter({}, [
            __this.widget(new table_1.TableRow({}, [
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('1')
                ]), {}),
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('2')
                ]), {}),
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('3')
                ]), {}),
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('4')
                ]), {}),
                __this.widget(new table_1.TableCell({}, [
                    __document.createTextNode('5')
                ]), {})
            ]), {})
        ]), {})
    ];
}; };
;
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.node('h3', {}, [
                        __document.createTextNode('Normal')
                    ]),
                    __this.widget(new table_1.TableLayout({}, __spreadArrays((exports.content()(__this)))), {})
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('h3', {}, [
                        __document.createTextNode(' Alternate')
                    ]),
                    __this.widget(new table_1.TableLayout({ ww: { 'alternate': true } }, __spreadArrays((exports.content()(__this)))), { ww: { 'alternate': true } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('h3', {}, [
                        __document.createTextNode('Bordered')
                    ]),
                    __this.widget(new table_1.TableLayout({ ww: { 'bordered': true } }, __spreadArrays((exports.content()(__this)))), { ww: { 'bordered': true } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('h3', {}, [
                        __document.createTextNode('Hoverable')
                    ]),
                    __this.widget(new table_1.TableLayout({ ww: { 'hoverable': true } }, __spreadArrays((exports.content()(__this)))), { ww: { 'hoverable': true } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('h3', {}, [
                        __document.createTextNode('Compact')
                    ]),
                    __this.widget(new table_1.TableLayout({ ww: { 'compact': true } }, __spreadArrays((exports.content()(__this)))), { ww: { 'compact': true } })
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.widget(new table_1.TableWindow({}, [
                        __this.widget(new table_1.TableLayout({}, __spreadArrays((exports.content()(__this)))), {})
                    ]), {})
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/layout/table":128,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],249:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.WellPage = void 0;
var views = require("./wml/well");
var WellPage = /** @class */ (function () {
    function WellPage() {
        this.view = new views.Main(this);
        this.values = {};
    }
    return WellPage;
}());
exports.WellPage = WellPage;
exports.default = new WellPage();

},{"./wml/well":250}],250:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var well_1 = require("../../../../../../lib/layout/well");
;
var demo_1 = require("../../../widgets/demo");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.node('h1', {}, [
                        __document.createTextNode('Well')
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new well_1.Well({}, [
                            __document.createTextNode('This is in a well.')
                        ]), {})
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new well_1.Well({ ww: { 'className': '-small' } }, [
                            __document.createTextNode('This is a small well.')
                        ]), { ww: { 'className': '-small' } })
                    ]),
                    __this.node('p', {}, [
                        __this.widget(new well_1.Well({ ww: { 'className': '-large' } }, [
                            __document.createTextNode('This is a small well.')
                        ]), { ww: { 'className': '-large' } })
                    ])
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/layout/well":130,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],251:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MenuPage = void 0;
var menu_1 = require("./wml/menu");
var MenuPage = /** @class */ (function () {
    function MenuPage() {
        this.view = new menu_1.Main(this);
    }
    return MenuPage;
}());
exports.MenuPage = MenuPage;
exports.default = new MenuPage();

},{"./wml/menu":252}],252:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var menu_1 = require("../../../../../../lib/menu/menu");
;
var item_1 = require("../../../../../../lib/menu/item");
;
var link_1 = require("../../../../../../lib/content/link");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new menu_1.Menu({}, [
                    __this.widget(new item_1.Item({}, [
                        __this.node('h6', {}, [
                            __document.createTextNode('Menu')
                        ])
                    ]), {}),
                    __this.widget(new item_1.Item({}, [
                        __this.widget(new link_1.Link({ ww: { 'disabled': true, 'text': 'Back' } }, []), { ww: { 'disabled': true, 'text': 'Back' } })
                    ]), {}),
                    __this.widget(new item_1.Item({}, [
                        __this.widget(new link_1.Link({ ww: { 'disabled': true, 'text': 'Refresh' } }, []), { ww: { 'disabled': true, 'text': 'Refresh' } })
                    ]), {}),
                    __this.widget(new item_1.Item({ ww: { 'divider': true } }, []), { ww: { 'divider': true } }),
                    __this.widget(new item_1.Item({}, [
                        __this.node('a', { 'href': '#/menu' }, [
                            __document.createTextNode('Quit')
                        ])
                    ]), {})
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/content/link":7,"../../../../../../lib/menu/item":136,"../../../../../../lib/menu/menu":138,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],253:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.NavPage = void 0;
var nav_1 = require("./wml/nav");
var NavPage = /** @class */ (function () {
    function NavPage() {
        this.view = new nav_1.Main(this);
    }
    return NavPage;
}());
exports.NavPage = NavPage;
exports.default = new NavPage();

},{"./wml/nav":254}],254:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var demo_1 = require("../../../widgets/demo");
;
var nav_1 = require("../../../../../../lib/menu/nav");
;
var item_1 = require("../../../../../../lib/menu/item");
;
var link_1 = require("../../../../../../lib/content/link");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new demo_1.Demo({}, [
                __this.widget(new demo_1.Demo({}, [
                    __this.node('h3', {}, [
                        __document.createTextNode('This is a horizontal nav.')
                    ]),
                    __this.widget(new nav_1.Nav({}, [
                        __this.widget(new item_1.Item({}, [
                            __this.widget(new link_1.Link({ ww: { 'text': 'Home' } }, []), { ww: { 'text': 'Home' } })
                        ]), {}),
                        __this.widget(new item_1.Item({}, [
                            __this.widget(new link_1.Link({ ww: { 'disabled': true, 'text': 'Users' } }, []), { ww: { 'disabled': true, 'text': 'Users' } })
                        ]), {}),
                        __this.widget(new item_1.Item({}, [
                            __this.widget(new link_1.Link({ ww: { 'text': 'Logout' } }, []), { ww: { 'text': 'Logout' } })
                        ]), {})
                    ]), {})
                ]), {}),
                __this.widget(new demo_1.Demo({}, [
                    __this.node('h3', {}, [
                        __document.createTextNode('This is a vertical nav.')
                    ]),
                    __this.widget(new nav_1.Nav({ ww: { 'vertical': true } }, [
                        __this.widget(new item_1.Item({}, [
                            __this.widget(new link_1.Link({ ww: { 'text': 'Home' } }, []), { ww: { 'text': 'Home' } })
                        ]), {}),
                        __this.widget(new item_1.Item({}, [
                            __this.widget(new link_1.Link({ ww: { 'disabled': true, 'text': 'Users' } }, []), { ww: { 'disabled': true, 'text': 'Users' } })
                        ]), {}),
                        __this.widget(new item_1.Item({}, [
                            __this.widget(new link_1.Link({ ww: { 'text': 'Logout' } }, []), { ww: { 'text': 'Logout' } })
                        ]), {})
                    ]), { ww: { 'vertical': true } })
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/content/link":7,"../../../../../../lib/menu/item":136,"../../../../../../lib/menu/nav":141,"../../../widgets/demo":256,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],255:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.pages = void 0;
exports.pages = {
    'content_embed': require('./page/content_embed').default,
    'content_media-description': require('./page/content_media-description').default,
    'content_overlay': require('./page/content_overlay').default,
    'content_tag': require('./page/content_tag').default,
    'content_thumbnail': require('./page/content_thumbnail').default,
    'control_button': require('./page/control_button').default,
    'control_button-group': require('./page/control_button-group').default,
    'control_button-select': require('./page/control_button-select').default,
    'control_checkbox': require('./page/control_checkbox').default,
    'control_date-field': require('./page/control_date-field').default,
    'control_display-field': require('./page/control_display-field').default,
    'control_drop-down': require('./page/control_drop-down').default,
    'control_drop-list': require('./page/control_drop-list').default,
    'control_drop-list-field': require('./page/control_drop-list-field').default,
    'control_file-upload-surface': require('./page/control_file-upload-surface').default,
    'control_input-group': require('./page/control_input-group').default,
    'control_multi-select': require('./page/control_multi-select').default,
    'control_paginator': require('./page/control_paginator').default,
    'control_search': require('./page/control_search').default,
    'control_select': require('./page/control_select').default,
    'control_stack': require('./page/control_stack').default,
    'control_stack-select': require('./page/control_stack-select').default,
    'control_switch': require('./page/control_switch').default,
    'control_tab-bar': require('./page/control_tab-bar').default,
    'control_tag-control': require('./page/control_tag-control').default,
    'control_text-field': require('./page/control_text-field').default,
    'control_text-input': require('./page/control_text-input').default,
    'control_toolbar': require('./page/control_toolbar').default,
    'control_typeahead': require('./page/control_typeahead').default,
    'data_data-table': require('./page/data_data-table').default,
    'data_property-list': require('./page/data_property-list').default,
    'dialog_alert': require('./page/dialog_alert').default,
    'dialog_confirm': require('./page/dialog_confirm').default,
    'dialog_inform': require('./page/dialog_inform').default,
    'dialog_modal': require('./page/dialog_modal').default,
    'dialog_prompt': require('./page/dialog_prompt').default,
    'layout_callout': require('./page/layout_callout').default,
    'layout_description-list': require('./page/layout_description-list').default,
    'layout_grid': require('./page/layout_grid').default,
    'layout_horizontal': require('./page/layout_horizontal').default,
    'layout_list': require('./page/layout_list').default,
    'layout_meter': require('./page/layout_meter').default,
    'layout_panel': require('./page/layout_panel').default,
    'layout_tab': require('./page/layout_tab').default,
    'layout_table': require('./page/layout_table').default,
    'layout_well': require('./page/layout_well').default,
    'menu_menu': require('./page/menu_menu').default,
    'menu_nav': require('./page/menu_nav').default,
};

},{"./page/content_embed":158,"./page/content_media-description":160,"./page/content_overlay":162,"./page/content_tag":164,"./page/content_thumbnail":166,"./page/control_button":172,"./page/control_button-group":168,"./page/control_button-select":170,"./page/control_checkbox":174,"./page/control_date-field":176,"./page/control_display-field":178,"./page/control_drop-down":180,"./page/control_drop-list":184,"./page/control_drop-list-field":182,"./page/control_file-upload-surface":186,"./page/control_input-group":188,"./page/control_multi-select":190,"./page/control_paginator":192,"./page/control_search":194,"./page/control_select":196,"./page/control_stack":200,"./page/control_stack-select":198,"./page/control_switch":202,"./page/control_tab-bar":204,"./page/control_tag-control":206,"./page/control_text-field":208,"./page/control_text-input":210,"./page/control_toolbar":212,"./page/control_typeahead":214,"./page/data_data-table":217,"./page/data_property-list":219,"./page/dialog_alert":221,"./page/dialog_confirm":223,"./page/dialog_inform":225,"./page/dialog_modal":227,"./page/dialog_prompt":229,"./page/layout_callout":231,"./page/layout_description-list":233,"./page/layout_grid":235,"./page/layout_horizontal":237,"./page/layout_list":239,"./page/layout_meter":241,"./page/layout_panel":243,"./page/layout_tab":245,"./page/layout_table":247,"./page/layout_well":249,"./page/menu_menu":251,"./page/menu_nav":253}],256:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.Demo = void 0;
var wml = require("@quenk/wml");
var views = require("./wml/demo");
var Demo = /** @class */ (function (_super) {
    __extends(Demo, _super);
    function Demo() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.view = new views.Main(_this);
        _this.values = {
            size: _this.attrs.size,
            offset: _this.attrs.offset
        };
        return _this;
    }
    return Demo;
}(wml.Component));
exports.Demo = Demo;

},{"./wml/demo":257,"@quenk/wml":153}],257:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var grid_1 = require("../../../../../../lib/layout/grid");
;
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new grid_1.GridLayout({}, [
                __this.widget(new grid_1.Row({}, [
                    __this.widget(new grid_1.Column({ ww: { 'span': __context.values.size } }, __spreadArrays((__context.children))), { ww: { 'span': __context.values.size } })
                ]), {})
            ]), {});
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../../../lib/layout/grid":113,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],258:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Main = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
var drawer_1 = require("../../../../lib/layout/drawer");
;
var action_bar_1 = require("../../../../lib/layout/action-bar");
;
;
var link_1 = require("../../../../lib/content/link");
;
var menu_icon_1 = require("../../../../lib/content/menu-icon");
;
var main_1 = require("../../../../lib/layout/main");
;
var navigation_1 = require("./navigation");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Main = /** @class */ (function () {
    function Main(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new drawer_1.DrawerLayout({ wml: { 'id': __context.values.id.layout }, ww: { 'drawerContent': [
                        __this.registerView((new navigation_1.Navigation(__context))).render()
                    ] } }, [
                __this.widget(new action_bar_1.ActionBar({}, [
                    __this.widget(new link_1.Link({ ww: { 'onClick': __context.toggleDrawer } }, [
                        __this.widget(new menu_icon_1.MenuIcon({}, []), {})
                    ]), { ww: { 'onClick': __context.toggleDrawer } })
                ]), {}),
                __this.widget(new main_1.MainLayout({}, __spreadArrays((__context.content))), {})
            ]), { wml: { 'id': __context.values.id.layout }, ww: { 'drawerContent': [
                        __this.registerView((new navigation_1.Navigation(__context))).render()
                    ] } });
        };
    }
    Main.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Main.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Main.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Main.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Main.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Main.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Main.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Main.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Main;
}());
exports.Main = Main;

},{"../../../../lib/content/link":7,"../../../../lib/content/menu-icon":11,"../../../../lib/layout/action-bar":105,"../../../../lib/layout/drawer":111,"../../../../lib/layout/main":120,"./navigation":259,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}],259:[function(require,module,exports){
"use strict";
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Navigation = void 0;
var __document = require("@quenk/wml/lib/dom");
//@ts-ignore: 6192
var maybe_1 = require("@quenk/noni/lib/data/maybe");
;
var nav_1 = require("../../../../lib/menu/nav");
;
var item_1 = require("../../../../lib/menu/item");
;
var header_1 = require("../../../../lib/menu/header");
;
var link_1 = require("../../../../lib/content/link");
//@ts-ignore:6192
var __if = function (__expr, __conseq, __alt) {
    return (__expr) ? __conseq() : __alt ? __alt() : [];
};
//@ts-ignore:6192
var __forIn = function (list, f, alt) {
    var ret = [];
    for (var i = 0; i < list.length; i++)
        ret = ret.concat(f(list[i], i, list));
    return ret.length === 0 ? alt() : ret;
};
//@ts-ignore:6192
var __forOf = function (o, f, alt) {
    var ret = [];
    for (var key in o)
        if (o.hasOwnProperty(key))
            ret = ret.concat(f((o)[key], key, o));
    return ret.length === 0 ? alt() : ret;
};
// @ts-ignore 6192
var text = __document.text;
// @ts-ignore 6192
var unsafe = __document.unsafe;
// @ts-ignore 6192
var isSet = function (value) { return value != null; };
var Navigation = /** @class */ (function () {
    function Navigation(__context) {
        this.ids = {};
        this.groups = {};
        this.views = [];
        this.widgets = [];
        this.tree = __document.createElement('div');
        this.template = function (__this) {
            return __this.widget(new nav_1.Nav({ ww: { 'vertical': true } }, __spreadArrays([
                __this.widget(new item_1.Item({}, [
                    __this.widget(new link_1.Link({ wml: { 'group': 'links' }, ww: { 'active': (__context.page === 'home'), 'name': 'home', 'href': '#', 'onClick': __context.navigate, 'text': 'Home' } }, []), { wml: { 'group': 'links' }, ww: { 'active': (__context.page === 'home'), 'name': 'home', 'href': '#', 'onClick': __context.navigate, 'text': 'Home' } })
                ]), {})
            ], __forOf(__context.pages, function (items, section, _$$all) {
                return ([
                    __this.widget(new item_1.Item({}, [
                        __this.widget(new header_1.MenuHeader({ ww: { 'text': section } }, []), { ww: { 'text': section } }),
                        __this.widget(new nav_1.Nav({ ww: { 'vertical': true } }, __spreadArrays(__forOf(items, function (_, name, _$$all) {
                            return ([
                                __this.widget(new item_1.Item({}, [
                                    __this.widget(new link_1.Link({ wml: { 'group': 'links' }, ww: { 'name': name, 'href': ('#/' + name), 'onClick': __context.navigate, 'active': (__context.page === name), 'text': name } }, []), { wml: { 'group': 'links' }, ww: { 'name': name, 'href': ('#/' + name), 'onClick': __context.navigate, 'active': (__context.page === name), 'text': name } })
                                ]), {})
                            ]);
                        }, function () { return ([]); }))), { ww: { 'vertical': true } })
                    ]), {})
                ]);
            }, function () { return ([]); }))), { ww: { 'vertical': true } });
        };
    }
    Navigation.prototype.registerView = function (v) {
        this.views.push(v);
        return v;
    };
    Navigation.prototype.register = function (e, attrs) {
        var attrsMap = attrs;
        if (attrsMap.wml) {
            var _a = attrsMap.wml, id = _a.id, group = _a.group;
            if (id != null) {
                if (this.ids.hasOwnProperty(id))
                    throw new Error("Duplicate id '" + id + "' detected!");
                this.ids[id] = e;
            }
            if (group != null) {
                this.groups[group] = this.groups[group] || [];
                this.groups[group].push(e);
            }
        }
        return e;
    };
    Navigation.prototype.node = function (tag, attrs, children) {
        var e = __document.createElement(tag);
        Object.keys(attrs).forEach(function (key) {
            var value = attrs[key];
            if (typeof value === 'function') {
                e[key] = value;
            }
            else if (typeof value === 'string') {
                //prevent setting things like disabled=''
                if (value !== '')
                    e.setAttribute(key, value);
            }
            else if (typeof value === 'boolean') {
                e.setAttribute(key, '');
            }
            else if (!__document.isBrowser &&
                value instanceof __document.WMLDOMText) {
                e.setAttribute(key, value);
            }
        });
        children.forEach(function (c) {
            switch (typeof c) {
                case 'string':
                case 'number':
                case 'boolean':
                    var tn = __document.createTextNode('' + c);
                    e.appendChild(tn);
                case 'object':
                    e.appendChild(c);
                    break;
                default:
                    throw new TypeError("Can not adopt child " + c + " of type " + typeof c);
            }
        });
        this.register(e, attrs);
        return e;
    };
    Navigation.prototype.widget = function (w, attrs) {
        this.register(w, attrs);
        this.widgets.push(w);
        return w.render();
    };
    Navigation.prototype.findById = function (id) {
        var mW = maybe_1.fromNullable(this.ids[id]);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findById(id);
        }, mW);
    };
    Navigation.prototype.findByGroup = function (name) {
        var mGroup = maybe_1.fromArray(this.groups.hasOwnProperty(name) ?
            this.groups[name] :
            []);
        return this.views.reduce(function (p, c) {
            return p.isJust() ? p : c.findByGroup(name);
        }, mGroup);
    };
    Navigation.prototype.invalidate = function () {
        var tree = this.tree;
        var parent = tree.parentNode;
        if (tree == null)
            return console.warn('invalidate(): ' + 'Missing DOM tree!');
        if (tree.parentNode == null)
            throw new Error('invalidate(): cannot invalidate this view, it has no parent node!');
        parent.replaceChild(this.render(), tree);
    };
    Navigation.prototype.render = function () {
        this.ids = {};
        this.widgets.forEach(function (w) { return w.removed(); });
        this.widgets = [];
        this.views = [];
        this.tree = this.template(this);
        this.ids['root'] = (this.ids['root']) ?
            this.ids['root'] :
            this.tree;
        this.widgets.forEach(function (w) { return w.rendered(); });
        return this.tree;
    };
    return Navigation;
}());
exports.Navigation = Navigation;

},{"../../../../lib/content/link":7,"../../../../lib/menu/header":134,"../../../../lib/menu/item":136,"../../../../lib/menu/nav":141,"@quenk/noni/lib/data/maybe":147,"@quenk/wml/lib/dom":152}]},{},[156])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJsaWIvY29udGVudC9jYXJldC9pbmRleC5qcyIsImxpYi9jb250ZW50L2NhcmV0L3dtbC9jYXJldC5qcyIsImxpYi9jb250ZW50L2Nsb3NlL2luZGV4LmpzIiwibGliL2NvbnRlbnQvY2xvc2Uvd21sL2Nsb3NlLmpzIiwibGliL2NvbnRlbnQvZW1iZWQvaW5kZXguanMiLCJsaWIvY29udGVudC9lbWJlZC93bWwvZW1iZWQuanMiLCJsaWIvY29udGVudC9saW5rL2luZGV4LmpzIiwibGliL2NvbnRlbnQvbGluay93bWwvbGluay5qcyIsImxpYi9jb250ZW50L21lZGlhLWRlc2NyaXB0aW9uL2luZGV4LmpzIiwibGliL2NvbnRlbnQvbWVkaWEtZGVzY3JpcHRpb24vd21sL21lZGlhLWRlc2NyaXB0aW9uLmpzIiwibGliL2NvbnRlbnQvbWVudS1pY29uL2luZGV4LmpzIiwibGliL2NvbnRlbnQvbWVudS1pY29uL3dtbC9tZW51LWljb24uanMiLCJsaWIvY29udGVudC9vcmllbnRhdGlvbi5qcyIsImxpYi9jb250ZW50L292ZXJsYXkvaW5kZXguanMiLCJsaWIvY29udGVudC9vdmVybGF5L3dtbC9vdmVybGF5LmpzIiwibGliL2NvbnRlbnQvc2l6ZS5qcyIsImxpYi9jb250ZW50L3N0YXRlL2FjdGl2ZS5qcyIsImxpYi9jb250ZW50L3N0YXRlL2Rpc2FibGVkLmpzIiwibGliL2NvbnRlbnQvc3RhdGUvaGlkZGVuLmpzIiwibGliL2NvbnRlbnQvc3R5bGUvaW5kZXguanMiLCJsaWIvY29udGVudC90YWcvaW5kZXguanMiLCJsaWIvY29udGVudC90YWcvd21sL3RhZy5qcyIsImxpYi9jb250ZW50L3RodW1ibmFpbC9pbmRleC5qcyIsImxpYi9jb250ZW50L3RodW1ibmFpbC93bWwvdGh1bWJuYWlsLmpzIiwibGliL2NvbnRyb2wvYnV0dG9uLWdyb3VwL2luZGV4LmpzIiwibGliL2NvbnRyb2wvYnV0dG9uLWdyb3VwL3dtbC9idXR0b24tZ3JvdXAuanMiLCJsaWIvY29udHJvbC9idXR0b24tc2VsZWN0L2luZGV4LmpzIiwibGliL2NvbnRyb2wvYnV0dG9uLXNlbGVjdC93bWwvYnV0dG9uLXNlbGVjdC5qcyIsImxpYi9jb250cm9sL2J1dHRvbi9pbmRleC5qcyIsImxpYi9jb250cm9sL2J1dHRvbi93bWwvYnV0dG9uLmpzIiwibGliL2NvbnRyb2wvY2hlY2tib3gvaW5kZXguanMiLCJsaWIvY29udHJvbC9jaGVja2JveC93bWwvY2hlY2tib3guanMiLCJsaWIvY29udHJvbC9jbG9zZS1idXR0b24vaW5kZXguanMiLCJsaWIvY29udHJvbC9jbG9zZS1idXR0b24vd21sL2Nsb3NlLWJ1dHRvbi5qcyIsImxpYi9jb250cm9sL2RhdGUtZmllbGQvaW5kZXguanMiLCJsaWIvY29udHJvbC9kYXRlLWZpZWxkL3dtbC9kYXRlLWZpZWxkLmpzIiwibGliL2NvbnRyb2wvZGlzcGxheS1maWVsZC9pbmRleC5qcyIsImxpYi9jb250cm9sL2Rpc3BsYXktZmllbGQvd21sL2Rpc3BsYXktZmllbGQuanMiLCJsaWIvY29udHJvbC9kcm9wLWRvd24vaW5kZXguanMiLCJsaWIvY29udHJvbC9kcm9wLWRvd24vd21sL2Ryb3AtZG93bi5qcyIsImxpYi9jb250cm9sL2Ryb3AtbGlzdC1maWVsZC9pbmRleC5qcyIsImxpYi9jb250cm9sL2Ryb3AtbGlzdC1maWVsZC93bWwvZHJvcC1saXN0LWZpZWxkLmpzIiwibGliL2NvbnRyb2wvZHJvcC1saXN0L2luZGV4LmpzIiwibGliL2NvbnRyb2wvZHJvcC1saXN0L3dtbC9kcm9wLWxpc3QuanMiLCJsaWIvY29udHJvbC9mZWVkYmFjay5qcyIsImxpYi9jb250cm9sL2ZpbGUtaW5wdXQvaW5kZXguanMiLCJsaWIvY29udHJvbC9maWxlLWlucHV0L3dtbC9maWxlLWlucHV0LmpzIiwibGliL2NvbnRyb2wvZmlsZS11cGxvYWQtc3VyZmFjZS9pbmRleC5qcyIsImxpYi9jb250cm9sL2ZpbGUtdXBsb2FkLXN1cmZhY2Uvd21sL2ZpbGUtdXBsb2FkLXN1cmZhY2UuanMiLCJsaWIvY29udHJvbC9mb2N1cy5qcyIsImxpYi9jb250cm9sL2Zvcm0uanMiLCJsaWIvY29udHJvbC9oZWxwL2luZGV4LmpzIiwibGliL2NvbnRyb2wvaGVscC93bWwvaGVscC5qcyIsImxpYi9jb250cm9sL2luZGV4LmpzIiwibGliL2NvbnRyb2wvaW5wdXQtZ3JvdXAvaW5kZXguanMiLCJsaWIvY29udHJvbC9pbnB1dC1ncm91cC93bWwvaW5wdXQtZ3JvdXAuanMiLCJsaWIvY29udHJvbC9sYWJlbC9pbmRleC5qcyIsImxpYi9jb250cm9sL2xhYmVsL3dtbC9sYWJlbC5qcyIsImxpYi9jb250cm9sL211bHRpLXNlbGVjdC9pbmRleC5qcyIsImxpYi9jb250cm9sL211bHRpLXNlbGVjdC93bWwvbXVsdGktc2VsZWN0LmpzIiwibGliL2NvbnRyb2wvcGFnaW5hdG9yL2luZGV4LmpzIiwibGliL2NvbnRyb2wvcGFnaW5hdG9yL3dtbC9wYWdpbmF0b3IuanMiLCJsaWIvY29udHJvbC9yZXN1bHRzLW1lbnUvaW5kZXguanMiLCJsaWIvY29udHJvbC9yZXN1bHRzLW1lbnUvd21sL3Jlc3VsdHMtbWVudS5qcyIsImxpYi9jb250cm9sL3NlYXJjaC9pbmRleC5qcyIsImxpYi9jb250cm9sL3NlYXJjaC93bWwvc2VhcmNoLmpzIiwibGliL2NvbnRyb2wvc2VsZWN0L2luZGV4LmpzIiwibGliL2NvbnRyb2wvc2VsZWN0L3dtbC9zZWxlY3QuanMiLCJsaWIvY29udHJvbC9zdGFjay1zZWxlY3QvaW5kZXguanMiLCJsaWIvY29udHJvbC9zdGFjay1zZWxlY3Qvd21sL3N0YWNrLXNlbGVjdC5qcyIsImxpYi9jb250cm9sL3N0YWNrL2luZGV4LmpzIiwibGliL2NvbnRyb2wvc3RhY2svd21sL3N0YWNrLmpzIiwibGliL2NvbnRyb2wvc3dpdGNoL2luZGV4LmpzIiwibGliL2NvbnRyb2wvc3dpdGNoL3dtbC9zd2l0Y2guanMiLCJsaWIvY29udHJvbC90YWItYmFyL2luZGV4LmpzIiwibGliL2NvbnRyb2wvdGFiLWJhci93bWwvdGFiLWJhci5qcyIsImxpYi9jb250cm9sL3RhZy9pbmRleC5qcyIsImxpYi9jb250cm9sL3RhZy93bWwvdGFnLmpzIiwibGliL2NvbnRyb2wvdGV4dC1maWVsZC9pbmRleC5qcyIsImxpYi9jb250cm9sL3RleHQtZmllbGQvd21sL3RleHQtZmllbGQuanMiLCJsaWIvY29udHJvbC90ZXh0LWlucHV0L2luZGV4LmpzIiwibGliL2NvbnRyb2wvdGV4dC1pbnB1dC93bWwvdGV4dC1pbnB1dC5qcyIsImxpYi9jb250cm9sL3Rvb2xiYXIvaW5kZXguanMiLCJsaWIvY29udHJvbC90b29sYmFyL3dtbC90b29sYmFyLmpzIiwibGliL2NvbnRyb2wvdHlwZWFoZWFkL2luZGV4LmpzIiwibGliL2NvbnRyb2wvdHlwZWFoZWFkL3dtbC90eXBlYWhlYWQuanMiLCJsaWIvZGF0YS9wcm9wZXJ0eS1saXN0L2luZGV4LmpzIiwibGliL2RhdGEvcHJvcGVydHktbGlzdC93bWwvcHJvcGVydHktbGlzdC5qcyIsImxpYi9kYXRhL3RhYmxlL2NvbHVtbi9zb3J0LmpzIiwibGliL2RhdGEvdGFibGUvZXZlbnQuanMiLCJsaWIvZGF0YS90YWJsZS9pbmRleC5qcyIsImxpYi9kYXRhL3RhYmxlL3JhbmdlLmpzIiwibGliL2RhdGEvdGFibGUvd21sL3RhYmxlLmpzIiwibGliL2RpYWxvZy9hbGVydC9pbmRleC5qcyIsImxpYi9kaWFsb2cvYWxlcnQvd21sL2FsZXJ0LmpzIiwibGliL2RpYWxvZy9jb25maXJtL2luZGV4LmpzIiwibGliL2RpYWxvZy9jb25maXJtL3dtbC9jb25maXJtLmpzIiwibGliL2RpYWxvZy9pbmZvcm0vaW5kZXguanMiLCJsaWIvZGlhbG9nL2luZm9ybS93bWwvaW5mb3JtLmpzIiwibGliL2RpYWxvZy9tb2RhbC9pbmRleC5qcyIsImxpYi9kaWFsb2cvbW9kYWwvd21sL21vZGFsLmpzIiwibGliL2RpYWxvZy9wcm9tcHQvaW5kZXguanMiLCJsaWIvZGlhbG9nL3Byb21wdC93bWwvcHJvbXB0LmpzIiwibGliL2luZGV4LmpzIiwibGliL2xheW91dC9hY3Rpb24tYmFyL2luZGV4LmpzIiwibGliL2xheW91dC9hY3Rpb24tYmFyL3dtbC9hY3Rpb24tYmFyLmpzIiwibGliL2xheW91dC9jYWxsb3V0L2luZGV4LmpzIiwibGliL2xheW91dC9jYWxsb3V0L3dtbC9jYWxsb3V0LmpzIiwibGliL2xheW91dC9kZXNjcmlwdGlvbi1saXN0L2luZGV4LmpzIiwibGliL2xheW91dC9kZXNjcmlwdGlvbi1saXN0L3dtbC9kZXNjcmlwdGlvbi1saXN0LmpzIiwibGliL2xheW91dC9kcmF3ZXIvaW5kZXguanMiLCJsaWIvbGF5b3V0L2RyYXdlci93bWwvZHJhd2VyLmpzIiwibGliL2xheW91dC9ncmlkL2luZGV4LmpzIiwibGliL2xheW91dC9ncmlkL3dtbC9ncmlkLmpzIiwibGliL2xheW91dC9ob3Jpem9udGFsL2luZGV4LmpzIiwibGliL2xheW91dC9ob3Jpem9udGFsL3dtbC9ob3Jpem9udGFsLmpzIiwibGliL2xheW91dC9pbmRleC5qcyIsImxpYi9sYXlvdXQvbGlzdC9pbmRleC5qcyIsImxpYi9sYXlvdXQvbGlzdC93bWwvbGlzdC5qcyIsImxpYi9sYXlvdXQvbWFpbi9pbmRleC5qcyIsImxpYi9sYXlvdXQvbWFpbi93bWwvbWFpbi5qcyIsImxpYi9sYXlvdXQvbWV0ZXIvaW5kZXguanMiLCJsaWIvbGF5b3V0L21ldGVyL3dtbC9tZXRlci5qcyIsImxpYi9sYXlvdXQvcGFuZWwvaW5kZXguanMiLCJsaWIvbGF5b3V0L3BhbmVsL3dtbC9wYW5lbC5qcyIsImxpYi9sYXlvdXQvdGFiL2luZGV4LmpzIiwibGliL2xheW91dC90YWIvd21sL3RhYi5qcyIsImxpYi9sYXlvdXQvdGFibGUvaW5kZXguanMiLCJsaWIvbGF5b3V0L3RhYmxlL3dtbC90YWJsZS5qcyIsImxpYi9sYXlvdXQvd2VsbC9pbmRleC5qcyIsImxpYi9sYXlvdXQvd2VsbC93bWwvd2VsbC5qcyIsImxpYi9tZW51L2RyYXdlci9pbmRleC5qcyIsImxpYi9tZW51L2RyYXdlci93bWwvZHJhd2VyLmpzIiwibGliL21lbnUvaGVhZGVyL2luZGV4LmpzIiwibGliL21lbnUvaGVhZGVyL3dtbC9oZWFkZXIuanMiLCJsaWIvbWVudS9pdGVtL2luZGV4LmpzIiwibGliL21lbnUvaXRlbS93bWwvaXRlbS5qcyIsImxpYi9tZW51L21lbnUvaW5kZXguanMiLCJsaWIvbWVudS9tZW51L3dtbC9oZWFkZXIuanMiLCJsaWIvbWVudS9tZW51L3dtbC9tZW51LmpzIiwibGliL21lbnUvbmF2L2luZGV4LmpzIiwibGliL21lbnUvbmF2L3dtbC9uYXYuanMiLCJsaWIvdXRpbC5qcyIsIm5vZGVfbW9kdWxlcy9AcXVlbmsvbm9uaS9saWIvY29udHJvbC90aW1lci5qcyIsIm5vZGVfbW9kdWxlcy9AcXVlbmsvbm9uaS9saWIvZGF0YS9hcnJheS9pbmRleC5qcyIsIm5vZGVfbW9kdWxlcy9AcXVlbmsvbm9uaS9saWIvZGF0YS9hcnJheS9zb3J0LmpzIiwibm9kZV9tb2R1bGVzL0BxdWVuay9ub25pL2xpYi9kYXRhL21heWJlLmpzIiwibm9kZV9tb2R1bGVzL0BxdWVuay9ub25pL2xpYi9kYXRhL3JlY29yZC9pbmRleC5qcyIsIm5vZGVfbW9kdWxlcy9AcXVlbmsvbm9uaS9saWIvZGF0YS9yZWNvcmQvcGF0aC5qcyIsIm5vZGVfbW9kdWxlcy9AcXVlbmsvbm9uaS9saWIvZGF0YS90eXBlL2luZGV4LmpzIiwibm9kZV9tb2R1bGVzL0BxdWVuay9ub25pL2xpYi9tYXRoLmpzIiwibm9kZV9tb2R1bGVzL0BxdWVuay93bWwvbGliL2RvbS5qcyIsIm5vZGVfbW9kdWxlcy9AcXVlbmsvd21sL2xpYi9pbmRleC5qcyIsIm5vZGVfbW9kdWxlcy9tb21lbnQvbW9tZW50LmpzIiwibm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L2FwcC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L2ZpeHR1cmVzL2RhdGEvcmVzdWx0cy5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udGVudF9lbWJlZC9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udGVudF9lbWJlZC93bWwvZW1iZWQuanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRlbnRfbWVkaWEtZGVzY3JpcHRpb24vaW5kZXguanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRlbnRfbWVkaWEtZGVzY3JpcHRpb24vd21sL21lZGlhLWRlc2NyaXB0aW9uLmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250ZW50X292ZXJsYXkvaW5kZXguanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRlbnRfb3ZlcmxheS93bWwvb3ZlcmxheS5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udGVudF90YWcvaW5kZXguanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRlbnRfdGFnL3dtbC90YWcuanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRlbnRfdGh1bWJuYWlsL2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250ZW50X3RodW1ibmFpbC93bWwvdGh1bWJuYWlsLmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX2J1dHRvbi1ncm91cC9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF9idXR0b24tZ3JvdXAvd21sL2J1dHRvbi1ncm91cC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF9idXR0b24tc2VsZWN0L2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX2J1dHRvbi1zZWxlY3Qvd21sL2J1dHRvbi1zZWxlY3QuanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRyb2xfYnV0dG9uL2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX2J1dHRvbi93bWwvYnV0dG9uLmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX2NoZWNrYm94L2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX2NoZWNrYm94L3dtbC9jaGVja2JveC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF9kYXRlLWZpZWxkL2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX2RhdGUtZmllbGQvd21sL2RhdGUtZmllbGQuanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRyb2xfZGlzcGxheS1maWVsZC9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF9kaXNwbGF5LWZpZWxkL3dtbC9kaXNwbGF5LWZpZWxkLmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX2Ryb3AtZG93bi9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF9kcm9wLWRvd24vd21sL2Ryb3AtZG93bi5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF9kcm9wLWxpc3QtZmllbGQvaW5kZXguanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRyb2xfZHJvcC1saXN0LWZpZWxkL3dtbC9kcm9wLWxpc3QtZmllbGQuanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRyb2xfZHJvcC1saXN0L2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX2Ryb3AtbGlzdC93bWwvZHJvcC1saXN0LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX2ZpbGUtdXBsb2FkLXN1cmZhY2UvaW5kZXguanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRyb2xfZmlsZS11cGxvYWQtc3VyZmFjZS93bWwvZmlsZS11cGxvYWQtc3VyZmFjZS5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF9pbnB1dC1ncm91cC9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF9pbnB1dC1ncm91cC93bWwvaW5wdXQtZ3JvdXAuanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRyb2xfbXVsdGktc2VsZWN0L2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX211bHRpLXNlbGVjdC93bWwvbXVsdGktc2VsZWN0LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX3BhZ2luYXRvci9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF9wYWdpbmF0b3Ivd21sL3BhZ2luYXRvci5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF9zZWFyY2gvaW5kZXguanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRyb2xfc2VhcmNoL3dtbC9zZWFyY2guanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRyb2xfc2VsZWN0L2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX3NlbGVjdC93bWwvc2VsZWN0LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX3N0YWNrLXNlbGVjdC9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF9zdGFjay1zZWxlY3Qvd21sL3N0YWNrLXNlbGVjdC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF9zdGFjay9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF9zdGFjay93bWwvc3RhY2suanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRyb2xfc3dpdGNoL2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX3N3aXRjaC93bWwvc3dpdGNoLmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX3RhYi1iYXIvaW5kZXguanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRyb2xfdGFiLWJhci93bWwvdGFiLWJhci5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF90YWctY29udHJvbC9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF90YWctY29udHJvbC93bWwvdGFnLmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX3RleHQtZmllbGQvaW5kZXguanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRyb2xfdGV4dC1maWVsZC93bWwvdGV4dC1maWVsZC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF90ZXh0LWlucHV0L2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX3RleHQtaW5wdXQvd21sL3RleHQtaW5wdXQuanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2NvbnRyb2xfdG9vbGJhci9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF90b29sYmFyL3dtbC90b29sYmFyLmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9jb250cm9sX3R5cGVhaGVhZC9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvY29udHJvbF90eXBlYWhlYWQvd21sL3R5cGVhaGVhZC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvZGF0YV9kYXRhLXRhYmxlL2RhdGEuanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2RhdGFfZGF0YS10YWJsZS9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvZGF0YV9kYXRhLXRhYmxlL3dtbC90YWJsZS5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvZGF0YV9wcm9wZXJ0eS1saXN0L2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9kYXRhX3Byb3BlcnR5LWxpc3Qvd21sL3Byb3BlcnR5LWxpc3QuanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2RpYWxvZ19hbGVydC9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvZGlhbG9nX2FsZXJ0L3dtbC9hbGVydC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvZGlhbG9nX2NvbmZpcm0vaW5kZXguanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2RpYWxvZ19jb25maXJtL3dtbC9jb25maXJtLmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9kaWFsb2dfaW5mb3JtL2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9kaWFsb2dfaW5mb3JtL3dtbC9pbmZvcm0uanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2RpYWxvZ19tb2RhbC9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvZGlhbG9nX21vZGFsL3dtbC9tb2RhbC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvZGlhbG9nX3Byb21wdC9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvZGlhbG9nX3Byb21wdC93bWwvcHJvbXB0LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9sYXlvdXRfY2FsbG91dC9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvbGF5b3V0X2NhbGxvdXQvd21sL2NhbGxvdXQuanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2xheW91dF9kZXNjcmlwdGlvbi1saXN0L2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9sYXlvdXRfZGVzY3JpcHRpb24tbGlzdC93bWwvZGVzY3JpcHRpb24tbGlzdC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvbGF5b3V0X2dyaWQvaW5kZXguanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2xheW91dF9ncmlkL3dtbC9ncmlkLmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9sYXlvdXRfaG9yaXpvbnRhbC9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvbGF5b3V0X2hvcml6b250YWwvd21sL2hvcml6b250YWwuanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2xheW91dF9saXN0L2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9sYXlvdXRfbGlzdC93bWwvbGlzdC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvbGF5b3V0X21ldGVyL2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9sYXlvdXRfbWV0ZXIvd21sL21ldGVyLmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9sYXlvdXRfcGFuZWwvaW5kZXguanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2xheW91dF9wYW5lbC93bWwvcGFuZWwuanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2xheW91dF90YWIvaW5kZXguanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL2xheW91dF90YWIvd21sL3RhYi5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvbGF5b3V0X3RhYmxlL2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9sYXlvdXRfdGFibGUvd21sL3RhYmxlLmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9sYXlvdXRfd2VsbC9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvbGF5b3V0X3dlbGwvd21sL3dlbGwuanMiLCJ0ZXN0L2Jyb3dzZXIvZGVzdC9wYWdlL21lbnVfbWVudS9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvbWVudV9tZW51L3dtbC9tZW51LmpzIiwidGVzdC9icm93c2VyL2Rlc3QvcGFnZS9tZW51X25hdi9pbmRleC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2UvbWVudV9uYXYvd21sL25hdi5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3BhZ2VzLmpzIiwidGVzdC9icm93c2VyL2Rlc3Qvd2lkZ2V0cy9kZW1vL2luZGV4LmpzIiwidGVzdC9icm93c2VyL2Rlc3Qvd2lkZ2V0cy9kZW1vL3dtbC9kZW1vLmpzIiwidGVzdC9icm93c2VyL2Rlc3Qvd21sL2FwcC5qcyIsInRlc3QvYnJvd3Nlci9kZXN0L3dtbC9uYXZpZ2F0aW9uLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNySkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDclhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDblVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDclFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDek9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0tBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcFFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2UUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNySEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzd0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3plQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDclhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDclhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDclFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JlQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdExBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3I2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNySkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNySkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUN6RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDbERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeExBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUM1Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDOVZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdGlMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbktBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcE5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdk1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0tBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDektBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcktBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25LQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdktBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcktBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0T0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4UUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3UUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25LQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbFNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNhcmV0ID0gZXhwb3J0cy5DQVJFVCA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9jYXJldFwiKTtcbnZhciB3bWxfMSA9IHJlcXVpcmUoXCJAcXVlbmsvd21sXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5DQVJFVCA9ICd3dy1jYXJldCc7XG4vKipcbiAqIENhcmV0XG4gKi9cbnZhciBDYXJldCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoQ2FyZXQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQ2FyZXQoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4oX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICByb290OiB7XG4gICAgICAgICAgICAgICAgaWQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5pZCkgPyBfdGhpcy5hdHRycy53dy5pZCA6ICcnLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLkNBUkVULCAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuY2xhc3NOYW1lKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmNsYXNzTmFtZSA6ICcnKVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBDYXJldDtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLkNhcmV0ID0gQ2FyZXQ7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgnc3BhbicsIHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5yb290LmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuY2xhc3NOYW1lIH0sIFtdKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNhcmV0LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNsb3NlID0gZXhwb3J0cy5DTE9TRSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9jbG9zZVwiKTtcbnZhciB3bWxfMSA9IHJlcXVpcmUoXCJAcXVlbmsvd21sXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5DTE9TRSA9ICd3dy1jbG9zZSc7XG4vKipcbiAqIENsb3NlXG4gKi9cbnZhciBDbG9zZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoQ2xvc2UsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQ2xvc2UoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4oX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBpZDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmlkKSA/XG4gICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuaWQgOiAnJyxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLkNMT1NFLCAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuY2xhc3NOYW1lKSA/XG4gICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuY2xhc3NOYW1lIDogJycpLFxuICAgICAgICAgICAgb25DbGljazogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm9uQ2xpY2spID9cbiAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vbkNsaWNrIDogZnVuY3Rpb24gKCkgeyB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIENsb3NlO1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuQ2xvc2UgPSBDbG9zZTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdzcGFuJywgeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSwgJ29uY2xpY2snOiBfX2NvbnRleHQudmFsdWVzLm9uQ2xpY2sgfSwgW1xuICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ8OXJylcbiAgICAgICAgICAgIF0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2xvc2UuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRW1iZWQgPSBleHBvcnRzLkVNQkVEID0gdm9pZCAwO1xudmFyIHdtbF8xID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciBlbWJlZF8xID0gcmVxdWlyZShcIi4vd21sL2VtYmVkXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5FTUJFRCA9ICd3dy1lbWJlZCc7XG4vKipcbiAqIEVtYmVkXG4gKi9cbnZhciBFbWJlZCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoRW1iZWQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gRW1iZWQoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IGVtYmVkXzEuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgIGlkOiAnZW1iZWQnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5FTUJFRCwgX18xLmdldENsYXNzTmFtZShfdGhpcy5hdHRycykpLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBFbWJlZDtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLkVtYmVkID0gRW1iZWQ7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY2xhc3NOYW1lIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQuY2hpbGRyZW4pKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1lbWJlZC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5MaW5rID0gZXhwb3J0cy5MaW5rQ2xpY2tlZEV2ZW50ID0gZXhwb3J0cy5MSU5LID0gdm9pZCAwO1xudmFyIHdtbCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sXCIpO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL2xpbmtcIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgYWN0aXZlXzEgPSByZXF1aXJlKFwiLi4vc3RhdGUvYWN0aXZlXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuLyoqXG4gKiBMSU5LXG4gKi9cbmV4cG9ydHMuTElOSyA9ICd3dy1saW5rJztcbi8qKlxuICogTGlua0NsaWNrZWRFdmVudCBpbmRpY2F0ZXMgYW4gTGluayBoYXMgYmVlbiBjbGlja2VkLlxuICovXG52YXIgTGlua0NsaWNrZWRFdmVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBMaW5rQ2xpY2tlZEV2ZW50KG5hbWUsIGhyZWYpIHtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgdGhpcy5ocmVmID0gaHJlZjtcbiAgICB9XG4gICAgcmV0dXJuIExpbmtDbGlja2VkRXZlbnQ7XG59KCkpO1xuZXhwb3J0cy5MaW5rQ2xpY2tlZEV2ZW50ID0gTGlua0NsaWNrZWRFdmVudDtcbi8qKlxuICogTGluayBnZW5lcmF0ZXMgYW4gPGE+IGVsZW1lbnQuXG4gKi9cbnZhciBMaW5rID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhMaW5rLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIExpbmsoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4oX3RoaXMpO1xuICAgICAgICAvKipcbiAgICAgICAgICogbmFtZSBhc3NpZ25lZCB0byB0aGlzIExpbmsuXG4gICAgICAgICAqL1xuICAgICAgICBfdGhpcy5uYW1lID0gKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm5hbWUpID9cbiAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm5hbWUgOiAnJztcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHRpdGxlIGFzc2lnbmVkIHRvIHRoaXMgTGluay5cbiAgICAgICAgICovXG4gICAgICAgIF90aGlzLnRpdGxlID0gKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnRpdGxlKSA/XG4gICAgICAgICAgICBfdGhpcy5hdHRycy53dy50aXRsZSA6ICcnO1xuICAgICAgICAvKipcbiAgICAgICAgICogaHJlZiBhc3NpZ25lZCB0byB0aGlzIExpbmtcbiAgICAgICAgICovXG4gICAgICAgIF90aGlzLmhyZWYgPSAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuaHJlZikgP1xuICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuaHJlZiA6ICcnO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBhOiB7XG4gICAgICAgICAgICAgICAgaWQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5pZCkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5pZCA6ICcnLFxuICAgICAgICAgICAgICAgIGRpc2FibGVkOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZGlzYWJsZWQpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuZGlzYWJsZWQgOiBudWxsLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLkxJTkssIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5jbGFzc05hbWUpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuY2xhc3NOYW1lIDogJycsIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5hY3RpdmUpID9cbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlXzEuQUNUSVZFIDogJycpLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cudGl0bGUpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cudGl0bGUgOiBudWxsLFxuICAgICAgICAgICAgICAgIG5hbWU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5uYW1lKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm5hbWUgOiBudWxsLFxuICAgICAgICAgICAgICAgIGhyZWY6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5ocmVmKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmhyZWYgOiAnIycsXG4gICAgICAgICAgICAgICAgYWN0aXZlOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuYWN0aXZlKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmFjdGl2ZSA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIC8vVE9ETzogbW92ZSB0byBkb20gbGliXG4gICAgICAgICAgICAgICAgY29udGVudDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnRleHQpID9cbiAgICAgICAgICAgICAgICAgICAgW2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKF90aGlzLmF0dHJzLnd3LnRleHQpXSA6XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmNoaWxkcmVuLFxuICAgICAgICAgICAgICAgIGNsaWNrZWQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hID0gX3RoaXMuYXR0cnMud3csIG5hbWVfMSA9IF9hLm5hbWUsIGhyZWYgPSBfYS5ocmVmLCBvbkNsaWNrID0gX2Eub25DbGljaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaHJlZilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob25DbGljaylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrKG5ldyBMaW5rQ2xpY2tlZEV2ZW50KG5hbWVfMSwgaHJlZikpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAgKiBhY3RpdmF0ZSB0aGlzIG5hdiBsaXN0IEl0ZW0uXG4gICAgICAqL1xuICAgIExpbmsucHJvdG90eXBlLmFjdGl2YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbSA9IHV0aWxfMS5nZXRCeUlkKHRoaXMudmlldywgdGhpcy52YWx1ZXMuYS5pZCk7XG4gICAgICAgIGlmIChtLmlzSnVzdCgpKSB7XG4gICAgICAgICAgICB2YXIgZSA9IG0uZ2V0KCk7XG4gICAgICAgICAgICBlLmNsYXNzTGlzdC5yZW1vdmUoYWN0aXZlXzEuQUNUSVZFKTtcbiAgICAgICAgICAgIGUuY2xhc3NMaXN0LmFkZChhY3RpdmVfMS5BQ1RJVkUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogZGVhY3RpdmF0ZSB0aGlzIG5hdiBsaXN0IGl0ZW0uXG4gICAgICovXG4gICAgTGluay5wcm90b3R5cGUuZGVhY3RpdmF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG0gPSB1dGlsXzEuZ2V0QnlJZCh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLmEuaWQpO1xuICAgICAgICBpZiAobS5pc0p1c3QoKSlcbiAgICAgICAgICAgIG0uZ2V0KCkuY2xhc3NMaXN0LnJlbW92ZShhY3RpdmVfMS5BQ1RJVkUpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIHJldHVybiBMaW5rO1xufSh3bWwuQ29tcG9uZW50KSk7XG5leHBvcnRzLkxpbmsgPSBMaW5rO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheXMgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXlzKSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcbiAgICAgICAgICAgIHJba10gPSBhW2pdO1xuICAgIHJldHVybiByO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgnYScsIHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5hLmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmEuY2xhc3NOYW1lLCAnaHJlZic6IF9fY29udGV4dC52YWx1ZXMuYS5ocmVmLCAndGl0bGUnOiBfX2NvbnRleHQudmFsdWVzLmEudGl0bGUsICdkaXNhYmxlZCc6IF9fY29udGV4dC52YWx1ZXMuYS5kaXNhYmxlZCwgJ29uY2xpY2snOiBfX2NvbnRleHQudmFsdWVzLmEuY2xpY2tlZCB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LnZhbHVlcy5hLmNvbnRlbnQpKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1saW5rLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkRlc2NyaXB0aW9uID0gZXhwb3J0cy5NZWRpYSA9IGV4cG9ydHMuTWVkaWFEZXNjcmlwdGlvbiA9IGV4cG9ydHMuTUVESUFfREVTQ1JJUFRJT05fREVTQ1JJUFRJT04gPSBleHBvcnRzLk1FRElBX0RFU0NSSVBUSU9OX01FRElBID0gZXhwb3J0cy5NRURJQV9ERVNDUklQVElPTiA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9tZWRpYS1kZXNjcmlwdGlvblwiKTtcbnZhciB3bWxfMSA9IHJlcXVpcmUoXCJAcXVlbmsvd21sXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLi8uLi9cIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLk1FRElBX0RFU0NSSVBUSU9OID0gJ3d3LW1lZGlhLWRlc2NyaXB0aW9uJztcbmV4cG9ydHMuTUVESUFfREVTQ1JJUFRJT05fTUVESUEgPSAnd3ctbWVkaWEtZGVzY3JpcHRpb25fX21lZGlhJztcbmV4cG9ydHMuTUVESUFfREVTQ1JJUFRJT05fREVTQ1JJUFRJT04gPSAnd3ctbWVkaWEtZGVzY3JpcHRpb25fX2Rlc2NyaXB0aW9uJztcbi8qKlxuICogTWVkaWFEZXNjcmlwdGlvblxuICovXG52YXIgTWVkaWFEZXNjcmlwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTWVkaWFEZXNjcmlwdGlvbiwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBNZWRpYURlc2NyaXB0aW9uKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5NZWRpYURlc2NyaXB0aW9uKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5NRURJQV9ERVNDUklQVElPTiwgX18xLmdldENsYXNzTmFtZShfdGhpcy5hdHRycykpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIE1lZGlhRGVzY3JpcHRpb247XG59KHdtbF8xLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5NZWRpYURlc2NyaXB0aW9uID0gTWVkaWFEZXNjcmlwdGlvbjtcbi8qKlxuICogTWVkaWFcbiAqL1xudmFyIE1lZGlhID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhNZWRpYSwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBNZWRpYSgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuTWVkaWEoX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLk1FRElBX0RFU0NSSVBUSU9OX01FRElBLCBfXzEuZ2V0Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSlcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gTWVkaWE7XG59KHdtbF8xLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5NZWRpYSA9IE1lZGlhO1xuLyoqXG4gKiBEZXNjcmlwdGlvblxuICovXG52YXIgRGVzY3JpcHRpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKERlc2NyaXB0aW9uLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIERlc2NyaXB0aW9uKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5EZXNjcmlwdGlvbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIGlkOiBfXzEuZ2V0SWQoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuTUVESUFfREVTQ1JJUFRJT05fREVTQ1JJUFRJT04sIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBEZXNjcmlwdGlvbjtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLkRlc2NyaXB0aW9uID0gRGVzY3JpcHRpb247XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5EZXNjcmlwdGlvbiA9IGV4cG9ydHMuTWVkaWEgPSBleHBvcnRzLk1lZGlhRGVzY3JpcHRpb24gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNZWRpYURlc2NyaXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1lZGlhRGVzY3JpcHRpb24oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWVkaWFEZXNjcmlwdGlvbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1lZGlhRGVzY3JpcHRpb24ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWVkaWFEZXNjcmlwdGlvbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1lZGlhRGVzY3JpcHRpb24ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWVkaWFEZXNjcmlwdGlvbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWVkaWFEZXNjcmlwdGlvbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNZWRpYURlc2NyaXB0aW9uLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNZWRpYURlc2NyaXB0aW9uLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1lZGlhRGVzY3JpcHRpb247XG59KCkpO1xuZXhwb3J0cy5NZWRpYURlc2NyaXB0aW9uID0gTWVkaWFEZXNjcmlwdGlvbjtcbjtcbnZhciBNZWRpYSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNZWRpYShfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgnZGl2JywgeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LmNoaWxkcmVuKSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNZWRpYS5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1lZGlhLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1lZGlhLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWVkaWEucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWVkaWEucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1lZGlhLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1lZGlhLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNZWRpYS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNZWRpYTtcbn0oKSk7XG5leHBvcnRzLk1lZGlhID0gTWVkaWE7XG47XG52YXIgRGVzY3JpcHRpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRGVzY3JpcHRpb24oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgRGVzY3JpcHRpb24ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBEZXNjcmlwdGlvbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBEZXNjcmlwdGlvbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIERlc2NyaXB0aW9uLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIERlc2NyaXB0aW9uLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBEZXNjcmlwdGlvbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBEZXNjcmlwdGlvbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgRGVzY3JpcHRpb24ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gRGVzY3JpcHRpb247XG59KCkpO1xuZXhwb3J0cy5EZXNjcmlwdGlvbiA9IERlc2NyaXB0aW9uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bWVkaWEtZGVzY3JpcHRpb24uanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWVudUljb24gPSBleHBvcnRzLk1FTlVfSUNPTl9EQVNIID0gZXhwb3J0cy5NRU5VX0lDT04gPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvbWVudS1pY29uXCIpO1xudmFyIHdtbF8xID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLk1FTlVfSUNPTiA9ICd3dy1tZW51LWljb24nO1xuZXhwb3J0cy5NRU5VX0lDT05fREFTSCA9ICd3dy1tZW51LWljb25fX2Rhc2gnO1xuLyoqXG4gKiBNZW51SWNvbiBwcm92aWRlcyBhIGNzcyBpbXBsZW1lbnQgaWNvbiBub3JtYWxseSB1c2VkXG4gKiB0byB0b2dnbGUgYSBzaWRlIG1lbnUuXG4gKi9cbnZhciBNZW51SWNvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTWVudUljb24sIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTWVudUljb24oKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4oX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICByb290OiB7XG4gICAgICAgICAgICAgICAgaWQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5pZCkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5pZCA6ICcnLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLk1FTlVfSUNPTiwgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmlkKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmlkIDogJycpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGFzaDoge1xuICAgICAgICAgICAgICAgIGlkOiAnZGFzaCcsXG4gICAgICAgICAgICAgICAgY2xhc3M6IGV4cG9ydHMuTUVOVV9JQ09OX0RBU0hcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gTWVudUljb247XG59KHdtbF8xLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5NZW51SWNvbiA9IE1lbnVJY29uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ3NwYW4nLCB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMucm9vdC5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5yb290LmNsYXNzTmFtZSB9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3NwYW4nLCB7ICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuZGFzaC5jbGFzcyB9LCBbXSksXG4gICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3NwYW4nLCB7ICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuZGFzaC5jbGFzcyB9LCBbXSksXG4gICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3NwYW4nLCB7ICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuZGFzaC5jbGFzcyB9LCBbXSlcbiAgICAgICAgICAgIF0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bWVudS1pY29uLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXRCbG9ja0NsYXNzTmFtZSA9IGV4cG9ydHMuQk9UVE9NID0gZXhwb3J0cy5NSURETEUgPSBleHBvcnRzLkhPUklaT05UQUwgPSBleHBvcnRzLlJJR0hUID0gZXhwb3J0cy5MRUZUID0gZXhwb3J0cy5KVVNUSUZJRUQgPSBleHBvcnRzLkNMRUFSRklYID0gZXhwb3J0cy5CTE9DSyA9IGV4cG9ydHMuUE9TSVRJT05FRCA9IGV4cG9ydHMuUFVTSEFCTEUgPSBleHBvcnRzLlZFUlRJQ0FMID0gdm9pZCAwO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuLyoqXG4gKiBWRVJUSUNBTCBpbmRpY2F0ZXMgYW4gZWxlbWVudCBpcyB2ZXJ0aWNhbCByZW5kZXJlcmQuXG4gKi9cbmV4cG9ydHMuVkVSVElDQUwgPSAnLXZlcnRpY2FsJztcbi8qKlxuICogUFVTSEFCTEUgaW5kaWNhdGVzIGFuIGVsZW1lbnQgc3VwcG9ydHMgYmVpbmcgcHVzaGVkXG4gKiBhbmQgY2FuIGhhdmUgc3R5bGVzIGFkZGVkIHRvIGl0IGFyb3VuZCB0aGUgY29uY2VwdC5cbiAqL1xuZXhwb3J0cy5QVVNIQUJMRSA9ICctcHVzaGFibGUnO1xuLyoqXG4gKiBQT1NJVElPTkVEIGluZGljYXRlcyBhbiBlbGVtZW50IGlzIHBvc2l0aW9uZWQgYW5kIHJlc3BvbmRzXG4gKiB0byB0aGUgbGVmdCxyaWdodCBldGMuIHByb3BlcnRpZXMuXG4gKi9cbmV4cG9ydHMuUE9TSVRJT05FRCA9ICctcG9zaXRpb25lZCc7XG4vKipcbiAqIEJMT0NLIGluZGljYXRlcyBhbiBlbGVtZW50IHNob3VsZCBiZSBibG9jayBkaXNwbGF5ZWQuXG4gKi9cbmV4cG9ydHMuQkxPQ0sgPSAnLWJsb2NrJztcbi8qKlxuICogQ0xFQVJGSVggaGFjay5cbiAqL1xuZXhwb3J0cy5DTEVBUkZJWCA9ICctY2xlYXJmaXgnO1xuLyoqXG4gKiBKVVNUSUZJRUQgY29udGVudC5cbiAqL1xuZXhwb3J0cy5KVVNUSUZJRUQgPSAnLWp1c3RpZmllZCc7XG4vKipcbiAqIExFRlQgaW5kaWNhdGVzIGNvbnRlbnQgZmxvYXRlZCBvciBwb3NpdGlvbmVkIHRvIHRoZSBsZWZ0LlxuICovXG5leHBvcnRzLkxFRlQgPSAnLWxlZnQnO1xuLyoqXG4gKiBSSUdIVCBpbmRpY2F0ZXMgY29udGVudCBmbG9hdGVkIG9yIHBvc2l0aW9uZWQgdG8gdGhlIHJpZ2h0LlxuICovXG5leHBvcnRzLlJJR0hUID0gJy1yaWdodCc7XG4vKipcbiAqIEhPUklaT05UQUwgaW5kaWNhdGVzIGEgaG9yaXpvbnRhbCBhbGlnbm1lbnQuXG4gKi9cbmV4cG9ydHMuSE9SSVpPTlRBTCA9ICctaG9yaXpvbnRhbCc7XG5leHBvcnRzLk1JRERMRSA9ICctbWlkZGxlJztcbmV4cG9ydHMuQk9UVE9NID0gJy1ib3R0b20nO1xuLy8vY2xhc3NOYW1lczplbmRcbi8qKlxuICogZ2V0QmxvY2tDbGFzc05hbWUgcHJvdmlkZXMgdGhlIF9fQkxPQ0tfXyBjbGFzcyBuYW1lIGlmIHRoZSBhdHRyaWJ1dGVcbiAqIHZhbHVlIGlzIHNldCB0byB0cnVlLlxuICovXG5leHBvcnRzLmdldEJsb2NrQ2xhc3NOYW1lID0gZnVuY3Rpb24gKGF0dHJzKSB7XG4gICAgcmV0dXJuIChhdHRycy53dyAmJiAoYXR0cnMud3cuYmxvY2sgPT09IHRydWUpKSA/IGV4cG9ydHMuQkxPQ0sgOiAnJztcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1vcmllbnRhdGlvbi5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5PdmVybGF5ID0gZXhwb3J0cy5PVkVSTEFZID0gdm9pZCAwO1xudmFyIHdtbF8xID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciBvdmVybGF5XzEgPSByZXF1aXJlKFwiLi93bWwvb3ZlcmxheVwiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuT1ZFUkxBWSA9ICd3dy1vdmVybGF5Jztcbi8qKlxuICogT3ZlcmxheVxuICovXG52YXIgT3ZlcmxheSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoT3ZlcmxheSwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBPdmVybGF5KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyBvdmVybGF5XzEuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgIGlkOiAncm9vdCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLk9WRVJMQVksIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIG9uY2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cub25DbGljaylcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cub25DbGljaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGNsb3NlIHRoZSBvdmVybGF5LlxuICAgICAqL1xuICAgIE92ZXJsYXkucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbU8gPSB1dGlsXzEuZ2V0QnlJZCh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLndtbC5pZCk7XG4gICAgICAgIGlmIChtTy5pc0p1c3QoKSkge1xuICAgICAgICAgICAgdmFyIG4gPSBtTy5nZXQoKTtcbiAgICAgICAgICAgIGlmIChuLnBhcmVudE5vZGUpXG4gICAgICAgICAgICAgICAgbi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG4pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gT3ZlcmxheTtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLk92ZXJsYXkgPSBPdmVybGF5O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMud21sLmlkIH0sICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY2xhc3NOYW1lLCAnb25jbGljayc6IF9fY29udGV4dC52YWx1ZXMub25jbGljayB9LCBbXSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1vdmVybGF5LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXRTaXplQ2xhc3NOYW1lID0gZXhwb3J0cy5TaXplID0gZXhwb3J0cy5FWFRSQV9MQVJHRSA9IGV4cG9ydHMuTEFSR0UgPSBleHBvcnRzLk1FRElVTSA9IGV4cG9ydHMuU01BTEwgPSBleHBvcnRzLkVYVFJBX1NNQUxMID0gdm9pZCAwO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5FWFRSQV9TTUFMTCA9ICctZXh0cmEtc21hbGwnO1xuZXhwb3J0cy5TTUFMTCA9ICctc21hbGwnO1xuZXhwb3J0cy5NRURJVU0gPSAnLW1lZGl1bSc7XG5leHBvcnRzLkxBUkdFID0gJy1sYXJnZSc7XG5leHBvcnRzLkVYVFJBX0xBUkdFID0gJy1leHRyYS1sYXJnZSc7XG4vLy9jbGFzc05hbWVzOmVuZFxuLyoqXG4gKiBTaXplXG4gKi9cbnZhciBTaXplO1xuKGZ1bmN0aW9uIChTaXplKSB7XG4gICAgU2l6ZVtcIkV4dHJhU21hbGxcIl0gPSBcImV4dHJhLXNtYWxsXCI7XG4gICAgU2l6ZVtcIlNtYWxsXCJdID0gXCJzbWFsbFwiO1xuICAgIFNpemVbXCJNZWRpdW1cIl0gPSBcIm1lZGl1bVwiO1xuICAgIFNpemVbXCJMYXJnZVwiXSA9IFwibGFyZ2VcIjtcbiAgICBTaXplW1wiRXh0cmFMYXJnZVwiXSA9IFwiZXh0cmEtbGFyZ2VcIjtcbn0pKFNpemUgPSBleHBvcnRzLlNpemUgfHwgKGV4cG9ydHMuU2l6ZSA9IHt9KSk7XG4vKipcbiAqIGdldFNpemVDbGFzc05hbWVcbiAqL1xuZXhwb3J0cy5nZXRTaXplQ2xhc3NOYW1lID0gZnVuY3Rpb24gKHMpIHtcbiAgICBpZiAocyA9PT0gU2l6ZS5FeHRyYVNtYWxsKVxuICAgICAgICByZXR1cm4gZXhwb3J0cy5FWFRSQV9TTUFMTDtcbiAgICBlbHNlIGlmIChzID09PSBTaXplLlNtYWxsKVxuICAgICAgICByZXR1cm4gZXhwb3J0cy5TTUFMTDtcbiAgICBlbHNlIGlmIChzID09PSBTaXplLk1lZGl1bSlcbiAgICAgICAgcmV0dXJuIGV4cG9ydHMuTUVESVVNO1xuICAgIGVsc2UgaWYgKHMgPT09IFNpemUuTGFyZ2UpXG4gICAgICAgIHJldHVybiBleHBvcnRzLkxBUkdFO1xuICAgIGVsc2UgaWYgKHMgPT09IFNpemUuRXh0cmFMYXJnZSlcbiAgICAgICAgcmV0dXJuIGV4cG9ydHMuRVhUUkFfTEFSR0U7XG4gICAgcmV0dXJuICcnO1xufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNpemUuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmlzQWN0aXZlID0gZXhwb3J0cy5kZWFjdGl2YXRlID0gZXhwb3J0cy5hY3RpdmF0ZSA9IGV4cG9ydHMuQUNUSVZFID0gdm9pZCAwO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuLyoqXG4gKiBBQ1RJVkVcbiAqL1xuZXhwb3J0cy5BQ1RJVkUgPSAnLWFjdGl2ZSc7XG4vKipcbiAqIGFjdGl2YXRlIGhlbHBlci5cbiAqXG4gKiBBZGRzIHRoZSBBQ1RJVkUgY2xhc3MuXG4gKi9cbmV4cG9ydHMuYWN0aXZhdGUgPSBmdW5jdGlvbiAodmlldywgaWQpIHtcbiAgICByZXR1cm4gdXRpbF8xLmdldEJ5SWQodmlldywgaWQpXG4gICAgICAgIC5tYXAoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5jbGFzc0xpc3QucmVtb3ZlKGV4cG9ydHMuQUNUSVZFKTtcbiAgICAgICAgZS5jbGFzc0xpc3QuYWRkKGV4cG9ydHMuQUNUSVZFKTtcbiAgICB9KTtcbn07XG4vKipcbiAqIGRlYWN0aXZhdGUgaGVscGVyLlxuICpcbiAqIFJlbW92ZXMgdGhlIEFDVElWRSBjbGFzcy5cbiAqL1xuZXhwb3J0cy5kZWFjdGl2YXRlID0gZnVuY3Rpb24gKHZpZXcsIGlkKSB7XG4gICAgcmV0dXJuIHV0aWxfMS5nZXRCeUlkKHZpZXcsIGlkKVxuICAgICAgICAubWFwKGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmNsYXNzTGlzdC5yZW1vdmUoZXhwb3J0cy5BQ1RJVkUpOyB9KTtcbn07XG4vKipcbiAqIGlzQWN0aXZlIGhlbHBkZXJcbiAqXG4gKiBRdWVyaWVzIHdoZXRoZXIgdGhlIEFDVElWRSBjbGFzcyBpcyBwcmVzZW50LlxuICovXG5leHBvcnRzLmlzQWN0aXZlID0gZnVuY3Rpb24gKHZpZXcsIGlkKSB7XG4gICAgcmV0dXJuIHV0aWxfMS5nZXRCeUlkKHZpZXcsIGlkKVxuICAgICAgICAubWFwKGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmNsYXNzTGlzdC5jb250YWlucyhleHBvcnRzLkFDVElWRSk7IH0pXG4gICAgICAgIC5vckp1c3QoZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0pXG4gICAgICAgIC5nZXQoKTtcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hY3RpdmUuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkRJU0FCTEVEID0gdm9pZCAwO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuLyoqXG4gKiBESVNBQkxFRFxuICovXG5leHBvcnRzLkRJU0FCTEVEID0gJy1kaXNhYmxlZCc7XG4vLy9jbGFzc05hbWVzOmVuZFxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZGlzYWJsZWQuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnRvZ2dsZSA9IGV4cG9ydHMuc2hvdyA9IGV4cG9ydHMuaGlkZSA9IGV4cG9ydHMuaXNIaWRkZW4gPSBleHBvcnRzLkhJRERFTiA9IHZvaWQgMDtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbFwiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbi8qKlxuICogSElEREVOIG1lYW5zIGFuIGVsZW1lbnQgc2hvdWxkIG5vdCBiZSB2aXNpYmxlIGJ1dCBub3QgcmVtb3ZlZFxuICogZnJvbSB0aGUgRE9NLlxuICovXG5leHBvcnRzLkhJRERFTiA9ICctd3ctaGlkZGVuJztcbi8qKlxuICogaXNIaWRkZW4gaGVscGVyLlxuICpcbiAqIFJldHJpZXZlcyBhbiBIVE1MRWxlbWVudCBieSBpZCBhbmQgY2hlY2tzIHdoZXRoZXJcbiAqIGl0IGhhcyB0aGUgaGlkZGVuIGNsYXNzIGF0dGFjaGVkLlxuICovXG5leHBvcnRzLmlzSGlkZGVuID0gZnVuY3Rpb24gKHZpZXcsIGlkKSB7XG4gICAgdmFyIG0gPSB2aWV3LmZpbmRCeUlkKGlkKTtcbiAgICBpZiAobS5pc05vdGhpbmcoKSkge1xuICAgICAgICB1dGlsXzEud2Fybk1pc3NpbmcodmlldywgaWQpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBtLmdldCgpLmNsYXNzTGlzdC5jb250YWlucyhleHBvcnRzLkhJRERFTik7XG4gICAgfVxufTtcbi8qKlxuICogaGlkZSBoZWxwZXIuXG4gKlxuICogQXR0ZW1wdHMgdG8gYWRkIEhJRERFTiB0byB0aGUgdGFyZ2V0IGVsZW1lbnRzIGNsYXNzIG5hbWUuXG4gKi9cbmV4cG9ydHMuaGlkZSA9IGZ1bmN0aW9uICh2aWV3LCBpZCkge1xuICAgIHZhciBtID0gdmlldy5maW5kQnlJZChpZCk7XG4gICAgaWYgKG0uaXNOb3RoaW5nKCkpIHtcbiAgICAgICAgcmV0dXJuIHV0aWxfMS53YXJuTWlzc2luZyh2aWV3LCBpZCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB2YXIgZSA9IG0uZ2V0KCk7XG4gICAgICAgIGUuY2xhc3NMaXN0LnJlbW92ZShleHBvcnRzLkhJRERFTik7XG4gICAgICAgIGUuY2xhc3NMaXN0LmFkZChleHBvcnRzLkhJRERFTik7XG4gICAgfVxufTtcbi8qKlxuICogc2hvdyBoZWxwZXIuXG4gKlxuICogQXR0ZW1wdHMgdG8gcmVtb3ZlIHRoZSBISURERU4gY2xhc3MgbmFtZSBmcm9tIHRoZSB0YXJnZXQgZWxlbWVudC5cbiAqL1xuZXhwb3J0cy5zaG93ID0gZnVuY3Rpb24gKHZpZXcsIGlkKSB7XG4gICAgdmFyIG0gPSB2aWV3LmZpbmRCeUlkKGlkKTtcbiAgICBpZiAobS5pc05vdGhpbmcoKSkge1xuICAgICAgICByZXR1cm4gdXRpbF8xLndhcm5NaXNzaW5nKHZpZXcsIGlkKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG0uZ2V0KCkuY2xhc3NMaXN0LnJlbW92ZShleHBvcnRzLkhJRERFTik7XG4gICAgfVxufTtcbi8qKlxuICogdG9nZ2xlIGhlbHBlci5cbiAqXG4gKiBBdHRlbXB0cyB0byB0b2dnbGUgdGhlIEhJRERFTiBjbGFzcyBuYW1lIGZyb20gdGhlIHRhcmdldCBlbGVtZW50XG4gKiBjbGFzc0xpc3QuXG4gKi9cbmV4cG9ydHMudG9nZ2xlID0gZnVuY3Rpb24gKHZpZXcsIGlkKSB7XG4gICAgdmFyIG0gPSB2aWV3LmZpbmRCeUlkKGlkKTtcbiAgICBpZiAobS5pc05vdGhpbmcoKSkge1xuICAgICAgICByZXR1cm4gdXRpbF8xLndhcm5NaXNzaW5nKHZpZXcsIGlkKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG0uZ2V0KCkuY2xhc3NMaXN0LnRvZ2dsZShleHBvcnRzLkhJRERFTik7XG4gICAgfVxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWhpZGRlbi5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0U3R5bGVDbGFzc05hbWUgPSBleHBvcnRzLnN0eWxlcyA9IGV4cG9ydHMuU3R5bGUgPSBleHBvcnRzLk9VVExJTkUgPSBleHBvcnRzLkVSUk9SID0gZXhwb3J0cy5XQVJOSU5HID0gZXhwb3J0cy5JTkZPID0gZXhwb3J0cy5TVUNDRVNTID0gZXhwb3J0cy5QUklNQVJZID0gZXhwb3J0cy5ERUZBVUxUID0gdm9pZCAwO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuLyoqXG4gKiBERUZBVUxUIHN0eWxlLlxuICovXG5leHBvcnRzLkRFRkFVTFQgPSAnLWRlZmF1bHQnO1xuLyoqXG4gKiBQUklNQVJZIHN0eWxlLlxuICovXG5leHBvcnRzLlBSSU1BUlkgPSAnLXByaW1hcnknO1xuLyoqXG4gKiBTVUNDRVNTIHN0eWxlLlxuICovXG5leHBvcnRzLlNVQ0NFU1MgPSAnLXN1Y2Nlc3MnO1xuLyoqXG4gKiBJTkZPIHN0eWxlLlxuICovXG5leHBvcnRzLklORk8gPSAnLWluZm8nO1xuLyoqXG4gKiBXQVJOSU5HIHN0eWxlLlxuICovXG5leHBvcnRzLldBUk5JTkcgPSAnLXdhcm5pbmcnO1xuLyoqXG4gKiBFUlJPUiBzdHlsZS5cbiAqL1xuZXhwb3J0cy5FUlJPUiA9ICctZXJyb3InO1xuLyoqXG4gKiBPVVRMSU5FIHN0eWxlLlxuICovXG5leHBvcnRzLk9VVExJTkUgPSAnLW91dGxpbmUnO1xuLy8vY2xhc3NOYW1lczplbmRcbi8qKlxuICogU3R5bGUgZW51bS5cbiAqL1xudmFyIFN0eWxlO1xuKGZ1bmN0aW9uIChTdHlsZSkge1xuICAgIFN0eWxlW1wiRGVmYXVsdFwiXSA9IFwiZGVmYXVsdFwiO1xuICAgIFN0eWxlW1wiUHJpbWFyeVwiXSA9IFwicHJpbWFyeVwiO1xuICAgIFN0eWxlW1wiU3VjY2Vzc1wiXSA9IFwic3VjY2Vzc1wiO1xuICAgIFN0eWxlW1wiSW5mb1wiXSA9IFwiaW5mb1wiO1xuICAgIFN0eWxlW1wiV2FybmluZ1wiXSA9IFwid2FybmluZ1wiO1xuICAgIFN0eWxlW1wiRXJyb3JcIl0gPSBcImVycm9yXCI7XG59KShTdHlsZSA9IGV4cG9ydHMuU3R5bGUgfHwgKGV4cG9ydHMuU3R5bGUgPSB7fSkpO1xuZXhwb3J0cy5zdHlsZXMgPSBbXG4gICAgU3R5bGUuRGVmYXVsdCxcbiAgICBTdHlsZS5TdWNjZXNzLFxuICAgIFN0eWxlLkluZm8sXG4gICAgU3R5bGUuV2FybmluZyxcbiAgICBTdHlsZS5FcnJvclxuXTtcbi8qKlxuICogZ2V0U3R5bGVDbGFzc05hbWVcbiAqL1xuZXhwb3J0cy5nZXRTdHlsZUNsYXNzTmFtZSA9IGZ1bmN0aW9uIChzKSB7XG4gICAgc3dpdGNoIChzKSB7XG4gICAgICAgIGNhc2UgU3R5bGUuRGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLkRFRkFVTFQ7XG4gICAgICAgIGNhc2UgU3R5bGUuUHJpbWFyeTpcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLlBSSU1BUlk7XG4gICAgICAgIGNhc2UgU3R5bGUuU3VjY2VzczpcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLlNVQ0NFU1M7XG4gICAgICAgIGNhc2UgU3R5bGUuSW5mbzpcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLklORk87XG4gICAgICAgIGNhc2UgU3R5bGUuV2FybmluZzpcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzLldBUk5JTkc7XG4gICAgICAgIGNhc2UgU3R5bGUuRXJyb3I6XG4gICAgICAgICAgICByZXR1cm4gZXhwb3J0cy5FUlJPUjtcbiAgICB9XG4gICAgcmV0dXJuIGV4cG9ydHMuREVGQVVMVDtcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5UYWcgPSBleHBvcnRzLlRBRyA9IGV4cG9ydHMuU3R5bGUgPSB2b2lkIDA7XG52YXIgZG9tXzEgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xudmFyIHdtbF8xID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgc3R5bGVfMSA9IHJlcXVpcmUoXCIuLi8uLi9jb250ZW50L3N0eWxlXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiU3R5bGVcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHN0eWxlXzEuU3R5bGU7IH0gfSk7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciB0YWdfMSA9IHJlcXVpcmUoXCIuL3dtbC90YWdcIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLlRBRyA9ICd3dy10YWcnO1xuLyoqXG4gKiBUYWdcbiAqL1xudmFyIFRhZyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVGFnLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFRhZygpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdGFnXzEuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgIGlkOiAndGFnJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlkOiBfXzEuZ2V0SWQoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuVEFHLCBfXzEuZ2V0Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSwgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnN0eWxlKSA/XG4gICAgICAgICAgICAgICAgc3R5bGVfMS5nZXRTdHlsZUNsYXNzTmFtZShfdGhpcy5hdHRycy53dy5zdHlsZSkgOlxuICAgICAgICAgICAgICAgIHN0eWxlXzEuREVGQVVMVCksXG4gICAgICAgICAgICBvbmNsaWNrOiBmdW5jdGlvbiAoXykge1xuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vbkNsaWNrKVxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vbkNsaWNrKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udGVudDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnRleHQpID9cbiAgICAgICAgICAgICAgICBbZG9tXzEudGV4dChfdGhpcy5hdHRycy53dy50ZXh0KV0gOiBfdGhpcy5jaGlsZHJlblxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBUYWc7XG59KHdtbF8xLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5UYWcgPSBUYWc7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdzcGFuJywgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy53bWwuaWQgfSwgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUsICdvbmNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5vbmNsaWNrIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQudmFsdWVzLmNvbnRlbnQpKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD10YWcuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ2FwdGlvbiA9IGV4cG9ydHMuVGh1bWJuYWlsID0gZXhwb3J0cy5USFVNQk5BSUxfQ0FQVElPTiA9IGV4cG9ydHMuVEhVTUJOQUlMID0gdm9pZCAwO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL3RodW1ibmFpbFwiKTtcbnZhciB3bWxfMSA9IHJlcXVpcmUoXCJAcXVlbmsvd21sXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLi8uLi9cIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLlRIVU1CTkFJTCA9ICd3dy10aHVtYm5haWwnO1xuZXhwb3J0cy5USFVNQk5BSUxfQ0FQVElPTiA9ICd3dy10aHVtYm5haWxfX2NhcHRpb24nO1xuLyoqXG4gKiBUaHVtYm5haWxcbiAqL1xudmFyIFRodW1ibmFpbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVGh1bWJuYWlsLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFRodW1ibmFpbCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuaHJlZikgP1xuICAgICAgICAgICAgbmV3IHZpZXdzLkFuY2hvcihfdGhpcykgOiBuZXcgdmlld3MuVGh1bWJuYWlsKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5USFVNQk5BSUwsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIGhyZWY6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5ocmVmKSA/XG4gICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuaHJlZiA6ICcnLFxuICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cub25DbGljaykge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uQ2xpY2soKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIFRodW1ibmFpbDtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLlRodW1ibmFpbCA9IFRodW1ibmFpbDtcbi8qKlxuICogQ2FwdGlvblxuICovXG52YXIgQ2FwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoQ2FwdGlvbiwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBDYXB0aW9uKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5DYXB0aW9uKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5USFVNQk5BSUxfQ0FQVElPTiwgX18xLmdldENsYXNzTmFtZShfdGhpcy5hdHRycykpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIENhcHRpb247XG59KHdtbF8xLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5DYXB0aW9uID0gQ2FwdGlvbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNhcHRpb24gPSBleHBvcnRzLkFuY2hvciA9IGV4cG9ydHMuVGh1bWJuYWlsID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgVGh1bWJuYWlsID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFRodW1ibmFpbChfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgnZGl2JywgeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSwgJ29uY2xpY2snOiBfX2NvbnRleHQudmFsdWVzLm9uY2xpY2sgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgVGh1bWJuYWlsLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgVGh1bWJuYWlsLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIFRodW1ibmFpbC5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIFRodW1ibmFpbC5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBUaHVtYm5haWwucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIFRodW1ibmFpbC5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBUaHVtYm5haWwucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIFRodW1ibmFpbC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBUaHVtYm5haWw7XG59KCkpO1xuZXhwb3J0cy5UaHVtYm5haWwgPSBUaHVtYm5haWw7XG47XG52YXIgQW5jaG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEFuY2hvcihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgnYScsIHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUsICdocmVmJzogX19jb250ZXh0LnZhbHVlcy5ocmVmLCAnb25jbGljayc6IF9fY29udGV4dC52YWx1ZXMub25jbGljayB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LmNoaWxkcmVuKSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBBbmNob3IucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBBbmNob3IucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgQW5jaG9yLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgQW5jaG9yLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIEFuY2hvci5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgQW5jaG9yLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIEFuY2hvci5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgQW5jaG9yLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIEFuY2hvcjtcbn0oKSk7XG5leHBvcnRzLkFuY2hvciA9IEFuY2hvcjtcbjtcbnZhciBDYXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENhcHRpb24oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgQ2FwdGlvbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIENhcHRpb24ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgQ2FwdGlvbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIENhcHRpb24ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgQ2FwdGlvbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgQ2FwdGlvbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBDYXB0aW9uLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBDYXB0aW9uLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIENhcHRpb247XG59KCkpO1xuZXhwb3J0cy5DYXB0aW9uID0gQ2FwdGlvbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXRodW1ibmFpbC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5CdXR0b25Hcm91cCA9IGV4cG9ydHMuQlVUVE9OX0dST1VQX0NPTVBBVCA9IGV4cG9ydHMuQlVUVE9OX0dST1VQX0JVVFRPTiA9IGV4cG9ydHMuQlVUVE9OX0dST1VQID0gdm9pZCAwO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL2J1dHRvbi1ncm91cFwiKTtcbnZhciB3bWxfMSA9IHJlcXVpcmUoXCJAcXVlbmsvd21sXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIHRvb2xiYXJfMSA9IHJlcXVpcmUoXCIuLi90b29sYmFyXCIpO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLi8uLi9cIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLkJVVFRPTl9HUk9VUCA9ICd3dy1idXR0b24tZ3JvdXAnO1xuZXhwb3J0cy5CVVRUT05fR1JPVVBfQlVUVE9OID0gJ3d3LWJ1dHRvbi1ncm91cF9fYnV0dG9uJztcbmV4cG9ydHMuQlVUVE9OX0dST1VQX0NPTVBBVCA9ICd3dy1idXR0b24tZ3JvdXAtY29tcGF0Jztcbi8qKlxuICogQnV0dG9uR3JvdXAgZ3JvdXBzIG11bHRpcGxlIGJ1dHRvbnMgaW50byBvbmUgZWxlbWVudC5cbiAqL1xudmFyIEJ1dHRvbkdyb3VwID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhCdXR0b25Hcm91cCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBCdXR0b25Hcm91cCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHJvb3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5CVVRUT05fR1JPVVAsIHRvb2xiYXJfMS5UT09MQkFSX0NPTVBBVCwgX18xLmdldENsYXNzTmFtZShfdGhpcy5hdHRycykpXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIEJ1dHRvbkdyb3VwO1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuQnV0dG9uR3JvdXAgPSBCdXR0b25Hcm91cDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5yb290LmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuY2xhc3NOYW1lIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQuY2hpbGRyZW4pKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1idXR0b24tZ3JvdXAuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTXVsdGlCdXR0b25TZWxlY3QgPSBleHBvcnRzLkJ1dHRvblNlbGVjdCA9IGV4cG9ydHMuTXVsdGlCdXR0b25TZWN0aW9uID0gZXhwb3J0cy5CdXR0b25TZWN0aW9uID0gZXhwb3J0cy5CdXR0b25TZWxlY3RWYWx1ZXMgPSBleHBvcnRzLkJ1dHRvbkNoYW5nZWRFdmVudCA9IGV4cG9ydHMuQlVUVE9OX1NFTEVDVF9PUFRJT04gPSBleHBvcnRzLkJVVFRPTl9TRUxFQ1QgPSB2b2lkIDA7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciBfXzIgPSByZXF1aXJlKFwiLi4vXCIpO1xudmFyIGJ1dHRvbl9zZWxlY3RfMSA9IHJlcXVpcmUoXCIuL3dtbC9idXR0b24tc2VsZWN0XCIpO1xuLy8vY2xhc3NOYW1lOmJlZ2luXG5leHBvcnRzLkJVVFRPTl9TRUxFQ1QgPSAnd3ctYnV0dG9uLXNlbGVjdCc7XG5leHBvcnRzLkJVVFRPTl9TRUxFQ1RfT1BUSU9OID0gJ3d3LWJ1dHRvbi1zZWxlY3RfX29wdGlvbic7XG4vKipcbiAqIEJ1dHRvbkNoYW5nZWRFdmVudFxuICovXG52YXIgQnV0dG9uQ2hhbmdlZEV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhCdXR0b25DaGFuZ2VkRXZlbnQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQnV0dG9uQ2hhbmdlZEV2ZW50KCkge1xuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgfVxuICAgIHJldHVybiBCdXR0b25DaGFuZ2VkRXZlbnQ7XG59KF9fMi5FdmVudCkpO1xuZXhwb3J0cy5CdXR0b25DaGFuZ2VkRXZlbnQgPSBCdXR0b25DaGFuZ2VkRXZlbnQ7XG4vKipcbiAqIEBwcml2YXRlXG4gKi9cbnZhciBCdXR0b25TZWxlY3RWYWx1ZXMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQnV0dG9uU2VsZWN0VmFsdWVzKHJlZiwgYnV0dG9uKSB7XG4gICAgICAgIHRoaXMucmVmID0gcmVmO1xuICAgICAgICB0aGlzLmJ1dHRvbiA9IGJ1dHRvbjtcbiAgICAgICAgdGhpcy5pZCA9IF9fMS5nZXRJZCh0aGlzLnJlZi5hdHRycyk7XG4gICAgICAgIHRoaXMuY2xhc3NOYW1lID0gdXRpbF8xLmNvbmNhdChleHBvcnRzLkJVVFRPTl9TRUxFQ1QsIF9fMS5nZXRDbGFzc05hbWUodGhpcy5yZWYuYXR0cnMpKTtcbiAgICB9XG4gICAgcmV0dXJuIEJ1dHRvblNlbGVjdFZhbHVlcztcbn0oKSk7XG5leHBvcnRzLkJ1dHRvblNlbGVjdFZhbHVlcyA9IEJ1dHRvblNlbGVjdFZhbHVlcztcbi8qKlxuICogQHByaXZhdGVcbiAqL1xudmFyIEJ1dHRvblNlY3Rpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQnV0dG9uU2VjdGlvbihyZWYsIG9uQ2xpY2spIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5yZWYgPSByZWY7XG4gICAgICAgIHRoaXMub25DbGljayA9IG9uQ2xpY2s7XG4gICAgICAgIHRoaXMuY3VycmVudCA9IGdldEN1cnJlbnQodGhpcy5yZWYuYXR0cnMpO1xuICAgICAgICB0aGlzLnNlbGVjdGVkID0gW107XG4gICAgICAgIHRoaXMub3B0aW9ucyA9ICh0aGlzLnJlZi5hdHRycy53dyAmJiB0aGlzLnJlZi5hdHRycy53dy5vcHRpb25zKSA/XG4gICAgICAgICAgICB0aGlzLnJlZi5hdHRycy53dy5vcHRpb25zIDogW107XG4gICAgICAgIHRoaXMuaXNBY3RpdmUgPSBmdW5jdGlvbiAobikgeyByZXR1cm4gX3RoaXMucmVmLnZhbHVlcy5idXR0b24uY3VycmVudCA9PT0gbjsgfTtcbiAgICAgICAgdGhpcy5nZXRDbGFzc05hbWVzID0gZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgICAgIHJldHVybiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuQlVUVE9OX1NFTEVDVF9PUFRJT04sIF90aGlzLnJlZi52YWx1ZXMuYnV0dG9uLm9wdGlvbnNbbl0uY2xhc3NOYW1lKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIEJ1dHRvblNlY3Rpb247XG59KCkpO1xuZXhwb3J0cy5CdXR0b25TZWN0aW9uID0gQnV0dG9uU2VjdGlvbjtcbi8qKlxuICogQHByaXZhdGVcbiAqL1xudmFyIE11bHRpQnV0dG9uU2VjdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTXVsdGlCdXR0b25TZWN0aW9uLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIE11bHRpQnV0dG9uU2VjdGlvbihyZWYsIG9uQ2xpY2spIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcmVmLCBvbkNsaWNrKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5yZWYgPSByZWY7XG4gICAgICAgIF90aGlzLm9uQ2xpY2sgPSBvbkNsaWNrO1xuICAgICAgICBfdGhpcy5zZWxlY3RlZCA9IGdldFNlbGVjdGVkKF90aGlzLnJlZik7XG4gICAgICAgIF90aGlzLmlzQWN0aXZlID0gZnVuY3Rpb24gKG4pIHsgcmV0dXJuIF90aGlzLnJlZi52YWx1ZXMuYnV0dG9uLnNlbGVjdGVkLmluZGV4T2YobikgPiAtMTsgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gTXVsdGlCdXR0b25TZWN0aW9uO1xufShCdXR0b25TZWN0aW9uKSk7XG5leHBvcnRzLk11bHRpQnV0dG9uU2VjdGlvbiA9IE11bHRpQnV0dG9uU2VjdGlvbjtcbi8qKlxuICogQnV0dG9uU2VsZWN0XG4gKi9cbnZhciBCdXR0b25TZWxlY3QgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEJ1dHRvblNlbGVjdCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBCdXR0b25TZWxlY3QoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IGJ1dHRvbl9zZWxlY3RfMS5CdXR0b25TZWxlY3RWaWV3KF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0gbmV3IEJ1dHRvblNlbGVjdFZhbHVlcyhfdGhpcywgbmV3IEJ1dHRvblNlY3Rpb24oX3RoaXMsIGZ1bmN0aW9uIChpZHgpIHtcbiAgICAgICAgICAgIF90aGlzLnZhbHVlcy5idXR0b24uY3VycmVudCA9IGlkeDtcbiAgICAgICAgICAgIGlmICgoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cub25DaGFuZ2UpKVxuICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uQ2hhbmdlKG5ldyBCdXR0b25DaGFuZ2VkRXZlbnQoX3RoaXMuYXR0cnMud3cubmFtZSwgX3RoaXMudmFsdWVzLmJ1dHRvbi5vcHRpb25zW2lkeF0udmFsdWUpKTtcbiAgICAgICAgICAgIF90aGlzLnZpZXcuaW52YWxpZGF0ZSgpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIEJ1dHRvblNlbGVjdDtcbn0oX18yLkFic3RyYWN0Q29udHJvbCkpO1xuZXhwb3J0cy5CdXR0b25TZWxlY3QgPSBCdXR0b25TZWxlY3Q7XG4vKipcbiAqIE11bHRpQnV0dG9uU2VsZWN0XG4gKi9cbnZhciBNdWx0aUJ1dHRvblNlbGVjdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTXVsdGlCdXR0b25TZWxlY3QsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTXVsdGlCdXR0b25TZWxlY3QoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IGJ1dHRvbl9zZWxlY3RfMS5CdXR0b25TZWxlY3RWaWV3KF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0gbmV3IEJ1dHRvblNlbGVjdFZhbHVlcyhfdGhpcywgbmV3IE11bHRpQnV0dG9uU2VjdGlvbihfdGhpcywgZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZCA9IF90aGlzLnZhbHVlcy5idXR0b24uc2VsZWN0ZWQ7XG4gICAgICAgICAgICB2YXIgcG9zID0gc2VsZWN0ZWQuaW5kZXhPZihuKTtcbiAgICAgICAgICAgIGlmIChwb3MgPiAtMSlcbiAgICAgICAgICAgICAgICBzZWxlY3RlZC5zcGxpY2UocG9zLCAxKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBzZWxlY3RlZC5wdXNoKG4pO1xuICAgICAgICAgICAgaWYgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm9uQ2hhbmdlKVxuICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uQ2hhbmdlKG5ldyBCdXR0b25DaGFuZ2VkRXZlbnQoX3RoaXMuYXR0cnMud3cubmFtZSwgc2VsZWN0ZWQubWFwKGZ1bmN0aW9uIChuKSB7IHJldHVybiBfdGhpcy52YWx1ZXMuYnV0dG9uLm9wdGlvbnNbbl0udmFsdWU7IH0pKSk7XG4gICAgICAgICAgICBfdGhpcy52aWV3LmludmFsaWRhdGUoKTtcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBNdWx0aUJ1dHRvblNlbGVjdDtcbn0oX18yLkFic3RyYWN0Q29udHJvbCkpO1xuZXhwb3J0cy5NdWx0aUJ1dHRvblNlbGVjdCA9IE11bHRpQnV0dG9uU2VsZWN0O1xudmFyIGdldEN1cnJlbnQgPSBmdW5jdGlvbiAoYXR0cnMpIHtcbiAgICBpZiAoKGF0dHJzLnd3ICE9IG51bGwpICYmXG4gICAgICAgIChhdHRycy53dy52YWx1ZSAhPSBudWxsKSAmJlxuICAgICAgICAoYXR0cnMud3cub3B0aW9ucyAhPSBudWxsKSkge1xuICAgICAgICByZXR1cm4gYXR0cnMud3cub3B0aW9ucy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMsIGspIHtcbiAgICAgICAgICAgIHJldHVybiBjLnZhbHVlID09PVxuICAgICAgICAgICAgICAgIGF0dHJzLnd3LnZhbHVlID8gayA6IHA7XG4gICAgICAgIH0sIC0xKTtcbiAgICB9XG4gICAgcmV0dXJuIC0xO1xufTtcbnZhciBnZXRTZWxlY3RlZCA9IGZ1bmN0aW9uICh0aGF0KSB7XG4gICAgaWYgKHRoYXQuYXR0cnMgJiZcbiAgICAgICAgdGhhdC5hdHRycy53dyAmJlxuICAgICAgICB0aGF0LmF0dHJzLnd3LnZhbHVlICYmXG4gICAgICAgIHRoYXQuYXR0cnMud3cub3B0aW9ucykge1xuICAgICAgICB2YXIgX2EgPSB0aGF0LmF0dHJzLnd3LCB2YWx1ZSA9IF9hLnZhbHVlLCBvcHRpb25zXzEgPSBfYS5vcHRpb25zO1xuICAgICAgICByZXR1cm4gdmFsdWUubWFwKGZ1bmN0aW9uICh2KSB7IHJldHVybiBvcHRpb25zXzEucmVkdWNlKGZ1bmN0aW9uIChwLCBjLCBpKSB7XG4gICAgICAgICAgICByZXR1cm4gKHAgPiAtMSkgPyBwIDogKGMudmFsdWUgPT09IHYpID8gaSA6IHA7XG4gICAgICAgIH0sIC0xKTsgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkJ1dHRvblNlbGVjdFZpZXcgPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGJ1dHRvbl9ncm91cF8xID0gcmVxdWlyZShcIi4uLy4uL2J1dHRvbi1ncm91cFwiKTtcbjtcbnZhciBidXR0b25fMSA9IHJlcXVpcmUoXCIuLi8uLi9idXR0b25cIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xuO1xudmFyIEJ1dHRvblNlbGVjdFZpZXcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQnV0dG9uU2VsZWN0VmlldyhfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBidXR0b25fZ3JvdXBfMS5CdXR0b25Hcm91cCh7IHd3OiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQsICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSB9IH0sIF9fc3ByZWFkQXJyYXlzKF9fZm9ySW4oX19jb250ZXh0LnZhbHVlcy5idXR0b24ub3B0aW9ucywgZnVuY3Rpb24gKG9wdCwgaWR4LCBfJCRhbGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgYnV0dG9uXzEuQnV0dG9uKHsgd3c6IHsgJ2NsYXNzTmFtZSc6IF9fY29udGV4dC52YWx1ZXMuYnV0dG9uLmdldENsYXNzTmFtZXMoaWR4KSwgJ2FjdGl2ZSc6IF9fY29udGV4dC52YWx1ZXMuYnV0dG9uLmlzQWN0aXZlKGlkeCksICdvbkNsaWNrJzogZnVuY3Rpb24gKCkgeyByZXR1cm4gX19jb250ZXh0LnZhbHVlcy5idXR0b24ub25DbGljayhpZHgpOyB9LCAndGV4dCc6IG9wdC50ZXh0IH0gfSwgW10pLCB7IHd3OiB7ICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmJ1dHRvbi5nZXRDbGFzc05hbWVzKGlkeCksICdhY3RpdmUnOiBfX2NvbnRleHQudmFsdWVzLmJ1dHRvbi5pc0FjdGl2ZShpZHgpLCAnb25DbGljayc6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF9fY29udGV4dC52YWx1ZXMuYnV0dG9uLm9uQ2xpY2soaWR4KTsgfSwgJ3RleHQnOiBvcHQudGV4dCB9IH0pXG4gICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7IHJldHVybiAoW10pOyB9KSkpLCB7IHd3OiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQsICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSB9IH0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBCdXR0b25TZWxlY3RWaWV3LnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgQnV0dG9uU2VsZWN0Vmlldy5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBCdXR0b25TZWxlY3RWaWV3LnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgQnV0dG9uU2VsZWN0Vmlldy5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBCdXR0b25TZWxlY3RWaWV3LnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBCdXR0b25TZWxlY3RWaWV3LnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIEJ1dHRvblNlbGVjdFZpZXcucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIEJ1dHRvblNlbGVjdFZpZXcucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gQnV0dG9uU2VsZWN0Vmlldztcbn0oKSk7XG5leHBvcnRzLkJ1dHRvblNlbGVjdFZpZXcgPSBCdXR0b25TZWxlY3RWaWV3O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YnV0dG9uLXNlbGVjdC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5CdXR0b24gPSBleHBvcnRzLkJ1dHRvbkNsaWNrZWRFdmVudCA9IGV4cG9ydHMuQlVUVE9OID0gZXhwb3J0cy5TdHlsZSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9idXR0b25cIik7XG52YXIgZG9tXzEgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xudmFyIHRvb2xiYXJfMSA9IHJlcXVpcmUoXCIuLi90b29sYmFyXCIpO1xudmFyIGFjdGl2ZV8xID0gcmVxdWlyZShcIi4uLy4uL2NvbnRlbnQvc3RhdGUvYWN0aXZlXCIpO1xudmFyIG9yaWVudGF0aW9uXzEgPSByZXF1aXJlKFwiLi4vLi4vY29udGVudC9vcmllbnRhdGlvblwiKTtcbnZhciBzdHlsZV8xID0gcmVxdWlyZShcIi4uLy4uL2NvbnRlbnQvc3R5bGVcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJTdHlsZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc3R5bGVfMS5TdHlsZTsgfSB9KTtcbnZhciBzaXplXzEgPSByZXF1aXJlKFwiLi4vLi4vY29udGVudC9zaXplXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLi8uLi9cIik7XG52YXIgX18yID0gcmVxdWlyZShcIi4uL1wiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuQlVUVE9OID0gJ3d3LWJ1dHRvbic7XG47XG4vKipcbiAqIEJ1dHRvbkNsaWNrZWRFdmVudFxuICovXG52YXIgQnV0dG9uQ2xpY2tlZEV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhCdXR0b25DbGlja2VkRXZlbnQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQnV0dG9uQ2xpY2tlZEV2ZW50KCkge1xuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgfVxuICAgIHJldHVybiBCdXR0b25DbGlja2VkRXZlbnQ7XG59KF9fMi5FdmVudCkpO1xuZXhwb3J0cy5CdXR0b25DbGlja2VkRXZlbnQgPSBCdXR0b25DbGlja2VkRXZlbnQ7XG4vKipcbiAqIEJ1dHRvbiBpcyBhbiBpbXByb3ZlbWVudCBvdmVyIEhUTUxCdXR0aW9uRWxlbWVudFxuICovXG52YXIgQnV0dG9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhCdXR0b24sIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQnV0dG9uKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5hbmNob3IpID9cbiAgICAgICAgICAgIG5ldyB2aWV3cy5BbmNob3JWaWV3KF90aGlzKSA6IG5ldyB2aWV3cy5CdXR0b25WaWV3KF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgYnV0dG9uOiB7XG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnYnV0dG9uJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuQlVUVE9OLCBfXzEuZ2V0Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSwgdG9vbGJhcl8xLlRPT0xCQVJfQ09NUEFULCAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuc3R5bGUpID9cbiAgICAgICAgICAgICAgICAgICAgc3R5bGVfMS5nZXRTdHlsZUNsYXNzTmFtZShfdGhpcy5hdHRycy53dy5zdHlsZSkgOlxuICAgICAgICAgICAgICAgICAgICBzdHlsZV8xLkRFRkFVTFQsIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5zaXplKSA/XG4gICAgICAgICAgICAgICAgICAgIHNpemVfMS5nZXRTaXplQ2xhc3NOYW1lKF90aGlzLmF0dHJzLnd3LnNpemUpIDogJycsIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vdXRsaW5lKSA/XG4gICAgICAgICAgICAgICAgICAgIHN0eWxlXzEuT1VUTElORSA6ICcnLCAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuYmxvY2spID9cbiAgICAgICAgICAgICAgICAgICAgb3JpZW50YXRpb25fMS5CTE9DSyA6ICcnLCAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuYWN0aXZlKSA/XG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZV8xLkFDVElWRSA6ICcnKSxcbiAgICAgICAgICAgICAgICB0eXBlOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cudHlwZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy50eXBlIDogJ2J1dHRvbicsXG4gICAgICAgICAgICAgICAgbmFtZTogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm5hbWUpID8gX3RoaXMuYXR0cnMud3cubmFtZSA6ICcnLFxuICAgICAgICAgICAgICAgIGRpc2FibGVkOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZGlzYWJsZWQpID8gdHJ1ZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgYW5jaG9yOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuYW5jaG9yKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmFuY2hvciA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIG9uY2xpY2s6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uQ2xpY2sgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uQ2xpY2sobmV3IEJ1dHRvbkNsaWNrZWRFdmVudCgoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cubmFtZSkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm5hbWUgOiAnJywgX3RoaXMuYXR0cnMud3cudmFsdWUpKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy50ZXh0KSA/XG4gICAgICAgICAgICAgICAgICAgIFtkb21fMS50ZXh0KF90aGlzLmF0dHJzLnd3LnRleHQpXSA6IF90aGlzLmNoaWxkcmVuOyB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogZGlzYWJsZSB0aGlzIGJ1dHRvbi5cbiAgICAgKi9cbiAgICBCdXR0b24ucHJvdG90eXBlLmRpc2FibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHV0aWxfMS5nZXRCeUlkKHRoaXMudmlldywgdGhpcy52YWx1ZXMuYnV0dG9uLndtbC5pZClcbiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGIpIHsgcmV0dXJuIGIuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpOyB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGVuYWJsZSB0aGlzIGJ1dHRvbi5cbiAgICAgKi9cbiAgICBCdXR0b24ucHJvdG90eXBlLmVuYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdXRpbF8xLmdldEJ5SWQodGhpcy52aWV3LCB0aGlzLnZhbHVlcy5idXR0b24ud21sLmlkKVxuICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoYikgeyByZXR1cm4gYi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7IH0pO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogdG9nZ2xlIHRoZSBkaXNhYmxlZCBzdGF0ZSBvZiB0aGlzIGJ1dHRvbi5cbiAgICAgKi9cbiAgICBCdXR0b24ucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdXRpbF8xLmdldEJ5SWQodGhpcy52aWV3LCB0aGlzLnZhbHVlcy5idXR0b24ud21sLmlkKVxuICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoYikgeyByZXR1cm4gYi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykgP1xuICAgICAgICAgICAgX3RoaXMuZW5hYmxlKCkgOiBfdGhpcy5kaXNhYmxlKCk7IH0pO1xuICAgIH07XG4gICAgcmV0dXJuIEJ1dHRvbjtcbn0oX18yLkFic3RyYWN0Q29udHJvbCkpO1xuZXhwb3J0cy5CdXR0b24gPSBCdXR0b247XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5BbmNob3JWaWV3ID0gZXhwb3J0cy5CdXR0b25WaWV3ID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgQnV0dG9uVmlldyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBCdXR0b25WaWV3KF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdidXR0b24nLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmJ1dHRvbi53bWwuaWQgfSwgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5idXR0b24uaWQsICd0eXBlJzogX19jb250ZXh0LnZhbHVlcy5idXR0b24udHlwZSwgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmJ1dHRvbi5uYW1lLCAnZGlzYWJsZWQnOiBfX2NvbnRleHQudmFsdWVzLmJ1dHRvbi5kaXNhYmxlZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5idXR0b24uY2xhc3NOYW1lLCAnb25jbGljayc6IF9fY29udGV4dC52YWx1ZXMuYnV0dG9uLm9uY2xpY2sgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC52YWx1ZXMuYnV0dG9uLmNvbnRlbnQoKSkpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgQnV0dG9uVmlldy5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIEJ1dHRvblZpZXcucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgQnV0dG9uVmlldy5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIEJ1dHRvblZpZXcucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgQnV0dG9uVmlldy5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgQnV0dG9uVmlldy5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBCdXR0b25WaWV3LnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBCdXR0b25WaWV3LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIEJ1dHRvblZpZXc7XG59KCkpO1xuZXhwb3J0cy5CdXR0b25WaWV3ID0gQnV0dG9uVmlldztcbjtcbnZhciBBbmNob3JWaWV3ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEFuY2hvclZpZXcoX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2EnLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmJ1dHRvbi53bWwuaWQgfSwgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5idXR0b24uaWQsICd0eXBlJzogX19jb250ZXh0LnZhbHVlcy5idXR0b24udHlwZSwgJ2hyZWYnOiAnIycsICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5idXR0b24ubmFtZSwgJ2Rpc2FibGVkJzogX19jb250ZXh0LnZhbHVlcy5idXR0b24uZGlzYWJsZWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuYnV0dG9uLmNsYXNzTmFtZSwgJ29uY2xpY2snOiBfX2NvbnRleHQudmFsdWVzLmJ1dHRvbi5vbmNsaWNrIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQudmFsdWVzLmJ1dHRvbi5jb250ZW50KCkpKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIEFuY2hvclZpZXcucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBBbmNob3JWaWV3LnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIEFuY2hvclZpZXcucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBBbmNob3JWaWV3LnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIEFuY2hvclZpZXcucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIEFuY2hvclZpZXcucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgQW5jaG9yVmlldy5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgQW5jaG9yVmlldy5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBBbmNob3JWaWV3O1xufSgpKTtcbmV4cG9ydHMuQW5jaG9yVmlldyA9IEFuY2hvclZpZXc7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1idXR0b24uanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ2hlY2tib3ggPSBleHBvcnRzLkNoZWNrQ2hhbmdlZEV2ZW50ID0gZXhwb3J0cy5DSEVDS0JPWCA9IHZvaWQgMDtcbnZhciBjaGVja2JveF8xID0gcmVxdWlyZShcIi4vd21sL2NoZWNrYm94XCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLi9cIik7XG52YXIgX18yID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuQ0hFQ0tCT1ggPSAnd3ctY2hlY2tib3gnO1xuLyoqXG4gKiBDaGVja0NoYW5nZWRFdmVudCBzaWduYWxzIHRoZSB1c2VyIGhhcyBjaGFuZ2VkIHRoZSBjaGVja2JveCBzdGF0ZS5cbiAqL1xudmFyIENoZWNrQ2hhbmdlZEV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhDaGVja0NoYW5nZWRFdmVudCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBDaGVja0NoYW5nZWRFdmVudCgpIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gQ2hlY2tDaGFuZ2VkRXZlbnQ7XG59KF9fMS5FdmVudCkpO1xuZXhwb3J0cy5DaGVja0NoYW5nZWRFdmVudCA9IENoZWNrQ2hhbmdlZEV2ZW50O1xuLyoqXG4gKiBDaGVja2JveCBjb250cm9sLlxuICpcbiAqIFRoaXMgaXMgYW4gYWx0ZXJuYXRpdmUgdG8gdGhlIG5hdGl2ZSBjaGVja2JveCB0aGF0IGNhbiBiZSBzdHlsZWQuXG4gKi9cbnZhciBDaGVja2JveCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoQ2hlY2tib3gsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQ2hlY2tib3goKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IGNoZWNrYm94XzEuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHJvb3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogX18yLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5DSEVDS0JPWCwgX18yLmdldENsYXNzTmFtZShfdGhpcy5hdHRycykpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5wdXQ6IHtcbiAgICAgICAgICAgICAgICBuYW1lOiBfXzEuZ2V0TmFtZShfdGhpcy5hdHRycyksXG4gICAgICAgICAgICAgICAgdmFsdWU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy52YWx1ZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy52YWx1ZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMudmFsdWVzLmlucHV0LnZhbHVlID0gKCFfdGhpcy52YWx1ZXMuaW5wdXQudmFsdWUpIHx8IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vbkNoYW5nZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uQ2hhbmdlKG5ldyBDaGVja0NoYW5nZWRFdmVudChfdGhpcy52YWx1ZXMuaW5wdXQubmFtZSwgX3RoaXMudmFsdWVzLmlucHV0LnZhbHVlIHx8IGZhbHNlKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBDaGVja2JveDtcbn0oX18xLkFic3RyYWN0Q29udHJvbCkpO1xuZXhwb3J0cy5DaGVja2JveCA9IENoZWNrYm94O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheXMgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXlzKSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcbiAgICAgICAgICAgIHJba10gPSBhW2pdO1xuICAgIHJldHVybiByO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgnc3BhbicsIHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5yb290LmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuY2xhc3NOYW1lIH0sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnbGFiZWwnLCB7fSwgX19zcHJlYWRBcnJheXMoW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnaW5wdXQnLCB7ICd0eXBlJzogJ2NoZWNrYm94JywgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0Lm5hbWUsICdjaGVja2VkJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC52YWx1ZSwgJ29uY2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC5vbkNoYW5nZSB9LCBbXSlcbiAgICAgICAgICAgICAgICBdLCAoX19jb250ZXh0LmNoaWxkcmVuKSkpXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNoZWNrYm94LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNsb3NlQnV0dG9uID0gZXhwb3J0cy5DTE9TRV9CVVRUT04gPSB2b2lkIDA7XG52YXIgd21sXzEgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbFwiKTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbFwiKTtcbnZhciBfXzEgPSByZXF1aXJlKFwiLi4vLi4vXCIpO1xudmFyIGNsb3NlX2J1dHRvbl8xID0gcmVxdWlyZShcIi4vd21sL2Nsb3NlLWJ1dHRvblwiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuQ0xPU0VfQlVUVE9OID0gJ3d3LWNsb3NlLWJ1dHRvbic7XG47XG4vKipcbiAqIENsb3NlQnV0dG9uIHVzZWQgdG8gZGlzcGxheSB0aGUgXCJ4XCIgb24gZGlhbG9ncyBldGMuXG4gKi9cbnZhciBDbG9zZUJ1dHRvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoQ2xvc2VCdXR0b24sIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQ2xvc2VCdXR0b24oKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IGNsb3NlX2J1dHRvbl8xLk1haW4oX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLkNMT1NFX0JVVFRPTiwgX18xLmdldENsYXNzTmFtZShfdGhpcy5hdHRycykpLFxuICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgaWQ6ICdjbG9zZS1idXR0b24nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vbkNsaWNrKVxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vbkNsaWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIENsb3NlQnV0dG9uO1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuQ2xvc2VCdXR0b24gPSBDbG9zZUJ1dHRvbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBjbG9zZV8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NvbnRlbnQvY2xvc2VcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgnYnV0dG9uJywgeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSwgJ29uY2xpY2snOiBfX2NvbnRleHQudmFsdWVzLm9uY2xpY2sgfSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGNsb3NlXzEuQ2xvc2Uoe30sIFtdKSwge30pXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNsb3NlLWJ1dHRvbi5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkRhdGVGaWVsZCA9IGV4cG9ydHMuRGF0ZUNoYW5nZWRFdmVudCA9IGV4cG9ydHMuRm9ybWF0ID0gZXhwb3J0cy51c0Zvcm1hdHMgPSBleHBvcnRzLmNvbW1vbkZvcm1hdHMgPSBleHBvcnRzLmlzbzg2MDFGb3JtYXRzID0gZXhwb3J0cy5ZRVNURVJEQVkgPSBleHBvcnRzLk5PVyA9IGV4cG9ydHMuVE9EQVkgPSBleHBvcnRzLkRFTEFZID0gZXhwb3J0cy5WQUxVRV9GT1JNQVQgPSBleHBvcnRzLkRFRkFVTFRfSU5QVVRfRElTUExBWSA9IGV4cG9ydHMuREVGQVVMVF9JTlBVVF9QTEFDRUhPTERFUiA9IGV4cG9ydHMuREVGQVVMVF9JTlBVVF9GT1JNQVQgPSBleHBvcnRzLkRBVEVfRklFTERfSU5QVVQgPSBleHBvcnRzLkRBVEVfRklFTEQgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvZGF0ZS1maWVsZFwiKTtcbnZhciBtb21lbnQgPSByZXF1aXJlKFwibW9tZW50XCIpO1xudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgZmVlZGJhY2tfMSA9IHJlcXVpcmUoXCIuLi9mZWVkYmFja1wiKTtcbnZhciBmb3JtXzEgPSByZXF1aXJlKFwiLi4vZm9ybVwiKTtcbnZhciBfXzEgPSByZXF1aXJlKFwiLi4vLi4vXCIpO1xudmFyIF9fMiA9IHJlcXVpcmUoXCIuLi9cIik7XG52YXIgb3JpZW50YXRpb25fMSA9IHJlcXVpcmUoXCIuLi8uLi9jb250ZW50L29yaWVudGF0aW9uXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5EQVRFX0ZJRUxEID0gJ3d3LWRhdGUtZmllbGQnO1xuZXhwb3J0cy5EQVRFX0ZJRUxEX0lOUFVUID0gJ3d3LWRhdGUtZmllbGRfX2lucHV0Jztcbi8vL2NsYXNzTmFtZXM6ZW5kXG5leHBvcnRzLkRFRkFVTFRfSU5QVVRfRk9STUFUID0gbW9tZW50LklTT184NjAxO1xuZXhwb3J0cy5ERUZBVUxUX0lOUFVUX1BMQUNFSE9MREVSID0gJ1lZWVktTU0tREQnO1xuZXhwb3J0cy5ERUZBVUxUX0lOUFVUX0RJU1BMQVkgPSAnWVlZWS1NTS1ERCc7XG5leHBvcnRzLlZBTFVFX0ZPUk1BVCA9ICdZWVlZLU1NLUREJztcbmV4cG9ydHMuREVMQVkgPSAyMDA7XG5leHBvcnRzLlRPREFZID0gJ3RvZGF5JztcbmV4cG9ydHMuTk9XID0gJ25vdyc7XG5leHBvcnRzLllFU1RFUkRBWSA9ICd5ZXN0ZXJkYXknO1xuZXhwb3J0cy5pc284NjAxRm9ybWF0cyA9IFtcbiAgICAnWVlZWS1NTS1ERCcsXG4gICAgJ1lZWVktTU0tRCcsXG4gICAgJ1lZWVktTS1ERCcsXG4gICAgJ1lZWVktTS1EJyxcbiAgICAnWVktTU0tREQnLFxuICAgICdZWS1NTS1EJyxcbiAgICAnWVktTS1ERCcsXG4gICAgJ1lZLU0tRCcsXG4gICAgJ1lZWVkvTU0vREQnLFxuICAgICdZWVlZL01NL0QnLFxuICAgICdZWVlZL00vREQnLFxuICAgICdZWVlZL00vRCcsXG4gICAgJ1lZL01NL0REJyxcbiAgICAnWVkvTU0vRCcsXG4gICAgJ1lZL00vREQnLFxuICAgICdZWS9NL0QnLFxuICAgICdZWVlZIE1NIEREJyxcbiAgICAnWVlZWSBNTSBEJyxcbiAgICAnWVlZWSBNIEREJyxcbiAgICAnWVlZWSBNIEQnLFxuICAgICdZWSBNTSBERCcsXG4gICAgJ1lZIE1NIEQnLFxuICAgICdZWSBNIEREJyxcbiAgICAnWVkgTSBEJyxcbiAgICAnWVlZWU1NREQnLFxuICAgICdZWVlZTU1EJyxcbiAgICAnWVlZWU1ERCcsXG4gICAgJ1lZWVlNRCcsXG4gICAgJ1lZTU1ERCcsXG4gICAgJ1lZTU1EJyxcbiAgICAnWVlNREQnLFxuICAgICdZWU1EJyxcbl07XG5leHBvcnRzLmNvbW1vbkZvcm1hdHMgPSBbXG4gICAgJ0RELU1NLVlZWVknLFxuICAgICdELU1NLVlZWVknLFxuICAgICdERC1NLVlZWVknLFxuICAgICdELU0tWVlZWScsXG4gICAgJ0RELU1NLVlZJyxcbiAgICAnRC1NTS1ZWScsXG4gICAgJ0RELU0tWVknLFxuICAgICdELU0tWVknLFxuICAgICdERC9NTS9ZWVlZJyxcbiAgICAnRC9NTS9ZWVlZJyxcbiAgICAnREQvTS9ZWVlZJyxcbiAgICAnRC9NL1lZWVknLFxuICAgICdERC9NTS9ZWScsXG4gICAgJ0QvTU0vWVknLFxuICAgICdERC9NL1lZJyxcbiAgICAnRC9NL1lZJyxcbiAgICAnREQgTU0gWVlZWScsXG4gICAgJ0QgTU0gWVlZWScsXG4gICAgJ0REIE0gWVlZWScsXG4gICAgJ0QgTSBZWVlZJyxcbiAgICAnREQgTU0gWVknLFxuICAgICdEIE1NIFlZJyxcbiAgICAnREQgTSBZWScsXG4gICAgJ0QgTSBZWScsXG4gICAgJ0RETU1ZWVlZJyxcbiAgICAnRE1NWVlZWScsXG4gICAgJ0RETVlZWVknLFxuICAgICdETVlZWVknLFxuICAgICdERE1NWVknLFxuICAgICdETU1ZWScsXG4gICAgJ0RETVlZJyxcbiAgICAnRE1ZWScsXG5dO1xuZXhwb3J0cy51c0Zvcm1hdHMgPSBbXG4gICAgJ01NLURELVlZWVknLFxuICAgICdNTS1ELVlZWVknLFxuICAgICdNLURELVlZWVknLFxuICAgICdNLUQtWVlZWScsXG4gICAgJ01NLURELVlZJyxcbiAgICAnTU0tRC1ZWScsXG4gICAgJ00tREQtWVknLFxuICAgICdNLUQtWVknLFxuICAgICdNTS9ERC9ZWVlZJyxcbiAgICAnTU0vRC9ZWVlZJyxcbiAgICAnTS9ERC9ZWVlZJyxcbiAgICAnTS9EL1lZWVknLFxuICAgICdNTS9ERC9ZWScsXG4gICAgJ01NL0QvWVknLFxuICAgICdNL0REL1lZJyxcbiAgICAnTS9EL1lZJyxcbiAgICAnTU0gREQgWVlZWScsXG4gICAgJ01NIEQgWVlZWScsXG4gICAgJ00gREQgWVlZWScsXG4gICAgJ00gRCBZWVlZJyxcbiAgICAnTU0gREQgWVknLFxuICAgICdNTSBEIFlZJyxcbiAgICAnTSBERCBZWScsXG4gICAgJ00gRCBZWScsXG4gICAgJ01NRERZWVlZJyxcbiAgICAnTU1EWVlZWScsXG4gICAgJ01ERFlZWVknLFxuICAgICdNRFlZWVknLFxuICAgICdNTUREWVknLFxuICAgICdNTURZWScsXG4gICAgJ01ERFlZJyxcbiAgICAnTURZWScsXG5dO1xuLyoqXG4gKiBGb3JtYXQgaXMgdXNlZCB0byBkZXRlcm1pbmUgd2hhdCBmb3JtYXQgaW5wdXQgc2hvdWxkIGJlIHBhcnNlZCBhcy5cbiAqL1xudmFyIEZvcm1hdDtcbihmdW5jdGlvbiAoRm9ybWF0KSB7XG4gICAgRm9ybWF0W0Zvcm1hdFtcIklTTzg2MDFcIl0gPSAxXSA9IFwiSVNPODYwMVwiO1xuICAgIEZvcm1hdFtGb3JtYXRbXCJDT01NT05cIl0gPSAyXSA9IFwiQ09NTU9OXCI7XG4gICAgRm9ybWF0W0Zvcm1hdFtcIlVTQVwiXSA9IDNdID0gXCJVU0FcIjtcbn0pKEZvcm1hdCA9IGV4cG9ydHMuRm9ybWF0IHx8IChleHBvcnRzLkZvcm1hdCA9IHt9KSk7XG4vKipcbiAqIERhdGVDaGFuZ2VkRXZlbnQgaXMgZ2VuZXJhdGVkIHdoZW4gYSB2YWxpZCBkYXRlIGhhcyBiZWVuIGVudGVyZWQuXG4gKlxuICogVGhlIHZhbHVlIGlzIGEgdHJ1bmNhdGVkIElTTzg2MDEgc3RyaW5nIGNvbnNpc3Rpbmcgb2YgdGhlIGRhdGUgcGFydCBhbG9uZS5cbiAqL1xudmFyIERhdGVDaGFuZ2VkRXZlbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKERhdGVDaGFuZ2VkRXZlbnQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gRGF0ZUNoYW5nZWRFdmVudCgpIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gRGF0ZUNoYW5nZWRFdmVudDtcbn0oX18yLkV2ZW50KSk7XG5leHBvcnRzLkRhdGVDaGFuZ2VkRXZlbnQgPSBEYXRlQ2hhbmdlZEV2ZW50O1xuLyoqXG4gKiBEYXRlRmllbGQgcHJvdmlkZXMgYSB0ZXh0IGZpZWxkIGZvciBlbnRlcmluZyBkYXRlcy5cbiAqXG4gKiBJdCB3aWxsIG9ubHkgZmlyZSBjaGFuZ2UgZXZlbnRzIHdoZW4gdGhlIGRhdGUgaW5wdXQgbWF0Y2hlcyBvbmVcbiAqIG9mIHRoZSAzIGZvcm1hdCBzZXRzIChJU084NjAxLENvbW1vbixVUykuXG4gKlxuICogSWYgdGhlIHVzZXIgcmVtb3ZlcyBmb2N1cyBhbmQgdGhlIGVudHJ5IGlzIG5vdCB2YWxpZCwgaXQgd2lsbCBiZSBpZ25vcmVkXG4gKiBhbmQgbm8gY2hhbmdlIGV2ZW50IHdpbGwgYmUgZmlyZWQuIE9uY2UgYSB2YWxpZCBkYXRlIGhhcyBiZWVuIGVudGVyZWQsXG4gKiB0aGUgdmFsdWUgZGlzcGxheWVkIGNhbiBiZSBmb3JtYXRlZCB1c2luZyB0aGUgZm9ybWF0IHNwZWNpZmllZCBpbiB0aGVcbiAqIFwiZGlzcGxheVwiIGF0dHJpYnV0ZS4gVGhpcyBkb2VzIG5vdCBhZmZlY3QgdGhlIGFjdHVhbCB2YWx1ZSBwcm92aWRlZFxuICogdG8gb25DaGFuZ2UgaGFuZGxlcnMuXG4gKi9cbnZhciBEYXRlRmllbGQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKERhdGVGaWVsZCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBEYXRlRmllbGQoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4oX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICByb290OiB7XG4gICAgICAgICAgICAgICAgd21sOiB7IGlkOiAncm9vdCcgfSxcbiAgICAgICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5EQVRFX0ZJRUxELCBfXzEuZ2V0Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSwgb3JpZW50YXRpb25fMS5nZXRCbG9ja0NsYXNzTmFtZShfdGhpcy5hdHRycyksIGZlZWRiYWNrXzEuZ2V0VmFsaWRpdHlDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250cm9sOiB7XG4gICAgICAgICAgICAgICAgd21sOiB7IGlkOiAnaW5wdXQnIH0sXG4gICAgICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycylcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgICAgIGlkOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cubmFtZSkgfHwgJycsXG4gICAgICAgICAgICAgICAgdGV4dDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmxhYmVsKSB8fCAnJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnbWVzc2FnZXMnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0ZXh0OiBmZWVkYmFja18xLmdldE1lc3NhZ2UoX3RoaXMuYXR0cnMpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5wdXQ6IHtcbiAgICAgICAgICAgICAgICB3bWw6IHsgaWQ6ICdpbnB1dCcgfSxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IGV4cG9ydHMuREFURV9GSUVMRF9JTlBVVCxcbiAgICAgICAgICAgICAgICBuYW1lOiBfXzIuZ2V0TmFtZShfdGhpcy5hdHRycyksXG4gICAgICAgICAgICAgICAgZm9ybWF0OiBnZXRGb3JtYXQoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBnZXRQbGFjZWhvbGRlcihfdGhpcy5hdHRycyksXG4gICAgICAgICAgICAgICAgZGlzcGxheTogZ2V0RGlzcGxheShfdGhpcy5hdHRycyksXG4gICAgICAgICAgICAgICAgbW9tZW50OiAoKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnZhbHVlKSA/XG4gICAgICAgICAgICAgICAgICAgIG1heWJlXzEuanVzdChwYXJzZURhdGUoZ2V0VmFsdWUoX3RoaXMuYXR0cnMpLCBnZXRGb3JtYXQoX3RoaXMuYXR0cnMpKSkgOlxuICAgICAgICAgICAgICAgICAgICBtYXliZV8xLm5vdGhpbmcoKSksXG4gICAgICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIChfdGhpcy52YWx1ZXMuaW5wdXQubW9tZW50LmlzSnVzdCgpICYmXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnZhbHVlcy5pbnB1dC5tb21lbnQuZ2V0KCkuaXNWYWxpZCgpKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnZhbHVlcy5pbnB1dC5tb21lbnQuZ2V0KCkuZm9ybWF0KF90aGlzLnZhbHVlcy5pbnB1dC5kaXNwbGF5KSA6ICcnOyB9LFxuICAgICAgICAgICAgICAgIGRpc2FibGVkOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZGlzYWJsZWQgPT09IHRydWUpID9cbiAgICAgICAgICAgICAgICAgICAgdHJ1ZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgb25mb2N1czogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZS50YXJnZXQuc2VsZWN0KCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvbmlucHV0OiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5vbmlucHV0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMudmFsdWVzLmlucHV0Lm9ua2V5dXAoZSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvbmtleXVwOiB1dGlsXzEuZGVib3VuY2UoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gZS50YXJnZXQudmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnZhbHVlcy5pbnB1dC5tb21lbnQgPSBtYXliZV8xLm5vdGhpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmZpcmVDaGFuZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0gcGFyc2VEYXRlKHZhbHVlLCBfdGhpcy52YWx1ZXMuaW5wdXQuZm9ybWF0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtLmlzVmFsaWQoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnZhbHVlcy5pbnB1dC5tb21lbnQgPSBtYXliZV8xLmp1c3QobSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZmlyZUNoYW5nZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgZXhwb3J0cy5ERUxBWSksXG4gICAgICAgICAgICAgICAgb25ibHVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuaW52YWxpZGF0ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIERhdGVGaWVsZC5wcm90b3R5cGUuZmlyZUNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuYXR0cnMud3cgJiYgdGhpcy5hdHRycy53dy5vbkNoYW5nZSkge1xuICAgICAgICAgICAgdmFyIG5hbWVfMSA9IHRoaXMuYXR0cnMud3cubmFtZSB8fCAnJztcbiAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlcy5pbnB1dC5tb21lbnQuaXNKdXN0KCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgbSA9IHRoaXMudmFsdWVzLmlucHV0Lm1vbWVudC5nZXQoKTtcbiAgICAgICAgICAgICAgICBpZiAobS5pc1ZhbGlkKCkpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXR0cnMud3cub25DaGFuZ2UobmV3IERhdGVDaGFuZ2VkRXZlbnQobmFtZV8xLCBtLmZvcm1hdChleHBvcnRzLlZBTFVFX0ZPUk1BVCkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0cnMud3cub25DaGFuZ2UobmV3IERhdGVDaGFuZ2VkRXZlbnQobmFtZV8xLCB1bmRlZmluZWQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgRGF0ZUZpZWxkLnByb3RvdHlwZS5zZXRNZXNzYWdlID0gZnVuY3Rpb24gKG1zZykge1xuICAgICAgICB0aGlzLnZhbHVlcy5tZXNzYWdlcy50ZXh0ID0gbXNnO1xuICAgICAgICBmb3JtXzEuc2V0TWVzc2FnZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLm1lc3NhZ2VzLndtbC5pZCwgbXNnKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBEYXRlRmllbGQucHJvdG90eXBlLnJlbW92ZU1lc3NhZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudmFsdWVzLm1lc3NhZ2VzLnRleHQgPSAnJztcbiAgICAgICAgZm9ybV8xLnJlbW92ZU1lc3NhZ2UodGhpcy52aWV3LCB0aGlzLnZhbHVlcy5tZXNzYWdlcy53bWwuaWQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIHJldHVybiBEYXRlRmllbGQ7XG59KGZvcm1fMS5BYnN0cmFjdEZvcm1Db250cm9sKSk7XG5leHBvcnRzLkRhdGVGaWVsZCA9IERhdGVGaWVsZDtcbnZhciBwYXJzZURhdGUgPSBmdW5jdGlvbiAoZCwgZm9ybWF0cykge1xuICAgIHZhciBzdHIgPSBkLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKChzdHIgPT09IGV4cG9ydHMuVE9EQVkpIHx8IChzdHIgPT09IGV4cG9ydHMuTk9XKSkge1xuICAgICAgICByZXR1cm4gbW9tZW50LnV0YygpO1xuICAgIH1cbiAgICBlbHNlIGlmIChzdHIgPT09IGV4cG9ydHMuWUVTVEVSREFZKSB7XG4gICAgICAgIHJldHVybiBtb21lbnQudXRjKCkuc3VidHJhY3QoMSwgJ2QnKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBtb21lbnQudXRjKGQsIF9fc3ByZWFkQXJyYXlzKGZvcm1hdHMsIFttb21lbnQuSVNPXzg2MDFdKSwgdHJ1ZSk7XG4gICAgfVxufTtcbnZhciBnZXRWYWx1ZSA9IGZ1bmN0aW9uIChhdHRycykge1xuICAgIHJldHVybiAoYXR0cnMud3cgJiYgYXR0cnMud3cudmFsdWUpID8gYXR0cnMud3cudmFsdWUgOiAnJztcbn07XG52YXIgZ2V0Rm9ybWF0ID0gZnVuY3Rpb24gKGF0dHJzKSB7XG4gICAgaWYgKGF0dHJzLnd3ICYmIGF0dHJzLnd3LmZvcm1hdCkge1xuICAgICAgICBzd2l0Y2ggKGF0dHJzLnd3LmZvcm1hdCkge1xuICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgIHJldHVybiBleHBvcnRzLmNvbW1vbkZvcm1hdHM7XG4gICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGV4cG9ydHMudXNGb3JtYXRzO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZXhwb3J0cy5pc284NjAxRm9ybWF0cztcbn07XG52YXIgZ2V0UGxhY2Vob2xkZXIgPSBmdW5jdGlvbiAoYXR0cnMpIHtcbiAgICBpZiAoYXR0cnMud3cgJiYgYXR0cnMud3cucGxhY2Vob2xkZXIpXG4gICAgICAgIHJldHVybiBhdHRycy53dy5wbGFjZWhvbGRlcjtcbiAgICBpZiAoYXR0cnMud3cgJiYgYXR0cnMud3cuZm9ybWF0KSB7XG4gICAgICAgIHN3aXRjaCAoYXR0cnMud3cuZm9ybWF0KSB7XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgcmV0dXJuICdERC1NTS1ZWVlZJztcbiAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ01NLURELVlZWVknO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gJ1lZWVktTU0tREQnO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiAnWVlZWS1NTS1ERCc7XG59O1xudmFyIGdldERpc3BsYXkgPSBmdW5jdGlvbiAoYXR0cnMpIHtcbiAgICByZXR1cm4gKGF0dHJzLnd3ICYmIGF0dHJzLnd3LmRpc3BsYXkpID8gYXR0cnMud3cuZGlzcGxheSA6IGV4cG9ydHMuREVGQVVMVF9JTlBVVF9ESVNQTEFZO1xufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBsYWJlbF8xID0gcmVxdWlyZShcIi4uLy4uL2xhYmVsXCIpO1xuO1xudmFyIGhlbHBfMSA9IHJlcXVpcmUoXCIuLi8uLi9oZWxwXCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5yb290LmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuY2xhc3NOYW1lIH0sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBsYWJlbF8xLkxhYmVsKHsgd3c6IHsgJ2Zvcic6IF9fY29udGV4dC52YWx1ZXMucm9vdC5pZCwgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmxhYmVsLnRleHQgfSB9LCBbXSksIHsgd3c6IHsgJ2Zvcic6IF9fY29udGV4dC52YWx1ZXMucm9vdC5pZCwgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmxhYmVsLnRleHQgfSB9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnaW5wdXQnLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0LndtbC5pZCB9LCAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQud21sLmlkLCAnb25mb2N1cyc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQub25mb2N1cywgJ29uaW5wdXQnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0Lm9uaW5wdXQsICdvbmtleXVwJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC5vbmtleXVwLCAnb25ibHVyJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC5vbmJsdXIsICd2YWx1ZSc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQudmFsdWUoKSwgJ2Rpc2FibGVkJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC5kaXNhYmxlZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC5jbGFzc05hbWUsICdwbGFjZWhvbGRlcic6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQucGxhY2Vob2xkZXIgfSwgW10pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGhlbHBfMS5IZWxwKHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubWVzc2FnZXMud21sLmlkIH0sIHd3OiB7ICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5tZXNzYWdlcy50ZXh0IH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLm1lc3NhZ2VzLndtbC5pZCB9LCB3dzogeyAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMubWVzc2FnZXMudGV4dCB9IH0pXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRhdGUtZmllbGQuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRGlzcGxheUZpZWxkID0gZXhwb3J0cy5ESVNQTEFZX0ZJRUxEX0NPTlRFTlQgPSBleHBvcnRzLkRJU1BMQVlfRklFTEQgPSBleHBvcnRzLlN0eWxlID0gdm9pZCAwO1xudmFyIHdtbF8xID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgdG9vbGJhcl8xID0gcmVxdWlyZShcIi4uL3Rvb2xiYXJcIik7XG52YXIgb3JpZW50YXRpb25fMSA9IHJlcXVpcmUoXCIuLi8uLi9jb250ZW50L29yaWVudGF0aW9uXCIpO1xudmFyIGRpc2FibGVkXzEgPSByZXF1aXJlKFwiLi4vLi4vY29udGVudC9zdGF0ZS9kaXNhYmxlZFwiKTtcbnZhciBzdHlsZV8xID0gcmVxdWlyZShcIi4uLy4uL2NvbnRlbnQvc3R5bGVcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJTdHlsZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc3R5bGVfMS5TdHlsZTsgfSB9KTtcbnZhciBzaXplXzEgPSByZXF1aXJlKFwiLi4vLi4vY29udGVudC9zaXplXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLi8uLi9cIik7XG52YXIgZGlzcGxheV9maWVsZF8xID0gcmVxdWlyZShcIi4vd21sL2Rpc3BsYXktZmllbGRcIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLkRJU1BMQVlfRklFTEQgPSAnd3ctZGlzcGxheS1maWVsZCc7XG5leHBvcnRzLkRJU1BMQVlfRklFTERfQ09OVEVOVCA9ICd3dy1kaXNwbGF5LWZpZWxkX19jb250ZW50Jztcbjtcbi8qKlxuICogRGlzcGxheUZpZWxkIGlzIHVzZWQgdG8gZGlzcGxheSBhIHZhbHVlIGluIGEgdGV4dCBmaWVsZCBsaWtlIGJveC5cbiAqL1xudmFyIERpc3BsYXlGaWVsZCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoRGlzcGxheUZpZWxkLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIERpc3BsYXlGaWVsZCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgZGlzcGxheV9maWVsZF8xLk1haW4oX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICBpZDogJ2Rpc3BsYXknXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBkaXNhYmxlZDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmRpc2FibGVkKSA/XG4gICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuZGlzYWJsZWQgOiBmYWxzZSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLkRJU1BMQVlfRklFTEQsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpLCB0b29sYmFyXzEuVE9PTEJBUl9DT01QQVQsIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5zdHlsZSkgP1xuICAgICAgICAgICAgICAgIHN0eWxlXzEuZ2V0U3R5bGVDbGFzc05hbWUoX3RoaXMuYXR0cnMud3cuc3R5bGUpIDpcbiAgICAgICAgICAgICAgICBzdHlsZV8xLkRFRkFVTFQsIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5zaXplKSA/XG4gICAgICAgICAgICAgICAgc2l6ZV8xLmdldFNpemVDbGFzc05hbWUoX3RoaXMuYXR0cnMud3cuc2l6ZSkgOiAnJywgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmJsb2NrKSA/XG4gICAgICAgICAgICAgICAgb3JpZW50YXRpb25fMS5CTE9DSyA6ICcnLCAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZGlzYWJsZWQpID9cbiAgICAgICAgICAgICAgICBkaXNhYmxlZF8xLkRJU0FCTEVEIDogJycpLFxuICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOyAvL3ByZXZlbnQgYSBidWcgd2hlbiB1c2VkIHdpdGggUmVzdWx0c01lbnVcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuYXR0cnMud3cgJiZcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cub25DbGljayAmJlxuICAgICAgICAgICAgICAgICAgICAoIV90aGlzLnZhbHVlcy5kaXNhYmxlZCkpXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uQ2xpY2soKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBleHBvcnRzLkRJU1BMQVlfRklFTERfQ09OVEVOVFxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBEaXNwbGF5RmllbGQ7XG59KHdtbF8xLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5EaXNwbGF5RmllbGQgPSBEaXNwbGF5RmllbGQ7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY2xhc3NOYW1lLCAnb25jbGljayc6IF9fY29udGV4dC52YWx1ZXMub25jbGljayB9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2RpdicsIHsgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jb250ZW50LmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LmNoaWxkcmVuKSkpXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRpc3BsYXktZmllbGQuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRHJvcERvd24gPSBleHBvcnRzLkRST1BfRE9XTl9DT05URU5UID0gZXhwb3J0cy5EUk9QX0RPV05fVE9HR0xFID0gZXhwb3J0cy5EUk9QX0RPV04gPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvZHJvcC1kb3duXCIpO1xudmFyIGhpZGRlbiA9IHJlcXVpcmUoXCIuLi8uLi9jb250ZW50L3N0YXRlL2hpZGRlblwiKTtcbnZhciBzdHlsZSA9IHJlcXVpcmUoXCIuLi8uLi9jb250ZW50L3N0eWxlXCIpO1xudmFyIHdtbF8xID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgYnV0dG9uX2dyb3VwXzEgPSByZXF1aXJlKFwiLi4vYnV0dG9uLWdyb3VwXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLi8uLi9cIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLkRST1BfRE9XTiA9ICd3dy1kcm9wLWRvd24tbWVudSc7XG5leHBvcnRzLkRST1BfRE9XTl9UT0dHTEUgPSAnd3ctZHJvcC1kb3duLW1lbnVfX3RvZ2dsZSc7XG5leHBvcnRzLkRST1BfRE9XTl9DT05URU5UID0gJ3d3LWRyb3AtZG93bl9fY29udGVudCc7XG4vKipcbiAqIERyb3BEb3duIHByb3ZpZGVzIGEgY29tcG9uZW50IGZvciBkaXNwbGF5aW5nIGEgcG9wIHVwIG1lbnUuXG4gKlxuICogICAgKy0tLS0tLS0tK1xuICogICAgfCAgTWVudSAgfFxuICogICAgKy0tLS0tLS0tK1xuICogICAgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rXG4gKiAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICAgIHwgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gfFxuICogICAgfCAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgICB8IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIHxcbiAqICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogICAgfCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSB8XG4gKiAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICAgICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tK1xuICovXG52YXIgRHJvcERvd24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKERyb3BEb3duLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIERyb3BEb3duKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5NYWluKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgcm9vdDoge1xuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ3Jvb3QnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5EUk9QX0RPV04sIGJ1dHRvbl9ncm91cF8xLkJVVFRPTl9HUk9VUF9DT01QQVQsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGJ1dHRvbjoge1xuICAgICAgICAgICAgICAgIHRleHQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5idXR0b25UZXh0KSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmJ1dHRvblRleHQgOiAnJyxcbiAgICAgICAgICAgICAgICBhbmNob3I6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5hbmNob3IpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuYW5jaG9yIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuRFJPUF9ET1dOX1RPR0dMRSwgc3R5bGUuREVGQVVMVCwgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmJ1dHRvbkNsYXNzTmFtZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5idXR0b25DbGFzc05hbWUgOiAnJyksXG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5kaXNhYmxlZCkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5kaXNhYmxlZCA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmJ1dHRvblRlbXBsYXRlKSA/XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5idXR0b25UZW1wbGF0ZSA6IHZpZXdzLmJ1dHRvbjtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1heVJvb3QgPSB1dGlsXzEuZ2V0QnlJZChfdGhpcy52aWV3LCBfdGhpcy52YWx1ZXMucm9vdC53bWwuaWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobWF5Um9vdC5pc0p1c3QoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBtYXlSb290LmdldCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLnZhbHVlcy5jb250ZW50LmF1dG9DbG9zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoaWRlID0gX3RoaXMudmFsdWVzLmNvbnRlbnQuaGlkZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2ludGVyY2VwdCBjbGlja3Mgb24gYnV0dG9uIGFuZCBjb250ZW50IHNlY3Rpb25zXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vcHJldmVudCBkb3VibGluZyB1cCBoYW5kbGVycy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5jaGlsZHJlbltpXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGlkZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuY2hpbGRyZW5baV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoaWRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy50b2dnbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIF90aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnY29udGVudCdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLkRST1BfRE9XTl9DT05URU5ULCBoaWRkZW4uSElEREVOKSxcbiAgICAgICAgICAgICAgICBhdXRvQ2xvc2U6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5hdXRvQ2xvc2UgPT09IGZhbHNlKSA/XG4gICAgICAgICAgICAgICAgICAgIGZhbHNlIDogdHJ1ZSxcbiAgICAgICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmNoaWxkcmVuOyB9LFxuICAgICAgICAgICAgICAgIGhpZGU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmhpZGUoKTsgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIERyb3BEb3duLnByb3RvdHlwZS5pc0hpZGRlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGhpZGRlbi5pc0hpZGRlbih0aGlzLnZpZXcsIHRoaXMudmFsdWVzLmNvbnRlbnQud21sLmlkKTtcbiAgICB9O1xuICAgIERyb3BEb3duLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBoaWRkZW4uaGlkZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLmNvbnRlbnQud21sLmlkKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBEcm9wRG93bi5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaGlkZGVuLnNob3codGhpcy52aWV3LCB0aGlzLnZhbHVlcy5jb250ZW50LndtbC5pZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgRHJvcERvd24ucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaGlkZGVuLnRvZ2dsZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLmNvbnRlbnQud21sLmlkKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBEcm9wRG93bi5wcm90b3R5cGUuaGFuZGxlRXZlbnQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB1dGlsXzEuZ2V0QnlJZCh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLnJvb3Qud21sLmlkKVxuICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAocm9vdCkge1xuICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5ib2R5LmNvbnRhaW5zKHJvb3QpKVxuICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgX3RoaXMpO1xuICAgICAgICAgICAgaWYgKCghcm9vdC5jb250YWlucyhlLnRhcmdldCkpKVxuICAgICAgICAgICAgICAgIF90aGlzLmhpZGUoKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gRHJvcERvd247XG59KHdtbF8xLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5Ecm9wRG93biA9IERyb3BEb3duO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheXMgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXlzKSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcbiAgICAgICAgICAgIHJba10gPSBhW2pdO1xuICAgIHJldHVybiByO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IGV4cG9ydHMuYnV0dG9uID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBidXR0b25fMSA9IHJlcXVpcmUoXCIuLi8uLi9idXR0b25cIik7XG47XG52YXIgY2FyZXRfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jb250ZW50L2NhcmV0XCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbmV4cG9ydHMuYnV0dG9uID0gZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICByZXR1cm4gW1xuICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBidXR0b25fMS5CdXR0b24oeyB3dzogeyAnY2xhc3NOYW1lJzogZC52YWx1ZXMuYnV0dG9uLmNsYXNzTmFtZSwgJ2FuY2hvcic6IGQudmFsdWVzLmJ1dHRvbi5hbmNob3IsICdkaXNhYmxlZCc6IGQudmFsdWVzLmJ1dHRvbi5kaXNhYmxlZCwgJ29uQ2xpY2snOiBkLnZhbHVlcy5idXR0b24ub25DbGljayB9IH0sIFtcbiAgICAgICAgICAgIHRleHQoKGQudmFsdWVzLmJ1dHRvbi50ZXh0ICsgJyAnKSksXG4gICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBjYXJldF8xLkNhcmV0KHt9LCBbXSksIHt9KVxuICAgICAgICBdKSwgeyB3dzogeyAnY2xhc3NOYW1lJzogZC52YWx1ZXMuYnV0dG9uLmNsYXNzTmFtZSwgJ2FuY2hvcic6IGQudmFsdWVzLmJ1dHRvbi5hbmNob3IsICdkaXNhYmxlZCc6IGQudmFsdWVzLmJ1dHRvbi5kaXNhYmxlZCwgJ29uQ2xpY2snOiBkLnZhbHVlcy5idXR0b24ub25DbGljayB9IH0pXG4gICAgXTtcbn07IH07XG47XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLnJvb3Qud21sLmlkIH0sICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMucm9vdC5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC52YWx1ZXMuYnV0dG9uLnRlbXBsYXRlKCkoX19jb250ZXh0KShfX3RoaXMpKSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdkaXYnLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRlbnQud21sLmlkIH0sICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY29udGVudC5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC52YWx1ZXMuY29udGVudC5yZW5kZXIoKSkpKVxuICAgICAgICAgICAgXSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZHJvcC1kb3duLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkRyb3BMaXN0RmllbGQgPSBleHBvcnRzLkRST1BfTElTVF9GSUVMRCA9IGV4cG9ydHMuSXRlbUNoYW5nZWRFdmVudCA9IHZvaWQgMDtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbFwiKTtcbnZhciBmZWVkYmFja18xID0gcmVxdWlyZShcIi4uL2ZlZWRiYWNrXCIpO1xudmFyIHNlbGVjdF8xID0gcmVxdWlyZShcIi4uL3NlbGVjdFwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkl0ZW1DaGFuZ2VkRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHNlbGVjdF8xLkl0ZW1DaGFuZ2VkRXZlbnQ7IH0gfSk7XG52YXIgZm9ybV8xID0gcmVxdWlyZShcIi4uL2Zvcm1cIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciBfXzIgPSByZXF1aXJlKFwiLi4vXCIpO1xudmFyIGRyb3BfbGlzdF9maWVsZF8xID0gcmVxdWlyZShcIi4vd21sL2Ryb3AtbGlzdC1maWVsZFwiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuRFJPUF9MSVNUX0ZJRUxEID0gJ3d3LWRyb3AtbGlzdC1maWVsZCc7XG4vKipcbiAqIERyb3BMaXN0RmllbGRcbiAqL1xudmFyIERyb3BMaXN0RmllbGQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKERyb3BMaXN0RmllbGQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gRHJvcExpc3RGaWVsZCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgZHJvcF9saXN0X2ZpZWxkXzEuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHJvb3Q6IHtcbiAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdyb290J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuRFJPUF9MSVNUX0ZJRUxELCBfXzEuZ2V0Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSwgZmVlZGJhY2tfMS5nZXRWYWxpZGl0eUNsYXNzTmFtZShfdGhpcy5hdHRycykpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbWVzc2FnZXM6IHtcbiAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdtZXNzYWdlJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdGV4dDogZmVlZGJhY2tfMS5nZXRNZXNzYWdlKF90aGlzLmF0dHJzKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICAgICAgaWQ6IF9fMi5nZXROYW1lKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgICAgICB0ZXh0OiBmb3JtXzEuZ2V0TGFiZWwoX3RoaXMuYXR0cnMpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udHJvbDoge1xuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ2NvbnRyb2wnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBuYW1lOiBfXzIuZ2V0TmFtZShfdGhpcy5hdHRycyksXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBmZWVkYmFja18xLmdldFZhbGlkaXR5Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgICAgICBibG9jazogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnBsYWNlaG9sZGVyKSxcbiAgICAgICAgICAgICAgICBkaXNhYmxlZDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmRpc2FibGVkKSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnZhbHVlKSxcbiAgICAgICAgICAgICAgICBvcHRpb25zOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cub3B0aW9ucykgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vcHRpb25zIDogW10sXG4gICAgICAgICAgICAgICAgc3RyaW5naWZpZXI6IF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnN0cmluZ2lmaWVyLFxuICAgICAgICAgICAgICAgIGl0ZW1UZW1wbGF0ZTogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lml0ZW1UZW1wbGF0ZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5pdGVtVGVtcGxhdGUgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgbm9JdGVtc1RlbXBsYXRlOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cubm9JdGVtc1RlbXBsYXRlKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm5vSXRlbXNUZW1wbGF0ZSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBvblNlbGVjdDogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm9uQ2hhbmdlKVxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cub25DaGFuZ2UobmV3IHNlbGVjdF8xLkl0ZW1DaGFuZ2VkRXZlbnQoZS5uYW1lLCBlLnZhbHVlKSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBEcm9wTGlzdEZpZWxkLnByb3RvdHlwZS5zZXRNZXNzYWdlID0gZnVuY3Rpb24gKG1zZykge1xuICAgICAgICBnZXRIZWxwKHRoaXMpLm1hcChmdW5jdGlvbiAoaCkgeyByZXR1cm4gaC5zZXRNZXNzYWdlKG1zZyk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIERyb3BMaXN0RmllbGQucHJvdG90eXBlLnJlbW92ZU1lc3NhZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdldEhlbHAodGhpcykubWFwKGZ1bmN0aW9uIChoKSB7IHJldHVybiBoLnJlbW92ZU1lc3NhZ2UoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgcmV0dXJuIERyb3BMaXN0RmllbGQ7XG59KGZvcm1fMS5BYnN0cmFjdEZvcm1Db250cm9sKSk7XG5leHBvcnRzLkRyb3BMaXN0RmllbGQgPSBEcm9wTGlzdEZpZWxkO1xudmFyIGdldEhlbHAgPSBmdW5jdGlvbiAodCkge1xuICAgIHJldHVybiB1dGlsXzEuZ2V0QnlJZCh0LnZpZXcsIHQudmFsdWVzLm1lc3NhZ2VzLndtbC5pZCk7XG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGxhYmVsXzEgPSByZXF1aXJlKFwiLi4vLi4vbGFiZWxcIik7XG47XG52YXIgaGVscF8xID0gcmVxdWlyZShcIi4uLy4uL2hlbHBcIik7XG47XG52YXIgZHJvcF9saXN0XzEgPSByZXF1aXJlKFwiLi4vLi4vZHJvcC1saXN0XCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMucm9vdC53bWwuaWQgfSwgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5yb290LmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuY2xhc3NOYW1lIH0sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBsYWJlbF8xLkxhYmVsKHsgd3c6IHsgJ2Zvcic6IF9fY29udGV4dC52YWx1ZXMucm9vdC5pZCwgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmxhYmVsLnRleHQgfSB9LCBbXSksIHsgd3c6IHsgJ2Zvcic6IF9fY29udGV4dC52YWx1ZXMucm9vdC5pZCwgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmxhYmVsLnRleHQgfSB9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkcm9wX2xpc3RfMS5Ecm9wTGlzdCh7IHd3OiB7ICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wuY2xhc3NOYW1lLCAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC5uYW1lLCAncGxhY2Vob2xkZXInOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wucGxhY2Vob2xkZXIsICdkaXNhYmxlZCc6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC5kaXNhYmxlZCwgJ2Jsb2NrJzogX19jb250ZXh0LnZhbHVlcy5jb250cm9sLmJsb2NrLCAndmFsdWUnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wudmFsdWUsICdvcHRpb25zJzogX19jb250ZXh0LnZhbHVlcy5jb250cm9sLm9wdGlvbnMsICdvblNlbGVjdCc6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC5vblNlbGVjdCwgJ25vSXRlbXNUZW1wbGF0ZSc6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC5ub0l0ZW1zVGVtcGxhdGUsICdpdGVtVGVtcGxhdGUnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wuaXRlbVRlbXBsYXRlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wuc3RyaW5naWZpZXIgfSB9LCBbXSksIHsgd3c6IHsgJ2NsYXNzTmFtZSc6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC5jbGFzc05hbWUsICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5jb250cm9sLm5hbWUsICdwbGFjZWhvbGRlcic6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC5wbGFjZWhvbGRlciwgJ2Rpc2FibGVkJzogX19jb250ZXh0LnZhbHVlcy5jb250cm9sLmRpc2FibGVkLCAnYmxvY2snOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wuYmxvY2ssICd2YWx1ZSc6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC52YWx1ZSwgJ29wdGlvbnMnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wub3B0aW9ucywgJ29uU2VsZWN0JzogX19jb250ZXh0LnZhbHVlcy5jb250cm9sLm9uU2VsZWN0LCAnbm9JdGVtc1RlbXBsYXRlJzogX19jb250ZXh0LnZhbHVlcy5jb250cm9sLm5vSXRlbXNUZW1wbGF0ZSwgJ2l0ZW1UZW1wbGF0ZSc6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC5pdGVtVGVtcGxhdGUsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC5zdHJpbmdpZmllciB9IH0pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGhlbHBfMS5IZWxwKHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubWVzc2FnZXMud21sLmlkIH0sIHd3OiB7ICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5tZXNzYWdlcy50ZXh0IH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLm1lc3NhZ2VzLndtbC5pZCB9LCB3dzogeyAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMubWVzc2FnZXMudGV4dCB9IH0pXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRyb3AtbGlzdC1maWVsZC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Ecm9wTGlzdCA9IGV4cG9ydHMuRFJPUF9MSVNUID0gZXhwb3J0cy5JdGVtU2VsZWN0ZWRFdmVudCA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9kcm9wLWxpc3RcIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgc2l6ZV8xID0gcmVxdWlyZShcIi4uLy4uL2NvbnRlbnQvc2l6ZVwiKTtcbnZhciBvcmllbnRhdGlvbl8xID0gcmVxdWlyZShcIi4uLy4uL2NvbnRlbnQvb3JpZW50YXRpb25cIik7XG52YXIgcmVzdWx0c19tZW51XzEgPSByZXF1aXJlKFwiLi4vcmVzdWx0cy1tZW51XCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiSXRlbVNlbGVjdGVkRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlc3VsdHNfbWVudV8xLkl0ZW1TZWxlY3RlZEV2ZW50OyB9IH0pO1xudmFyIHNlYXJjaF8xID0gcmVxdWlyZShcIi4uL3NlYXJjaFwiKTtcbnZhciBfXzEgPSByZXF1aXJlKFwiLi4vLi4vXCIpO1xudmFyIF9fMiA9IHJlcXVpcmUoXCIuLi9cIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLkRST1BfTElTVCA9ICd3dy1kcm9wLWxpc3QnO1xuLyoqXG4gKiBEcm9wTGlzdCBwcm92aWRlcyBhIGNvbnRyb2wgZm9yIG1ha2luZyBhIHNlbGVjdGlvbiBmcm9tIGEgbGlzdCBvZiBjaG9pY2VzLlxuICovXG52YXIgRHJvcExpc3QgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKERyb3BMaXN0LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIERyb3BMaXN0KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5NYWluKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5EUk9QX0xJU1QsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpLCAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuc2l6ZSkgP1xuICAgICAgICAgICAgICAgIHNpemVfMS5nZXRTaXplQ2xhc3NOYW1lKF90aGlzLmF0dHJzLnd3LnNpemUpIDogJycsIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5ibG9jaykgP1xuICAgICAgICAgICAgICAgIG9yaWVudGF0aW9uXzEuQkxPQ0sgOiAnJyksXG4gICAgICAgICAgICBuYW1lOiBfXzIuZ2V0TmFtZShfdGhpcy5hdHRycyksXG4gICAgICAgICAgICB2YWx1ZTogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnZhbHVlKSxcbiAgICAgICAgICAgIGNvbnRyb2w6IHtcbiAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdkcm9wLWxpc3QnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnbWVzc2FnZXMnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRpc3BsYXk6IHtcbiAgICAgICAgICAgICAgICBkaXNhYmxlZDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmRpc2FibGVkKSxcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuYXR0cnMud3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dy5vcHRpb25zICYmIF90aGlzLnZhbHVlcy52YWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q3VycmVudChfdGhpcy5hdHRycy53dy5vcHRpb25zLCBfdGhpcy52YWx1ZXMudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmF0dHJzLnd3LnBsYWNlaG9sZGVyIHx8ICdTZWxlY3Qgb25lJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy50b2dnbGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbWVudToge1xuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ21lbnUnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBuYW1lOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cubmFtZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5uYW1lIDogJycsXG4gICAgICAgICAgICAgICAgYmxvY2s6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5ibG9jaykgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5ibG9jayA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGhpZGRlbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICByZXN1bHRzOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cub3B0aW9ucykgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vcHRpb25zIDogW10sXG4gICAgICAgICAgICAgICAgb25TZWxlY3Q6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vblNlbGVjdClcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uU2VsZWN0KG5ldyByZXN1bHRzX21lbnVfMS5JdGVtU2VsZWN0ZWRFdmVudChlLm5hbWUsIGUudmFsdWUudmFsdWUpKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMudmFsdWVzLnZhbHVlID0gZS52YWx1ZS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMudmlldy5pbnZhbGlkYXRlKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpdGVtVGVtcGxhdGU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5pdGVtVGVtcGxhdGUpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuaXRlbVRlbXBsYXRlIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIG5vSXRlbXNUZW1wbGF0ZTogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm5vSXRlbXNUZW1wbGF0ZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5ub0l0ZW1zVGVtcGxhdGUgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgc3RyaW5naWZpZXI6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5zdHJpbmdpZmllcikgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5zdHJpbmdpZmllciA6IGZ1bmN0aW9uICh2KSB7IHJldHVybiB2LmxhYmVsOyB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogdXBkYXRlIGNoYW5nZXMgdGhlIG9wdGlvbnMgYXZhaWxhYmxlIGluIHRoZSBsaXN0LlxuICAgICAqXG4gICAgICogVGhlIHZpZXcgd2lsbCBiZSBpbnZhbGlkYXRlZC5cbiAgICAgKi9cbiAgICBEcm9wTGlzdC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy52YWx1ZXMubWVudS5yZXN1bHRzID0gb3B0aW9ucztcbiAgICAgICAgdGhpcy52aWV3LmludmFsaWRhdGUoKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBvcGVuIHRoZSByZXN1bHRzIG1lbnUuXG4gICAgICovXG4gICAgRHJvcExpc3QucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlYXJjaF8xLm9wZW5NZW51KHRoaXMudmlldywgdGhpcy52YWx1ZXMubWVudS53bWwuaWQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGNsb3NlIHRoZSByZXN1bHRzIG1lbnUuXG4gICAgICovXG4gICAgRHJvcExpc3QucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWFyY2hfMS5jbG9zZU1lbnUodGhpcy52aWV3LCB0aGlzLnZhbHVlcy5tZW51LndtbC5pZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogdG9nZ2xlIHRoZSByZXN1bHRzIG1lbnUuXG4gICAgICovXG4gICAgRHJvcExpc3QucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2VhcmNoXzEudG9nZ2xlTWVudSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLm1lbnUud21sLmlkKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICByZXR1cm4gRHJvcExpc3Q7XG59KF9fMi5BYnN0cmFjdENvbnRyb2wpKTtcbmV4cG9ydHMuRHJvcExpc3QgPSBEcm9wTGlzdDtcbnZhciBnZXRDdXJyZW50ID0gZnVuY3Rpb24gKG9wdHMsIHZhbHVlLCB0ZXh0KSB7XG4gICAgaWYgKHRleHQgPT09IHZvaWQgMCkgeyB0ZXh0ID0gJ1NlbGVjdCBvbmUnOyB9XG4gICAgcmV0dXJuIG9wdHMucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7IHJldHVybiBjLnZhbHVlID09PSB2YWx1ZSA/IGMubGFiZWwgOiBwOyB9LCB0ZXh0KTtcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG52YXIgY2FyZXRfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jb250ZW50L2NhcmV0XCIpO1xuO1xudmFyIHJlc3VsdHNfbWVudV8xID0gcmVxdWlyZShcIi4uLy4uL3Jlc3VsdHMtbWVudVwiKTtcbjtcbnZhciBkaXNwbGF5X2ZpZWxkXzEgPSByZXF1aXJlKFwiLi4vLi4vZGlzcGxheS1maWVsZFwiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY2xhc3NOYW1lIH0sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkaXNwbGF5X2ZpZWxkXzEuRGlzcGxheUZpZWxkKHsgd3c6IHsgJ29uQ2xpY2snOiBfX2NvbnRleHQudmFsdWVzLmRpc3BsYXkub25DbGljaywgJ2Rpc2FibGVkJzogX19jb250ZXh0LnZhbHVlcy5kaXNwbGF5LmRpc2FibGVkIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICB0ZXh0KF9fY29udGV4dC52YWx1ZXMuZGlzcGxheS5wbGFjZWhvbGRlcigpKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgY2FyZXRfMS5DYXJldCh7fSwgW10pLCB7fSlcbiAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnb25DbGljayc6IF9fY29udGV4dC52YWx1ZXMuZGlzcGxheS5vbkNsaWNrLCAnZGlzYWJsZWQnOiBfX2NvbnRleHQudmFsdWVzLmRpc3BsYXkuZGlzYWJsZWQgfSB9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyByZXN1bHRzX21lbnVfMS5SZXN1bHRzTWVudSh7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLm1lbnUud21sLmlkIH0sIHd3OiB7ICdibG9jayc6IF9fY29udGV4dC52YWx1ZXMubWVudS5ibG9jaywgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLm1lbnUubmFtZSwgJ2hpZGRlbic6IF9fY29udGV4dC52YWx1ZXMubWVudS5oaWRkZW4sICdyZXN1bHRzJzogX19jb250ZXh0LnZhbHVlcy5tZW51LnJlc3VsdHMsICdvblNlbGVjdCc6IF9fY29udGV4dC52YWx1ZXMubWVudS5vblNlbGVjdCwgJ25vSXRlbXNUZW1wbGF0ZSc6IF9fY29udGV4dC52YWx1ZXMubWVudS5ub0l0ZW1zVGVtcGxhdGUsICdpdGVtVGVtcGxhdGUnOiBfX2NvbnRleHQudmFsdWVzLm1lbnUuaXRlbVRlbXBsYXRlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLm1lbnUuc3RyaW5naWZpZXIgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubWVudS53bWwuaWQgfSwgd3c6IHsgJ2Jsb2NrJzogX19jb250ZXh0LnZhbHVlcy5tZW51LmJsb2NrLCAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMubWVudS5uYW1lLCAnaGlkZGVuJzogX19jb250ZXh0LnZhbHVlcy5tZW51LmhpZGRlbiwgJ3Jlc3VsdHMnOiBfX2NvbnRleHQudmFsdWVzLm1lbnUucmVzdWx0cywgJ29uU2VsZWN0JzogX19jb250ZXh0LnZhbHVlcy5tZW51Lm9uU2VsZWN0LCAnbm9JdGVtc1RlbXBsYXRlJzogX19jb250ZXh0LnZhbHVlcy5tZW51Lm5vSXRlbXNUZW1wbGF0ZSwgJ2l0ZW1UZW1wbGF0ZSc6IF9fY29udGV4dC52YWx1ZXMubWVudS5pdGVtVGVtcGxhdGUsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMubWVudS5zdHJpbmdpZmllciB9IH0pXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRyb3AtbGlzdC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy52YWxpZGF0aW9uU3RhdGUyQ2xhc3NOYW1lID0gZXhwb3J0cy5nZXRNZXNzYWdlID0gZXhwb3J0cy5nZXRWYWxpZGl0eUNsYXNzTmFtZSA9IGV4cG9ydHMuZ2V0VmFsaWRhdGlvblN0YXRlID0gZXhwb3J0cy5yZW1vdmVWYWxpZGF0aW9uU3RhdGUgPSBleHBvcnRzLnNldFZhbGlkYXRpb25TdGF0ZSA9IGV4cG9ydHMucmVtb3ZlTWVzc2FnZSA9IGV4cG9ydHMuc2V0TWVzc2FnZSA9IGV4cG9ydHMuQWJzdHJhY3RGZWVkYmFja0NvbnRyb2wgPSBleHBvcnRzLlZhbGlkYXRpb25TdGF0ZSA9IHZvaWQgMDtcbnZhciBzdHlsZSA9IHJlcXVpcmUoXCIuLi9jb250ZW50L3N0eWxlXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi91dGlsXCIpO1xudmFyIGNvbnRyb2xfMSA9IHJlcXVpcmUoXCIuLi9jb250cm9sXCIpO1xuLyoqXG4gKiBWYWxpZGF0aW9uU3RhdGVcbiAqL1xudmFyIFZhbGlkYXRpb25TdGF0ZTtcbihmdW5jdGlvbiAoVmFsaWRhdGlvblN0YXRlKSB7XG4gICAgVmFsaWRhdGlvblN0YXRlW1wiTmV1dHJhbFwiXSA9IFwibmV1dHJhbFwiO1xuICAgIFZhbGlkYXRpb25TdGF0ZVtcIkVycm9yXCJdID0gXCJlcnJvclwiO1xuICAgIFZhbGlkYXRpb25TdGF0ZVtcIlN1Y2Nlc3NcIl0gPSBcInN1Y2Nlc3NcIjtcbiAgICBWYWxpZGF0aW9uU3RhdGVbXCJXYXJuaW5nXCJdID0gXCJ3YXJuaW5nXCI7XG59KShWYWxpZGF0aW9uU3RhdGUgPSBleHBvcnRzLlZhbGlkYXRpb25TdGF0ZSB8fCAoZXhwb3J0cy5WYWxpZGF0aW9uU3RhdGUgPSB7fSkpO1xuLyoqXG4gKiBBYnN0cmFjdEZlZWRiYWNrQ29udHJvbFxuICpcbiAqIFByb3ZpZGVzIGEgZGVmYXVsdCBpbXBsZW1lbnRhaW9uIG9mIHRoZSBpbnRlcmZhY2UgbWV0aG9kcy5cbiAqL1xudmFyIEFic3RyYWN0RmVlZGJhY2tDb250cm9sID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhBYnN0cmFjdEZlZWRiYWNrQ29udHJvbCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBBYnN0cmFjdEZlZWRiYWNrQ29udHJvbCgpIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgIH1cbiAgICBBYnN0cmFjdEZlZWRiYWNrQ29udHJvbC5wcm90b3R5cGUuc2V0TWVzc2FnZSA9IGZ1bmN0aW9uIChtc2cpIHtcbiAgICAgICAgZXhwb3J0cy5zZXRNZXNzYWdlKHRoaXMudmlldywgdGhpcy52YWx1ZXMubWVzc2FnZXMud21sLmlkLCBtc2cpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIEFic3RyYWN0RmVlZGJhY2tDb250cm9sLnByb3RvdHlwZS5yZW1vdmVNZXNzYWdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBleHBvcnRzLnJlbW92ZU1lc3NhZ2UodGhpcy52aWV3LCB0aGlzLnZhbHVlcy5tZXNzYWdlcy53bWwuaWQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIEFic3RyYWN0RmVlZGJhY2tDb250cm9sLnByb3RvdHlwZS5zZXRWYWxpZGF0aW9uU3RhdGUgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgZXhwb3J0cy5zZXRWYWxpZGF0aW9uU3RhdGUodGhpcy52aWV3LCB0aGlzLnZhbHVlcy5jb250cm9sLndtbC5pZCwgc3RhdGUpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIEFic3RyYWN0RmVlZGJhY2tDb250cm9sLnByb3RvdHlwZS5yZW1vdmVWYWxpZGF0aW9uU3RhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGV4cG9ydHMucmVtb3ZlVmFsaWRhdGlvblN0YXRlKHRoaXMudmlldywgdGhpcy52YWx1ZXMuY29udHJvbC53bWwuaWQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIEFic3RyYWN0RmVlZGJhY2tDb250cm9sLnByb3RvdHlwZS5nZXRWYWxpZGF0aW9uU3RhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBleHBvcnRzLmdldFZhbGlkYXRpb25TdGF0ZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLmNvbnRyb2wud21sLmlkKTtcbiAgICB9O1xuICAgIHJldHVybiBBYnN0cmFjdEZlZWRiYWNrQ29udHJvbDtcbn0oY29udHJvbF8xLkFic3RyYWN0Q29udHJvbCkpO1xuZXhwb3J0cy5BYnN0cmFjdEZlZWRiYWNrQ29udHJvbCA9IEFic3RyYWN0RmVlZGJhY2tDb250cm9sO1xuLyoqXG4gKiBzZXRNZXNzYWdlIGhlbHBlci5cbiAqL1xuZXhwb3J0cy5zZXRNZXNzYWdlID0gZnVuY3Rpb24gKHZpZXcsIGlkLCBtc2cpIHtcbiAgICByZXR1cm4gdXRpbF8xLmdldEJ5SWQodmlldywgaWQpXG4gICAgICAgIC5tYXAoZnVuY3Rpb24gKG1lc3NhZ2VzKSB7XG4gICAgICAgIHZhciBub2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobXNnKTtcbiAgICAgICAgd2hpbGUgKG1lc3NhZ2VzLmxhc3RDaGlsZClcbiAgICAgICAgICAgIG1lc3NhZ2VzLnJlbW92ZUNoaWxkKG1lc3NhZ2VzLmxhc3RDaGlsZCk7XG4gICAgICAgIG1lc3NhZ2VzLmFwcGVuZENoaWxkKG5vZGUpO1xuICAgIH0pO1xufTtcbi8qKlxuICogcmVtb3ZlTWVzc2FnZVxuICovXG5leHBvcnRzLnJlbW92ZU1lc3NhZ2UgPSBmdW5jdGlvbiAodmlldywgaWQpIHtcbiAgICByZXR1cm4gdXRpbF8xLmdldEJ5SWQodmlldywgaWQpXG4gICAgICAgIC5tYXAoZnVuY3Rpb24gKG1lc3NhZ2VzKSB7XG4gICAgICAgIHdoaWxlIChtZXNzYWdlcy5sYXN0Q2hpbGQpXG4gICAgICAgICAgICBtZXNzYWdlcy5yZW1vdmVDaGlsZChtZXNzYWdlcy5sYXN0Q2hpbGQpO1xuICAgIH0pO1xufTtcbi8qKlxuICogc2V0VmFsaWRhdGlvblN0YXRlIGhlbHBlci5cbiAqL1xuZXhwb3J0cy5zZXRWYWxpZGF0aW9uU3RhdGUgPSBmdW5jdGlvbiAodmlldywgaWQsIHN0YXRlKSB7XG4gICAgZXhwb3J0cy5yZW1vdmVWYWxpZGF0aW9uU3RhdGUodmlldywgaWQpO1xuICAgIGlmIChzdGF0ZSAhPT0gVmFsaWRhdGlvblN0YXRlLk5ldXRyYWwpXG4gICAgICAgIHV0aWxfMS5nZXRCeUlkKHZpZXcsIGlkKVxuICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5jbGFzc0xpc3QuYWRkKGV4cG9ydHMudmFsaWRhdGlvblN0YXRlMkNsYXNzTmFtZShzdGF0ZSkpOyB9KTtcbn07XG4vKipcbiAqIHJlbW92ZVZhbGlkYXRpb25TdGF0ZSBoZWxwZXIuXG4gKi9cbmV4cG9ydHMucmVtb3ZlVmFsaWRhdGlvblN0YXRlID0gZnVuY3Rpb24gKHZpZXcsIGlkKSB7XG4gICAgdXRpbF8xLmdldEJ5SWQodmlldywgaWQpXG4gICAgICAgIC5tYXAoZnVuY3Rpb24gKGgpIHtcbiAgICAgICAgaC5jbGFzc0xpc3QucmVtb3ZlKHN0eWxlLlNVQ0NFU1MpO1xuICAgICAgICBoLmNsYXNzTGlzdC5yZW1vdmUoc3R5bGUuRVJST1IpO1xuICAgICAgICBoLmNsYXNzTGlzdC5yZW1vdmUoc3R5bGUuV0FSTklORyk7XG4gICAgfSk7XG59O1xuLyoqXG4gKiBnZXRWYWxpZGF0aW9uU3RhdGUgY2FsY3VsYXRlcyB0aGUgVmFsaWRhdGlvblN0YXRlIG9mIGFuIEhUTUxFbGVtZW50XG4gKiAoaWRlbnRpZmllZCBieSBpZCkgYnkgYW5hbHlzaW5nIGl0cyBjbGFzcyBsaXN0LlxuICovXG5leHBvcnRzLmdldFZhbGlkYXRpb25TdGF0ZSA9IGZ1bmN0aW9uICh2aWV3LCBpZCkge1xuICAgIHJldHVybiB1dGlsXzEuZ2V0QnlJZCh2aWV3LCBpZClcbiAgICAgICAgLm1hcChmdW5jdGlvbiAoaCkge1xuICAgICAgICBpZiAoaC5jbGFzc0xpc3QuY29udGFpbnMoc3R5bGUuU1VDQ0VTUykpXG4gICAgICAgICAgICByZXR1cm4gVmFsaWRhdGlvblN0YXRlLlN1Y2Nlc3M7XG4gICAgICAgIGVsc2UgaWYgKGguY2xhc3NMaXN0LmNvbnRhaW5zKHN0eWxlLldBUk5JTkcpKVxuICAgICAgICAgICAgcmV0dXJuIFZhbGlkYXRpb25TdGF0ZS5XYXJuaW5nO1xuICAgICAgICBlbHNlIGlmIChoLmNsYXNzTGlzdC5jb250YWlucyhzdHlsZS5FUlJPUikpXG4gICAgICAgICAgICByZXR1cm4gVmFsaWRhdGlvblN0YXRlLkVycm9yO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gVmFsaWRhdGlvblN0YXRlLk5ldXRyYWw7XG4gICAgfSlcbiAgICAgICAgLmdldCgpO1xufTtcbi8qKlxuICogZ2V0VmFsaWRpdHlDbGFzc05hbWUgcHJvdmlkZXMgdGhlIGFwcGxpY2FibGUgc3R5bGUgY2xhc3MgYnkgY2hlY2tpbmdcbiAqIHRoZSB2YWxpZGl0eSBwcm9wZXJ0aWVzIG9mIEZlZWRiYWNrQ29udHJvQXR0cnMuXG4gKi9cbmV4cG9ydHMuZ2V0VmFsaWRpdHlDbGFzc05hbWUgPSBmdW5jdGlvbiAoYXR0cnMpIHtcbiAgICBpZiAoYXR0cnMud3cpIHtcbiAgICAgICAgaWYgKGF0dHJzLnd3LmVycm9yICYmIChhdHRycy53dy5lcnJvciAhPSAnJykpXG4gICAgICAgICAgICByZXR1cm4gc3R5bGUuRVJST1I7XG4gICAgICAgIGlmIChhdHRycy53dy53YXJuaW5nICYmIChhdHRycy53dy53YXJuaW5nICE9ICcnKSlcbiAgICAgICAgICAgIHJldHVybiBzdHlsZS5XQVJOSU5HO1xuICAgICAgICBpZiAoYXR0cnMud3cuc3VjY2VzcyAmJiAoYXR0cnMud3cuc3VjY2VzcyAhPSAnJykpXG4gICAgICAgICAgICByZXR1cm4gc3R5bGUuU1VDQ0VTUztcbiAgICB9XG4gICAgcmV0dXJuICcnO1xufTtcbi8qKlxuICogZ2V0TWVzc2FnZVxuICovXG5leHBvcnRzLmdldE1lc3NhZ2UgPSBmdW5jdGlvbiAoYXR0cnMpIHtcbiAgICBpZiAoYXR0cnMud3cpIHtcbiAgICAgICAgaWYgKGF0dHJzLnd3LmVycm9yICYmIChhdHRycy53dy5lcnJvciAhPSAnJykpXG4gICAgICAgICAgICByZXR1cm4gYXR0cnMud3cuZXJyb3I7XG4gICAgICAgIGlmIChhdHRycy53dy53YXJuaW5nICYmIChhdHRycy53dy53YXJuaW5nICE9ICcnKSlcbiAgICAgICAgICAgIHJldHVybiBhdHRycy53dy53YXJuaW5nO1xuICAgICAgICBpZiAoYXR0cnMud3cuc3VjY2VzcyAmJiAoYXR0cnMud3cuc3VjY2VzcyAhPSAnJykpXG4gICAgICAgICAgICByZXR1cm4gYXR0cnMud3cuc3VjY2VzcztcbiAgICAgICAgaWYgKGF0dHJzLnd3Lm1lc3NhZ2UgJiYgKGF0dHJzLnd3Lm1lc3NhZ2UgIT0gJycpKVxuICAgICAgICAgICAgcmV0dXJuIGF0dHJzLnd3Lm1lc3NhZ2U7XG4gICAgfVxuICAgIHJldHVybiAnJztcbn07XG4vKipcbiAqIHZhbGlkYXRpb25TdGF0ZTJDbGFzc05hbWUgdHJhbnNmb3JtcyBhIFZhbGlkYXRpb25TdGF0ZSBpbnRvXG4gKiB0aGUgY29ycmVzcG9uZGluZyBjbGFzcyBuYW1lIChpZiBhbnkpLlxuICovXG5leHBvcnRzLnZhbGlkYXRpb25TdGF0ZTJDbGFzc05hbWUgPSBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICBpZiAoc3RhdGUgPT09IFZhbGlkYXRpb25TdGF0ZS5TdWNjZXNzKVxuICAgICAgICByZXR1cm4gc3R5bGUuU1VDQ0VTUztcbiAgICBlbHNlIGlmIChzdGF0ZSA9PT0gVmFsaWRhdGlvblN0YXRlLldhcm5pbmcpXG4gICAgICAgIHJldHVybiBzdHlsZS5XQVJOSU5HO1xuICAgIGVsc2UgaWYgKHN0YXRlID09PSBWYWxpZGF0aW9uU3RhdGUuRXJyb3IpXG4gICAgICAgIHJldHVybiBzdHlsZS5FUlJPUjtcbiAgICBlbHNlXG4gICAgICAgIHJldHVybiAnJztcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1mZWVkYmFjay5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5saXN0MkFycmF5ID0gZXhwb3J0cy5GaWxlSW5wdXQgPSBleHBvcnRzLkZpbGVDaGFuZ2VkRXZlbnQgPSBleHBvcnRzLkZJTEVfSU5QVVQgPSB2b2lkIDA7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciBfXzIgPSByZXF1aXJlKFwiLi4vXCIpO1xudmFyIGZpbGVfaW5wdXRfMSA9IHJlcXVpcmUoXCIuL3dtbC9maWxlLWlucHV0XCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5GSUxFX0lOUFVUID0gJ3d3LWZpbGUtaW5wdXQnO1xuLyoqXG4gKiBGaWxlQ2hhbmdlZEV2ZW50IGlzIGZpcmVkIHdoZW5cbiAqL1xudmFyIEZpbGVDaGFuZ2VkRXZlbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEZpbGVDaGFuZ2VkRXZlbnQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gRmlsZUNoYW5nZWRFdmVudCgpIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gRmlsZUNoYW5nZWRFdmVudDtcbn0oX18yLkV2ZW50KSk7XG5leHBvcnRzLkZpbGVDaGFuZ2VkRXZlbnQgPSBGaWxlQ2hhbmdlZEV2ZW50O1xuLyoqXG4gKiBGaWxlSW5wdXQgcHJvdmlkZXMgYSBzdXJmYWNlIGZvciBmaWxlIHNlbGVjdGlvbi5cbiAqXG4gKiBJdCBzdXBwb3J0cyBkcmFnIGFuZCBkcm9wIG9mIHRoZSBmaWxlcyBhcyBpbnB1dC5cbiAqL1xudmFyIEZpbGVJbnB1dCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoRmlsZUlucHV0LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIEZpbGVJbnB1dCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgZmlsZV9pbnB1dF8xLkZpbGVJbnB1dFZpZXcoX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLkZJTEVfSU5QVVQsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIG5hbWU6IF9fMi5nZXROYW1lKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgIGFjY2VwdDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmFjY2VwdCkgP1xuICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmFjY2VwdCA6ICcnLFxuICAgICAgICAgICAgbXVsdGlwbGU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5tdWx0aXBsZSkgP1xuICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm11bHRpcGxlIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgY2hhbmdlOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIHZhciBpbnB1dCA9IGUudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGlmICgoaW5wdXQuZmlsZXMgIT0gbnVsbCkgJiZcbiAgICAgICAgICAgICAgICAgICAgKGlucHV0LmZpbGVzLmxlbmd0aCA+IDApICYmXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3ICYmXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uQ2hhbmdlKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uQ2hhbmdlKG5ldyBGaWxlQ2hhbmdlZEV2ZW50KGlucHV0Lm5hbWUsIGV4cG9ydHMubGlzdDJBcnJheShpbnB1dC5maWxlcykpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIEZpbGVJbnB1dDtcbn0oX18yLkFic3RyYWN0Q29udHJvbCkpO1xuZXhwb3J0cy5GaWxlSW5wdXQgPSBGaWxlSW5wdXQ7XG4vKipcbiAqIGxpc3QyQXJyYXkgY29udmVydHMgYSBGaWxlTGlzdCBpbnRvIGEgcGxhaW4gYXJyYXkgb2YgZmlsZXMuXG4gKi9cbmV4cG9ydHMubGlzdDJBcnJheSA9IGZ1bmN0aW9uIChsaXN0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0W2ldID0gbGlzdFtpXTtcbiAgICByZXR1cm4gcmV0O1xufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5GaWxlSW5wdXRWaWV3ID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgRmlsZUlucHV0VmlldyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBGaWxlSW5wdXRWaWV3KF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdpbnB1dCcsIHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUsICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5uYW1lLCAndHlwZSc6ICdmaWxlJywgJ2FjY2VwdCc6IF9fY29udGV4dC52YWx1ZXMuYWNjZXB0LCAnb25jaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLmNoYW5nZSwgJ211bHRpcGxlJzogX19jb250ZXh0LnZhbHVlcy5tdWx0aXBsZSB9LCBbXSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIEZpbGVJbnB1dFZpZXcucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBGaWxlSW5wdXRWaWV3LnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIEZpbGVJbnB1dFZpZXcucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBGaWxlSW5wdXRWaWV3LnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIEZpbGVJbnB1dFZpZXcucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIEZpbGVJbnB1dFZpZXcucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgRmlsZUlucHV0Vmlldy5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgRmlsZUlucHV0Vmlldy5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBGaWxlSW5wdXRWaWV3O1xufSgpKTtcbmV4cG9ydHMuRmlsZUlucHV0VmlldyA9IEZpbGVJbnB1dFZpZXc7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1maWxlLWlucHV0LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkZpbGVVcGxvYWRTdXJmYWNlID0gZXhwb3J0cy5GSUxFX1VQTE9BRF9TVVJGQUNFX1RFWFQgPSBleHBvcnRzLkZJTEVfVVBMT0FEX1NVUkZBQ0VfSU5QVVQgPSBleHBvcnRzLkZJTEVfVVBMT0FEX1NVUkZBQ0UgPSBleHBvcnRzLklOU1RSVUNUSU9OX1RFWFQgPSBleHBvcnRzLkZpbGVDaGFuZ2VkRXZlbnQgPSB2b2lkIDA7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgZmlsZV9pbnB1dF8xID0gcmVxdWlyZShcIi4uL2ZpbGUtaW5wdXRcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJGaWxlQ2hhbmdlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBmaWxlX2lucHV0XzEuRmlsZUNoYW5nZWRFdmVudDsgfSB9KTtcbnZhciBfXzEgPSByZXF1aXJlKFwiLi4vLi4vXCIpO1xudmFyIF9fMiA9IHJlcXVpcmUoXCIuLi9cIik7XG52YXIgZmlsZV91cGxvYWRfc3VyZmFjZV8xID0gcmVxdWlyZShcIi4vd21sL2ZpbGUtdXBsb2FkLXN1cmZhY2VcIik7XG5leHBvcnRzLklOU1RSVUNUSU9OX1RFWFQgPSAnQ2hvb3NlIGEgZmlsZSc7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLkZJTEVfVVBMT0FEX1NVUkZBQ0UgPSAnd3ctZmlsZS11cGxvYWQtc3VyZmFjZSc7XG5leHBvcnRzLkZJTEVfVVBMT0FEX1NVUkZBQ0VfSU5QVVQgPSAnd3ctZmlsZS11cGxvYWQtc3VyZmFjZV9faW5wdXQnO1xuZXhwb3J0cy5GSUxFX1VQTE9BRF9TVVJGQUNFX1RFWFQgPSAnd3ctZmlsZS11cGxvYWQtc3VyZmFjZV9fdGV4dCc7XG4vKipcbiAqIEZpbGVVcGxvYWRTdXJmYWNlIHByb3ZpZGVzIGEgc3VyZmFjZSBmb3IgZmlsZSBzZWxlY3Rpb24uXG4gKlxuICogSXQgc3VwcG9ydHMgZHJhZyBhbmQgZHJvcCBvZiB0aGUgZmlsZXMgYXMgaW5wdXQuXG4gKi9cbnZhciBGaWxlVXBsb2FkU3VyZmFjZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoRmlsZVVwbG9hZFN1cmZhY2UsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gRmlsZVVwbG9hZFN1cmZhY2UoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IGZpbGVfdXBsb2FkX3N1cmZhY2VfMS5GaWxlVXBsb2FkU3VyZmFjZVZpZXcoX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLkZJTEVfVVBMT0FEX1NVUkZBQ0UsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIHN0b3A6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZHJvcDogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5uYW1lKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm5hbWUgOiAnJztcbiAgICAgICAgICAgICAgICBpZiAoZS5kYXRhVHJhbnNmZXIgJiYgZS5kYXRhVHJhbnNmZXIuZmlsZXMubGVuZ3RoID4gMClcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMudmFsdWVzLmlucHV0Lm9uQ2hhbmdlKG5ldyBmaWxlX2lucHV0XzEuRmlsZUNoYW5nZWRFdmVudChuYW1lLCBmaWxlX2lucHV0XzEubGlzdDJBcnJheShlLmRhdGFUcmFuc2Zlci5maWxlcykpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbnB1dDoge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogZXhwb3J0cy5GSUxFX1VQTE9BRF9TVVJGQUNFX0lOUFVULFxuICAgICAgICAgICAgICAgIG5hbWU6IF9fMi5nZXROYW1lKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgICAgICBhY2NlcHQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5hY2NlcHQpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuYWNjZXB0IDogJycsXG4gICAgICAgICAgICAgICAgbXVsdGlwbGU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5tdWx0aXBsZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5tdWx0aXBsZSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMudmFsdWVzLnRleHQudmFsdWUgPSBlLnZhbHVlWzBdLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vbkNoYW5nZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uQ2hhbmdlKGUpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy52aWV3LmludmFsaWRhdGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGV4dDoge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogZXhwb3J0cy5GSUxFX1VQTE9BRF9TVVJGQUNFX1RFWFQsXG4gICAgICAgICAgICAgICAgdmFsdWU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy50ZXh0KSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LnRleHQgOiBleHBvcnRzLklOU1RSVUNUSU9OX1RFWFRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gRmlsZVVwbG9hZFN1cmZhY2U7XG59KF9fMi5BYnN0cmFjdENvbnRyb2wpKTtcbmV4cG9ydHMuRmlsZVVwbG9hZFN1cmZhY2UgPSBGaWxlVXBsb2FkU3VyZmFjZTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5GaWxlVXBsb2FkU3VyZmFjZVZpZXcgPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGZpbGVfaW5wdXRfMSA9IHJlcXVpcmUoXCIuLi8uLi9maWxlLWlucHV0XCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBGaWxlVXBsb2FkU3VyZmFjZVZpZXcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRmlsZVVwbG9hZFN1cmZhY2VWaWV3KF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY2xhc3NOYW1lLCAnb25kcmFnZW50ZXInOiBfX2NvbnRleHQudmFsdWVzLnN0b3AsICdvbmRyYWdvdmVyJzogX19jb250ZXh0LnZhbHVlcy5zdG9wLCAnb25kcm9wJzogX19jb250ZXh0LnZhbHVlcy5kcm9wIH0sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBmaWxlX2lucHV0XzEuRmlsZUlucHV0KHsgd3c6IHsgJ2NsYXNzTmFtZSc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQuY2xhc3NOYW1lLCAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQubmFtZSwgJ2FjY2VwdCc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQuYWNjZXB0LCAnbXVsdGlwbGUnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0Lm11bHRpcGxlLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0Lm9uQ2hhbmdlIH0gfSwgW10pLCB7IHd3OiB7ICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0LmNsYXNzTmFtZSwgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0Lm5hbWUsICdhY2NlcHQnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0LmFjY2VwdCwgJ211bHRpcGxlJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC5tdWx0aXBsZSwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC5vbkNoYW5nZSB9IH0pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdkaXYnLCB7ICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMudGV4dC5jbGFzc05hbWUgfSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnaDMnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dChfX2NvbnRleHQudmFsdWVzLnRleHQudmFsdWUpXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIF0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBGaWxlVXBsb2FkU3VyZmFjZVZpZXcucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBGaWxlVXBsb2FkU3VyZmFjZVZpZXcucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgRmlsZVVwbG9hZFN1cmZhY2VWaWV3LnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgRmlsZVVwbG9hZFN1cmZhY2VWaWV3LnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIEZpbGVVcGxvYWRTdXJmYWNlVmlldy5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgRmlsZVVwbG9hZFN1cmZhY2VWaWV3LnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIEZpbGVVcGxvYWRTdXJmYWNlVmlldy5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgRmlsZVVwbG9hZFN1cmZhY2VWaWV3LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIEZpbGVVcGxvYWRTdXJmYWNlVmlldztcbn0oKSk7XG5leHBvcnRzLkZpbGVVcGxvYWRTdXJmYWNlVmlldyA9IEZpbGVVcGxvYWRTdXJmYWNlVmlldztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWZpbGUtdXBsb2FkLXN1cmZhY2UuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmZvY3VzID0gZXhwb3J0cy5Gb2N1c0xvc3RFdmVudCA9IGV4cG9ydHMuRm9jdXNHYWluZWRFdmVudCA9IHZvaWQgMDtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vdXRpbFwiKTtcbi8qKlxuICogRm9jdXNHYWluZWRFdmVudFxuICovXG52YXIgRm9jdXNHYWluZWRFdmVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBGb2N1c0dhaW5lZEV2ZW50KG5hbWUpIHtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB9XG4gICAgcmV0dXJuIEZvY3VzR2FpbmVkRXZlbnQ7XG59KCkpO1xuZXhwb3J0cy5Gb2N1c0dhaW5lZEV2ZW50ID0gRm9jdXNHYWluZWRFdmVudDtcbi8qKlxuICogRm9jdXNMb3N0RXZlbnRcbiAqL1xudmFyIEZvY3VzTG9zdEV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEZvY3VzTG9zdEV2ZW50KG5hbWUpIHtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB9XG4gICAgcmV0dXJuIEZvY3VzTG9zdEV2ZW50O1xufSgpKTtcbmV4cG9ydHMuRm9jdXNMb3N0RXZlbnQgPSBGb2N1c0xvc3RFdmVudDtcbi8qKlxuICogZm9jdXMgRE9NIGhlbHBlci5cbiAqL1xuZXhwb3J0cy5mb2N1cyA9IGZ1bmN0aW9uICh2aWV3LCBpZCkge1xuICAgIHV0aWxfMS5nZXRCeUlkKHZpZXcsIGlkKVxuICAgICAgICAubWFwKGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmZvY3VzKCk7IH0pO1xufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWZvY3VzLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuLyoqXG4gKiBUaGUgZm9ybSBtb2R1bGUgZGVhbHMgd2l0aCBjb250cm9scyBzcGVjaWZpY2FsbHkgZm9yIGFjY2VwdGluZyB1c2VyIGlucHV0LlxuICovXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucmVtb3ZlTWVzc2FnZSA9IGV4cG9ydHMuc2V0TWVzc2FnZSA9IGV4cG9ydHMuZ2V0TGFiZWwgPSBleHBvcnRzLkFic3RyYWN0Rm9ybUNvbnRyb2wgPSB2b2lkIDA7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uL3V0aWxcIik7XG52YXIgZmVlZGJhY2tfMSA9IHJlcXVpcmUoXCIuL2ZlZWRiYWNrXCIpO1xuLyoqXG4gKiBBYnN0cmFjdEZvcm1Db250cm9sIHByb3ZpZGVzIGEgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBhXG4gKiBGb3JtQ29udHJvbC5cbiAqL1xudmFyIEFic3RyYWN0Rm9ybUNvbnRyb2wgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEFic3RyYWN0Rm9ybUNvbnRyb2wsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQWJzdHJhY3RGb3JtQ29udHJvbCgpIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gQWJzdHJhY3RGb3JtQ29udHJvbDtcbn0oZmVlZGJhY2tfMS5BYnN0cmFjdEZlZWRiYWNrQ29udHJvbCkpO1xuZXhwb3J0cy5BYnN0cmFjdEZvcm1Db250cm9sID0gQWJzdHJhY3RGb3JtQ29udHJvbDtcbi8qKlxuICogZ2V0TGFiZWwgZXh0cmFjdHMgdGhlIGxhYmVsIHZhbHVlIGZyb20gRnJvbUNvbnRyb2xBdHRycy5cbiAqL1xuZXhwb3J0cy5nZXRMYWJlbCA9IGZ1bmN0aW9uIChhdHRycykgeyByZXR1cm4gKGF0dHJzLnd3ICYmIGF0dHJzLnd3LmxhYmVsKSA/IGF0dHJzLnd3LmxhYmVsIDogJyc7IH07XG4vKipcbiAqIHNldE1lc3NhZ2UgaGVscGVyLlxuICpcbiAqIFNldHMgdGhlIG1lc3NhZ2Ugb24gdGhlIEhlbHAgd2lkZ2V0LlxuICovXG5leHBvcnRzLnNldE1lc3NhZ2UgPSBmdW5jdGlvbiAodmlldywgaWQsIG1zZykge1xuICAgIHV0aWxfMS5nZXRCeUlkKHZpZXcsIGlkKS5tYXAoZnVuY3Rpb24gKGgpIHsgaC5zZXRNZXNzYWdlKG1zZyk7IH0pO1xufTtcbi8qKlxuICogcmVtb3ZlTWVzc2FnZSBoZWxwZXIuXG4gKlxuICogUmVtb3ZlcyB0aGUgbWVzc2FnZSBmcm9tIHRoZSBIZWxwIHdpZGdldC5cbiAqL1xuZXhwb3J0cy5yZW1vdmVNZXNzYWdlID0gZnVuY3Rpb24gKHZpZXcsIGlkKSB7XG4gICAgdXRpbF8xLmdldEJ5SWQodmlldywgaWQpLm1hcChmdW5jdGlvbiAoaCkgeyBoLnJlbW92ZU1lc3NhZ2UoKTsgfSk7XG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Zm9ybS5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5IZWxwID0gZXhwb3J0cy5IRUxQID0gdm9pZCAwO1xudmFyIHdtbF8xID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgZmVlZGJhY2tfMSA9IHJlcXVpcmUoXCIuLi9mZWVkYmFja1wiKTtcbnZhciBfXzEgPSByZXF1aXJlKFwiLi4vLi4vXCIpO1xudmFyIGhlbHBfMSA9IHJlcXVpcmUoXCIuL3dtbC9oZWxwXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5IRUxQID0gJ3d3LWhlbHAnO1xuLyoqXG4gKiBIZWxwXG4gKi9cbnZhciBIZWxwID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhIZWxwLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIEhlbHAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IGhlbHBfMS5NYWluKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgaGVscDoge1xuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ2hlbHAnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpZDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmlkKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmlkIDogJycsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuSEVMUCwgX18xLmdldENsYXNzTmFtZShfdGhpcy5hdHRycykpLFxuICAgICAgICAgICAgICAgIHRleHQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy50ZXh0KSA/XG4gICAgICAgICAgICAgICAgICAgIFtkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShfdGhpcy5hdHRycy53dy50ZXh0KV0gOiBfdGhpcy5jaGlsZHJlblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIEhlbHAucHJvdG90eXBlLnNldE1lc3NhZ2UgPSBmdW5jdGlvbiAobXNnKSB7XG4gICAgICAgIGZlZWRiYWNrXzEuc2V0TWVzc2FnZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLmhlbHAud21sLmlkLCBtc2cpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIEhlbHAucHJvdG90eXBlLnJlbW92ZU1lc3NhZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZlZWRiYWNrXzEucmVtb3ZlTWVzc2FnZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLmhlbHAud21sLmlkKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICByZXR1cm4gSGVscDtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLkhlbHAgPSBIZWxwO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheXMgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXlzKSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcbiAgICAgICAgICAgIHJba10gPSBhW2pdO1xuICAgIHJldHVybiByO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgnc3BhbicsIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaGVscC53bWwuaWQgfSwgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5oZWxwLmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmhlbHAuY2xhc3NOYW1lIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQudmFsdWVzLmhlbHAudGV4dCkpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWhlbHAuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0VmFsdWUgPSBleHBvcnRzLmdldERpc2FibGVkID0gZXhwb3J0cy5nZXROYW1lID0gZXhwb3J0cy5BYnN0cmFjdENvbnRyb2wgPSBleHBvcnRzLkV2ZW50ID0gdm9pZCAwO1xuLyoqXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyB0aGUgcGFyZW50IGludGVyZmFjZXMgZm9yIG1vc3Qgb2YgdGhlXG4gKiB3aWRnZXRzIGNvbnNpZGVyZWQgJ2NvbnRyb2xzJy5cbiAqXG4gKiBDb250cm9scyBhbGxvdyB1c2VycyB0byBtYW5pcHVsYXRlIHRoZSBzdGF0ZSBvZiBhbiBhcHBsaWNhdGlvblxuICogYnkgaW50ZXJhY3Rpbmcgd2l0aCB3aWRnZXRzIG9uIHNjcmVlbi4gSW4gc2ltcGxlciB0ZXJtcyxcbiAqIHRoZXkgYXJlIHRoZSB3aWRnZXRzIHRoYXQgYWNjZXB0IHVzZXIgaW5wdXQgb3IgdHJpZ2dlclxuICogcmVhY3Rpb25zIHdoZW4gdGhlIHVzZXIgbWFuaXB1bGF0ZXMgdGhlbS5cbiAqXG4gKiBHZW5lcmFsbHksIHdlIHVzZSBhIHN0cmVhbWluZyBiYXNlZCB3b3JrZmxvdywgdGhhdCBpc1xuICogYXMgdGhlIHVzZXIgcHJlZm9ybXMgYSBzdXBwb3J0ZWQgYWN0aW9uIGFuZCBldmVudCBpcyBnZW5lcmF0ZWRcbiAqIGVhY2ggYW5kIGV2ZXJ5IHRpbWUgYW5kIHNvbWUgaGFuZGxlciBpcyBhcHBsaWVkIHRvIHRoZSBldmVudC5cbiAqL1xuLyoqIEBpbXBvcnRzICovXG52YXIgd21sXzEgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbFwiKTtcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuLyoqXG4gKiBFdmVudCBpcyB0aGUgcGFyZW50IGNsYXNzIG9mIGFsbCBldmVudHMgZ2VuZXJhdGVkIGJ5IGNvbnRyb2xzLlxuICovXG52YXIgRXZlbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRXZlbnQobmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gRXZlbnQ7XG59KCkpO1xuZXhwb3J0cy5FdmVudCA9IEV2ZW50O1xuLyoqXG4gKiBBYnN0cmFjdENvbnRyb2wgaW1wbGVtZW50cyB0aGUgbWV0aG9kcyBvZiB0aGUgQ29udHJvbCBpbnRlcmZhY2UuXG4gKi9cbnZhciBBYnN0cmFjdENvbnRyb2wgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEFic3RyYWN0Q29udHJvbCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBBYnN0cmFjdENvbnRyb2woKSB7XG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIEFic3RyYWN0Q29udHJvbDtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLkFic3RyYWN0Q29udHJvbCA9IEFic3RyYWN0Q29udHJvbDtcbi8qKlxuICogZ2V0TmFtZVxuICovXG5leHBvcnRzLmdldE5hbWUgPSBmdW5jdGlvbiAoYXR0cnMpIHtcbiAgICByZXR1cm4gKGF0dHJzLnd3ICYmIGF0dHJzLnd3Lm5hbWUpID8gYXR0cnMud3cubmFtZSA6ICcnO1xufTtcbi8qKlxuICogZ2V0RGlzYWJsZWRcbiAqL1xuZXhwb3J0cy5nZXREaXNhYmxlZCA9IGZ1bmN0aW9uIChhdHRycykge1xuICAgIHJldHVybiAoYXR0cnMud3cgJiYgYXR0cnMud3cuZGlzYWJsZWQpID8gYXR0cnMud3cuZGlzYWJsZWQgOiB1bmRlZmluZWQ7XG59O1xuLyoqXG4gKiBnZXRWYWx1ZVxuICovXG5leHBvcnRzLmdldFZhbHVlID0gZnVuY3Rpb24gKGF0dHJzKSB7XG4gICAgcmV0dXJuIChhdHRycy53dyAmJiBhdHRycy53dy52YWx1ZSkgPyBtYXliZV8xLmp1c3QoYXR0cnMud3cudmFsdWUpIDogbWF5YmVfMS5ub3RoaW5nKCk7XG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQWRkT24gPSBleHBvcnRzLklucHV0R3JvdXAgPSBleHBvcnRzLklOUFVUX0dST1VQX0JVVFRPTl9BRERPTiA9IGV4cG9ydHMuSU5QVVRfR1JPVVBfQURET04gPSBleHBvcnRzLklOUFVUX0dST1VQID0gdm9pZCAwO1xudmFyIHdtbF8xID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciBpbnB1dF9ncm91cF8xID0gcmVxdWlyZShcIi4vd21sL2lucHV0LWdyb3VwXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5JTlBVVF9HUk9VUCA9ICd3dy1pbnB1dC1ncm91cCc7XG5leHBvcnRzLklOUFVUX0dST1VQX0FERE9OID0gJ3d3LWlucHV0LWdyb3VwX19hZGRvbic7XG5leHBvcnRzLklOUFVUX0dST1VQX0JVVFRPTl9BRERPTiA9ICd3dy1pbnB1dC1ncm91cF9fYnV0dG9uLWFkZG9uJztcbi8qKlxuICogSW5wdXRHcm91cCBhbGxvd3MgYW4gaW5wdXQgdG8gYmUgd3JhcHBlZCB0b2dldGhlciB3aXRoIG90aGVyIGNvbnRyb2xzIHRvXG4gKiBhcHBlYXIgYXMgb25lLlxuICpcbiAqIFRoaXMgaXMgdXNlZnVsIGZvciBjcmVhdGluZyBpbnB1dHMgdGhhdCBtYXkgaGF2ZSByZWxhdGVkIGZpZWxkcyB0aGF0IHNob3VsZFxuICogYmUgbW9kaWZpZWQgd2hlbiBjaGFuZ2VkLiBGb3IgZXhhbXBsZSwgZW50ZXJpbmcgYW4gYW1vdW50IGFuZCBjdXJyZW5jeSBpbiB0aGVcbiAqIHNhbWUgcGxhY2UuXG4gKlxuICogICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAqICB8IFRURCBeIHwgNTAwMC4wMCAgICAgICAgICAgICAgICB8XG4gKiAgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tK1xuICovXG52YXIgSW5wdXRHcm91cCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoSW5wdXRHcm91cCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBJbnB1dEdyb3VwKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyBpbnB1dF9ncm91cF8xLklucHV0R3JvdXBWaWV3KF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5JTlBVVF9HUk9VUCwgX18xLmdldENsYXNzTmFtZShfdGhpcy5hdHRycykpLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBJbnB1dEdyb3VwO1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuSW5wdXRHcm91cCA9IElucHV0R3JvdXA7XG4vKipcbiAqIEFkZE9uIGlzIHVzZWQgdG8gYXR0YWNoIHRoZSBleHRyYSB0ZXh0IG9yIGNvbnRyb2wgdG8gdGhlIGlucHV0LlxuICovXG52YXIgQWRkT24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEFkZE9uLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIEFkZE9uKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyBpbnB1dF9ncm91cF8xLkFkZE9uVmlldyhfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIGlkOiBfXzEuZ2V0SWQoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KF90aGlzLmF0dHJzLmJ1dHRvbiA/XG4gICAgICAgICAgICAgICAgZXhwb3J0cy5JTlBVVF9HUk9VUF9CVVRUT05fQURET04gOlxuICAgICAgICAgICAgICAgIGV4cG9ydHMuSU5QVVRfR1JPVVBfQURET04sIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gQWRkT247XG59KHdtbF8xLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5BZGRPbiA9IEFkZE9uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheXMgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXlzKSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcbiAgICAgICAgICAgIHJba10gPSBhW2pdO1xuICAgIHJldHVybiByO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQWRkT25WaWV3ID0gZXhwb3J0cy5JbnB1dEdyb3VwVmlldyA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIElucHV0R3JvdXBWaWV3ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIElucHV0R3JvdXBWaWV3KF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY2xhc3NOYW1lIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQuY2hpbGRyZW4pKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIElucHV0R3JvdXBWaWV3LnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgSW5wdXRHcm91cFZpZXcucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgSW5wdXRHcm91cFZpZXcucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBJbnB1dEdyb3VwVmlldy5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBJbnB1dEdyb3VwVmlldy5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgSW5wdXRHcm91cFZpZXcucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgSW5wdXRHcm91cFZpZXcucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIElucHV0R3JvdXBWaWV3LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIElucHV0R3JvdXBWaWV3O1xufSgpKTtcbmV4cG9ydHMuSW5wdXRHcm91cFZpZXcgPSBJbnB1dEdyb3VwVmlldztcbjtcbnZhciBBZGRPblZpZXcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQWRkT25WaWV3KF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY2xhc3NOYW1lIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQuY2hpbGRyZW4pKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIEFkZE9uVmlldy5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIEFkZE9uVmlldy5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBBZGRPblZpZXcucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBBZGRPblZpZXcucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgQWRkT25WaWV3LnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBBZGRPblZpZXcucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgQWRkT25WaWV3LnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBBZGRPblZpZXcucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gQWRkT25WaWV3O1xufSgpKTtcbmV4cG9ydHMuQWRkT25WaWV3ID0gQWRkT25WaWV3O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5wdXQtZ3JvdXAuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTGFiZWwgPSBleHBvcnRzLkxBQkVMID0gdm9pZCAwO1xudmFyIHdtbF8xID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciBsYWJlbF8xID0gcmVxdWlyZShcIi4vd21sL2xhYmVsXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5MQUJFTCA9ICd3dy1sYWJlbCc7XG4vKipcbiAqIExhYmVsXG4gKi9cbnZhciBMYWJlbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTGFiZWwsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTGFiZWwoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IGxhYmVsXzEuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuTEFCRUwsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgICAgICBmb3I6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5mb3IpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuZm9yIDogJycsXG4gICAgICAgICAgICAgICAgdGV4dDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnRleHQpID9cbiAgICAgICAgICAgICAgICAgICAgW2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKF90aGlzLmF0dHJzLnd3LnRleHQpXSA6IF90aGlzLmNoaWxkcmVuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIExhYmVsO1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuTGFiZWwgPSBMYWJlbDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2xhYmVsJywgeyAnZm9yJzogX19jb250ZXh0LnZhbHVlcy5sYWJlbC5mb3IsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMubGFiZWwuY2xhc3NOYW1lIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQudmFsdWVzLmxhYmVsLnRleHQpKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1sYWJlbC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NdWx0aVNlbGVjdCA9IGV4cG9ydHMuSXRlbXNDaGFuZ2VkRXZlbnQgPSBleHBvcnRzLkRFRkFVTFRfRk9OVF9JTkNSRU1FTlQgPSBleHBvcnRzLkRFRkFVTFRfSU5QVVRfV0lEVEggPSBleHBvcnRzLk1VTFRJX1NFTEVDVF9UQUcgPSBleHBvcnRzLk1VTFRJX1NFTEVDVF9JTlBVVCA9IGV4cG9ydHMuTVVMVElfU0VMRUNUX0NPTlRFTlQgPSBleHBvcnRzLk1VTFRJX1NFTEVDVCA9IGV4cG9ydHMuVGVybUNoYW5nZWRFdmVudCA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9tdWx0aS1zZWxlY3RcIik7XG52YXIgb3JpZW50YXRpb25fMSA9IHJlcXVpcmUoXCIuLi8uLi9jb250ZW50L29yaWVudGF0aW9uXCIpO1xudmFyIGZvcm1fMSA9IHJlcXVpcmUoXCIuLi9mb3JtXCIpO1xudmFyIHNlYXJjaF8xID0gcmVxdWlyZShcIi4uL3NlYXJjaFwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlRlcm1DaGFuZ2VkRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHNlYXJjaF8xLlRlcm1DaGFuZ2VkRXZlbnQ7IH0gfSk7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciBfXzIgPSByZXF1aXJlKFwiLi4vXCIpO1xudmFyIGZlZWRiYWNrXzEgPSByZXF1aXJlKFwiLi4vZmVlZGJhY2tcIik7XG52YXIgYWN0aXZlXzEgPSByZXF1aXJlKFwiLi4vLi4vY29udGVudC9zdGF0ZS9hY3RpdmVcIik7XG52YXIgZGlzYWJsZWRfMSA9IHJlcXVpcmUoXCIuLi8uLi9jb250ZW50L3N0YXRlL2Rpc2FibGVkXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5NVUxUSV9TRUxFQ1QgPSAnd3ctbXVsdGktc2VsZWN0JztcbmV4cG9ydHMuTVVMVElfU0VMRUNUX0NPTlRFTlQgPSAnd3ctbXVsdGktc2VsZWN0X19jb250ZW50JztcbmV4cG9ydHMuTVVMVElfU0VMRUNUX0lOUFVUID0gJ3d3LW11bHRpLXNlbGVjdF9faW5wdXQnO1xuZXhwb3J0cy5NVUxUSV9TRUxFQ1RfVEFHID0gJ3d3LW11bHRpLXNlbGVjdF9fdGFnJztcbi8vL2NsYXNzTmFtZXM6ZW5kXG5leHBvcnRzLkRFRkFVTFRfSU5QVVRfV0lEVEggPSA1MDtcbmV4cG9ydHMuREVGQVVMVF9GT05UX0lOQ1JFTUVOVCA9IDc7XG4vKipcbiAqIEl0ZW1zQ2hhbmdlZEV2ZW50XG4gKi9cbnZhciBJdGVtc0NoYW5nZWRFdmVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoSXRlbXNDaGFuZ2VkRXZlbnQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gSXRlbXNDaGFuZ2VkRXZlbnQoKSB7XG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIEl0ZW1zQ2hhbmdlZEV2ZW50O1xufShfXzIuRXZlbnQpKTtcbmV4cG9ydHMuSXRlbXNDaGFuZ2VkRXZlbnQgPSBJdGVtc0NoYW5nZWRFdmVudDtcbi8qKlxuICogTXVsdGlTZWxlY3RcbiAqL1xudmFyIE11bHRpU2VsZWN0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhNdWx0aVNlbGVjdCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBNdWx0aVNlbGVjdCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHJvb3Q6IHtcbiAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdyb290J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5kaXNhYmxlZCkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5kaXNhYmxlZCA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlkOiBfXzEuZ2V0SWQoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLk1VTFRJX1NFTEVDVCwgX18xLmdldENsYXNzTmFtZShfdGhpcy5hdHRycyksIGZlZWRiYWNrXzEuZ2V0VmFsaWRpdHlDbGFzc05hbWUoX3RoaXMuYXR0cnMpLCBvcmllbnRhdGlvbl8xLmdldEJsb2NrQ2xhc3NOYW1lKF90aGlzLmF0dHJzKSwgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmRpc2FibGVkKSA/XG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVkXzEuRElTQUJMRUQgOiAnJylcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250cm9sOiB7XG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAncm9vdCdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGFiZWw6IHtcbiAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdsYWJlbCdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRleHQ6IGZvcm1fMS5nZXRMYWJlbChfdGhpcy5hdHRycylcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZWFyY2g6IHtcbiAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdzZWFyY2gnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBibG9jazogX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuYmxvY2sgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIGl0ZW1UZW1wbGF0ZTogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lml0ZW1UZW1wbGF0ZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5pdGVtVGVtcGxhdGUgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgbm9JdGVtc1RlbXBsYXRlOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cubm9JdGVtc1RlbXBsYXRlKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm5vSXRlbXNUZW1wbGF0ZSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBvblNlYXJjaDogZnVuY3Rpb24gKGV2dCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cub25TZWFyY2gpXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vblNlYXJjaChldnQpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25TZWxlY3Q6IGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBfYS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucHVzaCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmZpcmVDaGFuZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucmVkcmF3KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnbWVzc2FnZSdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRleHQ6IGZlZWRiYWNrXzEuZ2V0TWVzc2FnZShfdGhpcy5hdHRycylcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBleHBvcnRzLk1VTFRJX1NFTEVDVF9DT05URU5ULFxuICAgICAgICAgICAgICAgIG9uZm9jdXM6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmZvY3VzKCk7IH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0YWdzOiB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuTVVMVElfU0VMRUNUX1RBRywgZmVlZGJhY2tfMS5nZXRWYWxpZGl0eUNsYXNzTmFtZShfdGhpcy5hdHRycykpLFxuICAgICAgICAgICAgICAgIHZhbHVlOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cudmFsdWUpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cudmFsdWUgOiBbXSxcbiAgICAgICAgICAgICAgICBkaXNhYmxlZDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmRpc2FibGVkKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmRpc2FibGVkIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgaGFzOiBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy52YWx1ZXMudGFncy52YWx1ZS5sZW5ndGggPiAwOyB9LFxuICAgICAgICAgICAgICAgIGdldFRleHQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5zdHJpbmdpZmllcikgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5zdHJpbmdpZmllciA6IGZ1bmN0aW9uICh2KSB7IHJldHVybiBTdHJpbmcodik7IH0sXG4gICAgICAgICAgICAgICAgb25EaXNtaXNzOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gTnVtYmVyKGUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnZhbHVlcy50YWdzLnZhbHVlLnNwbGljZShpZHgsIDEpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5maXJlQ2hhbmdlKCk7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnJlZHJhdygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbnB1dDoge1xuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ2lucHV0J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBleHBvcnRzLk1VTFRJX1NFTEVDVF9JTlBVVCxcbiAgICAgICAgICAgICAgICBuYW1lOiBfXzIuZ2V0TmFtZShfdGhpcy5hdHRycyksXG4gICAgICAgICAgICAgICAgaW5wdXRXaWR0aDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmlucHV0V2lkdGgpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuaW5wdXRXaWR0aCA6IGV4cG9ydHMuREVGQVVMVF9JTlBVVF9XSURUSCxcbiAgICAgICAgICAgICAgICBmb250SW5jcmVtZW50OiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZm9udEluY3JlbWVudCkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5mb250SW5jcmVtZW50IDogZXhwb3J0cy5ERUZBVUxUX0ZPTlRfSU5DUkVNRU5ULFxuICAgICAgICAgICAgICAgIGRpc2FibGVkOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZGlzYWJsZWQpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuZGlzYWJsZWQgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgb25TZWFyY2g6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghX3RoaXMudmFsdWVzLnJvb3QuZGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmdyb3coZS52YWx1ZS5sZW5ndGggKyAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vblNlYXJjaClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vblNlYXJjaChlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZW51OiB7XG4gICAgICAgICAgICAgICAgd21sOiB7IGlkOiAnbWVudScgfSxcbiAgICAgICAgICAgICAgICBuYW1lOiBfXzIuZ2V0TmFtZShfdGhpcy5hdHRycyksXG4gICAgICAgICAgICAgICAgYmxvY2s6IHRydWUsXG4gICAgICAgICAgICAgICAgb25TZWxlY3Q6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnZhbHVlcy50YWdzLnZhbHVlLnB1c2goZS52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmZpcmVDaGFuZ2UoKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucmVkcmF3KCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpdGVtVGVtcGxhdGU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5pdGVtVGVtcGxhdGUpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuaXRlbVRlbXBsYXRlIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIG5vSXRlbXNUZW1wbGF0ZTogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm5vSXRlbXNUZW1wbGF0ZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5ub0l0ZW1zVGVtcGxhdGUgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgc3RyaW5naWZpZXI6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5zdHJpbmdpZmllcikgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5zdHJpbmdpZmllciA6IHVuZGVmaW5lZFxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgTXVsdGlTZWxlY3QucHJvdG90eXBlLmZpcmVDaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmF0dHJzLnd3ICYmIHRoaXMuYXR0cnMud3cub25DaGFuZ2UpXG4gICAgICAgICAgICB0aGlzLmF0dHJzLnd3Lm9uQ2hhbmdlKG5ldyBJdGVtc0NoYW5nZWRFdmVudChfXzIuZ2V0TmFtZSh0aGlzLmF0dHJzKSwgdGhpcy52YWx1ZXMudGFncy52YWx1ZS5zbGljZSgpKSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIE11bHRpU2VsZWN0LnByb3RvdHlwZS5ncm93ID0gZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgdmFyIG1JbnB1dCA9IHV0aWxfMS5nZXRCeUlkKHRoaXMudmlldywgdGhpcy52YWx1ZXMuaW5wdXQud21sLmlkKTtcbiAgICAgICAgaWYgKG1JbnB1dC5pc05vdGhpbmcoKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdmFyIGkgPSBtSW5wdXQuZ2V0KCk7XG4gICAgICAgIHZhciBtRG9tID0gdXRpbF8xLmdldEJ5SWQoaS52aWV3LCBpLnZhbHVlcy53bWwuaWQpO1xuICAgICAgICBpZiAobURvbS5pc05vdGhpbmcoKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdmFyIGRvbSA9IG1Eb20uZ2V0KCk7XG4gICAgICAgIGRvbS5zdHlsZS53aWR0aCA9IG4gKiB0aGlzLnZhbHVlcy5pbnB1dC5mb250SW5jcmVtZW50ICsgXCJweFwiO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBNdWx0aVNlbGVjdC5wcm90b3R5cGUucmVkcmF3ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnZpZXcuaW52YWxpZGF0ZSgpO1xuICAgICAgICB0aGlzLmZvY3VzKCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgTXVsdGlTZWxlY3QucHJvdG90eXBlLnNldE1lc3NhZ2UgPSBmdW5jdGlvbiAobXNnKSB7XG4gICAgICAgIGZvcm1fMS5zZXRNZXNzYWdlKHRoaXMudmlldywgdGhpcy52YWx1ZXMubWVzc2FnZXMud21sLmlkLCBtc2cpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIE11bHRpU2VsZWN0LnByb3RvdHlwZS5yZW1vdmVNZXNzYWdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmb3JtXzEucmVtb3ZlTWVzc2FnZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLm1lc3NhZ2VzLndtbC5pZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgTXVsdGlTZWxlY3QucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIChyZXN1bHRzKSB7XG4gICAgICAgIHNlYXJjaF8xLnVwZGF0ZU1lbnUodGhpcy52aWV3LCB0aGlzLnZhbHVlcy5tZW51LndtbC5pZCwgcmVzdWx0cyk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgTXVsdGlTZWxlY3QucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlYXJjaF8xLm9wZW5NZW51KHRoaXMudmlldywgdGhpcy52YWx1ZXMubWVudS53bWwuaWQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIE11bHRpU2VsZWN0LnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2VhcmNoXzEuY2xvc2VNZW51KHRoaXMudmlldywgdGhpcy52YWx1ZXMubWVudS53bWwuaWQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIE11bHRpU2VsZWN0LnByb3RvdHlwZS5mb2N1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZ2V0SW5wdXQodGhpcykubWFwKGZ1bmN0aW9uIChpKSB7IHJldHVybiBpLmZvY3VzKCk7IH0pO1xuICAgICAgICBnZXRSb290KHRoaXMpLm1hcChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5jbGFzc0xpc3QuYWRkKGFjdGl2ZV8xLkFDVElWRSk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIHB1c2ggYSB2YWx1ZSBvbnRvIHRoZSBlbmQgb2YgdGhlIGludGVybmFsIHN0YWNrLlxuICAgICAqL1xuICAgIE11bHRpU2VsZWN0LnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIHRoaXMudmFsdWVzLnRhZ3MudmFsdWUucHVzaCh2YWx1ZSk7XG4gICAgICAgIHRoaXMuZmlyZUNoYW5nZSgpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIHJldHVybiBNdWx0aVNlbGVjdDtcbn0oZm9ybV8xLkFic3RyYWN0Rm9ybUNvbnRyb2wpKTtcbmV4cG9ydHMuTXVsdGlTZWxlY3QgPSBNdWx0aVNlbGVjdDtcbnZhciBnZXRJbnB1dCA9IGZ1bmN0aW9uIChtKSB7XG4gICAgcmV0dXJuIHV0aWxfMS5nZXRCeUlkKG0udmlldywgbS52YWx1ZXMuaW5wdXQud21sLmlkKTtcbn07XG52YXIgZ2V0Um9vdCA9IGZ1bmN0aW9uIChtKSB7XG4gICAgcmV0dXJuIHV0aWxfMS5nZXRCeUlkKG0udmlldywgbS52YWx1ZXMucm9vdC53bWwuaWQpO1xufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGxhYmVsXzEgPSByZXF1aXJlKFwiLi4vLi4vbGFiZWxcIik7XG47XG52YXIgaGVscF8xID0gcmVxdWlyZShcIi4uLy4uL2hlbHBcIik7XG47XG52YXIgdGFnXzEgPSByZXF1aXJlKFwiLi4vLi4vdGFnXCIpO1xuO1xudmFyIHNlYXJjaF8xID0gcmVxdWlyZShcIi4uLy4uL3NlYXJjaFwiKTtcbjtcbnZhciByZXN1bHRzX21lbnVfMSA9IHJlcXVpcmUoXCIuLi8uLi9yZXN1bHRzLW1lbnVcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgnZGl2JywgeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMucm9vdC5jbGFzc05hbWUgfSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGxhYmVsXzEuTGFiZWwoeyB3dzogeyAnZm9yJzogX19jb250ZXh0LnZhbHVlcy5yb290LmlkLCAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMubGFiZWwudGV4dCB9IH0sIFtdKSwgeyB3dzogeyAnZm9yJzogX19jb250ZXh0LnZhbHVlcy5yb290LmlkLCAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMubGFiZWwudGV4dCB9IH0pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdkaXYnLCB7ICdvbmNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5jb250ZW50Lm9uZm9jdXMsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY29udGVudC5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKChfX2NvbnRleHQudmFsdWVzLnRhZ3MuaGFzKCkpID9cbiAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIChfX3NwcmVhZEFycmF5cyhfX2ZvckluKF9fY29udGV4dC52YWx1ZXMudGFncy52YWx1ZSwgZnVuY3Rpb24gKHZhbHVlLCBpZHgsIF8kJGFsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFnXzEuVGFnKHsgd3c6IHsgJ25hbWUnOiBTdHJpbmcoaWR4KSwgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLnRhZ3MuZ2V0VGV4dCh2YWx1ZSksICdkaXNhYmxlZCc6IF9fY29udGV4dC52YWx1ZXMudGFncy5kaXNhYmxlZCwgJ2NsYXNzTmFtZSc6IF9fY29udGV4dC52YWx1ZXMudGFncy5jbGFzc05hbWUsICdvbkRpc21pc3MnOiBfX2NvbnRleHQudmFsdWVzLnRhZ3Mub25EaXNtaXNzIH0gfSwgW10pLCB7IHd3OiB7ICduYW1lJzogU3RyaW5nKGlkeCksICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy50YWdzLmdldFRleHQodmFsdWUpLCAnZGlzYWJsZWQnOiBfX2NvbnRleHQudmFsdWVzLnRhZ3MuZGlzYWJsZWQsICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLnRhZ3MuY2xhc3NOYW1lLCAnb25EaXNtaXNzJzogX19jb250ZXh0LnZhbHVlcy50YWdzLm9uRGlzbWlzcyB9IH0pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtdKTsgfSkpKTsgfSkoKSA6XG4gICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7IHJldHVybiAoW1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCgnJylcbiAgICAgICAgICAgICAgICAgICAgXSk7IH0pKCkpLCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHNlYXJjaF8xLklucHV0KHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQud21sLmlkIH0sIHd3OiB7ICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0LmNsYXNzTmFtZSwgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0Lm5hbWUsICdkaXNhYmxlZCc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQuZGlzYWJsZWQsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQub25TZWFyY2ggfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQud21sLmlkIH0sIHd3OiB7ICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0LmNsYXNzTmFtZSwgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0Lm5hbWUsICdkaXNhYmxlZCc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQuZGlzYWJsZWQsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQub25TZWFyY2ggfSB9KVxuICAgICAgICAgICAgICAgIF0pKSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyByZXN1bHRzX21lbnVfMS5SZXN1bHRzTWVudSh7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLm1lbnUud21sLmlkIH0sIHd3OiB7ICdibG9jayc6IF9fY29udGV4dC52YWx1ZXMubWVudS5ibG9jaywgJ2hpZGRlbic6IHRydWUsICdvblNlbGVjdCc6IF9fY29udGV4dC52YWx1ZXMubWVudS5vblNlbGVjdCwgJ25vSXRlbXNUZW1wbGF0ZSc6IF9fY29udGV4dC52YWx1ZXMubWVudS5ub0l0ZW1zVGVtcGxhdGUsICdpdGVtVGVtcGxhdGUnOiBfX2NvbnRleHQudmFsdWVzLm1lbnUuaXRlbVRlbXBsYXRlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLm1lbnUuc3RyaW5naWZpZXIgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubWVudS53bWwuaWQgfSwgd3c6IHsgJ2Jsb2NrJzogX19jb250ZXh0LnZhbHVlcy5tZW51LmJsb2NrLCAnaGlkZGVuJzogdHJ1ZSwgJ29uU2VsZWN0JzogX19jb250ZXh0LnZhbHVlcy5tZW51Lm9uU2VsZWN0LCAnbm9JdGVtc1RlbXBsYXRlJzogX19jb250ZXh0LnZhbHVlcy5tZW51Lm5vSXRlbXNUZW1wbGF0ZSwgJ2l0ZW1UZW1wbGF0ZSc6IF9fY29udGV4dC52YWx1ZXMubWVudS5pdGVtVGVtcGxhdGUsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMubWVudS5zdHJpbmdpZmllciB9IH0pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGhlbHBfMS5IZWxwKHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubWVzc2FnZXMud21sLmlkIH0sIHd3OiB7ICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5tZXNzYWdlcy50ZXh0IH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLm1lc3NhZ2VzLndtbC5pZCB9LCB3dzogeyAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMubWVzc2FnZXMudGV4dCB9IH0pXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW11bHRpLXNlbGVjdC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5QYWdpbmF0b3IgPSBleHBvcnRzLlBvc2l0aW9uVmlld0NvbnRleHQgPSBleHBvcnRzLlBhZ2VDaGFuZ2VkRXZlbnQgPSBleHBvcnRzLlBBR0lOQVRPUl9MQVNUID0gZXhwb3J0cy5QQUdJTkFUT1JfTkVYVCA9IGV4cG9ydHMuUEFHSU5BVE9SX1BPU0lUSU9OID0gZXhwb3J0cy5QQUdJTkFUT1JfUFJFVklPVVMgPSBleHBvcnRzLlBBR0lOQVRPUl9GSVJTVCA9IGV4cG9ydHMuUEFHSU5BVE9SID0gdm9pZCAwO1xudmFyIHdtbF8xID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgdGltZXJfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvY29udHJvbC90aW1lclwiKTtcbnZhciBkaXNhYmxlZF8xID0gcmVxdWlyZShcIi4uLy4uL2NvbnRlbnQvc3RhdGUvZGlzYWJsZWRcIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciBfXzIgPSByZXF1aXJlKFwiLi4vXCIpO1xudmFyIHBhZ2luYXRvcl8xID0gcmVxdWlyZShcIi4vd21sL3BhZ2luYXRvclwiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuUEFHSU5BVE9SID0gJ3d3LXBhZ2luYXRvcic7XG5leHBvcnRzLlBBR0lOQVRPUl9GSVJTVCA9ICd3dy1wYWdpbmF0b3JfX2ZpcnN0JztcbmV4cG9ydHMuUEFHSU5BVE9SX1BSRVZJT1VTID0gJ3d3LXBhZ2luYXRvcl9fcHJldmlvdXMnO1xuZXhwb3J0cy5QQUdJTkFUT1JfUE9TSVRJT04gPSAnd3ctcGFnaW5hdG9yX19wb3NpdGlvbic7XG5leHBvcnRzLlBBR0lOQVRPUl9ORVhUID0gJ3d3LXBhZ2luYXRvcl9fbmV4dCc7XG5leHBvcnRzLlBBR0lOQVRPUl9MQVNUID0gJ3d3LXBhZ2luYXRvcl9fbGFzdCc7XG4vKipcbiAqIFBhZ2VDaGFuZ2VkRXZlbnQgaW5kaWNhdGluZyB0aGUgY3VycmVudCBwYWdlIGhhcyBiZWVuIGNoYW5nZWQuXG4gKi9cbnZhciBQYWdlQ2hhbmdlZEV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhQYWdlQ2hhbmdlZEV2ZW50LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFBhZ2VDaGFuZ2VkRXZlbnQoKSB7XG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIFBhZ2VDaGFuZ2VkRXZlbnQ7XG59KF9fMi5FdmVudCkpO1xuZXhwb3J0cy5QYWdlQ2hhbmdlZEV2ZW50ID0gUGFnZUNoYW5nZWRFdmVudDtcbi8qKlxuICogUG9zaXRpb25WaWV3Q29udGV4dCBjb250YWlucyB0aGUgaW5mbyBuZWVkZWQgdG8gcmVuZGVyIHRoZSBwb3NpdG9uIHBhcnQgb2ZcbiAqIHRoZSBwYWdpbmF0b3IuXG4gKi9cbnZhciBQb3NpdGlvblZpZXdDb250ZXh0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFBvc2l0aW9uVmlld0NvbnRleHQoY2xhc3NOYW1lLCBjdXJyZW50LCB0b3RhbCwgb25DaGFuZ2UpIHtcbiAgICAgICAgdGhpcy5jbGFzc05hbWUgPSBjbGFzc05hbWU7XG4gICAgICAgIHRoaXMuY3VycmVudCA9IGN1cnJlbnQ7XG4gICAgICAgIHRoaXMudG90YWwgPSB0b3RhbDtcbiAgICAgICAgdGhpcy5vbkNoYW5nZSA9IG9uQ2hhbmdlO1xuICAgIH1cbiAgICByZXR1cm4gUG9zaXRpb25WaWV3Q29udGV4dDtcbn0oKSk7XG5leHBvcnRzLlBvc2l0aW9uVmlld0NvbnRleHQgPSBQb3NpdGlvblZpZXdDb250ZXh0O1xuLyoqXG4gKiBQYWdpbmF0b3IgcHJvdmlkZXMgYSBjb250cm9sIGZvciBuYXZpZ2F0aW5nIHBhZ2VkIGRhdGEsIHJlc3VsdHMsIHZpZXcgZXRjLlxuICovXG52YXIgUGFnaW5hdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhQYWdpbmF0b3IsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gUGFnaW5hdG9yKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyBwYWdpbmF0b3JfMS5QYWdpbmF0b3JWaWV3KF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5QQUdJTkFUT1IsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIGN1cnJlbnQ6IHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmN1cnJlbnQpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuY3VycmVudCA6IDEsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdG90YWw6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy50b3RhbCkgP1xuICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LnRvdGFsIDogMSxcbiAgICAgICAgICAgIGZpcnN0OiB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBleHBvcnRzLlBBR0lOQVRPUl9GSVJTVCxcbiAgICAgICAgICAgICAgICBpc0Rpc2FibGVkOiBmdW5jdGlvbiAoKSB7IHJldHVybiAoX3RoaXMudmFsdWVzLmN1cnJlbnQudmFsdWUgPD0gMSk7IH0sXG4gICAgICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy52YWx1ZXMuY3VycmVudC52YWx1ZSA9IDE7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmZpcmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHJldmlvdXM6IHtcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IGV4cG9ydHMuUEFHSU5BVE9SX1BSRVZJT1VTLFxuICAgICAgICAgICAgICAgIGlzRGlzYWJsZWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIChfdGhpcy52YWx1ZXMuY3VycmVudC52YWx1ZSA8PSAxKTsgfSxcbiAgICAgICAgICAgICAgICBvbmNsaWNrOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnZhbHVlcy5jdXJyZW50LnZhbHVlID0gX3RoaXMudmFsdWVzLmN1cnJlbnQudmFsdWUgLSAxO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5maXJlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBleHBvcnRzLlBBR0lOQVRPUl9QT1NJVElPTixcbiAgICAgICAgICAgICAgICB2aWV3OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjdHggPSBuZXcgUG9zaXRpb25WaWV3Q29udGV4dChfdGhpcy52YWx1ZXMucG9zaXRpb24uY2xhc3NOYW1lLCBfdGhpcy52YWx1ZXMuY3VycmVudC52YWx1ZSwgX3RoaXMudmFsdWVzLnRvdGFsLCB0aW1lcl8xLmRlYm91bmNlKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IE51bWJlcihlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgobiA+IDApICYmIChuIDw9IF90aGlzLnZhbHVlcy50b3RhbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy52YWx1ZXMuY3VycmVudC52YWx1ZSA9IG47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZmlyZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LCA1MDAwKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnBvc2l0aW9uVmlldykgP1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cucG9zaXRpb25WaWV3KGN0eCkgOlxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IHBhZ2luYXRvcl8xLlBvc2l0aW9uVmlldyhjdHgpKS5yZW5kZXIoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbmV4dDoge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogZXhwb3J0cy5QQUdJTkFUT1JfTkVYVCxcbiAgICAgICAgICAgICAgICBpc0Rpc2FibGVkOiBmdW5jdGlvbiAoKSB7IHJldHVybiAoX3RoaXMudmFsdWVzLmN1cnJlbnQudmFsdWUgPj0gX3RoaXMudmFsdWVzLnRvdGFsKTsgfSxcbiAgICAgICAgICAgICAgICBvbmNsaWNrOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnZhbHVlcy5jdXJyZW50LnZhbHVlID0gX3RoaXMudmFsdWVzLmN1cnJlbnQudmFsdWUgKyAxO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5maXJlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxhc3Q6IHtcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IGV4cG9ydHMuUEFHSU5BVE9SX0xBU1QsXG4gICAgICAgICAgICAgICAgaXNEaXNhYmxlZDogZnVuY3Rpb24gKCkgeyByZXR1cm4gKF90aGlzLnZhbHVlcy5jdXJyZW50LnZhbHVlID49IF90aGlzLnZhbHVlcy50b3RhbCk7IH0sXG4gICAgICAgICAgICAgICAgb25jbGljazogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy52YWx1ZXMuY3VycmVudC52YWx1ZSA9IF90aGlzLnZhbHVlcy50b3RhbDtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuZmlyZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkaXNhYmxlZDoge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogZGlzYWJsZWRfMS5ESVNBQkxFRFxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgUGFnaW5hdG9yLnByb3RvdHlwZS5maXJlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5hdHRycy53dyAmJiB0aGlzLmF0dHJzLnd3Lm9uQ2hhbmdlKVxuICAgICAgICAgICAgdGhpcy5hdHRycy53dy5vbkNoYW5nZShuZXcgUGFnZUNoYW5nZWRFdmVudCh0aGlzLmF0dHJzLnd3Lm5hbWUgfHwgJycsIHRoaXMudmFsdWVzLmN1cnJlbnQudmFsdWUpKTtcbiAgICAgICAgdGhpcy52aWV3LmludmFsaWRhdGUoKTtcbiAgICB9O1xuICAgIHJldHVybiBQYWdpbmF0b3I7XG59KHdtbF8xLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5QYWdpbmF0b3IgPSBQYWdpbmF0b3I7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5QYWdpbmF0b3JWaWV3ID0gZXhwb3J0cy5Qb3NpdGlvblZpZXcgPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIHRleHRfaW5wdXRfMSA9IHJlcXVpcmUoXCIuLi8uLi90ZXh0LWlucHV0XCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBQb3NpdGlvblZpZXcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUG9zaXRpb25WaWV3KF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdsaScsIHsgJ2NsYXNzJzogX19jb250ZXh0LmNsYXNzTmFtZSB9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3NwYW4nLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdQYWdlICcpLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0ZXh0X2lucHV0XzEuVGV4dElucHV0KHsgd3c6IHsgJ3R5cGUnOiAnbnVtYmVyJywgJ21hdGNoJzogJ1swLTldJywgJ3ZhbHVlJzogU3RyaW5nKF9fY29udGV4dC5jdXJyZW50KSwgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlIH0gfSwgW10pLCB7IHd3OiB7ICd0eXBlJzogJ251bWJlcicsICdtYXRjaCc6ICdbMC05XScsICd2YWx1ZSc6IFN0cmluZyhfX2NvbnRleHQuY3VycmVudCksICdvbkNoYW5nZSc6IF9fY29udGV4dC5vbkNoYW5nZSB9IH0pLFxuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcgb2YgJyksXG4gICAgICAgICAgICAgICAgICAgIHRleHQoX19jb250ZXh0LnRvdGFsKVxuICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgUG9zaXRpb25WaWV3LnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgUG9zaXRpb25WaWV3LnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIFBvc2l0aW9uVmlldy5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIFBvc2l0aW9uVmlldy5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBQb3NpdGlvblZpZXcucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIFBvc2l0aW9uVmlldy5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBQb3NpdGlvblZpZXcucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIFBvc2l0aW9uVmlldy5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBQb3NpdGlvblZpZXc7XG59KCkpO1xuZXhwb3J0cy5Qb3NpdGlvblZpZXcgPSBQb3NpdGlvblZpZXc7XG47XG52YXIgUGFnaW5hdG9yVmlldyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBQYWdpbmF0b3JWaWV3KF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCd1bCcsIHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUgfSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdsaScsIHsgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5maXJzdC5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKChfX2NvbnRleHQudmFsdWVzLmZpcnN0LmlzRGlzYWJsZWQoKSkgP1xuICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdzcGFuJywgeyAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmRpc2FibGVkLmNsYXNzTmFtZSB9LCBbXSlcbiAgICAgICAgICAgICAgICAgICAgXSk7IH0pKCkgOlxuICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdhJywgeyAnaHJlZic6ICcjJywgJ29uY2xpY2snOiBfX2NvbnRleHQudmFsdWVzLmZpcnN0Lm9uY2xpY2sgfSwgW10pXG4gICAgICAgICAgICAgICAgICAgIF0pOyB9KSgpKSkpLFxuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdsaScsIHsgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5wcmV2aW91cy5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKChfX2NvbnRleHQudmFsdWVzLnByZXZpb3VzLmlzRGlzYWJsZWQoKSkgP1xuICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdzcGFuJywgeyAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmRpc2FibGVkLmNsYXNzTmFtZSB9LCBbXSlcbiAgICAgICAgICAgICAgICAgICAgXSk7IH0pKCkgOlxuICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdhJywgeyAnaHJlZic6ICcjJywgJ29uY2xpY2snOiBfX2NvbnRleHQudmFsdWVzLnByZXZpb3VzLm9uY2xpY2sgfSwgW10pXG4gICAgICAgICAgICAgICAgICAgIF0pOyB9KSgpKSkpLFxuICAgICAgICAgICAgICAgIF9fY29udGV4dC52YWx1ZXMucG9zaXRpb24udmlldygpLFxuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdsaScsIHsgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5uZXh0LmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoKF9fY29udGV4dC52YWx1ZXMubmV4dC5pc0Rpc2FibGVkKCkpID9cbiAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnc3BhbicsIHsgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5kaXNhYmxlZC5jbGFzc05hbWUgfSwgW10pXG4gICAgICAgICAgICAgICAgICAgIF0pOyB9KSgpIDpcbiAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnYScsIHsgJ2hyZWYnOiAnIycsICdvbmNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5uZXh0Lm9uY2xpY2sgfSwgW10pXG4gICAgICAgICAgICAgICAgICAgIF0pOyB9KSgpKSkpLFxuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdsaScsIHsgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5sYXN0LmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoKF9fY29udGV4dC52YWx1ZXMubGFzdC5pc0Rpc2FibGVkKCkpID9cbiAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnc3BhbicsIHsgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5kaXNhYmxlZC5jbGFzc05hbWUgfSwgW10pXG4gICAgICAgICAgICAgICAgICAgIF0pOyB9KSgpIDpcbiAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnYScsIHsgJ2hyZWYnOiAnIycsICdvbmNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5sYXN0Lm9uY2xpY2sgfSwgW10pXG4gICAgICAgICAgICAgICAgICAgIF0pOyB9KSgpKSkpXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgUGFnaW5hdG9yVmlldy5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIFBhZ2luYXRvclZpZXcucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgUGFnaW5hdG9yVmlldy5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIFBhZ2luYXRvclZpZXcucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgUGFnaW5hdG9yVmlldy5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgUGFnaW5hdG9yVmlldy5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBQYWdpbmF0b3JWaWV3LnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBQYWdpbmF0b3JWaWV3LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIFBhZ2luYXRvclZpZXc7XG59KCkpO1xuZXhwb3J0cy5QYWdpbmF0b3JWaWV3ID0gUGFnaW5hdG9yVmlldztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2luYXRvci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5SZXN1bHRzTWVudSA9IGV4cG9ydHMuSXRlbVNlbGVjdGVkRXZlbnQgPSBleHBvcnRzLlJFU1VMVFNfTUVOVSA9IHZvaWQgMDtcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIHdtbF8xID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbFwiKTtcbnZhciBfXzIgPSByZXF1aXJlKFwiLi4vXCIpO1xudmFyIHJlc3VsdHNfbWVudV8xID0gcmVxdWlyZShcIi4vd21sL3Jlc3VsdHMtbWVudVwiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuUkVTVUxUU19NRU5VID0gJ3d3LXJlc3VsdHMtbWVudSc7XG4vKipcbiAqIEl0ZW1TZWxlY3RlZEV2ZW50XG4gKi9cbnZhciBJdGVtU2VsZWN0ZWRFdmVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoSXRlbVNlbGVjdGVkRXZlbnQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gSXRlbVNlbGVjdGVkRXZlbnQoKSB7XG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIEl0ZW1TZWxlY3RlZEV2ZW50O1xufShfXzIuRXZlbnQpKTtcbmV4cG9ydHMuSXRlbVNlbGVjdGVkRXZlbnQgPSBJdGVtU2VsZWN0ZWRFdmVudDtcbi8qKlxuICogUmVzdWx0c01lbnUgdXNlZCB0byBkaXNwbGF5IHJlc3VsdHMgaW4gc2VsZWN0IHN0eWxlZCBjb250cm9scy5cbiAqL1xudmFyIFJlc3VsdHNNZW51ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhSZXN1bHRzTWVudSwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBSZXN1bHRzTWVudSgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgcmVzdWx0c19tZW51XzEuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgIGlkOiAnbWVudSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0cmVlOiBtYXliZV8xLm5vdGhpbmcoKSxcbiAgICAgICAgICAgIHJlc3VsdHM6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5yZXN1bHRzKSA/XG4gICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cucmVzdWx0cyA6IFtdLFxuICAgICAgICAgICAgbmFtZTogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm5hbWUpID9cbiAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5uYW1lIDogJycsXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5SRVNVTFRTX01FTlUsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIGJsb2NrOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuYmxvY2spID9cbiAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5ibG9jayA6IGZhbHNlLFxuICAgICAgICAgICAgaGlkZGVuOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuaGlkZGVuKSA/XG4gICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuaGlkZGVuIDogZmFsc2UsXG4gICAgICAgICAgICBpdGVtOiB7XG4gICAgICAgICAgICAgICAgc3RyaW5naWZpZXI6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5zdHJpbmdpZmllcikgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5zdHJpbmdpZmllciA6IGZ1bmN0aW9uICh2KSB7IHJldHVybiBPYmplY3QudG9TdHJpbmcuY2FsbCh2KTsgfSxcbiAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vblNlbGVjdClcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uU2VsZWN0KG5ldyBJdGVtU2VsZWN0ZWRFdmVudChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5uYW1lIHx8ICcnLCBfdGhpcy52YWx1ZXMucmVzdWx0c1tpbmRleF0pKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuaXRlbVRlbXBsYXRlKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lml0ZW1UZW1wbGF0ZSA6XG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChvcHRpb24sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0c19tZW51XzEuaXRlbVRlbXBsYXRlKF90aGlzLCBvcHRpb24sIGluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBub0l0ZW1zVGVtcGxhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5ub0l0ZW1zVGVtcGxhdGUpID9cbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm5vSXRlbXNUZW1wbGF0ZSA6IHJlc3VsdHNfbWVudV8xLm5vSXRlbXNUZW1wbGF0ZSgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgUmVzdWx0c01lbnUucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHV0aWxfMS5nZXRCeUlkKHRoaXMudmlldywgdGhpcy52YWx1ZXMud21sLmlkKVxuICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAobSkgeyByZXR1cm4gbS5zaG93KCk7IH0pO1xuICAgICAgICB0aGlzLnZhbHVlcy5oaWRkZW4gPSBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuYXR0cnMud3cgJiYgdGhpcy5hdHRycy53dy5vbk9wZW4pXG4gICAgICAgICAgICB0aGlzLmF0dHJzLnd3Lm9uT3BlbigpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIFJlc3VsdHNNZW51LnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdXRpbF8xLmdldEJ5SWQodGhpcy52aWV3LCB0aGlzLnZhbHVlcy53bWwuaWQpXG4gICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChtKSB7IHJldHVybiBtLmhpZGUoKTsgfSk7XG4gICAgICAgIHRoaXMudmFsdWVzLmhpZGRlbiA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLmF0dHJzLnd3ICYmIHRoaXMuYXR0cnMud3cub25DbG9zZSlcbiAgICAgICAgICAgIHRoaXMuYXR0cnMud3cub25DbG9zZSgpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIFJlc3VsdHNNZW51LnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHV0aWxfMS5nZXRCeUlkKHRoaXMudmlldywgdGhpcy52YWx1ZXMud21sLmlkKVxuICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAobSkgeyByZXR1cm4gbS50b2dnbGUoKTsgfSk7XG4gICAgICAgIHRoaXMudmFsdWVzLmhpZGRlbiA9ICF0aGlzLnZhbHVlcy5oaWRkZW47XG4gICAgICAgIGlmICh0aGlzLnZhbHVlcy5oaWRkZW4gPT09IHRydWUgJiZcbiAgICAgICAgICAgIHRoaXMuYXR0cnMud3cgJiZcbiAgICAgICAgICAgIHRoaXMuYXR0cnMud3cub25DbG9zZSlcbiAgICAgICAgICAgIHRoaXMuYXR0cnMud3cub25DbG9zZSgpO1xuICAgICAgICBlbHNlIGlmICh0aGlzLnZhbHVlcy5oaWRkZW4gPT09IGZhbHNlICYmXG4gICAgICAgICAgICB0aGlzLmF0dHJzLnd3ICYmXG4gICAgICAgICAgICB0aGlzLmF0dHJzLnd3Lm9uT3BlbilcbiAgICAgICAgICAgIHRoaXMuYXR0cnMud3cub25PcGVuKCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgUmVzdWx0c01lbnUucHJvdG90eXBlLmhhbmRsZUV2ZW50ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKHRoaXMudmFsdWVzLnRyZWUuaXNKdXN0KCkpIHtcbiAgICAgICAgICAgIHZhciByb290ID0gdGhpcy52YWx1ZXMudHJlZS5nZXQoKTtcbiAgICAgICAgICAgIGlmICghZG9jdW1lbnQuYm9keS5jb250YWlucyhyb290KSlcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMpO1xuICAgICAgICAgICAgaWYgKCghcm9vdC5jb250YWlucyhlLnRhcmdldCkpKVxuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICogdXBkYXRlIHdpbGwgY2F1c2UgdGhlIG1lbnUgdG8gYmUgZGlzcGxheWVkLlxuICAgICAqL1xuICAgIFJlc3VsdHNNZW51LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAocmVzdWx0cykge1xuICAgICAgICB0aGlzLnZhbHVlcy5yZXN1bHRzID0gcmVzdWx0cztcbiAgICAgICAgdGhpcy52YWx1ZXMuaGlkZGVuID0gZmFsc2U7XG4gICAgICAgIHRoaXMudmlldy5pbnZhbGlkYXRlKCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgUmVzdWx0c01lbnUucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy52YWx1ZXMudHJlZSA9IG1heWJlXzEuanVzdCh0aGlzLnZpZXcucmVuZGVyKCkpO1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzKTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcyk7XG4gICAgICAgIHJldHVybiB0aGlzLnZhbHVlcy50cmVlLmdldCgpO1xuICAgIH07XG4gICAgcmV0dXJuIFJlc3VsdHNNZW51O1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuUmVzdWx0c01lbnUgPSBSZXN1bHRzTWVudTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSBleHBvcnRzLm5vSXRlbXNUZW1wbGF0ZSA9IGV4cG9ydHMuaXRlbVRlbXBsYXRlID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBsaW5rXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY29udGVudC9saW5rXCIpO1xuO1xudmFyIG1lbnVfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9tZW51L21lbnVcIik7XG47XG52YXIgaXRlbV8xID0gcmVxdWlyZShcIi4uLy4uLy4uL21lbnUvaXRlbVwiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG5leHBvcnRzLml0ZW1UZW1wbGF0ZSA9IGZ1bmN0aW9uIChyLCBvcHRpb24sIF9pbmRleCkgeyByZXR1cm4gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgIHJldHVybiBbXG4gICAgICAgIHRleHQoci52YWx1ZXMuaXRlbS5zdHJpbmdpZmllcihvcHRpb24pKVxuICAgIF07XG59OyB9O1xuO1xuZXhwb3J0cy5ub0l0ZW1zVGVtcGxhdGUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgICAgX190aGlzLm5vZGUoJ2InLCB7fSwgW1xuICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnTm8gcmVzdWx0cyB0byBkaXNwbGF5LicpXG4gICAgICAgIF0pXG4gICAgXTtcbn07IH07XG47XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IG1lbnVfMS5NZW51KHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMud21sLmlkIH0sIHd3OiB7ICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSwgJ2Jsb2NrJzogX19jb250ZXh0LnZhbHVlcy5ibG9jaywgJ2hpZGRlbic6IF9fY29udGV4dC52YWx1ZXMuaGlkZGVuIH0gfSwgX19zcHJlYWRBcnJheXMoX19mb3JJbihfX2NvbnRleHQudmFsdWVzLnJlc3VsdHMsIGZ1bmN0aW9uIChyZXN1bHQsIGluZGV4LCBfJCRhbGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaXRlbV8xLkl0ZW0oeyB3dzogeyAnbmFtZSc6ICgnJyArIGluZGV4KSB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGxpbmtfMS5MaW5rKHsgd3c6IHsgJ29uQ2xpY2snOiBmdW5jdGlvbiAoKSB7IHJldHVybiBfX2NvbnRleHQudmFsdWVzLml0ZW0uY2xpY2soaW5kZXgpOyB9IH0gfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC52YWx1ZXMuaXRlbS50ZW1wbGF0ZShyZXN1bHQsIGluZGV4KShfX3RoaXMpKSkpLCB7IHd3OiB7ICdvbkNsaWNrJzogZnVuY3Rpb24gKCkgeyByZXR1cm4gX19jb250ZXh0LnZhbHVlcy5pdGVtLmNsaWNrKGluZGV4KTsgfSB9IH0pXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICduYW1lJzogKCcnICsgaW5kZXgpIH0gfSlcbiAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHsgcmV0dXJuIChfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LnZhbHVlcy5pdGVtLm5vSXRlbXNUZW1wbGF0ZSgpKF9fdGhpcykpKSk7IH0pKSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMud21sLmlkIH0sIHd3OiB7ICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSwgJ2Jsb2NrJzogX19jb250ZXh0LnZhbHVlcy5ibG9jaywgJ2hpZGRlbic6IF9fY29udGV4dC52YWx1ZXMuaGlkZGVuIH0gfSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1yZXN1bHRzLW1lbnUuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMudG9nZ2xlTWVudSA9IGV4cG9ydHMuY2xvc2VNZW51ID0gZXhwb3J0cy5vcGVuTWVudSA9IGV4cG9ydHMudXBkYXRlTWVudSA9IGV4cG9ydHMuU2VhcmNoID0gZXhwb3J0cy5JbnB1dCA9IGV4cG9ydHMuRXNjYXBlRXZlbnQgPSBleHBvcnRzLkZvY3VzTG9zdEV2ZW50ID0gZXhwb3J0cy5Gb2N1c0dhaW5lZEV2ZW50ID0gZXhwb3J0cy5UZXJtQ2hhbmdlZEV2ZW50ID0gZXhwb3J0cy5TRUFSQ0hfSU5QVVQgPSBleHBvcnRzLlNFQVJDSCA9IGV4cG9ydHMuRVNDQVBFID0gZXhwb3J0cy5JdGVtU2VsZWN0ZWRFdmVudCA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9zZWFyY2hcIik7XG52YXIgdGltZXJfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvY29udHJvbC90aW1lclwiKTtcbnZhciBvcmllbnRhdGlvbl8xID0gcmVxdWlyZShcIi4uLy4uL2NvbnRlbnQvb3JpZW50YXRpb25cIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgcmVzdWx0c19tZW51XzEgPSByZXF1aXJlKFwiLi4vcmVzdWx0cy1tZW51XCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiSXRlbVNlbGVjdGVkRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlc3VsdHNfbWVudV8xLkl0ZW1TZWxlY3RlZEV2ZW50OyB9IH0pO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLi8uLi9cIik7XG52YXIgX18yID0gcmVxdWlyZShcIi4uL1wiKTtcbi8qKlxuICogRVNDQVBFIGtleSBjb2RlLlxuICovXG5leHBvcnRzLkVTQ0FQRSA9IDI3O1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5TRUFSQ0ggPSAnd3ctc2VhcmNoJztcbmV4cG9ydHMuU0VBUkNIX0lOUFVUID0gJ3d3LXNlYXJjaF9faW5wdXQnO1xuLyoqXG4gKiBUZXJtQ2hhbmdlZEV2ZW50IHNpZ25hbHMgdGhlIHNlYXJjaCB0ZXJtIGhhcyBjaGFuZ2VkLlxuICovXG52YXIgVGVybUNoYW5nZWRFdmVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVGVybUNoYW5nZWRFdmVudCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBUZXJtQ2hhbmdlZEV2ZW50KCkge1xuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgfVxuICAgIHJldHVybiBUZXJtQ2hhbmdlZEV2ZW50O1xufShfXzIuRXZlbnQpKTtcbmV4cG9ydHMuVGVybUNoYW5nZWRFdmVudCA9IFRlcm1DaGFuZ2VkRXZlbnQ7XG4vKipcbiAqIEZvY3VzR2FpbmVkRXZlbnQgc2lnbmFscyB0aGUgdXNlciBhcyBnaXZlbiBmb2N1cyB0byB0aGUgY29udHJvbC5cbiAqL1xudmFyIEZvY3VzR2FpbmVkRXZlbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRm9jdXNHYWluZWRFdmVudChuYW1lKSB7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgfVxuICAgIHJldHVybiBGb2N1c0dhaW5lZEV2ZW50O1xufSgpKTtcbmV4cG9ydHMuRm9jdXNHYWluZWRFdmVudCA9IEZvY3VzR2FpbmVkRXZlbnQ7XG4vKipcbiAqIEZvY3VzTG9zdEV2ZW50IHNpZ25hbHMgdGhlIHVzZXIgaGFzIHJlbW92ZWQgZm9jdXMgZnJvbSB0aGUgY29udHJvbC5cbiAqL1xudmFyIEZvY3VzTG9zdEV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEZvY3VzTG9zdEV2ZW50KG5hbWUpIHtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB9XG4gICAgcmV0dXJuIEZvY3VzTG9zdEV2ZW50O1xufSgpKTtcbmV4cG9ydHMuRm9jdXNMb3N0RXZlbnQgPSBGb2N1c0xvc3RFdmVudDtcbi8qKlxuICogRXNjYXBlRXZlbnQgc2lnbmFscyB0aGUgdXNlciBoYXMgcHJlc3NlZCB0aGUgZXNjYXBlIGtleSB3aGlsZSB0eXBpbmcuXG4gKi9cbnZhciBFc2NhcGVFdmVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBFc2NhcGVFdmVudChuYW1lKSB7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgfVxuICAgIHJldHVybiBFc2NhcGVFdmVudDtcbn0oKSk7XG5leHBvcnRzLkVzY2FwZUV2ZW50ID0gRXNjYXBlRXZlbnQ7XG4vKipcbiAqIElucHV0IHByb3ZpZGVzIHRoZSBpbnB1dCBwYXJ0IG9mIGEgU2VhcmNoIGNvbnRyb2wuXG4gKlxuICogVGhpcyBpcyBoZXJlIG1vc3RseSBmb3IgY29kZSByZS11c2UuXG4gKi9cbnZhciBJbnB1dCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoSW5wdXQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gSW5wdXQoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLklucHV0VmlldyhfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHdtbDogeyBpZDogJ3Jvb3QnIH0sXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5TRUFSQ0hfSU5QVVQsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cucGxhY2Vob2xkZXIpID9cbiAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5wbGFjZWhvbGRlciA6ICcnLFxuICAgICAgICAgICAgcmVhZE9ubHk6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5yZWFkT25seSkgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgZGlzYWJsZWQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5kaXNhYmxlZCkgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgYXV0b2NvbXBsZXRlOiAnZG8gbm90IGVuYWJsZSBwbGVhc2UnLFxuICAgICAgICAgICAgYXV0b2ZvY3VzOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuYXV0b2ZvY3VzKSA/XG4gICAgICAgICAgICAgICAgdHJ1ZSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHNpemU6IFN0cmluZygoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuc2l6ZSkgP1xuICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LnNpemUgOiAyMCksXG4gICAgICAgICAgICB2YWx1ZTogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnZhbHVlKSA/XG4gICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cudmFsdWUgOiAnJyxcbiAgICAgICAgICAgIG9uZm9jdXM6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0O1xuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vbkZvY3VzKVxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vbkZvY3VzKG5ldyBGb2N1c0dhaW5lZEV2ZW50KF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm5hbWUgfHwgJycpKTtcbiAgICAgICAgICAgICAgICB0YXJnZXQudmFsdWUgPSB0YXJnZXQudmFsdWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25rZXl1cDogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBleHBvcnRzLkVTQ0FQRSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cub25Fc2NhcGUpXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vbkVzY2FwZShuZXcgRXNjYXBlRXZlbnQoX3RoaXMuYXR0cnMud3cubmFtZSB8fCAnJykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuZmlyZVNlYXJjaChlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25pbnB1dDogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAvL0ZvciBjb21wYXRhYmlsaXR5IHJlYXNvbnNcbiAgICAgICAgICAgICAgICBlLnRhcmdldC5vbmlucHV0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICBfdGhpcy52YWx1ZXMub25rZXl1cChlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbmJsdXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cub25CbHVyKVxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vbkJsdXIobmV3IEZvY3VzTG9zdEV2ZW50KF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm5hbWUgfHwgJycpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBJbnB1dC5wcm90b3R5cGUuZmlyZVNlYXJjaCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmICh0aGlzLmF0dHJzLnd3ICYmIHRoaXMuYXR0cnMud3cub25TZWFyY2gpIHtcbiAgICAgICAgICAgIHZhciBuYW1lXzEgPSAnJyArIHRoaXMuYXR0cnMud3cubmFtZTtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGUudGFyZ2V0LnZhbHVlO1xuICAgICAgICAgICAgdGhpcy5hdHRycy53dy5vblNlYXJjaChuZXcgVGVybUNoYW5nZWRFdmVudChuYW1lXzEsIHZhbHVlKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0LnByb3RvdHlwZS5yZW5kZXJlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMudmFsdWVzLmF1dG9mb2N1cyA9PT0gdHJ1ZSlcbiAgICAgICAgICAgIHRoaXMuZm9jdXMoKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGZvY3VzIHN0ZWFscyB1c2VyIGZvY3VzIHRvIHRoZSBJbnB1dC5cbiAgICAgKi9cbiAgICBJbnB1dC5wcm90b3R5cGUuZm9jdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRpbWVyXzEudGljayhmdW5jdGlvbiAoKSB7IHJldHVybiBnZXRJbnB1dChfdGhpcykubWFwKGZ1bmN0aW9uIChpKSB7IHJldHVybiBpLmZvY3VzKCk7IH0pOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBzZXRTaXplIHNldHMgdGhlIHNpemUgb2YgdGhlIGlucHV0LlxuICAgICAqL1xuICAgIElucHV0LnByb3RvdHlwZS5zZXRTaXplID0gZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgdGhpcy52YWx1ZXMuc2l6ZSA9IFN0cmluZyhuKTtcbiAgICAgICAgZ2V0SW5wdXQodGhpcykubWFwKGZ1bmN0aW9uIChpKSB7IHJldHVybiBpLnNldEF0dHJpYnV0ZSgnc2l6ZScsIFN0cmluZyhuKSk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGdldFNpemUgcmV0dXJucyB0aGUgc2l6ZSBvZiB0aGUgKGludGVybmFsbHkgdHJhY2tlZCkgc2l6ZVxuICAgICAqIG9mIHRoZSBJbnB1dC5cbiAgICAgKi9cbiAgICBJbnB1dC5wcm90b3R5cGUuZ2V0U2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIE51bWJlcih0aGlzLnZhbHVlcy5zaXplKTtcbiAgICB9O1xuICAgIHJldHVybiBJbnB1dDtcbn0oX18yLkFic3RyYWN0Q29udHJvbCkpO1xuZXhwb3J0cy5JbnB1dCA9IElucHV0O1xuLyoqXG4gKiBTZWFyY2ggcHJvdmlkZXMgYW4gaW5wdXQgdGhhdCBjYW4gYmUgdXNlZCBpbiB0aGUgdWkgZm9yIGEgc2VhcmNoIGVuZ2luZS5cbiAqL1xudmFyIFNlYXJjaCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoU2VhcmNoLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFNlYXJjaCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHJvb3Q6IHtcbiAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdyb290J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuU0VBUkNILCBfXzEuZ2V0Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSwgb3JpZW50YXRpb25fMS5nZXRCbG9ja0NsYXNzTmFtZShfdGhpcy5hdHRycykpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5wdXQ6IHtcbiAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdpbnB1dCdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG5hbWU6IF9fMi5nZXROYW1lKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnBsYWNlaG9sZGVyKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LnBsYWNlaG9sZGVyIDogJycsXG4gICAgICAgICAgICAgICAgYXV0b2ZvY3VzOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuYXV0b2ZvY3VzKSA/XG4gICAgICAgICAgICAgICAgICAgIHRydWUgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgcmVhZE9ubHk6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5yZWFkT25seSkgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIGRpc2FibGVkOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZGlzYWJsZWQpIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB2YWx1ZTogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnRlcm0pID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cudGVybSA6XG4gICAgICAgICAgICAgICAgICAgIChfdGhpcy5hdHRycy53dyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuc3RyaW5naWZpZXIgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LnZhbHVlKSA/XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5zdHJpbmdpZmllcihfdGhpcy5hdHRycy53dy52YWx1ZSkgOiAnJyxcbiAgICAgICAgICAgICAgICBvbkZvY3VzOiBfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vbkZvY3VzIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBvblNlYXJjaDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm9uU2VhcmNoKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uU2VhcmNoIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIG9uRXNjYXBlOiBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5jbG9zZSgpOyB9LFxuICAgICAgICAgICAgICAgIG9uQmx1cjogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm9uQmx1cikgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vbkJsdXIgOiB1bmRlZmluZWRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZW51OiB7XG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnbWVudSdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG5hbWU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5uYW1lKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm5hbWUgOiAnJyxcbiAgICAgICAgICAgICAgICBibG9jazogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmJsb2NrKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmJsb2NrIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgb25TZWxlY3Q6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vblNlbGVjdClcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uU2VsZWN0KGUpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaXRlbVRlbXBsYXRlOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuaXRlbVRlbXBsYXRlKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lml0ZW1UZW1wbGF0ZSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBub0l0ZW1zVGVtcGxhdGU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5ub0l0ZW1zVGVtcGxhdGUpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cubm9JdGVtc1RlbXBsYXRlIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHN0cmluZ2lmaWVyOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuc3RyaW5naWZpZXIpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuc3RyaW5naWZpZXIgOiB1bmRlZmluZWRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBTZWFyY2gucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICB1dGlsXzEuZ2V0QnlJZCh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLnJvb3Qud21sLmlkKVxuICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoZSkgeyBlLnZhbHVlID0gdmFsdWU7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGZvY3VzIGdpdmVzIGZvY3VzIHRvIHRoZSBpbnB1dC5cbiAgICAgKi9cbiAgICBTZWFyY2gucHJvdG90eXBlLmZvY3VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB1dGlsXzEuZ2V0QnlJZCh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLmlucHV0LndtbC5pZClcbiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGkpIHsgcmV0dXJuIGkuZm9jdXMoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogdXBkYXRlIHRoZSBTZWxlY3Qgd2l0aCBuZXcgaXRlbSBvcHRpb25zIHRvXG4gICAgICogcHJlc2VudCB0byB0aGUgdXNlci5cbiAgICAgKi9cbiAgICBTZWFyY2gucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIChyZXN1bHRzKSB7XG4gICAgICAgIGV4cG9ydHMudXBkYXRlTWVudSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLm1lbnUud21sLmlkLCByZXN1bHRzKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBvcGVuIHRoZSByZXN1bHRzIG1lbnUuXG4gICAgICovXG4gICAgU2VhcmNoLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBleHBvcnRzLm9wZW5NZW51KHRoaXMudmlldywgdGhpcy52YWx1ZXMubWVudS53bWwuaWQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGNsb3NlIHRoZSByZXN1bHRzIG1lbnUuXG4gICAgICovXG4gICAgU2VhcmNoLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZXhwb3J0cy5jbG9zZU1lbnUodGhpcy52aWV3LCB0aGlzLnZhbHVlcy5tZW51LndtbC5pZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgcmV0dXJuIFNlYXJjaDtcbn0oX18yLkFic3RyYWN0Q29udHJvbCkpO1xuZXhwb3J0cy5TZWFyY2ggPSBTZWFyY2g7XG52YXIgZ2V0SW5wdXQgPSBmdW5jdGlvbiAoaSkge1xuICAgIHJldHVybiB1dGlsXzEuZ2V0QnlJZChpLnZpZXcsIGkudmFsdWVzLndtbC5pZCk7XG59O1xuLyoqXG4gKiB1cGRhdGVNZW51IHdpbGwgY2F1c2UgdGhlIG1lbnUgdG8gYmUgZGlzcGxheWVkIHdpdGggbmV3IGl0ZW1zLlxuICovXG5leHBvcnRzLnVwZGF0ZU1lbnUgPSBmdW5jdGlvbiAodmlldywgaWQsIHJlc3VsdHMpIHtcbiAgICB2YXIgbU1lbnUgPSB1dGlsXzEuZ2V0QnlJZCh2aWV3LCBpZCk7XG4gICAgaWYgKG1NZW51LmlzSnVzdCgpKVxuICAgICAgICBtTWVudS5nZXQoKS51cGRhdGUocmVzdWx0cyk7XG59O1xuLyoqXG4gKiBvcGVuTWVudSB3aWxsIGNhdXNlIHRoZSBtZW51IHRvIGJlIGRpc3BsYXllZCB3aXRoIHdoYXRldmVyIGNvbnRlbnRzXG4gKiB3ZXJlIHByZXZpb3VzbHkgc2V0LlxuICovXG5leHBvcnRzLm9wZW5NZW51ID0gZnVuY3Rpb24gKHZpZXcsIGlkKSB7XG4gICAgdXRpbF8xLmdldEJ5SWQodmlldywgaWQpXG4gICAgICAgIC5tYXAoZnVuY3Rpb24gKG0pIHsgcmV0dXJuIG0ub3BlbigpOyB9KTtcbn07XG4vKipcbiAqIGNsb3NlTWVudSB3aWxsIGNhdXNlIHRoZSBtZW51IHRvIG5vIGxvbmdlciBiZSBkaXNwbGF5ZWQuXG4gKi9cbmV4cG9ydHMuY2xvc2VNZW51ID0gZnVuY3Rpb24gKHZpZXcsIGlkKSB7XG4gICAgdXRpbF8xLmdldEJ5SWQodmlldywgaWQpXG4gICAgICAgIC5tYXAoZnVuY3Rpb24gKG0pIHsgcmV0dXJuIG0uY2xvc2UoKTsgfSk7XG59O1xuLyoqXG4gKiB0b2dnbGVNZW51XG4gKi9cbmV4cG9ydHMudG9nZ2xlTWVudSA9IGZ1bmN0aW9uICh2aWV3LCBpZCkge1xuICAgIHV0aWxfMS5nZXRCeUlkKHZpZXcsIGlkKVxuICAgICAgICAubWFwKGZ1bmN0aW9uIChtKSB7IHJldHVybiBtLnRvZ2dsZSgpOyB9KTtcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IGV4cG9ydHMuSW5wdXRWaWV3ID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciByZXN1bHRzX21lbnVfMSA9IHJlcXVpcmUoXCIuLi8uLi9yZXN1bHRzLW1lbnVcIik7XG47XG52YXIgX18xID0gcmVxdWlyZShcIi4uL1wiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgSW5wdXRWaWV3ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIElucHV0VmlldyhfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgnaW5wdXQnLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLndtbC5pZCB9LCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSwgJ29ua2V5dXAnOiBfX2NvbnRleHQudmFsdWVzLm9ua2V5dXAsICdvbmlucHV0JzogX19jb250ZXh0LnZhbHVlcy5vbmlucHV0LCAnb25mb2N1cyc6IF9fY29udGV4dC52YWx1ZXMub25mb2N1cywgJ29uYmx1cic6IF9fY29udGV4dC52YWx1ZXMub25ibHVyLCAnYXV0b2ZvY3VzJzogX19jb250ZXh0LnZhbHVlcy5hdXRvZm9jdXMsICdhdXRvY29tcGxldGUnOiBfX2NvbnRleHQudmFsdWVzLmF1dG9jb21wbGV0ZSwgJ3NpemUnOiBfX2NvbnRleHQudmFsdWVzLnNpemUsICdwbGFjZWhvbGRlcic6IF9fY29udGV4dC52YWx1ZXMucGxhY2Vob2xkZXIsICdyZWFkT25seSc6IF9fY29udGV4dC52YWx1ZXMucmVhZE9ubHksICdkaXNhYmxlZCc6IF9fY29udGV4dC52YWx1ZXMuZGlzYWJsZWQsICd2YWx1ZSc6IF9fY29udGV4dC52YWx1ZXMudmFsdWUgfSwgW10pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBJbnB1dFZpZXcucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBJbnB1dFZpZXcucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgSW5wdXRWaWV3LnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgSW5wdXRWaWV3LnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIElucHV0Vmlldy5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgSW5wdXRWaWV3LnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIElucHV0Vmlldy5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgSW5wdXRWaWV3LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIElucHV0Vmlldztcbn0oKSk7XG5leHBvcnRzLklucHV0VmlldyA9IElucHV0VmlldztcbjtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMucm9vdC53bWwuaWQgfSwgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5yb290LmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuY2xhc3NOYW1lIH0sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBfXzEuSW5wdXQoeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC53bWwuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0Lm5hbWUsICdhdXRvZm9jdXMnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0LmF1dG9mb2N1cywgJ29uRm9jdXMnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0Lm9uRm9jdXMsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQub25TZWFyY2gsICdvbkVzY2FwZSc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQub25Fc2NhcGUsICdvbkJsdXInOiBfX2NvbnRleHQudmFsdWVzLmlucHV0Lm9uQmx1ciwgJ3BsYWNlaG9sZGVyJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC5wbGFjZWhvbGRlciwgJ3JlYWRPbmx5JzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC5yZWFkT25seSwgJ2Rpc2FibGVkJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC5kaXNhYmxlZCwgJ3ZhbHVlJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC52YWx1ZSB9IH0sIFtdKSwgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC53bWwuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0Lm5hbWUsICdhdXRvZm9jdXMnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0LmF1dG9mb2N1cywgJ29uRm9jdXMnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0Lm9uRm9jdXMsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQub25TZWFyY2gsICdvbkVzY2FwZSc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQub25Fc2NhcGUsICdvbkJsdXInOiBfX2NvbnRleHQudmFsdWVzLmlucHV0Lm9uQmx1ciwgJ3BsYWNlaG9sZGVyJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC5wbGFjZWhvbGRlciwgJ3JlYWRPbmx5JzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC5yZWFkT25seSwgJ2Rpc2FibGVkJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC5kaXNhYmxlZCwgJ3ZhbHVlJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC52YWx1ZSB9IH0pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHJlc3VsdHNfbWVudV8xLlJlc3VsdHNNZW51KHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubWVudS53bWwuaWQgfSwgd3c6IHsgJ2hpZGRlbic6IHRydWUsICdibG9jayc6IF9fY29udGV4dC52YWx1ZXMubWVudS5ibG9jaywgJ29uU2VsZWN0JzogX19jb250ZXh0LnZhbHVlcy5tZW51Lm9uU2VsZWN0LCAnbm9JdGVtc1RlbXBsYXRlJzogX19jb250ZXh0LnZhbHVlcy5tZW51Lm5vSXRlbXNUZW1wbGF0ZSwgJ2l0ZW1UZW1wbGF0ZSc6IF9fY29udGV4dC52YWx1ZXMubWVudS5pdGVtVGVtcGxhdGUsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMubWVudS5zdHJpbmdpZmllciB9IH0sIFtdKSwgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5tZW51LndtbC5pZCB9LCB3dzogeyAnaGlkZGVuJzogdHJ1ZSwgJ2Jsb2NrJzogX19jb250ZXh0LnZhbHVlcy5tZW51LmJsb2NrLCAnb25TZWxlY3QnOiBfX2NvbnRleHQudmFsdWVzLm1lbnUub25TZWxlY3QsICdub0l0ZW1zVGVtcGxhdGUnOiBfX2NvbnRleHQudmFsdWVzLm1lbnUubm9JdGVtc1RlbXBsYXRlLCAnaXRlbVRlbXBsYXRlJzogX19jb250ZXh0LnZhbHVlcy5tZW51Lml0ZW1UZW1wbGF0ZSwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5tZW51LnN0cmluZ2lmaWVyIH0gfSlcbiAgICAgICAgICAgIF0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2VhcmNoLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVwZGF0ZSA9IGV4cG9ydHMuY2xvc2UgPSBleHBvcnRzLm9wZW4gPSBleHBvcnRzLlNlbGVjdCA9IGV4cG9ydHMuU2VhcmNoU2VjdGlvbiA9IGV4cG9ydHMuSW5wdXRTZWN0aW9uID0gZXhwb3J0cy5MYWJlbFNlY3Rpb24gPSBleHBvcnRzLk1lc3NhZ2VzU2VjdGlvbiA9IGV4cG9ydHMuQ29udHJvbFNlY3Rpb24gPSBleHBvcnRzLlJvb3RTZWN0aW9uID0gZXhwb3J0cy5JdGVtVW5zZXRFdmVudCA9IGV4cG9ydHMuSXRlbUNoYW5nZWRFdmVudCA9IGV4cG9ydHMuU0VMRUNUID0gZXhwb3J0cy5JdGVtU2VsZWN0ZWRFdmVudCA9IGV4cG9ydHMuVGVybUNoYW5nZWRFdmVudCA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9zZWxlY3RcIik7XG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBvcmllbnRhdGlvbl8xID0gcmVxdWlyZShcIi4uLy4uL2NvbnRlbnQvb3JpZW50YXRpb25cIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgZmVlZGJhY2tfMSA9IHJlcXVpcmUoXCIuLi9mZWVkYmFja1wiKTtcbnZhciBmb3JtXzEgPSByZXF1aXJlKFwiLi4vZm9ybVwiKTtcbnZhciBfXzEgPSByZXF1aXJlKFwiLi4vLi4vXCIpO1xudmFyIF9fMiA9IHJlcXVpcmUoXCIuLi9cIik7XG52YXIgc2VhcmNoXzEgPSByZXF1aXJlKFwiLi4vc2VhcmNoXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiVGVybUNoYW5nZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc2VhcmNoXzEuVGVybUNoYW5nZWRFdmVudDsgfSB9KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkl0ZW1TZWxlY3RlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBzZWFyY2hfMS5JdGVtU2VsZWN0ZWRFdmVudDsgfSB9KTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuU0VMRUNUID0gJ3d3LXNlbGVjdCc7XG4vKipcbiAqIEl0ZW1DaGFuZ2VkRXZlbnRcbiAqL1xudmFyIEl0ZW1DaGFuZ2VkRXZlbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEl0ZW1DaGFuZ2VkRXZlbnQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gSXRlbUNoYW5nZWRFdmVudCgpIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gSXRlbUNoYW5nZWRFdmVudDtcbn0oX18yLkV2ZW50KSk7XG5leHBvcnRzLkl0ZW1DaGFuZ2VkRXZlbnQgPSBJdGVtQ2hhbmdlZEV2ZW50O1xuLyoqXG4gKiBJdGVtVW5zZXRFdmVudFxuICovXG52YXIgSXRlbVVuc2V0RXZlbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEl0ZW1VbnNldEV2ZW50LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIEl0ZW1VbnNldEV2ZW50KG5hbWUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgbmFtZSwgdW5kZWZpbmVkKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gSXRlbVVuc2V0RXZlbnQ7XG59KF9fMi5FdmVudCkpO1xuZXhwb3J0cy5JdGVtVW5zZXRFdmVudCA9IEl0ZW1VbnNldEV2ZW50O1xuLyoqXG4gKiBSb290U2VjdGlvblxuICovXG52YXIgUm9vdFNlY3Rpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUm9vdFNlY3Rpb24oYXR0cnMpIHtcbiAgICAgICAgdGhpcy5hdHRycyA9IGF0dHJzO1xuICAgICAgICB0aGlzLndtbCA9IHsgaWQ6ICdyb290JyB9O1xuICAgICAgICB0aGlzLmlkID0gX18xLmdldElkKHRoaXMuYXR0cnMpO1xuICAgICAgICB0aGlzLmNsYXNzTmFtZSA9IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5TRUxFQ1QsIF9fMS5nZXRDbGFzc05hbWUodGhpcy5hdHRycyksIGZlZWRiYWNrXzEuZ2V0VmFsaWRpdHlDbGFzc05hbWUodGhpcy5hdHRycyksIG9yaWVudGF0aW9uXzEuZ2V0QmxvY2tDbGFzc05hbWUodGhpcy5hdHRycykpO1xuICAgIH1cbiAgICByZXR1cm4gUm9vdFNlY3Rpb247XG59KCkpO1xuZXhwb3J0cy5Sb290U2VjdGlvbiA9IFJvb3RTZWN0aW9uO1xuLyoqXG4gKiBDb250cm9sU2VjdGlvblxuICovXG52YXIgQ29udHJvbFNlY3Rpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQ29udHJvbFNlY3Rpb24oKSB7XG4gICAgICAgIHRoaXMud21sID0geyBpZDogJ3Jvb3QnIH07XG4gICAgfVxuICAgIHJldHVybiBDb250cm9sU2VjdGlvbjtcbn0oKSk7XG5leHBvcnRzLkNvbnRyb2xTZWN0aW9uID0gQ29udHJvbFNlY3Rpb247XG4vKipcbiAqIE1lc3NhZ2VzU2VjdGlvblxuICovXG52YXIgTWVzc2FnZXNTZWN0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1lc3NhZ2VzU2VjdGlvbihhdHRycykge1xuICAgICAgICB0aGlzLmF0dHJzID0gYXR0cnM7XG4gICAgICAgIHRoaXMud21sID0geyBpZDogJ21lc3NhZ2UnIH07XG4gICAgICAgIHRoaXMudGV4dCA9IGZlZWRiYWNrXzEuZ2V0TWVzc2FnZSh0aGlzLmF0dHJzKTtcbiAgICB9XG4gICAgcmV0dXJuIE1lc3NhZ2VzU2VjdGlvbjtcbn0oKSk7XG5leHBvcnRzLk1lc3NhZ2VzU2VjdGlvbiA9IE1lc3NhZ2VzU2VjdGlvbjtcbi8qKlxuICogTGFiZWxTZWN0aW9uXG4gKi9cbnZhciBMYWJlbFNlY3Rpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTGFiZWxTZWN0aW9uKGF0dHJzKSB7XG4gICAgICAgIHRoaXMuYXR0cnMgPSBhdHRycztcbiAgICAgICAgdGhpcy5pZCA9IF9fMi5nZXROYW1lKHRoaXMuYXR0cnMpO1xuICAgICAgICB0aGlzLnRleHQgPSBmb3JtXzEuZ2V0TGFiZWwodGhpcy5hdHRycyk7XG4gICAgfVxuICAgIHJldHVybiBMYWJlbFNlY3Rpb247XG59KCkpO1xuZXhwb3J0cy5MYWJlbFNlY3Rpb24gPSBMYWJlbFNlY3Rpb247XG4vKipcbiAqIElucHV0U2VjdGlvblxuICovXG52YXIgSW5wdXRTZWN0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIElucHV0U2VjdGlvbihhdHRycykge1xuICAgICAgICB0aGlzLmF0dHJzID0gYXR0cnM7XG4gICAgICAgIHRoaXMud21sID0geyBpZDogJ2lucHV0JyB9O1xuICAgIH1cbiAgICByZXR1cm4gSW5wdXRTZWN0aW9uO1xufSgpKTtcbmV4cG9ydHMuSW5wdXRTZWN0aW9uID0gSW5wdXRTZWN0aW9uO1xuLyoqXG4gKiBTZWFyY2hTZWN0aW9uXG4gKi9cbnZhciBTZWFyY2hTZWN0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFNlYXJjaFNlY3Rpb24oYXR0cnMsIGNsb3NlLCBvblNlbGVjdCkge1xuICAgICAgICB0aGlzLmF0dHJzID0gYXR0cnM7XG4gICAgICAgIHRoaXMuY2xvc2UgPSBjbG9zZTtcbiAgICAgICAgdGhpcy5vblNlbGVjdCA9IG9uU2VsZWN0O1xuICAgICAgICB0aGlzLndtbCA9IHsgaWQ6ICdzZWFyY2gnIH07XG4gICAgICAgIHRoaXMubmFtZSA9IF9fMi5nZXROYW1lKHRoaXMuYXR0cnMpO1xuICAgICAgICB0aGlzLmNsYXNzTmFtZSA9ICh0aGlzLmF0dHJzLnd3ICYmIHRoaXMuYXR0cnMud3cuaW5wdXRDbGFzc05hbWUpID9cbiAgICAgICAgICAgIHRoaXMuYXR0cnMud3cuaW5wdXRDbGFzc05hbWUgOiAnJztcbiAgICAgICAgdGhpcy5wbGFjZWhvbGRlciA9ICh0aGlzLmF0dHJzLnd3ICYmIHRoaXMuYXR0cnMud3cucGxhY2Vob2xkZXIpID9cbiAgICAgICAgICAgIHRoaXMuYXR0cnMud3cucGxhY2Vob2xkZXIgOiAnJztcbiAgICAgICAgdGhpcy5ibG9jayA9ICh0aGlzLmF0dHJzLnd3ICYmIHRoaXMuYXR0cnMud3cuYmxvY2spID9cbiAgICAgICAgICAgIHRoaXMuYXR0cnMud3cuYmxvY2sgOiBmYWxzZTtcbiAgICAgICAgdGhpcy52YWx1ZSA9ICh0aGlzLmF0dHJzLnd3ICYmIHRoaXMuYXR0cnMud3cudmFsdWUpID9cbiAgICAgICAgICAgIHRoaXMuYXR0cnMud3cudmFsdWUgOiB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucmVhZE9ubHkgPSAodGhpcy5hdHRycy53dyAmJiB0aGlzLmF0dHJzLnd3LnJlYWRPbmx5KTtcbiAgICAgICAgdGhpcy5kaXNhYmxlZCA9ICh0aGlzLmF0dHJzLnd3ICYmIHRoaXMuYXR0cnMud3cuZGlzYWJsZWQpO1xuICAgICAgICB0aGlzLml0ZW1UZW1wbGF0ZSA9ICh0aGlzLmF0dHJzLnd3ICYmIHRoaXMuYXR0cnMud3cuaXRlbVRlbXBsYXRlKSA/XG4gICAgICAgICAgICB0aGlzLmF0dHJzLnd3Lml0ZW1UZW1wbGF0ZSA6IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5ub0l0ZW1zVGVtcGxhdGUgPSAodGhpcy5hdHRycy53dyAmJiB0aGlzLmF0dHJzLnd3Lm5vSXRlbXNUZW1wbGF0ZSkgP1xuICAgICAgICAgICAgdGhpcy5hdHRycy53dy5ub0l0ZW1zVGVtcGxhdGUgOiB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RyaW5naWZpZXIgPSAodGhpcy5hdHRycy53dyAmJiB0aGlzLmF0dHJzLnd3LnN0cmluZ2lmaWVyKSA/XG4gICAgICAgICAgICB0aGlzLmF0dHJzLnd3LnN0cmluZ2lmaWVyIDogdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm9uU2VhcmNoID0gKHRoaXMuYXR0cnMud3cgJiYgdGhpcy5hdHRycy53dy5vblNlYXJjaCkgP1xuICAgICAgICAgICAgdGhpcy5hdHRycy53dy5vblNlYXJjaCA6IGZ1bmN0aW9uICgpIHsgfTtcbiAgICB9XG4gICAgcmV0dXJuIFNlYXJjaFNlY3Rpb247XG59KCkpO1xuZXhwb3J0cy5TZWFyY2hTZWN0aW9uID0gU2VhcmNoU2VjdGlvbjtcbi8qKlxuICogU2VsZWN0IHByb3ZpZGVzIGFuIGNvbnRyb2wgZm9yIHNlbGVjdGluZyBhbiBpdGVtIGZyb20gYVxuICogbGlzdC5cbiAqL1xudmFyIFNlbGVjdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoU2VsZWN0LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFNlbGVjdCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHJvb3Q6IG5ldyBSb290U2VjdGlvbihfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjb250cm9sOiBuZXcgQ29udHJvbFNlY3Rpb24oKSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBuZXcgTWVzc2FnZXNTZWN0aW9uKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgIGxhYmVsOiBuZXcgTGFiZWxTZWN0aW9uKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgIGlucHV0OiBuZXcgSW5wdXRTZWN0aW9uKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgIHNlYXJjaDogbmV3IFNlYXJjaFNlY3Rpb24oX3RoaXMuYXR0cnMsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmNsb3NlKCk7IH0sIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICBfdGhpcy52YWx1ZXMudGFnLnZhbHVlID0gbWF5YmVfMS5qdXN0KGUudmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vbkNoYW5nZSlcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cub25DaGFuZ2UobmV3IEl0ZW1DaGFuZ2VkRXZlbnQoJycgKyBfdGhpcy5hdHRycy53dy5uYW1lLCBlLnZhbHVlKSk7XG4gICAgICAgICAgICAgICAgX3RoaXMudmlldy5pbnZhbGlkYXRlKCk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHRhZzoge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogZmVlZGJhY2tfMS5nZXRWYWxpZGl0eUNsYXNzTmFtZShfdGhpcy5hdHRycyksXG4gICAgICAgICAgICAgICAgdmFsdWU6ICgoX3RoaXMuYXR0cnMud3cgJiZcbiAgICAgICAgICAgICAgICAgICAgKF90aGlzLmF0dHJzLnd3LnZhbHVlICE9IHVuZGVmaW5lZCkpID9cbiAgICAgICAgICAgICAgICAgICAgbWF5YmVfMS5qdXN0KF90aGlzLmF0dHJzLnd3LnZhbHVlKSA6IG1heWJlXzEubm90aGluZygpKSxcbiAgICAgICAgICAgICAgICBkaXNhYmxlZDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmRpc2FibGVkKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmRpc2FibGVkIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgaXNTZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnZhbHVlcy50YWcudmFsdWUuaXNKdXN0KCk7IH0sXG4gICAgICAgICAgICAgICAgZ2V0VGV4dDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuc3RyaW5naWZpZXIpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuYXR0cnMud3cuc3RyaW5naWZpZXIoX3RoaXMudmFsdWVzLnRhZy52YWx1ZS5nZXQoKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRpc21pc3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMudmFsdWVzLnRhZy52YWx1ZSA9IG1heWJlXzEubm90aGluZygpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cub25VbnNldClcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uVW5zZXQobmV3IEl0ZW1VbnNldEV2ZW50KF90aGlzLmF0dHJzLnd3Lm5hbWUgKyAnJykpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy52aWV3LmludmFsaWRhdGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgU2VsZWN0LnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBleHBvcnRzLm9wZW4odGhpcy52aWV3LCB0aGlzLnZhbHVlcy5zZWFyY2gud21sLmlkKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBTZWxlY3QucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBleHBvcnRzLmNsb3NlKHRoaXMudmlldywgdGhpcy52YWx1ZXMuc2VhcmNoLndtbC5pZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgU2VsZWN0LnByb3RvdHlwZS5zZXRNZXNzYWdlID0gZnVuY3Rpb24gKG1zZykge1xuICAgICAgICB0aGlzLnZhbHVlcy5tZXNzYWdlcy50ZXh0ID0gbXNnO1xuICAgICAgICBmb3JtXzEuc2V0TWVzc2FnZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLm1lc3NhZ2VzLndtbC5pZCwgbXNnKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBTZWxlY3QucHJvdG90eXBlLnJlbW92ZU1lc3NhZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudmFsdWVzLm1lc3NhZ2VzLnRleHQgPSAnJztcbiAgICAgICAgZm9ybV8xLnJlbW92ZU1lc3NhZ2UodGhpcy52aWV3LCB0aGlzLnZhbHVlcy5tZXNzYWdlcy53bWwuaWQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIHVwZGF0ZSB0aGUgU2VsZWN0IHdpdGggbmV3IGl0ZW0gb3B0aW9ucyB0b1xuICAgICAqIHByZXNlbnQgdG8gdGhlIHVzZXIuXG4gICAgICovXG4gICAgU2VsZWN0LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAocmVzdWx0cykge1xuICAgICAgICBleHBvcnRzLnVwZGF0ZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLnNlYXJjaC53bWwuaWQsIHJlc3VsdHMpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIHJldHVybiBTZWxlY3Q7XG59KGZvcm1fMS5BYnN0cmFjdEZvcm1Db250cm9sKSk7XG5leHBvcnRzLlNlbGVjdCA9IFNlbGVjdDtcbi8qKlxuICogb3BlbiBoZWxwZXIuXG4gKlxuICogSW52b2tlcyB0aGUgb3BlbiBtZXRob2Qgb24gdGhlIFNlYXJjaCB3aWRnZXQuXG4gKi9cbmV4cG9ydHMub3BlbiA9IGZ1bmN0aW9uICh2aWV3LCBpZCkge1xuICAgIHV0aWxfMS5nZXRCeUlkKHZpZXcsIGlkKVxuICAgICAgICAubWFwKGZ1bmN0aW9uIChtKSB7IHJldHVybiBtLm9wZW4oKTsgfSk7XG59O1xuLyoqXG4gKiBjbG9zZSBoZWxwZXIuXG4gKlxuICogSW52b2tlcyB0aGUgY2xvc2UgbWV0aG9kIG9uIHRoZSBTZWFyY2ggd2lkZ2V0LlxuICovXG5leHBvcnRzLmNsb3NlID0gZnVuY3Rpb24gKHZpZXcsIGlkKSB7XG4gICAgdXRpbF8xLmdldEJ5SWQodmlldywgaWQpXG4gICAgICAgIC5tYXAoZnVuY3Rpb24gKG0pIHsgcmV0dXJuIG0uY2xvc2UoKTsgfSk7XG59O1xuLyoqXG4gKiB1cGRhdGUgaGVscGVyLlxuICpcbiAqIEludm9rZXMgdGhlIHVwZGF0ZSBtZXRob2Qgb24gdGhlIFNlYXJjaCB3aWRnZXQuXG4gKi9cbmV4cG9ydHMudXBkYXRlID0gZnVuY3Rpb24gKHZpZXcsIGlkLCByZXN1bHRzKSB7XG4gICAgdmFyIG1TZWFyY2ggPSB1dGlsXzEuZ2V0QnlJZCh2aWV3LCBpZCk7XG4gICAgaWYgKG1TZWFyY2guaXNKdXN0KCkpXG4gICAgICAgIG1TZWFyY2guZ2V0KCkudXBkYXRlKHJlc3VsdHMpO1xufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIHNlYXJjaF8xID0gcmVxdWlyZShcIi4uLy4uL3NlYXJjaFwiKTtcbjtcbnZhciBsYWJlbF8xID0gcmVxdWlyZShcIi4uLy4uL2xhYmVsXCIpO1xuO1xudmFyIGhlbHBfMSA9IHJlcXVpcmUoXCIuLi8uLi9oZWxwXCIpO1xuO1xudmFyIHRhZ18xID0gcmVxdWlyZShcIi4uLy4uL3RhZ1wiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMucm9vdC5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5yb290LmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cyhbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbGFiZWxfMS5MYWJlbCh7IHd3OiB7ICdmb3InOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuaWQsICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5sYWJlbC50ZXh0IH0gfSwgW10pLCB7IHd3OiB7ICdmb3InOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuaWQsICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5sYWJlbC50ZXh0IH0gfSlcbiAgICAgICAgICAgIF0sICgoX19jb250ZXh0LnZhbHVlcy50YWcuaXNTZXQoKSkgP1xuICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7IHJldHVybiAoW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWdfMS5UYWcoeyB3dzogeyAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMudGFnLmdldFRleHQoKSwgJ2NsYXNzTmFtZSc6IF9fY29udGV4dC52YWx1ZXMudGFnLmNsYXNzTmFtZSwgJ2Rpc2FibGVkJzogX19jb250ZXh0LnZhbHVlcy50YWcuZGlzYWJsZWQsICdvbkRpc21pc3MnOiBfX2NvbnRleHQudmFsdWVzLnRhZy5kaXNtaXNzIH0gfSwgW10pLCB7IHd3OiB7ICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy50YWcuZ2V0VGV4dCgpLCAnY2xhc3NOYW1lJzogX19jb250ZXh0LnZhbHVlcy50YWcuY2xhc3NOYW1lLCAnZGlzYWJsZWQnOiBfX2NvbnRleHQudmFsdWVzLnRhZy5kaXNhYmxlZCwgJ29uRGlzbWlzcyc6IF9fY29udGV4dC52YWx1ZXMudGFnLmRpc21pc3MgfSB9KVxuICAgICAgICAgICAgICAgIF0pOyB9KSgpIDpcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgc2VhcmNoXzEuU2VhcmNoKHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLndtbC5pZCB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLm5hbWUsICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5jbGFzc05hbWUsICdibG9jayc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLmJsb2NrLCAncGxhY2Vob2xkZXInOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5wbGFjZWhvbGRlciwgJ3JlYWRPbmx5JzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gucmVhZE9ubHksICdkaXNhYmxlZCc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLmRpc2FibGVkLCAnaXRlbVRlbXBsYXRlJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2guaXRlbVRlbXBsYXRlLCAnbm9JdGVtc1RlbXBsYXRlJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gubm9JdGVtc1RlbXBsYXRlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gub25TZWFyY2gsICdvblNlbGVjdCc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLm9uU2VsZWN0IH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC53bWwuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5uYW1lLCAnY2xhc3NOYW1lJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2guY2xhc3NOYW1lLCAnYmxvY2snOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5ibG9jaywgJ3BsYWNlaG9sZGVyJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gucGxhY2Vob2xkZXIsICdyZWFkT25seSc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLnJlYWRPbmx5LCAnZGlzYWJsZWQnOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5kaXNhYmxlZCwgJ2l0ZW1UZW1wbGF0ZSc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLml0ZW1UZW1wbGF0ZSwgJ25vSXRlbXNUZW1wbGF0ZSc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLm5vSXRlbXNUZW1wbGF0ZSwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2guc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLm9uU2VhcmNoLCAnb25TZWxlY3QnOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5vblNlbGVjdCB9IH0pXG4gICAgICAgICAgICAgICAgXSk7IH0pKCkpLCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaGVscF8xLkhlbHAoeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5tZXNzYWdlcy53bWwuaWQgfSwgd3c6IHsgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLm1lc3NhZ2VzLnRleHQgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubWVzc2FnZXMud21sLmlkIH0sIHd3OiB7ICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5tZXNzYWdlcy50ZXh0IH0gfSlcbiAgICAgICAgICAgIF0pKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNlbGVjdC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5TdGFja1NlbGVjdCA9IGV4cG9ydHMuSXRlbXNDaGFuZ2VkRXZlbnQgPSBleHBvcnRzLlNUQUNLX1NFTEVDVCA9IGV4cG9ydHMuVGVybUNoYW5nZWRFdmVudCA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9zdGFjay1zZWxlY3RcIik7XG52YXIgb3JpZW50YXRpb25fMSA9IHJlcXVpcmUoXCIuLi8uLi9jb250ZW50L29yaWVudGF0aW9uXCIpO1xudmFyIGZvcm1fMSA9IHJlcXVpcmUoXCIuLi9mb3JtXCIpO1xudmFyIHNlYXJjaF8xID0gcmVxdWlyZShcIi4uL3NlYXJjaFwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlRlcm1DaGFuZ2VkRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHNlYXJjaF8xLlRlcm1DaGFuZ2VkRXZlbnQ7IH0gfSk7XG52YXIgc2VsZWN0XzEgPSByZXF1aXJlKFwiLi4vc2VsZWN0XCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLi8uLi9cIik7XG52YXIgX18yID0gcmVxdWlyZShcIi4uL1wiKTtcbnZhciBmZWVkYmFja18xID0gcmVxdWlyZShcIi4uL2ZlZWRiYWNrXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5TVEFDS19TRUxFQ1QgPSAnd3ctc3RhY2stc2VsZWN0Jztcbi8qKlxuICogSXRlbXNDaGFuZ2VkRXZlbnRcbiAqL1xudmFyIEl0ZW1zQ2hhbmdlZEV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhJdGVtc0NoYW5nZWRFdmVudCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBJdGVtc0NoYW5nZWRFdmVudCgpIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gSXRlbXNDaGFuZ2VkRXZlbnQ7XG59KF9fMi5FdmVudCkpO1xuZXhwb3J0cy5JdGVtc0NoYW5nZWRFdmVudCA9IEl0ZW1zQ2hhbmdlZEV2ZW50O1xuLyoqXG4gKiBTdGFja1NlbGVjdCBwcm92aWRlcyBhIGNvbnRyb2wgZm9yIGFsbG93aW5nIGEgdXNlciB0byBzZWxlY3RcbiAqIG11bHRpcGxlIGl0ZW1zIGZyb20gYSBsaXN0LlxuICpcbiAqIEl0IHVzZSBhIHN0YWNrIHRvIGRpc3BsYXkgdGhlIHNlbGVjdGVkIGl0ZW1zLlxuICpcbiAqICAgICArPT09PT09PT09PT09PT09PT09PT09PT09PStcbiAqICAgICB8ICA8c2VsZWN0PiAgICAgICAgICAgICAgIHxcbiAqICAgICArPT09PT09PT09PT09PT09PT09PT09PT09PStcbiAqICAgICArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAqICAgICB8ICAgPGl0ZW0+ICAgICAgICAgICAgICB4IHxcbiAqICAgICArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAqICAgICArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAqICAgICB8ICAgPGl0ZW0+ICAgICAgICAgICAgICB4IHxcbiAqICAgICArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAqICAgICArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAqICAgICB8ICAgPGl0ZW0+ICAgICAgICAgICAgICB4IHxcbiAqICAgICArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAqL1xudmFyIFN0YWNrU2VsZWN0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhTdGFja1NlbGVjdCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBTdGFja1NlbGVjdCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHJvb3Q6IHtcbiAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdyb290J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuU1RBQ0tfU0VMRUNULCBfXzEuZ2V0Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSwgZmVlZGJhY2tfMS5nZXRWYWxpZGl0eUNsYXNzTmFtZShfdGhpcy5hdHRycyksIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5ibG9jaykgPyBvcmllbnRhdGlvbl8xLkJMT0NLIDogJycpLFxuICAgICAgICAgICAgICAgIGRpcjogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmRpcikgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5kaXIgOiAxXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udHJvbDoge1xuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ3Jvb3QnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnbGFiZWwnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0ZXh0OiBmb3JtXzEuZ2V0TGFiZWwoX3RoaXMuYXR0cnMpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VhcmNoOiB7XG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnc2VhcmNoJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbmFtZTogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm5hbWUpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cubmFtZSA6ICcnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgYmxvY2s6IHRydWUsXG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5kaXNhYmxlZCkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5kaXNhYmxlZCA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cucGxhY2Vob2xkZXIpIHx8ICcnLFxuICAgICAgICAgICAgICAgIG9uU2VhcmNoOiBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vblNlYXJjaClcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uU2VhcmNoKGV2dCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvblNlbGVjdDogZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IF9hLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMucHVzaCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnbWVzc2FnZSdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRleHQ6IGZlZWRiYWNrXzEuZ2V0TWVzc2FnZShfdGhpcy5hdHRycylcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdGFjazoge1xuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ3N0YWNrJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbmFtZTogX18yLmdldE5hbWUoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgICAgIGRpc2FibGVkOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZGlzYWJsZWQpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuZGlzYWJsZWQgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnZhbHVlKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LnZhbHVlIDogW10sXG4gICAgICAgICAgICAgICAgZGVjb3JhdG9yOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuc3RyaW5naWZpZXIpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuc3RyaW5naWZpZXIgOiBmdW5jdGlvbiAodikgeyByZXR1cm4gU3RyaW5nKHYpOyB9LFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cub25DaGFuZ2UpXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vbkNoYW5nZShlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgU3RhY2tTZWxlY3QucHJvdG90eXBlLnNldE1lc3NhZ2UgPSBmdW5jdGlvbiAobXNnKSB7XG4gICAgICAgIGZvcm1fMS5zZXRNZXNzYWdlKHRoaXMudmlldywgdGhpcy52YWx1ZXMubWVzc2FnZXMud21sLmlkLCBtc2cpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIFN0YWNrU2VsZWN0LnByb3RvdHlwZS5yZW1vdmVNZXNzYWdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmb3JtXzEucmVtb3ZlTWVzc2FnZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLm1lc3NhZ2VzLndtbC5pZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogdXBkYXRlIHRoZSBsaXN0IG9mIGF2YWlsYWJsZSBvcHRpb25zIGRpc3BsYXllZCB0byB0aGUgdXNlci5cbiAgICAgKi9cbiAgICBTdGFja1NlbGVjdC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKGxpc3QpIHtcbiAgICAgICAgc2VsZWN0XzEudXBkYXRlKHRoaXMudmlldywgdGhpcy52YWx1ZXMuc2VhcmNoLndtbC5pZCwgbGlzdCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogcHVzaCBhIHZhbHVlIG9udG8gdGhlIHN0YWNrLlxuICAgICAqL1xuICAgIFN0YWNrU2VsZWN0LnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpc1xuICAgICAgICAgICAgLnZpZXdcbiAgICAgICAgICAgIC5maW5kQnlJZCh0aGlzLnZhbHVlcy5zdGFjay53bWwuaWQpXG4gICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChzKSB7IHJldHVybiBzLnB1c2godik7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIHJldHVybiBTdGFja1NlbGVjdDtcbn0oZm9ybV8xLkFic3RyYWN0Rm9ybUNvbnRyb2wpKTtcbmV4cG9ydHMuU3RhY2tTZWxlY3QgPSBTdGFja1NlbGVjdDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIHNlYXJjaF8xID0gcmVxdWlyZShcIi4uLy4uL3NlYXJjaFwiKTtcbjtcbnZhciBzdGFja18xID0gcmVxdWlyZShcIi4uLy4uL3N0YWNrXCIpO1xuO1xudmFyIGxhYmVsXzEgPSByZXF1aXJlKFwiLi4vLi4vbGFiZWxcIik7XG47XG52YXIgaGVscF8xID0gcmVxdWlyZShcIi4uLy4uL2hlbHBcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgnZGl2JywgeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMucm9vdC5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKCgoX19jb250ZXh0LnZhbHVlcy5yb290LmRpciA9PT0gLTEpKSA/XG4gICAgICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGxhYmVsXzEuTGFiZWwoeyB3dzogeyAnZm9yJzogX19jb250ZXh0LnZhbHVlcy5yb290LmlkLCAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMubGFiZWwudGV4dCB9IH0sIFtdKSwgeyB3dzogeyAnZm9yJzogX19jb250ZXh0LnZhbHVlcy5yb290LmlkLCAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMubGFiZWwudGV4dCB9IH0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBzZWFyY2hfMS5TZWFyY2goeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gud21sLmlkIH0sIHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gubmFtZSwgJ3ZhbHVlJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gudmFsdWUsICdibG9jayc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLmJsb2NrLCAnZGlzYWJsZWQnOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5kaXNhYmxlZCwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5zdGFjay5kZWNvcmF0b3IsICdwbGFjZWhvbGRlcic6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLnBsYWNlaG9sZGVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5vblNlYXJjaCwgJ29uU2VsZWN0JzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gub25TZWxlY3QgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLndtbC5pZCB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLm5hbWUsICd2YWx1ZSc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLnZhbHVlLCAnYmxvY2snOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5ibG9jaywgJ2Rpc2FibGVkJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2guZGlzYWJsZWQsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMuc3RhY2suZGVjb3JhdG9yLCAncGxhY2Vob2xkZXInOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5wbGFjZWhvbGRlciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gub25TZWFyY2gsICdvblNlbGVjdCc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLm9uU2VsZWN0IH0gfSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHN0YWNrXzEuU3RhY2soeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5zdGFjay53bWwuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLnN0YWNrLm5hbWUsICd2YWx1ZSc6IF9fY29udGV4dC52YWx1ZXMuc3RhY2sudmFsdWUsICdkaXNhYmxlZCc6IF9fY29udGV4dC52YWx1ZXMuc3RhY2suZGlzYWJsZWQsICdkZWNvcmF0b3InOiBfX2NvbnRleHQudmFsdWVzLnN0YWNrLmRlY29yYXRvciwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5zdGFjay5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5zdGFjay53bWwuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLnN0YWNrLm5hbWUsICd2YWx1ZSc6IF9fY29udGV4dC52YWx1ZXMuc3RhY2sudmFsdWUsICdkaXNhYmxlZCc6IF9fY29udGV4dC52YWx1ZXMuc3RhY2suZGlzYWJsZWQsICdkZWNvcmF0b3InOiBfX2NvbnRleHQudmFsdWVzLnN0YWNrLmRlY29yYXRvciwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5zdGFjay5vbkNoYW5nZSB9IH0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBoZWxwXzEuSGVscCh7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLm1lc3NhZ2VzLndtbC5pZCB9LCB3dzogeyAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMubWVzc2FnZXMudGV4dCB9IH0sIFtdKSwgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5tZXNzYWdlcy53bWwuaWQgfSwgd3c6IHsgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLm1lc3NhZ2VzLnRleHQgfSB9KVxuICAgICAgICAgICAgICAgIF0pOyB9KSgpIDpcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbGFiZWxfMS5MYWJlbCh7IHd3OiB7ICdmb3InOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuaWQsICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5sYWJlbC50ZXh0IH0gfSwgW10pLCB7IHd3OiB7ICdmb3InOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuaWQsICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5sYWJlbC50ZXh0IH0gfSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHN0YWNrXzEuU3RhY2soeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5zdGFjay53bWwuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLnN0YWNrLm5hbWUsICd2YWx1ZSc6IF9fY29udGV4dC52YWx1ZXMuc3RhY2sudmFsdWUsICdkZWNvcmF0b3InOiBfX2NvbnRleHQudmFsdWVzLnN0YWNrLmRlY29yYXRvciwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5zdGFjay5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5zdGFjay53bWwuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLnN0YWNrLm5hbWUsICd2YWx1ZSc6IF9fY29udGV4dC52YWx1ZXMuc3RhY2sudmFsdWUsICdkZWNvcmF0b3InOiBfX2NvbnRleHQudmFsdWVzLnN0YWNrLmRlY29yYXRvciwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5zdGFjay5vbkNoYW5nZSB9IH0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBzZWFyY2hfMS5TZWFyY2goeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gud21sLmlkIH0sIHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gubmFtZSwgJ3ZhbHVlJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gudmFsdWUsICdibG9jayc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLmJsb2NrLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLnN0YWNrLmRlY29yYXRvciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gub25TZWFyY2gsICdvblNlbGVjdCc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLm9uU2VsZWN0IH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC53bWwuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5uYW1lLCAndmFsdWUnOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC52YWx1ZSwgJ2Jsb2NrJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2guYmxvY2ssICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMuc3RhY2suZGVjb3JhdG9yLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5vblNlYXJjaCwgJ29uU2VsZWN0JzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gub25TZWxlY3QgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaGVscF8xLkhlbHAoeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5tZXNzYWdlcy53bWwuaWQgfSwgd3c6IHsgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLm1lc3NhZ2VzLnRleHQgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubWVzc2FnZXMud21sLmlkIH0sIHd3OiB7ICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5tZXNzYWdlcy50ZXh0IH0gfSlcbiAgICAgICAgICAgICAgICBdKTsgfSkoKSkpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXN0YWNrLXNlbGVjdC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5TdGFjayA9IGV4cG9ydHMuU3RhY2tDaGFuZ2VkRXZlbnQgPSBleHBvcnRzLlNUQUNLX0NMT1NFX0JVVFRPTiA9IGV4cG9ydHMuU1RBQ0tfRUxFTUVOVF9DT05URU5UID0gZXhwb3J0cy5TVEFDS19FTEVNRU5UID0gZXhwb3J0cy5TVEFDSyA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9zdGFja1wiKTtcbnZhciBkb21fMSA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciBfXzIgPSByZXF1aXJlKFwiLi4vXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5TVEFDSyA9ICd3dy1zdGFjayc7XG5leHBvcnRzLlNUQUNLX0VMRU1FTlQgPSAnd3ctc3RhY2tfX2VsZW1lbnQnO1xuZXhwb3J0cy5TVEFDS19FTEVNRU5UX0NPTlRFTlQgPSAnd3ctc3RhY2tfX2VsZW1lbnRfX2NvbnRlbnQnO1xuZXhwb3J0cy5TVEFDS19DTE9TRV9CVVRUT04gPSAnd3ctc3RhY2tfX2J1dHRvbic7XG4vKipcbiAqIFN0YWNrQ2hhbmdlZEV2ZW50IGlzIGdlbmVyYXRlZCB3aGVuIHRoZSB1c2VyIHJlbW92ZXMgYW4gaXRlbSBmcm9tIHRoZSBzdGFjay5cbiAqL1xudmFyIFN0YWNrQ2hhbmdlZEV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhTdGFja0NoYW5nZWRFdmVudCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBTdGFja0NoYW5nZWRFdmVudCgpIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gU3RhY2tDaGFuZ2VkRXZlbnQ7XG59KF9fMi5FdmVudCkpO1xuZXhwb3J0cy5TdGFja0NoYW5nZWRFdmVudCA9IFN0YWNrQ2hhbmdlZEV2ZW50O1xuLyoqXG4gKiBTdGFjayBkaXNwbGF5cyBhIGxpc3Qgb2YgaXRlbXMgdGhhdCBjYW4gYmUgbW9kaWZpZWRcbiAqIGJ5IHJlbGVhc2luZyBvbmUgb3IgbW9yZSBhdCBhIHRpbWUuXG4gKi9cbnZhciBTdGFjayA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoU3RhY2ssIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gU3RhY2soKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4oX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICByb290OiB7XG4gICAgICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuU1RBQ0ssIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgICAgICBkaXNhYmxlZDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmRpc2FibGVkKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmRpc2FibGVkIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdmFsdWU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy52YWx1ZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy52YWx1ZSA6IFtdLFxuICAgICAgICAgICAgICAgIGZpcmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFfdGhpcy52YWx1ZXMucm9vdC5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm9uQ2hhbmdlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uQ2hhbmdlKG5ldyBTdGFja0NoYW5nZWRFdmVudChfdGhpcy5hdHRycy53dy5uYW1lLCBfdGhpcy52YWx1ZXMucm9vdC52YWx1ZS5zbGljZSgpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy52aWV3LmludmFsaWRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbGVtZW50OiB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBleHBvcnRzLlNUQUNLX0VMRU1FTlQsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6IGZ1bmN0aW9uICh2LCBpZHgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5lbGVtZW50VGVtcGxhdGUpID9cbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmVsZW1lbnRUZW1wbGF0ZShfdGhpcykodikoaWR4KShfdGhpcy52aWV3KSA6XG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3cy5jb250ZW50KF90aGlzLCB2LCBpZHgpKF90aGlzLnZpZXcpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IGV4cG9ydHMuU1RBQ0tfRUxFTUVOVF9DT05URU5UXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gKGluZGV4KSB7IHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnZhbHVlcy5yb290LnZhbHVlLnNwbGljZShOdW1iZXIoaW5kZXgpLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMudmFsdWVzLnJvb3QuZmlyZSgpO1xuICAgICAgICAgICAgICAgIH07IH0sXG4gICAgICAgICAgICAgICAgZGVjb3JhdG9yOiBmdW5jdGlvbiAodikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZG9tXzEudGV4dCgoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZGVjb3JhdG9yKSA/XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5kZWNvcmF0b3IodikgOiB2ICsgJycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjbG9zZToge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogZXhwb3J0cy5TVEFDS19DTE9TRV9CVVRUT05cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBwdXNoIGEgbmV3IG1lbWJlciBvbnRvIHRoZSBzdGFjay5cbiAgICAgKi9cbiAgICBTdGFjay5wcm90b3R5cGUucHVzaCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICB0aGlzLnZhbHVlcy5yb290LnZhbHVlLnB1c2godmFsdWUpO1xuICAgICAgICB0aGlzLnZhbHVlcy5yb290LmZpcmUoKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICByZXR1cm4gU3RhY2s7XG59KF9fMi5BYnN0cmFjdENvbnRyb2wpKTtcbmV4cG9ydHMuU3RhY2sgPSBTdGFjaztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSBleHBvcnRzLmNvbnRlbnQgPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbmV4cG9ydHMuY29udGVudCA9IGZ1bmN0aW9uIChzLCB2LCBfKSB7IHJldHVybiBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgICAgX190aGlzLm5vZGUoJ2RpdicsIHsgJ2NsYXNzJzogcy52YWx1ZXMuZWxlbWVudC5jb250ZW50LmNsYXNzTmFtZSB9LCBbXG4gICAgICAgICAgICBzLnZhbHVlcy5lbGVtZW50LmRlY29yYXRvcih2KVxuICAgICAgICBdKVxuICAgIF07XG59OyB9O1xuO1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgndWwnLCB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMucm9vdC5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5yb290LmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cyhfX2ZvckluKF9fY29udGV4dC52YWx1ZXMucm9vdC52YWx1ZSwgZnVuY3Rpb24gKHYsIGluZGV4LCBfJCRhbGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2xpJywgeyAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmVsZW1lbnQuY2xhc3NOYW1lIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQudmFsdWVzLmVsZW1lbnQudGVtcGxhdGUodiwgaW5kZXgpKSwgKCgoX19jb250ZXh0LnZhbHVlcy5yb290LmRpc2FibGVkID09PSBmYWxzZSkpID9cbiAgICAgICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7IHJldHVybiAoW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdidXR0b24nLCB7ICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY2xvc2UuY2xhc3NOYW1lLCAnb25jbGljayc6IF9fY29udGV4dC52YWx1ZXMuZWxlbWVudC5jbG9zZShpbmRleCkgfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCfDlycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pOyB9KSgpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7IHJldHVybiAoW10pOyB9KSgpKSkpXG4gICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7IHJldHVybiAoW10pOyB9KSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c3RhY2suanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuU3dpdGNoID0gZXhwb3J0cy5Td2l0Y2hDaGFuZ2VkRXZlbnQgPSBleHBvcnRzLlNXSVRDSF9TTElERVIgPSBleHBvcnRzLlNXSVRDSCA9IHZvaWQgMDtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbFwiKTtcbnZhciBfXzEgPSByZXF1aXJlKFwiLi4vLi4vXCIpO1xudmFyIF9fMiA9IHJlcXVpcmUoXCIuLi9cIik7XG52YXIgc3dpdGNoXzEgPSByZXF1aXJlKFwiLi93bWwvc3dpdGNoXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5TV0lUQ0ggPSAnd3ctc3dpdGNoJztcbmV4cG9ydHMuU1dJVENIX1NMSURFUiA9ICd3dy1zd2l0Y2hfX3NsaWRlcic7XG4vKipcbiAqIFN3aXRjaENoYW5nZWRFdmVudCBzaWduYWxzIHRoZSB1c2VyIGhhcyBjaGFuZ2VkIHRoZSBzd2l0Y2guXG4gKi9cbnZhciBTd2l0Y2hDaGFuZ2VkRXZlbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFN3aXRjaENoYW5nZWRFdmVudCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBTd2l0Y2hDaGFuZ2VkRXZlbnQoKSB7XG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIFN3aXRjaENoYW5nZWRFdmVudDtcbn0oX18yLkV2ZW50KSk7XG5leHBvcnRzLlN3aXRjaENoYW5nZWRFdmVudCA9IFN3aXRjaENoYW5nZWRFdmVudDtcbi8qKlxuICogU3dpdGNoIGFsbG93cyB0aGUgdXNlciB0byBzZWxlY3QgYmV0d2VlbiBvbmUgb3IgdHdvIHZhbHVlcy5cbiAqL1xudmFyIFN3aXRjaCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoU3dpdGNoLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFN3aXRjaCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgc3dpdGNoXzEuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHJvb3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5TV0lUQ0gsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNsaWRlcjoge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogZXhwb3J0cy5TV0lUQ0hfU0xJREVSXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW5wdXQ6IHtcbiAgICAgICAgICAgICAgICBuYW1lOiBfXzIuZ2V0TmFtZShfdGhpcy5hdHRycyksXG4gICAgICAgICAgICAgICAgdmFsdWU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy52YWx1ZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy52YWx1ZSA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNoZWNrZWQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnZhbHVlcy5pbnB1dC52YWx1ZSA/IHRydWUgOiB1bmRlZmluZWQ7IH0sXG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ6IF9fMi5nZXREaXNhYmxlZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMudmFsdWVzLmlucHV0LnZhbHVlID0gKCFfdGhpcy52YWx1ZXMuaW5wdXQudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm9uQ2hhbmdlKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uQ2hhbmdlKG5ldyBTd2l0Y2hDaGFuZ2VkRXZlbnQoX3RoaXMudmFsdWVzLmlucHV0Lm5hbWUsIF90aGlzLnZhbHVlcy5pbnB1dC52YWx1ZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gU3dpdGNoO1xufShfXzIuQWJzdHJhY3RDb250cm9sKSk7XG5leHBvcnRzLlN3aXRjaCA9IFN3aXRjaDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdsYWJlbCcsIHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5yb290LmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuY2xhc3NOYW1lIH0sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnaW5wdXQnLCB7ICd0eXBlJzogJ2NoZWNrYm94JywgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmlucHV0Lm5hbWUsICdjaGVja2VkJzogX19jb250ZXh0LnZhbHVlcy5pbnB1dC5jaGVja2VkKCksICdkaXNhYmxlZCc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQuZGlzYWJsZWQsICdvbmNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMuaW5wdXQub25DaGFuZ2UgfSwgW10pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdkaXYnLCB7ICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuc2xpZGVyLmNsYXNzTmFtZSB9LCBbXSlcbiAgICAgICAgICAgIF0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c3dpdGNoLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlRhYkJhciA9IGV4cG9ydHMuVGFiID0gZXhwb3J0cy5UYWJDbGlja2VkRXZlbnQgPSBleHBvcnRzLlRBQl9CQVIgPSBleHBvcnRzLlRBQiA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC90YWItYmFyXCIpO1xudmFyIGRvbV8xID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbnZhciB3bWxfMSA9IHJlcXVpcmUoXCJAcXVlbmsvd21sXCIpO1xudmFyIGFjdGl2ZV8xID0gcmVxdWlyZShcIi4uLy4uL2NvbnRlbnQvc3RhdGUvYWN0aXZlXCIpO1xudmFyIG9yaWVudGF0aW9uXzEgPSByZXF1aXJlKFwiLi4vLi4vY29udGVudC9vcmllbnRhdGlvblwiKTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbFwiKTtcbnZhciBfXzEgPSByZXF1aXJlKFwiLi4vLi4vXCIpO1xudmFyIF9fMiA9IHJlcXVpcmUoXCIuLi9cIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG4vKipcbiAqIFRBQlxuICovXG5leHBvcnRzLlRBQiA9ICd3dy10YWInO1xuLyoqXG4gKiBUQUJfQkFSXG4gKi9cbmV4cG9ydHMuVEFCX0JBUiA9ICd3dy10YWItYmFyJztcbi8qKlxuICogVGFiQ2xpY2tlZEV2ZW50IGlzIGZpcmVkIHdoZW4gYSB1c2VyIGNsaWNrcyBvbiBhIHRhYi5cbiAqXG4gKiBJdCBjb250YWlucyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgdGFiIHRoYXQgd2FzIGNsaWNrZWQuXG4gKi9cbnZhciBUYWJDbGlja2VkRXZlbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFRhYkNsaWNrZWRFdmVudCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBUYWJDbGlja2VkRXZlbnQobmFtZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBuYW1lLCBuYW1lKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gVGFiQ2xpY2tlZEV2ZW50O1xufShfXzIuRXZlbnQpKTtcbmV4cG9ydHMuVGFiQ2xpY2tlZEV2ZW50ID0gVGFiQ2xpY2tlZEV2ZW50O1xuLyoqXG4gKiBUYWIgcHJvdmlkZXMgYSBzaW5nbGUgdGFiIGl0ZW0uXG4gKlxuICogV2hlbiBhIHRhYiBpcyBjbGlja2VkLCBpdCBhdHRlbXB0cyB0byByZW1vdmUgdGhlIGFjdGl2ZSBjbGFzcyBmcm9tXG4gKiBpdCdzIHNpYmxpbmdzIGFuZCBhcHBseSBpdCB0byBpdHNlbGYuIFRoZXJlZm9yZSB0aGUgc2libGluZyBvZiBhXG4gKiB0YWIgc2hvdWxkIGFsd2F5cyBiZSBhIFRhYi5cbiAqL1xudmFyIFRhYiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVGFiLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFRhYigpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuVGFiKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgcm9vdDoge1xuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ3Jvb3QnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5UQUIsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpLCAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuYWN0aXZlKSA/IGFjdGl2ZV8xLkFDVElWRSA6ICcnKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhOiB7XG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnbGluaydcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy50ZXh0KSA/XG4gICAgICAgICAgICAgICAgICAgIFtkb21fMS50ZXh0KF90aGlzLmF0dHJzLnd3LnRleHQpXSA6IF90aGlzLmNoaWxkcmVuLFxuICAgICAgICAgICAgICAgIGNsaWNrZWQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1heWJlUm9vdCA9IHV0aWxfMS5nZXRCeUlkKF90aGlzLnZpZXcsIF90aGlzLnZhbHVlcy5yb290LndtbC5pZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtYXliZVJvb3QuaXNOb3RoaW5nKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIHZhciByb290ID0gbWF5YmVSb290LmdldCgpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gcm9vdC5wYXJlbnROb2RlO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2licyA9IHBhcmVudC5jaGlsZHJlbjtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaWJzLmxlbmd0aDsgaSsrKVxuICAgICAgICAgICAgICAgICAgICAgICAgc2lic1tpXS5jbGFzc0xpc3QucmVtb3ZlKGFjdGl2ZV8xLkFDVElWRSk7XG4gICAgICAgICAgICAgICAgICAgIHJvb3QuY2xhc3NMaXN0LmFkZChhY3RpdmVfMS5BQ1RJVkUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cub25DbGljaylcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uQ2xpY2sobmV3IFRhYkNsaWNrZWRFdmVudChcIlwiICsgX3RoaXMuYXR0cnMud3cubmFtZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBjbGljayB0aGlzIFRhYlxuICAgICAqL1xuICAgIFRhYi5wcm90b3R5cGUuY2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHV0aWxfMS5nZXRCeUlkKHRoaXMudmlldywgdGhpcy52YWx1ZXMucm9vdC53bWwuaWQpXG4gICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmNsaWNrKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIHJldHVybiBUYWI7XG59KF9fMi5BYnN0cmFjdENvbnRyb2wpKTtcbmV4cG9ydHMuVGFiID0gVGFiO1xuLyoqXG4gKiBUYWJCYXIgYWN0cyBhcyBhIHBhcmVudCBjb250YWluZXIgZm9yIGEgZ3JvdXAgb2YgVGFiLlxuICpcbiAqIFVzZSBpdCB0byBjcmVhdGUgYSB0YWJiZWQgbmF2aWdhdGlvbiBvciB2aWV3IGZvciBtYWluIGxheW91dCxcbiAqIHN1YiB2aWV3cyBvciBmb3JtcyBldGMuXG4gKi9cbnZhciBUYWJCYXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFRhYkJhciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBUYWJCYXIoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLlRhYkJhcihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHJvb3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5UQUJfQkFSLCBfXzEuZ2V0Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSwgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lmp1c3RpZnkpID8gb3JpZW50YXRpb25fMS5KVVNUSUZJRUQgOiAnJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gVGFiQmFyO1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuVGFiQmFyID0gVGFiQmFyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheXMgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXlzKSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcbiAgICAgICAgICAgIHJba10gPSBhW2pdO1xuICAgIHJldHVybiByO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuVGFiID0gZXhwb3J0cy5UYWJCYXIgPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBUYWJCYXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVGFiQmFyKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCd1bCcsIHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5yb290LmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuY2xhc3NOYW1lIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQuY2hpbGRyZW4pKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIFRhYkJhci5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIFRhYkJhci5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBUYWJCYXIucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBUYWJCYXIucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgVGFiQmFyLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBUYWJCYXIucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgVGFiQmFyLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBUYWJCYXIucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gVGFiQmFyO1xufSgpKTtcbmV4cG9ydHMuVGFiQmFyID0gVGFiQmFyO1xuO1xudmFyIFRhYiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBUYWIoX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2xpJywgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5yb290LndtbC5pZCB9LCAnaWQnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMucm9vdC5jbGFzc05hbWUgfSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdhJywgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5hLndtbC5pZCB9LCAnaHJlZic6ICcjJywgJ29uY2xpY2snOiBfX2NvbnRleHQudmFsdWVzLmEuY2xpY2tlZCB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LnZhbHVlcy5hLmNvbnRlbnQpKSlcbiAgICAgICAgICAgIF0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBUYWIucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBUYWIucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgVGFiLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgVGFiLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIFRhYi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgVGFiLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIFRhYi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgVGFiLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIFRhYjtcbn0oKSk7XG5leHBvcnRzLlRhYiA9IFRhYjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXRhYi1iYXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuVGFnID0gZXhwb3J0cy5EaXNtaXNzRXZlbnQgPSBleHBvcnRzLlRBR19DT05UUk9MX0RJU01JU1MgPSBleHBvcnRzLlRBR19DT05UUk9MX1RFWFQgPSBleHBvcnRzLlRBR19DT05UUk9MID0gdm9pZCAwO1xudmFyIHN0eWxlXzEgPSByZXF1aXJlKFwiLi4vLi4vY29udGVudC9zdHlsZVwiKTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbFwiKTtcbnZhciBfXzEgPSByZXF1aXJlKFwiLi4vLi4vXCIpO1xudmFyIF9fMiA9IHJlcXVpcmUoXCIuLi9cIik7XG52YXIgdGFnXzEgPSByZXF1aXJlKFwiLi93bWwvdGFnXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5UQUdfQ09OVFJPTCA9ICd3dy10YWctY29udHJvbCc7XG5leHBvcnRzLlRBR19DT05UUk9MX1RFWFQgPSAnd3ctdGFnLWNvbnRyb2xfX3RleHQnO1xuZXhwb3J0cy5UQUdfQ09OVFJPTF9ESVNNSVNTID0gJ3d3LXRhZy1jb250cm9sX19kaXNtaXNzJztcbi8qKlxuICogRGlzbWlzc0V2ZW50IGlzIGdlbmVyYXRlZCB3aGVuIHRoZSBjbG9zZSBidXR0b24gdXMgY2xpY2tlZC5cbiAqL1xudmFyIERpc21pc3NFdmVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoRGlzbWlzc0V2ZW50LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIERpc21pc3NFdmVudChuYW1lKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG5hbWUsIHVuZGVmaW5lZCkgfHwgdGhpcztcbiAgICAgICAgX3RoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIERpc21pc3NFdmVudDtcbn0oX18yLkV2ZW50KSk7XG5leHBvcnRzLkRpc21pc3NFdmVudCA9IERpc21pc3NFdmVudDtcbi8qKlxuICogVGFnIGRpc3BsYXlzIHNvbWUgdGV4dCBpbiBhIGRpc21pc3NhYmxlIHRhZy5cbiAqXG4gKiBUaGUgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoaXMgVGFnIGFuZCB0aGUgb25lIGZyb20gdGhlIGNvbnRlbnRcbiAqIG1vZHVsZSBpcyB0aGF0IHRoaXMgb25lIGlzIHByaW1hcmlseSBtZWFudCB0byBiZSB1c2VkIGFzIGEgY29udHJvbFxuICogb3IgYXMgcGFydCBvZiBhIG1vcmUgY29tcGxpY2F0ZWQgY29udHJvbC5cbiAqL1xudmFyIFRhZyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVGFnLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFRhZygpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdGFnXzEuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIGlkOiBfXzEuZ2V0SWQoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuVEFHX0NPTlRST0wsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIHN0eWxlOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuc3R5bGUpID9cbiAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5zdHlsZSA6IHN0eWxlXzEuU3R5bGUuRGVmYXVsdCxcbiAgICAgICAgICAgIGRpc2FibGVkOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZGlzYWJsZWQpID9cbiAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5kaXNhYmxlZCA6IGZhbHNlLFxuICAgICAgICAgICAgdGV4dDoge1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogZXhwb3J0cy5UQUdfQ09OVFJPTF9URVhULFxuICAgICAgICAgICAgICAgIHZhbHVlOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cudGV4dCkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy50ZXh0IDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRpc21pc3M6IHtcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IGV4cG9ydHMuVEFHX0NPTlRST0xfRElTTUlTUyxcbiAgICAgICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vbkRpc21pc3MpXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vbkRpc21pc3MobmV3IERpc21pc3NFdmVudChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5uYW1lIHx8ICcnKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBUYWc7XG59KF9fMi5BYnN0cmFjdENvbnRyb2wpKTtcbmV4cG9ydHMuVGFnID0gVGFnO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheXMgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXlzKSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcbiAgICAgICAgICAgIHJba10gPSBhW2pdO1xuICAgIHJldHVybiByO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG52YXIgdCA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jb250ZW50L3RhZ1wiKTtcbjtcbnZhciBjbG9zZV8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NvbnRlbnQvY2xvc2VcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyB0LlRhZyh7IHd3OiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQsICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSwgJ3N0eWxlJzogX19jb250ZXh0LnZhbHVlcy5zdHlsZSB9IH0sIF9fc3ByZWFkQXJyYXlzKCgoKF9fY29udGV4dC52YWx1ZXMudGV4dC52YWx1ZSAhPT0gJycpKSA/XG4gICAgICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdzcGFuJywgeyAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLnRleHQuY2xhc3NOYW1lIH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQoX19jb250ZXh0LnZhbHVlcy50ZXh0LnZhbHVlKVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pOyB9KSgpIDpcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgdGV4dCgnJylcbiAgICAgICAgICAgICAgICBdKTsgfSkoKSksIChfX2NvbnRleHQuY2hpbGRyZW4pLCAoKChfX2NvbnRleHQudmFsdWVzLmRpc2FibGVkICE9PSB0cnVlKSkgP1xuICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7IHJldHVybiAoW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBjbG9zZV8xLkNsb3NlKHsgd3c6IHsgJ2NsYXNzTmFtZSc6IF9fY29udGV4dC52YWx1ZXMuZGlzbWlzcy5jbGFzc05hbWUsICdvbkNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5kaXNtaXNzLm9uQ2xpY2sgfSB9LCBbXSksIHsgd3c6IHsgJ2NsYXNzTmFtZSc6IF9fY29udGV4dC52YWx1ZXMuZGlzbWlzcy5jbGFzc05hbWUsICdvbkNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5kaXNtaXNzLm9uQ2xpY2sgfSB9KVxuICAgICAgICAgICAgICAgIF0pOyB9KSgpIDpcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtdKTsgfSkoKSkpKSwgeyB3dzogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLCAnY2xhc3NOYW1lJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUsICdzdHlsZSc6IF9fY29udGV4dC52YWx1ZXMuc3R5bGUgfSB9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXRhZy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5UZXh0RmllbGQgPSBleHBvcnRzLlRFWFRfRklFTEQgPSBleHBvcnRzLlRleHRDaGFuZ2VkRXZlbnQgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvdGV4dC1maWVsZFwiKTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbFwiKTtcbnZhciBmZWVkYmFja18xID0gcmVxdWlyZShcIi4uL2ZlZWRiYWNrXCIpO1xudmFyIGZvcm1fMSA9IHJlcXVpcmUoXCIuLi9mb3JtXCIpO1xudmFyIHRleHRfaW5wdXRfMSA9IHJlcXVpcmUoXCIuLi90ZXh0LWlucHV0XCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiVGV4dENoYW5nZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGV4dF9pbnB1dF8xLlRleHRDaGFuZ2VkRXZlbnQ7IH0gfSk7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciBfXzIgPSByZXF1aXJlKFwiLi4vXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5URVhUX0ZJRUxEID0gJ3d3LXRleHQtZmllbGQnO1xuLyoqXG4gKiBUZXh0RmllbGQgcHJvdmlkZXMgYSB3cmFwcGVkIG5hdGl2ZSB0ZXh0IGlucHV0IGNvbnRyb2wuXG4gKi9cbnZhciBUZXh0RmllbGQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFRleHRGaWVsZCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBUZXh0RmllbGQoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4oX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICByb290OiB7XG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAncm9vdCdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLlRFWFRfRklFTEQsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpLCBmZWVkYmFja18xLmdldFZhbGlkaXR5Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZXNzYWdlczoge1xuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ21lc3NhZ2UnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0ZXh0OiBmZWVkYmFja18xLmdldE1lc3NhZ2UoX3RoaXMuYXR0cnMpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGFiZWw6IHtcbiAgICAgICAgICAgICAgICBpZDogX18yLmdldE5hbWUoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgICAgIHRleHQ6IGZvcm1fMS5nZXRMYWJlbChfdGhpcy5hdHRycylcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250cm9sOiB7XG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAncm9vdCdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGlkOiBfXzEuZ2V0SWQoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgICAgIG5hbWU6IF9fMi5nZXROYW1lKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgICAgICB0eXBlOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cudHlwZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy50eXBlIDogJ3RleHQnLFxuICAgICAgICAgICAgICAgIG1pbjogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm1pbikgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5taW4gOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgbWF4OiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cubWF4KSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm1heCA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBmb2N1czogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmZvY3VzKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmZvY3VzIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cucGxhY2Vob2xkZXIpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cucGxhY2Vob2xkZXIgOiAnJyxcbiAgICAgICAgICAgICAgICBtYXRjaDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm1hdGNoKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm1hdGNoIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIGxlbmd0aDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lmxlbmd0aCkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5sZW5ndGggOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdmFsdWU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy52YWx1ZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy52YWx1ZSA6ICcnLFxuICAgICAgICAgICAgICAgIGRpc2FibGVkOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZGlzYWJsZWQpID8gdHJ1ZSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICByZWFkT25seTogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnJlYWRPbmx5KSA/XG4gICAgICAgICAgICAgICAgICAgIHRydWUgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgcm93czogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnJvd3MpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cucm93cyA6IDEsXG4gICAgICAgICAgICAgICAgb25pbnB1dDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm9uQ2hhbmdlKSA/XG4gICAgICAgICAgICAgICAgICAgIG9uaW5wdXQoX3RoaXMpIDogZnVuY3Rpb24gKCkgeyB9LFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cub25DaGFuZ2UpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cub25DaGFuZ2UgOiBmdW5jdGlvbiAoKSB7IH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBUZXh0RmllbGQucHJvdG90eXBlLnNldE1lc3NhZ2UgPSBmdW5jdGlvbiAobXNnKSB7XG4gICAgICAgIGdldEhlbHAodGhpcykubWFwKGZ1bmN0aW9uIChoKSB7IHJldHVybiBoLnNldE1lc3NhZ2UobXNnKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgVGV4dEZpZWxkLnByb3RvdHlwZS5yZW1vdmVNZXNzYWdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBnZXRIZWxwKHRoaXMpLm1hcChmdW5jdGlvbiAoaCkgeyByZXR1cm4gaC5yZW1vdmVNZXNzYWdlKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIHJldHVybiBUZXh0RmllbGQ7XG59KGZvcm1fMS5BYnN0cmFjdEZvcm1Db250cm9sKSk7XG5leHBvcnRzLlRleHRGaWVsZCA9IFRleHRGaWVsZDtcbnZhciBnZXRIZWxwID0gZnVuY3Rpb24gKHQpIHtcbiAgICByZXR1cm4gdXRpbF8xLmdldEJ5SWQodC52aWV3LCB0LnZhbHVlcy5tZXNzYWdlcy53bWwuaWQpO1xufTtcbnZhciBvbmlucHV0ID0gZnVuY3Rpb24gKGYpIHsgcmV0dXJuIGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKGYuYXR0cnMud3cgJiYgZi5hdHRycy53dyAmJiBmLmF0dHJzLnd3Lm9uQ2hhbmdlKVxuICAgICAgICBmLmF0dHJzLnd3Lm9uQ2hhbmdlKG5ldyB0ZXh0X2lucHV0XzEuVGV4dENoYW5nZWRFdmVudCgoZi5hdHRycy53dyAmJiBmLmF0dHJzLnd3Lm5hbWUpID9cbiAgICAgICAgICAgIGYuYXR0cnMud3cubmFtZSA6ICcnLCBlLnRhcmdldC52YWx1ZSkpO1xufTsgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBsYWJlbF8xID0gcmVxdWlyZShcIi4uLy4uL2xhYmVsXCIpO1xuO1xudmFyIGhlbHBfMSA9IHJlcXVpcmUoXCIuLi8uLi9oZWxwXCIpO1xuO1xudmFyIHRleHRfaW5wdXRfMSA9IHJlcXVpcmUoXCIuLi8uLi90ZXh0LWlucHV0XCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMucm9vdC53bWwuaWQgfSwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5yb290LmNsYXNzTmFtZSB9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbGFiZWxfMS5MYWJlbCh7IHd3OiB7ICdmb3InOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wuaWQsICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5sYWJlbC50ZXh0IH0gfSwgW10pLCB7IHd3OiB7ICdmb3InOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wuaWQsICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5sYWJlbC50ZXh0IH0gfSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGV4dF9pbnB1dF8xLlRleHRJbnB1dCh7IHd3OiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC5pZCwgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wubmFtZSwgJ2ZvY3VzJzogX19jb250ZXh0LnZhbHVlcy5jb250cm9sLmZvY3VzLCAncGxhY2Vob2xkZXInOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wucGxhY2Vob2xkZXIsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC5vbkNoYW5nZSwgJ2Jsb2NrJzogdHJ1ZSwgJ3R5cGUnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wudHlwZSwgJ21pbic6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC5taW4sICdtYXgnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wubWF4LCAnbWF0Y2gnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wubWF0Y2gsICdsZW5ndGgnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wubGVuZ3RoLCAndmFsdWUnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wudmFsdWUsICdyb3dzJzogX19jb250ZXh0LnZhbHVlcy5jb250cm9sLnJvd3MsICdkaXNhYmxlZCc6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC5kaXNhYmxlZCwgJ3JlYWRPbmx5JzogX19jb250ZXh0LnZhbHVlcy5jb250cm9sLnJlYWRPbmx5IH0gfSwgW10pLCB7IHd3OiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC5pZCwgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wubmFtZSwgJ2ZvY3VzJzogX19jb250ZXh0LnZhbHVlcy5jb250cm9sLmZvY3VzLCAncGxhY2Vob2xkZXInOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wucGxhY2Vob2xkZXIsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC5vbkNoYW5nZSwgJ2Jsb2NrJzogdHJ1ZSwgJ3R5cGUnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wudHlwZSwgJ21pbic6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC5taW4sICdtYXgnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wubWF4LCAnbWF0Y2gnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wubWF0Y2gsICdsZW5ndGgnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wubGVuZ3RoLCAndmFsdWUnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRyb2wudmFsdWUsICdyb3dzJzogX19jb250ZXh0LnZhbHVlcy5jb250cm9sLnJvd3MsICdkaXNhYmxlZCc6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC5kaXNhYmxlZCwgJ3JlYWRPbmx5JzogX19jb250ZXh0LnZhbHVlcy5jb250cm9sLnJlYWRPbmx5IH0gfSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaGVscF8xLkhlbHAoeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5tZXNzYWdlcy53bWwuaWQgfSwgd3c6IHsgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLm1lc3NhZ2VzLnRleHQgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubWVzc2FnZXMud21sLmlkIH0sIHd3OiB7ICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5tZXNzYWdlcy50ZXh0IH0gfSlcbiAgICAgICAgICAgIF0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dGV4dC1maWVsZC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5UZXh0SW5wdXQgPSBleHBvcnRzLlRleHRDaGFuZ2VkRXZlbnQgPSBleHBvcnRzLlRFWFRfSU5QVVQgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvdGV4dC1pbnB1dFwiKTtcbnZhciB0aW1lcl8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9jb250cm9sL3RpbWVyXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIG9yaWVudGF0aW9uXzEgPSByZXF1aXJlKFwiLi4vLi4vY29udGVudC9vcmllbnRhdGlvblwiKTtcbnZhciBzaXplXzEgPSByZXF1aXJlKFwiLi4vLi4vY29udGVudC9zaXplXCIpO1xudmFyIGZvY3VzXzEgPSByZXF1aXJlKFwiLi4vZm9jdXNcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciBfXzIgPSByZXF1aXJlKFwiLi4vXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5URVhUX0lOUFVUID0gJ3d3LXRleHQtaW5wdXQnO1xuLyoqXG4gKiBUZXh0Q2hhbmdlZEV2ZW50XG4gKi9cbnZhciBUZXh0Q2hhbmdlZEV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhUZXh0Q2hhbmdlZEV2ZW50LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFRleHRDaGFuZ2VkRXZlbnQoKSB7XG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIFRleHRDaGFuZ2VkRXZlbnQ7XG59KF9fMi5FdmVudCkpO1xuZXhwb3J0cy5UZXh0Q2hhbmdlZEV2ZW50ID0gVGV4dENoYW5nZWRFdmVudDtcbi8qKlxuICogVGV4dElucHV0IHByb3ZpZGVzIHNvbWUgZXh0cmEgc3R5bGluZyB0byB0aGUgbmF0aXZlIGlucHV0LlxuICovXG52YXIgVGV4dElucHV0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhUZXh0SW5wdXQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gVGV4dElucHV0KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5yb3dzICYmIF90aGlzLmF0dHJzLnd3LnJvd3MgPiAxKSA/XG4gICAgICAgICAgICBuZXcgdmlld3MuVGV4dGFyZWEoX3RoaXMpIDogbmV3IHZpZXdzLklucHV0KF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgY29udHJvbDoge1xuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ3Jvb3QnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlkOiBfXzEuZ2V0SWQoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuVEVYVF9JTlBVVCwgX18xLmdldENsYXNzTmFtZShfdGhpcy5hdHRycyksIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5zaXplKSA/XG4gICAgICAgICAgICAgICAgc2l6ZV8xLmdldFNpemVDbGFzc05hbWUoX3RoaXMuYXR0cnMud3cuc2l6ZSkgOiAnJywgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmJsb2NrKSA/XG4gICAgICAgICAgICAgICAgb3JpZW50YXRpb25fMS5CTE9DSyA6ICcnKSxcbiAgICAgICAgICAgIG5hbWU6IF9fMi5nZXROYW1lKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgIHR5cGU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy50eXBlKSA/XG4gICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cudHlwZSA6ICd0ZXh0JyxcbiAgICAgICAgICAgIG1pbjogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm1pbikgP1xuICAgICAgICAgICAgICAgIFN0cmluZyhfdGhpcy5hdHRycy53dy5taW4pIDogbnVsbCxcbiAgICAgICAgICAgIG1heDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm1heCkgP1xuICAgICAgICAgICAgICAgIFN0cmluZyhfdGhpcy5hdHRycy53dy5tYXgpIDogbnVsbCxcbiAgICAgICAgICAgIG1hdGNoOiBuZXcgUmVnRXhwKChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5tYXRjaCkgP1xuICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm1hdGNoIDogJy4nKSxcbiAgICAgICAgICAgIGxlbmd0aDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lmxlbmd0aCkgP1xuICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lmxlbmd0aCA6IEluZmluaXR5LFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5wbGFjZWhvbGRlcikgP1xuICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LnBsYWNlaG9sZGVyIDogJycsXG4gICAgICAgICAgICB2YWx1ZTogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnZhbHVlKSA/XG4gICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cudmFsdWUgOiAnJyxcbiAgICAgICAgICAgIHJvd3M6IFN0cmluZygoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cucm93cykgP1xuICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LnJvd3MgOiAxKSxcbiAgICAgICAgICAgIGRpc2FibGVkOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZGlzYWJsZWQgPT09IHRydWUpID9cbiAgICAgICAgICAgICAgICB0cnVlIDogbnVsbCxcbiAgICAgICAgICAgIHJlYWRPbmx5OiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cucmVhZE9ubHkgPT09IHRydWUpID9cbiAgICAgICAgICAgICAgICB0cnVlIDogbnVsbCxcbiAgICAgICAgICAgIG9ua2V5ZG93bjogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZS5rZXkubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGUudGFyZ2V0LnZhbHVlIHx8ICcnO1xuICAgICAgICAgICAgICAgICAgICBpZiAoKCFfdGhpcy52YWx1ZXMubWF0Y2gudGVzdChlLmtleSkpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAodmFsdWUubGVuZ3RoID4gX3RoaXMudmFsdWVzLmxlbmd0aCkpXG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uaW5wdXQ6IGRpc3BhdGNoSW5wdXQoX3RoaXMpLFxuICAgICAgICAgICAgYXV0b2ZvY3VzOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZm9jdXMpID8gdHJ1ZSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIG9uZm9jdXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cub25Gb2N1c0dhaW5lZClcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cub25Gb2N1c0dhaW5lZChuZXcgZm9jdXNfMS5Gb2N1c0dhaW5lZEV2ZW50KF9fMi5nZXROYW1lKF90aGlzLmF0dHJzKSkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uYmx1cjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vbkZvY3VzTG9zdClcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cub25Gb2N1c0xvc3QobmV3IGZvY3VzXzEuRm9jdXNMb3N0RXZlbnQoX18yLmdldE5hbWUoX3RoaXMuYXR0cnMpKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgVGV4dElucHV0LnByb3RvdHlwZS5yZW5kZXJlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMudmFsdWVzLmF1dG9mb2N1cyA9PT0gdHJ1ZSlcbiAgICAgICAgICAgIHRoaXMuZm9jdXMoKTtcbiAgICB9O1xuICAgIFRleHRJbnB1dC5wcm90b3R5cGUuZm9jdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHJldHVybiB0aW1lcl8xLnRpY2soZnVuY3Rpb24gKCkgeyByZXR1cm4gZm9jdXNfMS5mb2N1cyhfdGhpcy52aWV3LCBfdGhpcy52YWx1ZXMuY29udHJvbC53bWwuaWQpOyB9KTtcbiAgICB9O1xuICAgIHJldHVybiBUZXh0SW5wdXQ7XG59KF9fMi5BYnN0cmFjdENvbnRyb2wpKTtcbmV4cG9ydHMuVGV4dElucHV0ID0gVGV4dElucHV0O1xuLyoqXG4gKiBkaXNwYXRjaElucHV0IHdoZW4gdGhlIHVzZXIgaW5wdXRzIHNvbWUgdGV4dC5cbiAqL1xudmFyIGRpc3BhdGNoSW5wdXQgPSBmdW5jdGlvbiAoaSkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoaS5hdHRycy53dyAmJiBpLmF0dHJzLnd3Lm9uQ2hhbmdlKVxuICAgICAgICBpLmF0dHJzLnd3Lm9uQ2hhbmdlKG5ldyBUZXh0Q2hhbmdlZEV2ZW50KChpLmF0dHJzICYmIGkuYXR0cnMud3cubmFtZSkgP1xuICAgICAgICAgICAgaS5hdHRycy53dy5uYW1lIDogJycsIGUudGFyZ2V0LnZhbHVlKSk7XG59OyB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLklucHV0ID0gZXhwb3J0cy5UZXh0YXJlYSA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIFRleHRhcmVhID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFRleHRhcmVhKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCd0ZXh0YXJlYScsIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC53bWwuaWQgfSwgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5pZCwgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLm5hbWUsICdwbGFjZWhvbGRlcic6IF9fY29udGV4dC52YWx1ZXMucGxhY2Vob2xkZXIsICdvbmlucHV0JzogX19jb250ZXh0LnZhbHVlcy5vbmlucHV0LCAndmFsdWUnOiBfX2NvbnRleHQudmFsdWVzLnZhbHVlLCAnZGlzYWJsZWQnOiBfX2NvbnRleHQudmFsdWVzLmRpc2FibGVkLCAncmVhZG9ubHknOiBfX2NvbnRleHQudmFsdWVzLnJlYWRPbmx5LCAncm93cyc6IF9fY29udGV4dC52YWx1ZXMucm93cywgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUgfSwgW1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKF9fY29udGV4dC52YWx1ZXMudmFsdWUpXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgVGV4dGFyZWEucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBUZXh0YXJlYS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBUZXh0YXJlYS5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIFRleHRhcmVhLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIFRleHRhcmVhLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBUZXh0YXJlYS5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBUZXh0YXJlYS5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgVGV4dGFyZWEucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gVGV4dGFyZWE7XG59KCkpO1xuZXhwb3J0cy5UZXh0YXJlYSA9IFRleHRhcmVhO1xuO1xudmFyIElucHV0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIElucHV0KF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdpbnB1dCcsIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuY29udHJvbC53bWwuaWQgfSwgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5pZCwgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLm5hbWUsICd0eXBlJzogX19jb250ZXh0LnZhbHVlcy50eXBlLCAnbWluJzogX19jb250ZXh0LnZhbHVlcy5taW4sICdtYXgnOiBfX2NvbnRleHQudmFsdWVzLm1heCwgJ3BsYWNlaG9sZGVyJzogX19jb250ZXh0LnZhbHVlcy5wbGFjZWhvbGRlciwgJ29uaW5wdXQnOiBfX2NvbnRleHQudmFsdWVzLm9uaW5wdXQsICdvbmtleWRvd24nOiBfX2NvbnRleHQudmFsdWVzLm9ua2V5ZG93biwgJ2F1dG9mb2N1cyc6IF9fY29udGV4dC52YWx1ZXMuYXV0b2ZvY3VzLCAndmFsdWUnOiBfX2NvbnRleHQudmFsdWVzLnZhbHVlLCAnZGlzYWJsZWQnOiBfX2NvbnRleHQudmFsdWVzLmRpc2FibGVkLCAncmVhZG9ubHknOiBfX2NvbnRleHQudmFsdWVzLnJlYWRPbmx5LCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSB9LCBbXSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIElucHV0LnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgSW5wdXQucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgSW5wdXQucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBJbnB1dC5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBJbnB1dC5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgSW5wdXQucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgSW5wdXQucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIElucHV0LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIElucHV0O1xufSgpKTtcbmV4cG9ydHMuSW5wdXQgPSBJbnB1dDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXRleHQtaW5wdXQuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuVG9vbGJhciA9IGV4cG9ydHMuVE9PTEJBUl9DT01QQVQgPSBleHBvcnRzLlRPT0xCQVIgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvdG9vbGJhclwiKTtcbnZhciB3bWxfMSA9IHJlcXVpcmUoXCJAcXVlbmsvd21sXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLi8uLi9cIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLlRPT0xCQVIgPSAnd3ctdG9vbGJhcic7XG5leHBvcnRzLlRPT0xCQVJfQ09NUEFUID0gJy10b29sYmFyLWNvbXBhdCc7XG4vKipcbiAqIFRvb2xiYXIgcHJvdmlkZXMgYSB3aWRnZXQgZm9yIGdyb3VwaW5nIHJlbGF0ZWQgY29udHJvbHMgaW50byBhXG4gKiBzaW5nbGUgcm93LlxuICovXG52YXIgVG9vbGJhciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVG9vbGJhciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBUb29sYmFyKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5NYWluKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgcm9vdDoge1xuICAgICAgICAgICAgICAgIGlkOiBfXzEuZ2V0SWQoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLlRPT0xCQVIsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBUb29sYmFyO1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuVG9vbGJhciA9IFRvb2xiYXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMucm9vdC5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5yb290LmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LmNoaWxkcmVuKSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dG9vbGJhci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5UeXBlYWhlYWQgPSBleHBvcnRzLlRZUEVBSEVBRCA9IGV4cG9ydHMuSXRlbVNlbGVjdGVkRXZlbnQgPSBleHBvcnRzLlRleHRDaGFuZ2VkRXZlbnQgPSBleHBvcnRzLlRlcm1DaGFuZ2VkRXZlbnQgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvdHlwZWFoZWFkXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIGZvcm1fMSA9IHJlcXVpcmUoXCIuLi9mb3JtXCIpO1xudmFyIHNlYXJjaF8xID0gcmVxdWlyZShcIi4uL3NlYXJjaFwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlRlcm1DaGFuZ2VkRXZlbnRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHNlYXJjaF8xLlRlcm1DaGFuZ2VkRXZlbnQ7IH0gfSk7XG52YXIgdGV4dF9maWVsZF8xID0gcmVxdWlyZShcIi4uL3RleHQtZmllbGRcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJUZXh0Q2hhbmdlZEV2ZW50XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0ZXh0X2ZpZWxkXzEuVGV4dENoYW5nZWRFdmVudDsgfSB9KTtcbnZhciBzZWxlY3RfMSA9IHJlcXVpcmUoXCIuLi9zZWxlY3RcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJJdGVtU2VsZWN0ZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc2VsZWN0XzEuSXRlbVNlbGVjdGVkRXZlbnQ7IH0gfSk7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLlRZUEVBSEVBRCA9ICd3dy10eXBlYWhlYWQnO1xuLyoqXG4gKiBUeXBlYWhlYWQgcHJvdmlkZXMgYW4gdGV4dCBpbnB1dCBmaWVsZCB0aGF0IGNhbiBzdWdnZXN0cyB2YWx1ZXNcbiAqIGFzIHRoZSB1c2VyIHR5cGVzLlxuICovXG52YXIgVHlwZWFoZWFkID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhUeXBlYWhlYWQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gVHlwZWFoZWFkKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5NYWluKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgcm9vdDogbmV3IHNlbGVjdF8xLlJvb3RTZWN0aW9uKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgIGNvbnRyb2w6IG5ldyBzZWxlY3RfMS5Db250cm9sU2VjdGlvbigpLFxuICAgICAgICAgICAgbWVzc2FnZXM6IG5ldyBzZWxlY3RfMS5NZXNzYWdlc1NlY3Rpb24oX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgbGFiZWw6IG5ldyBzZWxlY3RfMS5MYWJlbFNlY3Rpb24oX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgc2VhcmNoOiBuZXcgc2VsZWN0XzEuU2VhcmNoU2VjdGlvbihfdGhpcy5hdHRycywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuY2xvc2UoKTsgfSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIHZhciBtU2VhcmNoID0gdXRpbF8xLmdldEJ5SWQoX3RoaXMudmlldywgX3RoaXMudmFsdWVzLnNlYXJjaC53bWwuaWQpO1xuICAgICAgICAgICAgICAgIGlmIChtU2VhcmNoLmlzSnVzdCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzID0gbVNlYXJjaC5nZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0ciA9IChfdGhpcy52YWx1ZXMuc2VhcmNoLnN0cmluZ2lmaWVyKSA/XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy52YWx1ZXMuc2VhcmNoLnN0cmluZ2lmaWVyKGUudmFsdWUpIDogZS52YWx1ZSArICcnO1xuICAgICAgICAgICAgICAgICAgICBzLnNldChzdHIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cub25DaGFuZ2UpXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vbkNoYW5nZShuZXcgdGV4dF9maWVsZF8xLlRleHRDaGFuZ2VkRXZlbnQoJycgKyBfdGhpcy5hdHRycy53dy5uYW1lLCBzdHIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIFR5cGVhaGVhZC5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2VsZWN0XzEub3Blbih0aGlzLnZpZXcsIHRoaXMudmFsdWVzLnNlYXJjaC53bWwuaWQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIFR5cGVhaGVhZC5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGVjdF8xLmNsb3NlKHRoaXMudmlldywgdGhpcy52YWx1ZXMuc2VhcmNoLndtbC5pZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgVHlwZWFoZWFkLnByb3RvdHlwZS5zZXRNZXNzYWdlID0gZnVuY3Rpb24gKG1zZykge1xuICAgICAgICB0aGlzLnZhbHVlcy5tZXNzYWdlcy50ZXh0ID0gbXNnO1xuICAgICAgICBmb3JtXzEuc2V0TWVzc2FnZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLm1lc3NhZ2VzLndtbC5pZCwgbXNnKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBUeXBlYWhlYWQucHJvdG90eXBlLnJlbW92ZU1lc3NhZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudmFsdWVzLm1lc3NhZ2VzLnRleHQgPSAnJztcbiAgICAgICAgZm9ybV8xLnJlbW92ZU1lc3NhZ2UodGhpcy52aWV3LCB0aGlzLnZhbHVlcy5tZXNzYWdlcy53bWwuaWQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIFR5cGVhaGVhZC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKHJlc3VsdHMpIHtcbiAgICAgICAgc2VsZWN0XzEudXBkYXRlKHRoaXMudmlldywgdGhpcy52YWx1ZXMuc2VhcmNoLndtbC5pZCwgcmVzdWx0cyk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgcmV0dXJuIFR5cGVhaGVhZDtcbn0oZm9ybV8xLkFic3RyYWN0Rm9ybUNvbnRyb2wpKTtcbmV4cG9ydHMuVHlwZWFoZWFkID0gVHlwZWFoZWFkO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIHNlYXJjaF8xID0gcmVxdWlyZShcIi4uLy4uL3NlYXJjaFwiKTtcbjtcbnZhciBsYWJlbF8xID0gcmVxdWlyZShcIi4uLy4uL2xhYmVsXCIpO1xuO1xudmFyIGhlbHBfMSA9IHJlcXVpcmUoXCIuLi8uLi9oZWxwXCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5yb290LmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuY2xhc3NOYW1lIH0sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBsYWJlbF8xLkxhYmVsKHsgd3c6IHsgJ2Zvcic6IF9fY29udGV4dC52YWx1ZXMucm9vdC5pZCwgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmxhYmVsLnRleHQgfSB9LCBbXSksIHsgd3c6IHsgJ2Zvcic6IF9fY29udGV4dC52YWx1ZXMucm9vdC5pZCwgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmxhYmVsLnRleHQgfSB9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBzZWFyY2hfMS5TZWFyY2goeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gud21sLmlkIH0sIHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gubmFtZSwgJ2NsYXNzTmFtZSc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLmNsYXNzTmFtZSwgJ2Jsb2NrJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2guYmxvY2ssICdkaXNhYmxlZCc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLmRpc2FibGVkLCAncGxhY2Vob2xkZXInOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5wbGFjZWhvbGRlciwgJ3JlYWRPbmx5JzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gucmVhZE9ubHksICdpdGVtVGVtcGxhdGUnOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5pdGVtVGVtcGxhdGUsICdub0l0ZW1zVGVtcGxhdGUnOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5ub0l0ZW1zVGVtcGxhdGUsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5vblNlYXJjaCwgJ29uU2VsZWN0JzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gub25TZWxlY3QgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLndtbC5pZCB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLm5hbWUsICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5jbGFzc05hbWUsICdibG9jayc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLmJsb2NrLCAnZGlzYWJsZWQnOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5kaXNhYmxlZCwgJ3BsYWNlaG9sZGVyJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gucGxhY2Vob2xkZXIsICdyZWFkT25seSc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLnJlYWRPbmx5LCAnaXRlbVRlbXBsYXRlJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2guaXRlbVRlbXBsYXRlLCAnbm9JdGVtc1RlbXBsYXRlJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gubm9JdGVtc1RlbXBsYXRlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLnNlYXJjaC5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5zZWFyY2gub25TZWFyY2gsICdvblNlbGVjdCc6IF9fY29udGV4dC52YWx1ZXMuc2VhcmNoLm9uU2VsZWN0IH0gfSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaGVscF8xLkhlbHAoeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5tZXNzYWdlcy53bWwuaWQgfSwgd3c6IHsgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLm1lc3NhZ2VzLnRleHQgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubWVzc2FnZXMud21sLmlkIH0sIHd3OiB7ICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5tZXNzYWdlcy50ZXh0IH0gfSlcbiAgICAgICAgICAgIF0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dHlwZWFoZWFkLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlByb3BlcnR5TGlzdCA9IGV4cG9ydHMuRGF0YUN0eCA9IGV4cG9ydHMuUFJPUEVSVFlfTElTVCA9IHZvaWQgMDtcbnZhciB3bWxfMSA9IHJlcXVpcmUoXCJAcXVlbmsvd21sXCIpO1xudmFyIHBhdGhfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9yZWNvcmQvcGF0aFwiKTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbFwiKTtcbnZhciBfXzEgPSByZXF1aXJlKFwiLi4vLi4vXCIpO1xudmFyIHByb3BlcnR5X2xpc3RfMSA9IHJlcXVpcmUoXCIuL3dtbC9wcm9wZXJ0eS1saXN0XCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5QUk9QRVJUWV9MSVNUID0gJ3d3LXByb3BlcnR5LWxpc3QnO1xuLyoqXG4gKiBEYXRhQ3R4XG4gKi9cbnZhciBEYXRhQ3R4ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIERhdGFDdHgoZGF0YSwgbmFtZSwgdmFsdWUsIGZvcm1hdCkge1xuICAgICAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0O1xuICAgIH1cbiAgICByZXR1cm4gRGF0YUN0eDtcbn0oKSk7XG5leHBvcnRzLkRhdGFDdHggPSBEYXRhQ3R4O1xuLyoqXG4gKiBQcm9wZXJ0eUxpc3QgZ2VuZXJhdGVzIGEgZGVzY3JpcHRpb24gbGlzdCB1c2luZyB0aGUgcHJvcGVydGllcyBvZlxuICogYW4gb2JqZWN0LlxuICovXG52YXIgUHJvcGVydHlMaXN0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhQcm9wZXJ0eUxpc3QsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gUHJvcGVydHlMaXN0KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyBwcm9wZXJ0eV9saXN0XzEuUHJvcGVydHlMaXN0VmlldyhfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHJvb3Q6IHtcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5QUk9QRVJUWV9MSVNULCBfXzEuZ2V0Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmaWVsZHM6ICgoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZmllbGRzKSA/XG4gICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuZmllbGRzIDogW10pLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIHZhbHVlOiAoKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmRhdGEpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuZGF0YSA6IHt9KSxcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtRGF0YSA9IHBhdGhfMS5nZXQoZi5uYW1lLCBfdGhpcy52YWx1ZXMuZGF0YS52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtRGF0YS5pc05vdGhpbmcoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgcHJvcGVydHlfbGlzdF8xLk5vdGhpbmdWaWV3KHt9KS5yZW5kZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBtRGF0YS5nZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZtdCA9IChmLmZvcm1hdCkgPyBmLmZvcm1hdCA6IGZ1bmN0aW9uIChjKSB7IHJldHVybiAnJyArIGM7IH07XG4gICAgICAgICAgICAgICAgICAgIHZhciBjdHggPSBuZXcgRGF0YUN0eChkLCBmLm5hbWUsIF90aGlzLnZhbHVlcy5kYXRhLnZhbHVlLCBmbXQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZi5kYXRhRnJhZ21lbnQpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZi5kYXRhRnJhZ21lbnQoY3R4KS5yZW5kZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBwcm9wZXJ0eV9saXN0XzEuRGF0YVZpZXcoY3R4KS5yZW5kZXIoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogc2V0RGF0YSB0byBiZSBkaXNwbGF5ZWQuXG4gICAgICovXG4gICAgUHJvcGVydHlMaXN0LnByb3RvdHlwZS5zZXREYXRhID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgdGhpcy52YWx1ZXMuZGF0YS52YWx1ZSA9IGRhdGE7XG4gICAgICAgIHRoaXMudmlldy5pbnZhbGlkYXRlKCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgcmV0dXJuIFByb3BlcnR5TGlzdDtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLlByb3BlcnR5TGlzdCA9IFByb3BlcnR5TGlzdDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlByb3BlcnR5TGlzdFZpZXcgPSBleHBvcnRzLkRhdGFWaWV3ID0gZXhwb3J0cy5Ob3RoaW5nVmlldyA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG47XG52YXIgZGVzY3JpcHRpb25fbGlzdF8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2xheW91dC9kZXNjcmlwdGlvbi1saXN0XCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBOb3RoaW5nVmlldyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBOb3RoaW5nVmlldyhfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZXNjcmlwdGlvbl9saXN0XzEuRGF0YSh7fSwgW10pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE5vdGhpbmdWaWV3LnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTm90aGluZ1ZpZXcucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTm90aGluZ1ZpZXcucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBOb3RoaW5nVmlldy5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBOb3RoaW5nVmlldy5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTm90aGluZ1ZpZXcucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTm90aGluZ1ZpZXcucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE5vdGhpbmdWaWV3LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE5vdGhpbmdWaWV3O1xufSgpKTtcbmV4cG9ydHMuTm90aGluZ1ZpZXcgPSBOb3RoaW5nVmlldztcbjtcbnZhciBEYXRhVmlldyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBEYXRhVmlldyhfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZXNjcmlwdGlvbl9saXN0XzEuRGF0YSh7fSwgW1xuICAgICAgICAgICAgICAgIHRleHQoX19jb250ZXh0LmZvcm1hdChfX2NvbnRleHQuZGF0YSkpXG4gICAgICAgICAgICBdKSwge30pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBEYXRhVmlldy5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIERhdGFWaWV3LnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIERhdGFWaWV3LnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgRGF0YVZpZXcucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgRGF0YVZpZXcucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIERhdGFWaWV3LnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIERhdGFWaWV3LnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBEYXRhVmlldy5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBEYXRhVmlldztcbn0oKSk7XG5leHBvcnRzLkRhdGFWaWV3ID0gRGF0YVZpZXc7XG47XG52YXIgUHJvcGVydHlMaXN0VmlldyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBQcm9wZXJ0eUxpc3RWaWV3KF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlc2NyaXB0aW9uX2xpc3RfMS5EZXNjcmlwdGlvbkxpc3QoeyB3dzogeyAnY2xhc3NOYW1lJzogX19jb250ZXh0LnZhbHVlcy5yb290LmNsYXNzTmFtZSB9IH0sIF9fc3ByZWFkQXJyYXlzKF9fZm9ySW4oX19jb250ZXh0LnZhbHVlcy5maWVsZHMsIGZ1bmN0aW9uIChmaWVsZCwgXyQkaSwgXyQkYWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlc2NyaXB0aW9uX2xpc3RfMS5UaXRsZSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dChmaWVsZC5oZWFkaW5nKVxuICAgICAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgICAgICBfX2NvbnRleHQudmFsdWVzLmRhdGEuZ2V0KGZpZWxkKVxuICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtdKTsgfSkpKSwgeyB3dzogeyAnY2xhc3NOYW1lJzogX19jb250ZXh0LnZhbHVlcy5yb290LmNsYXNzTmFtZSB9IH0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBQcm9wZXJ0eUxpc3RWaWV3LnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgUHJvcGVydHlMaXN0Vmlldy5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBQcm9wZXJ0eUxpc3RWaWV3LnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgUHJvcGVydHlMaXN0Vmlldy5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBQcm9wZXJ0eUxpc3RWaWV3LnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBQcm9wZXJ0eUxpc3RWaWV3LnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIFByb3BlcnR5TGlzdFZpZXcucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIFByb3BlcnR5TGlzdFZpZXcucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gUHJvcGVydHlMaXN0Vmlldztcbn0oKSk7XG5leHBvcnRzLlByb3BlcnR5TGlzdFZpZXcgPSBQcm9wZXJ0eUxpc3RWaWV3O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cHJvcGVydHktbGlzdC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc29ydEJ5SWQgPSBleHBvcnRzLlNvcnRSZXF1ZXN0ID0gdm9pZCAwO1xudmFyIHBhdGhfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9yZWNvcmQvcGF0aFwiKTtcbnZhciBzb3J0XzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvYXJyYXkvc29ydFwiKTtcbi8qKlxuICogU29ydFJlcXVlc3QgY29udGFpbnMgdGhlIGluZm8gbmVlZGVkIHRvIHByZWZvcm0gYSBzb3J0LlxuICovXG52YXIgU29ydFJlcXVlc3QgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gU29ydFJlcXVlc3QoY29sdW1uLCBkYXRhLCBrZXkpIHtcbiAgICAgICAgdGhpcy5jb2x1bW4gPSBjb2x1bW47XG4gICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XG4gICAgICAgIHRoaXMua2V5ID0ga2V5O1xuICAgIH1cbiAgICByZXR1cm4gU29ydFJlcXVlc3Q7XG59KCkpO1xuZXhwb3J0cy5Tb3J0UmVxdWVzdCA9IFNvcnRSZXF1ZXN0O1xuLyoqXG4gKiBzb3J0QnlJZCBzb3J0cyBhIGRhdGFzZXQgYnkgYSBjb2x1bW4gdXNpbmcgdGhlIGNvbHVtbnMgaWQuXG4gKlxuICogRGF0YSBpcyBvbmx5IHNvcnRlZCBieSBvbmUgY29sdW1uIGF0IGEgdGltZS5cbiAqL1xuZXhwb3J0cy5zb3J0QnlJZCA9IGZ1bmN0aW9uIChjb2xzLCBrZXksIGRhdGEsIGlkKSB7XG4gICAgdmFyIHNwZWMgPSBjb2xzW2lkXTtcbiAgICB2YXIgY3VycmVudCA9IGRhdGFbMF0sIG9yaWdpbmFsID0gZGF0YVsxXTtcbiAgICBpZiAoc3BlYyA9PT0gdW5kZWZpbmVkKVxuICAgICAgICByZXR1cm4gW2N1cnJlbnQsIGtleV07XG4gICAgaWYgKCFzcGVjLnNvcnQpXG4gICAgICAgIHJldHVybiBbY3VycmVudCwga2V5XTtcbiAgICBpZiAoa2V5WzBdID09PSBpZCkge1xuICAgICAgICByZXR1cm4gW2N1cnJlbnQucmV2ZXJzZSgpLCBba2V5WzBdLCBrZXlbMV0gKiAtMV1dO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdmFyIHN0cmF0ZWd5ID0gZ2V0U29ydFN0cmF0ZWd5KHNwZWMuc29ydCk7XG4gICAgICAgIHZhciBhbGlhcyA9IHNwZWMuYWxpYXMgPyBzcGVjLmFsaWFzIDogc3BlYy5uYW1lO1xuICAgICAgICByZXR1cm4gW2RvU29ydChvcmlnaW5hbC5zbGljZSgpLCBzdHJhdGVneSwgYWxpYXMpLCBbaWQsIC0xXV07XG4gICAgfVxufTtcbnZhciBnZXRTb3J0U3RyYXRlZ3kgPSBmdW5jdGlvbiAocykge1xuICAgIGlmICh0eXBlb2YgcyA9PT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgcmV0dXJuIHM7XG4gICAgaWYgKHMgPT09ICdkYXRlJylcbiAgICAgICAgcmV0dXJuIHNvcnRfMS5kYXRlO1xuICAgIGlmIChzID09PSAnbnVtYmVyJylcbiAgICAgICAgcmV0dXJuIHNvcnRfMS5udW1iZXI7XG4gICAgaWYgKHMgPT09ICdzdHJpbmcnKVxuICAgICAgICByZXR1cm4gc29ydF8xLnN0cmluZztcbiAgICByZXR1cm4gc29ydF8xLm5hdHVyYWw7XG59O1xudmFyIGRvU29ydCA9IGZ1bmN0aW9uIChkYXRhLCBzLCBhbGlhcykge1xuICAgIHJldHVybiBkYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIHMoZ2V0QW55KGFsaWFzLCBhKSwgZ2V0QW55KGFsaWFzLCBiKSk7IH0pO1xufTtcbnZhciBnZXRBbnkgPSBmdW5jdGlvbiAocGF0aCwgc3JjKSB7XG4gICAgcmV0dXJuIHBhdGhfMS5nZXREZWZhdWx0KHBhdGgsIHNyYywgdW5kZWZpbmVkKTtcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zb3J0LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5EYXRhQ2hhbmdlZEV2ZW50ID0gZXhwb3J0cy5DZWxsQ2xpY2tlZEV2ZW50ID0gZXhwb3J0cy5IZWFkaW5nQ2xpY2tlZEV2ZW50ID0gdm9pZCAwO1xuLyoqXG4gKiBIZWFkaW5nQ2xpY2tlZEV2ZW50IGlzIHRyaWdnZXJlZCB3aGVuIHRoZSB1c2VyIGNsaWNrcyBvblxuICogb25lIG9mIHRoZSBjb2x1bW4gaGVhZGluZ3MuXG4gKi9cbnZhciBIZWFkaW5nQ2xpY2tlZEV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEhlYWRpbmdDbGlja2VkRXZlbnQoY29sdW1uKSB7XG4gICAgICAgIHRoaXMuY29sdW1uID0gY29sdW1uO1xuICAgIH1cbiAgICByZXR1cm4gSGVhZGluZ0NsaWNrZWRFdmVudDtcbn0oKSk7XG5leHBvcnRzLkhlYWRpbmdDbGlja2VkRXZlbnQgPSBIZWFkaW5nQ2xpY2tlZEV2ZW50O1xuLyoqXG4gKiBDZWxsQ2xpY2tlZEV2ZW50IHRyaWdnZXJlZCB3aGVuIGEgY2VsbCBpcyBjbGlja2VkIG9uLlxuICovXG52YXIgQ2VsbENsaWNrZWRFdmVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDZWxsQ2xpY2tlZEV2ZW50KGNvbHVtbiwgcm93KSB7XG4gICAgICAgIHRoaXMuY29sdW1uID0gY29sdW1uO1xuICAgICAgICB0aGlzLnJvdyA9IHJvdztcbiAgICB9XG4gICAgcmV0dXJuIENlbGxDbGlja2VkRXZlbnQ7XG59KCkpO1xuZXhwb3J0cy5DZWxsQ2xpY2tlZEV2ZW50ID0gQ2VsbENsaWNrZWRFdmVudDtcbi8qKlxuICogRGF0YUNoYW5nZWRFdmVudCBnZW5lcmF0ZWQgd2hlbiB0aGUgaW50ZXJuYWwgcmVwcmVzZW50YXRpb24gb2YgdGhlIGRhdGFcbiAqIGNoYW5nZXMuXG4gKi9cbnZhciBEYXRhQ2hhbmdlZEV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIERhdGFDaGFuZ2VkRXZlbnQobmFtZSwgZGF0YSwga2V5KSB7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XG4gICAgICAgIHRoaXMua2V5ID0ga2V5O1xuICAgIH1cbiAgICByZXR1cm4gRGF0YUNoYW5nZWRFdmVudDtcbn0oKSk7XG5leHBvcnRzLkRhdGFDaGFuZ2VkRXZlbnQgPSBEYXRhQ2hhbmdlZEV2ZW50O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZXZlbnQuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRGF0YVRhYmxlID0gZXhwb3J0cy5OZXdDZWxsQ29udGV4dCA9IGV4cG9ydHMuTmV3Qm9keUNvbnRleHQgPSBleHBvcnRzLk5ld0hlYWRpbmdDb250ZXh0ID0gZXhwb3J0cy5OZXdIZWFkQ29udGV4dCA9IGV4cG9ydHMuREVTQyA9IGV4cG9ydHMuQVNDID0gZXhwb3J0cy5EQVRBX1RBQkxFX0NFTEwgPSBleHBvcnRzLkRBVEFfVEFCTEVfQk9EWSA9IGV4cG9ydHMuREFUQV9UQUJMRV9IRUFESU5HID0gZXhwb3J0cy5EQVRBX1RBQkxFX0hFQUQgPSBleHBvcnRzLkRBVEFfVEFCTEUgPSBleHBvcnRzLkhlYWRpbmdDbGlja2VkRXZlbnQgPSBleHBvcnRzLkNlbGxDbGlja2VkRXZlbnQgPSBleHBvcnRzLkRhdGFDaGFuZ2VkRXZlbnQgPSBleHBvcnRzLlNvcnRSZXF1ZXN0ID0gdm9pZCAwO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL3RhYmxlXCIpO1xudmFyIHdtbF8xID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgYXJyYXlfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9hcnJheVwiKTtcbnZhciBwYXRoXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvcmVjb3JkL3BhdGhcIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciBzb3J0XzEgPSByZXF1aXJlKFwiLi9jb2x1bW4vc29ydFwiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIlNvcnRSZXF1ZXN0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBzb3J0XzEuU29ydFJlcXVlc3Q7IH0gfSk7XG52YXIgZXZlbnRfMSA9IHJlcXVpcmUoXCIuL2V2ZW50XCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiRGF0YUNoYW5nZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXZlbnRfMS5EYXRhQ2hhbmdlZEV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiQ2VsbENsaWNrZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXZlbnRfMS5DZWxsQ2xpY2tlZEV2ZW50OyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiSGVhZGluZ0NsaWNrZWRFdmVudFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZXZlbnRfMS5IZWFkaW5nQ2xpY2tlZEV2ZW50OyB9IH0pO1xudmFyIHJhbmdlXzEgPSByZXF1aXJlKFwiLi9yYW5nZVwiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuREFUQV9UQUJMRSA9ICd3dy1kYXRhLXRhYmxlJztcbmV4cG9ydHMuREFUQV9UQUJMRV9IRUFEID0gJ3d3LWRhdGEtdGFibGVfX2hlYWQnO1xuZXhwb3J0cy5EQVRBX1RBQkxFX0hFQURJTkcgPSAnd3ctZGF0YS10YWJsZV9faGVhZGluZyc7XG5leHBvcnRzLkRBVEFfVEFCTEVfQk9EWSA9ICd3dy1kYXRhLXRhYmxlX19ib2R5JztcbmV4cG9ydHMuREFUQV9UQUJMRV9DRUxMID0gJ3d3LWRhdGEtdGFibGVfX2NlbGwnO1xuZXhwb3J0cy5BU0MgPSAnLWFzYyc7XG5leHBvcnRzLkRFU0MgPSAnLWRlc2MnO1xuLyoqXG4gKiBOZXdIZWFkQ29udGV4dFxuICovXG52YXIgTmV3SGVhZENvbnRleHQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTmV3SGVhZENvbnRleHQodGFibGUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy50YWJsZSA9IHRhYmxlO1xuICAgICAgICB0aGlzLmNsYXNzTmFtZSA9IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5EQVRBX1RBQkxFX0hFQUQsICh0aGlzLnRhYmxlLmF0dHJzLnd3ICYmIHRoaXMudGFibGUuYXR0cnMud3cuaGVhZENsYXNzTmFtZSB8fCAnJykpO1xuICAgICAgICB0aGlzLmNvbHVtbnMgPSB0aGlzLnRhYmxlLnZhbHVlcy5jb2x1bW5zO1xuICAgICAgICB0aGlzLmRhdGEgPSB0aGlzLnRhYmxlLnZhbHVlcy5kYXRhc2V0WzBdO1xuICAgICAgICB0aGlzLmhlYWRpbmcgPSBmdW5jdGlvbiAoYywgaSkge1xuICAgICAgICAgICAgcmV0dXJuIGdldEhlYWRpbmdWaWV3KF90aGlzLnRhYmxlLCBuZXcgTmV3SGVhZGluZ0NvbnRleHQoX3RoaXMudGFibGUsIF90aGlzLCBjLCBpKSwgYykucmVuZGVyKCk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBOZXdIZWFkQ29udGV4dDtcbn0oKSk7XG5leHBvcnRzLk5ld0hlYWRDb250ZXh0ID0gTmV3SGVhZENvbnRleHQ7XG4vKipcbiAqIE5ld0hlYWRpbmdDb250ZXh0XG4gKi9cbnZhciBOZXdIZWFkaW5nQ29udGV4dCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBOZXdIZWFkaW5nQ29udGV4dCh0YWJsZSwgaGVhZENvbnRleHQsIGNvbHVtbiwgaW5kZXgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy50YWJsZSA9IHRhYmxlO1xuICAgICAgICB0aGlzLmhlYWRDb250ZXh0ID0gaGVhZENvbnRleHQ7XG4gICAgICAgIHRoaXMuY29sdW1uID0gY29sdW1uO1xuICAgICAgICB0aGlzLmluZGV4ID0gaW5kZXg7XG4gICAgICAgIHRoaXMuY2xhc3NOYW1lID0gdXRpbF8xLmNvbmNhdChleHBvcnRzLkRBVEFfVEFCTEVfSEVBRElORywgKHRoaXMudGFibGUuYXR0cnMud3cgJiYgdGhpcy50YWJsZS5hdHRycy53dy5oZWFkaW5nQ2xhc3NOYW1lIHx8ICcnKSwgdGhpcy5jb2x1bW4uaGVhZGluZ0NsYXNzTmFtZSwgZ2V0U29ydENsYXNzTmFtZSh0aGlzLnRhYmxlLnZhbHVlcy5zb3J0S2V5LCB0aGlzLmluZGV4KSk7XG4gICAgICAgIHRoaXMub25jbGljayA9IGZ1bmN0aW9uIChfKSB7XG4gICAgICAgICAgICBpZiAoX3RoaXMuY29sdW1uLnNvcnQpXG4gICAgICAgICAgICAgICAgX3RoaXMudGFibGUudmFsdWVzLnNvcnQoX3RoaXMuaW5kZXgpO1xuICAgICAgICAgICAgaWYgKF90aGlzLmNvbHVtbi5vbkhlYWRpbmdDbGlja2VkKVxuICAgICAgICAgICAgICAgIF90aGlzLmNvbHVtbi5vbkhlYWRpbmdDbGlja2VkKG5ldyBldmVudF8xLkhlYWRpbmdDbGlja2VkRXZlbnQoX3RoaXMuaW5kZXgpKTtcbiAgICAgICAgICAgIGlmIChfdGhpcy50YWJsZS5hdHRycy53dyAmJiBfdGhpcy50YWJsZS5hdHRycy53dy5vbkhlYWRpbmdDbGlja2VkKVxuICAgICAgICAgICAgICAgIF90aGlzLnRhYmxlLmF0dHJzLnd3Lm9uSGVhZGluZ0NsaWNrZWQobmV3IGV2ZW50XzEuSGVhZGluZ0NsaWNrZWRFdmVudChfdGhpcy5pbmRleCkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gTmV3SGVhZGluZ0NvbnRleHQ7XG59KCkpO1xuZXhwb3J0cy5OZXdIZWFkaW5nQ29udGV4dCA9IE5ld0hlYWRpbmdDb250ZXh0O1xuLyoqXG4gKiBOZXdCb2R5Q29udGV4dFxuICovXG52YXIgTmV3Qm9keUNvbnRleHQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTmV3Qm9keUNvbnRleHQodGFibGUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy50YWJsZSA9IHRhYmxlO1xuICAgICAgICB0aGlzLmNsYXNzTmFtZSA9IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5EQVRBX1RBQkxFX0JPRFksICh0aGlzLnRhYmxlLmF0dHJzLnd3ICYmIHRoaXMudGFibGUuYXR0cnMud3cuYm9keUNsYXNzTmFtZSB8fCAnJykpO1xuICAgICAgICB0aGlzLmNvbHVtbnMgPSB0aGlzLnRhYmxlLnZhbHVlcy5jb2x1bW5zO1xuICAgICAgICB0aGlzLmRhdGEgPSB0aGlzLnRhYmxlLnZhbHVlcy5kYXRhc2V0WzBdO1xuICAgICAgICB0aGlzLmNlbGwgPSBmdW5jdGlvbiAoYywgaWQsIHJvdykge1xuICAgICAgICAgICAgcmV0dXJuIGdldENlbGxWaWV3KF90aGlzLnRhYmxlLCBuZXcgTmV3Q2VsbENvbnRleHQoX3RoaXMudGFibGUsIF90aGlzLCBjLCBpZCwgcm93KSwgYykucmVuZGVyKCk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBOZXdCb2R5Q29udGV4dDtcbn0oKSk7XG5leHBvcnRzLk5ld0JvZHlDb250ZXh0ID0gTmV3Qm9keUNvbnRleHQ7XG4vKipcbiAqIE5ld0NlbGxDb250ZXh0XG4gKi9cbnZhciBOZXdDZWxsQ29udGV4dCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBOZXdDZWxsQ29udGV4dCh0YWJsZSwgYm9keUNvbnRleHQsIHNwZWMsIGNvbHVtbiwgcm93KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMudGFibGUgPSB0YWJsZTtcbiAgICAgICAgdGhpcy5ib2R5Q29udGV4dCA9IGJvZHlDb250ZXh0O1xuICAgICAgICB0aGlzLnNwZWMgPSBzcGVjO1xuICAgICAgICB0aGlzLmNvbHVtbiA9IGNvbHVtbjtcbiAgICAgICAgdGhpcy5yb3cgPSByb3c7XG4gICAgICAgIHRoaXMuaWQgPSBjZWxsSWQodGhpcy5jb2x1bW4sIHRoaXMucm93KTtcbiAgICAgICAgdGhpcy5jbGFzc05hbWUgPSB1dGlsXzEuY29uY2F0KGV4cG9ydHMuREFUQV9UQUJMRV9DRUxMLCAodGhpcy50YWJsZS5hdHRycy53dyAmJiB0aGlzLnRhYmxlLmF0dHJzLnd3LmNlbGxDbGFzc05hbWUgfHwgJycpLCB0aGlzLnNwZWMuY2VsbENsYXNzTmFtZSwgZ2V0U29ydENsYXNzTmFtZSh0aGlzLnRhYmxlLnZhbHVlcy5zb3J0S2V5LCB0aGlzLmNvbHVtbikpO1xuICAgICAgICB0aGlzLnZhbHVlID0gcGF0aF8xLnVuc2FmZUdldCh0aGlzLnNwZWMubmFtZSwgdGhpcy50YWJsZS52YWx1ZXMuZGF0YXNldFswXVt0aGlzLnJvd10pO1xuICAgICAgICB0aGlzLmRhdHVtID0gdGhpcy50YWJsZS52YWx1ZXMuZGF0YXNldFswXVt0aGlzLnJvd107XG4gICAgICAgIHRoaXMuZm9ybWF0ID0gdGhpcy5zcGVjLmZvcm1hdCA/XG4gICAgICAgICAgICB0aGlzLnNwZWMuZm9ybWF0IDpcbiAgICAgICAgICAgIGZ1bmN0aW9uIChjKSB7IHJldHVybiBTdHJpbmcoYyA9PSBudWxsID8gJycgOiBjKTsgfTtcbiAgICAgICAgdGhpcy5vbmNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKF90aGlzLnNwZWMub25DZWxsQ2xpY2tlZClcbiAgICAgICAgICAgICAgICBfdGhpcy5zcGVjLm9uQ2VsbENsaWNrZWQobmV3IGV2ZW50XzEuQ2VsbENsaWNrZWRFdmVudChfdGhpcy5jb2x1bW4sIF90aGlzLnJvdykpO1xuICAgICAgICAgICAgaWYgKF90aGlzLnRhYmxlLmF0dHJzLnd3ICYmIF90aGlzLnRhYmxlLmF0dHJzLnd3Lm9uQ2VsbENsaWNrZWQpXG4gICAgICAgICAgICAgICAgX3RoaXMudGFibGUuYXR0cnMud3cub25DZWxsQ2xpY2tlZChuZXcgZXZlbnRfMS5DZWxsQ2xpY2tlZEV2ZW50KF90aGlzLmNvbHVtbiwgX3RoaXMucm93KSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBOZXdDZWxsQ29udGV4dDtcbn0oKSk7XG5leHBvcnRzLk5ld0NlbGxDb250ZXh0ID0gTmV3Q2VsbENvbnRleHQ7XG4vKipcbiAqIERhdGFUYWJsZSBjYW4gYmUgdXNlZCBmb3IgZGlzcGxheWluZyBzb3J0YWJsZVxuICogdGFidWxhciBkYXRhLlxuICovXG52YXIgRGF0YVRhYmxlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhEYXRhVGFibGUsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gRGF0YVRhYmxlKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5NYWluKF90aGlzKTtcbiAgICAgICAgX3RoaXMudGhlYWRWaWV3ID0gbmV3IHZpZXdzLkVtcHR5Vmlldyh7fSk7XG4gICAgICAgIF90aGlzLnRib2R5VmlldyA9IG5ldyB2aWV3cy5FbXB0eVZpZXcoe30pO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICB3bWw6IHsgaWQ6ICd0YWJsZScgfSxcbiAgICAgICAgICAgIGlkOiBfXzEuZ2V0SWQoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuREFUQV9UQUJMRSwgX18xLmdldENsYXNzTmFtZShfdGhpcy5hdHRycykpLFxuICAgICAgICAgICAgbmFtZTogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm5hbWUgfHwgJycpLFxuICAgICAgICAgICAgc29ydGFibGU6IChfdGhpcy5hdHRycy53dyAmJiAoX3RoaXMuYXR0cnMud3cuc29ydGFibGUgIT0gbnVsbCkpID9cbiAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5zb3J0YWJsZSA6IHRydWUsXG4gICAgICAgICAgICBzb3J0S2V5OiAoKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnNvcnRLZXkpID9cbiAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5zb3J0S2V5IDogWy0xLCAxXSksXG4gICAgICAgICAgICBzb3J0OiBmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLnZhbHVlcy5zb3J0YWJsZSlcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc29ydChjb2wpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRhdGFzZXQ6ICgoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZGF0YSkgP1xuICAgICAgICAgICAgICAgIFtfdGhpcy5hdHRycy53dy5kYXRhLnNsaWNlKCksIF90aGlzLmF0dHJzLnd3LmRhdGEuc2xpY2UoKV0gOlxuICAgICAgICAgICAgICAgIFtbXSwgW11dKSxcbiAgICAgICAgICAgIGNvbHVtbnM6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5jb2x1bW5zKSA/XG4gICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuY29sdW1ucyA6IFtdLFxuICAgICAgICAgICAgdGhlYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy50aGVhZFZpZXcgPSBnZXRIZWFkVmlldyhfdGhpcywgbmV3IE5ld0hlYWRDb250ZXh0KF90aGlzKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnRoZWFkVmlldy5yZW5kZXIoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0Ym9keTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF90aGlzLnRib2R5VmlldyA9IGdldEJvZHlWaWV3KF90aGlzLCBuZXcgTmV3Qm9keUNvbnRleHQoX3RoaXMpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMudGJvZHlWaWV3LnJlbmRlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgRGF0YVRhYmxlLnByb3RvdHlwZS5maXJlQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5hdHRycy53dyAmJiB0aGlzLmF0dHJzLnd3Lm9uQ2hhbmdlKVxuICAgICAgICAgICAgdGhpcy5hdHRycy53dy5vbkNoYW5nZShuZXcgZXZlbnRfMS5EYXRhQ2hhbmdlZEV2ZW50KHRoaXMudmFsdWVzLm5hbWUsIHRoaXMudmFsdWVzLmRhdGFzZXRbMF0uc2xpY2UoKSwgdGhpcy52YWx1ZXMuc29ydEtleS5zbGljZSgpKSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiB1cGRhdGUgdGhlIGRhdGEgZGlzcGxheWVkIHdpdGggYSBuZXcgZGF0YS5cbiAgICAgKi9cbiAgICBEYXRhVGFibGUucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHRoaXMudmFsdWVzLmRhdGFzZXQgPSBbZGF0YS5zbGljZSgpLCBkYXRhLnNsaWNlKCldO1xuICAgICAgICB0aGlzLnZpZXcuaW52YWxpZGF0ZSgpO1xuICAgICAgICB0aGlzLmZpcmVDaGFuZ2UoKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiB1cGRhdGVXaXRoU29ydEtleSBpcyBsaWtlIHVwZGF0ZSBidXQgd2lsbCBzZXQgdGhlIHNvcnQga2V5IGFzIHdlbGwuXG4gICAgICovXG4gICAgRGF0YVRhYmxlLnByb3RvdHlwZS51cGRhdGVXaXRoU29ydEtleSA9IGZ1bmN0aW9uIChkYXRhLCBrZXkpIHtcbiAgICAgICAgdGhpcy52YWx1ZXMuc29ydEtleSA9IGtleTtcbiAgICAgICAgdGhpcy51cGRhdGUoZGF0YSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogc29ydCB0aGUgdGFibGUgZGF0YSBieSB0aGUgY29sdW1uIGlkIHNwZWNpZmllZC5cbiAgICAgKlxuICAgICAqIFRoZSBkYXRhIGNhbiBvbmx5IGJlIHNvcnRlZCBieSBvbmUgY29sdW1uIGF0IGEgdGltZSBhbmQgdGhhdCBjb2x1bW5cbiAgICAgKiBtdXN0IHNwZWNpZnkgdGhlIFwic29ydFwiIGtleS5cbiAgICAgKlxuICAgICAqIFRoaXMgbWV0aG9kIGNhdXNlcyBhIHJlcGFpbnQuXG4gICAgICovXG4gICAgRGF0YVRhYmxlLnByb3RvdHlwZS5zb3J0ID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBfYSA9IHRoaXMudmFsdWVzLCBzb3J0S2V5ID0gX2Euc29ydEtleSwgZGF0YXNldCA9IF9hLmRhdGFzZXQ7XG4gICAgICAgIHZhciBkZWwgPSBnZXRTb3J0RGVsZWdhdGUodGhpcyk7XG4gICAgICAgIHZhciBfYiA9IGRlbChuZXcgc29ydF8xLlNvcnRSZXF1ZXN0KGlkLCBkYXRhc2V0WzFdLCBzb3J0S2V5KSksIGRhdGEgPSBfYlswXSwga2V5ID0gX2JbMV07XG4gICAgICAgIHRoaXMudmFsdWVzLmRhdGFzZXRbMF0gPSBkYXRhO1xuICAgICAgICB0aGlzLnZhbHVlcy5zb3J0S2V5ID0ga2V5O1xuICAgICAgICB0aGlzLnZpZXcuaW52YWxpZGF0ZSgpO1xuICAgICAgICB0aGlzLmZpcmVDaGFuZ2UoKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBnZXRSb3cgcmV0dXJucyBhIFJhbmdlIG9mIEhUTUxUYWJsZUNlbGxFbGVtZW50cyBmb3IgdGhlIHJvd1xuICAgICAqIHRoYXQgbWF0Y2hlcyB0aGUgcHJvdmlkZWQgaWQuXG4gICAgICpcbiAgICAgKiBJZiBubyByb3dzIGFyZSBmb3VuZCBieSB0aGF0IGlkLCB0aGUgUmFuZ2Ugd2lsbCBiZSBlbXB0eS5cbiAgICAgKiBJbiBvcmRlciBmb3IgdGhpcyBtZXRob2QgdG8gd29yayB0aGUgYm9keSB2aWV3IE1VU1QgaW5jbHVkZVxuICAgICAqIHRoZSB3bWw6aWQgb24gZWFjaCA8dHI+IGVsZW1lbnQgdGhhdCByZXByZXNlbnRzIGEgcm93IG9mIGRhdGEuXG4gICAgICovXG4gICAgRGF0YVRhYmxlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgIHZhciBtVHIgPSB1dGlsXzEuZ2V0QnlJZCh0aGlzLnRib2R5VmlldywgXCJcIiArIHJvdyk7XG4gICAgICAgIGlmIChtVHIuaXNOb3RoaW5nKCkpXG4gICAgICAgICAgICByZXR1cm4gbmV3IHJhbmdlXzEuUmFuZ2VJbnN0YW5jZShbXSk7XG4gICAgICAgIHZhciB0ciA9IG1Uci5nZXQoKTtcbiAgICAgICAgcmV0dXJuIG5ldyByYW5nZV8xLlJhbmdlSW5zdGFuY2UoYXJyYXlfMS5tYWtlKHRyLmNlbGxzLmxlbmd0aCwgZnVuY3Rpb24gKG4pIHsgcmV0dXJuIHRyLmNlbGxzW25dOyB9KSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBnZXRDZWxsIHByb3ZpZGVzIGEgUmFuZ2UgY29udGFpbmluZyBhIGNlbGwgbG9jYXRlZCBhdCB0aGVcbiAgICAgKiBpbnRlcnNlY3Rpb24gb2YgdGhlIGNvbHVtbiBhbmQgcm93LlxuICAgICAqL1xuICAgIERhdGFUYWJsZS5wcm90b3R5cGUuZ2V0Q2VsbCA9IGZ1bmN0aW9uIChjb2x1bW4sIHJvdykge1xuICAgICAgICB2YXIgY2VsbHMgPSB0aGlzLmdldFJvdyhyb3cpLmNlbGxzO1xuICAgICAgICBpZiAoIWNlbGxzW2NvbHVtbl0pXG4gICAgICAgICAgICByZXR1cm4gbmV3IHJhbmdlXzEuUmFuZ2VJbnN0YW5jZShbXSk7XG4gICAgICAgIHJldHVybiBuZXcgcmFuZ2VfMS5SYW5nZUluc3RhbmNlKFtjZWxsc1tjb2x1bW5dXSk7XG4gICAgfTtcbiAgICByZXR1cm4gRGF0YVRhYmxlO1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuRGF0YVRhYmxlID0gRGF0YVRhYmxlO1xudmFyIGdldEhlYWRWaWV3ID0gZnVuY3Rpb24gKHRhYmxlLCBjdHgpIHtcbiAgICByZXR1cm4gKHRhYmxlLmF0dHJzLnd3ICYmIHRhYmxlLmF0dHJzLnd3LmhlYWRGcmFnbWVudCkgP1xuICAgICAgICB0YWJsZS5hdHRycy53dy5oZWFkRnJhZ21lbnQoY3R4KSA6IG5ldyB2aWV3cy5IZWFkVmlldyhjdHgpO1xufTtcbnZhciBnZXRIZWFkaW5nVmlldyA9IGZ1bmN0aW9uICh0YWJsZSwgY3R4LCBjKSB7XG4gICAgcmV0dXJuIGMuaGVhZGluZ0ZyYWdtZW50ID8gYy5oZWFkaW5nRnJhZ21lbnQoY3R4KSA6XG4gICAgICAgICh0YWJsZS5hdHRycy53dyAmJiB0YWJsZS5hdHRycy53dy5oZWFkaW5nRnJhZ21lbnQpID9cbiAgICAgICAgICAgIHRhYmxlLmF0dHJzLnd3LmhlYWRpbmdGcmFnbWVudChjdHgpIDogbmV3IHZpZXdzLkhlYWRpbmdWaWV3KGN0eCk7XG59O1xudmFyIGdldEJvZHlWaWV3ID0gZnVuY3Rpb24gKHRhYmxlLCBjdHgpIHtcbiAgICByZXR1cm4gKHRhYmxlLmF0dHJzLnd3ICYmIHRhYmxlLmF0dHJzLnd3LmJvZHlGcmFnbWVudCkgP1xuICAgICAgICB0YWJsZS5hdHRycy53dy5ib2R5RnJhZ21lbnQoY3R4KSA6XG4gICAgICAgIG5ldyB2aWV3cy5Cb2R5VmlldyhjdHgpO1xufTtcbnZhciBnZXRDZWxsVmlldyA9IGZ1bmN0aW9uICh0YWJsZSwgY3R4LCBjKSB7XG4gICAgcmV0dXJuIGMuY2VsbEZyYWdtZW50ID8gYy5jZWxsRnJhZ21lbnQoY3R4KSA6XG4gICAgICAgICh0YWJsZS5hdHRycy53dyAmJiB0YWJsZS5hdHRycy53dy5jZWxsRnJhZ21lbnQpID9cbiAgICAgICAgICAgIHRhYmxlLmF0dHJzLnd3LmNlbGxGcmFnbWVudChjdHgpIDpcbiAgICAgICAgICAgIG5ldyB2aWV3cy5DZWxsVmlldyhjdHgpO1xufTtcbnZhciBnZXRTb3J0RGVsZWdhdGUgPSBmdW5jdGlvbiAodGFibGUpIHtcbiAgICByZXR1cm4gKHRhYmxlLmF0dHJzLnd3ICYmIHRhYmxlLmF0dHJzLnd3LnNvcnREZWxlZ2F0ZSkgP1xuICAgICAgICB0YWJsZS5hdHRycy53dy5zb3J0RGVsZWdhdGUgOlxuICAgICAgICBmdW5jdGlvbiAocikgeyByZXR1cm4gc29ydF8xLnNvcnRCeUlkKHRhYmxlLnZhbHVlcy5jb2x1bW5zLCByLmtleSwgW3RhYmxlLnZhbHVlcy5kYXRhc2V0WzBdLCByLmRhdGFdLCByLmNvbHVtbik7IH07XG59O1xudmFyIGdldFNvcnRDbGFzc05hbWUgPSBmdW5jdGlvbiAoa2V5LCBpbmRleCkge1xuICAgIHJldHVybiAoa2V5WzBdID09PSBpbmRleCkgPyAoa2V5WzFdID09PSAxKSA/IGV4cG9ydHMuQVNDIDogZXhwb3J0cy5ERVNDIDogJyc7XG59O1xudmFyIGNlbGxJZCA9IGZ1bmN0aW9uIChjb2x1bW4sIHJvdykgeyByZXR1cm4gY29sdW1uICsgXCIsXCIgKyByb3c7IH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuUmFuZ2VJbnN0YW5jZSA9IHZvaWQgMDtcbi8qKlxuICogUmFuZ2VJbnN0YW5jZVxuICovXG52YXIgUmFuZ2VJbnN0YW5jZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBSYW5nZUluc3RhbmNlKGNlbGxzKSB7XG4gICAgICAgIHRoaXMuY2VsbHMgPSBjZWxscztcbiAgICB9XG4gICAgcmV0dXJuIFJhbmdlSW5zdGFuY2U7XG59KCkpO1xuZXhwb3J0cy5SYW5nZUluc3RhbmNlID0gUmFuZ2VJbnN0YW5jZTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXJhbmdlLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSBleHBvcnRzLkNlbGxWaWV3ID0gZXhwb3J0cy5Cb2R5VmlldyA9IGV4cG9ydHMuSGVhZGluZ1ZpZXcgPSBleHBvcnRzLkhlYWRWaWV3ID0gZXhwb3J0cy5FbXB0eVZpZXcgPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuO1xudmFyIHRhYmxlXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vbGF5b3V0L3RhYmxlXCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBFbXB0eVZpZXcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRW1wdHlWaWV3KF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7fSwgW10pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBFbXB0eVZpZXcucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBFbXB0eVZpZXcucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgRW1wdHlWaWV3LnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgRW1wdHlWaWV3LnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIEVtcHR5Vmlldy5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgRW1wdHlWaWV3LnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIEVtcHR5Vmlldy5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgRW1wdHlWaWV3LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIEVtcHR5Vmlldztcbn0oKSk7XG5leHBvcnRzLkVtcHR5VmlldyA9IEVtcHR5VmlldztcbjtcbnZhciBIZWFkVmlldyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBIZWFkVmlldyhfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgndGhlYWQnLCB7ICdjbGFzcyc6IF9fY29udGV4dC5jbGFzc05hbWUgfSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCd0cicsIHt9LCBfX3NwcmVhZEFycmF5cyhfX2ZvckluKF9fY29udGV4dC5jb2x1bW5zLCBmdW5jdGlvbiAoY29sLCBpZHgsIF8kJGFsbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fY29udGV4dC5oZWFkaW5nKGNvbCwgaWR4KVxuICAgICAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7IHJldHVybiAoW10pOyB9KSkpXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgSGVhZFZpZXcucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBIZWFkVmlldy5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBIZWFkVmlldy5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIEhlYWRWaWV3LnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIEhlYWRWaWV3LnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBIZWFkVmlldy5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBIZWFkVmlldy5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgSGVhZFZpZXcucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gSGVhZFZpZXc7XG59KCkpO1xuZXhwb3J0cy5IZWFkVmlldyA9IEhlYWRWaWV3O1xuO1xudmFyIEhlYWRpbmdWaWV3ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEhlYWRpbmdWaWV3KF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCd0aCcsIHsgJ2NsYXNzJzogX19jb250ZXh0LmNsYXNzTmFtZSwgJ29uY2xpY2snOiBfX2NvbnRleHQub25jbGljayB9LCBbXG4gICAgICAgICAgICAgICAgdGV4dChfX2NvbnRleHQuY29sdW1uLmhlYWRpbmcpXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgSGVhZGluZ1ZpZXcucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBIZWFkaW5nVmlldy5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBIZWFkaW5nVmlldy5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIEhlYWRpbmdWaWV3LnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIEhlYWRpbmdWaWV3LnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBIZWFkaW5nVmlldy5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBIZWFkaW5nVmlldy5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgSGVhZGluZ1ZpZXcucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gSGVhZGluZ1ZpZXc7XG59KCkpO1xuZXhwb3J0cy5IZWFkaW5nVmlldyA9IEhlYWRpbmdWaWV3O1xuO1xudmFyIEJvZHlWaWV3ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEJvZHlWaWV3KF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCd0Ym9keScsIHsgJ2NsYXNzJzogX19jb250ZXh0LmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cyhfX2ZvckluKF9fY29udGV4dC5kYXRhLCBmdW5jdGlvbiAoXywgcm93LCBfJCRhbGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3RyJywgeyB3bWw6IHsgJ2lkJzogU3RyaW5nKHJvdykgfSB9LCBfX3NwcmVhZEFycmF5cyhfX2ZvckluKF9fY29udGV4dC5jb2x1bW5zLCBmdW5jdGlvbiAoY29sLCBpZHgsIF8kJGFsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX19jb250ZXh0LmNlbGwoY29sLCBpZHgsIHJvdylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7IHJldHVybiAoW10pOyB9KSkpXG4gICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7IHJldHVybiAoW10pOyB9KSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBCb2R5Vmlldy5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIEJvZHlWaWV3LnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIEJvZHlWaWV3LnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgQm9keVZpZXcucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgQm9keVZpZXcucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIEJvZHlWaWV3LnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIEJvZHlWaWV3LnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBCb2R5Vmlldy5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBCb2R5Vmlldztcbn0oKSk7XG5leHBvcnRzLkJvZHlWaWV3ID0gQm9keVZpZXc7XG47XG52YXIgQ2VsbFZpZXcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQ2VsbFZpZXcoX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ3RkJywgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LmlkIH0sICdjbGFzcyc6IF9fY29udGV4dC5jbGFzc05hbWUsICdvbmNsaWNrJzogX19jb250ZXh0Lm9uY2xpY2sgfSwgW1xuICAgICAgICAgICAgICAgIHRleHQoX19jb250ZXh0LmZvcm1hdChfX2NvbnRleHQudmFsdWUpKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIENlbGxWaWV3LnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgQ2VsbFZpZXcucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgQ2VsbFZpZXcucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBDZWxsVmlldy5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBDZWxsVmlldy5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgQ2VsbFZpZXcucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgQ2VsbFZpZXcucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIENlbGxWaWV3LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIENlbGxWaWV3O1xufSgpKTtcbmV4cG9ydHMuQ2VsbFZpZXcgPSBDZWxsVmlldztcbjtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLndpZGdldChuZXcgdGFibGVfMS5UYWJsZUxheW91dCh7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLndtbC5pZCB9LCB3dzogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLCAnY2xhc3NOYW1lJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUgfSB9LCBbXG4gICAgICAgICAgICAgICAgX19jb250ZXh0LnZhbHVlcy50aGVhZCgpLFxuICAgICAgICAgICAgICAgIF9fY29udGV4dC52YWx1ZXMudGJvZHkoKVxuICAgICAgICAgICAgXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMud21sLmlkIH0sIHd3OiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQsICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSB9IH0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dGFibGUuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQWxlcnQgPSBleHBvcnRzLkFMRVJUID0gZXhwb3J0cy5TdHlsZSA9IHZvaWQgMDtcbnZhciBkb21fMSA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG52YXIgd21sXzEgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbFwiKTtcbnZhciBzdHlsZV8xID0gcmVxdWlyZShcIi4uLy4uL2NvbnRlbnQvc3R5bGVcIik7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJTdHlsZVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gc3R5bGVfMS5TdHlsZTsgfSB9KTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbFwiKTtcbnZhciBfXzEgPSByZXF1aXJlKFwiLi4vLi4vXCIpO1xudmFyIGFsZXJ0XzEgPSByZXF1aXJlKFwiLi93bWwvYWxlcnRcIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLkFMRVJUID0gJ3d3LWFsZXJ0Jztcbi8qKlxuICogQWxlcnQgaXMgdXNlZCBmb3IgZGlzcGxheWluZyBpbXBvcnRhbnQgbWVzc2FnZXMgdG8gdXNlcnMuXG4gKi9cbnZhciBBbGVydCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoQWxlcnQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQWxlcnQoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IGFsZXJ0XzEuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgIGlkOiAnYWxlcnQnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5BTEVSVCwgX18xLmdldENsYXNzTmFtZShfdGhpcy5hdHRycyksIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5zdHlsZSkgP1xuICAgICAgICAgICAgICAgIHN0eWxlXzEuZ2V0U3R5bGVDbGFzc05hbWUoX3RoaXMuYXR0cnMud3cuc3R5bGUpIDpcbiAgICAgICAgICAgICAgICBzdHlsZV8xLkRFRkFVTFQpLFxuICAgICAgICAgICAgY2xvc2FibGU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5jbG9zYWJsZSkgP1xuICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmNsb3NhYmxlIDogZmFsc2UsXG4gICAgICAgICAgICBjb250ZW50OiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cudGV4dCkgP1xuICAgICAgICAgICAgICAgIFtkb21fMS50ZXh0KF90aGlzLmF0dHJzLnd3LnRleHQpXSA6IF90aGlzLmNoaWxkcmVuXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogY2xvc2UgdGhlIGFsZXJ0LlxuICAgICAqL1xuICAgIEFsZXJ0LnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG1Sb290ID0gdXRpbF8xLmdldEJ5SWQodGhpcy52aWV3LCB0aGlzLnZhbHVlcy53bWwuaWQpO1xuICAgICAgICBpZiAobVJvb3QuaXNKdXN0KCkpIHtcbiAgICAgICAgICAgIHZhciByb290ID0gbVJvb3QuZ2V0KCk7XG4gICAgICAgICAgICBpZiAocm9vdC5wYXJlbnROb2RlKVxuICAgICAgICAgICAgICAgIHJvb3QucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyb290KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIEFsZXJ0O1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuQWxlcnQgPSBBbGVydDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGNsb3NlXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY29udGVudC9jbG9zZVwiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLndtbC5pZCB9LCAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LnZhbHVlcy5jb250ZW50KSwgKChfX2NvbnRleHQudmFsdWVzLmNsb3NhYmxlKSA/XG4gICAgICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGNsb3NlXzEuQ2xvc2UoeyB3dzogeyAnb25DbGljayc6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF9fY29udGV4dC5jbG9zZSgpOyB9IH0gfSwgW10pLCB7IHd3OiB7ICdvbkNsaWNrJzogZnVuY3Rpb24gKCkgeyByZXR1cm4gX19jb250ZXh0LmNsb3NlKCk7IH0gfSB9KVxuICAgICAgICAgICAgICAgIF0pOyB9KSgpIDpcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgdGV4dCgnJylcbiAgICAgICAgICAgICAgICBdKTsgfSkoKSkpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFsZXJ0LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNvbmZpcm0gPSBleHBvcnRzLlByaW1hcnkgPSBleHBvcnRzLkNPTkZJUk1fWUVTID0gZXhwb3J0cy5DT05GSVJNX05PID0gZXhwb3J0cy5DT05GSVJNID0gdm9pZCAwO1xudmFyIHdtbF8xID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciBwcm9tcHRfMSA9IHJlcXVpcmUoXCIuLi9wcm9tcHRcIik7XG52YXIgY29uZmlybV8xID0gcmVxdWlyZShcIi4vd21sL2NvbmZpcm1cIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLkNPTkZJUk0gPSAnd3ctY29uZmlybSc7XG5leHBvcnRzLkNPTkZJUk1fTk8gPSAnd3ctY29uZmlybV9fbm8nO1xuZXhwb3J0cy5DT05GSVJNX1lFUyA9ICd3dy1wcm9tcHRfX3llcyc7XG4vLy9jbGFzc05hbWVzOmVuZFxuLyoqXG4gKiBQcmltYXJ5IGluZGljYXRlcyB3aGV0aGVyIHRoZSB5ZXMgb3Igbm8gYnV0dG9uIHNob3VsZCBiZSBoaWdobGlnaHRlZC5cbiAqL1xudmFyIFByaW1hcnk7XG4oZnVuY3Rpb24gKFByaW1hcnkpIHtcbiAgICBQcmltYXJ5W1wiTm9cIl0gPSBcIm5vXCI7XG4gICAgUHJpbWFyeVtcIlllc1wiXSA9IFwieWVzXCI7XG59KShQcmltYXJ5ID0gZXhwb3J0cy5QcmltYXJ5IHx8IChleHBvcnRzLlByaW1hcnkgPSB7fSkpO1xuLyoqXG4gKiBDb25maXJtIGRpc3BsYXlzIGEgZGlhbG9nIGZvciBjb25maXJtaW5nIGFuIGFjdGlvbi5cbiAqL1xudmFyIENvbmZpcm0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKENvbmZpcm0sIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQ29uZmlybSgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgY29uZmlybV8xLk1haW4oX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLkNPTkZJUk0sIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgIGlkOiAnbW9kYWwnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGVhZGVyOiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy50aXRsZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy50aXRsZSA6ICcnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZm9vdGVyOiB7XG4gICAgICAgICAgICAgICAgbm86IHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm5vVGV4dCkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cubm9UZXh0IDogJ05vJyxcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuQ09ORklSTV9OTywgKF90aGlzLmF0dHJzLnd3ICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5wcmltYXJ5ICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5wcmltYXJ5ID09PSBQcmltYXJ5Lk5vKSA/ICctcHJpbWFyeScgOiAnJyksXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vbk5vKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uTm8oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHllczoge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cueWVzVGV4dCkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cueWVzVGV4dCA6ICdZZXMnLFxuICAgICAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAneWVzJ1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5DT05GSVJNX1lFUywgKF90aGlzLmF0dHJzLnd3ICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5wcmltYXJ5ICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5wcmltYXJ5ID09PSBQcmltYXJ5Lk5vKSA/ICcnIDogJy1wcmltYXJ5JyksXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vblllcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vblllcygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBDb25maXJtLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcHJvbXB0XzEuY2xvc2UodGhpcy52aWV3LCB0aGlzLnZhbHVlcy53bWwuaWQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIHJldHVybiBDb25maXJtO1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuQ29uZmlybSA9IENvbmZpcm07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBidXR0b25fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jb250cm9sL2J1dHRvblwiKTtcbjtcbnZhciBjbG9zZV9idXR0b25fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jb250cm9sL2Nsb3NlLWJ1dHRvblwiKTtcbjtcbnZhciBtb2RhbF8xID0gcmVxdWlyZShcIi4uLy4uL21vZGFsXCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLndpZGdldChuZXcgbW9kYWxfMS5Nb2RhbCh7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLndtbC5pZCB9LCB3dzogeyAnY2xhc3NOYW1lJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUgfSB9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbW9kYWxfMS5Nb2RhbEhlYWRlcih7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBjbG9zZV9idXR0b25fMS5DbG9zZUJ1dHRvbih7IHd3OiB7ICdvbkNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5mb290ZXIubm8ub25DbGljayB9IH0sIFtdKSwgeyB3dzogeyAnb25DbGljayc6IF9fY29udGV4dC52YWx1ZXMuZm9vdGVyLm5vLm9uQ2xpY2sgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dChfX2NvbnRleHQudmFsdWVzLmhlYWRlci50aXRsZSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IG1vZGFsXzEuTW9kYWxCb2R5KHt9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LmNoaWxkcmVuKSkpLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbW9kYWxfMS5Nb2RhbEZvb3Rlcih7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBidXR0b25fMS5CdXR0b24oeyB3dzogeyAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMuZm9vdGVyLm5vLnRleHQsICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmZvb3Rlci5uby5jbGFzc05hbWUsICdvbkNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5mb290ZXIubm8ub25DbGljayB9IH0sIFtdKSwgeyB3dzogeyAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMuZm9vdGVyLm5vLnRleHQsICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmZvb3Rlci5uby5jbGFzc05hbWUsICdvbkNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5mb290ZXIubm8ub25DbGljayB9IH0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBidXR0b25fMS5CdXR0b24oeyB3dzogeyAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMuZm9vdGVyLnllcy50ZXh0LCAnY2xhc3NOYW1lJzogX19jb250ZXh0LnZhbHVlcy5mb290ZXIueWVzLmNsYXNzTmFtZSwgJ29uQ2xpY2snOiBfX2NvbnRleHQudmFsdWVzLmZvb3Rlci55ZXMub25DbGljayB9IH0sIFtdKSwgeyB3dzogeyAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMuZm9vdGVyLnllcy50ZXh0LCAnY2xhc3NOYW1lJzogX19jb250ZXh0LnZhbHVlcy5mb290ZXIueWVzLmNsYXNzTmFtZSwgJ29uQ2xpY2snOiBfX2NvbnRleHQudmFsdWVzLmZvb3Rlci55ZXMub25DbGljayB9IH0pXG4gICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMud21sLmlkIH0sIHd3OiB7ICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSB9IH0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y29uZmlybS5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5JbmZvcm0gPSBleHBvcnRzLklORk9STV9PSyA9IGV4cG9ydHMuSU5GT1JNID0gdm9pZCAwO1xudmFyIHdtbF8xID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciBwcm9tcHRfMSA9IHJlcXVpcmUoXCIuLi9wcm9tcHRcIik7XG52YXIgaW5mb3JtXzEgPSByZXF1aXJlKFwiLi93bWwvaW5mb3JtXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5JTkZPUk0gPSAnd3ctaW5mb3JtJztcbmV4cG9ydHMuSU5GT1JNX09LID0gJ3d3LWluZm9ybV9fb2snO1xuLyoqXG4gKiBJbmZvcm0gZGlzcGxheXMgYSBtZXNzYWdlIHRvIHRoZSB1c2VyLlxuICovXG52YXIgSW5mb3JtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhJbmZvcm0sIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gSW5mb3JtKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyBpbmZvcm1fMS5NYWluKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5JTkZPUk0sIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgIGlkOiAnbW9kYWwnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGVhZGVyOiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy50aXRsZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy50aXRsZSA6ICcnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZm9vdGVyOiB7XG4gICAgICAgICAgICAgICAgb2s6IHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmJ1dHRvblRleHQpID9cbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmJ1dHRvblRleHQgOiAnT2snLFxuICAgICAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAnb2snXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLklORk9STV9PSywgJy1wcmltYXJ5JyksXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vbkNsb3NlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uQ2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgSW5mb3JtLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcHJvbXB0XzEuY2xvc2UodGhpcy52aWV3LCB0aGlzLnZhbHVlcy53bWwuaWQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIHJldHVybiBJbmZvcm07XG59KHdtbF8xLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5JbmZvcm0gPSBJbmZvcm07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBidXR0b25fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jb250cm9sL2J1dHRvblwiKTtcbjtcbnZhciBjbG9zZV9idXR0b25fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi9jb250cm9sL2Nsb3NlLWJ1dHRvblwiKTtcbjtcbnZhciBtb2RhbF8xID0gcmVxdWlyZShcIi4uLy4uL21vZGFsXCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLndpZGdldChuZXcgbW9kYWxfMS5Nb2RhbCh7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLndtbC5pZCB9LCB3dzogeyAnY2xhc3NOYW1lJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUgfSB9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbW9kYWxfMS5Nb2RhbEhlYWRlcih7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBjbG9zZV9idXR0b25fMS5DbG9zZUJ1dHRvbih7IHd3OiB7ICdvbkNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5mb290ZXIub2sub25DbGljayB9IH0sIFtdKSwgeyB3dzogeyAnb25DbGljayc6IF9fY29udGV4dC52YWx1ZXMuZm9vdGVyLm9rLm9uQ2xpY2sgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgdGV4dChfX2NvbnRleHQudmFsdWVzLmhlYWRlci50aXRsZSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IG1vZGFsXzEuTW9kYWxCb2R5KHt9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LmNoaWxkcmVuKSkpLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbW9kYWxfMS5Nb2RhbEZvb3Rlcih7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBidXR0b25fMS5CdXR0b24oeyB3dzogeyAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMuZm9vdGVyLm9rLnRleHQsICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmZvb3Rlci5vay5jbGFzc05hbWUsICdvbkNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5mb290ZXIub2sub25DbGljayB9IH0sIFtdKSwgeyB3dzogeyAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMuZm9vdGVyLm9rLnRleHQsICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmZvb3Rlci5vay5jbGFzc05hbWUsICdvbkNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5mb290ZXIub2sub25DbGljayB9IH0pXG4gICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMud21sLmlkIH0sIHd3OiB7ICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSB9IH0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5mb3JtLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1vZGFsRm9vdGVyID0gZXhwb3J0cy5Nb2RhbEJvZHkgPSBleHBvcnRzLk1vZGFsSGVhZGVyID0gZXhwb3J0cy5Nb2RhbCA9IGV4cG9ydHMuTU9EQUxfRk9PVEVSID0gZXhwb3J0cy5NT0RBTF9CT0RZID0gZXhwb3J0cy5NT0RBTF9IRUFERVIgPSBleHBvcnRzLk1PREFMX0NPTlRFTlQgPSBleHBvcnRzLk1PREFMX1BPU0lUSU9OID0gZXhwb3J0cy5NT0RBTCA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9tb2RhbFwiKTtcbnZhciB3bWxfMSA9IHJlcXVpcmUoXCJAcXVlbmsvd21sXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLi8uLi9cIik7XG52YXIgbGF5b3V0XzEgPSByZXF1aXJlKFwiLi4vLi4vbGF5b3V0XCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5NT0RBTCA9ICd3dy1tb2RhbCc7XG5leHBvcnRzLk1PREFMX1BPU0lUSU9OID0gJ3d3LW1vZGFsX19wb3NpdGlvbic7XG5leHBvcnRzLk1PREFMX0NPTlRFTlQgPSAnd3ctbW9kYWxfX2NvbnRlbnQnO1xuZXhwb3J0cy5NT0RBTF9IRUFERVIgPSAnd3ctbW9kYWxfX2hlYWRlcic7XG5leHBvcnRzLk1PREFMX0JPRFkgPSAnd3ctbW9kYWxfX2JvZHknO1xuZXhwb3J0cy5NT0RBTF9GT09URVIgPSAnd3ctbW9kYWxfX2Zvb3Rlcic7XG4vKipcbiAqIE1vZGFsXG4gKi9cbnZhciBNb2RhbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTW9kYWwsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTW9kYWwoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1vZGFsKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgaWQ6ICdyb290J1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGlkOiBfXzEuZ2V0SWQoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuTU9EQUwsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IGV4cG9ydHMuTU9EQUxfQ09OVEVOVFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBleHBvcnRzLk1PREFMX1BPU0lUSU9OXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogY2xvc2UgdGhlIG1vZGFsLlxuICAgICAqL1xuICAgIE1vZGFsLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG1PID0gdXRpbF8xLmdldEJ5SWQodGhpcy52aWV3LCB0aGlzLnZhbHVlcy53bWwuaWQpO1xuICAgICAgICBpZiAobU8uaXNKdXN0KCkpIHtcbiAgICAgICAgICAgIHZhciBuID0gbU8uZ2V0KCk7XG4gICAgICAgICAgICBpZiAobi5wYXJlbnROb2RlKVxuICAgICAgICAgICAgICAgIG4ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChuKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIE1vZGFsO1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuTW9kYWwgPSBNb2RhbDtcbi8qKlxuICogTW9kYWxIZWFkZXJcbiAqL1xudmFyIE1vZGFsSGVhZGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhNb2RhbEhlYWRlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBNb2RhbEhlYWRlcigpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuTW9kYWxIZWFkZXIoX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICBpZDogJ3Jvb3QnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5NT0RBTF9IRUFERVIsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIGNvbnRlbnQ6IHsgd21sOiB7IGlkOiAncm9vdCcgfSB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIE1vZGFsSGVhZGVyO1xufShsYXlvdXRfMS5BYnN0cmFjdExheW91dCkpO1xuZXhwb3J0cy5Nb2RhbEhlYWRlciA9IE1vZGFsSGVhZGVyO1xuLyoqXG4gKiBNb2RhbEJvZHlBdHRyc1xuICovXG52YXIgTW9kYWxCb2R5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhNb2RhbEJvZHksIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTW9kYWxCb2R5KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5Nb2RhbEJvZHkoX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICBpZDogJ3Jvb3QnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5NT0RBTF9CT0RZLCBfXzEuZ2V0Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSksXG4gICAgICAgICAgICBjb250ZW50OiB7IHdtbDogeyBpZDogJ3Jvb3QnIH0gfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBNb2RhbEJvZHk7XG59KGxheW91dF8xLkFic3RyYWN0TGF5b3V0KSk7XG5leHBvcnRzLk1vZGFsQm9keSA9IE1vZGFsQm9keTtcbi8qKlxuICogTW9kYWxGb290ZXJcbiAqL1xudmFyIE1vZGFsRm9vdGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhNb2RhbEZvb3RlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBNb2RhbEZvb3RlcigpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuTW9kYWxGb290ZXIoX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICBpZDogJ3Jvb3QnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5NT0RBTF9GT09URVIsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIGNvbnRlbnQ6IHsgd21sOiB7IGlkOiAncm9vdCcgfSB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIE1vZGFsRm9vdGVyO1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuTW9kYWxGb290ZXIgPSBNb2RhbEZvb3Rlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1vZGFsRm9vdGVyID0gZXhwb3J0cy5Nb2RhbEJvZHkgPSBleHBvcnRzLk1vZGFsSGVhZGVyID0gZXhwb3J0cy5Nb2RhbCA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1vZGFsID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1vZGFsKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLndtbC5pZCB9LCAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSB9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2RpdicsIHsgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5wb3NpdGlvbi5jbGFzc05hbWUgfSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnZGl2JywgeyAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRlbnQuY2xhc3NOYW1lIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQuY2hpbGRyZW4pKSlcbiAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1vZGFsLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTW9kYWwucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTW9kYWwucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNb2RhbC5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNb2RhbC5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTW9kYWwucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTW9kYWwucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1vZGFsLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1vZGFsO1xufSgpKTtcbmV4cG9ydHMuTW9kYWwgPSBNb2RhbDtcbjtcbnZhciBNb2RhbEhlYWRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNb2RhbEhlYWRlcihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgnZGl2JywgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy53bWwuaWQgfSwgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTW9kYWxIZWFkZXIucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNb2RhbEhlYWRlci5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNb2RhbEhlYWRlci5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1vZGFsSGVhZGVyLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1vZGFsSGVhZGVyLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNb2RhbEhlYWRlci5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNb2RhbEhlYWRlci5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTW9kYWxIZWFkZXIucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTW9kYWxIZWFkZXI7XG59KCkpO1xuZXhwb3J0cy5Nb2RhbEhlYWRlciA9IE1vZGFsSGVhZGVyO1xuO1xudmFyIE1vZGFsQm9keSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNb2RhbEJvZHkoX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMud21sLmlkIH0sICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY2xhc3NOYW1lIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQuY2hpbGRyZW4pKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1vZGFsQm9keS5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1vZGFsQm9keS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNb2RhbEJvZHkucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNb2RhbEJvZHkucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTW9kYWxCb2R5LnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNb2RhbEJvZHkucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTW9kYWxCb2R5LnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNb2RhbEJvZHkucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTW9kYWxCb2R5O1xufSgpKTtcbmV4cG9ydHMuTW9kYWxCb2R5ID0gTW9kYWxCb2R5O1xuO1xudmFyIE1vZGFsRm9vdGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1vZGFsRm9vdGVyKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLndtbC5pZCB9LCAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LmNoaWxkcmVuKSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNb2RhbEZvb3Rlci5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1vZGFsRm9vdGVyLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1vZGFsRm9vdGVyLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTW9kYWxGb290ZXIucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTW9kYWxGb290ZXIucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1vZGFsRm9vdGVyLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1vZGFsRm9vdGVyLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNb2RhbEZvb3Rlci5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNb2RhbEZvb3Rlcjtcbn0oKSk7XG5leHBvcnRzLk1vZGFsRm9vdGVyID0gTW9kYWxGb290ZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tb2RhbC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5jbG9zZSA9IGV4cG9ydHMuUHJvbXB0ID0gZXhwb3J0cy5QUk9NUFRfU0FWRSA9IGV4cG9ydHMuUFJPTVBUX0NMT1NFID0gZXhwb3J0cy5QUk9NUFQgPSB2b2lkIDA7XG52YXIgd21sXzEgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbFwiKTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbFwiKTtcbnZhciBfXzEgPSByZXF1aXJlKFwiLi4vLi4vXCIpO1xudmFyIHByb21wdF8xID0gcmVxdWlyZShcIi4vd21sL3Byb21wdFwiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuUFJPTVBUID0gJ3d3LXByb21wdCc7XG5leHBvcnRzLlBST01QVF9DTE9TRSA9ICd3dy1wcm9tcHRfX2Nsb3NlJztcbmV4cG9ydHMuUFJPTVBUX1NBVkUgPSAnd3ctcHJvbXB0X19zYXZlJztcbi8qKlxuICogUHJvbXB0IGRpc3BsYXlzIGEgZGlhbG9nIHRvIHRoZSB1c2VyIHN1aXRhYmxlIGZvciBjb2xsZWN0aW5nIGRhdGFcbiAqIGlucHV0LlxuICovXG52YXIgUHJvbXB0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhQcm9tcHQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gUHJvbXB0KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyBwcm9tcHRfMS5NYWluKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5QUk9NUFQsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgIGlkOiAnbW9kYWwnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGVhZGVyOiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy50aXRsZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy50aXRsZSA6ICcnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZm9vdGVyOiB7XG4gICAgICAgICAgICAgICAgY2xvc2U6IHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmNsb3NlVGV4dCkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuY2xvc2VUZXh0IDogJ0Nsb3NlJyxcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBleHBvcnRzLlBST01QVF9DTE9TRSxcbiAgICAgICAgICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm9uQ2FuY2VsKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm9uQ2FuY2VsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzYXZlOiB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5zYXZlVGV4dCkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuc2F2ZVRleHQgOiAnU2F2ZScsXG4gICAgICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdzYXZlJ1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoJy1wcmltYXJ5JywgZXhwb3J0cy5QUk9NUFRfU0FWRSksXG4gICAgICAgICAgICAgICAgICAgIGRpc2FibGVkOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZGlzYWJsZWQpID9cbiAgICAgICAgICAgICAgICAgICAgICAgIHRydWUgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm9uU2F2ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vblNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgUHJvbXB0LnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZXhwb3J0cy5jbG9zZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLndtbC5pZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogZW5hYmxlIHNhdmluZy5cbiAgICAgKi9cbiAgICBQcm9tcHQucHJvdG90eXBlLmVuYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZ2V0U2F2ZSh0aGlzKS5tYXAoZnVuY3Rpb24gKGIpIHsgcmV0dXJuIGIuZW5hYmxlKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGRpc2FibGUgc2F2aW5nLlxuICAgICAqL1xuICAgIFByb21wdC5wcm90b3R5cGUuZGlzYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZ2V0U2F2ZSh0aGlzKS5tYXAoZnVuY3Rpb24gKGIpIHsgcmV0dXJuIGIuZGlzYWJsZSgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICByZXR1cm4gUHJvbXB0O1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuUHJvbXB0ID0gUHJvbXB0O1xudmFyIGdldFNhdmUgPSBmdW5jdGlvbiAocCkge1xuICAgIHJldHVybiB1dGlsXzEuZ2V0QnlJZChwLnZpZXcsIHAudmFsdWVzLmZvb3Rlci5zYXZlLndtbC5pZCk7XG59O1xuLyoqXG4gKiBjbG9zZSB0aGUgTW9kYWwgaW4gYSB2aWV3LlxuICovXG5leHBvcnRzLmNsb3NlID0gZnVuY3Rpb24gKHZpZXcsIGlkKSB7XG4gICAgcmV0dXJuIHV0aWxfMS5nZXRCeUlkKHZpZXcsIGlkKS5tYXAoZnVuY3Rpb24gKG0pIHsgcmV0dXJuIG0uY2xvc2UoKTsgfSk7XG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheXMgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXlzKSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcbiAgICAgICAgICAgIHJba10gPSBhW2pdO1xuICAgIHJldHVybiByO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG52YXIgYnV0dG9uXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY29udHJvbC9idXR0b25cIik7XG47XG52YXIgY2xvc2VfYnV0dG9uXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vY29udHJvbC9jbG9zZS1idXR0b25cIik7XG47XG52YXIgbW9kYWxfMSA9IHJlcXVpcmUoXCIuLi8uLi9tb2RhbFwiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IG1vZGFsXzEuTW9kYWwoeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy53bWwuaWQgfSwgd3c6IHsgJ2NsYXNzTmFtZSc6IF9fY29udGV4dC52YWx1ZXMuY2xhc3NOYW1lIH0gfSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IG1vZGFsXzEuTW9kYWxIZWFkZXIoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgY2xvc2VfYnV0dG9uXzEuQ2xvc2VCdXR0b24oeyB3dzogeyAnb25DbGljayc6IF9fY29udGV4dC52YWx1ZXMuZm9vdGVyLmNsb3NlLm9uQ2xpY2sgfSB9LCBbXSksIHsgd3c6IHsgJ29uQ2xpY2snOiBfX2NvbnRleHQudmFsdWVzLmZvb3Rlci5jbG9zZS5vbkNsaWNrIH0gfSksXG4gICAgICAgICAgICAgICAgICAgIHRleHQoX19jb250ZXh0LnZhbHVlcy5oZWFkZXIudGl0bGUpXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBtb2RhbF8xLk1vZGFsQm9keSh7fSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IG1vZGFsXzEuTW9kYWxGb290ZXIoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgYnV0dG9uXzEuQnV0dG9uKHsgd3c6IHsgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmZvb3Rlci5jbG9zZS50ZXh0LCAnY2xhc3NOYW1lJzogX19jb250ZXh0LnZhbHVlcy5mb290ZXIuY2xvc2UuY2xhc3NOYW1lLCAnb25DbGljayc6IF9fY29udGV4dC52YWx1ZXMuZm9vdGVyLmNsb3NlLm9uQ2xpY2sgfSB9LCBbXSksIHsgd3c6IHsgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmZvb3Rlci5jbG9zZS50ZXh0LCAnY2xhc3NOYW1lJzogX19jb250ZXh0LnZhbHVlcy5mb290ZXIuY2xvc2UuY2xhc3NOYW1lLCAnb25DbGljayc6IF9fY29udGV4dC52YWx1ZXMuZm9vdGVyLmNsb3NlLm9uQ2xpY2sgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgYnV0dG9uXzEuQnV0dG9uKHsgd3c6IHsgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmZvb3Rlci5zYXZlLnRleHQsICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmZvb3Rlci5zYXZlLmNsYXNzTmFtZSwgJ2Rpc2FibGVkJzogX19jb250ZXh0LnZhbHVlcy5mb290ZXIuc2F2ZS5kaXNhYmxlZCwgJ29uQ2xpY2snOiBfX2NvbnRleHQudmFsdWVzLmZvb3Rlci5zYXZlLm9uQ2xpY2sgfSB9LCBbXSksIHsgd3c6IHsgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmZvb3Rlci5zYXZlLnRleHQsICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLmZvb3Rlci5zYXZlLmNsYXNzTmFtZSwgJ2Rpc2FibGVkJzogX19jb250ZXh0LnZhbHVlcy5mb290ZXIuc2F2ZS5kaXNhYmxlZCwgJ29uQ2xpY2snOiBfX2NvbnRleHQudmFsdWVzLmZvb3Rlci5zYXZlLm9uQ2xpY2sgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgIF0pLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLndtbC5pZCB9LCB3dzogeyAnY2xhc3NOYW1lJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUgfSB9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXByb21wdC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZ2V0Q2xhc3NOYW1lID0gZXhwb3J0cy5nZXRJZCA9IHZvaWQgMDtcbi8qKlxuICogZ2V0SWQgZnJvbSBhIHdpZGdldCdzIHBhc3NlZCBhdHRyaWJ1dGVzLlxuICovXG5leHBvcnRzLmdldElkID0gZnVuY3Rpb24gKGF0dHJzKSB7XG4gICAgcmV0dXJuIChhdHRycy53dyAmJiBhdHRycy53dy5pZCkgPyBhdHRycy53dy5pZCA6ICcnO1xufTtcbi8qKlxuICogZ2V0Q2xhc3NOYW1lIGZyb20gYSB3aWRnZXQncyBwYXNzZWQgYXR0cmlidXRlcy5cbiAqL1xuZXhwb3J0cy5nZXRDbGFzc05hbWUgPSBmdW5jdGlvbiAoYXR0cnMpIHtcbiAgICB2YXIgYXNIdG1sQXR0cnMgPSBhdHRycztcbiAgICB2YXIgYXNXaWRnZXRBdHRycyA9IGF0dHJzLnd3O1xuICAgIHJldHVybiBhc0h0bWxBdHRycy5jbGFzc05hbWUgfHxcbiAgICAgICAgKGFzV2lkZ2V0QXR0cnMgJiYgYXNXaWRnZXRBdHRycy5jbGFzc05hbWUpIHx8ICcnO1xufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkFjdGlvbkJhciA9IGV4cG9ydHMuQUNUSU9OX0JBUl9DT05URU5UID0gZXhwb3J0cy5BQ1RJT05fQkFSID0gdm9pZCAwO1xudmFyIG9yaWVudGF0aW9uID0gcmVxdWlyZShcIi4uLy4uL2NvbnRlbnQvb3JpZW50YXRpb25cIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIF9fMiA9IHJlcXVpcmUoXCIuLi9cIik7XG52YXIgYWN0aW9uX2Jhcl8xID0gcmVxdWlyZShcIi4vd21sL2FjdGlvbi1iYXJcIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG4vKipcbiAqIEFDVElPTl9CQVIgY2xhc3MgbmFtZS4gZm9yIHRoZSBBY3Rpb25CYXIgcm9vdC5cbiAqL1xuZXhwb3J0cy5BQ1RJT05fQkFSID0gJ3d3LWFjdGlvbi1iYXInO1xuLyoqXG4gKiBBQ1RJT05fQkFSX0NPTlRFTlQgY2xhc3MgbmFtZS5cbiAqL1xuZXhwb3J0cy5BQ1RJT05fQkFSX0NPTlRFTlQgPSAnd3ctYWN0aW9uLWJhcl9fY29udGVudCc7XG4vKipcbiAqIEFjdGlvbkJhciBwcm92aWRlcyBhIGJhciBhY3Jvc3MgdGhlIHNjcmVlbiB0aGF0IGNhbiBiZVxuICogdXNlZCBhcyBhIHRvb2xiYXIsIG5hdmlnYXRpb24gbWVudSBvciBzb21ldGhpbmcgc2ltaWxsYXIuXG4gKi9cbnZhciBBY3Rpb25CYXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEFjdGlvbkJhciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBBY3Rpb25CYXIoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IGFjdGlvbl9iYXJfMS5NYWluKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgcm9vdDoge1xuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ3Jvb3QnLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaWQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5pZCkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5pZCA6ICcnLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLkFDVElPTl9CQVIsIF9fMi5MQVlPVVQsIG9yaWVudGF0aW9uLlBPU0lUSU9ORUQsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdjb250ZW50J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY2xhc3M6IGV4cG9ydHMuQUNUSU9OX0JBUl9DT05URU5UXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIEFjdGlvbkJhcjtcbn0oX18yLkFic3RyYWN0TGF5b3V0KSk7XG5leHBvcnRzLkFjdGlvbkJhciA9IEFjdGlvbkJhcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMucm9vdC53bWwuaWQgfSwgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5yb290LmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuY2xhc3NOYW1lIH0sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnZGl2JywgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5jb250ZW50LndtbC5pZCB9LCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRlbnQuY2xhc3MgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hY3Rpb24tYmFyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNhbGxvdXQgPSBleHBvcnRzLkNBTExPVVQgPSBleHBvcnRzLlN0eWxlID0gdm9pZCAwO1xudmFyIHdtbF8xID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgc3R5bGVfMSA9IHJlcXVpcmUoXCIuLi8uLi9jb250ZW50L3N0eWxlXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiU3R5bGVcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHN0eWxlXzEuU3R5bGU7IH0gfSk7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbnZhciBjYWxsb3V0XzEgPSByZXF1aXJlKFwiLi93bWwvY2FsbG91dFwiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuQ0FMTE9VVCA9ICd3dy1jYWxsb3V0Jztcbi8qKlxuICogQ2FsbG91dFxuICovXG52YXIgQ2FsbG91dCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoQ2FsbG91dCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBDYWxsb3V0KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyBjYWxsb3V0XzEuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIGlkOiBfXzEuZ2V0SWQoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuQ0FMTE9VVCwgX18xLmdldENsYXNzTmFtZShfdGhpcy5hdHRycyksIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5zdHlsZSkgP1xuICAgICAgICAgICAgICAgIHN0eWxlXzEuZ2V0U3R5bGVDbGFzc05hbWUoX3RoaXMuYXR0cnMud3cuc3R5bGUpIDpcbiAgICAgICAgICAgICAgICBzdHlsZV8xLkRFRkFVTFQpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIENhbGxvdXQ7XG59KHdtbF8xLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5DYWxsb3V0ID0gQ2FsbG91dDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNhbGxvdXQuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRGF0YSA9IGV4cG9ydHMuVGl0bGUgPSBleHBvcnRzLkRlc2NyaXB0aW9uTGlzdCA9IGV4cG9ydHMuREVTQ1JJUFRJT05fTElTVF9EQVRBID0gZXhwb3J0cy5ERVNDUklQVElPTl9MSVNUX1RJVExFID0gZXhwb3J0cy5ERVNDUklQVElPTl9MSVNUID0gdm9pZCAwO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL2Rlc2NyaXB0aW9uLWxpc3RcIik7XG52YXIgd21sXzEgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbFwiKTtcbnZhciBvcmllbnRhdGlvbl8xID0gcmVxdWlyZShcIi4uLy4uL2NvbnRlbnQvb3JpZW50YXRpb25cIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuREVTQ1JJUFRJT05fTElTVCA9ICd3dy1kZXNjcmlwdGlvbi1saXN0JztcbmV4cG9ydHMuREVTQ1JJUFRJT05fTElTVF9USVRMRSA9ICd3dy1kZXNjcmlwdGlvbi1saXN0X190aXRsZSc7XG5leHBvcnRzLkRFU0NSSVBUSU9OX0xJU1RfREFUQSA9ICd3dy1kZXNjcmlwdGlvbi1saXN0X19kYXRhJztcbi8qKlxuICogRGVzY3JpcHRpb25MaXN0IGxheW91dC5cbiAqL1xudmFyIERlc2NyaXB0aW9uTGlzdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoRGVzY3JpcHRpb25MaXN0LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIERlc2NyaXB0aW9uTGlzdCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuRGVzY3JpcHRpb25MaXN0KF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5ERVNDUklQVElPTl9MSVNULCBfXzEuZ2V0Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSwgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lmhvcml6b250YWwpID8gb3JpZW50YXRpb25fMS5IT1JJWk9OVEFMIDogJycpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIERlc2NyaXB0aW9uTGlzdDtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLkRlc2NyaXB0aW9uTGlzdCA9IERlc2NyaXB0aW9uTGlzdDtcbi8qKlxuICogVGl0bGVcbiAqL1xudmFyIFRpdGxlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhUaXRsZSwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBUaXRsZSgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuVGl0bGUoX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLkRFU0NSSVBUSU9OX0xJU1RfVElUTEUsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBUaXRsZTtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLlRpdGxlID0gVGl0bGU7XG4vKipcbiAqIERhdGFcbiAqL1xudmFyIERhdGEgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKERhdGEsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gRGF0YSgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuRGF0YShfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIGlkOiBfXzEuZ2V0SWQoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuREVTQ1JJUFRJT05fTElTVF9EQVRBLCBfXzEuZ2V0Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSlcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gRGF0YTtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLkRhdGEgPSBEYXRhO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheXMgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXlzKSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcbiAgICAgICAgICAgIHJba10gPSBhW2pdO1xuICAgIHJldHVybiByO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRGF0YSA9IGV4cG9ydHMuVGl0bGUgPSBleHBvcnRzLkRlc2NyaXB0aW9uTGlzdCA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIERlc2NyaXB0aW9uTGlzdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBEZXNjcmlwdGlvbkxpc3QoX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RsJywgeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LmNoaWxkcmVuKSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBEZXNjcmlwdGlvbkxpc3QucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBEZXNjcmlwdGlvbkxpc3QucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgRGVzY3JpcHRpb25MaXN0LnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgRGVzY3JpcHRpb25MaXN0LnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIERlc2NyaXB0aW9uTGlzdC5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgRGVzY3JpcHRpb25MaXN0LnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIERlc2NyaXB0aW9uTGlzdC5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgRGVzY3JpcHRpb25MaXN0LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIERlc2NyaXB0aW9uTGlzdDtcbn0oKSk7XG5leHBvcnRzLkRlc2NyaXB0aW9uTGlzdCA9IERlc2NyaXB0aW9uTGlzdDtcbjtcbnZhciBUaXRsZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBUaXRsZShfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgnZHQnLCB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY2xhc3NOYW1lIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQuY2hpbGRyZW4pKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIFRpdGxlLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgVGl0bGUucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgVGl0bGUucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBUaXRsZS5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBUaXRsZS5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgVGl0bGUucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgVGl0bGUucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIFRpdGxlLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIFRpdGxlO1xufSgpKTtcbmV4cG9ydHMuVGl0bGUgPSBUaXRsZTtcbjtcbnZhciBEYXRhID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIERhdGEoX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RkJywgeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LmNoaWxkcmVuKSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBEYXRhLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgRGF0YS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBEYXRhLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgRGF0YS5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBEYXRhLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBEYXRhLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIERhdGEucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIERhdGEucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gRGF0YTtcbn0oKSk7XG5leHBvcnRzLkRhdGEgPSBEYXRhO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZGVzY3JpcHRpb24tbGlzdC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5EcmF3ZXJMYXlvdXQgPSBleHBvcnRzLkRSQVdFUl9MQVlPVVQgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvZHJhd2VyXCIpO1xudmFyIHdtbF8xID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgaGlkZGVuXzEgPSByZXF1aXJlKFwiLi4vLi4vY29udGVudC9zdGF0ZS9oaWRkZW5cIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uL1wiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbi8qKlxuICogRFJBV0VSX0xBWU9VVFxuICovXG5leHBvcnRzLkRSQVdFUl9MQVlPVVQgPSAnd3ctZHJhd2VyLWxheW91dCc7XG47XG4vKipcbiAqIERyYXdlckxheW91dCBwcm92aWRlcyBhIDEgY29sdW1uIGFwcGxpY2F0aW9uIGxheW91dCB3aXRoIGEgZHJhd2VyIHRoYXQgY2FuXG4gKiBiZSBzaG93biBvciBoaWRkZW4gdXBvbiByZXF1ZXN0cy5cbiAqXG4gKiBUaGUgZHJhd2VyIHRha2VzIHVwIG1vc3Qgb2YgdGhlIHNjcmVlbiBvbiBtb2JpbGUgYW5kIGFib3V0IHJvdWdobHkgMS82IC0gMS84XG4gKiBvbiBhIGRlc2t0b3AgKG5vdCBmYWN0IGNoZWNrZWQgeWV0KS5cbiAqXG4gKiAgTW9iaWxlOlxuICogICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rXG4gKiAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgfCAgIDxkcmF3ZXI+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rXG4gKlxuICogIERlc2t0b3A6XG4gKiAgKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAqICB8ICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogIHwgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgfCAgICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICB8ICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogIHwgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgfCAgIDxkcmF3ZXI+ICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICB8ICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogIHwgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgfCAgICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICB8ICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogIHwgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgfCAgICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICB8ICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICogIHwgICAgICAgICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gKiAgfCAgICAgICAgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqICArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tK1xuICovXG52YXIgRHJhd2VyTGF5b3V0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhEcmF3ZXJMYXlvdXQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gRHJhd2VyTGF5b3V0KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5EcmF3ZXJMYXlvdXQoX3RoaXMpO1xuICAgICAgICAvKipcbiAgICAgICAgICogdmFsdWVzIGlzIGEgaGFzaCBvZiB2YWx1ZXMgdXNlZCBpbiB0aGUgdGVtcGxhdGUuXG4gICAgICAgICAqL1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICByb290OiB7XG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnbGF5b3V0J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaWQ6IF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmlkLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLkRSQVdFUl9MQVlPVVQsIF9fMS5MQVlPVVQsIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5jbGFzc05hbWUpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuY2xhc3NOYW1lIDogJycpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZHJhd2VyOiB7XG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnZHJhd2VyJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaGlkZGVuOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZHJhd2VySGlkZGVuKSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmRyYXdlckhpZGRlbiA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5kcmF3ZXJDb250ZW50KSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmRyYXdlckNvbnRlbnQgOiBbXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgICBpZDogJ2NvbnRlbnQnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBfdGhpcy5jaGlsZHJlblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIERyYXdlckxheW91dC5wcm90b3R5cGUuaXNIaWRkZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBtID0gZ2V0RHJhd2VyKHRoaXMpO1xuICAgICAgICBpZiAobS5pc05vdGhpbmcoKSlcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICByZXR1cm4gbS5nZXQoKS5pc0hpZGRlbigpO1xuICAgIH07XG4gICAgRHJhd2VyTGF5b3V0LnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbSA9IGdldERyYXdlcih0aGlzKTtcbiAgICAgICAgaWYgKG0uaXNKdXN0KCkpIHtcbiAgICAgICAgICAgIG0uZ2V0KCkuaGlkZSgpO1xuICAgICAgICAgICAgaGlkZGVuXzEuaGlkZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLnJvb3Qud21sLmlkKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIERyYXdlckxheW91dC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG0gPSBnZXREcmF3ZXIodGhpcyk7XG4gICAgICAgIGlmIChtLmlzSnVzdCgpKSB7XG4gICAgICAgICAgICBtLmdldCgpLnNob3coKTtcbiAgICAgICAgICAgIGhpZGRlbl8xLnNob3codGhpcy52aWV3LCB0aGlzLnZhbHVlcy5yb290LndtbC5pZCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBEcmF3ZXJMYXlvdXQucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG0gPSBnZXREcmF3ZXIodGhpcyk7XG4gICAgICAgIGlmIChtLmlzSnVzdCgpKSB7XG4gICAgICAgICAgICBtLmdldCgpLnRvZ2dsZSgpO1xuICAgICAgICAgICAgaGlkZGVuXzEudG9nZ2xlKHRoaXMudmlldywgdGhpcy52YWx1ZXMucm9vdC53bWwuaWQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgRHJhd2VyTGF5b3V0LnByb3RvdHlwZS5zZXRDb250ZW50ID0gZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgdGhpcy52YWx1ZXMuY29udGVudC52YWx1ZSA9IGM7XG4gICAgICAgIHRoaXMudmlldy5pbnZhbGlkYXRlKCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgRHJhd2VyTGF5b3V0LnByb3RvdHlwZS5yZW1vdmVDb250ZW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnZhbHVlcy5jb250ZW50LnZhbHVlID0gW107XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgcmV0dXJuIERyYXdlckxheW91dDtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLkRyYXdlckxheW91dCA9IERyYXdlckxheW91dDtcbnZhciBnZXREcmF3ZXIgPSBmdW5jdGlvbiAoZGwpIHtcbiAgICB2YXIgbSA9IGRsLnZpZXcuZmluZEJ5SWQoZGwudmFsdWVzLmRyYXdlci53bWwuaWQpO1xuICAgIGlmIChtLmlzTm90aGluZygpKVxuICAgICAgICB1dGlsXzEud2Fybk1pc3NpbmcoZGwudmlldywgZGwudmFsdWVzLmRyYXdlci53bWwuaWQpO1xuICAgIHJldHVybiBtO1xufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkRyYXdlckxheW91dCA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG52YXIgZHJhd2VyXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vbWVudS9kcmF3ZXJcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIERyYXdlckxheW91dCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBEcmF3ZXJMYXlvdXQoX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMucm9vdC53bWwuaWQgfSwgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5yb290LmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuY2xhc3NOYW1lIH0sIF9fc3ByZWFkQXJyYXlzKFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkcmF3ZXJfMS5EcmF3ZXIoeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5kcmF3ZXIud21sLmlkIH0sIHd3OiB7ICdoaWRkZW4nOiBfX2NvbnRleHQudmFsdWVzLmRyYXdlci5oaWRkZW4sICdjb250ZW50JzogX19jb250ZXh0LnZhbHVlcy5kcmF3ZXIuY29udGVudCB9IH0sIFtdKSwgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5kcmF3ZXIud21sLmlkIH0sIHd3OiB7ICdoaWRkZW4nOiBfX2NvbnRleHQudmFsdWVzLmRyYXdlci5oaWRkZW4sICdjb250ZW50JzogX19jb250ZXh0LnZhbHVlcy5kcmF3ZXIuY29udGVudCB9IH0pXG4gICAgICAgICAgICBdLCAoX19jb250ZXh0LnZhbHVlcy5jb250ZW50LnZhbHVlKSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBEcmF3ZXJMYXlvdXQucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBEcmF3ZXJMYXlvdXQucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgRHJhd2VyTGF5b3V0LnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgRHJhd2VyTGF5b3V0LnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIERyYXdlckxheW91dC5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgRHJhd2VyTGF5b3V0LnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIERyYXdlckxheW91dC5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgRHJhd2VyTGF5b3V0LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIERyYXdlckxheW91dDtcbn0oKSk7XG5leHBvcnRzLkRyYXdlckxheW91dCA9IERyYXdlckxheW91dDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRyYXdlci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Db2x1bW4gPSBleHBvcnRzLlJvdyA9IGV4cG9ydHMuR3JpZExheW91dCA9IGV4cG9ydHMuR1JJRF9MQVlPVVRfQ09MVU1OID0gZXhwb3J0cy5HUklEX0xBWU9VVF9ST1cgPSBleHBvcnRzLkdSSURfTEFZT1VUID0gdm9pZCAwO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL2dyaWRcIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uL1wiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuR1JJRF9MQVlPVVQgPSAnd3ctZ3JpZC1sYXlvdXQnO1xuZXhwb3J0cy5HUklEX0xBWU9VVF9ST1cgPSAnd3ctZ3JpZC1sYXlvdXRfX3Jvdyc7XG5leHBvcnRzLkdSSURfTEFZT1VUX0NPTFVNTiA9ICd3dy1ncmlkLWxheW91dF9fY29sdW1uJztcbjtcbi8qKlxuICogR3JpZExheW91dFxuICovXG52YXIgR3JpZExheW91dCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoR3JpZExheW91dCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBHcmlkTGF5b3V0KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5HcmlkTGF5b3V0KF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICAgIGlkOiBfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5pZCxcbiAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdyb290JyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5jbGFzc05hbWUpID9cbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmNsYXNzTmFtZSA6ICcnO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXRpbF8xLmNvbmNhdChleHBvcnRzLkdSSURfTEFZT1VULCBfXzEuTEFZT1VULCBjKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIEdyaWRMYXlvdXQ7XG59KF9fMS5BYnN0cmFjdExheW91dCkpO1xuZXhwb3J0cy5HcmlkTGF5b3V0ID0gR3JpZExheW91dDtcbi8qKlxuICogUm93XG4gKi9cbnZhciBSb3cgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFJvdywgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBSb3coKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLlJvdyhfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgICBpZDogX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuaWQsXG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAncm93JyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5jbGFzc05hbWUpID9cbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmNsYXNzTmFtZSA6ICcnO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXRpbF8xLmNvbmNhdChleHBvcnRzLkdSSURfTEFZT1VUX1JPVywgYyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBSb3c7XG59KF9fMS5BYnN0cmFjdExheW91dCkpO1xuZXhwb3J0cy5Sb3cgPSBSb3c7XG4vKipcbiAqIENvbHVtblxuICovXG52YXIgQ29sdW1uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhDb2x1bW4sIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQ29sdW1uKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5Db2x1bW4oX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgICAgaWQ6IF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmlkLFxuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ2NvbHVtbidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuYXR0cnMud3cgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHV0aWxfMS5jb25jYXQoZXhwb3J0cy5HUklEX0xBWU9VVF9DT0xVTU4sIF90aGlzLmF0dHJzLnd3LnNwYW4gP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiLXNwYW5cIiArIF90aGlzLmF0dHJzLnd3LnNwYW4gOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICctc3BhbjEyJywgX3RoaXMuYXR0cnMud3cub2Zmc2V0ID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIi1vZmZzZXRcIiArIF90aGlzLmF0dHJzLnd3Lm9mZnNldCA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJycsIF90aGlzLmF0dHJzLnd3LmNsYXNzTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXRpbF8xLmNvbmNhdChleHBvcnRzLkdSSURfTEFZT1VUX0NPTFVNTiwgJy1zcGFuMTInKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gQ29sdW1uO1xufShfXzEuQWJzdHJhY3RMYXlvdXQpKTtcbmV4cG9ydHMuQ29sdW1uID0gQ29sdW1uO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheXMgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXlzKSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcbiAgICAgICAgICAgIHJba10gPSBhW2pdO1xuICAgIHJldHVybiByO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQ29sdW1uID0gZXhwb3J0cy5Sb3cgPSBleHBvcnRzLkdyaWRMYXlvdXQgPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBHcmlkTGF5b3V0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEdyaWRMYXlvdXQoX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuY29udGVudC53bWwuaWQgfSwgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5jb250ZW50LmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRlbnQuY2xhc3NOYW1lKCkgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgR3JpZExheW91dC5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIEdyaWRMYXlvdXQucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgR3JpZExheW91dC5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIEdyaWRMYXlvdXQucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgR3JpZExheW91dC5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgR3JpZExheW91dC5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBHcmlkTGF5b3V0LnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBHcmlkTGF5b3V0LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIEdyaWRMYXlvdXQ7XG59KCkpO1xuZXhwb3J0cy5HcmlkTGF5b3V0ID0gR3JpZExheW91dDtcbjtcbnZhciBSb3cgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUm93KF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRlbnQud21sLmlkIH0sICdpZCc6IF9fY29udGV4dC52YWx1ZXMuY29udGVudC5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jb250ZW50LmNsYXNzTmFtZSgpIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQuY2hpbGRyZW4pKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIFJvdy5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIFJvdy5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBSb3cucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBSb3cucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgUm93LnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBSb3cucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgUm93LnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBSb3cucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gUm93O1xufSgpKTtcbmV4cG9ydHMuUm93ID0gUm93O1xuO1xudmFyIENvbHVtbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDb2x1bW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuY29udGVudC53bWwuaWQgfSwgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5jb250ZW50LmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRlbnQuY2xhc3NOYW1lKCkgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgQ29sdW1uLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgQ29sdW1uLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIENvbHVtbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIENvbHVtbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBDb2x1bW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIENvbHVtbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBDb2x1bW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIENvbHVtbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBDb2x1bW47XG59KCkpO1xuZXhwb3J0cy5Db2x1bW4gPSBDb2x1bW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1ncmlkLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkhvcml6b250YWxMYXlvdXQgPSBleHBvcnRzLkhvcml6b250YWxMYXlvdXRPcmllbnRhdGlvbiA9IGV4cG9ydHMuSE9SSVpPTlRBTF9MQVlPVVQgPSB2b2lkIDA7XG52YXIgd21sID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvaG9yaXpvbnRhbFwiKTtcbnZhciBvcmllbnRhdGlvbl8xID0gcmVxdWlyZShcIi4uLy4uL2NvbnRlbnQvb3JpZW50YXRpb25cIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgX18xID0gcmVxdWlyZShcIi4uLy4uL1wiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuSE9SSVpPTlRBTF9MQVlPVVQgPSAnd3ctaG9yaXpvbnRhbC1sYXlvdXQnO1xuLy8vY2xhc3NOYW1lczplbmRcbi8qKlxuICogSG9yaXpvbnRhbExheW91dE9yaWVudGF0aW9uXG4gKi9cbnZhciBIb3Jpem9udGFsTGF5b3V0T3JpZW50YXRpb247XG4oZnVuY3Rpb24gKEhvcml6b250YWxMYXlvdXRPcmllbnRhdGlvbikge1xuICAgIEhvcml6b250YWxMYXlvdXRPcmllbnRhdGlvbltcIkxlZnRcIl0gPSBcImxlZnRcIjtcbiAgICBIb3Jpem9udGFsTGF5b3V0T3JpZW50YXRpb25bXCJSaWdodFwiXSA9IFwicmlnaHRcIjtcbn0pKEhvcml6b250YWxMYXlvdXRPcmllbnRhdGlvbiA9IGV4cG9ydHMuSG9yaXpvbnRhbExheW91dE9yaWVudGF0aW9uIHx8IChleHBvcnRzLkhvcml6b250YWxMYXlvdXRPcmllbnRhdGlvbiA9IHt9KSk7XG4vKipcbiAqIEhvcml6b250YWxMYXlvdXQgdXNlcyB0aGUgY3NzIGZsZXhib3ggdG8gcHJvdmlkZSBhIGNvbnRhaW5lclxuICogd2hlcmUgYWxsIGl0ZW1zIGFyZSBsYWlkIG91dCBpbiBhIHNpbmdsZSByb3cuXG4gKi9cbnZhciBIb3Jpem9udGFsTGF5b3V0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhIb3Jpem9udGFsTGF5b3V0LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIEhvcml6b250YWxMYXlvdXQoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4oX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICByb290OiB7XG4gICAgICAgICAgICAgICAgaWQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5pZCkgPyBfdGhpcy5hdHRycy53dy5pZCA6ICcnLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLkhPUklaT05UQUxfTEFZT1VULCBfXzEuZ2V0Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSwgZ2V0T3JpZW50YXRpb24oX3RoaXMuYXR0cnMpKVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBIb3Jpem9udGFsTGF5b3V0O1xufSh3bWwuQ29tcG9uZW50KSk7XG5leHBvcnRzLkhvcml6b250YWxMYXlvdXQgPSBIb3Jpem9udGFsTGF5b3V0O1xudmFyIGdldE9yaWVudGF0aW9uID0gZnVuY3Rpb24gKGF0dHJzKSB7XG4gICAgcmV0dXJuIChhdHRycy53dyAmJiBhdHRycy53dy5vcmllbnRhdGlvbikgP1xuICAgICAgICBhdHRycy53dy5vcmllbnRhdGlvbiA9PT0gSG9yaXpvbnRhbExheW91dE9yaWVudGF0aW9uLlJpZ2h0ID9cbiAgICAgICAgICAgIG9yaWVudGF0aW9uXzEuUklHSFQgOiBvcmllbnRhdGlvbl8xLkxFRlQgOiAnJztcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7ICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMucm9vdC5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWhvcml6b250YWwuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZG9SZW1vdmVDb250ZW50ID0gZXhwb3J0cy5kb1NldENvbnRlbnQgPSBleHBvcnRzLkFic3RyYWN0TGF5b3V0ID0gZXhwb3J0cy5MQVlPVVQgPSB2b2lkIDA7XG52YXIgd21sXzEgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbFwiKTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vdXRpbFwiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuTEFZT1VUID0gJy1sYXlvdXQnO1xuLyoqXG4gKiBBYnN0cmFjdExheW91dCBwcm92aWRlcyBhbiBpbXBsZW1lbnRhdGlvbiBvZiBMYXlvdXQuXG4gKi9cbnZhciBBYnN0cmFjdExheW91dCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoQWJzdHJhY3RMYXlvdXQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQWJzdHJhY3RMYXlvdXQoKSB7XG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICB9XG4gICAgQWJzdHJhY3RMYXlvdXQucHJvdG90eXBlLnNldENvbnRlbnQgPSBmdW5jdGlvbiAoYykge1xuICAgICAgICBleHBvcnRzLmRvU2V0Q29udGVudCh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLmNvbnRlbnQud21sLmlkLCBjKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBBYnN0cmFjdExheW91dC5wcm90b3R5cGUucmVtb3ZlQ29udGVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZXhwb3J0cy5kb1JlbW92ZUNvbnRlbnQodGhpcy52aWV3LCB0aGlzLnZhbHVlcy5jb250ZW50LndtbC5pZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgcmV0dXJuIEFic3RyYWN0TGF5b3V0O1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuQWJzdHJhY3RMYXlvdXQgPSBBYnN0cmFjdExheW91dDtcbi8qKlxuICogZG9TZXRDb250ZW50IG9uIGEgTm9kZSBmb3VuZCBpbiBhIHZpZXcuXG4gKi9cbmV4cG9ydHMuZG9TZXRDb250ZW50ID0gZnVuY3Rpb24gKHZpZXcsIGlkLCBjb250ZW50KSB7XG4gICAgdmFyIG1heWJlUm9vdCA9IHZpZXcuZmluZEJ5SWQoaWQpO1xuICAgIGlmIChtYXliZVJvb3QuaXNOb3RoaW5nKCkpXG4gICAgICAgIHJldHVybiB1dGlsXzEud2Fybk1pc3NpbmcodmlldywgaWQpO1xuICAgIHZhciBuID0gbWF5YmVSb290LmdldCgpO1xuICAgIHdoaWxlIChuLmZpcnN0Q2hpbGQpXG4gICAgICAgIG4ucmVtb3ZlQ2hpbGQobi5maXJzdENoaWxkKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbnRlbnQubGVuZ3RoOyBpKyspXG4gICAgICAgIG4uYXBwZW5kQ2hpbGQoY29udGVudFtpXSk7XG59O1xuLyoqXG4gKiBkb1JlbW92ZUNvbnRlbnQgZnJvbSBhIFZpZXcuXG4gKi9cbmV4cG9ydHMuZG9SZW1vdmVDb250ZW50ID0gZnVuY3Rpb24gKHZpZXcsIGlkKSB7XG4gICAgdmFyIG1heWJlTm9kZSA9IHZpZXcuZmluZEJ5SWQoaWQpO1xuICAgIGlmIChtYXliZU5vZGUuaXNOb3RoaW5nKCkpXG4gICAgICAgIHJldHVybiB1dGlsXzEud2Fybk1pc3NpbmcodmlldywgaWQpO1xuICAgIHZhciBuID0gbWF5YmVOb2RlLmdldCgpO1xuICAgIHdoaWxlIChuLmZpcnN0Q2hpbGQpXG4gICAgICAgIG4ucmVtb3ZlQ2hpbGQobi5maXJzdENoaWxkKTtcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5MaXN0TGF5b3V0ID0gZXhwb3J0cy5MaXN0TGF5b3V0SXRlbSA9IGV4cG9ydHMuTElTVF9MQVlPVVRfSVRFTSA9IGV4cG9ydHMuTElTVF9MQVlPVVQgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvbGlzdFwiKTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbFwiKTtcbnZhciBhY3RpdmVfMSA9IHJlcXVpcmUoXCIuLi8uLi9jb250ZW50L3N0YXRlL2FjdGl2ZVwiKTtcbnZhciBfXzEgPSByZXF1aXJlKFwiLi4vXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5MSVNUX0xBWU9VVCA9ICd3dy1saXN0LWxheW91dCc7XG5leHBvcnRzLkxJU1RfTEFZT1VUX0lURU0gPSAnd3ctbGlzdC1sYXlvdXRfX2l0ZW0nO1xuLyoqXG4gKiBMaXN0TGF5b3V0SXRlbVxuICovXG52YXIgTGlzdExheW91dEl0ZW0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKExpc3RMYXlvdXRJdGVtLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIExpc3RMYXlvdXRJdGVtKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5MaXN0TGF5b3V0SXRlbShfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdpdGVtJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaWQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5pZCkgPyBfdGhpcy5hdHRycy53dy5pZCA6ICcnLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLkxJU1RfTEFZT1VUX0lURU0sIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5hY3RpdmUpID8gYWN0aXZlXzEuQUNUSVZFIDogJycpLFxuICAgICAgICAgICAgICAgIG5hbWU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5uYW1lKSA/IF90aGlzLmF0dHJzLnd3Lm5hbWUgOiAnJyxcbiAgICAgICAgICAgICAgICBvbmNsaWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vbkNsaWNrKVxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cub25DbGljayhfdGhpcy5hdHRycy53dyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3Lm5hbWUgfHwgJycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBMaXN0TGF5b3V0SXRlbS5wcm90b3R5cGUuaXNBY3RpdmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBhY3RpdmVfMS5pc0FjdGl2ZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLmNvbnRlbnQud21sLmlkKTtcbiAgICB9O1xuICAgIExpc3RMYXlvdXRJdGVtLnByb3RvdHlwZS5hY3RpdmF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYWN0aXZlXzEuYWN0aXZhdGUodGhpcy52aWV3LCB0aGlzLnZhbHVlcy5jb250ZW50LndtbC5pZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgTGlzdExheW91dEl0ZW0ucHJvdG90eXBlLmRlYWN0aXZhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGFjdGl2ZV8xLmRlYWN0aXZhdGUodGhpcy52aWV3LCB0aGlzLnZhbHVlcy5jb250ZW50LndtbC5pZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgTGlzdExheW91dEl0ZW0ucHJvdG90eXBlLnRvZ2dsZUFjdGl2ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNBY3RpdmUoKSlcbiAgICAgICAgICAgIHRoaXMuZGVhY3RpdmF0ZSgpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLmFjdGl2YXRlKCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgcmV0dXJuIExpc3RMYXlvdXRJdGVtO1xufShfXzEuQWJzdHJhY3RMYXlvdXQpKTtcbmV4cG9ydHMuTGlzdExheW91dEl0ZW0gPSBMaXN0TGF5b3V0SXRlbTtcbi8qKlxuICogTGlzdExheW91dCBpcyB1c2VkIHRvIGNyZWF0ZSBhIHZlcnRpY2FsIGxpc3Qgb2YgY29udGVudC5cbiAqXG4gKiBDaGlsZHJlbiBtdXN0IGJlIExpc3RHcm91cEl0ZW1zLlxuICovXG52YXIgTGlzdExheW91dCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTGlzdExheW91dCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBMaXN0TGF5b3V0KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5MaXN0TGF5b3V0KF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ2xpc3QnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpZDogX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuaWQsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuTElTVF9MQVlPVVQsIF9fMS5MQVlPVVQsIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5jbGFzc05hbWUpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuY2xhc3NOYW1lIDogJycpXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIExpc3RMYXlvdXQ7XG59KF9fMS5BYnN0cmFjdExheW91dCkpO1xuZXhwb3J0cy5MaXN0TGF5b3V0ID0gTGlzdExheW91dDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkxpc3RMYXlvdXQgPSBleHBvcnRzLkxpc3RMYXlvdXRJdGVtID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTGlzdExheW91dEl0ZW0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTGlzdExheW91dEl0ZW0oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2xpJywgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5jb250ZW50LndtbC5pZCB9LCAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRlbnQuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY29udGVudC5jbGFzc05hbWUsICdvbmNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5jb250ZW50Lm9uY2xpY2sgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTGlzdExheW91dEl0ZW0ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBMaXN0TGF5b3V0SXRlbS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBMaXN0TGF5b3V0SXRlbS5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIExpc3RMYXlvdXRJdGVtLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIExpc3RMYXlvdXRJdGVtLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBMaXN0TGF5b3V0SXRlbS5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBMaXN0TGF5b3V0SXRlbS5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTGlzdExheW91dEl0ZW0ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTGlzdExheW91dEl0ZW07XG59KCkpO1xuZXhwb3J0cy5MaXN0TGF5b3V0SXRlbSA9IExpc3RMYXlvdXRJdGVtO1xuO1xudmFyIExpc3RMYXlvdXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTGlzdExheW91dChfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgndWwnLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRlbnQud21sLmlkIH0sICdpZCc6IF9fY29udGV4dC52YWx1ZXMuY29udGVudC5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jb250ZW50LmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LmNoaWxkcmVuKSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBMaXN0TGF5b3V0LnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTGlzdExheW91dC5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBMaXN0TGF5b3V0LnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTGlzdExheW91dC5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBMaXN0TGF5b3V0LnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBMaXN0TGF5b3V0LnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIExpc3RMYXlvdXQucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIExpc3RMYXlvdXQucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTGlzdExheW91dDtcbn0oKSk7XG5leHBvcnRzLkxpc3RMYXlvdXQgPSBMaXN0TGF5b3V0O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bGlzdC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluTGF5b3V0ID0gZXhwb3J0cy5NQUlOX0xBWU9VVCA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9tYWluXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLi9cIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLk1BSU5fTEFZT1VUID0gJ3d3LW1haW4tbGF5b3V0Jztcbi8qKlxuICogTWFpbkxheW91dCBwcm92aWRlcyBhIGNvbnRhaW5lciBmb3IgdGhlIG1haW4gY29udGVudCBvZiBhbiBhcHBsaWNhdGlvbi5cbiAqL1xudmFyIE1haW5MYXlvdXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKE1haW5MYXlvdXQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTWFpbkxheW91dCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdtYWluJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaWQ6IChfdGhpcy5hdHRycyAmJiBfdGhpcy5hdHRycy53dykgPyBfdGhpcy5hdHRycy53dy5pZCA6ICcnLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLk1BSU5fTEFZT1VULCBfXzEuTEFZT1VULCAoX3RoaXMuYXR0cnMgJiYgX3RoaXMuYXR0cnMud3cpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuY2xhc3NOYW1lIDogJycpXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIE1haW5MYXlvdXQ7XG59KF9fMS5BYnN0cmFjdExheW91dCkpO1xuZXhwb3J0cy5NYWluTGF5b3V0ID0gTWFpbkxheW91dDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuY29udGVudC53bWwuaWQgfSwgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5jb250ZW50LmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRlbnQuY2xhc3NOYW1lIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQuY2hpbGRyZW4pKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tYWluLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1ldGVyQmFyID0gZXhwb3J0cy5NZXRlciA9IGV4cG9ydHMuTUVURVJfQkFSID0gZXhwb3J0cy5NRVRFUiA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9tZXRlclwiKTtcbnZhciB3bWxfMSA9IHJlcXVpcmUoXCJAcXVlbmsvd21sXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLi8uLi9cIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLk1FVEVSID0gJ3d3LW1ldGVyJztcbmV4cG9ydHMuTUVURVJfQkFSID0gJ3d3LW1ldGVyX19iYXInO1xuLyoqXG4gKiBNZXRlclxuICovXG52YXIgTWV0ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKE1ldGVyLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIE1ldGVyKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5NZXRlcihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIGlkOiBfXzEuZ2V0SWQoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuTUVURVIsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBNZXRlcjtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLk1ldGVyID0gTWV0ZXI7XG4vKipcbiAqIE1ldGVyQmFyXG4gKi9cbnZhciBNZXRlckJhciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTWV0ZXJCYXIsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTWV0ZXJCYXIoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1ldGVyQmFyKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5NRVRFUl9CQVIsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIHZhbHVlOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cudmFsdWUpID9cbiAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy52YWx1ZSA6IDAsXG4gICAgICAgICAgICBjb2xvcjogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmNvbG9yKSA/XG4gICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuY29sb3IgOiAnJyxcbiAgICAgICAgICAgIHN0eWxlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxpc3QgPSBbXTtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMudmFsdWVzLmNvbG9yKVxuICAgICAgICAgICAgICAgICAgICBsaXN0LnB1c2goXCJiYWNrZ3JvdW5kLWNvbG9yOlwiICsgX3RoaXMudmFsdWVzLmNvbG9yKTtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMudmFsdWVzLnZhbHVlKVxuICAgICAgICAgICAgICAgICAgICBsaXN0LnB1c2goXCJ3aWR0aDpcIiArIF90aGlzLnZhbHVlcy52YWx1ZSArIFwiJVwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbGlzdC5qb2luKCc7Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogc2V0VmFsdWUgc2V0cyB0aGUgdmFsdWUgb2YgdGhlIE1ldGVyQmFyLlxuICAgICAqL1xuICAgIE1ldGVyQmFyLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICB0aGlzLnZhbHVlcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLnZpZXcuaW52YWxpZGF0ZSgpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGluY3JlYXNlIHRoZSB2YWx1ZSBieSB0aGUgc3BlY2lmaWVkIGFtb3VudC5cbiAgICAgKi9cbiAgICBNZXRlckJhci5wcm90b3R5cGUuaW5jcmVhc2UgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgdGhpcy52YWx1ZXMudmFsdWUgPSB0aGlzLnZhbHVlcy52YWx1ZSArIHZhbHVlO1xuICAgICAgICB0aGlzLnZpZXcuaW52YWxpZGF0ZSgpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGRlY3JlYXNlIHRoZSB2YWx1ZSBieSB0aGUgc3BlY2lmaWVkIGFtb3VudC5cbiAgICAgKi9cbiAgICBNZXRlckJhci5wcm90b3R5cGUuZGVjcmVhc2UgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgdGhpcy52YWx1ZXMudmFsdWUgPSB0aGlzLnZhbHVlcy52YWx1ZSAtIHZhbHVlO1xuICAgICAgICB0aGlzLnZpZXcuaW52YWxpZGF0ZSgpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIHNldENvbG9yIG9mIHRoZSBNZXRlckJhci5cbiAgICAgKi9cbiAgICBNZXRlckJhci5wcm90b3R5cGUuc2V0Q29sb3IgPSBmdW5jdGlvbiAoY29sb3IpIHtcbiAgICAgICAgdGhpcy52YWx1ZXMuY29sb3IgPSBjb2xvcjtcbiAgICAgICAgdGhpcy52aWV3LmludmFsaWRhdGUoKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICByZXR1cm4gTWV0ZXJCYXI7XG59KHdtbF8xLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5NZXRlckJhciA9IE1ldGVyQmFyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheXMgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXlzKSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcbiAgICAgICAgICAgIHJba10gPSBhW2pdO1xuICAgIHJldHVybiByO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWV0ZXJCYXIgPSBleHBvcnRzLk1ldGVyID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWV0ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWV0ZXIoX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWV0ZXIucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNZXRlci5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNZXRlci5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1ldGVyLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1ldGVyLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNZXRlci5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNZXRlci5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWV0ZXIucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWV0ZXI7XG59KCkpO1xuZXhwb3J0cy5NZXRlciA9IE1ldGVyO1xuO1xudmFyIE1ldGVyQmFyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1ldGVyQmFyKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY2xhc3NOYW1lLCAnc3R5bGUnOiBfX2NvbnRleHQudmFsdWVzLnN0eWxlKCkgfSwgW10pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNZXRlckJhci5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1ldGVyQmFyLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1ldGVyQmFyLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWV0ZXJCYXIucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWV0ZXJCYXIucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1ldGVyQmFyLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1ldGVyQmFyLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNZXRlckJhci5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNZXRlckJhcjtcbn0oKSk7XG5leHBvcnRzLk1ldGVyQmFyID0gTWV0ZXJCYXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tZXRlci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5QYW5lbEZvb3RlciA9IGV4cG9ydHMuUGFuZWxCb2R5ID0gZXhwb3J0cy5QYW5lbEhlYWRlciA9IGV4cG9ydHMuUGFuZWwgPSBleHBvcnRzLlBBTkVMX0ZPT1RFUiA9IGV4cG9ydHMuUEFORUxfQk9EWSA9IGV4cG9ydHMuUEFORUxfSEVBREVSID0gZXhwb3J0cy5QQU5FTCA9IHZvaWQgMDtcbnZhciBzdHlsZSA9IHJlcXVpcmUoXCIuLi8uLi9jb250ZW50L3N0eWxlXCIpO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL3BhbmVsXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLlwiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbi8qKlxuICogUEFORUwgd3JhcHBlciBjbGFzcy5cbiAqL1xuZXhwb3J0cy5QQU5FTCA9ICd3dy1wYW5lbCc7XG4vKipcbiAqIFBBTkVMX0hFQURFUiBjbGFzcyBuYW1lLlxuICovXG5leHBvcnRzLlBBTkVMX0hFQURFUiA9ICd3dy1wYW5lbF9faGVhZGVyJztcbi8qKlxuICogUEFORUxfQk9EWSBjbGFzcyBuYW1lLlxuICovXG5leHBvcnRzLlBBTkVMX0JPRFkgPSAnd3ctcGFuZWxfX2JvZHknO1xuLyoqXG4gKiBQQU5FTF9GT09URVIgY2xhc3MgbmFtZS5cbiAqL1xuZXhwb3J0cy5QQU5FTF9GT09URVIgPSAnd3ctcGFuZWxfX2Zvb3Rlcic7XG4vKipcbiAqIFBhbmVsIHByb3ZpZGVzIGEgcmVjdGFuZ3VsYXIgY29udGFpbmVyIGZvciB2aXN1YWxseSBzZXBlcmF0aW5nXG4gKiBjb250ZW50IGJ5IGNvbnRleHQuXG4gKi9cbnZhciBQYW5lbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoUGFuZWwsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gUGFuZWwoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLlBhbmVsKF90aGlzKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHZhbHVlc1xuICAgICAgICAgKi9cbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiByb290IHZhbHVlcy5cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICAgIGlkOiBfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5pZCxcbiAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdwYW5lbCcsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5QQU5FTCwgX18xLkxBWU9VVCwgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnN0eWxlKSA/XG4gICAgICAgICAgICAgICAgICAgIFwiLVwiICsgX3RoaXMuYXR0cnMud3cuc3R5bGUgOiBzdHlsZS5ERUZBVUxULCBfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5jbGFzc05hbWUgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5jbGFzc05hbWUgOiAnJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gUGFuZWw7XG59KF9fMS5BYnN0cmFjdExheW91dCkpO1xuZXhwb3J0cy5QYW5lbCA9IFBhbmVsO1xuLyoqXG4gKiBQYW5lbEhlYWRlclxuICovXG52YXIgUGFuZWxIZWFkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFBhbmVsSGVhZGVyLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFBhbmVsSGVhZGVyKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5QYW5lbEhlYWRlcihfdGhpcyk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiB2YWx1ZXNcbiAgICAgICAgICovXG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdoZWFkZXInXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpZDogX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuaWQsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuUEFORUxfSEVBREVSLCBfXzEuTEFZT1VULCBfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5jbGFzc05hbWUgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5jbGFzc05hbWUgOiAnJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gUGFuZWxIZWFkZXI7XG59KF9fMS5BYnN0cmFjdExheW91dCkpO1xuZXhwb3J0cy5QYW5lbEhlYWRlciA9IFBhbmVsSGVhZGVyO1xuLyoqXG4gKiBQYW5lbEJvZHlcbiAqL1xudmFyIFBhbmVsQm9keSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoUGFuZWxCb2R5LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFBhbmVsQm9keSgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuUGFuZWxCb2R5KF90aGlzKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHZhbHVlc1xuICAgICAgICAgKi9cbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ2JvZHknXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpZDogX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuaWQsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuUEFORUxfQk9EWSwgX18xLkxBWU9VVCwgX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuY2xhc3NOYW1lID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuY2xhc3NOYW1lIDogJycpXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIFBhbmVsQm9keTtcbn0oX18xLkFic3RyYWN0TGF5b3V0KSk7XG5leHBvcnRzLlBhbmVsQm9keSA9IFBhbmVsQm9keTtcbi8qKlxuICogUGFuZWxGb290ZXJcbiAqL1xudmFyIFBhbmVsRm9vdGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhQYW5lbEZvb3RlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBQYW5lbEZvb3RlcigpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuUGFuZWxGb290ZXIoX3RoaXMpO1xuICAgICAgICAvKipcbiAgICAgICAgICogdmFsdWVzXG4gICAgICAgICAqL1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnZm9vdGVyJ1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaWQ6IF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmlkLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLlBBTkVMX0ZPT1RFUiwgX18xLkxBWU9VVCwgX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuY2xhc3NOYW1lID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuY2xhc3NOYW1lIDogJycpXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIFBhbmVsRm9vdGVyO1xufShfXzEuQWJzdHJhY3RMYXlvdXQpKTtcbmV4cG9ydHMuUGFuZWxGb290ZXIgPSBQYW5lbEZvb3Rlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlBhbmVsRm9vdGVyID0gZXhwb3J0cy5QYW5lbEJvZHkgPSBleHBvcnRzLlBhbmVsSGVhZGVyID0gZXhwb3J0cy5QYW5lbCA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIFBhbmVsID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFBhbmVsKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRlbnQuaWQgfSwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jb250ZW50LmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LmNoaWxkcmVuKSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBQYW5lbC5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIFBhbmVsLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIFBhbmVsLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgUGFuZWwucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgUGFuZWwucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIFBhbmVsLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIFBhbmVsLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBQYW5lbC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBQYW5lbDtcbn0oKSk7XG5leHBvcnRzLlBhbmVsID0gUGFuZWw7XG47XG52YXIgUGFuZWxIZWFkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUGFuZWxIZWFkZXIoX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuY29udGVudC5pZCB9LCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRlbnQuY2xhc3NOYW1lIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQuY2hpbGRyZW4pKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIFBhbmVsSGVhZGVyLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgUGFuZWxIZWFkZXIucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgUGFuZWxIZWFkZXIucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBQYW5lbEhlYWRlci5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBQYW5lbEhlYWRlci5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgUGFuZWxIZWFkZXIucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgUGFuZWxIZWFkZXIucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIFBhbmVsSGVhZGVyLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIFBhbmVsSGVhZGVyO1xufSgpKTtcbmV4cG9ydHMuUGFuZWxIZWFkZXIgPSBQYW5lbEhlYWRlcjtcbjtcbnZhciBQYW5lbEJvZHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gUGFuZWxCb2R5KF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRlbnQuaWQgfSwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jb250ZW50LmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LmNoaWxkcmVuKSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBQYW5lbEJvZHkucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBQYW5lbEJvZHkucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgUGFuZWxCb2R5LnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgUGFuZWxCb2R5LnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIFBhbmVsQm9keS5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgUGFuZWxCb2R5LnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIFBhbmVsQm9keS5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgUGFuZWxCb2R5LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIFBhbmVsQm9keTtcbn0oKSk7XG5leHBvcnRzLlBhbmVsQm9keSA9IFBhbmVsQm9keTtcbjtcbnZhciBQYW5lbEZvb3RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBQYW5lbEZvb3RlcihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgnZGl2JywgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5jb250ZW50LmlkIH0sICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY29udGVudC5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgUGFuZWxGb290ZXIucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBQYW5lbEZvb3Rlci5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBQYW5lbEZvb3Rlci5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIFBhbmVsRm9vdGVyLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIFBhbmVsRm9vdGVyLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBQYW5lbEZvb3Rlci5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBQYW5lbEZvb3Rlci5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgUGFuZWxGb290ZXIucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gUGFuZWxGb290ZXI7XG59KCkpO1xuZXhwb3J0cy5QYW5lbEZvb3RlciA9IFBhbmVsRm9vdGVyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFuZWwuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuVGFiTGF5b3V0ID0gZXhwb3J0cy5UQUJfTEFZT1VUID0gdm9pZCAwO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL3RhYlwiKTtcbnZhciB3bWxfMSA9IHJlcXVpcmUoXCJAcXVlbmsvd21sXCIpO1xudmFyIGRvbV8xID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLi8uLi9cIik7XG52YXIgX18yID0gcmVxdWlyZShcIi4uL1wiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuVEFCX0xBWU9VVCA9ICd3dy10YWItbGF5b3V0Jztcbi8qKlxuICogVGFiTGF5b3V0IHByb3ZpZGVzIGEgbGF5b3V0IHdob3NlIGRpc3BsYXllZCBjb250ZW50IGNhbiBiZSBjaGFuZ2VkIHZpYSB0YWJzLlxuICpcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqIHwgVGFiMSAgfCAgVGFiMiAgfCBUYWIyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxDb250ZW50PiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAqIHxfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX3xcbiAqL1xudmFyIFRhYkxheW91dCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVGFiTGF5b3V0LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFRhYkxheW91dCgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHJvb3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5UQUJfTEFZT1VULCBfXzIuTEFZT1VULCBfXzEuZ2V0Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSksXG4gICAgICAgICAgICAgICAgY29udGVudDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmFjdGl2ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYXliZUFjdGl2ZSA9IG1heWJlXzEuZnJvbU51bGxhYmxlKF90aGlzLnZhbHVlcy50YWJzLmRhdGFbX3RoaXMuYXR0cnMud3cuYWN0aXZlXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobWF5YmVBY3RpdmUuaXNKdXN0KCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1heWJlQWN0aXZlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY29udGVudEZ1bihfdGhpcykoX3RoaXMudmlldyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmNoaWxkcmVuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0YWJzOiB7XG4gICAgICAgICAgICAgICAgY3VycmVudDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmFjdGl2ZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5hY3RpdmUgOiAnJyxcbiAgICAgICAgICAgICAgICBkYXRhOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cudGFicykgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy50YWJzIDoge30sXG4gICAgICAgICAgICAgICAgY29udGVudDogZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQudGFiRnVuKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQudGFiRnVuKF90aGlzKShfdGhpcy52aWV3KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQudGV4dClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbZG9tXzEudGV4dCh0LnRleHQpXTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLnZhbHVlcy50YWJzLmN1cnJlbnQgIT09IGUubmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnZhbHVlcy50YWJzLmN1cnJlbnQgPSBlLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0YWIgPSBtYXliZV8xLmZyb21OdWxsYWJsZShfdGhpcy52YWx1ZXMudGFicy5kYXRhW2UubmFtZV0pLmdldCgpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy52YWx1ZXMucm9vdC5jb250ZW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRhYi5jb250ZW50RnVuKF90aGlzKShfdGhpcy52aWV3KTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMudmlldy5pbnZhbGlkYXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIFRhYkxheW91dC5wcm90b3R5cGUuc2V0Q29udGVudCA9IGZ1bmN0aW9uIChjKSB7XG4gICAgICAgIHRoaXMudmFsdWVzLnJvb3QuY29udGVudCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGM7IH07XG4gICAgICAgIHRoaXMudmlldy5pbnZhbGlkYXRlKCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgVGFiTGF5b3V0LnByb3RvdHlwZS5yZW1vdmVDb250ZW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnZhbHVlcy5yb290LmNvbnRlbnQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBbXTsgfTtcbiAgICAgICAgdGhpcy52aWV3LmludmFsaWRhdGUoKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICByZXR1cm4gVGFiTGF5b3V0O1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuVGFiTGF5b3V0ID0gVGFiTGF5b3V0O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheXMgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXlzKSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcbiAgICAgICAgICAgIHJba10gPSBhW2pdO1xuICAgIHJldHVybiByO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG52YXIgdGFiX2Jhcl8xID0gcmVxdWlyZShcIi4uLy4uLy4uL2NvbnRyb2wvdGFiLWJhclwiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMucm9vdC5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5yb290LmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cyhbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFiX2Jhcl8xLlRhYkJhcih7fSwgX19zcHJlYWRBcnJheXMoX19mb3JPZihfX2NvbnRleHQudmFsdWVzLnRhYnMuZGF0YSwgZnVuY3Rpb24gKHRhYiwgbmFtZSwgXyQkYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFiX2Jhcl8xLlRhYih7IHd3OiB7ICduYW1lJzogbmFtZSwgJ2FjdGl2ZSc6IChfX2NvbnRleHQudmFsdWVzLnRhYnMuY3VycmVudCA9PT0gbmFtZSksICdvbkNsaWNrJzogX19jb250ZXh0LnZhbHVlcy50YWJzLm9uQ2xpY2sgfSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LnZhbHVlcy50YWJzLmNvbnRlbnQodGFiKSkpKSwgeyB3dzogeyAnbmFtZSc6IG5hbWUsICdhY3RpdmUnOiAoX19jb250ZXh0LnZhbHVlcy50YWJzLmN1cnJlbnQgPT09IG5hbWUpLCAnb25DbGljayc6IF9fY29udGV4dC52YWx1ZXMudGFicy5vbkNsaWNrIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtdKTsgfSkpKSwge30pXG4gICAgICAgICAgICBdLCAoX19jb250ZXh0LnZhbHVlcy5yb290LmNvbnRlbnQoKSkpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXRhYi5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5UYWJsZUxheW91dCA9IGV4cG9ydHMuVGFibGVXaW5kb3cgPSBleHBvcnRzLlRhYmxlQ2VsbCA9IGV4cG9ydHMuVGFibGVIZWFkaW5nID0gZXhwb3J0cy5UYWJsZVJvdyA9IGV4cG9ydHMuVGFibGVGb290ZXIgPSBleHBvcnRzLlRhYmxlQm9keSA9IGV4cG9ydHMuVGFibGVIZWFkZXIgPSBleHBvcnRzLkhPVkVSQUJMRSA9IGV4cG9ydHMuQUxURVJOQVRFID0gZXhwb3J0cy5DT01QQUNUID0gZXhwb3J0cy5CT1JERVJFRCA9IGV4cG9ydHMuVEFCTEVfV0lORE9XID0gZXhwb3J0cy5UQUJMRV9MQVlPVVQgPSBleHBvcnRzLlRBQkxFX0NFTEwgPSBleHBvcnRzLlRBQkxFX0hFQURJTkcgPSBleHBvcnRzLlRBQkxFX1JPVyA9IGV4cG9ydHMuVEFCTEVfRk9PVEVSID0gZXhwb3J0cy5UQUJMRV9CT0RZID0gZXhwb3J0cy5UQUJMRV9IRUFERVIgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvdGFibGVcIik7XG52YXIgd21sXzEgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbFwiKTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbFwiKTtcbnZhciBfXzEgPSByZXF1aXJlKFwiLi4vLi4vXCIpO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuZXhwb3J0cy5UQUJMRV9IRUFERVIgPSAnd3ctdGFibGUtbGF5b3V0X19oZWFkZXInO1xuZXhwb3J0cy5UQUJMRV9CT0RZID0gJ3d3LXRhYmxlLWxheW91dF9fYm9keSc7XG5leHBvcnRzLlRBQkxFX0ZPT1RFUiA9ICd3dy10YWJsZS1sYXlvdXRfX2Zvb3Rlcic7XG5leHBvcnRzLlRBQkxFX1JPVyA9ICd3dy10YWJsZS1sYXlvdXRfX3Jvdyc7XG5leHBvcnRzLlRBQkxFX0hFQURJTkcgPSAnd3ctdGFibGUtbGF5b3V0IF9oZWFkaW5nJztcbmV4cG9ydHMuVEFCTEVfQ0VMTCA9ICd3dy10YWJsZS1sYXlvdXRfX2NlbGwnO1xuZXhwb3J0cy5UQUJMRV9MQVlPVVQgPSAnd3ctdGFibGUtbGF5b3V0JztcbmV4cG9ydHMuVEFCTEVfV0lORE9XID0gJ3d3LXRhYmxlLXdpbmRvdyc7XG5leHBvcnRzLkJPUkRFUkVEID0gJy1ib3JkZXJlZCc7XG5leHBvcnRzLkNPTVBBQ1QgPSAnLWNvbXBhY3QnO1xuZXhwb3J0cy5BTFRFUk5BVEUgPSAnLWFsdGVybmF0ZSc7XG5leHBvcnRzLkhPVkVSQUJMRSA9ICctaG92ZXJhYmxlJztcbi8qKlxuICogVGFibGVIZWFkZXIgKDx0aGVhZD4pXG4gKi9cbnZhciBUYWJsZUhlYWRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVGFibGVIZWFkZXIsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gVGFibGVIZWFkZXIoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLlRhYmxlSGVhZGVyKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5UQUJMRV9IRUFERVIsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBUYWJsZUhlYWRlcjtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLlRhYmxlSGVhZGVyID0gVGFibGVIZWFkZXI7XG4vKipcbiAqIFRhYmxlQm9keVxuICovXG52YXIgVGFibGVCb2R5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhUYWJsZUJvZHksIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gVGFibGVCb2R5KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5UYWJsZUJvZHkoX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLlRBQkxFX0JPRFksIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBUYWJsZUJvZHk7XG59KHdtbF8xLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5UYWJsZUJvZHkgPSBUYWJsZUJvZHk7XG4vKipcbiAqIFRhYmxlRm9vdGVyXG4gKi9cbnZhciBUYWJsZUZvb3RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVGFibGVGb290ZXIsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gVGFibGVGb290ZXIoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLlRhYmxlRm9vdGVyKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5UQUJMRV9GT09URVIsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBUYWJsZUZvb3Rlcjtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLlRhYmxlRm9vdGVyID0gVGFibGVGb290ZXI7XG4vKipcbiAqIFRhYmxlUm93XG4gKi9cbnZhciBUYWJsZVJvdyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVGFibGVSb3csIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gVGFibGVSb3coKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IHZpZXdzLlRhYmxlUm93KF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5UQUJMRV9ST1csIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIG9uY2xpY2s6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vbmNsaWNrKSA/XG4gICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cub25jbGljayA6IHVuZGVmaW5lZFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBUYWJsZVJvdztcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLlRhYmxlUm93ID0gVGFibGVSb3c7XG4vKipcbiAqIFRhYmxlSGVhZGluZ1xuICovXG52YXIgVGFibGVIZWFkaW5nID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhUYWJsZUhlYWRpbmcsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gVGFibGVIZWFkaW5nKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5UYWJsZUhlYWRpbmcoX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLlRBQkxFX0hFQURJTkcsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIG9uY2xpY2s6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5vbmNsaWNrKSA/XG4gICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cub25jbGljayA6IHVuZGVmaW5lZFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBUYWJsZUhlYWRpbmc7XG59KHdtbF8xLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5UYWJsZUhlYWRpbmcgPSBUYWJsZUhlYWRpbmc7XG4vKipcbiAqIFRhYmxlQ2VsbFxuICovXG52YXIgVGFibGVDZWxsID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhUYWJsZUNlbGwsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gVGFibGVDZWxsKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5UYWJsZUNlbGwoX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBpZDogX18xLmdldElkKF90aGlzLmF0dHJzKSxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLlRBQkxFX0NFTEwsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpKSxcbiAgICAgICAgICAgIGNvbHNwYW46IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5jb2xzcGFuKSA/XG4gICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuY29sc3BhbiA6IDEsXG4gICAgICAgICAgICByb3dzcGFuOiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cucm93c3BhbikgP1xuICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LnJvd3NwYW4gOiAxLFxuICAgICAgICAgICAgb25jbGljazogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3Lm9uY2xpY2spID9cbiAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5vbmNsaWNrIDogdW5kZWZpbmVkXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIFRhYmxlQ2VsbDtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLlRhYmxlQ2VsbCA9IFRhYmxlQ2VsbDtcbi8qKlxuICogVGFibGVXaW5kb3cgYWxsb3dzIGEgVGFibGVMYXlvdXQgdG8gYmUgc2Nyb2xsZWQgb24gc21hbGxlciBzY3JlZW5zLlxuICovXG52YXIgVGFibGVXaW5kb3cgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFRhYmxlV2luZG93LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFRhYmxlV2luZG93KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5UYWJsZVdpbmRvdyhfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIGlkOiBfXzEuZ2V0SWQoX3RoaXMuYXR0cnMpLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuVEFCTEVfV0lORE9XLCBfXzEuZ2V0Q2xhc3NOYW1lKF90aGlzLmF0dHJzKSlcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gVGFibGVXaW5kb3c7XG59KHdtbF8xLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5UYWJsZVdpbmRvdyA9IFRhYmxlV2luZG93O1xuLyoqXG4gKiBUYWJsZUxheW91dCBwcm92aWRlcyBhIDx0YWJsZT4gYmFzZWQgbGF5b3V0LlxuICovXG52YXIgVGFibGVMYXlvdXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFRhYmxlTGF5b3V0LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFRhYmxlTGF5b3V0KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5UYWJsZUxheW91dChfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgIGlkOiAndGFibGUnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICBjbGFzc05hbWU6IHV0aWxfMS5jb25jYXQoZXhwb3J0cy5UQUJMRV9MQVlPVVQsIF9fMS5nZXRDbGFzc05hbWUoX3RoaXMuYXR0cnMpLCAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuYWx0ZXJuYXRlKSA/IGV4cG9ydHMuQUxURVJOQVRFIDogJycsIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5ib3JkZXJlZCkgPyBleHBvcnRzLkJPUkRFUkVEIDogJycsIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5jb21wYWN0KSA/IGV4cG9ydHMuQ09NUEFDVCA6ICcnLCAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuaG92ZXJhYmxlKSA/IGV4cG9ydHMuSE9WRVJBQkxFIDogJycpLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIHJldHVybiBUYWJsZUxheW91dDtcbn0od21sXzEuQ29tcG9uZW50KSk7XG5leHBvcnRzLlRhYmxlTGF5b3V0ID0gVGFibGVMYXlvdXQ7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5UYWJsZUxheW91dCA9IGV4cG9ydHMuVGFibGVXaW5kb3cgPSBleHBvcnRzLlRhYmxlQ2VsbCA9IGV4cG9ydHMuVGFibGVIZWFkaW5nID0gZXhwb3J0cy5UYWJsZVJvdyA9IGV4cG9ydHMuVGFibGVGb290ZXIgPSBleHBvcnRzLlRhYmxlQm9keSA9IGV4cG9ydHMuVGFibGVIZWFkZXIgPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBUYWJsZUhlYWRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBUYWJsZUhlYWRlcihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgndGhlYWQnLCB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY2xhc3NOYW1lIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQuY2hpbGRyZW4pKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIFRhYmxlSGVhZGVyLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgVGFibGVIZWFkZXIucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgVGFibGVIZWFkZXIucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBUYWJsZUhlYWRlci5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBUYWJsZUhlYWRlci5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgVGFibGVIZWFkZXIucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgVGFibGVIZWFkZXIucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIFRhYmxlSGVhZGVyLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIFRhYmxlSGVhZGVyO1xufSgpKTtcbmV4cG9ydHMuVGFibGVIZWFkZXIgPSBUYWJsZUhlYWRlcjtcbjtcbnZhciBUYWJsZUJvZHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVGFibGVCb2R5KF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCd0Ym9keScsIHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgVGFibGVCb2R5LnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgVGFibGVCb2R5LnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIFRhYmxlQm9keS5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIFRhYmxlQm9keS5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBUYWJsZUJvZHkucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIFRhYmxlQm9keS5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBUYWJsZUJvZHkucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIFRhYmxlQm9keS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBUYWJsZUJvZHk7XG59KCkpO1xuZXhwb3J0cy5UYWJsZUJvZHkgPSBUYWJsZUJvZHk7XG47XG52YXIgVGFibGVGb290ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVGFibGVGb290ZXIoX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ3Rmb290JywgeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LmNoaWxkcmVuKSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBUYWJsZUZvb3Rlci5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIFRhYmxlRm9vdGVyLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIFRhYmxlRm9vdGVyLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgVGFibGVGb290ZXIucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgVGFibGVGb290ZXIucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIFRhYmxlRm9vdGVyLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIFRhYmxlRm9vdGVyLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBUYWJsZUZvb3Rlci5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBUYWJsZUZvb3Rlcjtcbn0oKSk7XG5leHBvcnRzLlRhYmxlRm9vdGVyID0gVGFibGVGb290ZXI7XG47XG52YXIgVGFibGVSb3cgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVGFibGVSb3coX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ3RyJywgeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSwgJ29uY2xpY2snOiBfX2NvbnRleHQudmFsdWVzLm9uY2xpY2sgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgVGFibGVSb3cucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBUYWJsZVJvdy5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBUYWJsZVJvdy5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIFRhYmxlUm93LnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIFRhYmxlUm93LnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBUYWJsZVJvdy5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBUYWJsZVJvdy5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgVGFibGVSb3cucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gVGFibGVSb3c7XG59KCkpO1xuZXhwb3J0cy5UYWJsZVJvdyA9IFRhYmxlUm93O1xuO1xudmFyIFRhYmxlSGVhZGluZyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBUYWJsZUhlYWRpbmcoX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ3RoJywgeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSwgJ29uY2xpY2snOiBfX2NvbnRleHQudmFsdWVzLm9uY2xpY2sgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgVGFibGVIZWFkaW5nLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgVGFibGVIZWFkaW5nLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIFRhYmxlSGVhZGluZy5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIFRhYmxlSGVhZGluZy5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBUYWJsZUhlYWRpbmcucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIFRhYmxlSGVhZGluZy5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBUYWJsZUhlYWRpbmcucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIFRhYmxlSGVhZGluZy5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBUYWJsZUhlYWRpbmc7XG59KCkpO1xuZXhwb3J0cy5UYWJsZUhlYWRpbmcgPSBUYWJsZUhlYWRpbmc7XG47XG52YXIgVGFibGVDZWxsID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFRhYmxlQ2VsbChfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgndGQnLCB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMuY2xhc3NOYW1lLCAnY29sc3Bhbic6IFN0cmluZyhfX2NvbnRleHQudmFsdWVzLmNvbHNwYW4pLCAncm93c3Bhbic6IFN0cmluZyhfX2NvbnRleHQudmFsdWVzLnJvd3NwYW4pLCAnb25jbGljayc6IF9fY29udGV4dC52YWx1ZXMub25jbGljayB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LmNoaWxkcmVuKSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBUYWJsZUNlbGwucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBUYWJsZUNlbGwucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgVGFibGVDZWxsLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgVGFibGVDZWxsLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIFRhYmxlQ2VsbC5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgVGFibGVDZWxsLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIFRhYmxlQ2VsbC5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgVGFibGVDZWxsLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIFRhYmxlQ2VsbDtcbn0oKSk7XG5leHBvcnRzLlRhYmxlQ2VsbCA9IFRhYmxlQ2VsbDtcbjtcbnZhciBUYWJsZVdpbmRvdyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBUYWJsZVdpbmRvdyhfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgnZGl2JywgeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LmNoaWxkcmVuKSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBUYWJsZVdpbmRvdy5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIFRhYmxlV2luZG93LnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIFRhYmxlV2luZG93LnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgVGFibGVXaW5kb3cucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgVGFibGVXaW5kb3cucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIFRhYmxlV2luZG93LnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIFRhYmxlV2luZG93LnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBUYWJsZVdpbmRvdy5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBUYWJsZVdpbmRvdztcbn0oKSk7XG5leHBvcnRzLlRhYmxlV2luZG93ID0gVGFibGVXaW5kb3c7XG47XG52YXIgVGFibGVMYXlvdXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVGFibGVMYXlvdXQoX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ3RhYmxlJywgeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LmNoaWxkcmVuKSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBUYWJsZUxheW91dC5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIFRhYmxlTGF5b3V0LnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIFRhYmxlTGF5b3V0LnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgVGFibGVMYXlvdXQucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgVGFibGVMYXlvdXQucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIFRhYmxlTGF5b3V0LnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIFRhYmxlTGF5b3V0LnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBUYWJsZUxheW91dC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBUYWJsZUxheW91dDtcbn0oKSk7XG5leHBvcnRzLlRhYmxlTGF5b3V0ID0gVGFibGVMYXlvdXQ7XG4vLyMgc291cmNlTWFwcGluZ1VSTD10YWJsZS5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5XZWxsID0gZXhwb3J0cy5XRUxMID0gdm9pZCAwO1xudmFyIHV0aWxfMSA9IHJlcXVpcmUoXCIuLi8uLi91dGlsXCIpO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLlwiKTtcbnZhciB3ZWxsXzEgPSByZXF1aXJlKFwiLi93bWwvd2VsbFwiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuV0VMTCA9ICd3dy13ZWxsJztcbi8qKlxuICogV2VsbCBwcm92aWRlcyBhIHJlY3Rhbmd1bGFyIGNvbnRhaW5lciBmb3IgdmlzdWFsbHkgc2VwZXJhdGluZ1xuICogY29udGVudCBieSBjb250ZXh0LlxuICovXG52YXIgV2VsbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoV2VsbCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBXZWxsKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB3ZWxsXzEuV2VsbFZpZXcoX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIHJvb3QgdmFsdWVzLlxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBjb250ZW50OiB7XG4gICAgICAgICAgICAgICAgaWQ6IF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmlkLFxuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ3dlbGwnLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuV0VMTCwgX18xLkxBWU9VVCwgX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuY2xhc3NOYW1lID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuY2xhc3NOYW1lIDogJycpXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIFdlbGw7XG59KF9fMS5BYnN0cmFjdExheW91dCkpO1xuZXhwb3J0cy5XZWxsID0gV2VsbDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLldlbGxWaWV3ID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgV2VsbFZpZXcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gV2VsbFZpZXcoX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2RpdicsIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuY29udGVudC5pZCB9LCAnY2xhc3MnOiBfX2NvbnRleHQudmFsdWVzLmNvbnRlbnQuY2xhc3NOYW1lIH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQuY2hpbGRyZW4pKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIFdlbGxWaWV3LnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgV2VsbFZpZXcucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgV2VsbFZpZXcucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBXZWxsVmlldy5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBXZWxsVmlldy5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgV2VsbFZpZXcucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgV2VsbFZpZXcucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIFdlbGxWaWV3LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIFdlbGxWaWV3O1xufSgpKTtcbmV4cG9ydHMuV2VsbFZpZXcgPSBXZWxsVmlldztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXdlbGwuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRHJhd2VyID0gZXhwb3J0cy5EUkFXRVJfQ09OVEVOVCA9IGV4cG9ydHMuRFJBV0VSID0gdm9pZCAwO1xudmFyIGhpZGRlbl8xID0gcmVxdWlyZShcIi4uLy4uL2NvbnRlbnQvc3RhdGUvaGlkZGVuXCIpO1xudmFyIGxheW91dF8xID0gcmVxdWlyZShcIi4uLy4uL2xheW91dFwiKTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbFwiKTtcbnZhciBkcmF3ZXJfMSA9IHJlcXVpcmUoXCIuL3dtbC9kcmF3ZXJcIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLkRSQVdFUiA9ICd3dy1kcmF3ZXInO1xuZXhwb3J0cy5EUkFXRVJfQ09OVEVOVCA9ICd3dy1kcmF3ZXJfX2NvbnRlbnQnO1xuLyoqXG4gKiBEcmF3ZXIgcHJvdmlkZXMgYSB3aWRnZXQgZm9yIGRpc3BsYXlpbmcgbmF2aWdhdGlvbiBhbmQgb3RoZXIgc2lkZWJhciBjb250ZW50LlxuICpcbiAqIEl0J3MgYXBpIGFsbG93cyBmb3IgdG9nZ2xpbmcgYmV0d2VlbiBoaWRkZW4gYW5kIHNob3duIHN0YXRlcyBhcyB3ZWxsIGFzXG4gKiBxdWVyeWluZyB0aGUgY3VycmVudCBzdGF0ZS5cbiAqXG4gKiBUaGlzIHdpZGdldCdzIHN0eWxlIGludGVudGlvbmFsbHkgZ2l2ZXMgaXQgYSBoaWdoIHotaW5kZXggc28gdGhhdCBpdCBhcHBlYXJzXG4gKiBpbi1mcm9udCAgb2Ygb3RoZXIgY29udGVudC4gQWRqdXN0IHRoZSByZXNwZWN0aXZlIHN0eWxlIHZhcmlhYmxlcyB0byBjaGFuZ2UuXG4gKi9cbnZhciBEcmF3ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKERyYXdlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBEcmF3ZXIoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IGRyYXdlcl8xLk1haW4oX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICByb290OiB7XG4gICAgICAgICAgICAgICAgaWQ6IF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmlkLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdXRpbF8xLmNvbmNhdChleHBvcnRzLkRSQVdFUiwgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmhpZGRlbikgP1xuICAgICAgICAgICAgICAgICAgICBoaWRkZW5fMS5ISURERU4gOiAnJyksXG4gICAgICAgICAgICAgICAgd21sOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAncm9vdCdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udGVudDoge1xuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ2NvbnRlbnQnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IGV4cG9ydHMuRFJBV0VSX0NPTlRFTlQsXG4gICAgICAgICAgICAgICAgdmFsdWU6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5jb250ZW50KSA/XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmF0dHJzLnd3LmNvbnRlbnQgOiBfdGhpcy5jaGlsZHJlblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIERyYXdlci5wcm90b3R5cGUuaXNIaWRkZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBoaWRkZW5fMS5pc0hpZGRlbih0aGlzLnZpZXcsIHRoaXMudmFsdWVzLnJvb3Qud21sLmlkKTtcbiAgICB9O1xuICAgIERyYXdlci5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaGlkZGVuXzEuaGlkZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLnJvb3Qud21sLmlkKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBEcmF3ZXIucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGhpZGRlbl8xLnNob3codGhpcy52aWV3LCB0aGlzLnZhbHVlcy5yb290LndtbC5pZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgRHJhd2VyLnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGhpZGRlbl8xLnRvZ2dsZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLnJvb3Qud21sLmlkKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICByZXR1cm4gRHJhd2VyO1xufShsYXlvdXRfMS5BYnN0cmFjdExheW91dCkpO1xuZXhwb3J0cy5EcmF3ZXIgPSBEcmF3ZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdkaXYnLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLnJvb3Qud21sLmlkIH0sICdpZCc6IF9fY29udGV4dC52YWx1ZXMucm9vdC5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5yb290LmNsYXNzTmFtZSB9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2RpdicsIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuY29udGVudC53bWwuaWQgfSwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5jb250ZW50LmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LnZhbHVlcy5jb250ZW50LnZhbHVlKSkpXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRyYXdlci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NZW51SGVhZGVyID0gZXhwb3J0cy5NRU5VX0hFQURFUiA9IHZvaWQgMDtcbnZhciB3bWwgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbFwiKTtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9oZWFkZXJcIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG4vKipcbiAqIE1FTlVfSEVBREVSXG4gKi9cbmV4cG9ydHMuTUVOVV9IRUFERVIgPSAnd3ctbWVudS1oZWFkZXInO1xuLyoqXG4gKiBNZW51SGVhZGVyIGNhbiBiZSB1c2VkIHRvIGRpc3BsYXkgbm9uLWNsaWNrYWJsZSBoZWFkaW5nIHRleHQgaW4gYSBuYXYgbWVudS5cbiAqL1xudmFyIE1lbnVIZWFkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKE1lbnVIZWFkZXIsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTWVudUhlYWRlcigpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHNwYW46IHtcbiAgICAgICAgICAgICAgICBpZDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmlkKSA/IF90aGlzLmF0dHJzLnd3LmlkIDogJycsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuTUVOVV9IRUFERVIsIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5jbGFzc05hbWUpID9cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXR0cnMud3cuY2xhc3NOYW1lIDogJycpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGV4dDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnRleHQpID9cbiAgICAgICAgICAgICAgICBbZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoX3RoaXMuYXR0cnMud3cudGV4dCldIDogX3RoaXMuY2hpbGRyZW5cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gTWVudUhlYWRlcjtcbn0od21sLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5NZW51SGVhZGVyID0gTWVudUhlYWRlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ3NwYW4nLCB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuc3Bhbi5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5zcGFuLmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LnZhbHVlcy50ZXh0KSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aGVhZGVyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkl0ZW0gPSBleHBvcnRzLkl0ZW1DbGlja2VkRXZlbnQgPSBleHBvcnRzLkRJVklERVIgPSBleHBvcnRzLklURU0gPSB2b2lkIDA7XG52YXIgd21sID0gcmVxdWlyZShcIkBxdWVuay93bWxcIik7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvaXRlbVwiKTtcbnZhciBhY3RpdmVfMSA9IHJlcXVpcmUoXCIuLi8uLi9jb250ZW50L3N0YXRlL2FjdGl2ZVwiKTtcbnZhciBhY3RpdmVfMiA9IHJlcXVpcmUoXCIuLi8uLi9jb250ZW50L3N0YXRlL2FjdGl2ZVwiKTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vdXRpbFwiKTtcbi8vL2NsYXNzTmFtZXM6YmVnaW5cbmV4cG9ydHMuSVRFTSA9ICd3dy1tZW51LWl0ZW0nO1xuZXhwb3J0cy5ESVZJREVSID0gJy1kaXZpZGVyJztcbi8qKlxuICogSXRlbUNsaWNrZWRFdmVudCBpcyBmaXJlZCB3aGVuIHRoZSB1c2VyIGNsaWNrcyBvbiBhbiBpdGVtIGluXG4gKiBhIG5hdiBsaXN0LlxuICovXG52YXIgSXRlbUNsaWNrZWRFdmVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBJdGVtQ2xpY2tlZEV2ZW50KG5hbWUpIHtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB9XG4gICAgcmV0dXJuIEl0ZW1DbGlja2VkRXZlbnQ7XG59KCkpO1xuZXhwb3J0cy5JdGVtQ2xpY2tlZEV2ZW50ID0gSXRlbUNsaWNrZWRFdmVudDtcbi8qKlxuICogSXRlbSB3cmFwcyBjb250ZW50IGluIGEgbmF2aWdhdGlvbiBsaXN0LlxuICpcbiAqIEl0ZW1zIHNob3VsZCBub3QgaGF2ZSBhbnkgc2libGluZ3MgdGhhdCBhcmUgbm90IG90aGVyIEl0ZW1zLlxuICovXG52YXIgSXRlbSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoSXRlbSwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBJdGVtKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5NYWluKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgcm9vdDoge1xuICAgICAgICAgICAgICAgIHdtbDoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ3Jvb3QnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpZDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmlkKSA/IF90aGlzLmF0dHJzLnd3LmlkIDogJycsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuSVRFTSwgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmFjdGl2ZSkgPyBhY3RpdmVfMi5BQ1RJVkUgOiAnJywgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmRpdmlkZXIpID8gZXhwb3J0cy5ESVZJREVSIDogJycpLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuZGl2aWRlcilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy50ZXh0KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoX3RoaXMuYXR0cnMud3cudGV4dCldO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5jaGlsZHJlbjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBJdGVtLnByb3RvdHlwZS5hY3RpdmF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYWN0aXZlXzEuYWN0aXZhdGUodGhpcy52aWV3LCB0aGlzLnZhbHVlcy5yb290LndtbC5pZCk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgSXRlbS5wcm90b3R5cGUuZGVhY3RpdmF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYWN0aXZlXzEuZGVhY3RpdmF0ZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLnJvb3Qud21sLmlkKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICByZXR1cm4gSXRlbTtcbn0od21sLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5JdGVtID0gSXRlbTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2xpJywgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5yb290LndtbC5pZCB9LCAnaWQnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMucm9vdC5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC52YWx1ZXMucm9vdC5jb250ZW50LnJlbmRlcigpKSkpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aXRlbS5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NZW51ID0gZXhwb3J0cy5IZWFkZXJJdGVtID0gZXhwb3J0cy5DT05URU5UX01PREUgPSBleHBvcnRzLk5BVl9NT0RFID0gZXhwb3J0cy5NRU5VX0hFQURFUl9JVEVNID0gZXhwb3J0cy5NRU5VID0gdm9pZCAwO1xudmFyIGhpZGRlbiA9IHJlcXVpcmUoXCIuLi8uLi9jb250ZW50L3N0YXRlL2hpZGRlblwiKTtcbnZhciBoZWFkZXJWaWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9oZWFkZXJcIik7XG52YXIgd21sXzEgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbFwiKTtcbnZhciBkb21fMSA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG52YXIgdXRpbF8xID0gcmVxdWlyZShcIi4uLy4uL3V0aWxcIik7XG52YXIgb3JpZW50YXRpb25fMSA9IHJlcXVpcmUoXCIuLi8uLi9jb250ZW50L29yaWVudGF0aW9uXCIpO1xudmFyIF9fMSA9IHJlcXVpcmUoXCIuLi8uLi9cIik7XG52YXIgbWVudV8xID0gcmVxdWlyZShcIi4vd21sL21lbnVcIik7XG4vLy9jbGFzc05hbWVzOmJlZ2luXG5leHBvcnRzLk1FTlUgPSAnd3ctbWVudSc7XG5leHBvcnRzLk1FTlVfSEVBREVSX0lURU0gPSAnd3ctbWVudV9faGVhZGVyLWl0ZW0nO1xuLy8vY2xhc3NOYW1lczplbmRcbmV4cG9ydHMuTkFWX01PREUgPSAnbmF2JztcbmV4cG9ydHMuQ09OVEVOVF9NT0RFID0gJ2NvbnRlbnQnO1xuLyoqXG4gKiBIZWFkZXJJdGVtXG4gKi9cbnZhciBIZWFkZXJJdGVtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhIZWFkZXJJdGVtLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIEhlYWRlckl0ZW0oKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52aWV3ID0gbmV3IGhlYWRlclZpZXdzLk1haW4oX3RoaXMpO1xuICAgICAgICBfdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICByb290OiB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuTUVOVV9IRUFERVJfSVRFTSwgX18xLmdldENsYXNzTmFtZShfdGhpcy5hdHRycykpLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy50ZXh0KSA/XG4gICAgICAgICAgICAgICAgICAgIFtkb21fMS50ZXh0KF90aGlzLmF0dHJzLnd3LnRleHQpXSA6IF90aGlzLmNoaWxkcmVuXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIEhlYWRlckl0ZW07XG59KHdtbF8xLkNvbXBvbmVudCkpO1xuZXhwb3J0cy5IZWFkZXJJdGVtID0gSGVhZGVySXRlbTtcbi8qKlxuICogTWVudSBwcm92aWRlcyBhIERPTSBjb250YWluZXIgZm9yIHJlbmRlcmluZ1xuICogYSBkcm9wZG93biBzdHlsZSBtZW51LlxuICovXG52YXIgTWVudSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTWVudSwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBNZW51KCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyBtZW51XzEuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHJvb3Q6IHtcbiAgICAgICAgICAgICAgICB3bWw6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6ICdyb290J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaWQ6IF9fMS5nZXRJZChfdGhpcy5hdHRycyksXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsXzEuY29uY2F0KGV4cG9ydHMuTUVOVSwgX18xLmdldENsYXNzTmFtZShfdGhpcy5hdHRycyksIChfdGhpcy5hdHRycy53dyAmJiBfdGhpcy5hdHRycy53dy5oaWRkZW4pID8gaGlkZGVuLkhJRERFTiA6ICcnLCAoX3RoaXMuYXR0cnMud3cgJiYgX3RoaXMuYXR0cnMud3cuYmxvY2spID8gb3JpZW50YXRpb25fMS5CTE9DSyA6ICcnKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1lbnU6IHtcbiAgICAgICAgICAgICAgICBpZDogJ21lbnUnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udGVudDogZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuY2hpbGRyZW47IH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBNZW51LnByb3RvdHlwZS5pc0hpZGRlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGhpZGRlbi5pc0hpZGRlbih0aGlzLnZpZXcsIHRoaXMudmFsdWVzLnJvb3Qud21sLmlkKTtcbiAgICB9O1xuICAgIE1lbnUucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGhpZGRlbi5oaWRlKHRoaXMudmlldywgdGhpcy52YWx1ZXMucm9vdC53bWwuaWQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIE1lbnUucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGhpZGRlbi5zaG93KHRoaXMudmlldywgdGhpcy52YWx1ZXMucm9vdC53bWwuaWQpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIE1lbnUucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaGlkZGVuLnRvZ2dsZSh0aGlzLnZpZXcsIHRoaXMudmFsdWVzLnJvb3Qud21sLmlkKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBNZW51LnByb3RvdHlwZS5zZXRDb250ZW50ID0gZnVuY3Rpb24gKGNvbnRlbnQpIHtcbiAgICAgICAgdGhpcy52YWx1ZXMuY29udGVudCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNvbnRlbnQ7IH07XG4gICAgICAgIHRoaXMudmlldy5pbnZhbGlkYXRlKCk7XG4gICAgICAgIHRoaXMuc2hvdygpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIHJldHVybiBNZW51O1xufSh3bWxfMS5Db21wb25lbnQpKTtcbmV4cG9ydHMuTWVudSA9IE1lbnU7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy5ub2RlKCdsaScsIHsgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5yb290LmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LnZhbHVlcy5yb290LmNvbnRlbnQpKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1oZWFkZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheXMgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXlzKSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcbiAgICAgICAgICAgIHJba10gPSBhW2pdO1xuICAgIHJldHVybiByO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMubm9kZSgndWwnLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLnJvb3Qud21sLmlkIH0sICdpZCc6IF9fY29udGV4dC52YWx1ZXMucm9vdC5pZCwgJ2NsYXNzJzogX19jb250ZXh0LnZhbHVlcy5yb290LmNsYXNzTmFtZSB9LCBfX3NwcmVhZEFycmF5cygoX19jb250ZXh0LnZhbHVlcy5jb250ZW50KCkpKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tZW51LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk5hdiA9IGV4cG9ydHMuTkFWID0gdm9pZCAwO1xudmFyIHdtbCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sXCIpO1xudmFyIHV0aWwgPSByZXF1aXJlKFwiLi4vLi4vdXRpbFwiKTtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9uYXZcIik7XG52YXIgb3JpZW50YXRpb25fMSA9IHJlcXVpcmUoXCIuLi8uLi9jb250ZW50L29yaWVudGF0aW9uXCIpO1xudmFyIGl0ZW1fMSA9IHJlcXVpcmUoXCIuLi9pdGVtXCIpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiSXRlbVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gaXRlbV8xLkl0ZW07IH0gfSk7XG52YXIgbGlua18xID0gcmVxdWlyZShcIi4uLy4uL2NvbnRlbnQvbGlua1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIkxpbmtcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGxpbmtfMS5MaW5rOyB9IH0pO1xuLy8vY2xhc3NOYW1lczpiZWdpblxuLyoqXG4gKiBOQVZcbiAqL1xuZXhwb3J0cy5OQVYgPSAnd3ctbmF2Jztcbi8qKlxuICogTmF2IHByb3ZpZGVzIHN0eWxpbmcgZm9yIGRpc3BsYXlpbmcgYSBsaXN0IG9mIGFuY2hvciBsaW5rcy5cbiAqL1xudmFyIE5hdiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTmF2LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIE5hdigpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbihfdGhpcyk7XG4gICAgICAgIF90aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHJvb3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmlkKSA/IF90aGlzLmF0dHJzLnd3LmlkIDogJycsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB1dGlsLmNvbmNhdChleHBvcnRzLk5BViwgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LmNsYXNzTmFtZSkgP1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hdHRycy53dy5jbGFzc05hbWUgOiAnJywgKF90aGlzLmF0dHJzLnd3ICYmIF90aGlzLmF0dHJzLnd3LnZlcnRpY2FsKSA/XG4gICAgICAgICAgICAgICAgICAgIG9yaWVudGF0aW9uXzEuVkVSVElDQUwgOiAnJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gTmF2O1xufSh3bWwuQ29tcG9uZW50KSk7XG5leHBvcnRzLk5hdiA9IE5hdjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ3VsJywgeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuaWQsICdjbGFzcyc6IF9fY29udGV4dC52YWx1ZXMucm9vdC5jbGFzc05hbWUgfSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jaGlsZHJlbikpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW5hdi5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbi8qKlxuICogVGhpcyBtb2R1bGUgcHJvdmlkZXMgdXRpbGl0eSBmdW5jdGlvbnMgYW5kIGNvbnN0YW50cyB1c2VkXG4gKiB0aHJvdWdoIG91dCB0aGUgd21sLXdpZGdldHMgbW9kdWxlLlxuICovXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmRlYm91bmNlID0gZXhwb3J0cy5yZXBsYWNlQ29udGVudCA9IGV4cG9ydHMubm9vcCA9IGV4cG9ydHMuY29uY2F0ID0gZXhwb3J0cy5jb21iaW5lID0gZXhwb3J0cy53YXJuTWlzc2luZyA9IGV4cG9ydHMuZ2V0QnlJZCA9IHZvaWQgMDtcbi8qKlxuICogZ2V0QnlJZCByZXRyZWl2ZXMgYW4gV01MRWxlbWVudCBmcm9tIGEgdmlldyBieSBpdHMgaWQuXG4gKlxuICogSWYgdGhlIFdNTEVsZW1lbnQgaXMgbm90IGZvdW5kIGEgd2FybmluZyBpcyBsb2dnZWQgdG8gY29uc29sZS5cbiAqL1xuZXhwb3J0cy5nZXRCeUlkID0gZnVuY3Rpb24gKHZpZXcsIGlkKSB7XG4gICAgdmFyIG0gPSB2aWV3LmZpbmRCeUlkKGlkKTtcbiAgICBpZiAobS5pc05vdGhpbmcoKSkge1xuICAgICAgICBleHBvcnRzLndhcm5NaXNzaW5nKHZpZXcsIGlkKTtcbiAgICB9XG4gICAgcmV0dXJuIG07XG59O1xuLyoqXG4gKiB3YXJuIHZpYSBjb25zb2xlIHRoYXQgYW4gZWxlbWVudCBpcyBtaXNzaW5nLlxuICovXG5leHBvcnRzLndhcm5NaXNzaW5nID0gZnVuY3Rpb24gKHZpZXcsIGlkKSB7XG4gICAgY29uc29sZS53YXJuKCdUaGUgdmlldyAnLCB2aWV3LCBcIiBkb2VzIG5vdCBoYXZlIGFuIGlkIFxcXCJcIiArIGlkICsgXCJcXFwiIVwiKTtcbn07XG4vKipcbiAqIGNvbWJpbmUgdGhlIG1lbWJlcnMgb2YgYW4gYXJyYXkgaW50byBvbmUgc3RyaW5nLlxuICovXG5leHBvcnRzLmNvbWJpbmUgPSBmdW5jdGlvbiAoc3RyLCBqb2luZXIpIHtcbiAgICBpZiAoam9pbmVyID09PSB2b2lkIDApIHsgam9pbmVyID0gJyAnOyB9XG4gICAgcmV0dXJuIHN0ci5maWx0ZXIoZnVuY3Rpb24gKHMpIHsgcmV0dXJuICgocyAhPSBudWxsKSB8fCBzICE9ICcnKTsgfSkuam9pbihqb2luZXIpO1xufTtcbi8qKlxuICogY29uY2F0IGpvaW5zIHZhcmlvdXMgc3RyaW5ncyB0b2dldGhlciB0byBmb3JtIGFuIGh0bWwgY2xhc3MgYXR0cmlidXRlIHZhbHVlLlxuICpcbiAqIFJlbW92ZXMgZW1wdHkgc3RyaW5ncywgbnVsbCBhbmQgdW5kZWZpbmVkIHZhbHVlcy5cbiAqL1xuZXhwb3J0cy5jb25jYXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHN0ciA9IFtdO1xuICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgIHN0cltfaV0gPSBhcmd1bWVudHNbX2ldO1xuICAgIH1cbiAgICByZXR1cm4gc3RyLmZpbHRlcihmdW5jdGlvbiAocykgeyByZXR1cm4gKChzID09IG51bGwpIHx8IChzID09ICcnKSkgPyBmYWxzZSA6IHRydWU7IH0pXG4gICAgICAgIC5tYXAoZnVuY3Rpb24gKHMpIHsgcmV0dXJuIHMudHJpbSgpOyB9KS5qb2luKCcgJyk7XG59O1xuLyoqXG4gKiBub29wXG4gKi9cbmV4cG9ydHMubm9vcCA9IGZ1bmN0aW9uICgpIHsgfTtcbi8qKlxuICogcmVwbGFjZUNvbnRlbnRcbiAqL1xuZXhwb3J0cy5yZXBsYWNlQ29udGVudCA9IGZ1bmN0aW9uIChyLCBub2RlKSB7XG4gICAgd2hpbGUgKG5vZGUubGFzdENoaWxkKVxuICAgICAgICBub2RlLnJlbW92ZUNoaWxkKG5vZGUubGFzdENoaWxkKTtcbiAgICBub2RlLmFwcGVuZENoaWxkKHIucmVuZGVyKCkpO1xufTtcbi8qKlxuICogZGVib3VuY2UgYSBmdW5jdGlvbiBzbyB0aGF0IGl0IGlzIG9ubHkgY2FsbGVkIG9uY2UgYWZ0ZXJcbiAqIGEgcGVyaW9kIG9mIHRpbWUuXG4gKi9cbmV4cG9ydHMuZGVib3VuY2UgPSBmdW5jdGlvbiAoZiwgZGVsYXkpIHtcbiAgICB2YXIgdGltZXIgPSAtMTtcbiAgICByZXR1cm4gZGVsYXkgPT09IDAgPyBmIDogZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgaWYgKHRpbWVyID09PSAtMSkge1xuICAgICAgICAgICAgdGltZXIgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBmKGEpOyB9LCBkZWxheSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgICAgICAgdGltZXIgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBmKGEpOyB9LCBkZWxheSk7XG4gICAgICAgIH1cbiAgICB9O1xufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXV0aWwuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnRocm90dGxlID0gZXhwb3J0cy5kZWJvdW5jZSA9IGV4cG9ydHMudGljayA9IHZvaWQgMDtcbi8qKlxuICogdGljayBydW5zIGEgZnVuY3Rpb24gaW4gdGhlIFwibmV4dCB0aWNrXCIgdXNpbmcgcHJvY2Vzcy5uZXh0VGljayBpbiBub2RlXG4gKiBvciBzZXRUaW1lb3V0KGYsIDApIGVsc2V3aGVyZS5cbiAqL1xudmFyIHRpY2sgPSBmdW5jdGlvbiAoZikgeyByZXR1cm4gKHR5cGVvZiB3aW5kb3cgPT0gJ3VuZGVmaW5lZCcpID9cbiAgICBzZXRUaW1lb3V0KGYsIDApIDpcbiAgICBwcm9jZXNzLm5leHRUaWNrKGYpOyB9O1xuZXhwb3J0cy50aWNrID0gdGljaztcbi8qKlxuICogZGVib3VuY2UgZGVsYXlzIHRoZSBhcHBsaWNhdGlvbiBvZiBhIGZ1bmN0aW9uIHVudGlsIHRoZSBzcGVjaWZpZWQgdGltZVxuICogaGFzIHBhc3NlZC5cbiAqXG4gKiBJZiBtdWx0aXBsZSBhdHRlbXB0cyB0byBhcHBseSB0aGUgZnVuY3Rpb24gaGF2ZSBvY2N1cmVkLCB0aGVuIGVhY2ggYXR0ZW1wdFxuICogd2lsbCByZXN0YXJ0IHRoZSBkZWxheSBwcm9jZXNzLiBUaGUgZnVuY3Rpb24gd2lsbCBvbmx5IGV2ZXIgYmUgYXBwbGllZCBvbmNlXG4gKiBhZnRlciB0aGUgZGVsYXksIHVzaW5nIHRoZSB2YWx1ZSBvZiB0aGUgZmluYWwgYXR0ZW1wdCBmb3IgYXBwbGljYXRpb24uXG4gKi9cbnZhciBkZWJvdW5jZSA9IGZ1bmN0aW9uIChmLCBkZWxheSkge1xuICAgIHZhciBpZCA9IC0xO1xuICAgIHJldHVybiBmdW5jdGlvbiAoYSkge1xuICAgICAgICBpZiAoaWQgPT09IC0xKSB7XG4gICAgICAgICAgICBpZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gZihhKTsgfSwgZGVsYXkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGlkKTtcbiAgICAgICAgICAgIGlkID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBmKGEpOyB9LCBkZWxheSk7XG4gICAgICAgIH1cbiAgICB9O1xufTtcbmV4cG9ydHMuZGVib3VuY2UgPSBkZWJvdW5jZTtcbi8qKlxuICogdGhyb3R0bGUgbGltaXRzIHRoZSBhcHBsaWNhdGlvbiBvZiBhIGZ1bmN0aW9uIHRvIG9jY3VyIG9ubHkgb25lIHdpdGhpbiB0aGVcbiAqIHNwZWNpZmllZCBkdXJhdGlvbi5cbiAqXG4gKiBUaGUgZmlyc3QgYXBwbGljYXRpb24gd2lsbCBleGVjdXRlIGltbWVkaWF0ZWx5IHN1YnNlcXVlbnQgYXBwbGljYXRpb25zXG4gKiB3aWxsIGJlIGlnbm9yZWQgdW50aWwgdGhlIGR1cmF0aW9uIGhhcyBwYXNzZWQuXG4gKi9cbnZhciB0aHJvdHRsZSA9IGZ1bmN0aW9uIChmLCBkdXJhdGlvbikge1xuICAgIHZhciB3YWl0ID0gZmFsc2U7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChhKSB7XG4gICAgICAgIGlmICh3YWl0ID09PSBmYWxzZSkge1xuICAgICAgICAgICAgZihhKTtcbiAgICAgICAgICAgIHdhaXQgPSB0cnVlO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiB3YWl0ID0gZmFsc2U7IH0sIGR1cmF0aW9uKTtcbiAgICAgICAgfVxuICAgIH07XG59O1xuZXhwb3J0cy50aHJvdHRsZSA9IHRocm90dGxlO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dGltZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheSA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheSkgfHwgZnVuY3Rpb24gKHRvLCBmcm9tLCBwYWNrKSB7XG4gICAgaWYgKHBhY2sgfHwgYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgZm9yICh2YXIgaSA9IDAsIGwgPSBmcm9tLmxlbmd0aCwgYXI7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgaWYgKGFyIHx8ICEoaSBpbiBmcm9tKSkge1xuICAgICAgICAgICAgaWYgKCFhcikgYXIgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tLCAwLCBpKTtcbiAgICAgICAgICAgIGFyW2ldID0gZnJvbVtpXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdG8uY29uY2F0KGFyIHx8IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20pKTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmNvbXBhY3QgPSBleHBvcnRzLmZsYXR0ZW4gPSBleHBvcnRzLmNvbWJpbmUgPSBleHBvcnRzLm1ha2UgPSBleHBvcnRzLnJlbW92ZUF0ID0gZXhwb3J0cy5yZW1vdmUgPSBleHBvcnRzLmRlZHVwZSA9IGV4cG9ydHMuZGlzdHJpYnV0ZSA9IGV4cG9ydHMuZ3JvdXAgPSBleHBvcnRzLnBhcnRpdGlvbiA9IGV4cG9ydHMuY29uY2F0ID0gZXhwb3J0cy5mbGF0TWFwID0gZXhwb3J0cy5tYXAgPSBleHBvcnRzLmNvbnRhaW5zID0gZXhwb3J0cy5lbXB0eSA9IGV4cG9ydHMudGFpbCA9IGV4cG9ydHMuaGVhZCA9IHZvaWQgMDtcbi8qKlxuICogVGhlIGFycmF5IG1vZHVsZSBwcm92aWRlcyBoZWxwZXIgZnVuY3Rpb25zXG4gKiBmb3Igd29ya2luZyB3aXRoIEpTIGFycmF5cy5cbiAqL1xudmFyIHJlY29yZF8xID0gcmVxdWlyZShcIi4uL3JlY29yZFwiKTtcbnZhciBtYXRoXzEgPSByZXF1aXJlKFwiLi4vLi4vbWF0aFwiKTtcbi8qKlxuICogaGVhZCByZXR1cm5zIHRoZSBpdGVtIGF0IGluZGV4IDAgb2YgYW4gYXJyYXlcbiAqL1xudmFyIGhlYWQgPSBmdW5jdGlvbiAobGlzdCkgeyByZXR1cm4gbGlzdFswXTsgfTtcbmV4cG9ydHMuaGVhZCA9IGhlYWQ7XG4vKipcbiAqIHRhaWwgcmV0dXJucyB0aGUgbGFzdCBpdGVtIGluIGFuIGFycmF5XG4gKi9cbnZhciB0YWlsID0gZnVuY3Rpb24gKGxpc3QpIHsgcmV0dXJuIGxpc3RbbGlzdC5sZW5ndGggLSAxXTsgfTtcbmV4cG9ydHMudGFpbCA9IHRhaWw7XG4vKipcbiAqIGVtcHR5IGluZGljYXRlcyB3aGV0aGVyIGFuIGFycmF5IGlzIGVtcHR5IG9yIG5vdC5cbiAqL1xudmFyIGVtcHR5ID0gZnVuY3Rpb24gKGxpc3QpIHsgcmV0dXJuIChsaXN0Lmxlbmd0aCA9PT0gMCk7IH07XG5leHBvcnRzLmVtcHR5ID0gZW1wdHk7XG4vKipcbiAqIGNvbnRhaW5zIGluZGljYXRlcyB3aGV0aGVyIGFuIGVsZW1lbnQgZXhpc3RzIGluIGFuIGFycmF5LlxuICovXG52YXIgY29udGFpbnMgPSBmdW5jdGlvbiAobGlzdCwgYSkgeyByZXR1cm4gKGxpc3QuaW5kZXhPZihhKSA+IC0xKTsgfTtcbmV4cG9ydHMuY29udGFpbnMgPSBjb250YWlucztcbi8qKlxuICogbWFwIGlzIGEgY3VycmllZCB2ZXJzaW9uIG9mIHRoZSBBcnJheSNtYXAgbWV0aG9kLlxuICovXG52YXIgbWFwID0gZnVuY3Rpb24gKGxpc3QpIHsgcmV0dXJuIGZ1bmN0aW9uIChmKSB7IHJldHVybiBsaXN0Lm1hcChmKTsgfTsgfTtcbmV4cG9ydHMubWFwID0gbWFwO1xuLyoqXG4gKiBmbGF0TWFwIGFsbG93cyBhIGZ1bmN0aW9uIHRvIHByb2R1Y2UgYSBjb21iaW5lZCBzZXQgb2YgYXJyYXlzIGZyb20gYSBtYXBcbiAqIG9wZXJhdGlvbiBvdmVyIGVhY2ggbWVtYmVyIG9mIGEgbGlzdC5cbiAqL1xudmFyIGZsYXRNYXAgPSBmdW5jdGlvbiAobGlzdCwgZikge1xuICAgIHJldHVybiBsaXN0LnJlZHVjZShmdW5jdGlvbiAocCwgYywgaSkgeyByZXR1cm4gcC5jb25jYXQoZihjLCBpLCBsaXN0KSk7IH0sIFtdKTtcbn07XG5leHBvcnRzLmZsYXRNYXAgPSBmbGF0TWFwO1xuLyoqXG4gKiBjb25jYXQgY29uY2F0ZW5hdGVzIGVsZW1lbnRzIHRvIHRoZSBlbmQgb2YgYW4gYXJyYXkgd2l0aG91dCBmbGF0dGVuaW5nXG4gKiBpZiBhbnkgb2YgdGhlIGVsZW1lbnRzIGFyZSBhbiBhcnJheS5cbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIGFsc28gaWdub3JlcyBudWxsIGFuZCB1bmRlZmluZWQuXG4gKi9cbnZhciBjb25jYXQgPSBmdW5jdGlvbiAobGlzdCkge1xuICAgIHZhciBpdGVtcyA9IFtdO1xuICAgIGZvciAodmFyIF9pID0gMTsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgIGl0ZW1zW19pIC0gMV0gPSBhcmd1bWVudHNbX2ldO1xuICAgIH1cbiAgICByZXR1cm4gX19zcHJlYWRBcnJheShfX3NwcmVhZEFycmF5KFtdLCBsaXN0LCB0cnVlKSwgaXRlbXMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7IHJldHVybiBpdGVtICE9IG51bGw7IH0pLCB0cnVlKTtcbn07XG5leHBvcnRzLmNvbmNhdCA9IGNvbmNhdDtcbi8qKlxuICogcGFydGl0aW9uIGFuIGFycmF5IGludG8gdHdvIHVzaW5nIGEgcGFydGl0aW9uaW5nIGZ1bmN0aW9uLlxuICpcbiAqIFRoZSBmaXJzdCBhcnJheSBjb250YWlucyB2YWx1ZXMgdGhhdCByZXR1cm4gdHJ1ZSBhbmQgdGhlIHNlY29uZCBmYWxzZS5cbiAqL1xudmFyIHBhcnRpdGlvbiA9IGZ1bmN0aW9uIChsaXN0LCBmKSB7IHJldHVybiAoMCwgZXhwb3J0cy5lbXB0eSkobGlzdCkgP1xuICAgIFtbXSwgW11dIDpcbiAgICBsaXN0LnJlZHVjZShmdW5jdGlvbiAoX2EsIGMsIGkpIHtcbiAgICAgICAgdmFyIHllcyA9IF9hWzBdLCBubyA9IF9hWzFdO1xuICAgICAgICByZXR1cm4gKGYoYywgaSwgbGlzdCkgP1xuICAgICAgICAgICAgWygwLCBleHBvcnRzLmNvbmNhdCkoeWVzLCBjKSwgbm9dIDpcbiAgICAgICAgICAgIFt5ZXMsICgwLCBleHBvcnRzLmNvbmNhdCkobm8sIGMpXSk7XG4gICAgfSwgW1tdLCBbXV0pOyB9O1xuZXhwb3J0cy5wYXJ0aXRpb24gPSBwYXJ0aXRpb247XG4vKipcbiAqIGdyb3VwIHRoZSBlbGVtZW50cyBvZiBhbiBhcnJheSBpbnRvIGEgUmVjb3JkIHdoZXJlIGVhY2ggcHJvcGVydHlcbiAqIGlzIGFuIGFycmF5IG9mIGVsZW1lbnRzIGFzc2lnbmVkIHRvIGl0J3MgcHJvcGVydHkgbmFtZS5cbiAqL1xudmFyIGdyb3VwID0gZnVuY3Rpb24gKGxpc3QsIGYpIHtcbiAgICByZXR1cm4gbGlzdC5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMsIGkpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICB2YXIgZyA9IGYoYywgaSwgbGlzdCk7XG4gICAgICAgIHJldHVybiAoMCwgcmVjb3JkXzEubWVyZ2UpKHAsIChfYSA9IHt9LFxuICAgICAgICAgICAgX2FbZ10gPSBBcnJheS5pc0FycmF5KHBbZ10pID9cbiAgICAgICAgICAgICAgICAoMCwgZXhwb3J0cy5jb25jYXQpKHBbZ10sIGMpIDogW2NdLFxuICAgICAgICAgICAgX2EpKTtcbiAgICB9LCB7fSk7XG59O1xuZXhwb3J0cy5ncm91cCA9IGdyb3VwO1xuLyoqXG4gKiBkaXN0cmlidXRlIGJyZWFrcyBhbiBhcnJheSBpbnRvIGFuIGFycmF5IG9mIGVxdWFsbHkgKGFwcHJveGltYXRlKSBzaXplZFxuICogc21hbGxlciBhcnJheXMuXG4gKi9cbnZhciBkaXN0cmlidXRlID0gZnVuY3Rpb24gKGxpc3QsIHNpemUpIHtcbiAgICB2YXIgciA9IGxpc3QucmVkdWNlKGZ1bmN0aW9uIChwLCBjLCBpKSB7XG4gICAgICAgIHJldHVybiAoMCwgbWF0aF8xLmlzTXVsdGlwbGVPZikoc2l6ZSwgaSArIDEpID9cbiAgICAgICAgICAgIFsoMCwgZXhwb3J0cy5jb25jYXQpKHBbMF0sICgwLCBleHBvcnRzLmNvbmNhdCkocFsxXSwgYykpLCBbXV0gOlxuICAgICAgICAgICAgW3BbMF0sICgwLCBleHBvcnRzLmNvbmNhdCkocFsxXSwgYyldO1xuICAgIH0sIFtbXSwgW11dKTtcbiAgICByZXR1cm4gKHJbMV0ubGVuZ3RoID09PSAwKSA/IHJbMF0gOiAoMCwgZXhwb3J0cy5jb25jYXQpKHJbMF0sIHJbMV0pO1xufTtcbmV4cG9ydHMuZGlzdHJpYnV0ZSA9IGRpc3RyaWJ1dGU7XG4vKipcbiAqIGRlZHVwZSBhbiBhcnJheSBieSBmaWx0ZXJpbmcgb3V0IGVsZW1lbnRzXG4gKiB0aGF0IGFwcGVhciB0d2ljZS5cbiAqL1xudmFyIGRlZHVwZSA9IGZ1bmN0aW9uIChsaXN0KSB7XG4gICAgcmV0dXJuIGxpc3QuZmlsdGVyKGZ1bmN0aW9uIChlLCBpLCBsKSB7IHJldHVybiBsLmluZGV4T2YoZSkgPT09IGk7IH0pO1xufTtcbmV4cG9ydHMuZGVkdXBlID0gZGVkdXBlO1xuLyoqXG4gKiByZW1vdmUgYW4gZWxlbWVudCBmcm9tIGFuIGFycmF5IHJldHVybmluZyBhIG5ldyBjb3B5IHdpdGggdGhlIGVsZW1lbnRcbiAqIHJlbW92ZWQuXG4gKi9cbnZhciByZW1vdmUgPSBmdW5jdGlvbiAobGlzdCwgdGFyZ2V0KSB7XG4gICAgdmFyIGlkeCA9IGxpc3QuaW5kZXhPZih0YXJnZXQpO1xuICAgIGlmIChpZHggPT09IC0xKSB7XG4gICAgICAgIHJldHVybiBsaXN0LnNsaWNlKCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB2YXIgYSA9IGxpc3Quc2xpY2UoKTtcbiAgICAgICAgYS5zcGxpY2UoaWR4LCAxKTtcbiAgICAgICAgcmV0dXJuIGE7XG4gICAgfVxufTtcbmV4cG9ydHMucmVtb3ZlID0gcmVtb3ZlO1xuLyoqXG4gKiByZW1vdmVBdCByZW1vdmVzIGFuIGVsZW1lbnQgYXQgdGhlIHNwZWNpZmllZCBpbmRleCByZXR1cm5pbmcgYSBjb3B5XG4gKiBvZiB0aGUgb3JpZ2luYWwgYXJyYXkgd2l0aCB0aGUgZWxlbWVudCByZW1vdmVkLlxuICovXG52YXIgcmVtb3ZlQXQgPSBmdW5jdGlvbiAobGlzdCwgaWR4KSB7XG4gICAgaWYgKChsaXN0Lmxlbmd0aCA+IGlkeCkgJiYgKGlkeCA+IC0xKSkge1xuICAgICAgICB2YXIgYSA9IGxpc3Quc2xpY2UoKTtcbiAgICAgICAgYS5zcGxpY2UoaWR4LCAxKTtcbiAgICAgICAgcmV0dXJuIGE7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gbGlzdC5zbGljZSgpO1xuICAgIH1cbn07XG5leHBvcnRzLnJlbW92ZUF0ID0gcmVtb3ZlQXQ7XG4vKipcbiAqIG1ha2UgYW4gYXJyYXkgb2YgZWxlbWVudHMgb2YgYSBnaXZlbiBzaXplIHVzaW5nIGEgZnVuY3Rpb24gdG8gcHJvdmlkZVxuICogZWFjaCBlbGVtZW50LlxuICpcbiAqIFRoZSBmdW5jdGlvbiByZWNlaXZlcyB0aGUgaW5kZXggbnVtYmVyIGZvciBlYWNoIHN0ZXAuXG4gKi9cbnZhciBtYWtlID0gZnVuY3Rpb24gKHNpemUsIGYpIHtcbiAgICB2YXIgYSA9IG5ldyBBcnJheShzaXplKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKylcbiAgICAgICAgYVtpXSA9IGYoaSk7XG4gICAgcmV0dXJuIGE7XG59O1xuZXhwb3J0cy5tYWtlID0gbWFrZTtcbi8qKlxuICogY29tYmluZSBhIGxpc3Qgb2Ygb2YgbGlzdHMgaW50byBvbmUgbGlzdC5cbiAqL1xudmFyIGNvbWJpbmUgPSBmdW5jdGlvbiAobGlzdCkge1xuICAgIHJldHVybiBsaXN0LnJlZHVjZShmdW5jdGlvbiAocCwgYykgeyByZXR1cm4gcC5jb25jYXQoYyk7IH0sIFtdKTtcbn07XG5leHBvcnRzLmNvbWJpbmUgPSBjb21iaW5lO1xuLyoqXG4gKiBmbGF0dGVuIGEgbGlzdCBvZiBpdGVtcyB0aGF0IG1heSBiZSBtdWx0aS1kaW1lbnNpb25hbC5cbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIG1heSBub3QgYmUgc3RhY2sgc2FmZS5cbiAqL1xudmFyIGZsYXR0ZW4gPSBmdW5jdGlvbiAobGlzdCkge1xuICAgIHJldHVybiBsaXN0LnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICByZXR1cm4gcC5jb25jYXQoQXJyYXkuaXNBcnJheShjKSA/ICgwLCBleHBvcnRzLmZsYXR0ZW4pKGMpIDogYyk7XG4gICAgfSwgW10pO1xufTtcbmV4cG9ydHMuZmxhdHRlbiA9IGZsYXR0ZW47XG4vKipcbiAqIGNvbXBhY3QgcmVtb3ZlcyBhbnkgb2NjdXJlbmNlcyBvZiBudWxsIG9yIHVuZGVmaW5lZCBpbiB0aGUgbGlzdC5cbiAqL1xudmFyIGNvbXBhY3QgPSBmdW5jdGlvbiAobGlzdCkge1xuICAgIHJldHVybiBsaXN0LmZpbHRlcihmdW5jdGlvbiAodikgeyByZXR1cm4gKHYgIT0gbnVsbCk7IH0pO1xufTtcbmV4cG9ydHMuY29tcGFjdCA9IGNvbXBhY3Q7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbi8qKlxuICogVXNlZnVsIGZ1bmN0aW9ucyBmb3Igc29ydGluZyBkYXRhIGluIGFuIGFycmF5LlxuICpcbiAqIFRoZSBmdW5jdGlvbnMgYXJlIGV4cGVjdGVkIHRvIGJlIHBhc3NlZCB0byBBcnJheSNzb3J0LlxuICogRGVmYXVsdHMgdG8gYXNjZW5kaW5nIG9yZGVyIHVubGVzcyBzcGVjaWZpZWQgb3RoZXJ3aXNlLlxuICovXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLm5hdHVyYWwgPSBleHBvcnRzLm51bWJlciA9IGV4cG9ydHMuc3RyaW5nID0gZXhwb3J0cy5kYXRlID0gdm9pZCAwO1xuLyoqXG4gKiBkYXRlIHNvcnRzIHR3byBzdHJpbmdzIHJlcHJlc2VudGluZyBkYXRlcy5cbiAqXG4gKiBUaGUgZGF0ZXMgYXJlIHBhc3NlZCB0byB0aGUgZGF0ZSBjb25zdHJ1Y3Rvci5cbiAqL1xudmFyIGRhdGUgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIHZhciBuYSA9IG5ldyBEYXRlKGEpLmdldFRpbWUoKTtcbiAgICB2YXIgbmIgPSBuZXcgRGF0ZShiKS5nZXRUaW1lKCk7XG4gICAgcmV0dXJuIG5hID4gbmIgPyAtMSA6IG5hIDwgbmIgPyAxIDogMDtcbn07XG5leHBvcnRzLmRhdGUgPSBkYXRlO1xuLyoqXG4gKiBzdHJpbmcgc29ydHMgdHdvIHN0cmluZ3MgYnkgZmlyc3QgbG93ZXIgY2FzaW5nIHRoZW0uXG4gKi9cbnZhciBzdHJpbmcgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIHZhciBsYSA9IFN0cmluZyhhKS5yZXBsYWNlKC9cXHMrLywgJycpLnRvTG93ZXJDYXNlKCk7XG4gICAgdmFyIGxiID0gU3RyaW5nKGIpLnJlcGxhY2UoL1xccysvLCAnJykudG9Mb3dlckNhc2UoKTtcbiAgICByZXR1cm4gKGxhID4gbGIpID8gLTEgOiAobGEgPCBsYikgPyAxIDogMDtcbn07XG5leHBvcnRzLnN0cmluZyA9IHN0cmluZztcbi8qKlxuICogbnVtYmVyIHNvcnRcbiAqL1xudmFyIG51bWJlciA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgdmFyIG5hID0gcGFyc2VGbG9hdChhKTtcbiAgICB2YXIgbmIgPSBwYXJzZUZsb2F0KGIpO1xuICAgIG5hID0gKGlzTmFOKGEpKSA/IC1JbmZpbml0eSA6IGE7XG4gICAgbmIgPSAoaXNOYU4oYikpID8gLUluZmluaXR5IDogYjtcbiAgICByZXR1cm4gKG5hID4gbmIpID8gLTEgOiAobmEgPCBuYikgPyAxIDogMDtcbn07XG5leHBvcnRzLm51bWJlciA9IG51bWJlcjtcbi8qKlxuICogbmF0dXJhbCBzb3J0IGltcGVsbWVudGF0aW9uLlxuICovXG52YXIgbmF0dXJhbCA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgaWYgKGEgPT09IHZvaWQgMCkgeyBhID0gJyc7IH1cbiAgICBpZiAoYiA9PT0gdm9pZCAwKSB7IGIgPSAnJzsgfVxuICAgIHZhciByZUEgPSAvW15hLXpBLVpdL2c7XG4gICAgdmFyIHJlTiA9IC9bXjAtOV0vZztcbiAgICB2YXIgYUludCA9IHBhcnNlSW50KGEsIDEwKTtcbiAgICB2YXIgYkludCA9IHBhcnNlSW50KGIsIDEwKTtcbiAgICBpZiAoaXNOYU4oYUludCkgJiYgaXNOYU4oYkludCkpIHtcbiAgICAgICAgdmFyIGFBID0gU3RyaW5nKGEpLnJlcGxhY2UocmVBLCAnJyk7XG4gICAgICAgIHZhciBiQSA9IFN0cmluZyhiKS5yZXBsYWNlKHJlQSwgJycpO1xuICAgICAgICBpZiAoYUEgPT09IGJBKSB7XG4gICAgICAgICAgICB2YXIgYU4gPSBwYXJzZUludChTdHJpbmcoYSkucmVwbGFjZShyZU4sICcnKSwgMTApO1xuICAgICAgICAgICAgdmFyIGJOID0gcGFyc2VJbnQoU3RyaW5nKGIpLnJlcGxhY2UocmVOLCAnJyksIDEwKTtcbiAgICAgICAgICAgIHJldHVybiBhTiA9PT0gYk4gPyAwIDogYU4gPiBiTiA/IC0xIDogMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBhQSA+IGJBID8gLTEgOiAxO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKGlzTmFOKGFJbnQpKSB7IC8vQSBpcyBub3QgYW4gSW50XG4gICAgICAgIHJldHVybiAtMTsgLy90byBtYWtlIGFscGhhbnVtZXJpYyBzb3J0IGZpcnN0IHJldHVybiAtMSBoZXJlXG4gICAgfVxuICAgIGVsc2UgaWYgKGlzTmFOKGJJbnQpKSB7IC8vQiBpcyBub3QgYW4gSW50XG4gICAgICAgIHJldHVybiAxOyAvL3RvIG1ha2UgYWxwaGFudW1lcmljIHNvcnQgZmlyc3QgcmV0dXJuIDEgaGVyZVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGFJbnQgPiBiSW50ID8gLTEgOiAxO1xuICAgIH1cbn07XG5leHBvcnRzLm5hdHVyYWwgPSBuYXR1cmFsO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c29ydC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZnJvbU5hTiA9IGV4cG9ydHMuZnJvbU51bWJlciA9IGV4cG9ydHMuZnJvbUJvb2xlYW4gPSBleHBvcnRzLmZyb21TdHJpbmcgPSBleHBvcnRzLmZyb21PYmplY3QgPSBleHBvcnRzLmZyb21BcnJheSA9IGV4cG9ydHMuZnJvbU51bGxhYmxlID0gZXhwb3J0cy5qdXN0ID0gZXhwb3J0cy5ub3RoaW5nID0gZXhwb3J0cy5vZiA9IGV4cG9ydHMuSnVzdCA9IGV4cG9ydHMuTm90aGluZyA9IHZvaWQgMDtcbi8qKlxuICogTm90aGluZyByZXByZXNlbnRzIHRoZSBhYnNlbmNlIG9mIGEgdXNhYmxlIHZhbHVlLlxuICovXG52YXIgTm90aGluZyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBOb3RoaW5nKCkge1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBtYXAgc2ltcGx5IHJldHVybnMgYSBOb3RoaW5nPEE+XG4gICAgICovXG4gICAgTm90aGluZy5wcm90b3R5cGUubWFwID0gZnVuY3Rpb24gKF8pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBOb3RoaW5nKCk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBhcCBhbGxvd3MgZm9yIGEgZnVuY3Rpb24gd3JhcHBlZCBpbiBhIEp1c3QgdG8gYXBwbHlcbiAgICAgKiB0byB2YWx1ZSBwcmVzZW50IGluIHRoaXMgSnVzdC5cbiAgICAgKi9cbiAgICBOb3RoaW5nLnByb3RvdHlwZS5hcCA9IGZ1bmN0aW9uIChfKSB7XG4gICAgICAgIHJldHVybiBuZXcgTm90aGluZygpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogb2Ygd3JhcHMgYSB2YWx1ZSBpbiBhIEp1c3QuXG4gICAgICovXG4gICAgTm90aGluZy5wcm90b3R5cGUub2YgPSBmdW5jdGlvbiAoYSkge1xuICAgICAgICByZXR1cm4gbmV3IEp1c3QoYSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBjaGFpbiBzaW1wbHkgcmV0dXJucyBhIE5vdGhpbmc8QT4uXG4gICAgICovXG4gICAgTm90aGluZy5wcm90b3R5cGUuY2hhaW4gPSBmdW5jdGlvbiAoXykge1xuICAgICAgICByZXR1cm4gbmV3IE5vdGhpbmcoKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGFsdCB3aWxsIHByZWZlciB3aGF0ZXZlciBNYXliZSBpbnN0YW5jZSBwcm92aWRlZC5cbiAgICAgKi9cbiAgICBOb3RoaW5nLnByb3RvdHlwZS5hbHQgPSBmdW5jdGlvbiAoYSkge1xuICAgICAgICByZXR1cm4gYTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGVtcHR5IHByb3ZpZGVzIGEgZGVmYXVsdCBNYXliZS5cbiAgICAgKiBNYXliZS5lbXB0eSgpID0gbmV3IE5vdGhpbmcoKVxuICAgICAqL1xuICAgIE5vdGhpbmcucHJvdG90eXBlLmVtcHR5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbmV3IE5vdGhpbmcoKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGV4dGVuZCByZXR1cm5zIGEgTm90aGluZzxBPi5cbiAgICAgKi9cbiAgICBOb3RoaW5nLnByb3RvdHlwZS5leHRlbmQgPSBmdW5jdGlvbiAoXykge1xuICAgICAgICByZXR1cm4gbmV3IE5vdGhpbmcoKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGVxIHJldHVybnMgdHJ1ZSBpZiBjb21wYXJlZCB0byBhbm90aGVyIE5vdGhpbmcgaW5zdGFuY2UuXG4gICAgICovXG4gICAgTm90aGluZy5wcm90b3R5cGUuZXEgPSBmdW5jdGlvbiAobSkge1xuICAgICAgICByZXR1cm4gbSBpbnN0YW5jZW9mIE5vdGhpbmc7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBvckp1c3QgY29udmVydHMgYSBOb3RoaW5nPEE+IHRvIGEgSnVzdFxuICAgICAqIHVzaW5nIHRoZSB2YWx1ZSBmcm9tIHRoZSBwcm92aWRlZCBmdW5jdGlvbi5cbiAgICAgKi9cbiAgICBOb3RoaW5nLnByb3RvdHlwZS5vckp1c3QgPSBmdW5jdGlvbiAoZikge1xuICAgICAgICByZXR1cm4gbmV3IEp1c3QoZigpKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIG9yRWxzZSBhbGxvd3MgYW4gYWx0ZXJuYXRpdmUgTWF5YmUgdmFsdWVcbiAgICAgKiB0byBiZSBwcm92aWRlZCBzaW5jZSB0aGlzIG9uZSBpcyBOb3RoaW5nPEE+LlxuICAgICAqL1xuICAgIE5vdGhpbmcucHJvdG90eXBlLm9yRWxzZSA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgIHJldHVybiBmKCk7XG4gICAgfTtcbiAgICBOb3RoaW5nLnByb3RvdHlwZS5pc05vdGhpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG4gICAgTm90aGluZy5wcm90b3R5cGUuaXNKdXN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBnZXQgdGhyb3dzIGFuIGVycm9yIGJlY2F1c2UgdGhlcmVcbiAgICAgKiBpcyBub3RoaW5nIGhlcmUgdG8gZ2V0LlxuICAgICAqL1xuICAgIE5vdGhpbmcucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGdldCBhIHZhbHVlIGZyb20gTm90aGluZyEnKTtcbiAgICB9O1xuICAgIHJldHVybiBOb3RoaW5nO1xufSgpKTtcbmV4cG9ydHMuTm90aGluZyA9IE5vdGhpbmc7XG4vKipcbiAqIEp1c3QgcmVwcmVzZW50cyB0aGUgcHJlc2VuY2Ugb2YgYSB1c2FibGUgdmFsdWUuXG4gKi9cbnZhciBKdXN0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEp1c3QodmFsdWUpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBtYXAgb3ZlciB0aGUgdmFsdWUgcHJlc2VudCBpbiB0aGUgSnVzdC5cbiAgICAgKi9cbiAgICBKdXN0LnByb3RvdHlwZS5tYXAgPSBmdW5jdGlvbiAoZikge1xuICAgICAgICByZXR1cm4gbmV3IEp1c3QoZih0aGlzLnZhbHVlKSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBhcCBhbGxvd3MgZm9yIGEgZnVuY3Rpb24gd3JhcHBlZCBpbiBhIEp1c3QgdG8gYXBwbHlcbiAgICAgKiB0byB2YWx1ZSBwcmVzZW50IGluIHRoaXMgSnVzdC5cbiAgICAgKi9cbiAgICBKdXN0LnByb3RvdHlwZS5hcCA9IGZ1bmN0aW9uIChtYikge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICByZXR1cm4gbWIubWFwKGZ1bmN0aW9uIChmKSB7IHJldHVybiBmKF90aGlzLnZhbHVlKTsgfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBvZiB3cmFwcyBhIHZhbHVlIGluIGEgSnVzdC5cbiAgICAgKi9cbiAgICBKdXN0LnByb3RvdHlwZS5vZiA9IGZ1bmN0aW9uIChhKSB7XG4gICAgICAgIHJldHVybiBuZXcgSnVzdChhKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGNoYWluIGFsbG93cyB0aGUgc2VxdWVuY2luZyBvZiBmdW5jdGlvbnMgdGhhdCByZXR1cm4gYSBNYXliZS5cbiAgICAgKi9cbiAgICBKdXN0LnByb3RvdHlwZS5jaGFpbiA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICAgIHJldHVybiBmKHRoaXMudmFsdWUpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogYWx0IHdpbGwgcHJlZmVyIHRoZSBmaXJzdCBKdXN0IGVuY291bnRlcmVkICh0aGlzKS5cbiAgICAgKi9cbiAgICBKdXN0LnByb3RvdHlwZS5hbHQgPSBmdW5jdGlvbiAoXykge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGVtcHR5IHByb3ZpZGVzIGEgZGVmYXVsdCBNYXliZS5cbiAgICAgKiBNYXliZS5lbXB0eSgpID0gbmV3IE5vdGhpbmcoKVxuICAgICAqL1xuICAgIEp1c3QucHJvdG90eXBlLmVtcHR5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbmV3IE5vdGhpbmcoKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGV4dGVuZCBhbGxvd3Mgc2VxdWVuY2luZyBvZiBNYXliZXMgd2l0aFxuICAgICAqIGZ1bmN0aW9ucyB0aGF0IHVud3JhcCBpbnRvIG5vbiBNYXliZSB0eXBlcy5cbiAgICAgKi9cbiAgICBKdXN0LnByb3RvdHlwZS5leHRlbmQgPSBmdW5jdGlvbiAoZikge1xuICAgICAgICByZXR1cm4gbmV3IEp1c3QoZih0aGlzKSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBlcSB0ZXN0cyB0aGUgdmFsdWUgb2YgdHdvIEp1c3RzLlxuICAgICAqL1xuICAgIEp1c3QucHJvdG90eXBlLmVxID0gZnVuY3Rpb24gKG0pIHtcbiAgICAgICAgcmV0dXJuICgobSBpbnN0YW5jZW9mIEp1c3QpICYmIChtLnZhbHVlID09PSB0aGlzLnZhbHVlKSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBvckp1c3QgcmV0dXJucyB0aGlzIEp1c3QuXG4gICAgICovXG4gICAgSnVzdC5wcm90b3R5cGUub3JKdXN0ID0gZnVuY3Rpb24gKF8pIHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBvckVsc2UgcmV0dXJucyB0aGlzIEp1c3RcbiAgICAgKi9cbiAgICBKdXN0LnByb3RvdHlwZS5vckVsc2UgPSBmdW5jdGlvbiAoXykge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIEp1c3QucHJvdG90eXBlLmlzTm90aGluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgSnVzdC5wcm90b3R5cGUuaXNKdXN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGdldCB0aGUgdmFsdWUgb2YgdGhpcyBKdXN0LlxuICAgICAqL1xuICAgIEp1c3QucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWU7XG4gICAgfTtcbiAgICByZXR1cm4gSnVzdDtcbn0oKSk7XG5leHBvcnRzLkp1c3QgPSBKdXN0O1xuLyoqXG4gKiBvZlxuICovXG52YXIgb2YgPSBmdW5jdGlvbiAoYSkgeyByZXR1cm4gbmV3IEp1c3QoYSk7IH07XG5leHBvcnRzLm9mID0gb2Y7XG4vKipcbiAqIG5vdGhpbmcgY29udmVuaWVuY2UgY29uc3RydWN0b3JcbiAqL1xudmFyIG5vdGhpbmcgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBuZXcgTm90aGluZygpOyB9O1xuZXhwb3J0cy5ub3RoaW5nID0gbm90aGluZztcbi8qKlxuICoganVzdCBjb252ZW5pZW5jZSBjb25zdHJ1Y3RvclxuICovXG52YXIganVzdCA9IGZ1bmN0aW9uIChhKSB7IHJldHVybiBuZXcgSnVzdChhKTsgfTtcbmV4cG9ydHMuanVzdCA9IGp1c3Q7XG4vKipcbiAqIGZyb21OdWxsYWJsZSBjb25zdHJ1Y3RzIGEgTWF5YmUgZnJvbSBhIHZhbHVlIHRoYXQgbWF5IGJlIG51bGwuXG4gKi9cbnZhciBmcm9tTnVsbGFibGUgPSBmdW5jdGlvbiAoYSkgeyByZXR1cm4gYSA9PSBudWxsID9cbiAgICBuZXcgTm90aGluZygpIDogbmV3IEp1c3QoYSk7IH07XG5leHBvcnRzLmZyb21OdWxsYWJsZSA9IGZyb21OdWxsYWJsZTtcbi8qKlxuICogZnJvbUFycmF5IGNoZWNrcyBhbiBhcnJheSB0byBzZWUgaWYgaXQncyBlbXB0eVxuICpcbiAqIFJldHVybnMgW1tOb3RoaW5nXV0gaWYgaXQgaXMsIFtbSnVzdF1dIG90aGVyd2lzZS5cbiAqL1xudmFyIGZyb21BcnJheSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgcmV0dXJuIChhLmxlbmd0aCA9PT0gMCkgPyBuZXcgTm90aGluZygpIDogbmV3IEp1c3QoYSk7XG59O1xuZXhwb3J0cy5mcm9tQXJyYXkgPSBmcm9tQXJyYXk7XG4vKipcbiAqIGZyb21PYmplY3QgdXNlcyBPYmplY3Qua2V5cyB0byB0dXJuIHNlZSBpZiBhbiBvYmplY3RcbiAqIGhhcyBhbnkgb3duIHByb3BlcnRpZXMuXG4gKi9cbnZhciBmcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG8pIHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXMobykubGVuZ3RoID09PSAwID8gbmV3IE5vdGhpbmcoKSA6IG5ldyBKdXN0KG8pO1xufTtcbmV4cG9ydHMuZnJvbU9iamVjdCA9IGZyb21PYmplY3Q7XG4vKipcbiAqIGZyb21TdHJpbmcgY29uc3RydWN0cyBOb3RoaW5nPEE+IGlmIHRoZSBzdHJpbmcgaXMgZW1wdHkgb3IgSnVzdDxBPiBvdGhlcndpc2UuXG4gKi9cbnZhciBmcm9tU3RyaW5nID0gZnVuY3Rpb24gKHMpIHtcbiAgICByZXR1cm4gKHMgPT09ICcnKSA/IG5ldyBOb3RoaW5nKCkgOiBuZXcgSnVzdChzKTtcbn07XG5leHBvcnRzLmZyb21TdHJpbmcgPSBmcm9tU3RyaW5nO1xuLyoqXG4gKiBmcm9tQm9vbGVhbiBjb25zdHJ1Y3RzIE5vdGhpbmcgaWYgYiBpcyBmYWxzZSwgSnVzdDxBPiBvdGhlcndpc2VcbiAqL1xudmFyIGZyb21Cb29sZWFuID0gZnVuY3Rpb24gKGIpIHtcbiAgICByZXR1cm4gKGIgPT09IGZhbHNlKSA/IG5ldyBOb3RoaW5nKCkgOiBuZXcgSnVzdChiKTtcbn07XG5leHBvcnRzLmZyb21Cb29sZWFuID0gZnJvbUJvb2xlYW47XG4vKipcbiAqIGZyb21OdW1iZXIgY29uc3RydWN0cyBOb3RoaW5nIGlmIG4gaXMgMCBKdXN0PEE+IG90aGVyd2lzZS5cbiAqL1xudmFyIGZyb21OdW1iZXIgPSBmdW5jdGlvbiAobikge1xuICAgIHJldHVybiAobiA9PT0gMCkgPyBuZXcgTm90aGluZygpIDogbmV3IEp1c3Qobik7XG59O1xuZXhwb3J0cy5mcm9tTnVtYmVyID0gZnJvbU51bWJlcjtcbi8qKlxuICogZnJvbU5hTiBjb25zdHJ1Y3RzIE5vdGhpbmcgaWYgYSB2YWx1ZSBpcyBub3QgYSBudW1iZXIgb3JcbiAqIEp1c3Q8QT4gb3RoZXJ3aXNlLlxuICovXG52YXIgZnJvbU5hTiA9IGZ1bmN0aW9uIChuKSB7XG4gICAgcmV0dXJuIGlzTmFOKG4pID8gbmV3IE5vdGhpbmcoKSA6IG5ldyBKdXN0KG4pO1xufTtcbmV4cG9ydHMuZnJvbU5hTiA9IGZyb21OYU47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tYXliZS5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucGlja1ZhbHVlID0gZXhwb3J0cy5waWNrS2V5ID0gZXhwb3J0cy5tYWtlID0gZXhwb3J0cy5yY29tcGFjdCA9IGV4cG9ydHMuY29tcGFjdCA9IGV4cG9ydHMuaXNCYWRLZXkgPSBleHBvcnRzLnNldCA9IGV4cG9ydHMuZXZlcnkgPSBleHBvcnRzLnNvbWUgPSBleHBvcnRzLmVtcHR5ID0gZXhwb3J0cy5jb3VudCA9IGV4cG9ydHMuY2xvbmUgPSBleHBvcnRzLmhhc0tleSA9IGV4cG9ydHMudmFsdWVzID0gZXhwb3J0cy5ncm91cCA9IGV4cG9ydHMucGFydGl0aW9uID0gZXhwb3J0cy5leGNsdWRlID0gZXhwb3J0cy5ybWVyZ2U1ID0gZXhwb3J0cy5ybWVyZ2U0ID0gZXhwb3J0cy5ybWVyZ2UzID0gZXhwb3J0cy5ybWVyZ2UgPSBleHBvcnRzLm1lcmdlNSA9IGV4cG9ydHMubWVyZ2U0ID0gZXhwb3J0cy5tZXJnZTMgPSBleHBvcnRzLm1lcmdlID0gZXhwb3J0cy5maWx0ZXIgPSBleHBvcnRzLnJlZHVjZSA9IGV4cG9ydHMuZm9yRWFjaCA9IGV4cG9ydHMubWFwVG8gPSBleHBvcnRzLm1hcCA9IGV4cG9ydHMua2V5cyA9IGV4cG9ydHMuaXNSZWNvcmQgPSBleHBvcnRzLmFzc2lnbiA9IGV4cG9ydHMuYmFkS2V5cyA9IHZvaWQgMDtcbi8qKlxuICogVGhlIHJlY29yZCBtb2R1bGUgcHJvdmlkZXMgZnVuY3Rpb25zIGZvciB0cmVhdGluZyBFUyBvYmplY3RzIGFzIHJlY29yZHMuXG4gKlxuICogU29tZSBvZiB0aGUgZnVuY3Rpb25zIHByb3ZpZGVkIGhlcmUgYXJlIG5vdCB0eXBlIHNhZmUgYW5kIG1heSByZXN1bHQgaW5cbiAqIHJ1bnRpbWUgZXJyb3JzIGlmIG5vdCB1c2VkIGNhcmVmdWxseS5cbiAqL1xudmFyIGFycmF5XzEgPSByZXF1aXJlKFwiLi4vYXJyYXlcIik7XG52YXIgdHlwZV8xID0gcmVxdWlyZShcIi4uL3R5cGVcIik7XG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCIuLi9tYXliZVwiKTtcbi8qKlxuICogYmFkS2V5cyBpcyBhIGxpc3Qgb2Yga2V5cyB3ZSBkb24ndCB3YW50IHRvIGNvcHkgYXJvdW5kIGJldHdlZW4gb2JqZWN0cy5cbiAqXG4gKiBNb3N0bHkgZHVlIHRvIHByb3RvdHlwZSBwb2xsdXRpb24gYnV0IHdobyBrbm93cyB3aGF0IG90aGVyIGtleXMgbWF5IGJlY29tZVxuICogYSBwcm9ibGVtIGFzIHRoZSBsYW5ndWFnZSBtYXR1cmVzLlxuICovXG5leHBvcnRzLmJhZEtleXMgPSBbJ19fcHJvdG9fXyddO1xuLyoqXG4gKiBhc3NpZ24gaXMgYW4gT2JqZWN0LmFzc2lnbiBwb2x5ZmlsbC5cbiAqXG4gKiBJdCBpcyB1c2VkIGludGVybmFsbHkgYW5kIHNob3VsZCBwcm9iYWJseSBub3QgYmUgdXNlZCBkaXJlY3RseSBlbHNld2hlcmUuXG4gKi9cbmZ1bmN0aW9uIGFzc2lnbih0YXJnZXQpIHtcbiAgICB2YXIgX3ZhckFyZ3MgPSBbXTtcbiAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICBfdmFyQXJnc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTtcbiAgICB9XG4gICAgdmFyIHRvID0gT2JqZWN0KHRhcmdldCk7XG4gICAgZm9yICh2YXIgaW5kZXggPSAxOyBpbmRleCA8IGFyZ3VtZW50cy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgdmFyIG5leHRTb3VyY2UgPSBhcmd1bWVudHNbaW5kZXhdO1xuICAgICAgICBpZiAobmV4dFNvdXJjZSAhPSBudWxsKVxuICAgICAgICAgICAgZm9yICh2YXIgbmV4dEtleSBpbiBuZXh0U291cmNlKVxuICAgICAgICAgICAgICAgIC8vIEF2b2lkIGJ1Z3Mgd2hlbiBoYXNPd25Qcm9wZXJ0eSBpcyBzaGFkb3dlZFxuICAgICAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobmV4dFNvdXJjZSwgbmV4dEtleSkpXG4gICAgICAgICAgICAgICAgICAgICgwLCBleHBvcnRzLnNldCkodG8sIG5leHRLZXksIG5leHRTb3VyY2VbbmV4dEtleV0pO1xuICAgIH1cbiAgICByZXR1cm4gdG87XG59XG5leHBvcnRzLmFzc2lnbiA9IGFzc2lnbjtcbi8qKlxuICogaXNSZWNvcmQgdGVzdHMgd2hldGhlciBhIHZhbHVlIGlzIGEgcmVjb3JkLlxuICpcbiAqIFRvIGJlIGEgUmVjb3JkLCBhIHZhbHVlIG11c3QgYmUgYW4gb2JqZWN0IGFuZDpcbiAqIDEuIG11c3Qgbm90IGJlIG51bGxcbiAqIDIuIG11c3Qgbm90IGJlIGFuIEFycmF5XG4gKiAyLiBtdXN0IG5vdCBiZSBhbiBpbnN0YW5jZSBvZiBEYXRlXG4gKiAzLiBtdXN0IG5vdCBiZSBhbiBpbnN0YW5jZSBvZiBSZWdFeHBcbiAqL1xudmFyIGlzUmVjb3JkID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgcmV0dXJuICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSAmJlxuICAgICAgICAodmFsdWUgIT0gbnVsbCkgJiZcbiAgICAgICAgKCFBcnJheS5pc0FycmF5KHZhbHVlKSkgJiZcbiAgICAgICAgKCEodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSkgJiZcbiAgICAgICAgKCEodmFsdWUgaW5zdGFuY2VvZiBSZWdFeHApKTtcbn07XG5leHBvcnRzLmlzUmVjb3JkID0gaXNSZWNvcmQ7XG4vKipcbiAqIGtleXMgaXMgYW4gT2JqZWN0LmtleXMgc2hvcnRjdXQuXG4gKi9cbnZhciBrZXlzID0gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gT2JqZWN0LmtleXMob2JqKTsgfTtcbmV4cG9ydHMua2V5cyA9IGtleXM7XG4vKipcbiAqIG1hcCBvdmVyIGEgUmVjb3JkJ3MgcHJvcGVydGllcyBwcm9kdWNpbmcgYSBuZXcgcmVjb3JkLlxuICpcbiAqIFRoZSBvcmRlciBvZiBrZXlzIHByb2Nlc3NlZCBpcyBub3QgZ3VhcmFudGVlZC5cbiAqL1xudmFyIG1hcCA9IGZ1bmN0aW9uIChyZWMsIGYpIHtcbiAgICByZXR1cm4gKDAsIGV4cG9ydHMua2V5cykocmVjKVxuICAgICAgICAucmVkdWNlKGZ1bmN0aW9uIChwLCBrKSB7IHJldHVybiAoMCwgZXhwb3J0cy5tZXJnZSkocCwgKDAsIGV4cG9ydHMuc2V0KSh7fSwgaywgZihyZWNba10sIGssIHJlYykpKTsgfSwge30pO1xufTtcbmV4cG9ydHMubWFwID0gbWFwO1xuLyoqXG4gKiBtYXBUbyBhbiBhcnJheSB0aGUgcHJvcGVydGllcyBvZiB0aGUgcHJvdmlkZWQgUmVjb3JkLlxuICpcbiAqIFRoZSBlbGVtZW50cyBvZiB0aGUgYXJyYXkgYXJlIHRoZSByZXN1bHQgb2YgYXBwbHlpbmcgdGhlIGZ1bmN0aW9uIHByb3ZpZGVkXG4gKiB0byBlYWNoIHByb3BlcnR5LiBUaGUgb3JkZXIgb2YgZWxlbWVudHMgaXMgbm90IGd1YXJhbnRlZWQuXG4gKi9cbnZhciBtYXBUbyA9IGZ1bmN0aW9uIChyZWMsIGYpIHtcbiAgICByZXR1cm4gKDAsIGV4cG9ydHMua2V5cykocmVjKS5tYXAoZnVuY3Rpb24gKGspIHsgcmV0dXJuIGYocmVjW2tdLCBrLCByZWMpOyB9KTtcbn07XG5leHBvcnRzLm1hcFRvID0gbWFwVG87XG4vKipcbiAqIGZvckVhY2ggaXMgc2ltaWxhciB0byBtYXAgb25seSB0aGUgcmVzdWx0IG9mIGVhY2ggZnVuY3Rpb24gY2FsbCBpcyBub3Qga2VwdC5cbiAqXG4gKiBUaGUgb3JkZXIgb2Yga2V5cyBwcm9jZXNzZWQgaXMgbm90IGd1YXJhbnRlZWQuXG4gKi9cbnZhciBmb3JFYWNoID0gZnVuY3Rpb24gKHJlYywgZikge1xuICAgIHJldHVybiAoMCwgZXhwb3J0cy5rZXlzKShyZWMpLmZvckVhY2goZnVuY3Rpb24gKGspIHsgcmV0dXJuIGYocmVjW2tdLCBrLCByZWMpOyB9KTtcbn07XG5leHBvcnRzLmZvckVhY2ggPSBmb3JFYWNoO1xuLyoqXG4gKiByZWR1Y2UgYSBSZWNvcmQncyBrZXlzIHRvIGEgc2luZ2xlIHZhbHVlLlxuICpcbiAqIFRoZSBpbml0aWFsIHZhbHVlIChhY2N1bSkgbXVzdCBiZSBzdXBwbGllZCB0byBhdm9pZCBlcnJvcnMgd2hlblxuICogdGhlcmUgYXJlIG5vIHByb3BlcnRpZXMgb24gdGhlIFJlY29yZC4gVGhlIG9yZGVyIG9mIGtleXMgcHJvY2Vzc2VkIGlzXG4gKiBub3QgZ3VhcmFudGVlZC5cbiAqL1xudmFyIHJlZHVjZSA9IGZ1bmN0aW9uIChyZWMsIGFjY3VtLCBmKSB7XG4gICAgcmV0dXJuICgwLCBleHBvcnRzLmtleXMpKHJlYykucmVkdWNlKGZ1bmN0aW9uIChwLCBrKSB7IHJldHVybiBmKHAsIHJlY1trXSwgayk7IH0sIGFjY3VtKTtcbn07XG5leHBvcnRzLnJlZHVjZSA9IHJlZHVjZTtcbi8qKlxuICogZmlsdGVyIHRoZSBrZXlzIG9mIGEgUmVjb3JkIHVzaW5nIGEgZmlsdGVyIGZ1bmN0aW9uLlxuICovXG52YXIgZmlsdGVyID0gZnVuY3Rpb24gKHJlYywgZikge1xuICAgIHJldHVybiAoMCwgZXhwb3J0cy5rZXlzKShyZWMpXG4gICAgICAgIC5yZWR1Y2UoZnVuY3Rpb24gKHAsIGspIHsgcmV0dXJuIGYocmVjW2tdLCBrLCByZWMpID9cbiAgICAgICAgKDAsIGV4cG9ydHMubWVyZ2UpKHAsICgwLCBleHBvcnRzLnNldCkoe30sIGssIHJlY1trXSkpIDogcDsgfSwge30pO1xufTtcbmV4cG9ydHMuZmlsdGVyID0gZmlsdGVyO1xuLyoqXG4gKiBtZXJnZSB0d28gb2JqZWN0cyAoc2hhbGxvdykgaW50byBvbmUgbmV3IG9iamVjdC5cbiAqXG4gKiBUaGUgcmV0dXJuIHZhbHVlJ3MgdHlwZSBpcyB0aGUgcHJvZHVjdCBvZiB0aGUgdHdvIG9iamVjdHMgcHJvdmlkZWQuXG4gKi9cbnZhciBtZXJnZSA9IGZ1bmN0aW9uIChsZWZ0LCByaWdodCkgeyByZXR1cm4gYXNzaWduKHt9LCBsZWZ0LCByaWdodCk7IH07XG5leHBvcnRzLm1lcmdlID0gbWVyZ2U7XG4vKipcbiAqIG1lcmdlM1xuICovXG52YXIgbWVyZ2UzID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgcmV0dXJuIGFzc2lnbih7fSwgYSwgYiwgYyk7IH07XG5leHBvcnRzLm1lcmdlMyA9IG1lcmdlMztcbi8qKlxuICogbWVyZ2U0XG4gKi9cbnZhciBtZXJnZTQgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkge1xuICAgIHJldHVybiBhc3NpZ24oe30sIGEsIGIsIGMsIGQpO1xufTtcbmV4cG9ydHMubWVyZ2U0ID0gbWVyZ2U0O1xuLyoqXG4gKiBtZXJnZTVcbiAqL1xudmFyIG1lcmdlNSA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlKSB7XG4gICAgcmV0dXJuIGFzc2lnbih7fSwgYSwgYiwgYywgZCwgZSk7XG59O1xuZXhwb3J0cy5tZXJnZTUgPSBtZXJnZTU7XG4vKipcbiAqIHJtZXJnZSBtZXJnZXMgMiByZWNvcmRzIHJlY3Vyc2l2ZWx5LlxuICpcbiAqIFRoaXMgZnVuY3Rpb24gbWF5IHZpb2xhdGUgdHlwZSBzYWZldHkuXG4gKi9cbnZhciBybWVyZ2UgPSBmdW5jdGlvbiAobGVmdCwgcmlnaHQpIHtcbiAgICByZXR1cm4gKDAsIGV4cG9ydHMucmVkdWNlKShyaWdodCwgbGVmdCwgZGVlcE1lcmdlKTtcbn07XG5leHBvcnRzLnJtZXJnZSA9IHJtZXJnZTtcbi8qKlxuICogcm1lcmdlM1xuICovXG52YXIgcm1lcmdlMyA9IGZ1bmN0aW9uIChyLCBzLCB0KSB7XG4gICAgcmV0dXJuIFtzLCB0XVxuICAgICAgICAucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgIHJldHVybiAoMCwgZXhwb3J0cy5yZWR1Y2UpKGMsIChwKSwgZGVlcE1lcmdlKTtcbiAgICB9LCByKTtcbn07XG5leHBvcnRzLnJtZXJnZTMgPSBybWVyZ2UzO1xuLyoqXG4gKiBybWVyZ2U0XG4gKi9cbnZhciBybWVyZ2U0ID0gZnVuY3Rpb24gKHIsIHMsIHQsIHUpIHtcbiAgICByZXR1cm4gW3MsIHQsIHVdXG4gICAgICAgIC5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgcmV0dXJuICgwLCBleHBvcnRzLnJlZHVjZSkoYywgKHApLCBkZWVwTWVyZ2UpO1xuICAgIH0sIHIpO1xufTtcbmV4cG9ydHMucm1lcmdlNCA9IHJtZXJnZTQ7XG4vKipcbiAqIHJtZXJnZTVcbiAqL1xudmFyIHJtZXJnZTUgPSBmdW5jdGlvbiAociwgcywgdCwgdSwgdikge1xuICAgIHJldHVybiBbcywgdCwgdSwgdl1cbiAgICAgICAgLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICByZXR1cm4gKDAsIGV4cG9ydHMucmVkdWNlKShjLCAocCksIGRlZXBNZXJnZSk7XG4gICAgfSwgcik7XG59O1xuZXhwb3J0cy5ybWVyZ2U1ID0gcm1lcmdlNTtcbnZhciBkZWVwTWVyZ2UgPSBmdW5jdGlvbiAocHJlLCBjdXJyLCBrZXkpIHtcbiAgICByZXR1cm4gKDAsIGV4cG9ydHMuaXNSZWNvcmQpKGN1cnIpID9cbiAgICAgICAgKDAsIGV4cG9ydHMubWVyZ2UpKHByZSwgKDAsIGV4cG9ydHMuc2V0KSh7fSwga2V5LCAoMCwgZXhwb3J0cy5pc1JlY29yZCkocHJlW2tleV0pID9cbiAgICAgICAgICAgICgwLCBleHBvcnRzLnJtZXJnZSkocHJlW2tleV0sIGN1cnIpIDpcbiAgICAgICAgICAgICgwLCBleHBvcnRzLm1lcmdlKSh7fSwgY3VycikpKSA6XG4gICAgICAgICgwLCBleHBvcnRzLm1lcmdlKShwcmUsICgwLCBleHBvcnRzLnNldCkoe30sIGtleSwgY3VycikpO1xufTtcbi8qKlxuICogZXhjbHVkZSByZW1vdmVzIHRoZSBzcGVjaWZpZWQgcHJvcGVydGllcyBmcm9tIGEgUmVjb3JkLlxuICovXG52YXIgZXhjbHVkZSA9IGZ1bmN0aW9uIChyZWMsIGtleXMpIHtcbiAgICB2YXIgbGlzdCA9IEFycmF5LmlzQXJyYXkoa2V5cykgPyBrZXlzIDogW2tleXNdO1xuICAgIHJldHVybiAoMCwgZXhwb3J0cy5yZWR1Y2UpKHJlYywge30sIGZ1bmN0aW9uIChwLCBjLCBrKSB7XG4gICAgICAgIHJldHVybiBsaXN0LmluZGV4T2YoaykgPiAtMSA/IHAgOiAoMCwgZXhwb3J0cy5tZXJnZSkocCwgKDAsIGV4cG9ydHMuc2V0KSh7fSwgaywgYykpO1xuICAgIH0pO1xufTtcbmV4cG9ydHMuZXhjbHVkZSA9IGV4Y2x1ZGU7XG4vKipcbiAqIHBhcnRpdGlvbiBhIFJlY29yZCBpbnRvIHR3byBzdWItcmVjb3JkcyB1c2luZyBhIFBhcnRpdGlvbkZ1bmMgZnVuY3Rpb24uXG4gKlxuICogVGhpcyBmdW5jdGlvbiBwcm9kdWNlcyBhbiBhcnJheSB3aGVyZSB0aGUgZmlyc3QgZWxlbWVudCBpcyBhIFJlY29yZFxuICogb2YgdmFsdWVzIHRoYXQgcmV0dXJuIHRydWUgYW5kIHRoZSBzZWNvbmQsIGZhbHNlLlxuICovXG52YXIgcGFydGl0aW9uID0gZnVuY3Rpb24gKHIsIGYpIHtcbiAgICByZXR1cm4gKDAsIGV4cG9ydHMucmVkdWNlKShyLCBbe30sIHt9XSwgZnVuY3Rpb24gKF9hLCBjLCBrKSB7XG4gICAgICAgIHZhciB5ZXMgPSBfYVswXSwgbm8gPSBfYVsxXTtcbiAgICAgICAgcmV0dXJuIGYoYywgaywgcikgP1xuICAgICAgICAgICAgWygwLCBleHBvcnRzLm1lcmdlKSh5ZXMsICgwLCBleHBvcnRzLnNldCkoe30sIGssIGMpKSwgbm9dIDpcbiAgICAgICAgICAgIFt5ZXMsICgwLCBleHBvcnRzLm1lcmdlKShubywgKDAsIGV4cG9ydHMuc2V0KSh7fSwgaywgYykpXTtcbiAgICB9KTtcbn07XG5leHBvcnRzLnBhcnRpdGlvbiA9IHBhcnRpdGlvbjtcbi8qKlxuICogZ3JvdXAgdGhlIHByb3BlcnRpZXMgb2YgYSBSZWNvcmQgaW50byBhbm90aGVyIFJlY29yZCB1c2luZyBhIEdyb3VwRnVuY1xuICogZnVuY3Rpb24uXG4gKi9cbnZhciBncm91cCA9IGZ1bmN0aW9uIChyZWMsIGYpIHtcbiAgICByZXR1cm4gKDAsIGV4cG9ydHMucmVkdWNlKShyZWMsIHt9LCBmdW5jdGlvbiAocHJldiwgY3Vyciwga2V5KSB7XG4gICAgICAgIHZhciBjYXRlZ29yeSA9IGYoY3Vyciwga2V5LCByZWMpO1xuICAgICAgICB2YXIgdmFsdWUgPSAoMCwgZXhwb3J0cy5pc1JlY29yZCkocHJldltjYXRlZ29yeV0pID9cbiAgICAgICAgICAgICgwLCBleHBvcnRzLm1lcmdlKShwcmV2W2NhdGVnb3J5XSwgKDAsIGV4cG9ydHMuc2V0KSh7fSwga2V5LCBjdXJyKSkgOlxuICAgICAgICAgICAgKDAsIGV4cG9ydHMuc2V0KSh7fSwga2V5LCBjdXJyKTtcbiAgICAgICAgcmV0dXJuICgwLCBleHBvcnRzLm1lcmdlKShwcmV2LCAoMCwgZXhwb3J0cy5zZXQpKHt9LCBjYXRlZ29yeSwgdmFsdWUpKTtcbiAgICB9KTtcbn07XG5leHBvcnRzLmdyb3VwID0gZ3JvdXA7XG4vKipcbiAqIHZhbHVlcyByZXR1cm5zIGEgc2hhbGxvdyBhcnJheSBvZiB0aGUgdmFsdWVzIG9mIGEgcmVjb3JkLlxuICovXG52YXIgdmFsdWVzID0gZnVuY3Rpb24gKHIpIHtcbiAgICByZXR1cm4gKDAsIGV4cG9ydHMucmVkdWNlKShyLCBbXSwgZnVuY3Rpb24gKHAsIGMpIHsgcmV0dXJuICgwLCBhcnJheV8xLmNvbmNhdCkocCwgYyk7IH0pO1xufTtcbmV4cG9ydHMudmFsdWVzID0gdmFsdWVzO1xuLyoqXG4gKiBoYXNLZXkgaW5kaWNhdGVzIHdoZXRoZXIgYSBSZWNvcmQgaGFzIGEgZ2l2ZW4ga2V5LlxuICovXG52YXIgaGFzS2V5ID0gZnVuY3Rpb24gKHIsIGtleSkge1xuICAgIHJldHVybiBPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChyLCBrZXkpO1xufTtcbmV4cG9ydHMuaGFzS2V5ID0gaGFzS2V5O1xuLyoqXG4gKiBjbG9uZSBhIFJlY29yZC5cbiAqXG4gKiBCcmVha3MgcmVmZXJlbmNlcyBhbmQgZGVlcCBjbG9uZXMgYXJyYXlzLlxuICogVGhpcyBmdW5jdGlvbiBzaG91bGQgb25seSBiZSB1c2VkIG9uIFJlY29yZHMgb3Igb2JqZWN0cyB0aGF0XG4gKiBhcmUgbm90IGNsYXNzIGluc3RhbmNlcy4gVGhpcyBmdW5jdGlvbiBtYXkgdmlvbGF0ZSB0eXBlIHNhZmV0eS5cbiAqL1xudmFyIGNsb25lID0gZnVuY3Rpb24gKHIpIHtcbiAgICByZXR1cm4gKDAsIGV4cG9ydHMucmVkdWNlKShyLCB7fSwgZnVuY3Rpb24gKHAsIGMsIGspIHsgKDAsIGV4cG9ydHMuc2V0KShwLCBrLCBfY2xvbmUoYykpOyByZXR1cm4gcDsgfSk7XG59O1xuZXhwb3J0cy5jbG9uZSA9IGNsb25lO1xudmFyIF9jbG9uZSA9IGZ1bmN0aW9uIChhKSB7XG4gICAgaWYgKCgwLCB0eXBlXzEuaXNBcnJheSkoYSkpXG4gICAgICAgIHJldHVybiBhLm1hcChfY2xvbmUpO1xuICAgIGVsc2UgaWYgKCgwLCBleHBvcnRzLmlzUmVjb3JkKShhKSlcbiAgICAgICAgcmV0dXJuICgwLCBleHBvcnRzLmNsb25lKShhKTtcbiAgICBlbHNlXG4gICAgICAgIHJldHVybiBhO1xufTtcbi8qKlxuICogY291bnQgaG93IG1hbnkgcHJvcGVydGllcyBleGlzdCBvbiB0aGUgcmVjb3JkLlxuICovXG52YXIgY291bnQgPSBmdW5jdGlvbiAocikgeyByZXR1cm4gKDAsIGV4cG9ydHMua2V5cykocikubGVuZ3RoOyB9O1xuZXhwb3J0cy5jb3VudCA9IGNvdW50O1xuLyoqXG4gKiBlbXB0eSB0ZXN0cyB3aGV0aGVyIHRoZSBvYmplY3QgaGFzIGFueSBwcm9wZXJ0aWVzIG9yIG5vdC5cbiAqL1xudmFyIGVtcHR5ID0gZnVuY3Rpb24gKHIpIHsgcmV0dXJuICgwLCBleHBvcnRzLmNvdW50KShyKSA9PT0gMDsgfTtcbmV4cG9ydHMuZW1wdHkgPSBlbXB0eTtcbi8qKlxuICogc29tZSB0ZXN0cyB3aGV0aGVyIGF0IGxlYXN0IG9uZSBwcm9wZXJ0eSBvZiBhIFJlY29yZCBwYXNzZXMgdGhlXG4gKiB0ZXN0IGltcGxlbWVudGVkIGJ5IHRoZSBwcm92aWRlZCBmdW5jdGlvbi5cbiAqL1xudmFyIHNvbWUgPSBmdW5jdGlvbiAobywgZikge1xuICAgIHJldHVybiAoMCwgZXhwb3J0cy5rZXlzKShvKS5zb21lKGZ1bmN0aW9uIChrKSB7IHJldHVybiBmKG9ba10sIGssIG8pOyB9KTtcbn07XG5leHBvcnRzLnNvbWUgPSBzb21lO1xuLyoqXG4gKiBldmVyeSB0ZXN0cyB3aGV0aGVyIGVhY2ggcHJvcGVydHkgb2YgYSBSZWNvcmQgcGFzc2VzIHRoZVxuICogdGVzdCBpbXBsZW1lbnRlZCBieSB0aGUgcHJvdmlkZWQgZnVuY3Rpb24uXG4gKi9cbnZhciBldmVyeSA9IGZ1bmN0aW9uIChvLCBmKSB7XG4gICAgcmV0dXJuICgwLCBleHBvcnRzLmtleXMpKG8pLmV2ZXJ5KGZ1bmN0aW9uIChrKSB7IHJldHVybiBmKG9ba10sIGssIG8pOyB9KTtcbn07XG5leHBvcnRzLmV2ZXJ5ID0gZXZlcnk7XG4vKipcbiAqIHNldCB0aGUgdmFsdWUgb2YgYSBrZXkgb24gYSBSZWNvcmQgaWdub3JpbmcgcHJvYmxlbWF0aWMga2V5cy5cbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIGV4aXN0cyB0byBhdm9pZCB1bmludGVudGlvbmFsbHkgc2V0dGluZyBwcm9ibGVtIGtleXMgc3VjaFxuICogYXMgX19wcm90b19fIG9uIGFuIG9iamVjdC5cbiAqXG4gKiBFdmVuIHRob3VnaCB0aGlzIGZ1bmN0aW9uIG11dGF0ZXMgdGhlIHByb3ZpZGVkIHJlY29yZCwgaXQgc2hvdWxkIGJlIHVzZWRcbiAqIGFzIHRob3VnaCBpdCBkb2VzIG5vdC5cbiAqXG4gKiBEb24ndDpcbiAqIHNldChvYmosIGtleSwgdmFsdWUpO1xuICpcbiAqIERvOlxuICogb2JqID0gc2V0KG9iaiwga2V5LCB2YWx1ZSk7XG4gKi9cbnZhciBzZXQgPSBmdW5jdGlvbiAociwgaywgdmFsdWUpIHtcbiAgICBpZiAoISgwLCBleHBvcnRzLmlzQmFkS2V5KShrKSlcbiAgICAgICAgcltrXSA9IHZhbHVlO1xuICAgIHJldHVybiByO1xufTtcbmV4cG9ydHMuc2V0ID0gc2V0O1xuLyoqXG4gKiBpc0JhZEtleSB0ZXN0cyB3aGV0aGVyIGEga2V5IGlzIHByb2JsZW1hdGljIChMaWtlIF9fcHJvdG9fXykuXG4gKi9cbnZhciBpc0JhZEtleSA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICByZXR1cm4gZXhwb3J0cy5iYWRLZXlzLmluZGV4T2Yoa2V5KSAhPT0gLTE7XG59O1xuZXhwb3J0cy5pc0JhZEtleSA9IGlzQmFkS2V5O1xuLyoqXG4gKiBjb21wYWN0IGEgUmVjb3JkIGJ5IHJlbW92aW5nIGFueSBwcm9wZXJ0aWVzIHRoYXQgPT0gbnVsbC5cbiAqL1xudmFyIGNvbXBhY3QgPSBmdW5jdGlvbiAocmVjKSB7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGZvciAodmFyIGtleSBpbiByZWMpXG4gICAgICAgIGlmIChyZWMuaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIGlmIChyZWNba2V5XSAhPSBudWxsKVxuICAgICAgICAgICAgICAgIHJlc3VsdCA9ICgwLCBleHBvcnRzLnNldCkocmVzdWx0LCBrZXksIHJlY1trZXldKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbmV4cG9ydHMuY29tcGFjdCA9IGNvbXBhY3Q7XG4vKipcbiAqIHJjb21wYWN0IHJlY3Vyc2l2ZWx5IGNvbXBhY3RzIGEgUmVjb3JkLlxuICovXG52YXIgcmNvbXBhY3QgPSBmdW5jdGlvbiAocmVjKSB7XG4gICAgcmV0dXJuICgwLCBleHBvcnRzLmNvbXBhY3QpKCgwLCBleHBvcnRzLm1hcCkocmVjLCBmdW5jdGlvbiAodmFsKSB7IHJldHVybiAoMCwgZXhwb3J0cy5pc1JlY29yZCkodmFsKSA/ICgwLCBleHBvcnRzLnJjb21wYWN0KSh2YWwpIDogdmFsOyB9KSk7XG59O1xuZXhwb3J0cy5yY29tcGFjdCA9IHJjb21wYWN0O1xuLyoqXG4gKiBtYWtlIGNyZWF0ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgYSBSZWNvcmQgb3B0aW9uYWxseSB1c2luZyB0aGUgcHJvdmlkZWRcbiAqIHZhbHVlIGFzIGFuIGluaXRpYWxpemVyLlxuICpcbiAqIFRoaXMgZnVuY3Rpb24gaXMgaW50ZW5kZWQgdG8gYXNzaXN0IHdpdGggY3VyYmluZyBwcm90b3R5cGUgcG9sbHV0aW9uIGJ5XG4gKiBjb25maWd1cmluZyBhIHNldHRlciBmb3IgX19wcm90b19fIHRoYXQgaWdub3JlcyBjaGFuZ2VzLlxuICovXG52YXIgbWFrZSA9IGZ1bmN0aW9uIChpbml0KSB7XG4gICAgaWYgKGluaXQgPT09IHZvaWQgMCkgeyBpbml0ID0ge307IH1cbiAgICB2YXIgcmVjID0ge307XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHJlYywgJ19fcHJvdG9fXycsIHtcbiAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIHNldDogZnVuY3Rpb24gKCkgeyB9XG4gICAgfSk7XG4gICAgZm9yICh2YXIga2V5IGluIGluaXQpXG4gICAgICAgIGlmIChpbml0Lmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZWNba2V5XSA9IGluaXRba2V5XTtcbiAgICByZXR1cm4gcmVjO1xufTtcbmV4cG9ydHMubWFrZSA9IG1ha2U7XG4vKipcbiAqIHBpY2tLZXkgc2VsZWN0cyB0aGUgdmFsdWUgb2YgdGhlIGZpcnN0IHByb3BlcnR5IGluIGEgUmVjb3JkIHRoYXQgcGFzc2VzIHRoZVxuICogcHJvdmlkZWQgdGVzdC5cbiAqL1xudmFyIHBpY2tLZXkgPSBmdW5jdGlvbiAocmVjLCB0ZXN0KSB7XG4gICAgcmV0dXJuICgwLCBleHBvcnRzLnJlZHVjZSkocmVjLCAoMCwgbWF5YmVfMS5ub3RoaW5nKSgpLCBmdW5jdGlvbiAocCwgYywgaykge1xuICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiB0ZXN0KGMsIGssIHJlYykgPyAoMCwgbWF5YmVfMS5qdXN0KShrKSA6IHA7XG4gICAgfSk7XG59O1xuZXhwb3J0cy5waWNrS2V5ID0gcGlja0tleTtcbi8qKlxuICogcGlja1ZhbHVlIHNlbGVjdHMgdGhlIHZhbHVlIG9mIHRoZSBmaXJzdCBwcm9wZXJ0eSBpbiBhIFJlY29yZCB0aGF0IHBhc3NlcyB0aGVcbiAqIHByb3ZpZGVkIHRlc3QuXG4gKi9cbnZhciBwaWNrVmFsdWUgPSBmdW5jdGlvbiAocmVjLCB0ZXN0KSB7XG4gICAgcmV0dXJuICgwLCBleHBvcnRzLnJlZHVjZSkocmVjLCAoMCwgbWF5YmVfMS5ub3RoaW5nKSgpLCBmdW5jdGlvbiAocCwgYywgaykge1xuICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiB0ZXN0KGMsIGssIHJlYykgPyAoMCwgbWF5YmVfMS5qdXN0KShjKSA6IHA7XG4gICAgfSk7XG59O1xuZXhwb3J0cy5waWNrVmFsdWUgPSBwaWNrVmFsdWU7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucHJvamVjdCA9IGV4cG9ydHMudW5mbGF0dGVuID0gZXhwb3J0cy5mbGF0dGVuID0gZXhwb3J0cy51bmVzY2FwZVJlY29yZCA9IGV4cG9ydHMuZXNjYXBlUmVjb3JkID0gZXhwb3J0cy51bmVzY2FwZSA9IGV4cG9ydHMuZXNjYXBlID0gZXhwb3J0cy5zZXQgPSBleHBvcnRzLmdldFN0cmluZyA9IGV4cG9ydHMuZ2V0RGVmYXVsdCA9IGV4cG9ydHMuZ2V0ID0gZXhwb3J0cy51bnNhZmVHZXQgPSBleHBvcnRzLnRva2VuaXplID0gdm9pZCAwO1xuLyoqXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyBhIHN5bnRheCBhbmQgYXNzb2NpYXRlZCBmdW5jdGlvbnMgZm9yXG4gKiBnZXR0aW5nIGFuZCBzZXR0aW5nIHZhbHVlcyBvbiBFUyBvYmplY3RzIGVhc2lseS5cbiAqXG4gKiBHaXZlbiBhIHBhdGgsIGEgdmFsdWUgY2FuIGVpdGhlciBiZSByZXRyaWV2ZWQgb3Igc2V0IG9uIGFuIG9iamVjdC5cbiAqXG4gKiBUaGUgcGF0aCBzeW50YXggZm9sbG93cyB0eXBpY2FsIEVTIGRvdCBub3RhdGlvbiwgYnJhY2tldCBub3RhdGlvbiBvciBhIG1peHR1cmVcbiAqIG9mIGJvdGguXG4gKlxuICogTm90ZSB0aGF0IHF1b3RlcyBhcmUgbm90IHVzZWQgd2hlbiBkZXNjcmliaW5nIGEgcGF0aCB2aWEgYnJhY2tldCBub3RhdGlvbi5cbiAqXG4gKiBJZiB5b3UgbmVlZCB0byB1c2UgYSBkb3Qgb3Igc3F1YXJlIGJyYWNrZXRzIGluIHlvdXIgcGF0aHMsIHByZWZpeCB0aGVtIHdpdGhcbiAqIHRoZSBcIlxcXCIgKGJhY2tzbGFzaCkgY2hhcmFjdGVyLlxuICovXG4vKiogaW1wb3J0cyAqKi9cbnZhciBtYXliZV8xID0gcmVxdWlyZShcIi4uL21heWJlXCIpO1xudmFyIF8xID0gcmVxdWlyZShcIi4vXCIpO1xudmFyIFRPS0VOX0RPVCA9ICcuJztcbnZhciBUT0tFTl9CUkFDS0VUX0xFRlQgPSAnWyc7XG52YXIgVE9LRU5fQlJBQ0tFVF9SSUdIVCA9ICddJztcbnZhciBUT0tFTl9FU0NBUEUgPSAnXFxcXCc7XG4vKipcbiAqIHRva2VuaXplIGEgcGF0aCBpbnRvIGEgbGlzdCBvZiBzZXF1ZW50aWFsIHByb3BlcnR5IG5hbWVzLlxuICovXG52YXIgdG9rZW5pemUgPSBmdW5jdGlvbiAoc3RyKSB7XG4gICAgdmFyIGkgPSAwO1xuICAgIHZhciBidWYgPSAnJztcbiAgICB2YXIgY3VyciA9ICcnO1xuICAgIHZhciBuZXh0ID0gJyc7XG4gICAgdmFyIHRva2VucyA9IFtdO1xuICAgIHdoaWxlIChpIDwgc3RyLmxlbmd0aCkge1xuICAgICAgICBjdXJyID0gc3RyW2ldO1xuICAgICAgICBuZXh0ID0gc3RyW2kgKyAxXTtcbiAgICAgICAgaWYgKGN1cnIgPT09IFRPS0VOX0VTQ0FQRSkge1xuICAgICAgICAgICAgLy9lc2NhcGUgc2VxdWVuY2VcbiAgICAgICAgICAgIGJ1ZiA9IFwiXCIgKyBidWYgKyBuZXh0O1xuICAgICAgICAgICAgaSsrO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGN1cnIgPT09IFRPS0VOX0RPVCkge1xuICAgICAgICAgICAgaWYgKGJ1ZiAhPT0gJycpXG4gICAgICAgICAgICAgICAgdG9rZW5zLnB1c2goYnVmKTsgLy9yZWNvZ25pemUgYSBwYXRoIGFuZCBwdXNoIGEgbmV3IHRva2VuXG4gICAgICAgICAgICBidWYgPSAnJztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgoY3VyciA9PT0gVE9LRU5fQlJBQ0tFVF9MRUZUKSAmJlxuICAgICAgICAgICAgbmV4dCA9PT0gVE9LRU5fQlJBQ0tFVF9SSUdIVCkge1xuICAgICAgICAgICAgLy9pbnRlcmNlcHQgZW1wdHkgYnJhY2tldCBwYXRoc1xuICAgICAgICAgICAgaSsrO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGN1cnIgPT09IFRPS0VOX0JSQUNLRVRfTEVGVCkge1xuICAgICAgICAgICAgdmFyIGJyYWNrZXRCdWYgPSAnJztcbiAgICAgICAgICAgIHZhciBmaXJzdERvdCA9IC0xO1xuICAgICAgICAgICAgdmFyIGZpcnN0RG90QnVmID0gJyc7XG4gICAgICAgICAgICBpKys7XG4gICAgICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgICAgIC8vZXZlcnl0aGluZyBiZXR3ZWVuIGJyYWNrZXRzIGlzIHRyZWF0ZWQgYXMgYSBwYXRoXG4gICAgICAgICAgICAgICAgLy9pZiBubyBjbG9zaW5nIGJyYWNrZXQgaXMgZm91bmQsIHdlIGJhY2sgdHJhY2sgdG8gdGhlIGZpcnN0IGRvdFxuICAgICAgICAgICAgICAgIC8vaWYgdGhlcmUgaXMgbm8gZG90IHRoZSB3aG9sZSBidWZmZXIgaXMgdHJlYXRlZCBhcyBhIHBhdGhcbiAgICAgICAgICAgICAgICBjdXJyID0gc3RyW2ldO1xuICAgICAgICAgICAgICAgIG5leHQgPSBzdHJbaSArIDFdO1xuICAgICAgICAgICAgICAgIGlmICgoY3VyciA9PT0gVE9LRU5fQlJBQ0tFVF9SSUdIVCkgJiZcbiAgICAgICAgICAgICAgICAgICAgKG5leHQgPT09IFRPS0VOX0JSQUNLRVRfUklHSFQpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vZXNjYXBlZCByaWdodCBicmFja2V0XG4gICAgICAgICAgICAgICAgICAgIGJyYWNrZXRCdWYgPSBcIlwiICsgYnJhY2tldEJ1ZiArIFRPS0VOX0JSQUNLRVRfUklHSFQ7XG4gICAgICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY3VyciA9PT0gVE9LRU5fQlJBQ0tFVF9SSUdIVCkge1xuICAgICAgICAgICAgICAgICAgICAvL3N1Y2Nlc3NmdWxseSB0b2tlbml6ZWQgdGhlIHBhdGhcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJ1ZiAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnMucHVzaChidWYpOyAvL3NhdmUgdGhlIHByZXZpb3VzIHBhdGhcbiAgICAgICAgICAgICAgICAgICAgdG9rZW5zLnB1c2goYnJhY2tldEJ1Zik7IC8vc2F2ZSB0aGUgY3VycmVudCBwYXRoXG4gICAgICAgICAgICAgICAgICAgIGJ1ZiA9ICcnO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY3VyciA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vbm8gY2xvc2luZyBicmFja2V0IGZvdW5kIGFuZCB3ZSByYW4gb3V0IG9mIHN0cmluZyB0byBzZWFyY2hcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpcnN0RG90ICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9iYWNrdHJhY2sgdG8gdGhlIGZpcnN0IGRvdCBlbmNvdW50ZXJlZFxuICAgICAgICAgICAgICAgICAgICAgICAgaSA9IGZpcnN0RG90O1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9zYXZlIHRoZSBwYXRocyBzbyBmYXJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRva2Vucy5wdXNoKFwiXCIgKyBidWYgKyBUT0tFTl9CUkFDS0VUX0xFRlQgKyBmaXJzdERvdEJ1Zik7XG4gICAgICAgICAgICAgICAgICAgICAgICBidWYgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9lbHNlIGlmIG5vIGRvdHMgd2VyZSBmb3VuZCB0cmVhdCB0aGUgY3VycmVudCBidWZmZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFuZCByZXN0IG9mIHRoZSBzdHJpbmcgYXMgcGFydCBvZiBvbmUgcGF0aC5cbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZiA9IFwiXCIgKyBidWYgKyBUT0tFTl9CUkFDS0VUX0xFRlQgKyBicmFja2V0QnVmO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKChjdXJyID09PSBUT0tFTl9ET1QpICYmIChmaXJzdERvdCA9PT0gLTEpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vdGFrZSBub3RlIG9mIHRoZSBsb2NhdGlvbiBhbmQgdG9rZW5zIGJldHdlZW4gXG4gICAgICAgICAgICAgICAgICAgIC8vdGhlIG9wZW5pbmcgYnJhY2tldCBhbmQgZmlyc3QgZG90LlxuICAgICAgICAgICAgICAgICAgICAvL0lmIHRoZXJlIGlzIG5vIGNsb3NpbmcgYnJhY2tldCwgd2UgdXNlIHRoaXMgaW5mbyB0b1xuICAgICAgICAgICAgICAgICAgICAvL2xleCBwcm9wZXJseS5cbiAgICAgICAgICAgICAgICAgICAgZmlyc3REb3QgPSBpO1xuICAgICAgICAgICAgICAgICAgICBmaXJzdERvdEJ1ZiA9IGJyYWNrZXRCdWY7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyYWNrZXRCdWYgPSBcIlwiICsgYnJhY2tldEJ1ZiArIGN1cnI7XG4gICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYnVmID0gXCJcIiArIGJ1ZiArIGN1cnI7XG4gICAgICAgIH1cbiAgICAgICAgaSsrO1xuICAgIH1cbiAgICBpZiAoKGJ1Zi5sZW5ndGggPiAwKSlcbiAgICAgICAgdG9rZW5zLnB1c2goYnVmKTtcbiAgICByZXR1cm4gdG9rZW5zO1xufTtcbmV4cG9ydHMudG9rZW5pemUgPSB0b2tlbml6ZTtcbi8qKlxuICogdW5zYWZlR2V0IHJldHJpZXZlcyBhIHZhbHVlIGF0IHRoZSBzcGVjaWZpZWQgcGF0aFxuICogb24gYW55IEVTIG9iamVjdC5cbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIGRvZXMgbm90IGNoZWNrIGlmIGdldHRpbmcgdGhlIHZhbHVlIHN1Y2NlZWRlZCBvciBub3QuXG4gKi9cbnZhciB1bnNhZmVHZXQgPSBmdW5jdGlvbiAocGF0aCwgc3JjKSB7XG4gICAgaWYgKHNyYyA9PSBudWxsKVxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIHZhciB0b2tzID0gKDAsIGV4cG9ydHMudG9rZW5pemUpKHBhdGgpO1xuICAgIHZhciBoZWFkID0gc3JjW3Rva3Muc2hpZnQoKV07XG4gICAgcmV0dXJuIHRva3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7IHJldHVybiAocCA9PSBudWxsKSA/IHAgOiBwW2NdOyB9LCBoZWFkKTtcbn07XG5leHBvcnRzLnVuc2FmZUdldCA9IHVuc2FmZUdldDtcbi8qKlxuICogZ2V0IGEgdmFsdWUgZnJvbSBhIFJlY29yZCBnaXZlbiBpdHMgcGF0aCBzYWZlbHkuXG4gKi9cbnZhciBnZXQgPSBmdW5jdGlvbiAocGF0aCwgc3JjKSB7XG4gICAgcmV0dXJuICgwLCBtYXliZV8xLmZyb21OdWxsYWJsZSkoKDAsIGV4cG9ydHMudW5zYWZlR2V0KShwYXRoLCBzcmMpKTtcbn07XG5leHBvcnRzLmdldCA9IGdldDtcbi8qKlxuICogZ2V0RGVmYXVsdCBpcyBsaWtlIGdldCBidXQgdGFrZXMgYSBkZWZhdWx0IHZhbHVlIHRvIHJldHVybiBpZlxuICogdGhlIHBhdGggaXMgbm90IGZvdW5kLlxuICovXG52YXIgZ2V0RGVmYXVsdCA9IGZ1bmN0aW9uIChwYXRoLCBzcmMsIGRlZikge1xuICAgIHJldHVybiAoMCwgZXhwb3J0cy5nZXQpKHBhdGgsIHNyYykub3JKdXN0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIGRlZjsgfSkuZ2V0KCk7XG59O1xuZXhwb3J0cy5nZXREZWZhdWx0ID0gZ2V0RGVmYXVsdDtcbi8qKlxuICogZ2V0U3RyaW5nIGNhc3RzIHRoZSByZXN1bHRpbmcgdmFsdWUgdG8gYSBzdHJpbmcuXG4gKlxuICogQW4gZW1wdHkgc3RyaW5nIGlzIHByb3ZpZGVkIGlmIHRoZSBwYXRoIGlzIG5vdCBmb3VuZC5cbiAqL1xudmFyIGdldFN0cmluZyA9IGZ1bmN0aW9uIChwYXRoLCBzcmMpIHtcbiAgICByZXR1cm4gKDAsIGV4cG9ydHMuZ2V0KShwYXRoLCBzcmMpLm1hcChmdW5jdGlvbiAodikgeyByZXR1cm4gU3RyaW5nKHYpOyB9KS5vckp1c3QoZnVuY3Rpb24gKCkgeyByZXR1cm4gJyc7IH0pLmdldCgpO1xufTtcbmV4cG9ydHMuZ2V0U3RyaW5nID0gZ2V0U3RyaW5nO1xuLyoqXG4gKiBzZXQgc2V0cyBhIHZhbHVlIG9uIGFuIG9iamVjdCBnaXZlbiBhIHBhdGguXG4gKi9cbnZhciBzZXQgPSBmdW5jdGlvbiAocCwgdiwgcikge1xuICAgIHZhciB0b2tzID0gKDAsIGV4cG9ydHMudG9rZW5pemUpKHApO1xuICAgIHJldHVybiBfc2V0KHIsIHYsIHRva3MpO1xufTtcbmV4cG9ydHMuc2V0ID0gc2V0O1xudmFyIF9zZXQgPSBmdW5jdGlvbiAociwgdmFsdWUsIHRva3MpIHtcbiAgICB2YXIgbztcbiAgICBpZiAodG9rcy5sZW5ndGggPT09IDApXG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICBvID0gKDAsIF8xLmlzUmVjb3JkKShyKSA/ICgwLCBfMS5jbG9uZSkocikgOiB7fTtcbiAgICBvID0gKDAsIF8xLnNldCkobywgdG9rc1swXSwgX3NldChvW3Rva3NbMF1dLCB2YWx1ZSwgdG9rcy5zbGljZSgxKSkpO1xuICAgIHJldHVybiBvO1xufTtcbi8qKlxuICogZXNjYXBlIGEgcGF0aCBzbyB0aGF0IG9jY3VyZW5jZXMgb2YgZG90cyBhcmUgbm90IGludGVycHJldGVkIGFzIHBhdGhzLlxuICpcbiAqIFRoaXMgZnVuY3Rpb24gZXNjYXBlcyBkb3RzIGFuZCBkb3RzIG9ubHkuXG4gKi9cbnZhciBlc2NhcGUgPSBmdW5jdGlvbiAocCkge1xuICAgIHZhciBpID0gMDtcbiAgICB2YXIgYnVmID0gJyc7XG4gICAgdmFyIGN1cnIgPSAnJztcbiAgICB3aGlsZSAoaSA8IHAubGVuZ3RoKSB7XG4gICAgICAgIGN1cnIgPSBwW2ldO1xuICAgICAgICBpZiAoKGN1cnIgPT09IFRPS0VOX0VTQ0FQRSkgfHwgKGN1cnIgPT09IFRPS0VOX0RPVCkpXG4gICAgICAgICAgICBidWYgPSBcIlwiICsgYnVmICsgVE9LRU5fRVNDQVBFICsgY3VycjtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgYnVmID0gXCJcIiArIGJ1ZiArIGN1cnI7XG4gICAgICAgIGkrKztcbiAgICB9XG4gICAgcmV0dXJuIGJ1Zjtcbn07XG5leHBvcnRzLmVzY2FwZSA9IGVzY2FwZTtcbi8qKlxuICogdW5lc2NhcGUgYSBwYXRoIHRoYXQgaGFzIGJlZW4gcHJldmlvdXNseSBlc2NhcGVkLlxuICovXG52YXIgdW5lc2NhcGUgPSBmdW5jdGlvbiAocCkge1xuICAgIHZhciBpID0gMDtcbiAgICB2YXIgY3VyciA9ICcnO1xuICAgIHZhciBuZXh0ID0gJyc7XG4gICAgdmFyIGJ1ZiA9ICcnO1xuICAgIHdoaWxlIChpIDwgcC5sZW5ndGgpIHtcbiAgICAgICAgY3VyciA9IHBbaV07XG4gICAgICAgIG5leHQgPSBwW2kgKyAxXTtcbiAgICAgICAgaWYgKGN1cnIgPT09IFRPS0VOX0VTQ0FQRSkge1xuICAgICAgICAgICAgYnVmID0gXCJcIiArIGJ1ZiArIG5leHQ7XG4gICAgICAgICAgICBpKys7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBidWYgPSBcIlwiICsgYnVmICsgY3VycjtcbiAgICAgICAgfVxuICAgICAgICBpKys7XG4gICAgfVxuICAgIHJldHVybiBidWY7XG59O1xuZXhwb3J0cy51bmVzY2FwZSA9IHVuZXNjYXBlO1xuLyoqXG4gKiBlc2NhcGVSZWNvcmQgZXNjYXBlcyBlYWNoIHByb3BlcnR5IG9mIGEgcmVjb3JkIHJlY3Vyc2l2ZWx5LlxuICovXG52YXIgZXNjYXBlUmVjb3JkID0gZnVuY3Rpb24gKHIpIHtcbiAgICByZXR1cm4gKDAsIF8xLnJlZHVjZSkociwge30sIGZ1bmN0aW9uIChwLCBjLCBrKSB7XG4gICAgICAgIGlmICh0eXBlb2YgYyA9PT0gJ29iamVjdCcpXG4gICAgICAgICAgICBwID0gKDAsIF8xLnNldCkocCwgKDAsIGV4cG9ydHMuZXNjYXBlKShrKSwgKDAsIGV4cG9ydHMuZXNjYXBlUmVjb3JkKShjKSk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHAgPSAoMCwgXzEuc2V0KShwLCAoMCwgZXhwb3J0cy5lc2NhcGUpKGspLCBjKTtcbiAgICAgICAgcmV0dXJuIHA7XG4gICAgfSk7XG59O1xuZXhwb3J0cy5lc2NhcGVSZWNvcmQgPSBlc2NhcGVSZWNvcmQ7XG4vKipcbiAqIHVuZXNjYXBlUmVjb3JkIHVuZXNjYXBlcyBlYWNoIHByb3BlcnR5IG9mIGEgcmVjb3JkIHJlY3Vyc2l2ZWx5LlxuICovXG52YXIgdW5lc2NhcGVSZWNvcmQgPSBmdW5jdGlvbiAocikge1xuICAgIHJldHVybiAoMCwgXzEucmVkdWNlKShyLCB7fSwgZnVuY3Rpb24gKHAsIGMsIGspIHtcbiAgICAgICAgaWYgKCgwLCBfMS5pc1JlY29yZCkoYykpXG4gICAgICAgICAgICBwID0gKDAsIF8xLnNldCkocCwgKDAsIGV4cG9ydHMudW5lc2NhcGUpKGspLCAoMCwgZXhwb3J0cy51bmVzY2FwZVJlY29yZCkoYykpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBwID0gKDAsIF8xLnNldCkocCwgKDAsIGV4cG9ydHMudW5lc2NhcGUpKGspLCBjKTtcbiAgICAgICAgcmV0dXJuIHA7XG4gICAgfSk7XG59O1xuZXhwb3J0cy51bmVzY2FwZVJlY29yZCA9IHVuZXNjYXBlUmVjb3JkO1xuLyoqXG4gKiBmbGF0dGVuIGFuIG9iamVjdCBpbnRvIGEgUmVjb3JkIHdoZXJlIGVhY2gga2V5IGlzIGEgcGF0aCB0byBhIG5vbi1jb21wbGV4XG4gKiB2YWx1ZSBvciBhcnJheS5cbiAqXG4gKiBJZiBhbnkgb2YgdGhlIHBhdGhzIGNvbnRhaW4gZG90cywgdGhleSB3aWxsIGJlIGVzY2FwZWQuXG4gKi9cbnZhciBmbGF0dGVuID0gZnVuY3Rpb24gKHIpIHtcbiAgICByZXR1cm4gKGZsYXRJbXBsKCcnKSh7fSkocikpO1xufTtcbmV4cG9ydHMuZmxhdHRlbiA9IGZsYXR0ZW47XG52YXIgZmxhdEltcGwgPSBmdW5jdGlvbiAocGZpeCkgeyByZXR1cm4gZnVuY3Rpb24gKHByZXYpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgcmV0dXJuICgwLCBfMS5yZWR1Y2UpKHIsIHByZXYsIGZ1bmN0aW9uIChwLCBjLCBrKSB7IHJldHVybiAoMCwgXzEuaXNSZWNvcmQpKGMpID9cbiAgICAgICAgICAgIChmbGF0SW1wbChwcmVmaXgocGZpeCwgaykpKHApKGMpKSA6XG4gICAgICAgICAgICAoMCwgXzEubWVyZ2UpKHAsICgwLCBfMS5zZXQpKHt9LCBwcmVmaXgocGZpeCwgayksIGMpKTsgfSk7XG4gICAgfTtcbn07IH07XG52YXIgcHJlZml4ID0gZnVuY3Rpb24gKHBmaXgsIGtleSkgeyByZXR1cm4gKHBmaXggPT09ICcnKSA/XG4gICAgKDAsIGV4cG9ydHMuZXNjYXBlKShrZXkpIDogcGZpeCArIFwiLlwiICsgKDAsIGV4cG9ydHMuZXNjYXBlKShrZXkpOyB9O1xuLyoqXG4gKiB1bmZsYXR0ZW4gYSBmbGF0dGVuZWQgUmVjb3JkIHNvIHRoYXQgYW55IG5lc3RlZCBwYXRocyBhcmUgZXhwYW5kZWRcbiAqIHRvIHRoZWlyIGZ1bGwgcmVwcmVzZW50YXRpb24uXG4gKi9cbnZhciB1bmZsYXR0ZW4gPSBmdW5jdGlvbiAocikge1xuICAgIHJldHVybiAoMCwgXzEucmVkdWNlKShyLCB7fSwgZnVuY3Rpb24gKHAsIGMsIGspIHsgcmV0dXJuICgwLCBleHBvcnRzLnNldCkoaywgYywgcCk7IH0pO1xufTtcbmV4cG9ydHMudW5mbGF0dGVuID0gdW5mbGF0dGVuO1xuLyoqXG4gKiBwcm9qZWN0IGEgUmVjb3JkIGFjY29yZGluZyB0byB0aGUgZmllbGQgc3BlY2lmaWNhdGlvbiBnaXZlbi5cbiAqXG4gKiBPbmx5IHByb3BlcnRpZXMgdGhhdCBhcHBlYXIgaW4gdGhlIHNwZWMgYW5kIHNldCB0byB0cnVlIHdpbGwgYmUgcmV0YWluZWQuXG4gKiBUaGlzIGZ1bmN0aW9uIG1heSB2aW9sYXRlIHR5cGUgc2FmZXR5IGFuZCBtYXkgbGVhdmUgdW5kZWZpbmVkIGhvbGVzIGluIHRoZVxuICogcmVzdWx0LlxuICovXG52YXIgcHJvamVjdCA9IGZ1bmN0aW9uIChzcGVjLCByZWMpIHtcbiAgICByZXR1cm4gKDAsIF8xLnJlZHVjZSkoc3BlYywge30sIGZ1bmN0aW9uIChwLCBjLCBrKSB7XG4gICAgICAgIHJldHVybiAoYyA9PT0gdHJ1ZSkgPyAoMCwgZXhwb3J0cy5zZXQpKGssICgwLCBleHBvcnRzLnVuc2FmZUdldCkoaywgcmVjKSwgcCkgOiBwO1xuICAgIH0pO1xufTtcbmV4cG9ydHMucHJvamVjdCA9IHByb2plY3Q7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYXRoLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy50b1N0cmluZyA9IGV4cG9ydHMuc2hvdyA9IGV4cG9ydHMudGVzdCA9IGV4cG9ydHMuaXMgPSBleHBvcnRzLmlzUHJpbSA9IGV4cG9ydHMuaXNGdW5jdGlvbiA9IGV4cG9ydHMuaXNCb29sZWFuID0gZXhwb3J0cy5pc051bWJlciA9IGV4cG9ydHMuaXNTdHJpbmcgPSBleHBvcnRzLmlzQXJyYXkgPSBleHBvcnRzLmlzT2JqZWN0ID0gZXhwb3J0cy5BbnkgPSB2b2lkIDA7XG52YXIgcHJpbXMgPSBbJ3N0cmluZycsICdudW1iZXInLCAnYm9vbGVhbiddO1xuLyoqXG4gKiBBbnkgaXMgYSBjbGFzcyB1c2VkIHRvIHJlcHJlc2VudCB0eXBlc2NyaXB0J3MgXCJhbnlcIiB0eXBlLlxuICovXG52YXIgQW55ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEFueSgpIHtcbiAgICB9XG4gICAgcmV0dXJuIEFueTtcbn0oKSk7XG5leHBvcnRzLkFueSA9IEFueTtcbi8qKlxuICogaXNPYmplY3QgdGVzdC5cbiAqXG4gKiBEb2VzIG5vdCBjb25zaWRlciBhbiBBcnJheSBhbiBvYmplY3QuXG4gKi9cbnZhciBpc09iamVjdCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHJldHVybiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JykgJiYgKCEoMCwgZXhwb3J0cy5pc0FycmF5KSh2YWx1ZSkpO1xufTtcbmV4cG9ydHMuaXNPYmplY3QgPSBpc09iamVjdDtcbi8qKlxuICogaXNBcnJheSB0ZXN0LlxuICovXG5leHBvcnRzLmlzQXJyYXkgPSBBcnJheS5pc0FycmF5O1xuLyoqXG4gKiBpc1N0cmluZyB0ZXN0LlxuICovXG52YXIgaXNTdHJpbmcgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJztcbn07XG5leHBvcnRzLmlzU3RyaW5nID0gaXNTdHJpbmc7XG4vKipcbiAqIGlzTnVtYmVyIHRlc3QuXG4gKi9cbnZhciBpc051bWJlciA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHJldHVybiAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJykgJiYgKCFpc05hTih2YWx1ZSkpO1xufTtcbmV4cG9ydHMuaXNOdW1iZXIgPSBpc051bWJlcjtcbi8qKlxuICogaXNCb29sZWFuIHRlc3QuXG4gKi9cbnZhciBpc0Jvb2xlYW4gPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbic7XG59O1xuZXhwb3J0cy5pc0Jvb2xlYW4gPSBpc0Jvb2xlYW47XG4vKipcbiAqIGlzRnVuY3Rpb24gdGVzdC5cbiAqL1xudmFyIGlzRnVuY3Rpb24gPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nO1xufTtcbmV4cG9ydHMuaXNGdW5jdGlvbiA9IGlzRnVuY3Rpb247XG4vKipcbiAqIGlzUHJpbSB0ZXN0LlxuICovXG52YXIgaXNQcmltID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgcmV0dXJuICEoKDAsIGV4cG9ydHMuaXNPYmplY3QpKHZhbHVlKSB8fFxuICAgICAgICAoMCwgZXhwb3J0cy5pc0FycmF5KSh2YWx1ZSkgfHxcbiAgICAgICAgKDAsIGV4cG9ydHMuaXNGdW5jdGlvbikodmFsdWUpKTtcbn07XG5leHBvcnRzLmlzUHJpbSA9IGlzUHJpbTtcbi8qKlxuICogaXMgcGVyZm9ybXMgYSB0eXBlb2Ygb2YgY2hlY2sgb24gYSB0eXBlLlxuICovXG52YXIgaXMgPSBmdW5jdGlvbiAoZXhwZWN0ZWQpIHsgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHJldHVybiB0eXBlb2YgKHZhbHVlKSA9PT0gZXhwZWN0ZWQ7XG59OyB9O1xuZXhwb3J0cy5pcyA9IGlzO1xuLyoqXG4gKiB0ZXN0IHdoZXRoZXIgYSB2YWx1ZSBjb25mb3JtcyB0byBzb21lIHBhdHRlcm4uXG4gKlxuICogVGhpcyBmdW5jdGlvbiBpcyBtYWRlIGF2YWlsYWJsZSBtYWlubHkgZm9yIGEgY3J1ZGUgcGF0dGVybiBtYXRjaGluZ1xuICogbWFjaGluZXJ5IHRoYXQgd29ya3MgYXMgZm9sbG93c3M6XG4gKiBzdHJpbmcgICAtPiBNYXRjaGVzIG9uIHRoZSB2YWx1ZSBvZiB0aGUgc3RyaW5nLlxuICogbnVtYmVyICAgLT4gTWF0Y2hlcyBvbiB0aGUgdmFsdWUgb2YgdGhlIG51bWJlci5cbiAqIGJvb2xlYW4gIC0+IE1hdGNoZXMgb24gdGhlIHZhbHVlIG9mIHRoZSBib29sZWFuLlxuICogb2JqZWN0ICAgLT4gRWFjaCBrZXkgb2YgdGhlIG9iamVjdCBpcyBtYXRjaGVkIG9uIHRoZSB2YWx1ZSwgYWxsIG11c3QgbWF0Y2guXG4gKiBmdW5jdGlvbiAtPiBUcmVhdGVkIGFzIGEgY29uc3RydWN0b3IgYW5kIHJlc3VsdHMgaW4gYW4gaW5zdGFuY2VvZiBjaGVjayBvclxuICogICAgICAgICAgICAgZm9yIFN0cmluZyxOdW1iZXIgYW5kIEJvb2xlYW4sIHRoaXMgdXNlcyB0aGUgdHlwZW9mIGNoZWNrLiBJZlxuICogICAgICAgICAgICAgdGhlIGZ1bmN0aW9uIGlzIFJlZ0V4cCB0aGVuIHdlIHVzZXMgdGhlIFJlZ0V4cC50ZXN0IGZ1bmN0aW9uXG4gKiAgICAgICAgICAgICBpbnN0ZWFkLlxuICovXG52YXIgdGVzdCA9IGZ1bmN0aW9uICh2YWx1ZSwgdCkge1xuICAgIGlmICgocHJpbXMuaW5kZXhPZih0eXBlb2YgdCkgPiAtMSkgJiYgKHZhbHVlID09PSB0KSlcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgZWxzZSBpZiAoKHR5cGVvZiB0ID09PSAnZnVuY3Rpb24nKSAmJlxuICAgICAgICAoKCh0ID09PSBTdHJpbmcpICYmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSkgfHxcbiAgICAgICAgICAgICgodCA9PT0gTnVtYmVyKSAmJiAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJykpIHx8XG4gICAgICAgICAgICAoKHQgPT09IEJvb2xlYW4pICYmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykpIHx8XG4gICAgICAgICAgICAoKHQgPT09IEFycmF5KSAmJiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpKSB8fFxuICAgICAgICAgICAgKHQgPT09IEFueSkgfHxcbiAgICAgICAgICAgICh2YWx1ZSBpbnN0YW5jZW9mIHQpKSlcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgZWxzZSBpZiAoKHQgaW5zdGFuY2VvZiBSZWdFeHApICYmXG4gICAgICAgICgodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgJiZcbiAgICAgICAgICAgIHQudGVzdCh2YWx1ZSkpKVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICBlbHNlIGlmICgodHlwZW9mIHQgPT09ICdvYmplY3QnKSAmJiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JykpXG4gICAgICAgIHJldHVybiBPYmplY3RcbiAgICAgICAgICAgIC5rZXlzKHQpXG4gICAgICAgICAgICAuZXZlcnkoZnVuY3Rpb24gKGspIHsgcmV0dXJuIE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCBrKSA/XG4gICAgICAgICAgICAoMCwgZXhwb3J0cy50ZXN0KSh2YWx1ZVtrXSwgdFtrXSkgOiBmYWxzZTsgfSk7XG4gICAgcmV0dXJuIGZhbHNlO1xufTtcbmV4cG9ydHMudGVzdCA9IHRlc3Q7XG4vKipcbiAqIHNob3cgdGhlIHR5cGUgb2YgYSB2YWx1ZS5cbiAqXG4gKiBOb3RlOiBUaGlzIG1heSBjcmFzaCBpZiB0aGUgdmFsdWUgaXMgYW5cbiAqIG9iamVjdCBsaXRlcmFsIHdpdGggcmVjdXJzaXZlIHJlZmVyZW5jZXMuXG4gKi9cbnZhciBzaG93ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKVxuICAgICAgICAgICAgcmV0dXJuIFwiW1wiICsgdmFsdWUubWFwKGV4cG9ydHMuc2hvdykgKyBcIl07XCI7XG4gICAgICAgIGVsc2UgaWYgKHZhbHVlLmNvbnN0cnVjdG9yICE9PSBPYmplY3QpXG4gICAgICAgICAgICByZXR1cm4gKHZhbHVlLmNvbnN0cnVjdG9yLm5hbWUgfHxcbiAgICAgICAgICAgICAgICB2YWx1ZS5jb25zdHJ1Y3Rvcik7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gJycgKyB2YWx1ZTtcbiAgICB9XG59O1xuZXhwb3J0cy5zaG93ID0gc2hvdztcbi8qKlxuICogdG9TdHJpbmcgY2FzdHMgYSB2YWx1ZSB0byBhIHN0cmluZy5cbiAqXG4gKiBJZiB0aGUgdmFsdWUgaXMgbnVsbCBvciB1bmRlZmluZWQgYW4gZW1wdHkgc3RyaW5nIGlzIHJldHVybmVkIGluc3RlYWQgb2ZcbiAqIHRoZSBkZWZhdWx0LlxuICovXG52YXIgdG9TdHJpbmcgPSBmdW5jdGlvbiAodmFsKSB7XG4gICAgcmV0dXJuICh2YWwgPT0gbnVsbCkgPyAnJyA6IFN0cmluZyh2YWwpO1xufTtcbmV4cG9ydHMudG9TdHJpbmcgPSB0b1N0cmluZztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5yb3VuZCA9IGV4cG9ydHMuaXNNdWx0aXBsZU9mID0gdm9pZCAwO1xuLyoqXG4gKiBpc011bHRpcGxlT2YgdGVzdHMgd2hldGhlciB0aGUgSW50ZWdlciAneScgaXMgYSBtdWx0aXBsZSBvZiB4LlxuICovXG52YXIgaXNNdWx0aXBsZU9mID0gZnVuY3Rpb24gKHgsIHkpIHsgcmV0dXJuICgoeSAlIHgpID09PSAwKTsgfTtcbmV4cG9ydHMuaXNNdWx0aXBsZU9mID0gaXNNdWx0aXBsZU9mO1xuLyoqXG4gKiByb3VuZCBhIG51bWJlciBcInhcIiB0byBcIm5cIiBwbGFjZXMgKG4gZGVmYXVsdHMgdG8gMCBwbGFjZXMpLlxuICpcbiAqIFRoaXMgdXNlcyB0aGUgTWF0aC5yb3VuZCh4ICogbikgLyBuIG1ldGhvZCBob3dldmVyIHdlIHRha2UgaW50b1xuICogY29uc2lkZXJhdGlvbiB0aGUgTWF0aC5yb3VuZCgxLjAwNSAqIDEwMCkgLyAxMDAgPT09IDEgaXNzdWUgYnkgdXNlIG9mIGFuXG4gKiBvZmZzZXQ6XG4gKlxuICogc2lnbiAqIChyb3VuZCgoYWJzKHgpICogMTBebikgKyAoMSAvIDEwXm4rMSkpIC8gMTBebilcbiAqXG4gKiBXaGVyZTpcbiAqXG4gKiBzaWduIGlzIHRoZSBzaWduIG9mIHhcbiAqIHJvdW5kIGlzIE1hdGgucm91bmRcbiAqIGFicyBpcyBNYXRoLmFic1xuICogKDEgLyAxMF5uKzEpIGlzIHRoZSBvZmZzZXQuXG4gKlxuICogVGhlIG9mZnNldCBpcyBvbmx5IHVzZWQgaWYgbiBpcyBtb3JlIHRoYW4gemVyby4gVGhlIGFic29sdXRlIHZhbHVlIG9mIHhcbiAqIGlzIHVzZWQgaW4gdGhlIGNhbGN1bGF0aW9uIHRvIGF2b2lkIEphdmFTY3JpcHQgaWRpb3N5bmNyYWNpZXMgd2hlbiByb3VuZGluZ1xuICogMC41OlxuICogKE1hdGgucm91bmQoKDEuMDA1ICogMTAwKSswLjAwMSkgLyAxMDApID09PSAxLjAxXG4gKlxuICogd2hlcmVhc1xuICogKE1hdGgucm91bmQoKC0xLjAwNSAqIDEwMCkrMC4wMDEpIC8gMTAwKSA9PT0gLTFcbiAqXG4gKiBTZWUgdGhlIGRlc2NyaXB0aW9uIFtoZXJlXSggaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvTWF0aC9yb3VuZClcbiAqIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICovXG52YXIgcm91bmQgPSBmdW5jdGlvbiAoeCwgbikge1xuICAgIGlmIChuID09PSB2b2lkIDApIHsgbiA9IDA7IH1cbiAgICB2YXIgZXhwID0gTWF0aC5wb3coMTAsIG4pO1xuICAgIHZhciBzaWduID0geCA+PSAwID8gMSA6IC0xO1xuICAgIHZhciBvZmZzZXQgPSAobiA+IDApID8gKDEgLyAoTWF0aC5wb3coMTAsIG4gKyAxKSkpIDogMDtcbiAgICByZXR1cm4gc2lnbiAqIChNYXRoLnJvdW5kKChNYXRoLmFicyh4KSAqIGV4cCkgKyBvZmZzZXQpIC8gZXhwKTtcbn07XG5leHBvcnRzLnJvdW5kID0gcm91bmQ7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tYXRoLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuLyoqXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyBmdW5jdGlvbnMgdXNlZCBpbiB0ZW1wbGF0ZXMgdG8gZ2VuZXJhdGUgc3VwcG9ydGVkIERPTVxuICogbm9kZXMuXG4gKlxuICogVGhlIGlkZWEgaGVyZSBpcyB0byBwcm92aWRlIGFuIGFic3RyYWN0aW9uIG92ZXIgRE9NIGNvbnN0cnVjdGlvbiBzb1xuICogd2UgY2FuIGRldGVjdCB3aGV0aGVyIHdlIGFyZSBpbiBhIGJyb3dzZXIgb3IgZWxzZXdoZXJlIGFuZCBhZGp1c3QgdG9cbiAqIHN1aXRlLlxuICovXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5jcmVhdGVFbGVtZW50ID0gZXhwb3J0cy51bnNhZmUgPSBleHBvcnRzLnRleHQgPSBleHBvcnRzLmNyZWF0ZVVuc2FmZVRleHROb2RlID0gZXhwb3J0cy5jcmVhdGVUZXh0Tm9kZSA9IGV4cG9ydHMuZXNjYXBlSFRNTCA9IGV4cG9ydHMuZXNjYXBlQXR0clZhbHVlID0gZXhwb3J0cy5lc2NhcGVBdHRycyA9IGV4cG9ydHMuaXNCcm93c2VyID0gZXhwb3J0cy5XTUxET01FbGVtZW50ID0gZXhwb3J0cy5XTUxET01UZXh0ID0gZXhwb3J0cy5XTUxET01Ob2RlID0gZXhwb3J0cy5XTUxOb2RlTGlzdCA9IHZvaWQgMDtcbnZhciByZWNvcmRfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9yZWNvcmRcIik7XG52YXIgdHlwZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL3R5cGVcIik7XG4vLyBEZWNsYXJlZCBzbyBpc0Jyb3dzZXIgd29ya3Mgb24gbm9kZS5qcy5cbnZhciB3aW5kb3cgPSBnbG9iYWw7XG52YXIgZG9jdW1lbnQgPSBnbG9iYWwuZG9jdW1lbnQ7XG52YXIgRE9DVFlQRSA9ICc8IURPQ1RZUEUgaHRtbD4nO1xudmFyIEFUVFJfRVNDX01BUCA9IHtcbiAgICAnJic6ICdcXFxcdTAwMjYnLFxuICAgICc+JzogJ1xcXFx1MDAzZScsXG4gICAgJzwnOiAnXFxcXHUwMDNjJyxcbiAgICAnXCInOiAnXFxcXHUwMDIyJyxcbiAgICAnPSc6ICdcXFxcdTAwM2QnLFxuICAgICdcXHUwMDVjJzogJ1xcXFx1MDA1YycsXG4gICAgJ1xcdTIwMjgnOiAnXFxcXHUyMDI4JyxcbiAgICAnXFx1MjAyOSc6ICdcXFxcdTIwMjknXG59O1xudmFyIGF0dHJzRXNjUmVnZXggPSBuZXcgUmVnRXhwKFwiW1wiICsgcmVjb3JkXzEubWFwVG8oQVRUUl9FU0NfTUFQLCBmdW5jdGlvbiAoXywgaykgeyByZXR1cm4gazsgfSkgKyBcIl1cIiwgJ2cnKTtcbnZhciBIVE1MX0VOVF9NQVAgPSB7XG4gICAgJ1wiJzogJyZxdW90OycsXG4gICAgJyYnOiAnJmFtcDsnLFxuICAgICdcXCcnOiAnJmFwb3M7JyxcbiAgICAnPCc6ICcmbHQ7JyxcbiAgICAnPic6ICcmZ3Q7J1xufTtcbnZhciBodG1sRXNjUmVnZXggPSBuZXcgUmVnRXhwKFwiW1wiICsgcmVjb3JkXzEubWFwVG8oSFRNTF9FTlRfTUFQLCBmdW5jdGlvbiAoXywgaykgeyByZXR1cm4gazsgfSkgKyBcIl1cIiwgJ2cnKTtcbnZhciB2b2lkRWxlbWVudHMgPSBbXG4gICAgJ2FyZWEnLFxuICAgICdiYXNlJyxcbiAgICAnYnInLFxuICAgICdjb2wnLFxuICAgICdjb21tYW5kJyxcbiAgICAnZW1iZWQnLFxuICAgICdocicsXG4gICAgJ2ltZycsXG4gICAgJ2lucHV0JyxcbiAgICAna2V5Z2VuJyxcbiAgICAnbGluaycsXG4gICAgJ21ldGEnLFxuICAgICdwYXJhbScsXG4gICAgJ3NvdXJjZScsXG4gICAgJ3RyYWNrJyxcbiAgICAnd2JyJ1xuXTtcbi8qKlxuICogV01MTm9kZUxpc3QgaW1wbGVtZW50YXRpb24uXG4gKiBAcHJpdmF0ZVxuICovXG52YXIgV01MTm9kZUxpc3QgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gV01MTm9kZUxpc3QoKSB7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gMDtcbiAgICB9XG4gICAgV01MTm9kZUxpc3QucHJvdG90eXBlLml0ZW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG4gICAgV01MTm9kZUxpc3QucHJvdG90eXBlLmZvckVhY2ggPSBmdW5jdGlvbiAoKSB7IH07XG4gICAgcmV0dXJuIFdNTE5vZGVMaXN0O1xufSgpKTtcbmV4cG9ydHMuV01MTm9kZUxpc3QgPSBXTUxOb2RlTGlzdDtcbi8qKlxuICogV01MRE9NTm9kZSBpbXBsZW1lbnRzIHRoZSBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzIG9mIHRoZSBET00gTm9kZSBpbnRlcmZhY2UgdG9cbiAqIGFsbG93IGEgZmFrZSBET00gdG8gYmUgYnVpbHQgaW4gc2VydmVyIHNpZGUgY29kZS5cbiAqXG4gKiBNb3N0IG9mIHRoZSBtZXRob2RzIGFuZCBwcm9wZXJ0aWVzIGNhbm5vdCBiZSByZWxpZWQgb24gYW5kIHNob3VsZCBub3QgYmVcbiAqIHVzZWQuXG4gKi9cbnZhciBXTUxET01Ob2RlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFdNTERPTU5vZGUobm9kZU5hbWUsIG5vZGVUeXBlKSB7XG4gICAgICAgIHRoaXMubm9kZU5hbWUgPSBub2RlTmFtZTtcbiAgICAgICAgdGhpcy5ub2RlVHlwZSA9IG5vZGVUeXBlO1xuICAgICAgICB0aGlzLkFUVFJJQlVURV9OT0RFID0gLTE7XG4gICAgICAgIHRoaXMuQ0RBVEFfU0VDVElPTl9OT0RFID0gLTE7XG4gICAgICAgIHRoaXMuQ09NTUVOVF9OT0RFID0gLTE7XG4gICAgICAgIHRoaXMuRE9DVU1FTlRfRlJBR01FTlRfTk9ERSA9IC0xO1xuICAgICAgICB0aGlzLkRPQ1VNRU5UX05PREUgPSAtMTtcbiAgICAgICAgdGhpcy5ET0NVTUVOVF9QT1NJVElPTl9DT05UQUlORURfQlkgPSAtMTtcbiAgICAgICAgdGhpcy5ET0NVTUVOVF9QT1NJVElPTl9DT05UQUlOUyA9IC0xO1xuICAgICAgICB0aGlzLkRPQ1VNRU5UX1BPU0lUSU9OX0RJU0NPTk5FQ1RFRCA9IC0xO1xuICAgICAgICB0aGlzLkRPQ1VNRU5UX1BPU0lUSU9OX0ZPTExPV0lORyA9IC0xO1xuICAgICAgICB0aGlzLkRPQ1VNRU5UX1BPU0lUSU9OX0lNUExFTUVOVEFUSU9OX1NQRUNJRklDID0gLTE7XG4gICAgICAgIHRoaXMuRE9DVU1FTlRfUE9TSVRJT05fUFJFQ0VESU5HID0gLTE7XG4gICAgICAgIHRoaXMuRE9DVU1FTlRfVFlQRV9OT0RFID0gLTE7XG4gICAgICAgIHRoaXMuRUxFTUVOVF9OT0RFID0gLTE7XG4gICAgICAgIHRoaXMuRU5USVRZX05PREUgPSAtMTtcbiAgICAgICAgdGhpcy5FTlRJVFlfUkVGRVJFTkNFX05PREUgPSAtMTtcbiAgICAgICAgdGhpcy5OT1RBVElPTl9OT0RFID0gLTE7XG4gICAgICAgIHRoaXMuUFJPQ0VTU0lOR19JTlNUUlVDVElPTl9OT0RFID0gLTE7XG4gICAgICAgIHRoaXMuVEVYVF9OT0RFID0gLTE7XG4gICAgICAgIHRoaXMuYmFzZVVSSSA9ICcnO1xuICAgICAgICB0aGlzLmNoaWxkTm9kZXMgPSBuZXcgV01MTm9kZUxpc3QoKTtcbiAgICAgICAgdGhpcy5maXJzdENoaWxkID0gbnVsbDtcbiAgICAgICAgdGhpcy5pc0Nvbm5lY3RlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmxhc3RDaGlsZCA9IG51bGw7XG4gICAgICAgIHRoaXMubmFtZXNwYWNlVVJJID0gbnVsbDtcbiAgICAgICAgdGhpcy5uZXh0U2libGluZyA9IG51bGw7XG4gICAgICAgIHRoaXMubm9kZVZhbHVlID0gbnVsbDtcbiAgICAgICAgdGhpcy5vd25lckRvY3VtZW50ID0gbnVsbDtcbiAgICAgICAgdGhpcy5wYXJlbnRFbGVtZW50ID0gbnVsbDtcbiAgICAgICAgdGhpcy5wYXJlbnROb2RlID0gbnVsbDtcbiAgICAgICAgdGhpcy5wcmV2aW91c1NpYmxpbmcgPSBudWxsO1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoV01MRE9NTm9kZS5wcm90b3R5cGUsIFwidGV4dENvbnRlbnRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIFdNTERPTU5vZGUucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7IH07XG4gICAgV01MRE9NTm9kZS5wcm90b3R5cGUuZGlzcGF0Y2hFdmVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgV01MRE9NTm9kZS5wcm90b3R5cGUucmVtb3ZlRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHsgfTtcbiAgICBXTUxET01Ob2RlLnByb3RvdHlwZS5hcHBlbmRDaGlsZCA9IGZ1bmN0aW9uIChuZXdDaGlsZCkge1xuICAgICAgICByZXR1cm4gbmV3Q2hpbGQ7XG4gICAgfTtcbiAgICBXTUxET01Ob2RlLnByb3RvdHlwZS5jbG9uZU5vZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgV01MRE9NTm9kZS5wcm90b3R5cGUuY29tcGFyZURvY3VtZW50UG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH07XG4gICAgV01MRE9NTm9kZS5wcm90b3R5cGUuY29udGFpbnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIFdNTERPTU5vZGUucHJvdG90eXBlLmdldFJvb3ROb2RlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIFdNTERPTU5vZGUucHJvdG90eXBlLmhhc0NoaWxkTm9kZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIFdNTERPTU5vZGUucHJvdG90eXBlLmluc2VydEJlZm9yZSA9IGZ1bmN0aW9uIChuZXdDaGlsZCkge1xuICAgICAgICByZXR1cm4gbmV3Q2hpbGQ7XG4gICAgfTtcbiAgICBXTUxET01Ob2RlLnByb3RvdHlwZS5pc0RlZmF1bHROYW1lc3BhY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIFdNTERPTU5vZGUucHJvdG90eXBlLmlzRXF1YWxOb2RlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICBXTUxET01Ob2RlLnByb3RvdHlwZS5pc1NhbWVOb2RlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICBXTUxET01Ob2RlLnByb3RvdHlwZS5sb29rdXBOYW1lc3BhY2VVUkkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG4gICAgV01MRE9NTm9kZS5wcm90b3R5cGUubG9va3VwUHJlZml4ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuICAgIFdNTERPTU5vZGUucHJvdG90eXBlLm5vcm1hbGl6ZSA9IGZ1bmN0aW9uICgpIHsgfTtcbiAgICBXTUxET01Ob2RlLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoKSB7IH07XG4gICAgV01MRE9NTm9kZS5wcm90b3R5cGUuYmVmb3JlID0gZnVuY3Rpb24gKCkgeyB9O1xuICAgIFdNTERPTU5vZGUucHJvdG90eXBlLmFmdGVyID0gZnVuY3Rpb24gKCkgeyB9O1xuICAgIFdNTERPTU5vZGUucHJvdG90eXBlLnJlcGxhY2VXaXRoID0gZnVuY3Rpb24gKCkgeyB9O1xuICAgIFdNTERPTU5vZGUucHJvdG90eXBlLnJlbW92ZUNoaWxkID0gZnVuY3Rpb24gKG9sZENoaWxkKSB7XG4gICAgICAgIHJldHVybiBvbGRDaGlsZDtcbiAgICB9O1xuICAgIFdNTERPTU5vZGUucHJvdG90eXBlLnJlcGxhY2VDaGlsZCA9IGZ1bmN0aW9uIChfLCBvbGRDaGlsZCkge1xuICAgICAgICByZXR1cm4gb2xkQ2hpbGQ7XG4gICAgfTtcbiAgICByZXR1cm4gV01MRE9NTm9kZTtcbn0oKSk7XG5leHBvcnRzLldNTERPTU5vZGUgPSBXTUxET01Ob2RlO1xuLyoqXG4gKiBXTUxET01UZXh0IGlzIHVzZWQgdG8gcmVwcmVzZW50IFRleHQgbm9kZXMgb24gdGhlIHNlcnZlciBzaWRlLlxuICogQHByaXZhdGVcbiAqL1xudmFyIFdNTERPTVRleHQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFdNTERPTVRleHQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gV01MRE9NVGV4dCh2YWx1ZSwgZXNjYXBlKSB7XG4gICAgICAgIGlmIChlc2NhcGUgPT09IHZvaWQgMCkgeyBlc2NhcGUgPSB0cnVlOyB9XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsICcjdGV4dCcsIC0xKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgICBfdGhpcy5lc2NhcGUgPSBlc2NhcGU7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdNTERPTVRleHQucHJvdG90eXBlLCBcInRleHRDb250ZW50XCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lc2NhcGUgPyBleHBvcnRzLmVzY2FwZUhUTUwodGhpcy52YWx1ZSkgOiB0aGlzLnZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgcmV0dXJuIFdNTERPTVRleHQ7XG59KFdNTERPTU5vZGUpKTtcbmV4cG9ydHMuV01MRE9NVGV4dCA9IFdNTERPTVRleHQ7XG4vKipcbiAqIFdNTERPTUVsZW1lbnQgaXMgdXNlZCB0byByZXByZXNlbnQgRWxlbWVudCBub2RlcyBvbiB0aGUgc2VydmVyIHNpZGUuXG4gKiBAcHJpdmF0ZVxuICovXG52YXIgV01MRE9NRWxlbWVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoV01MRE9NRWxlbWVudCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBXTUxET01FbGVtZW50KHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIGlmIChjaGlsZHJlbiA9PT0gdm9pZCAwKSB7IGNoaWxkcmVuID0gW107IH1cbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgdGFnLCAtMSkgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudGFnID0gdGFnO1xuICAgICAgICBfdGhpcy5hdHRycyA9IGF0dHJzO1xuICAgICAgICBfdGhpcy5jaGlsZHJlbiA9IGNoaWxkcmVuO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXTUxET01FbGVtZW50LnByb3RvdHlwZSwgXCJpbm5lckhUTUxcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuLm1hcChmdW5jdGlvbiAoYykgeyByZXR1cm4gKGMubm9kZU5hbWUgPT09ICcjdGV4dCcpID9cbiAgICAgICAgICAgICAgICBjLnRleHRDb250ZW50IDpcbiAgICAgICAgICAgICAgICBjLm91dGVySFRNTDsgfSkuam9pbignJyk7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoV01MRE9NRWxlbWVudC5wcm90b3R5cGUsIFwib3V0ZXJIVE1MXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdGFnID0gdGhpcy50YWc7XG4gICAgICAgICAgICB2YXIgY29udGVudCA9IHRoaXMuaW5uZXJIVE1MO1xuICAgICAgICAgICAgdmFyIGF0dHJzID0gcmVjb3JkXzEubWFwVG8oZXhwb3J0cy5lc2NhcGVBdHRycyh0aGlzLmF0dHJzKSwgZnVuY3Rpb24gKHZhbHVlLCBuYW1lKSB7IHJldHVybiAhdmFsdWUgP1xuICAgICAgICAgICAgICAgIG5hbWUgOiBuYW1lICsgXCI9XFxcIlwiICsgdmFsdWUgKyBcIlxcXCJcIjsgfSkuam9pbignICcpO1xuICAgICAgICAgICAgYXR0cnMgPSAoYXR0cnMudHJpbSgpICE9ICcnKSA/IFwiIFwiICsgYXR0cnMgOiAnJztcbiAgICAgICAgICAgIHZhciBvcGVuID0gXCI8XCIgKyB0YWcgKyBhdHRycyArIFwiPlwiO1xuICAgICAgICAgICAgaWYgKHRhZyA9PT0gXCJodG1sXCIpXG4gICAgICAgICAgICAgICAgb3BlbiA9IFwiXCIgKyBET0NUWVBFICsgb3BlbjtcbiAgICAgICAgICAgIHJldHVybiAodm9pZEVsZW1lbnRzLmluZGV4T2YodGFnKSA+IC0xKSA/XG4gICAgICAgICAgICAgICAgb3BlbiA6IFwiXCIgKyBvcGVuICsgY29udGVudCArIFwiPC9cIiArIHRhZyArIFwiPlwiO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgV01MRE9NRWxlbWVudC5wcm90b3R5cGUuc2V0QXR0cmlidXRlID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5hdHRyc1trZXldID0gdmFsdWU7XG4gICAgfTtcbiAgICBXTUxET01FbGVtZW50LnByb3RvdHlwZS5hcHBlbmRDaGlsZCA9IGZ1bmN0aW9uIChuZXdDaGlsZCkge1xuICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2gobmV3Q2hpbGQpO1xuICAgICAgICByZXR1cm4gbmV3Q2hpbGQ7XG4gICAgfTtcbiAgICByZXR1cm4gV01MRE9NRWxlbWVudDtcbn0oV01MRE9NTm9kZSkpO1xuZXhwb3J0cy5XTUxET01FbGVtZW50ID0gV01MRE9NRWxlbWVudDtcbi8qKlxuICogaXNCcm93c2VyIGlzIHNldCB0byB0cnVlIGlmIHdlIGRldGVjdCBhIHdpbmRvdyBhbmQgZG9jdW1lbnQgZ2xvYmFsIHZhcmlhYmxlLlxuICovXG5leHBvcnRzLmlzQnJvd3NlciA9ICgod2luZG93ICE9IG51bGwpICYmIChkb2N1bWVudCAhPSBudWxsKSk7XG4vKipcbiAqIGVzY2FwZUF0dHJzIGVzY2FwZXMgZWFjaCBrZXkgdmFsdWUgcGFpciBvZiBhIFdNTERPTUF0dHJzLlxuICovXG52YXIgZXNjYXBlQXR0cnMgPSBmdW5jdGlvbiAoYXR0cnMpIHsgcmV0dXJuIHJlY29yZF8xLm1hcChhdHRycywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgcmV0dXJuIHR5cGVfMS5pc0Z1bmN0aW9uKHZhbHVlKSA/IHZhbHVlIDpcbiAgICAgICAgKHZhbHVlIGluc3RhbmNlb2YgV01MRE9NVGV4dCkgPyB2YWx1ZS50ZXh0Q29udGVudCA6XG4gICAgICAgICAgICBleHBvcnRzLmVzY2FwZUF0dHJWYWx1ZShTdHJpbmcodmFsdWUpKTtcbn0pOyB9O1xuZXhwb3J0cy5lc2NhcGVBdHRycyA9IGVzY2FwZUF0dHJzO1xuLyoqXG4gKiBlc2NhcGVBdHRyVmFsdWUgZm9yIHNhZmUgYnJvd3NlciBkaXNwbGF5LlxuICovXG52YXIgZXNjYXBlQXR0clZhbHVlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlLnJlcGxhY2UoYXR0cnNFc2NSZWdleCwgZnVuY3Rpb24gKGhpdCkgeyByZXR1cm4gQVRUUl9FU0NfTUFQW2hpdF07IH0pO1xufTtcbmV4cG9ydHMuZXNjYXBlQXR0clZhbHVlID0gZXNjYXBlQXR0clZhbHVlO1xuLyoqXG4gKiBlc2NhcGVIVE1MIGZvciBzYWZlIGJyb3dzZXIgZGlzcGxheS5cbiAqL1xudmFyIGVzY2FwZUhUTUwgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUucmVwbGFjZShodG1sRXNjUmVnZXgsIGZ1bmN0aW9uIChoaXQpIHsgcmV0dXJuIEhUTUxfRU5UX01BUFtoaXRdOyB9KTtcbn07XG5leHBvcnRzLmVzY2FwZUhUTUwgPSBlc2NhcGVIVE1MO1xuLyoqXG4gKiBjcmVhdGVUZXh0Tm9kZSB3cmFwcGVyLlxuICovXG52YXIgY3JlYXRlVGV4dE5vZGUgPSBmdW5jdGlvbiAodHh0KSB7XG4gICAgdmFyIHN0ciA9IFN0cmluZygodHh0ID09IG51bGwpID8gJycgOiB0eHQpO1xuICAgIHJldHVybiBleHBvcnRzLmlzQnJvd3NlciA/IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHN0cikgOiBuZXcgV01MRE9NVGV4dChzdHIpO1xufTtcbmV4cG9ydHMuY3JlYXRlVGV4dE5vZGUgPSBjcmVhdGVUZXh0Tm9kZTtcbmV4cG9ydHMudGV4dCA9IGV4cG9ydHMuY3JlYXRlVGV4dE5vZGU7XG4vKipcbiAqIGNyZWF0ZVVuc2FmZVRleHROb2RlIGFsbG93cyByYXcgc3RyaW5ncyB0byBiZSBvdXRwdXQgd2l0aG91dCBlc2NhcGluZy5cbiAqXG4gKiBUaGlzIG9ubHkgd29ya3Mgb24gdGhlIHNlcnZlciBzaWRlLlxuICovXG52YXIgY3JlYXRlVW5zYWZlVGV4dE5vZGUgPSBmdW5jdGlvbiAodHh0KSB7XG4gICAgdmFyIHN0ciA9IFN0cmluZygodHh0ID09IG51bGwpID8gJycgOiB0eHQpO1xuICAgIHJldHVybiBleHBvcnRzLmlzQnJvd3NlciA/IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHN0cikgOiBuZXcgV01MRE9NVGV4dChzdHIsIGZhbHNlKTtcbn07XG5leHBvcnRzLmNyZWF0ZVVuc2FmZVRleHROb2RlID0gY3JlYXRlVW5zYWZlVGV4dE5vZGU7XG5leHBvcnRzLnVuc2FmZSA9IGV4cG9ydHMuY3JlYXRlVW5zYWZlVGV4dE5vZGU7XG4vKipcbiAqIGNyZWF0ZUVsZW1lbnQgd3JhcHBlci5cbiAqL1xudmFyIGNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICBpZiAoYXR0cnMgPT09IHZvaWQgMCkgeyBhdHRycyA9IHt9OyB9XG4gICAgaWYgKGNoaWxkcmVuID09PSB2b2lkIDApIHsgY2hpbGRyZW4gPSBbXTsgfVxuICAgIGlmICghZXhwb3J0cy5pc0Jyb3dzZXIpIHtcbiAgICAgICAgLy8gWFhYOiBUaGUgd2hvbGUgRWxlbWVudCBpbnRlcmZhY2UgaXMgbm90IGltcGxlbWVudGVkIGJ1dCBvbiBzZXJ2ZXJcbiAgICAgICAgLy8gc2lkZSB3ZSBhcmUgb25seSBpbnRlcmVzdGVkIGluIHNldEF0dHJpYnV0ZS5cbiAgICAgICAgcmV0dXJuIG5ldyBXTUxET01FbGVtZW50KHRhZywgYXR0cnMsIGNoaWxkcmVuKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHZhciBlXzEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIHJlY29yZF8xLmZvckVhY2goYXR0cnMsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZV8xW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvLyBwcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9XCJcIlxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGVfMS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGVfMS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICBlXzEuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKSk7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZV8xLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGVfMTtcbiAgICB9XG59O1xuZXhwb3J0cy5jcmVhdGVFbGVtZW50ID0gY3JlYXRlRWxlbWVudDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRvbS5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucmVuZGVyQXNOb2RlID0gZXhwb3J0cy5Db21wb25lbnQgPSB2b2lkIDA7XG4vKipcbiAqIENvbXBvbmVudCBpcyBhbiBhYnN0cmFjdCBXaWRnZXQgaW1wbGVtZW50YXRpb25cbiAqIHRoYXQgY2FuIGJlIHVzZWQgaW5zdGVhZCBvZiBtYW51YWxseSBpbXBsZW1lbnRpbmcgdGhlIHdob2xlIGludGVyZmFjZS5cbiAqL1xudmFyIENvbXBvbmVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0F9IGF0dHJzIGlzIHRoZSBhdHRyaWJ1dGVzIHRoaXMgQ29tcG9uZW50IGV4Y2VwdHMuXG4gICAgICogQHBhcmFtIHtDb250ZW50W119IGNoaWxkcmVuIGlzIGFuIGFycmF5IG9mIGNvbnRlbnQgZm9yIENvbXBvbmVudC5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBDb21wb25lbnQoYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHRoaXMuYXR0cnMgPSBhdHRycztcbiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IGNoaWxkcmVuO1xuICAgIH1cbiAgICBDb21wb25lbnQucHJvdG90eXBlLnJlbmRlcmVkID0gZnVuY3Rpb24gKCkgeyB9O1xuICAgIENvbXBvbmVudC5wcm90b3R5cGUucmVtb3ZlZCA9IGZ1bmN0aW9uICgpIHsgfTtcbiAgICBDb21wb25lbnQucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMudmlldy5yZW5kZXIoKTsgfTtcbiAgICByZXR1cm4gQ29tcG9uZW50O1xufSgpKTtcbmV4cG9ydHMuQ29tcG9uZW50ID0gQ29tcG9uZW50O1xuO1xuLyoqXG4gKiByZW5kZXJBc05vZGUgY29udGVudCBmcm9tIGEgUmVuZGVyYWJsZS5cbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIHVuc2FmZWx5IGFzc3VtZXMgdGhlIFJlbmRlcmFibGUgYWx3YXlzIHJldHVybnMgRE9NIGNvbnRlbnQuXG4gKi9cbnZhciByZW5kZXJBc05vZGUgPSBmdW5jdGlvbiAocikge1xuICAgIHJldHVybiByLnJlbmRlcigpO1xufTtcbmV4cG9ydHMucmVuZGVyQXNOb2RlID0gcmVuZGVyQXNOb2RlO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiLy8hIG1vbWVudC5qc1xuLy8hIHZlcnNpb24gOiAyLjI5LjFcbi8vISBhdXRob3JzIDogVGltIFdvb2QsIElza3JlbiBDaGVybmV2LCBNb21lbnQuanMgY29udHJpYnV0b3JzXG4vLyEgbGljZW5zZSA6IE1JVFxuLy8hIG1vbWVudGpzLmNvbVxuXG47KGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHtcbiAgICB0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgPyBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKSA6XG4gICAgdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKGZhY3RvcnkpIDpcbiAgICBnbG9iYWwubW9tZW50ID0gZmFjdG9yeSgpXG59KHRoaXMsIChmdW5jdGlvbiAoKSB7ICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBob29rQ2FsbGJhY2s7XG5cbiAgICBmdW5jdGlvbiBob29rcygpIHtcbiAgICAgICAgcmV0dXJuIGhvb2tDYWxsYmFjay5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuICAgIH1cblxuICAgIC8vIFRoaXMgaXMgZG9uZSB0byByZWdpc3RlciB0aGUgbWV0aG9kIGNhbGxlZCB3aXRoIG1vbWVudCgpXG4gICAgLy8gd2l0aG91dCBjcmVhdGluZyBjaXJjdWxhciBkZXBlbmRlbmNpZXMuXG4gICAgZnVuY3Rpb24gc2V0SG9va0NhbGxiYWNrKGNhbGxiYWNrKSB7XG4gICAgICAgIGhvb2tDYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzQXJyYXkoaW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIGlucHV0IGluc3RhbmNlb2YgQXJyYXkgfHxcbiAgICAgICAgICAgIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpbnB1dCkgPT09ICdbb2JqZWN0IEFycmF5XSdcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpc09iamVjdChpbnB1dCkge1xuICAgICAgICAvLyBJRTggd2lsbCB0cmVhdCB1bmRlZmluZWQgYW5kIG51bGwgYXMgb2JqZWN0IGlmIGl0IHdhc24ndCBmb3JcbiAgICAgICAgLy8gaW5wdXQgIT0gbnVsbFxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgaW5wdXQgIT0gbnVsbCAmJlxuICAgICAgICAgICAgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGlucHV0KSA9PT0gJ1tvYmplY3QgT2JqZWN0XSdcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBoYXNPd25Qcm9wKGEsIGIpIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChhLCBiKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpc09iamVjdEVtcHR5KG9iaikge1xuICAgICAgICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMpIHtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhvYmopLmxlbmd0aCA9PT0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBrO1xuICAgICAgICAgICAgZm9yIChrIGluIG9iaikge1xuICAgICAgICAgICAgICAgIGlmIChoYXNPd25Qcm9wKG9iaiwgaykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNVbmRlZmluZWQoaW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIGlucHV0ID09PSB2b2lkIDA7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNOdW1iZXIoaW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIHR5cGVvZiBpbnB1dCA9PT0gJ251bWJlcicgfHxcbiAgICAgICAgICAgIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpbnB1dCkgPT09ICdbb2JqZWN0IE51bWJlcl0nXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNEYXRlKGlucHV0KSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICBpbnB1dCBpbnN0YW5jZW9mIERhdGUgfHxcbiAgICAgICAgICAgIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpbnB1dCkgPT09ICdbb2JqZWN0IERhdGVdJ1xuICAgICAgICApO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1hcChhcnIsIGZuKSB7XG4gICAgICAgIHZhciByZXMgPSBbXSxcbiAgICAgICAgICAgIGk7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHJlcy5wdXNoKGZuKGFycltpXSwgaSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZXh0ZW5kKGEsIGIpIHtcbiAgICAgICAgZm9yICh2YXIgaSBpbiBiKSB7XG4gICAgICAgICAgICBpZiAoaGFzT3duUHJvcChiLCBpKSkge1xuICAgICAgICAgICAgICAgIGFbaV0gPSBiW2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGhhc093blByb3AoYiwgJ3RvU3RyaW5nJykpIHtcbiAgICAgICAgICAgIGEudG9TdHJpbmcgPSBiLnRvU3RyaW5nO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGhhc093blByb3AoYiwgJ3ZhbHVlT2YnKSkge1xuICAgICAgICAgICAgYS52YWx1ZU9mID0gYi52YWx1ZU9mO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGE7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlVVRDKGlucHV0LCBmb3JtYXQsIGxvY2FsZSwgc3RyaWN0KSB7XG4gICAgICAgIHJldHVybiBjcmVhdGVMb2NhbE9yVVRDKGlucHV0LCBmb3JtYXQsIGxvY2FsZSwgc3RyaWN0LCB0cnVlKS51dGMoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkZWZhdWx0UGFyc2luZ0ZsYWdzKCkge1xuICAgICAgICAvLyBXZSBuZWVkIHRvIGRlZXAgY2xvbmUgdGhpcyBvYmplY3QuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBlbXB0eTogZmFsc2UsXG4gICAgICAgICAgICB1bnVzZWRUb2tlbnM6IFtdLFxuICAgICAgICAgICAgdW51c2VkSW5wdXQ6IFtdLFxuICAgICAgICAgICAgb3ZlcmZsb3c6IC0yLFxuICAgICAgICAgICAgY2hhcnNMZWZ0T3ZlcjogMCxcbiAgICAgICAgICAgIG51bGxJbnB1dDogZmFsc2UsXG4gICAgICAgICAgICBpbnZhbGlkRXJhOiBudWxsLFxuICAgICAgICAgICAgaW52YWxpZE1vbnRoOiBudWxsLFxuICAgICAgICAgICAgaW52YWxpZEZvcm1hdDogZmFsc2UsXG4gICAgICAgICAgICB1c2VySW52YWxpZGF0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgaXNvOiBmYWxzZSxcbiAgICAgICAgICAgIHBhcnNlZERhdGVQYXJ0czogW10sXG4gICAgICAgICAgICBlcmE6IG51bGwsXG4gICAgICAgICAgICBtZXJpZGllbTogbnVsbCxcbiAgICAgICAgICAgIHJmYzI4MjI6IGZhbHNlLFxuICAgICAgICAgICAgd2Vla2RheU1pc21hdGNoOiBmYWxzZSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRQYXJzaW5nRmxhZ3MobSkge1xuICAgICAgICBpZiAobS5fcGYgPT0gbnVsbCkge1xuICAgICAgICAgICAgbS5fcGYgPSBkZWZhdWx0UGFyc2luZ0ZsYWdzKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG0uX3BmO1xuICAgIH1cblxuICAgIHZhciBzb21lO1xuICAgIGlmIChBcnJheS5wcm90b3R5cGUuc29tZSkge1xuICAgICAgICBzb21lID0gQXJyYXkucHJvdG90eXBlLnNvbWU7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgc29tZSA9IGZ1bmN0aW9uIChmdW4pIHtcbiAgICAgICAgICAgIHZhciB0ID0gT2JqZWN0KHRoaXMpLFxuICAgICAgICAgICAgICAgIGxlbiA9IHQubGVuZ3RoID4+PiAwLFxuICAgICAgICAgICAgICAgIGk7XG5cbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChpIGluIHQgJiYgZnVuLmNhbGwodGhpcywgdFtpXSwgaSwgdCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNWYWxpZChtKSB7XG4gICAgICAgIGlmIChtLl9pc1ZhbGlkID09IG51bGwpIHtcbiAgICAgICAgICAgIHZhciBmbGFncyA9IGdldFBhcnNpbmdGbGFncyhtKSxcbiAgICAgICAgICAgICAgICBwYXJzZWRQYXJ0cyA9IHNvbWUuY2FsbChmbGFncy5wYXJzZWREYXRlUGFydHMsIGZ1bmN0aW9uIChpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpICE9IG51bGw7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgaXNOb3dWYWxpZCA9XG4gICAgICAgICAgICAgICAgICAgICFpc05hTihtLl9kLmdldFRpbWUoKSkgJiZcbiAgICAgICAgICAgICAgICAgICAgZmxhZ3Mub3ZlcmZsb3cgPCAwICYmXG4gICAgICAgICAgICAgICAgICAgICFmbGFncy5lbXB0eSAmJlxuICAgICAgICAgICAgICAgICAgICAhZmxhZ3MuaW52YWxpZEVyYSAmJlxuICAgICAgICAgICAgICAgICAgICAhZmxhZ3MuaW52YWxpZE1vbnRoICYmXG4gICAgICAgICAgICAgICAgICAgICFmbGFncy5pbnZhbGlkV2Vla2RheSAmJlxuICAgICAgICAgICAgICAgICAgICAhZmxhZ3Mud2Vla2RheU1pc21hdGNoICYmXG4gICAgICAgICAgICAgICAgICAgICFmbGFncy5udWxsSW5wdXQgJiZcbiAgICAgICAgICAgICAgICAgICAgIWZsYWdzLmludmFsaWRGb3JtYXQgJiZcbiAgICAgICAgICAgICAgICAgICAgIWZsYWdzLnVzZXJJbnZhbGlkYXRlZCAmJlxuICAgICAgICAgICAgICAgICAgICAoIWZsYWdzLm1lcmlkaWVtIHx8IChmbGFncy5tZXJpZGllbSAmJiBwYXJzZWRQYXJ0cykpO1xuXG4gICAgICAgICAgICBpZiAobS5fc3RyaWN0KSB7XG4gICAgICAgICAgICAgICAgaXNOb3dWYWxpZCA9XG4gICAgICAgICAgICAgICAgICAgIGlzTm93VmFsaWQgJiZcbiAgICAgICAgICAgICAgICAgICAgZmxhZ3MuY2hhcnNMZWZ0T3ZlciA9PT0gMCAmJlxuICAgICAgICAgICAgICAgICAgICBmbGFncy51bnVzZWRUb2tlbnMubGVuZ3RoID09PSAwICYmXG4gICAgICAgICAgICAgICAgICAgIGZsYWdzLmJpZ0hvdXIgPT09IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKE9iamVjdC5pc0Zyb3plbiA9PSBudWxsIHx8ICFPYmplY3QuaXNGcm96ZW4obSkpIHtcbiAgICAgICAgICAgICAgICBtLl9pc1ZhbGlkID0gaXNOb3dWYWxpZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlzTm93VmFsaWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG0uX2lzVmFsaWQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlSW52YWxpZChmbGFncykge1xuICAgICAgICB2YXIgbSA9IGNyZWF0ZVVUQyhOYU4pO1xuICAgICAgICBpZiAoZmxhZ3MgIT0gbnVsbCkge1xuICAgICAgICAgICAgZXh0ZW5kKGdldFBhcnNpbmdGbGFncyhtKSwgZmxhZ3MpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKG0pLnVzZXJJbnZhbGlkYXRlZCA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbTtcbiAgICB9XG5cbiAgICAvLyBQbHVnaW5zIHRoYXQgYWRkIHByb3BlcnRpZXMgc2hvdWxkIGFsc28gYWRkIHRoZSBrZXkgaGVyZSAobnVsbCB2YWx1ZSksXG4gICAgLy8gc28gd2UgY2FuIHByb3Blcmx5IGNsb25lIG91cnNlbHZlcy5cbiAgICB2YXIgbW9tZW50UHJvcGVydGllcyA9IChob29rcy5tb21lbnRQcm9wZXJ0aWVzID0gW10pLFxuICAgICAgICB1cGRhdGVJblByb2dyZXNzID0gZmFsc2U7XG5cbiAgICBmdW5jdGlvbiBjb3B5Q29uZmlnKHRvLCBmcm9tKSB7XG4gICAgICAgIHZhciBpLCBwcm9wLCB2YWw7XG5cbiAgICAgICAgaWYgKCFpc1VuZGVmaW5lZChmcm9tLl9pc0FNb21lbnRPYmplY3QpKSB7XG4gICAgICAgICAgICB0by5faXNBTW9tZW50T2JqZWN0ID0gZnJvbS5faXNBTW9tZW50T2JqZWN0O1xuICAgICAgICB9XG4gICAgICAgIGlmICghaXNVbmRlZmluZWQoZnJvbS5faSkpIHtcbiAgICAgICAgICAgIHRvLl9pID0gZnJvbS5faTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzVW5kZWZpbmVkKGZyb20uX2YpKSB7XG4gICAgICAgICAgICB0by5fZiA9IGZyb20uX2Y7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFpc1VuZGVmaW5lZChmcm9tLl9sKSkge1xuICAgICAgICAgICAgdG8uX2wgPSBmcm9tLl9sO1xuICAgICAgICB9XG4gICAgICAgIGlmICghaXNVbmRlZmluZWQoZnJvbS5fc3RyaWN0KSkge1xuICAgICAgICAgICAgdG8uX3N0cmljdCA9IGZyb20uX3N0cmljdDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzVW5kZWZpbmVkKGZyb20uX3R6bSkpIHtcbiAgICAgICAgICAgIHRvLl90em0gPSBmcm9tLl90em07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFpc1VuZGVmaW5lZChmcm9tLl9pc1VUQykpIHtcbiAgICAgICAgICAgIHRvLl9pc1VUQyA9IGZyb20uX2lzVVRDO1xuICAgICAgICB9XG4gICAgICAgIGlmICghaXNVbmRlZmluZWQoZnJvbS5fb2Zmc2V0KSkge1xuICAgICAgICAgICAgdG8uX29mZnNldCA9IGZyb20uX29mZnNldDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzVW5kZWZpbmVkKGZyb20uX3BmKSkge1xuICAgICAgICAgICAgdG8uX3BmID0gZ2V0UGFyc2luZ0ZsYWdzKGZyb20pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghaXNVbmRlZmluZWQoZnJvbS5fbG9jYWxlKSkge1xuICAgICAgICAgICAgdG8uX2xvY2FsZSA9IGZyb20uX2xvY2FsZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtb21lbnRQcm9wZXJ0aWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBtb21lbnRQcm9wZXJ0aWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgcHJvcCA9IG1vbWVudFByb3BlcnRpZXNbaV07XG4gICAgICAgICAgICAgICAgdmFsID0gZnJvbVtwcm9wXTtcbiAgICAgICAgICAgICAgICBpZiAoIWlzVW5kZWZpbmVkKHZhbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9bcHJvcF0gPSB2YWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRvO1xuICAgIH1cblxuICAgIC8vIE1vbWVudCBwcm90b3R5cGUgb2JqZWN0XG4gICAgZnVuY3Rpb24gTW9tZW50KGNvbmZpZykge1xuICAgICAgICBjb3B5Q29uZmlnKHRoaXMsIGNvbmZpZyk7XG4gICAgICAgIHRoaXMuX2QgPSBuZXcgRGF0ZShjb25maWcuX2QgIT0gbnVsbCA/IGNvbmZpZy5fZC5nZXRUaW1lKCkgOiBOYU4pO1xuICAgICAgICBpZiAoIXRoaXMuaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICB0aGlzLl9kID0gbmV3IERhdGUoTmFOKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBQcmV2ZW50IGluZmluaXRlIGxvb3AgaW4gY2FzZSB1cGRhdGVPZmZzZXQgY3JlYXRlcyBuZXcgbW9tZW50XG4gICAgICAgIC8vIG9iamVjdHMuXG4gICAgICAgIGlmICh1cGRhdGVJblByb2dyZXNzID09PSBmYWxzZSkge1xuICAgICAgICAgICAgdXBkYXRlSW5Qcm9ncmVzcyA9IHRydWU7XG4gICAgICAgICAgICBob29rcy51cGRhdGVPZmZzZXQodGhpcyk7XG4gICAgICAgICAgICB1cGRhdGVJblByb2dyZXNzID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpc01vbWVudChvYmopIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIG9iaiBpbnN0YW5jZW9mIE1vbWVudCB8fCAob2JqICE9IG51bGwgJiYgb2JqLl9pc0FNb21lbnRPYmplY3QgIT0gbnVsbClcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB3YXJuKG1zZykge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgICBob29rcy5zdXBwcmVzc0RlcHJlY2F0aW9uV2FybmluZ3MgPT09IGZhbHNlICYmXG4gICAgICAgICAgICB0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICAgICAgICAgIGNvbnNvbGUud2FyblxuICAgICAgICApIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignRGVwcmVjYXRpb24gd2FybmluZzogJyArIG1zZyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkZXByZWNhdGUobXNnLCBmbikge1xuICAgICAgICB2YXIgZmlyc3RUaW1lID0gdHJ1ZTtcblxuICAgICAgICByZXR1cm4gZXh0ZW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChob29rcy5kZXByZWNhdGlvbkhhbmRsZXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGhvb2tzLmRlcHJlY2F0aW9uSGFuZGxlcihudWxsLCBtc2cpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZpcnN0VGltZSkge1xuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gW10sXG4gICAgICAgICAgICAgICAgICAgIGFyZyxcbiAgICAgICAgICAgICAgICAgICAgaSxcbiAgICAgICAgICAgICAgICAgICAga2V5O1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgYXJnID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYXJndW1lbnRzW2ldID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJnICs9ICdcXG5bJyArIGkgKyAnXSAnO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChrZXkgaW4gYXJndW1lbnRzWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhc093blByb3AoYXJndW1lbnRzWzBdLCBrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZyArPSBrZXkgKyAnOiAnICsgYXJndW1lbnRzWzBdW2tleV0gKyAnLCAnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZyA9IGFyZy5zbGljZSgwLCAtMik7IC8vIFJlbW92ZSB0cmFpbGluZyBjb21tYSBhbmQgc3BhY2VcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFyZyA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2goYXJnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgd2FybihcbiAgICAgICAgICAgICAgICAgICAgbXNnICtcbiAgICAgICAgICAgICAgICAgICAgICAgICdcXG5Bcmd1bWVudHM6ICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJncykuam9pbignJykgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJ1xcbicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEVycm9yKCkuc3RhY2tcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGZpcnN0VGltZSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH0sIGZuKTtcbiAgICB9XG5cbiAgICB2YXIgZGVwcmVjYXRpb25zID0ge307XG5cbiAgICBmdW5jdGlvbiBkZXByZWNhdGVTaW1wbGUobmFtZSwgbXNnKSB7XG4gICAgICAgIGlmIChob29rcy5kZXByZWNhdGlvbkhhbmRsZXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgaG9va3MuZGVwcmVjYXRpb25IYW5kbGVyKG5hbWUsIG1zZyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkZXByZWNhdGlvbnNbbmFtZV0pIHtcbiAgICAgICAgICAgIHdhcm4obXNnKTtcbiAgICAgICAgICAgIGRlcHJlY2F0aW9uc1tuYW1lXSA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBob29rcy5zdXBwcmVzc0RlcHJlY2F0aW9uV2FybmluZ3MgPSBmYWxzZTtcbiAgICBob29rcy5kZXByZWNhdGlvbkhhbmRsZXIgPSBudWxsO1xuXG4gICAgZnVuY3Rpb24gaXNGdW5jdGlvbihpbnB1dCkge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgKHR5cGVvZiBGdW5jdGlvbiAhPT0gJ3VuZGVmaW5lZCcgJiYgaW5wdXQgaW5zdGFuY2VvZiBGdW5jdGlvbikgfHxcbiAgICAgICAgICAgIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpbnB1dCkgPT09ICdbb2JqZWN0IEZ1bmN0aW9uXSdcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXQoY29uZmlnKSB7XG4gICAgICAgIHZhciBwcm9wLCBpO1xuICAgICAgICBmb3IgKGkgaW4gY29uZmlnKSB7XG4gICAgICAgICAgICBpZiAoaGFzT3duUHJvcChjb25maWcsIGkpKSB7XG4gICAgICAgICAgICAgICAgcHJvcCA9IGNvbmZpZ1tpXTtcbiAgICAgICAgICAgICAgICBpZiAoaXNGdW5jdGlvbihwcm9wKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzW2ldID0gcHJvcDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzWydfJyArIGldID0gcHJvcDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY29uZmlnID0gY29uZmlnO1xuICAgICAgICAvLyBMZW5pZW50IG9yZGluYWwgcGFyc2luZyBhY2NlcHRzIGp1c3QgYSBudW1iZXIgaW4gYWRkaXRpb24gdG9cbiAgICAgICAgLy8gbnVtYmVyICsgKHBvc3NpYmx5KSBzdHVmZiBjb21pbmcgZnJvbSBfZGF5T2ZNb250aE9yZGluYWxQYXJzZS5cbiAgICAgICAgLy8gVE9ETzogUmVtb3ZlIFwib3JkaW5hbFBhcnNlXCIgZmFsbGJhY2sgaW4gbmV4dCBtYWpvciByZWxlYXNlLlxuICAgICAgICB0aGlzLl9kYXlPZk1vbnRoT3JkaW5hbFBhcnNlTGVuaWVudCA9IG5ldyBSZWdFeHAoXG4gICAgICAgICAgICAodGhpcy5fZGF5T2ZNb250aE9yZGluYWxQYXJzZS5zb3VyY2UgfHwgdGhpcy5fb3JkaW5hbFBhcnNlLnNvdXJjZSkgK1xuICAgICAgICAgICAgICAgICd8JyArXG4gICAgICAgICAgICAgICAgL1xcZHsxLDJ9Ly5zb3VyY2VcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtZXJnZUNvbmZpZ3MocGFyZW50Q29uZmlnLCBjaGlsZENvbmZpZykge1xuICAgICAgICB2YXIgcmVzID0gZXh0ZW5kKHt9LCBwYXJlbnRDb25maWcpLFxuICAgICAgICAgICAgcHJvcDtcbiAgICAgICAgZm9yIChwcm9wIGluIGNoaWxkQ29uZmlnKSB7XG4gICAgICAgICAgICBpZiAoaGFzT3duUHJvcChjaGlsZENvbmZpZywgcHJvcCkpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNPYmplY3QocGFyZW50Q29uZmlnW3Byb3BdKSAmJiBpc09iamVjdChjaGlsZENvbmZpZ1twcm9wXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzW3Byb3BdID0ge307XG4gICAgICAgICAgICAgICAgICAgIGV4dGVuZChyZXNbcHJvcF0sIHBhcmVudENvbmZpZ1twcm9wXSk7XG4gICAgICAgICAgICAgICAgICAgIGV4dGVuZChyZXNbcHJvcF0sIGNoaWxkQ29uZmlnW3Byb3BdKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoaWxkQ29uZmlnW3Byb3BdICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzW3Byb3BdID0gY2hpbGRDb25maWdbcHJvcF07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHJlc1twcm9wXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChwcm9wIGluIHBhcmVudENvbmZpZykge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIGhhc093blByb3AocGFyZW50Q29uZmlnLCBwcm9wKSAmJlxuICAgICAgICAgICAgICAgICFoYXNPd25Qcm9wKGNoaWxkQ29uZmlnLCBwcm9wKSAmJlxuICAgICAgICAgICAgICAgIGlzT2JqZWN0KHBhcmVudENvbmZpZ1twcm9wXSlcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBjaGFuZ2VzIHRvIHByb3BlcnRpZXMgZG9uJ3QgbW9kaWZ5IHBhcmVudCBjb25maWdcbiAgICAgICAgICAgICAgICByZXNbcHJvcF0gPSBleHRlbmQoe30sIHJlc1twcm9wXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBMb2NhbGUoY29uZmlnKSB7XG4gICAgICAgIGlmIChjb25maWcgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5zZXQoY29uZmlnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhciBrZXlzO1xuXG4gICAgaWYgKE9iamVjdC5rZXlzKSB7XG4gICAgICAgIGtleXMgPSBPYmplY3Qua2V5cztcbiAgICB9IGVsc2Uge1xuICAgICAgICBrZXlzID0gZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgdmFyIGksXG4gICAgICAgICAgICAgICAgcmVzID0gW107XG4gICAgICAgICAgICBmb3IgKGkgaW4gb2JqKSB7XG4gICAgICAgICAgICAgICAgaWYgKGhhc093blByb3Aob2JqLCBpKSkge1xuICAgICAgICAgICAgICAgICAgICByZXMucHVzaChpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIHZhciBkZWZhdWx0Q2FsZW5kYXIgPSB7XG4gICAgICAgIHNhbWVEYXk6ICdbVG9kYXkgYXRdIExUJyxcbiAgICAgICAgbmV4dERheTogJ1tUb21vcnJvdyBhdF0gTFQnLFxuICAgICAgICBuZXh0V2VlazogJ2RkZGQgW2F0XSBMVCcsXG4gICAgICAgIGxhc3REYXk6ICdbWWVzdGVyZGF5IGF0XSBMVCcsXG4gICAgICAgIGxhc3RXZWVrOiAnW0xhc3RdIGRkZGQgW2F0XSBMVCcsXG4gICAgICAgIHNhbWVFbHNlOiAnTCcsXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGNhbGVuZGFyKGtleSwgbW9tLCBub3cpIHtcbiAgICAgICAgdmFyIG91dHB1dCA9IHRoaXMuX2NhbGVuZGFyW2tleV0gfHwgdGhpcy5fY2FsZW5kYXJbJ3NhbWVFbHNlJ107XG4gICAgICAgIHJldHVybiBpc0Z1bmN0aW9uKG91dHB1dCkgPyBvdXRwdXQuY2FsbChtb20sIG5vdykgOiBvdXRwdXQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gemVyb0ZpbGwobnVtYmVyLCB0YXJnZXRMZW5ndGgsIGZvcmNlU2lnbikge1xuICAgICAgICB2YXIgYWJzTnVtYmVyID0gJycgKyBNYXRoLmFicyhudW1iZXIpLFxuICAgICAgICAgICAgemVyb3NUb0ZpbGwgPSB0YXJnZXRMZW5ndGggLSBhYnNOdW1iZXIubGVuZ3RoLFxuICAgICAgICAgICAgc2lnbiA9IG51bWJlciA+PSAwO1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgKHNpZ24gPyAoZm9yY2VTaWduID8gJysnIDogJycpIDogJy0nKSArXG4gICAgICAgICAgICBNYXRoLnBvdygxMCwgTWF0aC5tYXgoMCwgemVyb3NUb0ZpbGwpKS50b1N0cmluZygpLnN1YnN0cigxKSArXG4gICAgICAgICAgICBhYnNOdW1iZXJcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICB2YXIgZm9ybWF0dGluZ1Rva2VucyA9IC8oXFxbW15cXFtdKlxcXSl8KFxcXFwpPyhbSGhdbW0oc3MpP3xNb3xNTT9NP00/fERvfERERG98REQ/RD9EP3xkZGQ/ZD98ZG8/fHdbb3x3XT98V1tvfFddP3xRbz98TnsxLDV9fFlZWVlZWXxZWVlZWXxZWVlZfFlZfHl7Miw0fXx5bz98Z2coZ2dnPyk/fEdHKEdHRz8pP3xlfEV8YXxBfGhoP3xISD98a2s/fG1tP3xzcz98U3sxLDl9fHh8WHx6ej98Wlo/fC4pL2csXG4gICAgICAgIGxvY2FsRm9ybWF0dGluZ1Rva2VucyA9IC8oXFxbW15cXFtdKlxcXSl8KFxcXFwpPyhMVFN8TFR8TEw/TD9MP3xsezEsNH0pL2csXG4gICAgICAgIGZvcm1hdEZ1bmN0aW9ucyA9IHt9LFxuICAgICAgICBmb3JtYXRUb2tlbkZ1bmN0aW9ucyA9IHt9O1xuXG4gICAgLy8gdG9rZW46ICAgICdNJ1xuICAgIC8vIHBhZGRlZDogICBbJ01NJywgMl1cbiAgICAvLyBvcmRpbmFsOiAgJ01vJ1xuICAgIC8vIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7IHRoaXMubW9udGgoKSArIDEgfVxuICAgIGZ1bmN0aW9uIGFkZEZvcm1hdFRva2VuKHRva2VuLCBwYWRkZWQsIG9yZGluYWwsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBmdW5jID0gY2FsbGJhY2s7XG4gICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBmdW5jID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzW2NhbGxiYWNrXSgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgIGZvcm1hdFRva2VuRnVuY3Rpb25zW3Rva2VuXSA9IGZ1bmM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhZGRlZCkge1xuICAgICAgICAgICAgZm9ybWF0VG9rZW5GdW5jdGlvbnNbcGFkZGVkWzBdXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gemVyb0ZpbGwoZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCBwYWRkZWRbMV0sIHBhZGRlZFsyXSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcmRpbmFsKSB7XG4gICAgICAgICAgICBmb3JtYXRUb2tlbkZ1bmN0aW9uc1tvcmRpbmFsXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVEYXRhKCkub3JkaW5hbChcbiAgICAgICAgICAgICAgICAgICAgZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpLFxuICAgICAgICAgICAgICAgICAgICB0b2tlblxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVtb3ZlRm9ybWF0dGluZ1Rva2VucyhpbnB1dCkge1xuICAgICAgICBpZiAoaW5wdXQubWF0Y2goL1xcW1tcXHNcXFNdLykpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnB1dC5yZXBsYWNlKC9eXFxbfFxcXSQvZywgJycpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpbnB1dC5yZXBsYWNlKC9cXFxcL2csICcnKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtYWtlRm9ybWF0RnVuY3Rpb24oZm9ybWF0KSB7XG4gICAgICAgIHZhciBhcnJheSA9IGZvcm1hdC5tYXRjaChmb3JtYXR0aW5nVG9rZW5zKSxcbiAgICAgICAgICAgIGksXG4gICAgICAgICAgICBsZW5ndGg7XG5cbiAgICAgICAgZm9yIChpID0gMCwgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChmb3JtYXRUb2tlbkZ1bmN0aW9uc1thcnJheVtpXV0pIHtcbiAgICAgICAgICAgICAgICBhcnJheVtpXSA9IGZvcm1hdFRva2VuRnVuY3Rpb25zW2FycmF5W2ldXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYXJyYXlbaV0gPSByZW1vdmVGb3JtYXR0aW5nVG9rZW5zKGFycmF5W2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAobW9tKSB7XG4gICAgICAgICAgICB2YXIgb3V0cHV0ID0gJycsXG4gICAgICAgICAgICAgICAgaTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIG91dHB1dCArPSBpc0Z1bmN0aW9uKGFycmF5W2ldKVxuICAgICAgICAgICAgICAgICAgICA/IGFycmF5W2ldLmNhbGwobW9tLCBmb3JtYXQpXG4gICAgICAgICAgICAgICAgICAgIDogYXJyYXlbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gb3V0cHV0O1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8vIGZvcm1hdCBkYXRlIHVzaW5nIG5hdGl2ZSBkYXRlIG9iamVjdFxuICAgIGZ1bmN0aW9uIGZvcm1hdE1vbWVudChtLCBmb3JtYXQpIHtcbiAgICAgICAgaWYgKCFtLmlzVmFsaWQoKSkge1xuICAgICAgICAgICAgcmV0dXJuIG0ubG9jYWxlRGF0YSgpLmludmFsaWREYXRlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBmb3JtYXQgPSBleHBhbmRGb3JtYXQoZm9ybWF0LCBtLmxvY2FsZURhdGEoKSk7XG4gICAgICAgIGZvcm1hdEZ1bmN0aW9uc1tmb3JtYXRdID1cbiAgICAgICAgICAgIGZvcm1hdEZ1bmN0aW9uc1tmb3JtYXRdIHx8IG1ha2VGb3JtYXRGdW5jdGlvbihmb3JtYXQpO1xuXG4gICAgICAgIHJldHVybiBmb3JtYXRGdW5jdGlvbnNbZm9ybWF0XShtKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBleHBhbmRGb3JtYXQoZm9ybWF0LCBsb2NhbGUpIHtcbiAgICAgICAgdmFyIGkgPSA1O1xuXG4gICAgICAgIGZ1bmN0aW9uIHJlcGxhY2VMb25nRGF0ZUZvcm1hdFRva2VucyhpbnB1dCkge1xuICAgICAgICAgICAgcmV0dXJuIGxvY2FsZS5sb25nRGF0ZUZvcm1hdChpbnB1dCkgfHwgaW5wdXQ7XG4gICAgICAgIH1cblxuICAgICAgICBsb2NhbEZvcm1hdHRpbmdUb2tlbnMubGFzdEluZGV4ID0gMDtcbiAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBsb2NhbEZvcm1hdHRpbmdUb2tlbnMudGVzdChmb3JtYXQpKSB7XG4gICAgICAgICAgICBmb3JtYXQgPSBmb3JtYXQucmVwbGFjZShcbiAgICAgICAgICAgICAgICBsb2NhbEZvcm1hdHRpbmdUb2tlbnMsXG4gICAgICAgICAgICAgICAgcmVwbGFjZUxvbmdEYXRlRm9ybWF0VG9rZW5zXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgbG9jYWxGb3JtYXR0aW5nVG9rZW5zLmxhc3RJbmRleCA9IDA7XG4gICAgICAgICAgICBpIC09IDE7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZm9ybWF0O1xuICAgIH1cblxuICAgIHZhciBkZWZhdWx0TG9uZ0RhdGVGb3JtYXQgPSB7XG4gICAgICAgIExUUzogJ2g6bW06c3MgQScsXG4gICAgICAgIExUOiAnaDptbSBBJyxcbiAgICAgICAgTDogJ01NL0REL1lZWVknLFxuICAgICAgICBMTDogJ01NTU0gRCwgWVlZWScsXG4gICAgICAgIExMTDogJ01NTU0gRCwgWVlZWSBoOm1tIEEnLFxuICAgICAgICBMTExMOiAnZGRkZCwgTU1NTSBELCBZWVlZIGg6bW0gQScsXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGxvbmdEYXRlRm9ybWF0KGtleSkge1xuICAgICAgICB2YXIgZm9ybWF0ID0gdGhpcy5fbG9uZ0RhdGVGb3JtYXRba2V5XSxcbiAgICAgICAgICAgIGZvcm1hdFVwcGVyID0gdGhpcy5fbG9uZ0RhdGVGb3JtYXRba2V5LnRvVXBwZXJDYXNlKCldO1xuXG4gICAgICAgIGlmIChmb3JtYXQgfHwgIWZvcm1hdFVwcGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gZm9ybWF0O1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fbG9uZ0RhdGVGb3JtYXRba2V5XSA9IGZvcm1hdFVwcGVyXG4gICAgICAgICAgICAubWF0Y2goZm9ybWF0dGluZ1Rva2VucylcbiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKHRvaykge1xuICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgdG9rID09PSAnTU1NTScgfHxcbiAgICAgICAgICAgICAgICAgICAgdG9rID09PSAnTU0nIHx8XG4gICAgICAgICAgICAgICAgICAgIHRvayA9PT0gJ0REJyB8fFxuICAgICAgICAgICAgICAgICAgICB0b2sgPT09ICdkZGRkJ1xuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdG9rLnNsaWNlKDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdG9rO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5qb2luKCcnKTtcblxuICAgICAgICByZXR1cm4gdGhpcy5fbG9uZ0RhdGVGb3JtYXRba2V5XTtcbiAgICB9XG5cbiAgICB2YXIgZGVmYXVsdEludmFsaWREYXRlID0gJ0ludmFsaWQgZGF0ZSc7XG5cbiAgICBmdW5jdGlvbiBpbnZhbGlkRGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ludmFsaWREYXRlO1xuICAgIH1cblxuICAgIHZhciBkZWZhdWx0T3JkaW5hbCA9ICclZCcsXG4gICAgICAgIGRlZmF1bHREYXlPZk1vbnRoT3JkaW5hbFBhcnNlID0gL1xcZHsxLDJ9LztcblxuICAgIGZ1bmN0aW9uIG9yZGluYWwobnVtYmVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9vcmRpbmFsLnJlcGxhY2UoJyVkJywgbnVtYmVyKTtcbiAgICB9XG5cbiAgICB2YXIgZGVmYXVsdFJlbGF0aXZlVGltZSA9IHtcbiAgICAgICAgZnV0dXJlOiAnaW4gJXMnLFxuICAgICAgICBwYXN0OiAnJXMgYWdvJyxcbiAgICAgICAgczogJ2EgZmV3IHNlY29uZHMnLFxuICAgICAgICBzczogJyVkIHNlY29uZHMnLFxuICAgICAgICBtOiAnYSBtaW51dGUnLFxuICAgICAgICBtbTogJyVkIG1pbnV0ZXMnLFxuICAgICAgICBoOiAnYW4gaG91cicsXG4gICAgICAgIGhoOiAnJWQgaG91cnMnLFxuICAgICAgICBkOiAnYSBkYXknLFxuICAgICAgICBkZDogJyVkIGRheXMnLFxuICAgICAgICB3OiAnYSB3ZWVrJyxcbiAgICAgICAgd3c6ICclZCB3ZWVrcycsXG4gICAgICAgIE06ICdhIG1vbnRoJyxcbiAgICAgICAgTU06ICclZCBtb250aHMnLFxuICAgICAgICB5OiAnYSB5ZWFyJyxcbiAgICAgICAgeXk6ICclZCB5ZWFycycsXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHJlbGF0aXZlVGltZShudW1iZXIsIHdpdGhvdXRTdWZmaXgsIHN0cmluZywgaXNGdXR1cmUpIHtcbiAgICAgICAgdmFyIG91dHB1dCA9IHRoaXMuX3JlbGF0aXZlVGltZVtzdHJpbmddO1xuICAgICAgICByZXR1cm4gaXNGdW5jdGlvbihvdXRwdXQpXG4gICAgICAgICAgICA/IG91dHB1dChudW1iZXIsIHdpdGhvdXRTdWZmaXgsIHN0cmluZywgaXNGdXR1cmUpXG4gICAgICAgICAgICA6IG91dHB1dC5yZXBsYWNlKC8lZC9pLCBudW1iZXIpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHBhc3RGdXR1cmUoZGlmZiwgb3V0cHV0KSB7XG4gICAgICAgIHZhciBmb3JtYXQgPSB0aGlzLl9yZWxhdGl2ZVRpbWVbZGlmZiA+IDAgPyAnZnV0dXJlJyA6ICdwYXN0J107XG4gICAgICAgIHJldHVybiBpc0Z1bmN0aW9uKGZvcm1hdCkgPyBmb3JtYXQob3V0cHV0KSA6IGZvcm1hdC5yZXBsYWNlKC8lcy9pLCBvdXRwdXQpO1xuICAgIH1cblxuICAgIHZhciBhbGlhc2VzID0ge307XG5cbiAgICBmdW5jdGlvbiBhZGRVbml0QWxpYXModW5pdCwgc2hvcnRoYW5kKSB7XG4gICAgICAgIHZhciBsb3dlckNhc2UgPSB1bml0LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGFsaWFzZXNbbG93ZXJDYXNlXSA9IGFsaWFzZXNbbG93ZXJDYXNlICsgJ3MnXSA9IGFsaWFzZXNbc2hvcnRoYW5kXSA9IHVuaXQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbm9ybWFsaXplVW5pdHModW5pdHMpIHtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiB1bml0cyA9PT0gJ3N0cmluZydcbiAgICAgICAgICAgID8gYWxpYXNlc1t1bml0c10gfHwgYWxpYXNlc1t1bml0cy50b0xvd2VyQ2FzZSgpXVxuICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbm9ybWFsaXplT2JqZWN0VW5pdHMoaW5wdXRPYmplY3QpIHtcbiAgICAgICAgdmFyIG5vcm1hbGl6ZWRJbnB1dCA9IHt9LFxuICAgICAgICAgICAgbm9ybWFsaXplZFByb3AsXG4gICAgICAgICAgICBwcm9wO1xuXG4gICAgICAgIGZvciAocHJvcCBpbiBpbnB1dE9iamVjdCkge1xuICAgICAgICAgICAgaWYgKGhhc093blByb3AoaW5wdXRPYmplY3QsIHByb3ApKSB7XG4gICAgICAgICAgICAgICAgbm9ybWFsaXplZFByb3AgPSBub3JtYWxpemVVbml0cyhwcm9wKTtcbiAgICAgICAgICAgICAgICBpZiAobm9ybWFsaXplZFByb3ApIHtcbiAgICAgICAgICAgICAgICAgICAgbm9ybWFsaXplZElucHV0W25vcm1hbGl6ZWRQcm9wXSA9IGlucHV0T2JqZWN0W3Byb3BdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBub3JtYWxpemVkSW5wdXQ7XG4gICAgfVxuXG4gICAgdmFyIHByaW9yaXRpZXMgPSB7fTtcblxuICAgIGZ1bmN0aW9uIGFkZFVuaXRQcmlvcml0eSh1bml0LCBwcmlvcml0eSkge1xuICAgICAgICBwcmlvcml0aWVzW3VuaXRdID0gcHJpb3JpdHk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0UHJpb3JpdGl6ZWRVbml0cyh1bml0c09iaikge1xuICAgICAgICB2YXIgdW5pdHMgPSBbXSxcbiAgICAgICAgICAgIHU7XG4gICAgICAgIGZvciAodSBpbiB1bml0c09iaikge1xuICAgICAgICAgICAgaWYgKGhhc093blByb3AodW5pdHNPYmosIHUpKSB7XG4gICAgICAgICAgICAgICAgdW5pdHMucHVzaCh7IHVuaXQ6IHUsIHByaW9yaXR5OiBwcmlvcml0aWVzW3VdIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHVuaXRzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgIHJldHVybiBhLnByaW9yaXR5IC0gYi5wcmlvcml0eTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB1bml0cztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpc0xlYXBZZWFyKHllYXIpIHtcbiAgICAgICAgcmV0dXJuICh5ZWFyICUgNCA9PT0gMCAmJiB5ZWFyICUgMTAwICE9PSAwKSB8fCB5ZWFyICUgNDAwID09PSAwO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFic0Zsb29yKG51bWJlcikge1xuICAgICAgICBpZiAobnVtYmVyIDwgMCkge1xuICAgICAgICAgICAgLy8gLTAgLT4gMFxuICAgICAgICAgICAgcmV0dXJuIE1hdGguY2VpbChudW1iZXIpIHx8IDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihudW1iZXIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdG9JbnQoYXJndW1lbnRGb3JDb2VyY2lvbikge1xuICAgICAgICB2YXIgY29lcmNlZE51bWJlciA9ICthcmd1bWVudEZvckNvZXJjaW9uLFxuICAgICAgICAgICAgdmFsdWUgPSAwO1xuXG4gICAgICAgIGlmIChjb2VyY2VkTnVtYmVyICE9PSAwICYmIGlzRmluaXRlKGNvZXJjZWROdW1iZXIpKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IGFic0Zsb29yKGNvZXJjZWROdW1iZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1ha2VHZXRTZXQodW5pdCwga2VlcFRpbWUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBzZXQkMSh0aGlzLCB1bml0LCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgaG9va3MudXBkYXRlT2Zmc2V0KHRoaXMsIGtlZXBUaW1lKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldCh0aGlzLCB1bml0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXQobW9tLCB1bml0KSB7XG4gICAgICAgIHJldHVybiBtb20uaXNWYWxpZCgpXG4gICAgICAgICAgICA/IG1vbS5fZFsnZ2V0JyArIChtb20uX2lzVVRDID8gJ1VUQycgOiAnJykgKyB1bml0XSgpXG4gICAgICAgICAgICA6IE5hTjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXQkMShtb20sIHVuaXQsIHZhbHVlKSB7XG4gICAgICAgIGlmIChtb20uaXNWYWxpZCgpICYmICFpc05hTih2YWx1ZSkpIHtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICB1bml0ID09PSAnRnVsbFllYXInICYmXG4gICAgICAgICAgICAgICAgaXNMZWFwWWVhcihtb20ueWVhcigpKSAmJlxuICAgICAgICAgICAgICAgIG1vbS5tb250aCgpID09PSAxICYmXG4gICAgICAgICAgICAgICAgbW9tLmRhdGUoKSA9PT0gMjlcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gdG9JbnQodmFsdWUpO1xuICAgICAgICAgICAgICAgIG1vbS5fZFsnc2V0JyArIChtb20uX2lzVVRDID8gJ1VUQycgOiAnJykgKyB1bml0XShcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIG1vbS5tb250aCgpLFxuICAgICAgICAgICAgICAgICAgICBkYXlzSW5Nb250aCh2YWx1ZSwgbW9tLm1vbnRoKCkpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9tLl9kWydzZXQnICsgKG1vbS5faXNVVEMgPyAnVVRDJyA6ICcnKSArIHVuaXRdKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIE1PTUVOVFNcblxuICAgIGZ1bmN0aW9uIHN0cmluZ0dldCh1bml0cykge1xuICAgICAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHVuaXRzKTtcbiAgICAgICAgaWYgKGlzRnVuY3Rpb24odGhpc1t1bml0c10pKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpc1t1bml0c10oKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzdHJpbmdTZXQodW5pdHMsIHZhbHVlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdW5pdHMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICB1bml0cyA9IG5vcm1hbGl6ZU9iamVjdFVuaXRzKHVuaXRzKTtcbiAgICAgICAgICAgIHZhciBwcmlvcml0aXplZCA9IGdldFByaW9yaXRpemVkVW5pdHModW5pdHMpLFxuICAgICAgICAgICAgICAgIGk7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcHJpb3JpdGl6ZWQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzW3ByaW9yaXRpemVkW2ldLnVuaXRdKHVuaXRzW3ByaW9yaXRpemVkW2ldLnVuaXRdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHVuaXRzID0gbm9ybWFsaXplVW5pdHModW5pdHMpO1xuICAgICAgICAgICAgaWYgKGlzRnVuY3Rpb24odGhpc1t1bml0c10pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNbdW5pdHNdKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICB2YXIgbWF0Y2gxID0gL1xcZC8sIC8vICAgICAgIDAgLSA5XG4gICAgICAgIG1hdGNoMiA9IC9cXGRcXGQvLCAvLyAgICAgIDAwIC0gOTlcbiAgICAgICAgbWF0Y2gzID0gL1xcZHszfS8sIC8vICAgICAwMDAgLSA5OTlcbiAgICAgICAgbWF0Y2g0ID0gL1xcZHs0fS8sIC8vICAgIDAwMDAgLSA5OTk5XG4gICAgICAgIG1hdGNoNiA9IC9bKy1dP1xcZHs2fS8sIC8vIC05OTk5OTkgLSA5OTk5OTlcbiAgICAgICAgbWF0Y2gxdG8yID0gL1xcZFxcZD8vLCAvLyAgICAgICAwIC0gOTlcbiAgICAgICAgbWF0Y2gzdG80ID0gL1xcZFxcZFxcZFxcZD8vLCAvLyAgICAgOTk5IC0gOTk5OVxuICAgICAgICBtYXRjaDV0bzYgPSAvXFxkXFxkXFxkXFxkXFxkXFxkPy8sIC8vICAgOTk5OTkgLSA5OTk5OTlcbiAgICAgICAgbWF0Y2gxdG8zID0gL1xcZHsxLDN9LywgLy8gICAgICAgMCAtIDk5OVxuICAgICAgICBtYXRjaDF0bzQgPSAvXFxkezEsNH0vLCAvLyAgICAgICAwIC0gOTk5OVxuICAgICAgICBtYXRjaDF0bzYgPSAvWystXT9cXGR7MSw2fS8sIC8vIC05OTk5OTkgLSA5OTk5OTlcbiAgICAgICAgbWF0Y2hVbnNpZ25lZCA9IC9cXGQrLywgLy8gICAgICAgMCAtIGluZlxuICAgICAgICBtYXRjaFNpZ25lZCA9IC9bKy1dP1xcZCsvLCAvLyAgICAtaW5mIC0gaW5mXG4gICAgICAgIG1hdGNoT2Zmc2V0ID0gL1p8WystXVxcZFxcZDo/XFxkXFxkL2dpLCAvLyArMDA6MDAgLTAwOjAwICswMDAwIC0wMDAwIG9yIFpcbiAgICAgICAgbWF0Y2hTaG9ydE9mZnNldCA9IC9afFsrLV1cXGRcXGQoPzo6P1xcZFxcZCk/L2dpLCAvLyArMDAgLTAwICswMDowMCAtMDA6MDAgKzAwMDAgLTAwMDAgb3IgWlxuICAgICAgICBtYXRjaFRpbWVzdGFtcCA9IC9bKy1dP1xcZCsoXFwuXFxkezEsM30pPy8sIC8vIDEyMzQ1Njc4OSAxMjM0NTY3ODkuMTIzXG4gICAgICAgIC8vIGFueSB3b3JkIChvciB0d28pIGNoYXJhY3RlcnMgb3IgbnVtYmVycyBpbmNsdWRpbmcgdHdvL3RocmVlIHdvcmQgbW9udGggaW4gYXJhYmljLlxuICAgICAgICAvLyBpbmNsdWRlcyBzY290dGlzaCBnYWVsaWMgdHdvIHdvcmQgYW5kIGh5cGhlbmF0ZWQgbW9udGhzXG4gICAgICAgIG1hdGNoV29yZCA9IC9bMC05XXswLDI1Nn1bJ2EtelxcdTAwQTAtXFx1MDVGRlxcdTA3MDAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkYwN1xcdUZGMTAtXFx1RkZFRl17MSwyNTZ9fFtcXHUwNjAwLVxcdTA2RkZcXC9dezEsMjU2fShcXHMqP1tcXHUwNjAwLVxcdTA2RkZdezEsMjU2fSl7MSwyfS9pLFxuICAgICAgICByZWdleGVzO1xuXG4gICAgcmVnZXhlcyA9IHt9O1xuXG4gICAgZnVuY3Rpb24gYWRkUmVnZXhUb2tlbih0b2tlbiwgcmVnZXgsIHN0cmljdFJlZ2V4KSB7XG4gICAgICAgIHJlZ2V4ZXNbdG9rZW5dID0gaXNGdW5jdGlvbihyZWdleClcbiAgICAgICAgICAgID8gcmVnZXhcbiAgICAgICAgICAgIDogZnVuY3Rpb24gKGlzU3RyaWN0LCBsb2NhbGVEYXRhKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gaXNTdHJpY3QgJiYgc3RyaWN0UmVnZXggPyBzdHJpY3RSZWdleCA6IHJlZ2V4O1xuICAgICAgICAgICAgICB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFBhcnNlUmVnZXhGb3JUb2tlbih0b2tlbiwgY29uZmlnKSB7XG4gICAgICAgIGlmICghaGFzT3duUHJvcChyZWdleGVzLCB0b2tlbikpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVnRXhwKHVuZXNjYXBlRm9ybWF0KHRva2VuKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVnZXhlc1t0b2tlbl0oY29uZmlnLl9zdHJpY3QsIGNvbmZpZy5fbG9jYWxlKTtcbiAgICB9XG5cbiAgICAvLyBDb2RlIGZyb20gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zNTYxNDkzL2lzLXRoZXJlLWEtcmVnZXhwLWVzY2FwZS1mdW5jdGlvbi1pbi1qYXZhc2NyaXB0XG4gICAgZnVuY3Rpb24gdW5lc2NhcGVGb3JtYXQocykge1xuICAgICAgICByZXR1cm4gcmVnZXhFc2NhcGUoXG4gICAgICAgICAgICBzXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoJ1xcXFwnLCAnJylcbiAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFxcXChcXFspfFxcXFwoXFxdKXxcXFsoW15cXF1cXFtdKilcXF18XFxcXCguKS9nLCBmdW5jdGlvbiAoXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZWQsXG4gICAgICAgICAgICAgICAgICAgIHAxLFxuICAgICAgICAgICAgICAgICAgICBwMixcbiAgICAgICAgICAgICAgICAgICAgcDMsXG4gICAgICAgICAgICAgICAgICAgIHA0XG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwMSB8fCBwMiB8fCBwMyB8fCBwNDtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlZ2V4RXNjYXBlKHMpIHtcbiAgICAgICAgcmV0dXJuIHMucmVwbGFjZSgvWy1cXC9cXFxcXiQqKz8uKCl8W1xcXXt9XS9nLCAnXFxcXCQmJyk7XG4gICAgfVxuXG4gICAgdmFyIHRva2VucyA9IHt9O1xuXG4gICAgZnVuY3Rpb24gYWRkUGFyc2VUb2tlbih0b2tlbiwgY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIGksXG4gICAgICAgICAgICBmdW5jID0gY2FsbGJhY2s7XG4gICAgICAgIGlmICh0eXBlb2YgdG9rZW4gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB0b2tlbiA9IFt0b2tlbl07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzTnVtYmVyKGNhbGxiYWNrKSkge1xuICAgICAgICAgICAgZnVuYyA9IGZ1bmN0aW9uIChpbnB1dCwgYXJyYXkpIHtcbiAgICAgICAgICAgICAgICBhcnJheVtjYWxsYmFja10gPSB0b0ludChpbnB1dCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCB0b2tlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdG9rZW5zW3Rva2VuW2ldXSA9IGZ1bmM7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhZGRXZWVrUGFyc2VUb2tlbih0b2tlbiwgY2FsbGJhY2spIHtcbiAgICAgICAgYWRkUGFyc2VUb2tlbih0b2tlbiwgZnVuY3Rpb24gKGlucHV0LCBhcnJheSwgY29uZmlnLCB0b2tlbikge1xuICAgICAgICAgICAgY29uZmlnLl93ID0gY29uZmlnLl93IHx8IHt9O1xuICAgICAgICAgICAgY2FsbGJhY2soaW5wdXQsIGNvbmZpZy5fdywgY29uZmlnLCB0b2tlbik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZFRpbWVUb0FycmF5RnJvbVRva2VuKHRva2VuLCBpbnB1dCwgY29uZmlnKSB7XG4gICAgICAgIGlmIChpbnB1dCAhPSBudWxsICYmIGhhc093blByb3AodG9rZW5zLCB0b2tlbikpIHtcbiAgICAgICAgICAgIHRva2Vuc1t0b2tlbl0oaW5wdXQsIGNvbmZpZy5fYSwgY29uZmlnLCB0b2tlbik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgWUVBUiA9IDAsXG4gICAgICAgIE1PTlRIID0gMSxcbiAgICAgICAgREFURSA9IDIsXG4gICAgICAgIEhPVVIgPSAzLFxuICAgICAgICBNSU5VVEUgPSA0LFxuICAgICAgICBTRUNPTkQgPSA1LFxuICAgICAgICBNSUxMSVNFQ09ORCA9IDYsXG4gICAgICAgIFdFRUsgPSA3LFxuICAgICAgICBXRUVLREFZID0gODtcblxuICAgIGZ1bmN0aW9uIG1vZChuLCB4KSB7XG4gICAgICAgIHJldHVybiAoKG4gJSB4KSArIHgpICUgeDtcbiAgICB9XG5cbiAgICB2YXIgaW5kZXhPZjtcblxuICAgIGlmIChBcnJheS5wcm90b3R5cGUuaW5kZXhPZikge1xuICAgICAgICBpbmRleE9mID0gQXJyYXkucHJvdG90eXBlLmluZGV4T2Y7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaW5kZXhPZiA9IGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAvLyBJIGtub3dcbiAgICAgICAgICAgIHZhciBpO1xuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpc1tpXSA9PT0gbykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGF5c0luTW9udGgoeWVhciwgbW9udGgpIHtcbiAgICAgICAgaWYgKGlzTmFOKHllYXIpIHx8IGlzTmFOKG1vbnRoKSkge1xuICAgICAgICAgICAgcmV0dXJuIE5hTjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbW9kTW9udGggPSBtb2QobW9udGgsIDEyKTtcbiAgICAgICAgeWVhciArPSAobW9udGggLSBtb2RNb250aCkgLyAxMjtcbiAgICAgICAgcmV0dXJuIG1vZE1vbnRoID09PSAxXG4gICAgICAgICAgICA/IGlzTGVhcFllYXIoeWVhcilcbiAgICAgICAgICAgICAgICA/IDI5XG4gICAgICAgICAgICAgICAgOiAyOFxuICAgICAgICAgICAgOiAzMSAtICgobW9kTW9udGggJSA3KSAlIDIpO1xuICAgIH1cblxuICAgIC8vIEZPUk1BVFRJTkdcblxuICAgIGFkZEZvcm1hdFRva2VuKCdNJywgWydNTScsIDJdLCAnTW8nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1vbnRoKCkgKyAxO1xuICAgIH0pO1xuXG4gICAgYWRkRm9ybWF0VG9rZW4oJ01NTScsIDAsIDAsIGZ1bmN0aW9uIChmb3JtYXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlRGF0YSgpLm1vbnRoc1Nob3J0KHRoaXMsIGZvcm1hdCk7XG4gICAgfSk7XG5cbiAgICBhZGRGb3JtYXRUb2tlbignTU1NTScsIDAsIDAsIGZ1bmN0aW9uIChmb3JtYXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlRGF0YSgpLm1vbnRocyh0aGlzLCBmb3JtYXQpO1xuICAgIH0pO1xuXG4gICAgLy8gQUxJQVNFU1xuXG4gICAgYWRkVW5pdEFsaWFzKCdtb250aCcsICdNJyk7XG5cbiAgICAvLyBQUklPUklUWVxuXG4gICAgYWRkVW5pdFByaW9yaXR5KCdtb250aCcsIDgpO1xuXG4gICAgLy8gUEFSU0lOR1xuXG4gICAgYWRkUmVnZXhUb2tlbignTScsIG1hdGNoMXRvMik7XG4gICAgYWRkUmVnZXhUb2tlbignTU0nLCBtYXRjaDF0bzIsIG1hdGNoMik7XG4gICAgYWRkUmVnZXhUb2tlbignTU1NJywgZnVuY3Rpb24gKGlzU3RyaWN0LCBsb2NhbGUpIHtcbiAgICAgICAgcmV0dXJuIGxvY2FsZS5tb250aHNTaG9ydFJlZ2V4KGlzU3RyaWN0KTtcbiAgICB9KTtcbiAgICBhZGRSZWdleFRva2VuKCdNTU1NJywgZnVuY3Rpb24gKGlzU3RyaWN0LCBsb2NhbGUpIHtcbiAgICAgICAgcmV0dXJuIGxvY2FsZS5tb250aHNSZWdleChpc1N0cmljdCk7XG4gICAgfSk7XG5cbiAgICBhZGRQYXJzZVRva2VuKFsnTScsICdNTSddLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5KSB7XG4gICAgICAgIGFycmF5W01PTlRIXSA9IHRvSW50KGlucHV0KSAtIDE7XG4gICAgfSk7XG5cbiAgICBhZGRQYXJzZVRva2VuKFsnTU1NJywgJ01NTU0nXSwgZnVuY3Rpb24gKGlucHV0LCBhcnJheSwgY29uZmlnLCB0b2tlbikge1xuICAgICAgICB2YXIgbW9udGggPSBjb25maWcuX2xvY2FsZS5tb250aHNQYXJzZShpbnB1dCwgdG9rZW4sIGNvbmZpZy5fc3RyaWN0KTtcbiAgICAgICAgLy8gaWYgd2UgZGlkbid0IGZpbmQgYSBtb250aCBuYW1lLCBtYXJrIHRoZSBkYXRlIGFzIGludmFsaWQuXG4gICAgICAgIGlmIChtb250aCAhPSBudWxsKSB7XG4gICAgICAgICAgICBhcnJheVtNT05USF0gPSBtb250aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLmludmFsaWRNb250aCA9IGlucHV0O1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBMT0NBTEVTXG5cbiAgICB2YXIgZGVmYXVsdExvY2FsZU1vbnRocyA9ICdKYW51YXJ5X0ZlYnJ1YXJ5X01hcmNoX0FwcmlsX01heV9KdW5lX0p1bHlfQXVndXN0X1NlcHRlbWJlcl9PY3RvYmVyX05vdmVtYmVyX0RlY2VtYmVyJy5zcGxpdChcbiAgICAgICAgICAgICdfJ1xuICAgICAgICApLFxuICAgICAgICBkZWZhdWx0TG9jYWxlTW9udGhzU2hvcnQgPSAnSmFuX0ZlYl9NYXJfQXByX01heV9KdW5fSnVsX0F1Z19TZXBfT2N0X05vdl9EZWMnLnNwbGl0KFxuICAgICAgICAgICAgJ18nXG4gICAgICAgICksXG4gICAgICAgIE1PTlRIU19JTl9GT1JNQVQgPSAvRFtvRF0/KFxcW1teXFxbXFxdXSpcXF18XFxzKStNTU1NPy8sXG4gICAgICAgIGRlZmF1bHRNb250aHNTaG9ydFJlZ2V4ID0gbWF0Y2hXb3JkLFxuICAgICAgICBkZWZhdWx0TW9udGhzUmVnZXggPSBtYXRjaFdvcmQ7XG5cbiAgICBmdW5jdGlvbiBsb2NhbGVNb250aHMobSwgZm9ybWF0KSB7XG4gICAgICAgIGlmICghbSkge1xuICAgICAgICAgICAgcmV0dXJuIGlzQXJyYXkodGhpcy5fbW9udGhzKVxuICAgICAgICAgICAgICAgID8gdGhpcy5fbW9udGhzXG4gICAgICAgICAgICAgICAgOiB0aGlzLl9tb250aHNbJ3N0YW5kYWxvbmUnXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaXNBcnJheSh0aGlzLl9tb250aHMpXG4gICAgICAgICAgICA/IHRoaXMuX21vbnRoc1ttLm1vbnRoKCldXG4gICAgICAgICAgICA6IHRoaXMuX21vbnRoc1tcbiAgICAgICAgICAgICAgICAgICh0aGlzLl9tb250aHMuaXNGb3JtYXQgfHwgTU9OVEhTX0lOX0ZPUk1BVCkudGVzdChmb3JtYXQpXG4gICAgICAgICAgICAgICAgICAgICAgPyAnZm9ybWF0J1xuICAgICAgICAgICAgICAgICAgICAgIDogJ3N0YW5kYWxvbmUnXG4gICAgICAgICAgICAgIF1bbS5tb250aCgpXTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsb2NhbGVNb250aHNTaG9ydChtLCBmb3JtYXQpIHtcbiAgICAgICAgaWYgKCFtKSB7XG4gICAgICAgICAgICByZXR1cm4gaXNBcnJheSh0aGlzLl9tb250aHNTaG9ydClcbiAgICAgICAgICAgICAgICA/IHRoaXMuX21vbnRoc1Nob3J0XG4gICAgICAgICAgICAgICAgOiB0aGlzLl9tb250aHNTaG9ydFsnc3RhbmRhbG9uZSddO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpc0FycmF5KHRoaXMuX21vbnRoc1Nob3J0KVxuICAgICAgICAgICAgPyB0aGlzLl9tb250aHNTaG9ydFttLm1vbnRoKCldXG4gICAgICAgICAgICA6IHRoaXMuX21vbnRoc1Nob3J0W1xuICAgICAgICAgICAgICAgICAgTU9OVEhTX0lOX0ZPUk1BVC50ZXN0KGZvcm1hdCkgPyAnZm9ybWF0JyA6ICdzdGFuZGFsb25lJ1xuICAgICAgICAgICAgICBdW20ubW9udGgoKV07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaGFuZGxlU3RyaWN0UGFyc2UobW9udGhOYW1lLCBmb3JtYXQsIHN0cmljdCkge1xuICAgICAgICB2YXIgaSxcbiAgICAgICAgICAgIGlpLFxuICAgICAgICAgICAgbW9tLFxuICAgICAgICAgICAgbGxjID0gbW9udGhOYW1lLnRvTG9jYWxlTG93ZXJDYXNlKCk7XG4gICAgICAgIGlmICghdGhpcy5fbW9udGhzUGFyc2UpIHtcbiAgICAgICAgICAgIC8vIHRoaXMgaXMgbm90IHVzZWRcbiAgICAgICAgICAgIHRoaXMuX21vbnRoc1BhcnNlID0gW107XG4gICAgICAgICAgICB0aGlzLl9sb25nTW9udGhzUGFyc2UgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuX3Nob3J0TW9udGhzUGFyc2UgPSBbXTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAxMjsgKytpKSB7XG4gICAgICAgICAgICAgICAgbW9tID0gY3JlYXRlVVRDKFsyMDAwLCBpXSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2hvcnRNb250aHNQYXJzZVtpXSA9IHRoaXMubW9udGhzU2hvcnQoXG4gICAgICAgICAgICAgICAgICAgIG1vbSxcbiAgICAgICAgICAgICAgICAgICAgJydcbiAgICAgICAgICAgICAgICApLnRvTG9jYWxlTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fbG9uZ01vbnRoc1BhcnNlW2ldID0gdGhpcy5tb250aHMobW9tLCAnJykudG9Mb2NhbGVMb3dlckNhc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdHJpY3QpIHtcbiAgICAgICAgICAgIGlmIChmb3JtYXQgPT09ICdNTU0nKSB7XG4gICAgICAgICAgICAgICAgaWkgPSBpbmRleE9mLmNhbGwodGhpcy5fc2hvcnRNb250aHNQYXJzZSwgbGxjKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gaWkgIT09IC0xID8gaWkgOiBudWxsO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpaSA9IGluZGV4T2YuY2FsbCh0aGlzLl9sb25nTW9udGhzUGFyc2UsIGxsYyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlpICE9PSAtMSA/IGlpIDogbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChmb3JtYXQgPT09ICdNTU0nKSB7XG4gICAgICAgICAgICAgICAgaWkgPSBpbmRleE9mLmNhbGwodGhpcy5fc2hvcnRNb250aHNQYXJzZSwgbGxjKTtcbiAgICAgICAgICAgICAgICBpZiAoaWkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWkgPSBpbmRleE9mLmNhbGwodGhpcy5fbG9uZ01vbnRoc1BhcnNlLCBsbGMpO1xuICAgICAgICAgICAgICAgIHJldHVybiBpaSAhPT0gLTEgPyBpaSA6IG51bGw7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlpID0gaW5kZXhPZi5jYWxsKHRoaXMuX2xvbmdNb250aHNQYXJzZSwgbGxjKTtcbiAgICAgICAgICAgICAgICBpZiAoaWkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWkgPSBpbmRleE9mLmNhbGwodGhpcy5fc2hvcnRNb250aHNQYXJzZSwgbGxjKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gaWkgIT09IC0xID8gaWkgOiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbG9jYWxlTW9udGhzUGFyc2UobW9udGhOYW1lLCBmb3JtYXQsIHN0cmljdCkge1xuICAgICAgICB2YXIgaSwgbW9tLCByZWdleDtcblxuICAgICAgICBpZiAodGhpcy5fbW9udGhzUGFyc2VFeGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIGhhbmRsZVN0cmljdFBhcnNlLmNhbGwodGhpcywgbW9udGhOYW1lLCBmb3JtYXQsIHN0cmljdCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuX21vbnRoc1BhcnNlKSB7XG4gICAgICAgICAgICB0aGlzLl9tb250aHNQYXJzZSA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fbG9uZ01vbnRoc1BhcnNlID0gW107XG4gICAgICAgICAgICB0aGlzLl9zaG9ydE1vbnRoc1BhcnNlID0gW107XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUT0RPOiBhZGQgc29ydGluZ1xuICAgICAgICAvLyBTb3J0aW5nIG1ha2VzIHN1cmUgaWYgb25lIG1vbnRoIChvciBhYmJyKSBpcyBhIHByZWZpeCBvZiBhbm90aGVyXG4gICAgICAgIC8vIHNlZSBzb3J0aW5nIGluIGNvbXB1dGVNb250aHNQYXJzZVxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMTI7IGkrKykge1xuICAgICAgICAgICAgLy8gbWFrZSB0aGUgcmVnZXggaWYgd2UgZG9uJ3QgaGF2ZSBpdCBhbHJlYWR5XG4gICAgICAgICAgICBtb20gPSBjcmVhdGVVVEMoWzIwMDAsIGldKTtcbiAgICAgICAgICAgIGlmIChzdHJpY3QgJiYgIXRoaXMuX2xvbmdNb250aHNQYXJzZVtpXSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2xvbmdNb250aHNQYXJzZVtpXSA9IG5ldyBSZWdFeHAoXG4gICAgICAgICAgICAgICAgICAgICdeJyArIHRoaXMubW9udGhzKG1vbSwgJycpLnJlcGxhY2UoJy4nLCAnJykgKyAnJCcsXG4gICAgICAgICAgICAgICAgICAgICdpJ1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2hvcnRNb250aHNQYXJzZVtpXSA9IG5ldyBSZWdFeHAoXG4gICAgICAgICAgICAgICAgICAgICdeJyArIHRoaXMubW9udGhzU2hvcnQobW9tLCAnJykucmVwbGFjZSgnLicsICcnKSArICckJyxcbiAgICAgICAgICAgICAgICAgICAgJ2knXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghc3RyaWN0ICYmICF0aGlzLl9tb250aHNQYXJzZVtpXSkge1xuICAgICAgICAgICAgICAgIHJlZ2V4ID1cbiAgICAgICAgICAgICAgICAgICAgJ14nICsgdGhpcy5tb250aHMobW9tLCAnJykgKyAnfF4nICsgdGhpcy5tb250aHNTaG9ydChtb20sICcnKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9tb250aHNQYXJzZVtpXSA9IG5ldyBSZWdFeHAocmVnZXgucmVwbGFjZSgnLicsICcnKSwgJ2knKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHRlc3QgdGhlIHJlZ2V4XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgc3RyaWN0ICYmXG4gICAgICAgICAgICAgICAgZm9ybWF0ID09PSAnTU1NTScgJiZcbiAgICAgICAgICAgICAgICB0aGlzLl9sb25nTW9udGhzUGFyc2VbaV0udGVzdChtb250aE5hbWUpXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgICAgICAgc3RyaWN0ICYmXG4gICAgICAgICAgICAgICAgZm9ybWF0ID09PSAnTU1NJyAmJlxuICAgICAgICAgICAgICAgIHRoaXMuX3Nob3J0TW9udGhzUGFyc2VbaV0udGVzdChtb250aE5hbWUpXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIXN0cmljdCAmJiB0aGlzLl9tb250aHNQYXJzZVtpXS50ZXN0KG1vbnRoTmFtZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIE1PTUVOVFNcblxuICAgIGZ1bmN0aW9uIHNldE1vbnRoKG1vbSwgdmFsdWUpIHtcbiAgICAgICAgdmFyIGRheU9mTW9udGg7XG5cbiAgICAgICAgaWYgKCFtb20uaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICAvLyBObyBvcFxuICAgICAgICAgICAgcmV0dXJuIG1vbTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBpZiAoL15cXGQrJC8udGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHRvSW50KHZhbHVlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBtb20ubG9jYWxlRGF0YSgpLm1vbnRoc1BhcnNlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBBbm90aGVyIHNpbGVudCBmYWlsdXJlP1xuICAgICAgICAgICAgICAgIGlmICghaXNOdW1iZXIodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtb207XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZGF5T2ZNb250aCA9IE1hdGgubWluKG1vbS5kYXRlKCksIGRheXNJbk1vbnRoKG1vbS55ZWFyKCksIHZhbHVlKSk7XG4gICAgICAgIG1vbS5fZFsnc2V0JyArIChtb20uX2lzVVRDID8gJ1VUQycgOiAnJykgKyAnTW9udGgnXSh2YWx1ZSwgZGF5T2ZNb250aCk7XG4gICAgICAgIHJldHVybiBtb207XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0U2V0TW9udGgodmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHtcbiAgICAgICAgICAgIHNldE1vbnRoKHRoaXMsIHZhbHVlKTtcbiAgICAgICAgICAgIGhvb2tzLnVwZGF0ZU9mZnNldCh0aGlzLCB0cnVlKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGdldCh0aGlzLCAnTW9udGgnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldERheXNJbk1vbnRoKCkge1xuICAgICAgICByZXR1cm4gZGF5c0luTW9udGgodGhpcy55ZWFyKCksIHRoaXMubW9udGgoKSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbW9udGhzU2hvcnRSZWdleChpc1N0cmljdCkge1xuICAgICAgICBpZiAodGhpcy5fbW9udGhzUGFyc2VFeGFjdCkge1xuICAgICAgICAgICAgaWYgKCFoYXNPd25Qcm9wKHRoaXMsICdfbW9udGhzUmVnZXgnKSkge1xuICAgICAgICAgICAgICAgIGNvbXB1dGVNb250aHNQYXJzZS5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzU3RyaWN0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21vbnRoc1Nob3J0U3RyaWN0UmVnZXg7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tb250aHNTaG9ydFJlZ2V4O1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKCFoYXNPd25Qcm9wKHRoaXMsICdfbW9udGhzU2hvcnRSZWdleCcpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbW9udGhzU2hvcnRSZWdleCA9IGRlZmF1bHRNb250aHNTaG9ydFJlZ2V4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21vbnRoc1Nob3J0U3RyaWN0UmVnZXggJiYgaXNTdHJpY3RcbiAgICAgICAgICAgICAgICA/IHRoaXMuX21vbnRoc1Nob3J0U3RyaWN0UmVnZXhcbiAgICAgICAgICAgICAgICA6IHRoaXMuX21vbnRoc1Nob3J0UmVnZXg7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtb250aHNSZWdleChpc1N0cmljdCkge1xuICAgICAgICBpZiAodGhpcy5fbW9udGhzUGFyc2VFeGFjdCkge1xuICAgICAgICAgICAgaWYgKCFoYXNPd25Qcm9wKHRoaXMsICdfbW9udGhzUmVnZXgnKSkge1xuICAgICAgICAgICAgICAgIGNvbXB1dGVNb250aHNQYXJzZS5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzU3RyaWN0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21vbnRoc1N0cmljdFJlZ2V4O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbW9udGhzUmVnZXg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoIWhhc093blByb3AodGhpcywgJ19tb250aHNSZWdleCcpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbW9udGhzUmVnZXggPSBkZWZhdWx0TW9udGhzUmVnZXg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbW9udGhzU3RyaWN0UmVnZXggJiYgaXNTdHJpY3RcbiAgICAgICAgICAgICAgICA/IHRoaXMuX21vbnRoc1N0cmljdFJlZ2V4XG4gICAgICAgICAgICAgICAgOiB0aGlzLl9tb250aHNSZWdleDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNvbXB1dGVNb250aHNQYXJzZSgpIHtcbiAgICAgICAgZnVuY3Rpb24gY21wTGVuUmV2KGEsIGIpIHtcbiAgICAgICAgICAgIHJldHVybiBiLmxlbmd0aCAtIGEubGVuZ3RoO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHNob3J0UGllY2VzID0gW10sXG4gICAgICAgICAgICBsb25nUGllY2VzID0gW10sXG4gICAgICAgICAgICBtaXhlZFBpZWNlcyA9IFtdLFxuICAgICAgICAgICAgaSxcbiAgICAgICAgICAgIG1vbTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IDEyOyBpKyspIHtcbiAgICAgICAgICAgIC8vIG1ha2UgdGhlIHJlZ2V4IGlmIHdlIGRvbid0IGhhdmUgaXQgYWxyZWFkeVxuICAgICAgICAgICAgbW9tID0gY3JlYXRlVVRDKFsyMDAwLCBpXSk7XG4gICAgICAgICAgICBzaG9ydFBpZWNlcy5wdXNoKHRoaXMubW9udGhzU2hvcnQobW9tLCAnJykpO1xuICAgICAgICAgICAgbG9uZ1BpZWNlcy5wdXNoKHRoaXMubW9udGhzKG1vbSwgJycpKTtcbiAgICAgICAgICAgIG1peGVkUGllY2VzLnB1c2godGhpcy5tb250aHMobW9tLCAnJykpO1xuICAgICAgICAgICAgbWl4ZWRQaWVjZXMucHVzaCh0aGlzLm1vbnRoc1Nob3J0KG1vbSwgJycpKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBTb3J0aW5nIG1ha2VzIHN1cmUgaWYgb25lIG1vbnRoIChvciBhYmJyKSBpcyBhIHByZWZpeCBvZiBhbm90aGVyIGl0XG4gICAgICAgIC8vIHdpbGwgbWF0Y2ggdGhlIGxvbmdlciBwaWVjZS5cbiAgICAgICAgc2hvcnRQaWVjZXMuc29ydChjbXBMZW5SZXYpO1xuICAgICAgICBsb25nUGllY2VzLnNvcnQoY21wTGVuUmV2KTtcbiAgICAgICAgbWl4ZWRQaWVjZXMuc29ydChjbXBMZW5SZXYpO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMTI7IGkrKykge1xuICAgICAgICAgICAgc2hvcnRQaWVjZXNbaV0gPSByZWdleEVzY2FwZShzaG9ydFBpZWNlc1tpXSk7XG4gICAgICAgICAgICBsb25nUGllY2VzW2ldID0gcmVnZXhFc2NhcGUobG9uZ1BpZWNlc1tpXSk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChpID0gMDsgaSA8IDI0OyBpKyspIHtcbiAgICAgICAgICAgIG1peGVkUGllY2VzW2ldID0gcmVnZXhFc2NhcGUobWl4ZWRQaWVjZXNbaV0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fbW9udGhzUmVnZXggPSBuZXcgUmVnRXhwKCdeKCcgKyBtaXhlZFBpZWNlcy5qb2luKCd8JykgKyAnKScsICdpJyk7XG4gICAgICAgIHRoaXMuX21vbnRoc1Nob3J0UmVnZXggPSB0aGlzLl9tb250aHNSZWdleDtcbiAgICAgICAgdGhpcy5fbW9udGhzU3RyaWN0UmVnZXggPSBuZXcgUmVnRXhwKFxuICAgICAgICAgICAgJ14oJyArIGxvbmdQaWVjZXMuam9pbignfCcpICsgJyknLFxuICAgICAgICAgICAgJ2knXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuX21vbnRoc1Nob3J0U3RyaWN0UmVnZXggPSBuZXcgUmVnRXhwKFxuICAgICAgICAgICAgJ14oJyArIHNob3J0UGllY2VzLmpvaW4oJ3wnKSArICcpJyxcbiAgICAgICAgICAgICdpJ1xuICAgICAgICApO1xuICAgIH1cblxuICAgIC8vIEZPUk1BVFRJTkdcblxuICAgIGFkZEZvcm1hdFRva2VuKCdZJywgMCwgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgeSA9IHRoaXMueWVhcigpO1xuICAgICAgICByZXR1cm4geSA8PSA5OTk5ID8gemVyb0ZpbGwoeSwgNCkgOiAnKycgKyB5O1xuICAgIH0pO1xuXG4gICAgYWRkRm9ybWF0VG9rZW4oMCwgWydZWScsIDJdLCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnllYXIoKSAlIDEwMDtcbiAgICB9KTtcblxuICAgIGFkZEZvcm1hdFRva2VuKDAsIFsnWVlZWScsIDRdLCAwLCAneWVhcicpO1xuICAgIGFkZEZvcm1hdFRva2VuKDAsIFsnWVlZWVknLCA1XSwgMCwgJ3llYXInKTtcbiAgICBhZGRGb3JtYXRUb2tlbigwLCBbJ1lZWVlZWScsIDYsIHRydWVdLCAwLCAneWVhcicpO1xuXG4gICAgLy8gQUxJQVNFU1xuXG4gICAgYWRkVW5pdEFsaWFzKCd5ZWFyJywgJ3knKTtcblxuICAgIC8vIFBSSU9SSVRJRVNcblxuICAgIGFkZFVuaXRQcmlvcml0eSgneWVhcicsIDEpO1xuXG4gICAgLy8gUEFSU0lOR1xuXG4gICAgYWRkUmVnZXhUb2tlbignWScsIG1hdGNoU2lnbmVkKTtcbiAgICBhZGRSZWdleFRva2VuKCdZWScsIG1hdGNoMXRvMiwgbWF0Y2gyKTtcbiAgICBhZGRSZWdleFRva2VuKCdZWVlZJywgbWF0Y2gxdG80LCBtYXRjaDQpO1xuICAgIGFkZFJlZ2V4VG9rZW4oJ1lZWVlZJywgbWF0Y2gxdG82LCBtYXRjaDYpO1xuICAgIGFkZFJlZ2V4VG9rZW4oJ1lZWVlZWScsIG1hdGNoMXRvNiwgbWF0Y2g2KTtcblxuICAgIGFkZFBhcnNlVG9rZW4oWydZWVlZWScsICdZWVlZWVknXSwgWUVBUik7XG4gICAgYWRkUGFyc2VUb2tlbignWVlZWScsIGZ1bmN0aW9uIChpbnB1dCwgYXJyYXkpIHtcbiAgICAgICAgYXJyYXlbWUVBUl0gPVxuICAgICAgICAgICAgaW5wdXQubGVuZ3RoID09PSAyID8gaG9va3MucGFyc2VUd29EaWdpdFllYXIoaW5wdXQpIDogdG9JbnQoaW5wdXQpO1xuICAgIH0pO1xuICAgIGFkZFBhcnNlVG9rZW4oJ1lZJywgZnVuY3Rpb24gKGlucHV0LCBhcnJheSkge1xuICAgICAgICBhcnJheVtZRUFSXSA9IGhvb2tzLnBhcnNlVHdvRGlnaXRZZWFyKGlucHV0KTtcbiAgICB9KTtcbiAgICBhZGRQYXJzZVRva2VuKCdZJywgZnVuY3Rpb24gKGlucHV0LCBhcnJheSkge1xuICAgICAgICBhcnJheVtZRUFSXSA9IHBhcnNlSW50KGlucHV0LCAxMCk7XG4gICAgfSk7XG5cbiAgICAvLyBIRUxQRVJTXG5cbiAgICBmdW5jdGlvbiBkYXlzSW5ZZWFyKHllYXIpIHtcbiAgICAgICAgcmV0dXJuIGlzTGVhcFllYXIoeWVhcikgPyAzNjYgOiAzNjU7XG4gICAgfVxuXG4gICAgLy8gSE9PS1NcblxuICAgIGhvb2tzLnBhcnNlVHdvRGlnaXRZZWFyID0gZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgICAgIHJldHVybiB0b0ludChpbnB1dCkgKyAodG9JbnQoaW5wdXQpID4gNjggPyAxOTAwIDogMjAwMCk7XG4gICAgfTtcblxuICAgIC8vIE1PTUVOVFNcblxuICAgIHZhciBnZXRTZXRZZWFyID0gbWFrZUdldFNldCgnRnVsbFllYXInLCB0cnVlKTtcblxuICAgIGZ1bmN0aW9uIGdldElzTGVhcFllYXIoKSB7XG4gICAgICAgIHJldHVybiBpc0xlYXBZZWFyKHRoaXMueWVhcigpKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVEYXRlKHksIG0sIGQsIGgsIE0sIHMsIG1zKSB7XG4gICAgICAgIC8vIGNhbid0IGp1c3QgYXBwbHkoKSB0byBjcmVhdGUgYSBkYXRlOlxuICAgICAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3EvMTgxMzQ4XG4gICAgICAgIHZhciBkYXRlO1xuICAgICAgICAvLyB0aGUgZGF0ZSBjb25zdHJ1Y3RvciByZW1hcHMgeWVhcnMgMC05OSB0byAxOTAwLTE5OTlcbiAgICAgICAgaWYgKHkgPCAxMDAgJiYgeSA+PSAwKSB7XG4gICAgICAgICAgICAvLyBwcmVzZXJ2ZSBsZWFwIHllYXJzIHVzaW5nIGEgZnVsbCA0MDAgeWVhciBjeWNsZSwgdGhlbiByZXNldFxuICAgICAgICAgICAgZGF0ZSA9IG5ldyBEYXRlKHkgKyA0MDAsIG0sIGQsIGgsIE0sIHMsIG1zKTtcbiAgICAgICAgICAgIGlmIChpc0Zpbml0ZShkYXRlLmdldEZ1bGxZZWFyKCkpKSB7XG4gICAgICAgICAgICAgICAgZGF0ZS5zZXRGdWxsWWVhcih5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRhdGUgPSBuZXcgRGF0ZSh5LCBtLCBkLCBoLCBNLCBzLCBtcyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGF0ZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVVVENEYXRlKHkpIHtcbiAgICAgICAgdmFyIGRhdGUsIGFyZ3M7XG4gICAgICAgIC8vIHRoZSBEYXRlLlVUQyBmdW5jdGlvbiByZW1hcHMgeWVhcnMgMC05OSB0byAxOTAwLTE5OTlcbiAgICAgICAgaWYgKHkgPCAxMDAgJiYgeSA+PSAwKSB7XG4gICAgICAgICAgICBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcbiAgICAgICAgICAgIC8vIHByZXNlcnZlIGxlYXAgeWVhcnMgdXNpbmcgYSBmdWxsIDQwMCB5ZWFyIGN5Y2xlLCB0aGVuIHJlc2V0XG4gICAgICAgICAgICBhcmdzWzBdID0geSArIDQwMDtcbiAgICAgICAgICAgIGRhdGUgPSBuZXcgRGF0ZShEYXRlLlVUQy5hcHBseShudWxsLCBhcmdzKSk7XG4gICAgICAgICAgICBpZiAoaXNGaW5pdGUoZGF0ZS5nZXRVVENGdWxsWWVhcigpKSkge1xuICAgICAgICAgICAgICAgIGRhdGUuc2V0VVRDRnVsbFllYXIoeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkYXRlID0gbmV3IERhdGUoRGF0ZS5VVEMuYXBwbHkobnVsbCwgYXJndW1lbnRzKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGF0ZTtcbiAgICB9XG5cbiAgICAvLyBzdGFydC1vZi1maXJzdC13ZWVrIC0gc3RhcnQtb2YteWVhclxuICAgIGZ1bmN0aW9uIGZpcnN0V2Vla09mZnNldCh5ZWFyLCBkb3csIGRveSkge1xuICAgICAgICB2YXIgLy8gZmlyc3Qtd2VlayBkYXkgLS0gd2hpY2ggamFudWFyeSBpcyBhbHdheXMgaW4gdGhlIGZpcnN0IHdlZWsgKDQgZm9yIGlzbywgMSBmb3Igb3RoZXIpXG4gICAgICAgICAgICBmd2QgPSA3ICsgZG93IC0gZG95LFxuICAgICAgICAgICAgLy8gZmlyc3Qtd2VlayBkYXkgbG9jYWwgd2Vla2RheSAtLSB3aGljaCBsb2NhbCB3ZWVrZGF5IGlzIGZ3ZFxuICAgICAgICAgICAgZndkbHcgPSAoNyArIGNyZWF0ZVVUQ0RhdGUoeWVhciwgMCwgZndkKS5nZXRVVENEYXkoKSAtIGRvdykgJSA3O1xuXG4gICAgICAgIHJldHVybiAtZndkbHcgKyBmd2QgLSAxO1xuICAgIH1cblxuICAgIC8vIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0lTT193ZWVrX2RhdGUjQ2FsY3VsYXRpbmdfYV9kYXRlX2dpdmVuX3RoZV95ZWFyLjJDX3dlZWtfbnVtYmVyX2FuZF93ZWVrZGF5XG4gICAgZnVuY3Rpb24gZGF5T2ZZZWFyRnJvbVdlZWtzKHllYXIsIHdlZWssIHdlZWtkYXksIGRvdywgZG95KSB7XG4gICAgICAgIHZhciBsb2NhbFdlZWtkYXkgPSAoNyArIHdlZWtkYXkgLSBkb3cpICUgNyxcbiAgICAgICAgICAgIHdlZWtPZmZzZXQgPSBmaXJzdFdlZWtPZmZzZXQoeWVhciwgZG93LCBkb3kpLFxuICAgICAgICAgICAgZGF5T2ZZZWFyID0gMSArIDcgKiAod2VlayAtIDEpICsgbG9jYWxXZWVrZGF5ICsgd2Vla09mZnNldCxcbiAgICAgICAgICAgIHJlc1llYXIsXG4gICAgICAgICAgICByZXNEYXlPZlllYXI7XG5cbiAgICAgICAgaWYgKGRheU9mWWVhciA8PSAwKSB7XG4gICAgICAgICAgICByZXNZZWFyID0geWVhciAtIDE7XG4gICAgICAgICAgICByZXNEYXlPZlllYXIgPSBkYXlzSW5ZZWFyKHJlc1llYXIpICsgZGF5T2ZZZWFyO1xuICAgICAgICB9IGVsc2UgaWYgKGRheU9mWWVhciA+IGRheXNJblllYXIoeWVhcikpIHtcbiAgICAgICAgICAgIHJlc1llYXIgPSB5ZWFyICsgMTtcbiAgICAgICAgICAgIHJlc0RheU9mWWVhciA9IGRheU9mWWVhciAtIGRheXNJblllYXIoeWVhcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNZZWFyID0geWVhcjtcbiAgICAgICAgICAgIHJlc0RheU9mWWVhciA9IGRheU9mWWVhcjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB5ZWFyOiByZXNZZWFyLFxuICAgICAgICAgICAgZGF5T2ZZZWFyOiByZXNEYXlPZlllYXIsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gd2Vla09mWWVhcihtb20sIGRvdywgZG95KSB7XG4gICAgICAgIHZhciB3ZWVrT2Zmc2V0ID0gZmlyc3RXZWVrT2Zmc2V0KG1vbS55ZWFyKCksIGRvdywgZG95KSxcbiAgICAgICAgICAgIHdlZWsgPSBNYXRoLmZsb29yKChtb20uZGF5T2ZZZWFyKCkgLSB3ZWVrT2Zmc2V0IC0gMSkgLyA3KSArIDEsXG4gICAgICAgICAgICByZXNXZWVrLFxuICAgICAgICAgICAgcmVzWWVhcjtcblxuICAgICAgICBpZiAod2VlayA8IDEpIHtcbiAgICAgICAgICAgIHJlc1llYXIgPSBtb20ueWVhcigpIC0gMTtcbiAgICAgICAgICAgIHJlc1dlZWsgPSB3ZWVrICsgd2Vla3NJblllYXIocmVzWWVhciwgZG93LCBkb3kpO1xuICAgICAgICB9IGVsc2UgaWYgKHdlZWsgPiB3ZWVrc0luWWVhcihtb20ueWVhcigpLCBkb3csIGRveSkpIHtcbiAgICAgICAgICAgIHJlc1dlZWsgPSB3ZWVrIC0gd2Vla3NJblllYXIobW9tLnllYXIoKSwgZG93LCBkb3kpO1xuICAgICAgICAgICAgcmVzWWVhciA9IG1vbS55ZWFyKCkgKyAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzWWVhciA9IG1vbS55ZWFyKCk7XG4gICAgICAgICAgICByZXNXZWVrID0gd2VlaztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB3ZWVrOiByZXNXZWVrLFxuICAgICAgICAgICAgeWVhcjogcmVzWWVhcixcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB3ZWVrc0luWWVhcih5ZWFyLCBkb3csIGRveSkge1xuICAgICAgICB2YXIgd2Vla09mZnNldCA9IGZpcnN0V2Vla09mZnNldCh5ZWFyLCBkb3csIGRveSksXG4gICAgICAgICAgICB3ZWVrT2Zmc2V0TmV4dCA9IGZpcnN0V2Vla09mZnNldCh5ZWFyICsgMSwgZG93LCBkb3kpO1xuICAgICAgICByZXR1cm4gKGRheXNJblllYXIoeWVhcikgLSB3ZWVrT2Zmc2V0ICsgd2Vla09mZnNldE5leHQpIC8gNztcbiAgICB9XG5cbiAgICAvLyBGT1JNQVRUSU5HXG5cbiAgICBhZGRGb3JtYXRUb2tlbigndycsIFsnd3cnLCAyXSwgJ3dvJywgJ3dlZWsnKTtcbiAgICBhZGRGb3JtYXRUb2tlbignVycsIFsnV1cnLCAyXSwgJ1dvJywgJ2lzb1dlZWsnKTtcblxuICAgIC8vIEFMSUFTRVNcblxuICAgIGFkZFVuaXRBbGlhcygnd2VlaycsICd3Jyk7XG4gICAgYWRkVW5pdEFsaWFzKCdpc29XZWVrJywgJ1cnKTtcblxuICAgIC8vIFBSSU9SSVRJRVNcblxuICAgIGFkZFVuaXRQcmlvcml0eSgnd2VlaycsIDUpO1xuICAgIGFkZFVuaXRQcmlvcml0eSgnaXNvV2VlaycsIDUpO1xuXG4gICAgLy8gUEFSU0lOR1xuXG4gICAgYWRkUmVnZXhUb2tlbigndycsIG1hdGNoMXRvMik7XG4gICAgYWRkUmVnZXhUb2tlbignd3cnLCBtYXRjaDF0bzIsIG1hdGNoMik7XG4gICAgYWRkUmVnZXhUb2tlbignVycsIG1hdGNoMXRvMik7XG4gICAgYWRkUmVnZXhUb2tlbignV1cnLCBtYXRjaDF0bzIsIG1hdGNoMik7XG5cbiAgICBhZGRXZWVrUGFyc2VUb2tlbihbJ3cnLCAnd3cnLCAnVycsICdXVyddLCBmdW5jdGlvbiAoXG4gICAgICAgIGlucHV0LFxuICAgICAgICB3ZWVrLFxuICAgICAgICBjb25maWcsXG4gICAgICAgIHRva2VuXG4gICAgKSB7XG4gICAgICAgIHdlZWtbdG9rZW4uc3Vic3RyKDAsIDEpXSA9IHRvSW50KGlucHV0KTtcbiAgICB9KTtcblxuICAgIC8vIEhFTFBFUlNcblxuICAgIC8vIExPQ0FMRVNcblxuICAgIGZ1bmN0aW9uIGxvY2FsZVdlZWsobW9tKSB7XG4gICAgICAgIHJldHVybiB3ZWVrT2ZZZWFyKG1vbSwgdGhpcy5fd2Vlay5kb3csIHRoaXMuX3dlZWsuZG95KS53ZWVrO1xuICAgIH1cblxuICAgIHZhciBkZWZhdWx0TG9jYWxlV2VlayA9IHtcbiAgICAgICAgZG93OiAwLCAvLyBTdW5kYXkgaXMgdGhlIGZpcnN0IGRheSBvZiB0aGUgd2Vlay5cbiAgICAgICAgZG95OiA2LCAvLyBUaGUgd2VlayB0aGF0IGNvbnRhaW5zIEphbiA2dGggaXMgdGhlIGZpcnN0IHdlZWsgb2YgdGhlIHllYXIuXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGxvY2FsZUZpcnN0RGF5T2ZXZWVrKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fd2Vlay5kb3c7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbG9jYWxlRmlyc3REYXlPZlllYXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl93ZWVrLmRveTtcbiAgICB9XG5cbiAgICAvLyBNT01FTlRTXG5cbiAgICBmdW5jdGlvbiBnZXRTZXRXZWVrKGlucHV0KSB7XG4gICAgICAgIHZhciB3ZWVrID0gdGhpcy5sb2NhbGVEYXRhKCkud2Vlayh0aGlzKTtcbiAgICAgICAgcmV0dXJuIGlucHV0ID09IG51bGwgPyB3ZWVrIDogdGhpcy5hZGQoKGlucHV0IC0gd2VlaykgKiA3LCAnZCcpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFNldElTT1dlZWsoaW5wdXQpIHtcbiAgICAgICAgdmFyIHdlZWsgPSB3ZWVrT2ZZZWFyKHRoaXMsIDEsIDQpLndlZWs7XG4gICAgICAgIHJldHVybiBpbnB1dCA9PSBudWxsID8gd2VlayA6IHRoaXMuYWRkKChpbnB1dCAtIHdlZWspICogNywgJ2QnKTtcbiAgICB9XG5cbiAgICAvLyBGT1JNQVRUSU5HXG5cbiAgICBhZGRGb3JtYXRUb2tlbignZCcsIDAsICdkbycsICdkYXknKTtcblxuICAgIGFkZEZvcm1hdFRva2VuKCdkZCcsIDAsIDAsIGZ1bmN0aW9uIChmb3JtYXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlRGF0YSgpLndlZWtkYXlzTWluKHRoaXMsIGZvcm1hdCk7XG4gICAgfSk7XG5cbiAgICBhZGRGb3JtYXRUb2tlbignZGRkJywgMCwgMCwgZnVuY3Rpb24gKGZvcm1hdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVEYXRhKCkud2Vla2RheXNTaG9ydCh0aGlzLCBmb3JtYXQpO1xuICAgIH0pO1xuXG4gICAgYWRkRm9ybWF0VG9rZW4oJ2RkZGQnLCAwLCAwLCBmdW5jdGlvbiAoZm9ybWF0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsZURhdGEoKS53ZWVrZGF5cyh0aGlzLCBmb3JtYXQpO1xuICAgIH0pO1xuXG4gICAgYWRkRm9ybWF0VG9rZW4oJ2UnLCAwLCAwLCAnd2Vla2RheScpO1xuICAgIGFkZEZvcm1hdFRva2VuKCdFJywgMCwgMCwgJ2lzb1dlZWtkYXknKTtcblxuICAgIC8vIEFMSUFTRVNcblxuICAgIGFkZFVuaXRBbGlhcygnZGF5JywgJ2QnKTtcbiAgICBhZGRVbml0QWxpYXMoJ3dlZWtkYXknLCAnZScpO1xuICAgIGFkZFVuaXRBbGlhcygnaXNvV2Vla2RheScsICdFJyk7XG5cbiAgICAvLyBQUklPUklUWVxuICAgIGFkZFVuaXRQcmlvcml0eSgnZGF5JywgMTEpO1xuICAgIGFkZFVuaXRQcmlvcml0eSgnd2Vla2RheScsIDExKTtcbiAgICBhZGRVbml0UHJpb3JpdHkoJ2lzb1dlZWtkYXknLCAxMSk7XG5cbiAgICAvLyBQQVJTSU5HXG5cbiAgICBhZGRSZWdleFRva2VuKCdkJywgbWF0Y2gxdG8yKTtcbiAgICBhZGRSZWdleFRva2VuKCdlJywgbWF0Y2gxdG8yKTtcbiAgICBhZGRSZWdleFRva2VuKCdFJywgbWF0Y2gxdG8yKTtcbiAgICBhZGRSZWdleFRva2VuKCdkZCcsIGZ1bmN0aW9uIChpc1N0cmljdCwgbG9jYWxlKSB7XG4gICAgICAgIHJldHVybiBsb2NhbGUud2Vla2RheXNNaW5SZWdleChpc1N0cmljdCk7XG4gICAgfSk7XG4gICAgYWRkUmVnZXhUb2tlbignZGRkJywgZnVuY3Rpb24gKGlzU3RyaWN0LCBsb2NhbGUpIHtcbiAgICAgICAgcmV0dXJuIGxvY2FsZS53ZWVrZGF5c1Nob3J0UmVnZXgoaXNTdHJpY3QpO1xuICAgIH0pO1xuICAgIGFkZFJlZ2V4VG9rZW4oJ2RkZGQnLCBmdW5jdGlvbiAoaXNTdHJpY3QsIGxvY2FsZSkge1xuICAgICAgICByZXR1cm4gbG9jYWxlLndlZWtkYXlzUmVnZXgoaXNTdHJpY3QpO1xuICAgIH0pO1xuXG4gICAgYWRkV2Vla1BhcnNlVG9rZW4oWydkZCcsICdkZGQnLCAnZGRkZCddLCBmdW5jdGlvbiAoaW5wdXQsIHdlZWssIGNvbmZpZywgdG9rZW4pIHtcbiAgICAgICAgdmFyIHdlZWtkYXkgPSBjb25maWcuX2xvY2FsZS53ZWVrZGF5c1BhcnNlKGlucHV0LCB0b2tlbiwgY29uZmlnLl9zdHJpY3QpO1xuICAgICAgICAvLyBpZiB3ZSBkaWRuJ3QgZ2V0IGEgd2Vla2RheSBuYW1lLCBtYXJrIHRoZSBkYXRlIGFzIGludmFsaWRcbiAgICAgICAgaWYgKHdlZWtkYXkgIT0gbnVsbCkge1xuICAgICAgICAgICAgd2Vlay5kID0gd2Vla2RheTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLmludmFsaWRXZWVrZGF5ID0gaW5wdXQ7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGFkZFdlZWtQYXJzZVRva2VuKFsnZCcsICdlJywgJ0UnXSwgZnVuY3Rpb24gKGlucHV0LCB3ZWVrLCBjb25maWcsIHRva2VuKSB7XG4gICAgICAgIHdlZWtbdG9rZW5dID0gdG9JbnQoaW5wdXQpO1xuICAgIH0pO1xuXG4gICAgLy8gSEVMUEVSU1xuXG4gICAgZnVuY3Rpb24gcGFyc2VXZWVrZGF5KGlucHV0LCBsb2NhbGUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBpbnB1dCAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnB1dDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghaXNOYU4oaW5wdXQpKSB7XG4gICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoaW5wdXQsIDEwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlucHV0ID0gbG9jYWxlLndlZWtkYXlzUGFyc2UoaW5wdXQpO1xuICAgICAgICBpZiAodHlwZW9mIGlucHV0ID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgcmV0dXJuIGlucHV0O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcGFyc2VJc29XZWVrZGF5KGlucHV0LCBsb2NhbGUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiBsb2NhbGUud2Vla2RheXNQYXJzZShpbnB1dCkgJSA3IHx8IDc7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGlzTmFOKGlucHV0KSA/IG51bGwgOiBpbnB1dDtcbiAgICB9XG5cbiAgICAvLyBMT0NBTEVTXG4gICAgZnVuY3Rpb24gc2hpZnRXZWVrZGF5cyh3cywgbikge1xuICAgICAgICByZXR1cm4gd3Muc2xpY2UobiwgNykuY29uY2F0KHdzLnNsaWNlKDAsIG4pKTtcbiAgICB9XG5cbiAgICB2YXIgZGVmYXVsdExvY2FsZVdlZWtkYXlzID0gJ1N1bmRheV9Nb25kYXlfVHVlc2RheV9XZWRuZXNkYXlfVGh1cnNkYXlfRnJpZGF5X1NhdHVyZGF5Jy5zcGxpdChcbiAgICAgICAgICAgICdfJ1xuICAgICAgICApLFxuICAgICAgICBkZWZhdWx0TG9jYWxlV2Vla2RheXNTaG9ydCA9ICdTdW5fTW9uX1R1ZV9XZWRfVGh1X0ZyaV9TYXQnLnNwbGl0KCdfJyksXG4gICAgICAgIGRlZmF1bHRMb2NhbGVXZWVrZGF5c01pbiA9ICdTdV9Nb19UdV9XZV9UaF9Gcl9TYScuc3BsaXQoJ18nKSxcbiAgICAgICAgZGVmYXVsdFdlZWtkYXlzUmVnZXggPSBtYXRjaFdvcmQsXG4gICAgICAgIGRlZmF1bHRXZWVrZGF5c1Nob3J0UmVnZXggPSBtYXRjaFdvcmQsXG4gICAgICAgIGRlZmF1bHRXZWVrZGF5c01pblJlZ2V4ID0gbWF0Y2hXb3JkO1xuXG4gICAgZnVuY3Rpb24gbG9jYWxlV2Vla2RheXMobSwgZm9ybWF0KSB7XG4gICAgICAgIHZhciB3ZWVrZGF5cyA9IGlzQXJyYXkodGhpcy5fd2Vla2RheXMpXG4gICAgICAgICAgICA/IHRoaXMuX3dlZWtkYXlzXG4gICAgICAgICAgICA6IHRoaXMuX3dlZWtkYXlzW1xuICAgICAgICAgICAgICAgICAgbSAmJiBtICE9PSB0cnVlICYmIHRoaXMuX3dlZWtkYXlzLmlzRm9ybWF0LnRlc3QoZm9ybWF0KVxuICAgICAgICAgICAgICAgICAgICAgID8gJ2Zvcm1hdCdcbiAgICAgICAgICAgICAgICAgICAgICA6ICdzdGFuZGFsb25lJ1xuICAgICAgICAgICAgICBdO1xuICAgICAgICByZXR1cm4gbSA9PT0gdHJ1ZVxuICAgICAgICAgICAgPyBzaGlmdFdlZWtkYXlzKHdlZWtkYXlzLCB0aGlzLl93ZWVrLmRvdylcbiAgICAgICAgICAgIDogbVxuICAgICAgICAgICAgPyB3ZWVrZGF5c1ttLmRheSgpXVxuICAgICAgICAgICAgOiB3ZWVrZGF5cztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsb2NhbGVXZWVrZGF5c1Nob3J0KG0pIHtcbiAgICAgICAgcmV0dXJuIG0gPT09IHRydWVcbiAgICAgICAgICAgID8gc2hpZnRXZWVrZGF5cyh0aGlzLl93ZWVrZGF5c1Nob3J0LCB0aGlzLl93ZWVrLmRvdylcbiAgICAgICAgICAgIDogbVxuICAgICAgICAgICAgPyB0aGlzLl93ZWVrZGF5c1Nob3J0W20uZGF5KCldXG4gICAgICAgICAgICA6IHRoaXMuX3dlZWtkYXlzU2hvcnQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbG9jYWxlV2Vla2RheXNNaW4obSkge1xuICAgICAgICByZXR1cm4gbSA9PT0gdHJ1ZVxuICAgICAgICAgICAgPyBzaGlmdFdlZWtkYXlzKHRoaXMuX3dlZWtkYXlzTWluLCB0aGlzLl93ZWVrLmRvdylcbiAgICAgICAgICAgIDogbVxuICAgICAgICAgICAgPyB0aGlzLl93ZWVrZGF5c01pblttLmRheSgpXVxuICAgICAgICAgICAgOiB0aGlzLl93ZWVrZGF5c01pbjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVTdHJpY3RQYXJzZSQxKHdlZWtkYXlOYW1lLCBmb3JtYXQsIHN0cmljdCkge1xuICAgICAgICB2YXIgaSxcbiAgICAgICAgICAgIGlpLFxuICAgICAgICAgICAgbW9tLFxuICAgICAgICAgICAgbGxjID0gd2Vla2RheU5hbWUudG9Mb2NhbGVMb3dlckNhc2UoKTtcbiAgICAgICAgaWYgKCF0aGlzLl93ZWVrZGF5c1BhcnNlKSB7XG4gICAgICAgICAgICB0aGlzLl93ZWVrZGF5c1BhcnNlID0gW107XG4gICAgICAgICAgICB0aGlzLl9zaG9ydFdlZWtkYXlzUGFyc2UgPSBbXTtcbiAgICAgICAgICAgIHRoaXMuX21pbldlZWtkYXlzUGFyc2UgPSBbXTtcblxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDc7ICsraSkge1xuICAgICAgICAgICAgICAgIG1vbSA9IGNyZWF0ZVVUQyhbMjAwMCwgMV0pLmRheShpKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9taW5XZWVrZGF5c1BhcnNlW2ldID0gdGhpcy53ZWVrZGF5c01pbihcbiAgICAgICAgICAgICAgICAgICAgbW9tLFxuICAgICAgICAgICAgICAgICAgICAnJ1xuICAgICAgICAgICAgICAgICkudG9Mb2NhbGVMb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9zaG9ydFdlZWtkYXlzUGFyc2VbaV0gPSB0aGlzLndlZWtkYXlzU2hvcnQoXG4gICAgICAgICAgICAgICAgICAgIG1vbSxcbiAgICAgICAgICAgICAgICAgICAgJydcbiAgICAgICAgICAgICAgICApLnRvTG9jYWxlTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fd2Vla2RheXNQYXJzZVtpXSA9IHRoaXMud2Vla2RheXMobW9tLCAnJykudG9Mb2NhbGVMb3dlckNhc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdHJpY3QpIHtcbiAgICAgICAgICAgIGlmIChmb3JtYXQgPT09ICdkZGRkJykge1xuICAgICAgICAgICAgICAgIGlpID0gaW5kZXhPZi5jYWxsKHRoaXMuX3dlZWtkYXlzUGFyc2UsIGxsYyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlpICE9PSAtMSA/IGlpIDogbnVsbDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09PSAnZGRkJykge1xuICAgICAgICAgICAgICAgIGlpID0gaW5kZXhPZi5jYWxsKHRoaXMuX3Nob3J0V2Vla2RheXNQYXJzZSwgbGxjKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gaWkgIT09IC0xID8gaWkgOiBudWxsO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpaSA9IGluZGV4T2YuY2FsbCh0aGlzLl9taW5XZWVrZGF5c1BhcnNlLCBsbGMpO1xuICAgICAgICAgICAgICAgIHJldHVybiBpaSAhPT0gLTEgPyBpaSA6IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoZm9ybWF0ID09PSAnZGRkZCcpIHtcbiAgICAgICAgICAgICAgICBpaSA9IGluZGV4T2YuY2FsbCh0aGlzLl93ZWVrZGF5c1BhcnNlLCBsbGMpO1xuICAgICAgICAgICAgICAgIGlmIChpaSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpaSA9IGluZGV4T2YuY2FsbCh0aGlzLl9zaG9ydFdlZWtkYXlzUGFyc2UsIGxsYyk7XG4gICAgICAgICAgICAgICAgaWYgKGlpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlpID0gaW5kZXhPZi5jYWxsKHRoaXMuX21pbldlZWtkYXlzUGFyc2UsIGxsYyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlpICE9PSAtMSA/IGlpIDogbnVsbDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09PSAnZGRkJykge1xuICAgICAgICAgICAgICAgIGlpID0gaW5kZXhPZi5jYWxsKHRoaXMuX3Nob3J0V2Vla2RheXNQYXJzZSwgbGxjKTtcbiAgICAgICAgICAgICAgICBpZiAoaWkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWkgPSBpbmRleE9mLmNhbGwodGhpcy5fd2Vla2RheXNQYXJzZSwgbGxjKTtcbiAgICAgICAgICAgICAgICBpZiAoaWkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWkgPSBpbmRleE9mLmNhbGwodGhpcy5fbWluV2Vla2RheXNQYXJzZSwgbGxjKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gaWkgIT09IC0xID8gaWkgOiBudWxsO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpaSA9IGluZGV4T2YuY2FsbCh0aGlzLl9taW5XZWVrZGF5c1BhcnNlLCBsbGMpO1xuICAgICAgICAgICAgICAgIGlmIChpaSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpaSA9IGluZGV4T2YuY2FsbCh0aGlzLl93ZWVrZGF5c1BhcnNlLCBsbGMpO1xuICAgICAgICAgICAgICAgIGlmIChpaSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpaSA9IGluZGV4T2YuY2FsbCh0aGlzLl9zaG9ydFdlZWtkYXlzUGFyc2UsIGxsYyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlpICE9PSAtMSA/IGlpIDogbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxvY2FsZVdlZWtkYXlzUGFyc2Uod2Vla2RheU5hbWUsIGZvcm1hdCwgc3RyaWN0KSB7XG4gICAgICAgIHZhciBpLCBtb20sIHJlZ2V4O1xuXG4gICAgICAgIGlmICh0aGlzLl93ZWVrZGF5c1BhcnNlRXhhY3QpIHtcbiAgICAgICAgICAgIHJldHVybiBoYW5kbGVTdHJpY3RQYXJzZSQxLmNhbGwodGhpcywgd2Vla2RheU5hbWUsIGZvcm1hdCwgc3RyaWN0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5fd2Vla2RheXNQYXJzZSkge1xuICAgICAgICAgICAgdGhpcy5fd2Vla2RheXNQYXJzZSA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fbWluV2Vla2RheXNQYXJzZSA9IFtdO1xuICAgICAgICAgICAgdGhpcy5fc2hvcnRXZWVrZGF5c1BhcnNlID0gW107XG4gICAgICAgICAgICB0aGlzLl9mdWxsV2Vla2RheXNQYXJzZSA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChpID0gMDsgaSA8IDc7IGkrKykge1xuICAgICAgICAgICAgLy8gbWFrZSB0aGUgcmVnZXggaWYgd2UgZG9uJ3QgaGF2ZSBpdCBhbHJlYWR5XG5cbiAgICAgICAgICAgIG1vbSA9IGNyZWF0ZVVUQyhbMjAwMCwgMV0pLmRheShpKTtcbiAgICAgICAgICAgIGlmIChzdHJpY3QgJiYgIXRoaXMuX2Z1bGxXZWVrZGF5c1BhcnNlW2ldKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZnVsbFdlZWtkYXlzUGFyc2VbaV0gPSBuZXcgUmVnRXhwKFxuICAgICAgICAgICAgICAgICAgICAnXicgKyB0aGlzLndlZWtkYXlzKG1vbSwgJycpLnJlcGxhY2UoJy4nLCAnXFxcXC4/JykgKyAnJCcsXG4gICAgICAgICAgICAgICAgICAgICdpJ1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2hvcnRXZWVrZGF5c1BhcnNlW2ldID0gbmV3IFJlZ0V4cChcbiAgICAgICAgICAgICAgICAgICAgJ14nICsgdGhpcy53ZWVrZGF5c1Nob3J0KG1vbSwgJycpLnJlcGxhY2UoJy4nLCAnXFxcXC4/JykgKyAnJCcsXG4gICAgICAgICAgICAgICAgICAgICdpJ1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWluV2Vla2RheXNQYXJzZVtpXSA9IG5ldyBSZWdFeHAoXG4gICAgICAgICAgICAgICAgICAgICdeJyArIHRoaXMud2Vla2RheXNNaW4obW9tLCAnJykucmVwbGFjZSgnLicsICdcXFxcLj8nKSArICckJyxcbiAgICAgICAgICAgICAgICAgICAgJ2knXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5fd2Vla2RheXNQYXJzZVtpXSkge1xuICAgICAgICAgICAgICAgIHJlZ2V4ID1cbiAgICAgICAgICAgICAgICAgICAgJ14nICtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy53ZWVrZGF5cyhtb20sICcnKSArXG4gICAgICAgICAgICAgICAgICAgICd8XicgK1xuICAgICAgICAgICAgICAgICAgICB0aGlzLndlZWtkYXlzU2hvcnQobW9tLCAnJykgK1xuICAgICAgICAgICAgICAgICAgICAnfF4nICtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy53ZWVrZGF5c01pbihtb20sICcnKTtcbiAgICAgICAgICAgICAgICB0aGlzLl93ZWVrZGF5c1BhcnNlW2ldID0gbmV3IFJlZ0V4cChyZWdleC5yZXBsYWNlKCcuJywgJycpLCAnaScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gdGVzdCB0aGUgcmVnZXhcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBzdHJpY3QgJiZcbiAgICAgICAgICAgICAgICBmb3JtYXQgPT09ICdkZGRkJyAmJlxuICAgICAgICAgICAgICAgIHRoaXMuX2Z1bGxXZWVrZGF5c1BhcnNlW2ldLnRlc3Qod2Vla2RheU5hbWUpXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgICAgICAgc3RyaWN0ICYmXG4gICAgICAgICAgICAgICAgZm9ybWF0ID09PSAnZGRkJyAmJlxuICAgICAgICAgICAgICAgIHRoaXMuX3Nob3J0V2Vla2RheXNQYXJzZVtpXS50ZXN0KHdlZWtkYXlOYW1lKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgICAgIHN0cmljdCAmJlxuICAgICAgICAgICAgICAgIGZvcm1hdCA9PT0gJ2RkJyAmJlxuICAgICAgICAgICAgICAgIHRoaXMuX21pbldlZWtkYXlzUGFyc2VbaV0udGVzdCh3ZWVrZGF5TmFtZSlcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICghc3RyaWN0ICYmIHRoaXMuX3dlZWtkYXlzUGFyc2VbaV0udGVzdCh3ZWVrZGF5TmFtZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIE1PTUVOVFNcblxuICAgIGZ1bmN0aW9uIGdldFNldERheU9mV2VlayhpbnB1dCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gaW5wdXQgIT0gbnVsbCA/IHRoaXMgOiBOYU47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGRheSA9IHRoaXMuX2lzVVRDID8gdGhpcy5fZC5nZXRVVENEYXkoKSA6IHRoaXMuX2QuZ2V0RGF5KCk7XG4gICAgICAgIGlmIChpbnB1dCAhPSBudWxsKSB7XG4gICAgICAgICAgICBpbnB1dCA9IHBhcnNlV2Vla2RheShpbnB1dCwgdGhpcy5sb2NhbGVEYXRhKCkpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkKGlucHV0IC0gZGF5LCAnZCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGRheTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFNldExvY2FsZURheU9mV2VlayhpbnB1dCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gaW5wdXQgIT0gbnVsbCA/IHRoaXMgOiBOYU47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHdlZWtkYXkgPSAodGhpcy5kYXkoKSArIDcgLSB0aGlzLmxvY2FsZURhdGEoKS5fd2Vlay5kb3cpICUgNztcbiAgICAgICAgcmV0dXJuIGlucHV0ID09IG51bGwgPyB3ZWVrZGF5IDogdGhpcy5hZGQoaW5wdXQgLSB3ZWVrZGF5LCAnZCcpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFNldElTT0RheU9mV2VlayhpbnB1dCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gaW5wdXQgIT0gbnVsbCA/IHRoaXMgOiBOYU47XG4gICAgICAgIH1cblxuICAgICAgICAvLyBiZWhhdmVzIHRoZSBzYW1lIGFzIG1vbWVudCNkYXkgZXhjZXB0XG4gICAgICAgIC8vIGFzIGEgZ2V0dGVyLCByZXR1cm5zIDcgaW5zdGVhZCBvZiAwICgxLTcgcmFuZ2UgaW5zdGVhZCBvZiAwLTYpXG4gICAgICAgIC8vIGFzIGEgc2V0dGVyLCBzdW5kYXkgc2hvdWxkIGJlbG9uZyB0byB0aGUgcHJldmlvdXMgd2Vlay5cblxuICAgICAgICBpZiAoaW5wdXQgIT0gbnVsbCkge1xuICAgICAgICAgICAgdmFyIHdlZWtkYXkgPSBwYXJzZUlzb1dlZWtkYXkoaW5wdXQsIHRoaXMubG9jYWxlRGF0YSgpKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRheSh0aGlzLmRheSgpICUgNyA/IHdlZWtkYXkgOiB3ZWVrZGF5IC0gNyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kYXkoKSB8fCA3O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gd2Vla2RheXNSZWdleChpc1N0cmljdCkge1xuICAgICAgICBpZiAodGhpcy5fd2Vla2RheXNQYXJzZUV4YWN0KSB7XG4gICAgICAgICAgICBpZiAoIWhhc093blByb3AodGhpcywgJ193ZWVrZGF5c1JlZ2V4JykpIHtcbiAgICAgICAgICAgICAgICBjb21wdXRlV2Vla2RheXNQYXJzZS5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzU3RyaWN0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dlZWtkYXlzU3RyaWN0UmVnZXg7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl93ZWVrZGF5c1JlZ2V4O1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKCFoYXNPd25Qcm9wKHRoaXMsICdfd2Vla2RheXNSZWdleCcpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fd2Vla2RheXNSZWdleCA9IGRlZmF1bHRXZWVrZGF5c1JlZ2V4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dlZWtkYXlzU3RyaWN0UmVnZXggJiYgaXNTdHJpY3RcbiAgICAgICAgICAgICAgICA/IHRoaXMuX3dlZWtkYXlzU3RyaWN0UmVnZXhcbiAgICAgICAgICAgICAgICA6IHRoaXMuX3dlZWtkYXlzUmVnZXg7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiB3ZWVrZGF5c1Nob3J0UmVnZXgoaXNTdHJpY3QpIHtcbiAgICAgICAgaWYgKHRoaXMuX3dlZWtkYXlzUGFyc2VFeGFjdCkge1xuICAgICAgICAgICAgaWYgKCFoYXNPd25Qcm9wKHRoaXMsICdfd2Vla2RheXNSZWdleCcpKSB7XG4gICAgICAgICAgICAgICAgY29tcHV0ZVdlZWtkYXlzUGFyc2UuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc1N0cmljdCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl93ZWVrZGF5c1Nob3J0U3RyaWN0UmVnZXg7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl93ZWVrZGF5c1Nob3J0UmVnZXg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoIWhhc093blByb3AodGhpcywgJ193ZWVrZGF5c1Nob3J0UmVnZXgnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3dlZWtkYXlzU2hvcnRSZWdleCA9IGRlZmF1bHRXZWVrZGF5c1Nob3J0UmVnZXg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fd2Vla2RheXNTaG9ydFN0cmljdFJlZ2V4ICYmIGlzU3RyaWN0XG4gICAgICAgICAgICAgICAgPyB0aGlzLl93ZWVrZGF5c1Nob3J0U3RyaWN0UmVnZXhcbiAgICAgICAgICAgICAgICA6IHRoaXMuX3dlZWtkYXlzU2hvcnRSZWdleDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHdlZWtkYXlzTWluUmVnZXgoaXNTdHJpY3QpIHtcbiAgICAgICAgaWYgKHRoaXMuX3dlZWtkYXlzUGFyc2VFeGFjdCkge1xuICAgICAgICAgICAgaWYgKCFoYXNPd25Qcm9wKHRoaXMsICdfd2Vla2RheXNSZWdleCcpKSB7XG4gICAgICAgICAgICAgICAgY29tcHV0ZVdlZWtkYXlzUGFyc2UuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc1N0cmljdCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl93ZWVrZGF5c01pblN0cmljdFJlZ2V4O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fd2Vla2RheXNNaW5SZWdleDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICghaGFzT3duUHJvcCh0aGlzLCAnX3dlZWtkYXlzTWluUmVnZXgnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3dlZWtkYXlzTWluUmVnZXggPSBkZWZhdWx0V2Vla2RheXNNaW5SZWdleDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLl93ZWVrZGF5c01pblN0cmljdFJlZ2V4ICYmIGlzU3RyaWN0XG4gICAgICAgICAgICAgICAgPyB0aGlzLl93ZWVrZGF5c01pblN0cmljdFJlZ2V4XG4gICAgICAgICAgICAgICAgOiB0aGlzLl93ZWVrZGF5c01pblJlZ2V4O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY29tcHV0ZVdlZWtkYXlzUGFyc2UoKSB7XG4gICAgICAgIGZ1bmN0aW9uIGNtcExlblJldihhLCBiKSB7XG4gICAgICAgICAgICByZXR1cm4gYi5sZW5ndGggLSBhLmxlbmd0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBtaW5QaWVjZXMgPSBbXSxcbiAgICAgICAgICAgIHNob3J0UGllY2VzID0gW10sXG4gICAgICAgICAgICBsb25nUGllY2VzID0gW10sXG4gICAgICAgICAgICBtaXhlZFBpZWNlcyA9IFtdLFxuICAgICAgICAgICAgaSxcbiAgICAgICAgICAgIG1vbSxcbiAgICAgICAgICAgIG1pbnAsXG4gICAgICAgICAgICBzaG9ydHAsXG4gICAgICAgICAgICBsb25ncDtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IDc7IGkrKykge1xuICAgICAgICAgICAgLy8gbWFrZSB0aGUgcmVnZXggaWYgd2UgZG9uJ3QgaGF2ZSBpdCBhbHJlYWR5XG4gICAgICAgICAgICBtb20gPSBjcmVhdGVVVEMoWzIwMDAsIDFdKS5kYXkoaSk7XG4gICAgICAgICAgICBtaW5wID0gcmVnZXhFc2NhcGUodGhpcy53ZWVrZGF5c01pbihtb20sICcnKSk7XG4gICAgICAgICAgICBzaG9ydHAgPSByZWdleEVzY2FwZSh0aGlzLndlZWtkYXlzU2hvcnQobW9tLCAnJykpO1xuICAgICAgICAgICAgbG9uZ3AgPSByZWdleEVzY2FwZSh0aGlzLndlZWtkYXlzKG1vbSwgJycpKTtcbiAgICAgICAgICAgIG1pblBpZWNlcy5wdXNoKG1pbnApO1xuICAgICAgICAgICAgc2hvcnRQaWVjZXMucHVzaChzaG9ydHApO1xuICAgICAgICAgICAgbG9uZ1BpZWNlcy5wdXNoKGxvbmdwKTtcbiAgICAgICAgICAgIG1peGVkUGllY2VzLnB1c2gobWlucCk7XG4gICAgICAgICAgICBtaXhlZFBpZWNlcy5wdXNoKHNob3J0cCk7XG4gICAgICAgICAgICBtaXhlZFBpZWNlcy5wdXNoKGxvbmdwKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBTb3J0aW5nIG1ha2VzIHN1cmUgaWYgb25lIHdlZWtkYXkgKG9yIGFiYnIpIGlzIGEgcHJlZml4IG9mIGFub3RoZXIgaXRcbiAgICAgICAgLy8gd2lsbCBtYXRjaCB0aGUgbG9uZ2VyIHBpZWNlLlxuICAgICAgICBtaW5QaWVjZXMuc29ydChjbXBMZW5SZXYpO1xuICAgICAgICBzaG9ydFBpZWNlcy5zb3J0KGNtcExlblJldik7XG4gICAgICAgIGxvbmdQaWVjZXMuc29ydChjbXBMZW5SZXYpO1xuICAgICAgICBtaXhlZFBpZWNlcy5zb3J0KGNtcExlblJldik7XG5cbiAgICAgICAgdGhpcy5fd2Vla2RheXNSZWdleCA9IG5ldyBSZWdFeHAoJ14oJyArIG1peGVkUGllY2VzLmpvaW4oJ3wnKSArICcpJywgJ2knKTtcbiAgICAgICAgdGhpcy5fd2Vla2RheXNTaG9ydFJlZ2V4ID0gdGhpcy5fd2Vla2RheXNSZWdleDtcbiAgICAgICAgdGhpcy5fd2Vla2RheXNNaW5SZWdleCA9IHRoaXMuX3dlZWtkYXlzUmVnZXg7XG5cbiAgICAgICAgdGhpcy5fd2Vla2RheXNTdHJpY3RSZWdleCA9IG5ldyBSZWdFeHAoXG4gICAgICAgICAgICAnXignICsgbG9uZ1BpZWNlcy5qb2luKCd8JykgKyAnKScsXG4gICAgICAgICAgICAnaSdcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5fd2Vla2RheXNTaG9ydFN0cmljdFJlZ2V4ID0gbmV3IFJlZ0V4cChcbiAgICAgICAgICAgICdeKCcgKyBzaG9ydFBpZWNlcy5qb2luKCd8JykgKyAnKScsXG4gICAgICAgICAgICAnaSdcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5fd2Vla2RheXNNaW5TdHJpY3RSZWdleCA9IG5ldyBSZWdFeHAoXG4gICAgICAgICAgICAnXignICsgbWluUGllY2VzLmpvaW4oJ3wnKSArICcpJyxcbiAgICAgICAgICAgICdpJ1xuICAgICAgICApO1xuICAgIH1cblxuICAgIC8vIEZPUk1BVFRJTkdcblxuICAgIGZ1bmN0aW9uIGhGb3JtYXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhvdXJzKCkgJSAxMiB8fCAxMjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBrRm9ybWF0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ob3VycygpIHx8IDI0O1xuICAgIH1cblxuICAgIGFkZEZvcm1hdFRva2VuKCdIJywgWydISCcsIDJdLCAwLCAnaG91cicpO1xuICAgIGFkZEZvcm1hdFRva2VuKCdoJywgWydoaCcsIDJdLCAwLCBoRm9ybWF0KTtcbiAgICBhZGRGb3JtYXRUb2tlbignaycsIFsna2snLCAyXSwgMCwga0Zvcm1hdCk7XG5cbiAgICBhZGRGb3JtYXRUb2tlbignaG1tJywgMCwgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gJycgKyBoRm9ybWF0LmFwcGx5KHRoaXMpICsgemVyb0ZpbGwodGhpcy5taW51dGVzKCksIDIpO1xuICAgIH0pO1xuXG4gICAgYWRkRm9ybWF0VG9rZW4oJ2htbXNzJywgMCwgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgJycgK1xuICAgICAgICAgICAgaEZvcm1hdC5hcHBseSh0aGlzKSArXG4gICAgICAgICAgICB6ZXJvRmlsbCh0aGlzLm1pbnV0ZXMoKSwgMikgK1xuICAgICAgICAgICAgemVyb0ZpbGwodGhpcy5zZWNvbmRzKCksIDIpXG4gICAgICAgICk7XG4gICAgfSk7XG5cbiAgICBhZGRGb3JtYXRUb2tlbignSG1tJywgMCwgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gJycgKyB0aGlzLmhvdXJzKCkgKyB6ZXJvRmlsbCh0aGlzLm1pbnV0ZXMoKSwgMik7XG4gICAgfSk7XG5cbiAgICBhZGRGb3JtYXRUb2tlbignSG1tc3MnLCAwLCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAnJyArXG4gICAgICAgICAgICB0aGlzLmhvdXJzKCkgK1xuICAgICAgICAgICAgemVyb0ZpbGwodGhpcy5taW51dGVzKCksIDIpICtcbiAgICAgICAgICAgIHplcm9GaWxsKHRoaXMuc2Vjb25kcygpLCAyKVxuICAgICAgICApO1xuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gbWVyaWRpZW0odG9rZW4sIGxvd2VyY2FzZSkge1xuICAgICAgICBhZGRGb3JtYXRUb2tlbih0b2tlbiwgMCwgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlRGF0YSgpLm1lcmlkaWVtKFxuICAgICAgICAgICAgICAgIHRoaXMuaG91cnMoKSxcbiAgICAgICAgICAgICAgICB0aGlzLm1pbnV0ZXMoKSxcbiAgICAgICAgICAgICAgICBsb3dlcmNhc2VcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG1lcmlkaWVtKCdhJywgdHJ1ZSk7XG4gICAgbWVyaWRpZW0oJ0EnLCBmYWxzZSk7XG5cbiAgICAvLyBBTElBU0VTXG5cbiAgICBhZGRVbml0QWxpYXMoJ2hvdXInLCAnaCcpO1xuXG4gICAgLy8gUFJJT1JJVFlcbiAgICBhZGRVbml0UHJpb3JpdHkoJ2hvdXInLCAxMyk7XG5cbiAgICAvLyBQQVJTSU5HXG5cbiAgICBmdW5jdGlvbiBtYXRjaE1lcmlkaWVtKGlzU3RyaWN0LCBsb2NhbGUpIHtcbiAgICAgICAgcmV0dXJuIGxvY2FsZS5fbWVyaWRpZW1QYXJzZTtcbiAgICB9XG5cbiAgICBhZGRSZWdleFRva2VuKCdhJywgbWF0Y2hNZXJpZGllbSk7XG4gICAgYWRkUmVnZXhUb2tlbignQScsIG1hdGNoTWVyaWRpZW0pO1xuICAgIGFkZFJlZ2V4VG9rZW4oJ0gnLCBtYXRjaDF0bzIpO1xuICAgIGFkZFJlZ2V4VG9rZW4oJ2gnLCBtYXRjaDF0bzIpO1xuICAgIGFkZFJlZ2V4VG9rZW4oJ2snLCBtYXRjaDF0bzIpO1xuICAgIGFkZFJlZ2V4VG9rZW4oJ0hIJywgbWF0Y2gxdG8yLCBtYXRjaDIpO1xuICAgIGFkZFJlZ2V4VG9rZW4oJ2hoJywgbWF0Y2gxdG8yLCBtYXRjaDIpO1xuICAgIGFkZFJlZ2V4VG9rZW4oJ2trJywgbWF0Y2gxdG8yLCBtYXRjaDIpO1xuXG4gICAgYWRkUmVnZXhUb2tlbignaG1tJywgbWF0Y2gzdG80KTtcbiAgICBhZGRSZWdleFRva2VuKCdobW1zcycsIG1hdGNoNXRvNik7XG4gICAgYWRkUmVnZXhUb2tlbignSG1tJywgbWF0Y2gzdG80KTtcbiAgICBhZGRSZWdleFRva2VuKCdIbW1zcycsIG1hdGNoNXRvNik7XG5cbiAgICBhZGRQYXJzZVRva2VuKFsnSCcsICdISCddLCBIT1VSKTtcbiAgICBhZGRQYXJzZVRva2VuKFsnaycsICdrayddLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5LCBjb25maWcpIHtcbiAgICAgICAgdmFyIGtJbnB1dCA9IHRvSW50KGlucHV0KTtcbiAgICAgICAgYXJyYXlbSE9VUl0gPSBrSW5wdXQgPT09IDI0ID8gMCA6IGtJbnB1dDtcbiAgICB9KTtcbiAgICBhZGRQYXJzZVRva2VuKFsnYScsICdBJ10sIGZ1bmN0aW9uIChpbnB1dCwgYXJyYXksIGNvbmZpZykge1xuICAgICAgICBjb25maWcuX2lzUG0gPSBjb25maWcuX2xvY2FsZS5pc1BNKGlucHV0KTtcbiAgICAgICAgY29uZmlnLl9tZXJpZGllbSA9IGlucHV0O1xuICAgIH0pO1xuICAgIGFkZFBhcnNlVG9rZW4oWydoJywgJ2hoJ10sIGZ1bmN0aW9uIChpbnB1dCwgYXJyYXksIGNvbmZpZykge1xuICAgICAgICBhcnJheVtIT1VSXSA9IHRvSW50KGlucHV0KTtcbiAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykuYmlnSG91ciA9IHRydWU7XG4gICAgfSk7XG4gICAgYWRkUGFyc2VUb2tlbignaG1tJywgZnVuY3Rpb24gKGlucHV0LCBhcnJheSwgY29uZmlnKSB7XG4gICAgICAgIHZhciBwb3MgPSBpbnB1dC5sZW5ndGggLSAyO1xuICAgICAgICBhcnJheVtIT1VSXSA9IHRvSW50KGlucHV0LnN1YnN0cigwLCBwb3MpKTtcbiAgICAgICAgYXJyYXlbTUlOVVRFXSA9IHRvSW50KGlucHV0LnN1YnN0cihwb3MpKTtcbiAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykuYmlnSG91ciA9IHRydWU7XG4gICAgfSk7XG4gICAgYWRkUGFyc2VUb2tlbignaG1tc3MnLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5LCBjb25maWcpIHtcbiAgICAgICAgdmFyIHBvczEgPSBpbnB1dC5sZW5ndGggLSA0LFxuICAgICAgICAgICAgcG9zMiA9IGlucHV0Lmxlbmd0aCAtIDI7XG4gICAgICAgIGFycmF5W0hPVVJdID0gdG9JbnQoaW5wdXQuc3Vic3RyKDAsIHBvczEpKTtcbiAgICAgICAgYXJyYXlbTUlOVVRFXSA9IHRvSW50KGlucHV0LnN1YnN0cihwb3MxLCAyKSk7XG4gICAgICAgIGFycmF5W1NFQ09ORF0gPSB0b0ludChpbnB1dC5zdWJzdHIocG9zMikpO1xuICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS5iaWdIb3VyID0gdHJ1ZTtcbiAgICB9KTtcbiAgICBhZGRQYXJzZVRva2VuKCdIbW0nLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5LCBjb25maWcpIHtcbiAgICAgICAgdmFyIHBvcyA9IGlucHV0Lmxlbmd0aCAtIDI7XG4gICAgICAgIGFycmF5W0hPVVJdID0gdG9JbnQoaW5wdXQuc3Vic3RyKDAsIHBvcykpO1xuICAgICAgICBhcnJheVtNSU5VVEVdID0gdG9JbnQoaW5wdXQuc3Vic3RyKHBvcykpO1xuICAgIH0pO1xuICAgIGFkZFBhcnNlVG9rZW4oJ0htbXNzJywgZnVuY3Rpb24gKGlucHV0LCBhcnJheSwgY29uZmlnKSB7XG4gICAgICAgIHZhciBwb3MxID0gaW5wdXQubGVuZ3RoIC0gNCxcbiAgICAgICAgICAgIHBvczIgPSBpbnB1dC5sZW5ndGggLSAyO1xuICAgICAgICBhcnJheVtIT1VSXSA9IHRvSW50KGlucHV0LnN1YnN0cigwLCBwb3MxKSk7XG4gICAgICAgIGFycmF5W01JTlVURV0gPSB0b0ludChpbnB1dC5zdWJzdHIocG9zMSwgMikpO1xuICAgICAgICBhcnJheVtTRUNPTkRdID0gdG9JbnQoaW5wdXQuc3Vic3RyKHBvczIpKTtcbiAgICB9KTtcblxuICAgIC8vIExPQ0FMRVNcblxuICAgIGZ1bmN0aW9uIGxvY2FsZUlzUE0oaW5wdXQpIHtcbiAgICAgICAgLy8gSUU4IFF1aXJrcyBNb2RlICYgSUU3IFN0YW5kYXJkcyBNb2RlIGRvIG5vdCBhbGxvdyBhY2Nlc3Npbmcgc3RyaW5ncyBsaWtlIGFycmF5c1xuICAgICAgICAvLyBVc2luZyBjaGFyQXQgc2hvdWxkIGJlIG1vcmUgY29tcGF0aWJsZS5cbiAgICAgICAgcmV0dXJuIChpbnB1dCArICcnKS50b0xvd2VyQ2FzZSgpLmNoYXJBdCgwKSA9PT0gJ3AnO1xuICAgIH1cblxuICAgIHZhciBkZWZhdWx0TG9jYWxlTWVyaWRpZW1QYXJzZSA9IC9bYXBdXFwuP20/XFwuPy9pLFxuICAgICAgICAvLyBTZXR0aW5nIHRoZSBob3VyIHNob3VsZCBrZWVwIHRoZSB0aW1lLCBiZWNhdXNlIHRoZSB1c2VyIGV4cGxpY2l0bHlcbiAgICAgICAgLy8gc3BlY2lmaWVkIHdoaWNoIGhvdXIgdGhleSB3YW50LiBTbyB0cnlpbmcgdG8gbWFpbnRhaW4gdGhlIHNhbWUgaG91ciAoaW5cbiAgICAgICAgLy8gYSBuZXcgdGltZXpvbmUpIG1ha2VzIHNlbnNlLiBBZGRpbmcvc3VidHJhY3RpbmcgaG91cnMgZG9lcyBub3QgZm9sbG93XG4gICAgICAgIC8vIHRoaXMgcnVsZS5cbiAgICAgICAgZ2V0U2V0SG91ciA9IG1ha2VHZXRTZXQoJ0hvdXJzJywgdHJ1ZSk7XG5cbiAgICBmdW5jdGlvbiBsb2NhbGVNZXJpZGllbShob3VycywgbWludXRlcywgaXNMb3dlcikge1xuICAgICAgICBpZiAoaG91cnMgPiAxMSkge1xuICAgICAgICAgICAgcmV0dXJuIGlzTG93ZXIgPyAncG0nIDogJ1BNJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBpc0xvd2VyID8gJ2FtJyA6ICdBTSc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgYmFzZUNvbmZpZyA9IHtcbiAgICAgICAgY2FsZW5kYXI6IGRlZmF1bHRDYWxlbmRhcixcbiAgICAgICAgbG9uZ0RhdGVGb3JtYXQ6IGRlZmF1bHRMb25nRGF0ZUZvcm1hdCxcbiAgICAgICAgaW52YWxpZERhdGU6IGRlZmF1bHRJbnZhbGlkRGF0ZSxcbiAgICAgICAgb3JkaW5hbDogZGVmYXVsdE9yZGluYWwsXG4gICAgICAgIGRheU9mTW9udGhPcmRpbmFsUGFyc2U6IGRlZmF1bHREYXlPZk1vbnRoT3JkaW5hbFBhcnNlLFxuICAgICAgICByZWxhdGl2ZVRpbWU6IGRlZmF1bHRSZWxhdGl2ZVRpbWUsXG5cbiAgICAgICAgbW9udGhzOiBkZWZhdWx0TG9jYWxlTW9udGhzLFxuICAgICAgICBtb250aHNTaG9ydDogZGVmYXVsdExvY2FsZU1vbnRoc1Nob3J0LFxuXG4gICAgICAgIHdlZWs6IGRlZmF1bHRMb2NhbGVXZWVrLFxuXG4gICAgICAgIHdlZWtkYXlzOiBkZWZhdWx0TG9jYWxlV2Vla2RheXMsXG4gICAgICAgIHdlZWtkYXlzTWluOiBkZWZhdWx0TG9jYWxlV2Vla2RheXNNaW4sXG4gICAgICAgIHdlZWtkYXlzU2hvcnQ6IGRlZmF1bHRMb2NhbGVXZWVrZGF5c1Nob3J0LFxuXG4gICAgICAgIG1lcmlkaWVtUGFyc2U6IGRlZmF1bHRMb2NhbGVNZXJpZGllbVBhcnNlLFxuICAgIH07XG5cbiAgICAvLyBpbnRlcm5hbCBzdG9yYWdlIGZvciBsb2NhbGUgY29uZmlnIGZpbGVzXG4gICAgdmFyIGxvY2FsZXMgPSB7fSxcbiAgICAgICAgbG9jYWxlRmFtaWxpZXMgPSB7fSxcbiAgICAgICAgZ2xvYmFsTG9jYWxlO1xuXG4gICAgZnVuY3Rpb24gY29tbW9uUHJlZml4KGFycjEsIGFycjIpIHtcbiAgICAgICAgdmFyIGksXG4gICAgICAgICAgICBtaW5sID0gTWF0aC5taW4oYXJyMS5sZW5ndGgsIGFycjIubGVuZ3RoKTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IG1pbmw7IGkgKz0gMSkge1xuICAgICAgICAgICAgaWYgKGFycjFbaV0gIT09IGFycjJbaV0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbWlubDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBub3JtYWxpemVMb2NhbGUoa2V5KSB7XG4gICAgICAgIHJldHVybiBrZXkgPyBrZXkudG9Mb3dlckNhc2UoKS5yZXBsYWNlKCdfJywgJy0nKSA6IGtleTtcbiAgICB9XG5cbiAgICAvLyBwaWNrIHRoZSBsb2NhbGUgZnJvbSB0aGUgYXJyYXlcbiAgICAvLyB0cnkgWydlbi1hdScsICdlbi1nYiddIGFzICdlbi1hdScsICdlbi1nYicsICdlbicsIGFzIGluIG1vdmUgdGhyb3VnaCB0aGUgbGlzdCB0cnlpbmcgZWFjaFxuICAgIC8vIHN1YnN0cmluZyBmcm9tIG1vc3Qgc3BlY2lmaWMgdG8gbGVhc3QsIGJ1dCBtb3ZlIHRvIHRoZSBuZXh0IGFycmF5IGl0ZW0gaWYgaXQncyBhIG1vcmUgc3BlY2lmaWMgdmFyaWFudCB0aGFuIHRoZSBjdXJyZW50IHJvb3RcbiAgICBmdW5jdGlvbiBjaG9vc2VMb2NhbGUobmFtZXMpIHtcbiAgICAgICAgdmFyIGkgPSAwLFxuICAgICAgICAgICAgaixcbiAgICAgICAgICAgIG5leHQsXG4gICAgICAgICAgICBsb2NhbGUsXG4gICAgICAgICAgICBzcGxpdDtcblxuICAgICAgICB3aGlsZSAoaSA8IG5hbWVzLmxlbmd0aCkge1xuICAgICAgICAgICAgc3BsaXQgPSBub3JtYWxpemVMb2NhbGUobmFtZXNbaV0pLnNwbGl0KCctJyk7XG4gICAgICAgICAgICBqID0gc3BsaXQubGVuZ3RoO1xuICAgICAgICAgICAgbmV4dCA9IG5vcm1hbGl6ZUxvY2FsZShuYW1lc1tpICsgMV0pO1xuICAgICAgICAgICAgbmV4dCA9IG5leHQgPyBuZXh0LnNwbGl0KCctJykgOiBudWxsO1xuICAgICAgICAgICAgd2hpbGUgKGogPiAwKSB7XG4gICAgICAgICAgICAgICAgbG9jYWxlID0gbG9hZExvY2FsZShzcGxpdC5zbGljZSgwLCBqKS5qb2luKCctJykpO1xuICAgICAgICAgICAgICAgIGlmIChsb2NhbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvY2FsZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICBuZXh0ICYmXG4gICAgICAgICAgICAgICAgICAgIG5leHQubGVuZ3RoID49IGogJiZcbiAgICAgICAgICAgICAgICAgICAgY29tbW9uUHJlZml4KHNwbGl0LCBuZXh0KSA+PSBqIC0gMVxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAvL3RoZSBuZXh0IGFycmF5IGl0ZW0gaXMgYmV0dGVyIHRoYW4gYSBzaGFsbG93ZXIgc3Vic3RyaW5nIG9mIHRoaXMgb25lXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBqLS07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpKys7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGdsb2JhbExvY2FsZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsb2FkTG9jYWxlKG5hbWUpIHtcbiAgICAgICAgdmFyIG9sZExvY2FsZSA9IG51bGwsXG4gICAgICAgICAgICBhbGlhc2VkUmVxdWlyZTtcbiAgICAgICAgLy8gVE9ETzogRmluZCBhIGJldHRlciB3YXkgdG8gcmVnaXN0ZXIgYW5kIGxvYWQgYWxsIHRoZSBsb2NhbGVzIGluIE5vZGVcbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgbG9jYWxlc1tuYW1lXSA9PT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgICAgICAgbW9kdWxlICYmXG4gICAgICAgICAgICBtb2R1bGUuZXhwb3J0c1xuICAgICAgICApIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgb2xkTG9jYWxlID0gZ2xvYmFsTG9jYWxlLl9hYmJyO1xuICAgICAgICAgICAgICAgIGFsaWFzZWRSZXF1aXJlID0gcmVxdWlyZTtcbiAgICAgICAgICAgICAgICBhbGlhc2VkUmVxdWlyZSgnLi9sb2NhbGUvJyArIG5hbWUpO1xuICAgICAgICAgICAgICAgIGdldFNldEdsb2JhbExvY2FsZShvbGRMb2NhbGUpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIC8vIG1hcmsgYXMgbm90IGZvdW5kIHRvIGF2b2lkIHJlcGVhdGluZyBleHBlbnNpdmUgZmlsZSByZXF1aXJlIGNhbGwgY2F1c2luZyBoaWdoIENQVVxuICAgICAgICAgICAgICAgIC8vIHdoZW4gdHJ5aW5nIHRvIGZpbmQgZW4tVVMsIGVuX1VTLCBlbi11cyBmb3IgZXZlcnkgZm9ybWF0IGNhbGxcbiAgICAgICAgICAgICAgICBsb2NhbGVzW25hbWVdID0gbnVsbDsgLy8gbnVsbCBtZWFucyBub3QgZm91bmRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbG9jYWxlc1tuYW1lXTtcbiAgICB9XG5cbiAgICAvLyBUaGlzIGZ1bmN0aW9uIHdpbGwgbG9hZCBsb2NhbGUgYW5kIHRoZW4gc2V0IHRoZSBnbG9iYWwgbG9jYWxlLiAgSWZcbiAgICAvLyBubyBhcmd1bWVudHMgYXJlIHBhc3NlZCBpbiwgaXQgd2lsbCBzaW1wbHkgcmV0dXJuIHRoZSBjdXJyZW50IGdsb2JhbFxuICAgIC8vIGxvY2FsZSBrZXkuXG4gICAgZnVuY3Rpb24gZ2V0U2V0R2xvYmFsTG9jYWxlKGtleSwgdmFsdWVzKSB7XG4gICAgICAgIHZhciBkYXRhO1xuICAgICAgICBpZiAoa2V5KSB7XG4gICAgICAgICAgICBpZiAoaXNVbmRlZmluZWQodmFsdWVzKSkge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBnZXRMb2NhbGUoa2V5KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGRlZmluZUxvY2FsZShrZXksIHZhbHVlcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgLy8gbW9tZW50LmR1cmF0aW9uLl9sb2NhbGUgPSBtb21lbnQuX2xvY2FsZSA9IGRhdGE7XG4gICAgICAgICAgICAgICAgZ2xvYmFsTG9jYWxlID0gZGF0YTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJyAmJiBjb25zb2xlLndhcm4pIHtcbiAgICAgICAgICAgICAgICAgICAgLy93YXJuIHVzZXIgaWYgYXJndW1lbnRzIGFyZSBwYXNzZWQgYnV0IHRoZSBsb2NhbGUgY291bGQgbm90IGJlIHNldFxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICAgICAgICAgICAgICAnTG9jYWxlICcgKyBrZXkgKyAnIG5vdCBmb3VuZC4gRGlkIHlvdSBmb3JnZXQgdG8gbG9hZCBpdD8nXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGdsb2JhbExvY2FsZS5fYWJicjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkZWZpbmVMb2NhbGUobmFtZSwgY29uZmlnKSB7XG4gICAgICAgIGlmIChjb25maWcgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHZhciBsb2NhbGUsXG4gICAgICAgICAgICAgICAgcGFyZW50Q29uZmlnID0gYmFzZUNvbmZpZztcbiAgICAgICAgICAgIGNvbmZpZy5hYmJyID0gbmFtZTtcbiAgICAgICAgICAgIGlmIChsb2NhbGVzW25hbWVdICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBkZXByZWNhdGVTaW1wbGUoXG4gICAgICAgICAgICAgICAgICAgICdkZWZpbmVMb2NhbGVPdmVycmlkZScsXG4gICAgICAgICAgICAgICAgICAgICd1c2UgbW9tZW50LnVwZGF0ZUxvY2FsZShsb2NhbGVOYW1lLCBjb25maWcpIHRvIGNoYW5nZSAnICtcbiAgICAgICAgICAgICAgICAgICAgICAgICdhbiBleGlzdGluZyBsb2NhbGUuIG1vbWVudC5kZWZpbmVMb2NhbGUobG9jYWxlTmFtZSwgJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAnY29uZmlnKSBzaG91bGQgb25seSBiZSB1c2VkIGZvciBjcmVhdGluZyBhIG5ldyBsb2NhbGUgJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAnU2VlIGh0dHA6Ly9tb21lbnRqcy5jb20vZ3VpZGVzLyMvd2FybmluZ3MvZGVmaW5lLWxvY2FsZS8gZm9yIG1vcmUgaW5mby4nXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBwYXJlbnRDb25maWcgPSBsb2NhbGVzW25hbWVdLl9jb25maWc7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZy5wYXJlbnRMb2NhbGUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmIChsb2NhbGVzW2NvbmZpZy5wYXJlbnRMb2NhbGVdICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50Q29uZmlnID0gbG9jYWxlc1tjb25maWcucGFyZW50TG9jYWxlXS5fY29uZmlnO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxvY2FsZSA9IGxvYWRMb2NhbGUoY29uZmlnLnBhcmVudExvY2FsZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsb2NhbGUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50Q29uZmlnID0gbG9jYWxlLl9jb25maWc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWxvY2FsZUZhbWlsaWVzW2NvbmZpZy5wYXJlbnRMb2NhbGVdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxlRmFtaWxpZXNbY29uZmlnLnBhcmVudExvY2FsZV0gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsZUZhbWlsaWVzW2NvbmZpZy5wYXJlbnRMb2NhbGVdLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnOiBjb25maWcsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbG9jYWxlc1tuYW1lXSA9IG5ldyBMb2NhbGUobWVyZ2VDb25maWdzKHBhcmVudENvbmZpZywgY29uZmlnKSk7XG5cbiAgICAgICAgICAgIGlmIChsb2NhbGVGYW1pbGllc1tuYW1lXSkge1xuICAgICAgICAgICAgICAgIGxvY2FsZUZhbWlsaWVzW25hbWVdLmZvckVhY2goZnVuY3Rpb24gKHgpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmaW5lTG9jYWxlKHgubmFtZSwgeC5jb25maWcpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBiYWNrd2FyZHMgY29tcGF0IGZvciBub3c6IGFsc28gc2V0IHRoZSBsb2NhbGVcbiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSBzZXQgdGhlIGxvY2FsZSBBRlRFUiBhbGwgY2hpbGQgbG9jYWxlcyBoYXZlIGJlZW5cbiAgICAgICAgICAgIC8vIGNyZWF0ZWQsIHNvIHdlIHdvbid0IGVuZCB1cCB3aXRoIHRoZSBjaGlsZCBsb2NhbGUgc2V0LlxuICAgICAgICAgICAgZ2V0U2V0R2xvYmFsTG9jYWxlKG5hbWUpO1xuXG4gICAgICAgICAgICByZXR1cm4gbG9jYWxlc1tuYW1lXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIHVzZWZ1bCBmb3IgdGVzdGluZ1xuICAgICAgICAgICAgZGVsZXRlIGxvY2FsZXNbbmFtZV07XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVwZGF0ZUxvY2FsZShuYW1lLCBjb25maWcpIHtcbiAgICAgICAgaWYgKGNvbmZpZyAhPSBudWxsKSB7XG4gICAgICAgICAgICB2YXIgbG9jYWxlLFxuICAgICAgICAgICAgICAgIHRtcExvY2FsZSxcbiAgICAgICAgICAgICAgICBwYXJlbnRDb25maWcgPSBiYXNlQ29uZmlnO1xuXG4gICAgICAgICAgICBpZiAobG9jYWxlc1tuYW1lXSAhPSBudWxsICYmIGxvY2FsZXNbbmFtZV0ucGFyZW50TG9jYWxlICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgY2hpbGQgbG9jYWxlIGluLXBsYWNlIHRvIGF2b2lkIG1lbW9yeS1sZWFrc1xuICAgICAgICAgICAgICAgIGxvY2FsZXNbbmFtZV0uc2V0KG1lcmdlQ29uZmlncyhsb2NhbGVzW25hbWVdLl9jb25maWcsIGNvbmZpZykpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBNRVJHRVxuICAgICAgICAgICAgICAgIHRtcExvY2FsZSA9IGxvYWRMb2NhbGUobmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKHRtcExvY2FsZSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmVudENvbmZpZyA9IHRtcExvY2FsZS5fY29uZmlnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25maWcgPSBtZXJnZUNvbmZpZ3MocGFyZW50Q29uZmlnLCBjb25maWcpO1xuICAgICAgICAgICAgICAgIGlmICh0bXBMb2NhbGUgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAvLyB1cGRhdGVMb2NhbGUgaXMgY2FsbGVkIGZvciBjcmVhdGluZyBhIG5ldyBsb2NhbGVcbiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGFiYnIgc28gaXQgd2lsbCBoYXZlIGEgbmFtZSAoZ2V0dGVycyByZXR1cm5cbiAgICAgICAgICAgICAgICAgICAgLy8gdW5kZWZpbmVkIG90aGVyd2lzZSkuXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hYmJyID0gbmFtZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbG9jYWxlID0gbmV3IExvY2FsZShjb25maWcpO1xuICAgICAgICAgICAgICAgIGxvY2FsZS5wYXJlbnRMb2NhbGUgPSBsb2NhbGVzW25hbWVdO1xuICAgICAgICAgICAgICAgIGxvY2FsZXNbbmFtZV0gPSBsb2NhbGU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGJhY2t3YXJkcyBjb21wYXQgZm9yIG5vdzogYWxzbyBzZXQgdGhlIGxvY2FsZVxuICAgICAgICAgICAgZ2V0U2V0R2xvYmFsTG9jYWxlKG5hbWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gcGFzcyBudWxsIGZvciBjb25maWcgdG8gdW51cGRhdGUsIHVzZWZ1bCBmb3IgdGVzdHNcbiAgICAgICAgICAgIGlmIChsb2NhbGVzW25hbWVdICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAobG9jYWxlc1tuYW1lXS5wYXJlbnRMb2NhbGUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBsb2NhbGVzW25hbWVdID0gbG9jYWxlc1tuYW1lXS5wYXJlbnRMb2NhbGU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChuYW1lID09PSBnZXRTZXRHbG9iYWxMb2NhbGUoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0U2V0R2xvYmFsTG9jYWxlKG5hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChsb2NhbGVzW25hbWVdICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGxvY2FsZXNbbmFtZV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsb2NhbGVzW25hbWVdO1xuICAgIH1cblxuICAgIC8vIHJldHVybnMgbG9jYWxlIGRhdGFcbiAgICBmdW5jdGlvbiBnZXRMb2NhbGUoa2V5KSB7XG4gICAgICAgIHZhciBsb2NhbGU7XG5cbiAgICAgICAgaWYgKGtleSAmJiBrZXkuX2xvY2FsZSAmJiBrZXkuX2xvY2FsZS5fYWJicikge1xuICAgICAgICAgICAga2V5ID0ga2V5Ll9sb2NhbGUuX2FiYnI7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWtleSkge1xuICAgICAgICAgICAgcmV0dXJuIGdsb2JhbExvY2FsZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghaXNBcnJheShrZXkpKSB7XG4gICAgICAgICAgICAvL3Nob3J0LWNpcmN1aXQgZXZlcnl0aGluZyBlbHNlXG4gICAgICAgICAgICBsb2NhbGUgPSBsb2FkTG9jYWxlKGtleSk7XG4gICAgICAgICAgICBpZiAobG9jYWxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxvY2FsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGtleSA9IFtrZXldO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNob29zZUxvY2FsZShrZXkpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxpc3RMb2NhbGVzKCkge1xuICAgICAgICByZXR1cm4ga2V5cyhsb2NhbGVzKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjaGVja092ZXJmbG93KG0pIHtcbiAgICAgICAgdmFyIG92ZXJmbG93LFxuICAgICAgICAgICAgYSA9IG0uX2E7XG5cbiAgICAgICAgaWYgKGEgJiYgZ2V0UGFyc2luZ0ZsYWdzKG0pLm92ZXJmbG93ID09PSAtMikge1xuICAgICAgICAgICAgb3ZlcmZsb3cgPVxuICAgICAgICAgICAgICAgIGFbTU9OVEhdIDwgMCB8fCBhW01PTlRIXSA+IDExXG4gICAgICAgICAgICAgICAgICAgID8gTU9OVEhcbiAgICAgICAgICAgICAgICAgICAgOiBhW0RBVEVdIDwgMSB8fCBhW0RBVEVdID4gZGF5c0luTW9udGgoYVtZRUFSXSwgYVtNT05USF0pXG4gICAgICAgICAgICAgICAgICAgID8gREFURVxuICAgICAgICAgICAgICAgICAgICA6IGFbSE9VUl0gPCAwIHx8XG4gICAgICAgICAgICAgICAgICAgICAgYVtIT1VSXSA+IDI0IHx8XG4gICAgICAgICAgICAgICAgICAgICAgKGFbSE9VUl0gPT09IDI0ICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgIChhW01JTlVURV0gIT09IDAgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFbU0VDT05EXSAhPT0gMCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYVtNSUxMSVNFQ09ORF0gIT09IDApKVxuICAgICAgICAgICAgICAgICAgICA/IEhPVVJcbiAgICAgICAgICAgICAgICAgICAgOiBhW01JTlVURV0gPCAwIHx8IGFbTUlOVVRFXSA+IDU5XG4gICAgICAgICAgICAgICAgICAgID8gTUlOVVRFXG4gICAgICAgICAgICAgICAgICAgIDogYVtTRUNPTkRdIDwgMCB8fCBhW1NFQ09ORF0gPiA1OVxuICAgICAgICAgICAgICAgICAgICA/IFNFQ09ORFxuICAgICAgICAgICAgICAgICAgICA6IGFbTUlMTElTRUNPTkRdIDwgMCB8fCBhW01JTExJU0VDT05EXSA+IDk5OVxuICAgICAgICAgICAgICAgICAgICA/IE1JTExJU0VDT05EXG4gICAgICAgICAgICAgICAgICAgIDogLTE7XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBnZXRQYXJzaW5nRmxhZ3MobSkuX292ZXJmbG93RGF5T2ZZZWFyICYmXG4gICAgICAgICAgICAgICAgKG92ZXJmbG93IDwgWUVBUiB8fCBvdmVyZmxvdyA+IERBVEUpXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBvdmVyZmxvdyA9IERBVEU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ2V0UGFyc2luZ0ZsYWdzKG0pLl9vdmVyZmxvd1dlZWtzICYmIG92ZXJmbG93ID09PSAtMSkge1xuICAgICAgICAgICAgICAgIG92ZXJmbG93ID0gV0VFSztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChnZXRQYXJzaW5nRmxhZ3MobSkuX292ZXJmbG93V2Vla2RheSAmJiBvdmVyZmxvdyA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICBvdmVyZmxvdyA9IFdFRUtEQVk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGdldFBhcnNpbmdGbGFncyhtKS5vdmVyZmxvdyA9IG92ZXJmbG93O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG07XG4gICAgfVxuXG4gICAgLy8gaXNvIDg2MDEgcmVnZXhcbiAgICAvLyAwMDAwLTAwLTAwIDAwMDAtVzAwIG9yIDAwMDAtVzAwLTAgKyBUICsgMDAgb3IgMDA6MDAgb3IgMDA6MDA6MDAgb3IgMDA6MDA6MDAuMDAwICsgKzAwOjAwIG9yICswMDAwIG9yICswMClcbiAgICB2YXIgZXh0ZW5kZWRJc29SZWdleCA9IC9eXFxzKigoPzpbKy1dXFxkezZ9fFxcZHs0fSktKD86XFxkXFxkLVxcZFxcZHxXXFxkXFxkLVxcZHxXXFxkXFxkfFxcZFxcZFxcZHxcXGRcXGQpKSg/OihUfCApKFxcZFxcZCg/OjpcXGRcXGQoPzo6XFxkXFxkKD86Wy4sXVxcZCspPyk/KT8pKFsrLV1cXGRcXGQoPzo6P1xcZFxcZCk/fFxccypaKT8pPyQvLFxuICAgICAgICBiYXNpY0lzb1JlZ2V4ID0gL15cXHMqKCg/OlsrLV1cXGR7Nn18XFxkezR9KSg/OlxcZFxcZFxcZFxcZHxXXFxkXFxkXFxkfFdcXGRcXGR8XFxkXFxkXFxkfFxcZFxcZHwpKSg/OihUfCApKFxcZFxcZCg/OlxcZFxcZCg/OlxcZFxcZCg/OlsuLF1cXGQrKT8pPyk/KShbKy1dXFxkXFxkKD86Oj9cXGRcXGQpP3xcXHMqWik/KT8kLyxcbiAgICAgICAgdHpSZWdleCA9IC9afFsrLV1cXGRcXGQoPzo6P1xcZFxcZCk/LyxcbiAgICAgICAgaXNvRGF0ZXMgPSBbXG4gICAgICAgICAgICBbJ1lZWVlZWS1NTS1ERCcsIC9bKy1dXFxkezZ9LVxcZFxcZC1cXGRcXGQvXSxcbiAgICAgICAgICAgIFsnWVlZWS1NTS1ERCcsIC9cXGR7NH0tXFxkXFxkLVxcZFxcZC9dLFxuICAgICAgICAgICAgWydHR0dHLVtXXVdXLUUnLCAvXFxkezR9LVdcXGRcXGQtXFxkL10sXG4gICAgICAgICAgICBbJ0dHR0ctW1ddV1cnLCAvXFxkezR9LVdcXGRcXGQvLCBmYWxzZV0sXG4gICAgICAgICAgICBbJ1lZWVktREREJywgL1xcZHs0fS1cXGR7M30vXSxcbiAgICAgICAgICAgIFsnWVlZWS1NTScsIC9cXGR7NH0tXFxkXFxkLywgZmFsc2VdLFxuICAgICAgICAgICAgWydZWVlZWVlNTUREJywgL1srLV1cXGR7MTB9L10sXG4gICAgICAgICAgICBbJ1lZWVlNTUREJywgL1xcZHs4fS9dLFxuICAgICAgICAgICAgWydHR0dHW1ddV1dFJywgL1xcZHs0fVdcXGR7M30vXSxcbiAgICAgICAgICAgIFsnR0dHR1tXXVdXJywgL1xcZHs0fVdcXGR7Mn0vLCBmYWxzZV0sXG4gICAgICAgICAgICBbJ1lZWVlEREQnLCAvXFxkezd9L10sXG4gICAgICAgICAgICBbJ1lZWVlNTScsIC9cXGR7Nn0vLCBmYWxzZV0sXG4gICAgICAgICAgICBbJ1lZWVknLCAvXFxkezR9LywgZmFsc2VdLFxuICAgICAgICBdLFxuICAgICAgICAvLyBpc28gdGltZSBmb3JtYXRzIGFuZCByZWdleGVzXG4gICAgICAgIGlzb1RpbWVzID0gW1xuICAgICAgICAgICAgWydISDptbTpzcy5TU1NTJywgL1xcZFxcZDpcXGRcXGQ6XFxkXFxkXFwuXFxkKy9dLFxuICAgICAgICAgICAgWydISDptbTpzcyxTU1NTJywgL1xcZFxcZDpcXGRcXGQ6XFxkXFxkLFxcZCsvXSxcbiAgICAgICAgICAgIFsnSEg6bW06c3MnLCAvXFxkXFxkOlxcZFxcZDpcXGRcXGQvXSxcbiAgICAgICAgICAgIFsnSEg6bW0nLCAvXFxkXFxkOlxcZFxcZC9dLFxuICAgICAgICAgICAgWydISG1tc3MuU1NTUycsIC9cXGRcXGRcXGRcXGRcXGRcXGRcXC5cXGQrL10sXG4gICAgICAgICAgICBbJ0hIbW1zcyxTU1NTJywgL1xcZFxcZFxcZFxcZFxcZFxcZCxcXGQrL10sXG4gICAgICAgICAgICBbJ0hIbW1zcycsIC9cXGRcXGRcXGRcXGRcXGRcXGQvXSxcbiAgICAgICAgICAgIFsnSEhtbScsIC9cXGRcXGRcXGRcXGQvXSxcbiAgICAgICAgICAgIFsnSEgnLCAvXFxkXFxkL10sXG4gICAgICAgIF0sXG4gICAgICAgIGFzcE5ldEpzb25SZWdleCA9IC9eXFwvP0RhdGVcXCgoLT9cXGQrKS9pLFxuICAgICAgICAvLyBSRkMgMjgyMiByZWdleDogRm9yIGRldGFpbHMgc2VlIGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmMyODIyI3NlY3Rpb24tMy4zXG4gICAgICAgIHJmYzI4MjIgPSAvXig/OihNb258VHVlfFdlZHxUaHV8RnJpfFNhdHxTdW4pLD9cXHMpPyhcXGR7MSwyfSlcXHMoSmFufEZlYnxNYXJ8QXByfE1heXxKdW58SnVsfEF1Z3xTZXB8T2N0fE5vdnxEZWMpXFxzKFxcZHsyLDR9KVxccyhcXGRcXGQpOihcXGRcXGQpKD86OihcXGRcXGQpKT9cXHMoPzooVVR8R01UfFtFQ01QXVtTRF1UKXwoW1p6XSl8KFsrLV1cXGR7NH0pKSQvLFxuICAgICAgICBvYnNPZmZzZXRzID0ge1xuICAgICAgICAgICAgVVQ6IDAsXG4gICAgICAgICAgICBHTVQ6IDAsXG4gICAgICAgICAgICBFRFQ6IC00ICogNjAsXG4gICAgICAgICAgICBFU1Q6IC01ICogNjAsXG4gICAgICAgICAgICBDRFQ6IC01ICogNjAsXG4gICAgICAgICAgICBDU1Q6IC02ICogNjAsXG4gICAgICAgICAgICBNRFQ6IC02ICogNjAsXG4gICAgICAgICAgICBNU1Q6IC03ICogNjAsXG4gICAgICAgICAgICBQRFQ6IC03ICogNjAsXG4gICAgICAgICAgICBQU1Q6IC04ICogNjAsXG4gICAgICAgIH07XG5cbiAgICAvLyBkYXRlIGZyb20gaXNvIGZvcm1hdFxuICAgIGZ1bmN0aW9uIGNvbmZpZ0Zyb21JU08oY29uZmlnKSB7XG4gICAgICAgIHZhciBpLFxuICAgICAgICAgICAgbCxcbiAgICAgICAgICAgIHN0cmluZyA9IGNvbmZpZy5faSxcbiAgICAgICAgICAgIG1hdGNoID0gZXh0ZW5kZWRJc29SZWdleC5leGVjKHN0cmluZykgfHwgYmFzaWNJc29SZWdleC5leGVjKHN0cmluZyksXG4gICAgICAgICAgICBhbGxvd1RpbWUsXG4gICAgICAgICAgICBkYXRlRm9ybWF0LFxuICAgICAgICAgICAgdGltZUZvcm1hdCxcbiAgICAgICAgICAgIHR6Rm9ybWF0O1xuXG4gICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykuaXNvID0gdHJ1ZTtcblxuICAgICAgICAgICAgZm9yIChpID0gMCwgbCA9IGlzb0RhdGVzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChpc29EYXRlc1tpXVsxXS5leGVjKG1hdGNoWzFdKSkge1xuICAgICAgICAgICAgICAgICAgICBkYXRlRm9ybWF0ID0gaXNvRGF0ZXNbaV1bMF07XG4gICAgICAgICAgICAgICAgICAgIGFsbG93VGltZSA9IGlzb0RhdGVzW2ldWzJdICE9PSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRhdGVGb3JtYXQgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5faXNWYWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtYXRjaFszXSkge1xuICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGwgPSBpc29UaW1lcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzb1RpbWVzW2ldWzFdLmV4ZWMobWF0Y2hbM10pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBtYXRjaFsyXSBzaG91bGQgYmUgJ1QnIG9yIHNwYWNlXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lRm9ybWF0ID0gKG1hdGNoWzJdIHx8ICcgJykgKyBpc29UaW1lc1tpXVswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aW1lRm9ybWF0ID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLl9pc1ZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWFsbG93VGltZSAmJiB0aW1lRm9ybWF0ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjb25maWcuX2lzVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobWF0Y2hbNF0pIHtcbiAgICAgICAgICAgICAgICBpZiAodHpSZWdleC5leGVjKG1hdGNoWzRdKSkge1xuICAgICAgICAgICAgICAgICAgICB0ekZvcm1hdCA9ICdaJztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25maWcuX2lzVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbmZpZy5fZiA9IGRhdGVGb3JtYXQgKyAodGltZUZvcm1hdCB8fCAnJykgKyAodHpGb3JtYXQgfHwgJycpO1xuICAgICAgICAgICAgY29uZmlnRnJvbVN0cmluZ0FuZEZvcm1hdChjb25maWcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uZmlnLl9pc1ZhbGlkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBleHRyYWN0RnJvbVJGQzI4MjJTdHJpbmdzKFxuICAgICAgICB5ZWFyU3RyLFxuICAgICAgICBtb250aFN0cixcbiAgICAgICAgZGF5U3RyLFxuICAgICAgICBob3VyU3RyLFxuICAgICAgICBtaW51dGVTdHIsXG4gICAgICAgIHNlY29uZFN0clxuICAgICkge1xuICAgICAgICB2YXIgcmVzdWx0ID0gW1xuICAgICAgICAgICAgdW50cnVuY2F0ZVllYXIoeWVhclN0ciksXG4gICAgICAgICAgICBkZWZhdWx0TG9jYWxlTW9udGhzU2hvcnQuaW5kZXhPZihtb250aFN0ciksXG4gICAgICAgICAgICBwYXJzZUludChkYXlTdHIsIDEwKSxcbiAgICAgICAgICAgIHBhcnNlSW50KGhvdXJTdHIsIDEwKSxcbiAgICAgICAgICAgIHBhcnNlSW50KG1pbnV0ZVN0ciwgMTApLFxuICAgICAgICBdO1xuXG4gICAgICAgIGlmIChzZWNvbmRTdHIpIHtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHBhcnNlSW50KHNlY29uZFN0ciwgMTApKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdW50cnVuY2F0ZVllYXIoeWVhclN0cikge1xuICAgICAgICB2YXIgeWVhciA9IHBhcnNlSW50KHllYXJTdHIsIDEwKTtcbiAgICAgICAgaWYgKHllYXIgPD0gNDkpIHtcbiAgICAgICAgICAgIHJldHVybiAyMDAwICsgeWVhcjtcbiAgICAgICAgfSBlbHNlIGlmICh5ZWFyIDw9IDk5OSkge1xuICAgICAgICAgICAgcmV0dXJuIDE5MDAgKyB5ZWFyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB5ZWFyO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHByZXByb2Nlc3NSRkMyODIyKHMpIHtcbiAgICAgICAgLy8gUmVtb3ZlIGNvbW1lbnRzIGFuZCBmb2xkaW5nIHdoaXRlc3BhY2UgYW5kIHJlcGxhY2UgbXVsdGlwbGUtc3BhY2VzIHdpdGggYSBzaW5nbGUgc3BhY2VcbiAgICAgICAgcmV0dXJuIHNcbiAgICAgICAgICAgIC5yZXBsYWNlKC9cXChbXildKlxcKXxbXFxuXFx0XS9nLCAnICcpXG4gICAgICAgICAgICAucmVwbGFjZSgvKFxcc1xccyspL2csICcgJylcbiAgICAgICAgICAgIC5yZXBsYWNlKC9eXFxzXFxzKi8sICcnKVxuICAgICAgICAgICAgLnJlcGxhY2UoL1xcc1xccyokLywgJycpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNoZWNrV2Vla2RheSh3ZWVrZGF5U3RyLCBwYXJzZWRJbnB1dCwgY29uZmlnKSB7XG4gICAgICAgIGlmICh3ZWVrZGF5U3RyKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBSZXBsYWNlIHRoZSB2YW5pbGxhIEpTIERhdGUgb2JqZWN0IHdpdGggYW4gaW5kZXBlbmRlbnQgZGF5LW9mLXdlZWsgY2hlY2suXG4gICAgICAgICAgICB2YXIgd2Vla2RheVByb3ZpZGVkID0gZGVmYXVsdExvY2FsZVdlZWtkYXlzU2hvcnQuaW5kZXhPZih3ZWVrZGF5U3RyKSxcbiAgICAgICAgICAgICAgICB3ZWVrZGF5QWN0dWFsID0gbmV3IERhdGUoXG4gICAgICAgICAgICAgICAgICAgIHBhcnNlZElucHV0WzBdLFxuICAgICAgICAgICAgICAgICAgICBwYXJzZWRJbnB1dFsxXSxcbiAgICAgICAgICAgICAgICAgICAgcGFyc2VkSW5wdXRbMl1cbiAgICAgICAgICAgICAgICApLmdldERheSgpO1xuICAgICAgICAgICAgaWYgKHdlZWtkYXlQcm92aWRlZCAhPT0gd2Vla2RheUFjdHVhbCkge1xuICAgICAgICAgICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLndlZWtkYXlNaXNtYXRjaCA9IHRydWU7XG4gICAgICAgICAgICAgICAgY29uZmlnLl9pc1ZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZU9mZnNldChvYnNPZmZzZXQsIG1pbGl0YXJ5T2Zmc2V0LCBudW1PZmZzZXQpIHtcbiAgICAgICAgaWYgKG9ic09mZnNldCkge1xuICAgICAgICAgICAgcmV0dXJuIG9ic09mZnNldHNbb2JzT2Zmc2V0XTtcbiAgICAgICAgfSBlbHNlIGlmIChtaWxpdGFyeU9mZnNldCkge1xuICAgICAgICAgICAgLy8gdGhlIG9ubHkgYWxsb3dlZCBtaWxpdGFyeSB0eiBpcyBaXG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBobSA9IHBhcnNlSW50KG51bU9mZnNldCwgMTApLFxuICAgICAgICAgICAgICAgIG0gPSBobSAlIDEwMCxcbiAgICAgICAgICAgICAgICBoID0gKGhtIC0gbSkgLyAxMDA7XG4gICAgICAgICAgICByZXR1cm4gaCAqIDYwICsgbTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIGRhdGUgYW5kIHRpbWUgZnJvbSByZWYgMjgyMiBmb3JtYXRcbiAgICBmdW5jdGlvbiBjb25maWdGcm9tUkZDMjgyMihjb25maWcpIHtcbiAgICAgICAgdmFyIG1hdGNoID0gcmZjMjgyMi5leGVjKHByZXByb2Nlc3NSRkMyODIyKGNvbmZpZy5faSkpLFxuICAgICAgICAgICAgcGFyc2VkQXJyYXk7XG4gICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgcGFyc2VkQXJyYXkgPSBleHRyYWN0RnJvbVJGQzI4MjJTdHJpbmdzKFxuICAgICAgICAgICAgICAgIG1hdGNoWzRdLFxuICAgICAgICAgICAgICAgIG1hdGNoWzNdLFxuICAgICAgICAgICAgICAgIG1hdGNoWzJdLFxuICAgICAgICAgICAgICAgIG1hdGNoWzVdLFxuICAgICAgICAgICAgICAgIG1hdGNoWzZdLFxuICAgICAgICAgICAgICAgIG1hdGNoWzddXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKCFjaGVja1dlZWtkYXkobWF0Y2hbMV0sIHBhcnNlZEFycmF5LCBjb25maWcpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25maWcuX2EgPSBwYXJzZWRBcnJheTtcbiAgICAgICAgICAgIGNvbmZpZy5fdHptID0gY2FsY3VsYXRlT2Zmc2V0KG1hdGNoWzhdLCBtYXRjaFs5XSwgbWF0Y2hbMTBdKTtcblxuICAgICAgICAgICAgY29uZmlnLl9kID0gY3JlYXRlVVRDRGF0ZS5hcHBseShudWxsLCBjb25maWcuX2EpO1xuICAgICAgICAgICAgY29uZmlnLl9kLnNldFVUQ01pbnV0ZXMoY29uZmlnLl9kLmdldFVUQ01pbnV0ZXMoKSAtIGNvbmZpZy5fdHptKTtcblxuICAgICAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykucmZjMjgyMiA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25maWcuX2lzVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIGRhdGUgZnJvbSAxKSBBU1AuTkVULCAyKSBJU08sIDMpIFJGQyAyODIyIGZvcm1hdHMsIG9yIDQpIG9wdGlvbmFsIGZhbGxiYWNrIGlmIHBhcnNpbmcgaXNuJ3Qgc3RyaWN0XG4gICAgZnVuY3Rpb24gY29uZmlnRnJvbVN0cmluZyhjb25maWcpIHtcbiAgICAgICAgdmFyIG1hdGNoZWQgPSBhc3BOZXRKc29uUmVnZXguZXhlYyhjb25maWcuX2kpO1xuICAgICAgICBpZiAobWF0Y2hlZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgY29uZmlnLl9kID0gbmV3IERhdGUoK21hdGNoZWRbMV0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uZmlnRnJvbUlTTyhjb25maWcpO1xuICAgICAgICBpZiAoY29uZmlnLl9pc1ZhbGlkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgZGVsZXRlIGNvbmZpZy5faXNWYWxpZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbmZpZ0Zyb21SRkMyODIyKGNvbmZpZyk7XG4gICAgICAgIGlmIChjb25maWcuX2lzVmFsaWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBkZWxldGUgY29uZmlnLl9pc1ZhbGlkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbmZpZy5fc3RyaWN0KSB7XG4gICAgICAgICAgICBjb25maWcuX2lzVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEZpbmFsIGF0dGVtcHQsIHVzZSBJbnB1dCBGYWxsYmFja1xuICAgICAgICAgICAgaG9va3MuY3JlYXRlRnJvbUlucHV0RmFsbGJhY2soY29uZmlnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGhvb2tzLmNyZWF0ZUZyb21JbnB1dEZhbGxiYWNrID0gZGVwcmVjYXRlKFxuICAgICAgICAndmFsdWUgcHJvdmlkZWQgaXMgbm90IGluIGEgcmVjb2duaXplZCBSRkMyODIyIG9yIElTTyBmb3JtYXQuIG1vbWVudCBjb25zdHJ1Y3Rpb24gZmFsbHMgYmFjayB0byBqcyBEYXRlKCksICcgK1xuICAgICAgICAgICAgJ3doaWNoIGlzIG5vdCByZWxpYWJsZSBhY3Jvc3MgYWxsIGJyb3dzZXJzIGFuZCB2ZXJzaW9ucy4gTm9uIFJGQzI4MjIvSVNPIGRhdGUgZm9ybWF0cyBhcmUgJyArXG4gICAgICAgICAgICAnZGlzY291cmFnZWQuIFBsZWFzZSByZWZlciB0byBodHRwOi8vbW9tZW50anMuY29tL2d1aWRlcy8jL3dhcm5pbmdzL2pzLWRhdGUvIGZvciBtb3JlIGluZm8uJyxcbiAgICAgICAgZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgY29uZmlnLl9kID0gbmV3IERhdGUoY29uZmlnLl9pICsgKGNvbmZpZy5fdXNlVVRDID8gJyBVVEMnIDogJycpKTtcbiAgICAgICAgfVxuICAgICk7XG5cbiAgICAvLyBQaWNrIHRoZSBmaXJzdCBkZWZpbmVkIG9mIHR3byBvciB0aHJlZSBhcmd1bWVudHMuXG4gICAgZnVuY3Rpb24gZGVmYXVsdHMoYSwgYiwgYykge1xuICAgICAgICBpZiAoYSAhPSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gYTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYiAhPSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gYjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjdXJyZW50RGF0ZUFycmF5KGNvbmZpZykge1xuICAgICAgICAvLyBob29rcyBpcyBhY3R1YWxseSB0aGUgZXhwb3J0ZWQgbW9tZW50IG9iamVjdFxuICAgICAgICB2YXIgbm93VmFsdWUgPSBuZXcgRGF0ZShob29rcy5ub3coKSk7XG4gICAgICAgIGlmIChjb25maWcuX3VzZVVUQykge1xuICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICBub3dWYWx1ZS5nZXRVVENGdWxsWWVhcigpLFxuICAgICAgICAgICAgICAgIG5vd1ZhbHVlLmdldFVUQ01vbnRoKCksXG4gICAgICAgICAgICAgICAgbm93VmFsdWUuZ2V0VVRDRGF0ZSgpLFxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW25vd1ZhbHVlLmdldEZ1bGxZZWFyKCksIG5vd1ZhbHVlLmdldE1vbnRoKCksIG5vd1ZhbHVlLmdldERhdGUoKV07XG4gICAgfVxuXG4gICAgLy8gY29udmVydCBhbiBhcnJheSB0byBhIGRhdGUuXG4gICAgLy8gdGhlIGFycmF5IHNob3VsZCBtaXJyb3IgdGhlIHBhcmFtZXRlcnMgYmVsb3dcbiAgICAvLyBub3RlOiBhbGwgdmFsdWVzIHBhc3QgdGhlIHllYXIgYXJlIG9wdGlvbmFsIGFuZCB3aWxsIGRlZmF1bHQgdG8gdGhlIGxvd2VzdCBwb3NzaWJsZSB2YWx1ZS5cbiAgICAvLyBbeWVhciwgbW9udGgsIGRheSAsIGhvdXIsIG1pbnV0ZSwgc2Vjb25kLCBtaWxsaXNlY29uZF1cbiAgICBmdW5jdGlvbiBjb25maWdGcm9tQXJyYXkoY29uZmlnKSB7XG4gICAgICAgIHZhciBpLFxuICAgICAgICAgICAgZGF0ZSxcbiAgICAgICAgICAgIGlucHV0ID0gW10sXG4gICAgICAgICAgICBjdXJyZW50RGF0ZSxcbiAgICAgICAgICAgIGV4cGVjdGVkV2Vla2RheSxcbiAgICAgICAgICAgIHllYXJUb1VzZTtcblxuICAgICAgICBpZiAoY29uZmlnLl9kKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjdXJyZW50RGF0ZSA9IGN1cnJlbnREYXRlQXJyYXkoY29uZmlnKTtcblxuICAgICAgICAvL2NvbXB1dGUgZGF5IG9mIHRoZSB5ZWFyIGZyb20gd2Vla3MgYW5kIHdlZWtkYXlzXG4gICAgICAgIGlmIChjb25maWcuX3cgJiYgY29uZmlnLl9hW0RBVEVdID09IG51bGwgJiYgY29uZmlnLl9hW01PTlRIXSA9PSBudWxsKSB7XG4gICAgICAgICAgICBkYXlPZlllYXJGcm9tV2Vla0luZm8oY29uZmlnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vaWYgdGhlIGRheSBvZiB0aGUgeWVhciBpcyBzZXQsIGZpZ3VyZSBvdXQgd2hhdCBpdCBpc1xuICAgICAgICBpZiAoY29uZmlnLl9kYXlPZlllYXIgIT0gbnVsbCkge1xuICAgICAgICAgICAgeWVhclRvVXNlID0gZGVmYXVsdHMoY29uZmlnLl9hW1lFQVJdLCBjdXJyZW50RGF0ZVtZRUFSXSk7XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBjb25maWcuX2RheU9mWWVhciA+IGRheXNJblllYXIoeWVhclRvVXNlKSB8fFxuICAgICAgICAgICAgICAgIGNvbmZpZy5fZGF5T2ZZZWFyID09PSAwXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS5fb3ZlcmZsb3dEYXlPZlllYXIgPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkYXRlID0gY3JlYXRlVVRDRGF0ZSh5ZWFyVG9Vc2UsIDAsIGNvbmZpZy5fZGF5T2ZZZWFyKTtcbiAgICAgICAgICAgIGNvbmZpZy5fYVtNT05USF0gPSBkYXRlLmdldFVUQ01vbnRoKCk7XG4gICAgICAgICAgICBjb25maWcuX2FbREFURV0gPSBkYXRlLmdldFVUQ0RhdGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERlZmF1bHQgdG8gY3VycmVudCBkYXRlLlxuICAgICAgICAvLyAqIGlmIG5vIHllYXIsIG1vbnRoLCBkYXkgb2YgbW9udGggYXJlIGdpdmVuLCBkZWZhdWx0IHRvIHRvZGF5XG4gICAgICAgIC8vICogaWYgZGF5IG9mIG1vbnRoIGlzIGdpdmVuLCBkZWZhdWx0IG1vbnRoIGFuZCB5ZWFyXG4gICAgICAgIC8vICogaWYgbW9udGggaXMgZ2l2ZW4sIGRlZmF1bHQgb25seSB5ZWFyXG4gICAgICAgIC8vICogaWYgeWVhciBpcyBnaXZlbiwgZG9uJ3QgZGVmYXVsdCBhbnl0aGluZ1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMyAmJiBjb25maWcuX2FbaV0gPT0gbnVsbDsgKytpKSB7XG4gICAgICAgICAgICBjb25maWcuX2FbaV0gPSBpbnB1dFtpXSA9IGN1cnJlbnREYXRlW2ldO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gWmVybyBvdXQgd2hhdGV2ZXIgd2FzIG5vdCBkZWZhdWx0ZWQsIGluY2x1ZGluZyB0aW1lXG4gICAgICAgIGZvciAoOyBpIDwgNzsgaSsrKSB7XG4gICAgICAgICAgICBjb25maWcuX2FbaV0gPSBpbnB1dFtpXSA9XG4gICAgICAgICAgICAgICAgY29uZmlnLl9hW2ldID09IG51bGwgPyAoaSA9PT0gMiA/IDEgOiAwKSA6IGNvbmZpZy5fYVtpXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGZvciAyNDowMDowMC4wMDBcbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgY29uZmlnLl9hW0hPVVJdID09PSAyNCAmJlxuICAgICAgICAgICAgY29uZmlnLl9hW01JTlVURV0gPT09IDAgJiZcbiAgICAgICAgICAgIGNvbmZpZy5fYVtTRUNPTkRdID09PSAwICYmXG4gICAgICAgICAgICBjb25maWcuX2FbTUlMTElTRUNPTkRdID09PSAwXG4gICAgICAgICkge1xuICAgICAgICAgICAgY29uZmlnLl9uZXh0RGF5ID0gdHJ1ZTtcbiAgICAgICAgICAgIGNvbmZpZy5fYVtIT1VSXSA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICBjb25maWcuX2QgPSAoY29uZmlnLl91c2VVVEMgPyBjcmVhdGVVVENEYXRlIDogY3JlYXRlRGF0ZSkuYXBwbHkoXG4gICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgaW5wdXRcbiAgICAgICAgKTtcbiAgICAgICAgZXhwZWN0ZWRXZWVrZGF5ID0gY29uZmlnLl91c2VVVENcbiAgICAgICAgICAgID8gY29uZmlnLl9kLmdldFVUQ0RheSgpXG4gICAgICAgICAgICA6IGNvbmZpZy5fZC5nZXREYXkoKTtcblxuICAgICAgICAvLyBBcHBseSB0aW1lem9uZSBvZmZzZXQgZnJvbSBpbnB1dC4gVGhlIGFjdHVhbCB1dGNPZmZzZXQgY2FuIGJlIGNoYW5nZWRcbiAgICAgICAgLy8gd2l0aCBwYXJzZVpvbmUuXG4gICAgICAgIGlmIChjb25maWcuX3R6bSAhPSBudWxsKSB7XG4gICAgICAgICAgICBjb25maWcuX2Quc2V0VVRDTWludXRlcyhjb25maWcuX2QuZ2V0VVRDTWludXRlcygpIC0gY29uZmlnLl90em0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbmZpZy5fbmV4dERheSkge1xuICAgICAgICAgICAgY29uZmlnLl9hW0hPVVJdID0gMjQ7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjaGVjayBmb3IgbWlzbWF0Y2hpbmcgZGF5IG9mIHdlZWtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgY29uZmlnLl93ICYmXG4gICAgICAgICAgICB0eXBlb2YgY29uZmlnLl93LmQgIT09ICd1bmRlZmluZWQnICYmXG4gICAgICAgICAgICBjb25maWcuX3cuZCAhPT0gZXhwZWN0ZWRXZWVrZGF5XG4gICAgICAgICkge1xuICAgICAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykud2Vla2RheU1pc21hdGNoID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRheU9mWWVhckZyb21XZWVrSW5mbyhjb25maWcpIHtcbiAgICAgICAgdmFyIHcsIHdlZWtZZWFyLCB3ZWVrLCB3ZWVrZGF5LCBkb3csIGRveSwgdGVtcCwgd2Vla2RheU92ZXJmbG93LCBjdXJXZWVrO1xuXG4gICAgICAgIHcgPSBjb25maWcuX3c7XG4gICAgICAgIGlmICh3LkdHICE9IG51bGwgfHwgdy5XICE9IG51bGwgfHwgdy5FICE9IG51bGwpIHtcbiAgICAgICAgICAgIGRvdyA9IDE7XG4gICAgICAgICAgICBkb3kgPSA0O1xuXG4gICAgICAgICAgICAvLyBUT0RPOiBXZSBuZWVkIHRvIHRha2UgdGhlIGN1cnJlbnQgaXNvV2Vla1llYXIsIGJ1dCB0aGF0IGRlcGVuZHMgb25cbiAgICAgICAgICAgIC8vIGhvdyB3ZSBpbnRlcnByZXQgbm93IChsb2NhbCwgdXRjLCBmaXhlZCBvZmZzZXQpLiBTbyBjcmVhdGVcbiAgICAgICAgICAgIC8vIGEgbm93IHZlcnNpb24gb2YgY3VycmVudCBjb25maWcgKHRha2UgbG9jYWwvdXRjL29mZnNldCBmbGFncywgYW5kXG4gICAgICAgICAgICAvLyBjcmVhdGUgbm93KS5cbiAgICAgICAgICAgIHdlZWtZZWFyID0gZGVmYXVsdHMoXG4gICAgICAgICAgICAgICAgdy5HRyxcbiAgICAgICAgICAgICAgICBjb25maWcuX2FbWUVBUl0sXG4gICAgICAgICAgICAgICAgd2Vla09mWWVhcihjcmVhdGVMb2NhbCgpLCAxLCA0KS55ZWFyXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgd2VlayA9IGRlZmF1bHRzKHcuVywgMSk7XG4gICAgICAgICAgICB3ZWVrZGF5ID0gZGVmYXVsdHMody5FLCAxKTtcbiAgICAgICAgICAgIGlmICh3ZWVrZGF5IDwgMSB8fCB3ZWVrZGF5ID4gNykge1xuICAgICAgICAgICAgICAgIHdlZWtkYXlPdmVyZmxvdyA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkb3cgPSBjb25maWcuX2xvY2FsZS5fd2Vlay5kb3c7XG4gICAgICAgICAgICBkb3kgPSBjb25maWcuX2xvY2FsZS5fd2Vlay5kb3k7XG5cbiAgICAgICAgICAgIGN1cldlZWsgPSB3ZWVrT2ZZZWFyKGNyZWF0ZUxvY2FsKCksIGRvdywgZG95KTtcblxuICAgICAgICAgICAgd2Vla1llYXIgPSBkZWZhdWx0cyh3LmdnLCBjb25maWcuX2FbWUVBUl0sIGN1cldlZWsueWVhcik7XG5cbiAgICAgICAgICAgIC8vIERlZmF1bHQgdG8gY3VycmVudCB3ZWVrLlxuICAgICAgICAgICAgd2VlayA9IGRlZmF1bHRzKHcudywgY3VyV2Vlay53ZWVrKTtcblxuICAgICAgICAgICAgaWYgKHcuZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgLy8gd2Vla2RheSAtLSBsb3cgZGF5IG51bWJlcnMgYXJlIGNvbnNpZGVyZWQgbmV4dCB3ZWVrXG4gICAgICAgICAgICAgICAgd2Vla2RheSA9IHcuZDtcbiAgICAgICAgICAgICAgICBpZiAod2Vla2RheSA8IDAgfHwgd2Vla2RheSA+IDYpIHtcbiAgICAgICAgICAgICAgICAgICAgd2Vla2RheU92ZXJmbG93ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHcuZSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgLy8gbG9jYWwgd2Vla2RheSAtLSBjb3VudGluZyBzdGFydHMgZnJvbSBiZWdpbm5pbmcgb2Ygd2Vla1xuICAgICAgICAgICAgICAgIHdlZWtkYXkgPSB3LmUgKyBkb3c7XG4gICAgICAgICAgICAgICAgaWYgKHcuZSA8IDAgfHwgdy5lID4gNikge1xuICAgICAgICAgICAgICAgICAgICB3ZWVrZGF5T3ZlcmZsb3cgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gZGVmYXVsdCB0byBiZWdpbm5pbmcgb2Ygd2Vla1xuICAgICAgICAgICAgICAgIHdlZWtkYXkgPSBkb3c7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHdlZWsgPCAxIHx8IHdlZWsgPiB3ZWVrc0luWWVhcih3ZWVrWWVhciwgZG93LCBkb3kpKSB7XG4gICAgICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS5fb3ZlcmZsb3dXZWVrcyA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAod2Vla2RheU92ZXJmbG93ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLl9vdmVyZmxvd1dlZWtkYXkgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGVtcCA9IGRheU9mWWVhckZyb21XZWVrcyh3ZWVrWWVhciwgd2Vlaywgd2Vla2RheSwgZG93LCBkb3kpO1xuICAgICAgICAgICAgY29uZmlnLl9hW1lFQVJdID0gdGVtcC55ZWFyO1xuICAgICAgICAgICAgY29uZmlnLl9kYXlPZlllYXIgPSB0ZW1wLmRheU9mWWVhcjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIGNvbnN0YW50IHRoYXQgcmVmZXJzIHRvIHRoZSBJU08gc3RhbmRhcmRcbiAgICBob29rcy5JU09fODYwMSA9IGZ1bmN0aW9uICgpIHt9O1xuXG4gICAgLy8gY29uc3RhbnQgdGhhdCByZWZlcnMgdG8gdGhlIFJGQyAyODIyIGZvcm1cbiAgICBob29rcy5SRkNfMjgyMiA9IGZ1bmN0aW9uICgpIHt9O1xuXG4gICAgLy8gZGF0ZSBmcm9tIHN0cmluZyBhbmQgZm9ybWF0IHN0cmluZ1xuICAgIGZ1bmN0aW9uIGNvbmZpZ0Zyb21TdHJpbmdBbmRGb3JtYXQoY29uZmlnKSB7XG4gICAgICAgIC8vIFRPRE86IE1vdmUgdGhpcyB0byBhbm90aGVyIHBhcnQgb2YgdGhlIGNyZWF0aW9uIGZsb3cgdG8gcHJldmVudCBjaXJjdWxhciBkZXBzXG4gICAgICAgIGlmIChjb25maWcuX2YgPT09IGhvb2tzLklTT184NjAxKSB7XG4gICAgICAgICAgICBjb25maWdGcm9tSVNPKGNvbmZpZyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbmZpZy5fZiA9PT0gaG9va3MuUkZDXzI4MjIpIHtcbiAgICAgICAgICAgIGNvbmZpZ0Zyb21SRkMyODIyKGNvbmZpZyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uZmlnLl9hID0gW107XG4gICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLmVtcHR5ID0gdHJ1ZTtcblxuICAgICAgICAvLyBUaGlzIGFycmF5IGlzIHVzZWQgdG8gbWFrZSBhIERhdGUsIGVpdGhlciB3aXRoIGBuZXcgRGF0ZWAgb3IgYERhdGUuVVRDYFxuICAgICAgICB2YXIgc3RyaW5nID0gJycgKyBjb25maWcuX2ksXG4gICAgICAgICAgICBpLFxuICAgICAgICAgICAgcGFyc2VkSW5wdXQsXG4gICAgICAgICAgICB0b2tlbnMsXG4gICAgICAgICAgICB0b2tlbixcbiAgICAgICAgICAgIHNraXBwZWQsXG4gICAgICAgICAgICBzdHJpbmdMZW5ndGggPSBzdHJpbmcubGVuZ3RoLFxuICAgICAgICAgICAgdG90YWxQYXJzZWRJbnB1dExlbmd0aCA9IDAsXG4gICAgICAgICAgICBlcmE7XG5cbiAgICAgICAgdG9rZW5zID1cbiAgICAgICAgICAgIGV4cGFuZEZvcm1hdChjb25maWcuX2YsIGNvbmZpZy5fbG9jYWxlKS5tYXRjaChmb3JtYXR0aW5nVG9rZW5zKSB8fCBbXTtcblxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0b2tlbiA9IHRva2Vuc1tpXTtcbiAgICAgICAgICAgIHBhcnNlZElucHV0ID0gKHN0cmluZy5tYXRjaChnZXRQYXJzZVJlZ2V4Rm9yVG9rZW4odG9rZW4sIGNvbmZpZykpIHx8XG4gICAgICAgICAgICAgICAgW10pWzBdO1xuICAgICAgICAgICAgaWYgKHBhcnNlZElucHV0KSB7XG4gICAgICAgICAgICAgICAgc2tpcHBlZCA9IHN0cmluZy5zdWJzdHIoMCwgc3RyaW5nLmluZGV4T2YocGFyc2VkSW5wdXQpKTtcbiAgICAgICAgICAgICAgICBpZiAoc2tpcHBlZC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLnVudXNlZElucHV0LnB1c2goc2tpcHBlZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN0cmluZyA9IHN0cmluZy5zbGljZShcbiAgICAgICAgICAgICAgICAgICAgc3RyaW5nLmluZGV4T2YocGFyc2VkSW5wdXQpICsgcGFyc2VkSW5wdXQubGVuZ3RoXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB0b3RhbFBhcnNlZElucHV0TGVuZ3RoICs9IHBhcnNlZElucHV0Lmxlbmd0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGRvbid0IHBhcnNlIGlmIGl0J3Mgbm90IGEga25vd24gdG9rZW5cbiAgICAgICAgICAgIGlmIChmb3JtYXRUb2tlbkZ1bmN0aW9uc1t0b2tlbl0pIHtcbiAgICAgICAgICAgICAgICBpZiAocGFyc2VkSW5wdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykuZW1wdHkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS51bnVzZWRUb2tlbnMucHVzaCh0b2tlbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGFkZFRpbWVUb0FycmF5RnJvbVRva2VuKHRva2VuLCBwYXJzZWRJbnB1dCwgY29uZmlnKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29uZmlnLl9zdHJpY3QgJiYgIXBhcnNlZElucHV0KSB7XG4gICAgICAgICAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykudW51c2VkVG9rZW5zLnB1c2godG9rZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gYWRkIHJlbWFpbmluZyB1bnBhcnNlZCBpbnB1dCBsZW5ndGggdG8gdGhlIHN0cmluZ1xuICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS5jaGFyc0xlZnRPdmVyID1cbiAgICAgICAgICAgIHN0cmluZ0xlbmd0aCAtIHRvdGFsUGFyc2VkSW5wdXRMZW5ndGg7XG4gICAgICAgIGlmIChzdHJpbmcubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykudW51c2VkSW5wdXQucHVzaChzdHJpbmcpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY2xlYXIgXzEyaCBmbGFnIGlmIGhvdXIgaXMgPD0gMTJcbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgY29uZmlnLl9hW0hPVVJdIDw9IDEyICYmXG4gICAgICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS5iaWdIb3VyID09PSB0cnVlICYmXG4gICAgICAgICAgICBjb25maWcuX2FbSE9VUl0gPiAwXG4gICAgICAgICkge1xuICAgICAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykuYmlnSG91ciA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLnBhcnNlZERhdGVQYXJ0cyA9IGNvbmZpZy5fYS5zbGljZSgwKTtcbiAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykubWVyaWRpZW0gPSBjb25maWcuX21lcmlkaWVtO1xuICAgICAgICAvLyBoYW5kbGUgbWVyaWRpZW1cbiAgICAgICAgY29uZmlnLl9hW0hPVVJdID0gbWVyaWRpZW1GaXhXcmFwKFxuICAgICAgICAgICAgY29uZmlnLl9sb2NhbGUsXG4gICAgICAgICAgICBjb25maWcuX2FbSE9VUl0sXG4gICAgICAgICAgICBjb25maWcuX21lcmlkaWVtXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gaGFuZGxlIGVyYVxuICAgICAgICBlcmEgPSBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS5lcmE7XG4gICAgICAgIGlmIChlcmEgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbmZpZy5fYVtZRUFSXSA9IGNvbmZpZy5fbG9jYWxlLmVyYXNDb252ZXJ0WWVhcihlcmEsIGNvbmZpZy5fYVtZRUFSXSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25maWdGcm9tQXJyYXkoY29uZmlnKTtcbiAgICAgICAgY2hlY2tPdmVyZmxvdyhjb25maWcpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1lcmlkaWVtRml4V3JhcChsb2NhbGUsIGhvdXIsIG1lcmlkaWVtKSB7XG4gICAgICAgIHZhciBpc1BtO1xuXG4gICAgICAgIGlmIChtZXJpZGllbSA9PSBudWxsKSB7XG4gICAgICAgICAgICAvLyBub3RoaW5nIHRvIGRvXG4gICAgICAgICAgICByZXR1cm4gaG91cjtcbiAgICAgICAgfVxuICAgICAgICBpZiAobG9jYWxlLm1lcmlkaWVtSG91ciAhPSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gbG9jYWxlLm1lcmlkaWVtSG91cihob3VyLCBtZXJpZGllbSk7XG4gICAgICAgIH0gZWxzZSBpZiAobG9jYWxlLmlzUE0gIT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gRmFsbGJhY2tcbiAgICAgICAgICAgIGlzUG0gPSBsb2NhbGUuaXNQTShtZXJpZGllbSk7XG4gICAgICAgICAgICBpZiAoaXNQbSAmJiBob3VyIDwgMTIpIHtcbiAgICAgICAgICAgICAgICBob3VyICs9IDEyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFpc1BtICYmIGhvdXIgPT09IDEyKSB7XG4gICAgICAgICAgICAgICAgaG91ciA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaG91cjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIHRoaXMgaXMgbm90IHN1cHBvc2VkIHRvIGhhcHBlblxuICAgICAgICAgICAgcmV0dXJuIGhvdXI7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBkYXRlIGZyb20gc3RyaW5nIGFuZCBhcnJheSBvZiBmb3JtYXQgc3RyaW5nc1xuICAgIGZ1bmN0aW9uIGNvbmZpZ0Zyb21TdHJpbmdBbmRBcnJheShjb25maWcpIHtcbiAgICAgICAgdmFyIHRlbXBDb25maWcsXG4gICAgICAgICAgICBiZXN0TW9tZW50LFxuICAgICAgICAgICAgc2NvcmVUb0JlYXQsXG4gICAgICAgICAgICBpLFxuICAgICAgICAgICAgY3VycmVudFNjb3JlLFxuICAgICAgICAgICAgdmFsaWRGb3JtYXRGb3VuZCxcbiAgICAgICAgICAgIGJlc3RGb3JtYXRJc1ZhbGlkID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKGNvbmZpZy5fZi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLmludmFsaWRGb3JtYXQgPSB0cnVlO1xuICAgICAgICAgICAgY29uZmlnLl9kID0gbmV3IERhdGUoTmFOKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb25maWcuX2YubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGN1cnJlbnRTY29yZSA9IDA7XG4gICAgICAgICAgICB2YWxpZEZvcm1hdEZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgICB0ZW1wQ29uZmlnID0gY29weUNvbmZpZyh7fSwgY29uZmlnKTtcbiAgICAgICAgICAgIGlmIChjb25maWcuX3VzZVVUQyAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGVtcENvbmZpZy5fdXNlVVRDID0gY29uZmlnLl91c2VVVEM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0ZW1wQ29uZmlnLl9mID0gY29uZmlnLl9mW2ldO1xuICAgICAgICAgICAgY29uZmlnRnJvbVN0cmluZ0FuZEZvcm1hdCh0ZW1wQ29uZmlnKTtcblxuICAgICAgICAgICAgaWYgKGlzVmFsaWQodGVtcENvbmZpZykpIHtcbiAgICAgICAgICAgICAgICB2YWxpZEZvcm1hdEZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgYW55IGlucHV0IHRoYXQgd2FzIG5vdCBwYXJzZWQgYWRkIGEgcGVuYWx0eSBmb3IgdGhhdCBmb3JtYXRcbiAgICAgICAgICAgIGN1cnJlbnRTY29yZSArPSBnZXRQYXJzaW5nRmxhZ3ModGVtcENvbmZpZykuY2hhcnNMZWZ0T3ZlcjtcblxuICAgICAgICAgICAgLy9vciB0b2tlbnNcbiAgICAgICAgICAgIGN1cnJlbnRTY29yZSArPSBnZXRQYXJzaW5nRmxhZ3ModGVtcENvbmZpZykudW51c2VkVG9rZW5zLmxlbmd0aCAqIDEwO1xuXG4gICAgICAgICAgICBnZXRQYXJzaW5nRmxhZ3ModGVtcENvbmZpZykuc2NvcmUgPSBjdXJyZW50U2NvcmU7XG5cbiAgICAgICAgICAgIGlmICghYmVzdEZvcm1hdElzVmFsaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgIHNjb3JlVG9CZWF0ID09IG51bGwgfHxcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFNjb3JlIDwgc2NvcmVUb0JlYXQgfHxcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRGb3JtYXRGb3VuZFxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICBzY29yZVRvQmVhdCA9IGN1cnJlbnRTY29yZTtcbiAgICAgICAgICAgICAgICAgICAgYmVzdE1vbWVudCA9IHRlbXBDb25maWc7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWxpZEZvcm1hdEZvdW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiZXN0Rm9ybWF0SXNWYWxpZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50U2NvcmUgPCBzY29yZVRvQmVhdCkge1xuICAgICAgICAgICAgICAgICAgICBzY29yZVRvQmVhdCA9IGN1cnJlbnRTY29yZTtcbiAgICAgICAgICAgICAgICAgICAgYmVzdE1vbWVudCA9IHRlbXBDb25maWc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZXh0ZW5kKGNvbmZpZywgYmVzdE1vbWVudCB8fCB0ZW1wQ29uZmlnKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjb25maWdGcm9tT2JqZWN0KGNvbmZpZykge1xuICAgICAgICBpZiAoY29uZmlnLl9kKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaSA9IG5vcm1hbGl6ZU9iamVjdFVuaXRzKGNvbmZpZy5faSksXG4gICAgICAgICAgICBkYXlPckRhdGUgPSBpLmRheSA9PT0gdW5kZWZpbmVkID8gaS5kYXRlIDogaS5kYXk7XG4gICAgICAgIGNvbmZpZy5fYSA9IG1hcChcbiAgICAgICAgICAgIFtpLnllYXIsIGkubW9udGgsIGRheU9yRGF0ZSwgaS5ob3VyLCBpLm1pbnV0ZSwgaS5zZWNvbmQsIGkubWlsbGlzZWNvbmRdLFxuICAgICAgICAgICAgZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICAgIHJldHVybiBvYmogJiYgcGFyc2VJbnQob2JqLCAxMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgY29uZmlnRnJvbUFycmF5KGNvbmZpZyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlRnJvbUNvbmZpZyhjb25maWcpIHtcbiAgICAgICAgdmFyIHJlcyA9IG5ldyBNb21lbnQoY2hlY2tPdmVyZmxvdyhwcmVwYXJlQ29uZmlnKGNvbmZpZykpKTtcbiAgICAgICAgaWYgKHJlcy5fbmV4dERheSkge1xuICAgICAgICAgICAgLy8gQWRkaW5nIGlzIHNtYXJ0IGVub3VnaCBhcm91bmQgRFNUXG4gICAgICAgICAgICByZXMuYWRkKDEsICdkJyk7XG4gICAgICAgICAgICByZXMuX25leHREYXkgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHByZXBhcmVDb25maWcoY29uZmlnKSB7XG4gICAgICAgIHZhciBpbnB1dCA9IGNvbmZpZy5faSxcbiAgICAgICAgICAgIGZvcm1hdCA9IGNvbmZpZy5fZjtcblxuICAgICAgICBjb25maWcuX2xvY2FsZSA9IGNvbmZpZy5fbG9jYWxlIHx8IGdldExvY2FsZShjb25maWcuX2wpO1xuXG4gICAgICAgIGlmIChpbnB1dCA9PT0gbnVsbCB8fCAoZm9ybWF0ID09PSB1bmRlZmluZWQgJiYgaW5wdXQgPT09ICcnKSkge1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUludmFsaWQoeyBudWxsSW5wdXQ6IHRydWUgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZW9mIGlucHV0ID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgY29uZmlnLl9pID0gaW5wdXQgPSBjb25maWcuX2xvY2FsZS5wcmVwYXJzZShpbnB1dCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaXNNb21lbnQoaW5wdXQpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IE1vbWVudChjaGVja092ZXJmbG93KGlucHV0KSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNEYXRlKGlucHV0KSkge1xuICAgICAgICAgICAgY29uZmlnLl9kID0gaW5wdXQ7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNBcnJheShmb3JtYXQpKSB7XG4gICAgICAgICAgICBjb25maWdGcm9tU3RyaW5nQW5kQXJyYXkoY29uZmlnKTtcbiAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQpIHtcbiAgICAgICAgICAgIGNvbmZpZ0Zyb21TdHJpbmdBbmRGb3JtYXQoY29uZmlnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbmZpZ0Zyb21JbnB1dChjb25maWcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFpc1ZhbGlkKGNvbmZpZykpIHtcbiAgICAgICAgICAgIGNvbmZpZy5fZCA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNvbmZpZ0Zyb21JbnB1dChjb25maWcpIHtcbiAgICAgICAgdmFyIGlucHV0ID0gY29uZmlnLl9pO1xuICAgICAgICBpZiAoaXNVbmRlZmluZWQoaW5wdXQpKSB7XG4gICAgICAgICAgICBjb25maWcuX2QgPSBuZXcgRGF0ZShob29rcy5ub3coKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNEYXRlKGlucHV0KSkge1xuICAgICAgICAgICAgY29uZmlnLl9kID0gbmV3IERhdGUoaW5wdXQudmFsdWVPZigpKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaW5wdXQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBjb25maWdGcm9tU3RyaW5nKGNvbmZpZyk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNBcnJheShpbnB1dCkpIHtcbiAgICAgICAgICAgIGNvbmZpZy5fYSA9IG1hcChpbnB1dC5zbGljZSgwKSwgZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUludChvYmosIDEwKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uZmlnRnJvbUFycmF5KGNvbmZpZyk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNPYmplY3QoaW5wdXQpKSB7XG4gICAgICAgICAgICBjb25maWdGcm9tT2JqZWN0KGNvbmZpZyk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNOdW1iZXIoaW5wdXQpKSB7XG4gICAgICAgICAgICAvLyBmcm9tIG1pbGxpc2Vjb25kc1xuICAgICAgICAgICAgY29uZmlnLl9kID0gbmV3IERhdGUoaW5wdXQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaG9va3MuY3JlYXRlRnJvbUlucHV0RmFsbGJhY2soY29uZmlnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZUxvY2FsT3JVVEMoaW5wdXQsIGZvcm1hdCwgbG9jYWxlLCBzdHJpY3QsIGlzVVRDKSB7XG4gICAgICAgIHZhciBjID0ge307XG5cbiAgICAgICAgaWYgKGZvcm1hdCA9PT0gdHJ1ZSB8fCBmb3JtYXQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBzdHJpY3QgPSBmb3JtYXQ7XG4gICAgICAgICAgICBmb3JtYXQgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobG9jYWxlID09PSB0cnVlIHx8IGxvY2FsZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHN0cmljdCA9IGxvY2FsZTtcbiAgICAgICAgICAgIGxvY2FsZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIChpc09iamVjdChpbnB1dCkgJiYgaXNPYmplY3RFbXB0eShpbnB1dCkpIHx8XG4gICAgICAgICAgICAoaXNBcnJheShpbnB1dCkgJiYgaW5wdXQubGVuZ3RoID09PSAwKVxuICAgICAgICApIHtcbiAgICAgICAgICAgIGlucHV0ID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIC8vIG9iamVjdCBjb25zdHJ1Y3Rpb24gbXVzdCBiZSBkb25lIHRoaXMgd2F5LlxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vbW9tZW50L21vbWVudC9pc3N1ZXMvMTQyM1xuICAgICAgICBjLl9pc0FNb21lbnRPYmplY3QgPSB0cnVlO1xuICAgICAgICBjLl91c2VVVEMgPSBjLl9pc1VUQyA9IGlzVVRDO1xuICAgICAgICBjLl9sID0gbG9jYWxlO1xuICAgICAgICBjLl9pID0gaW5wdXQ7XG4gICAgICAgIGMuX2YgPSBmb3JtYXQ7XG4gICAgICAgIGMuX3N0cmljdCA9IHN0cmljdDtcblxuICAgICAgICByZXR1cm4gY3JlYXRlRnJvbUNvbmZpZyhjKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVMb2NhbChpbnB1dCwgZm9ybWF0LCBsb2NhbGUsIHN0cmljdCkge1xuICAgICAgICByZXR1cm4gY3JlYXRlTG9jYWxPclVUQyhpbnB1dCwgZm9ybWF0LCBsb2NhbGUsIHN0cmljdCwgZmFsc2UpO1xuICAgIH1cblxuICAgIHZhciBwcm90b3R5cGVNaW4gPSBkZXByZWNhdGUoXG4gICAgICAgICAgICAnbW9tZW50KCkubWluIGlzIGRlcHJlY2F0ZWQsIHVzZSBtb21lbnQubWF4IGluc3RlYWQuIGh0dHA6Ly9tb21lbnRqcy5jb20vZ3VpZGVzLyMvd2FybmluZ3MvbWluLW1heC8nLFxuICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBvdGhlciA9IGNyZWF0ZUxvY2FsLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNWYWxpZCgpICYmIG90aGVyLmlzVmFsaWQoKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3RoZXIgPCB0aGlzID8gdGhpcyA6IG90aGVyO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGVJbnZhbGlkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICApLFxuICAgICAgICBwcm90b3R5cGVNYXggPSBkZXByZWNhdGUoXG4gICAgICAgICAgICAnbW9tZW50KCkubWF4IGlzIGRlcHJlY2F0ZWQsIHVzZSBtb21lbnQubWluIGluc3RlYWQuIGh0dHA6Ly9tb21lbnRqcy5jb20vZ3VpZGVzLyMvd2FybmluZ3MvbWluLW1heC8nLFxuICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBvdGhlciA9IGNyZWF0ZUxvY2FsLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNWYWxpZCgpICYmIG90aGVyLmlzVmFsaWQoKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3RoZXIgPiB0aGlzID8gdGhpcyA6IG90aGVyO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGVJbnZhbGlkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgLy8gUGljayBhIG1vbWVudCBtIGZyb20gbW9tZW50cyBzbyB0aGF0IG1bZm5dKG90aGVyKSBpcyB0cnVlIGZvciBhbGxcbiAgICAvLyBvdGhlci4gVGhpcyByZWxpZXMgb24gdGhlIGZ1bmN0aW9uIGZuIHRvIGJlIHRyYW5zaXRpdmUuXG4gICAgLy9cbiAgICAvLyBtb21lbnRzIHNob3VsZCBlaXRoZXIgYmUgYW4gYXJyYXkgb2YgbW9tZW50IG9iamVjdHMgb3IgYW4gYXJyYXksIHdob3NlXG4gICAgLy8gZmlyc3QgZWxlbWVudCBpcyBhbiBhcnJheSBvZiBtb21lbnQgb2JqZWN0cy5cbiAgICBmdW5jdGlvbiBwaWNrQnkoZm4sIG1vbWVudHMpIHtcbiAgICAgICAgdmFyIHJlcywgaTtcbiAgICAgICAgaWYgKG1vbWVudHMubGVuZ3RoID09PSAxICYmIGlzQXJyYXkobW9tZW50c1swXSkpIHtcbiAgICAgICAgICAgIG1vbWVudHMgPSBtb21lbnRzWzBdO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbW9tZW50cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVMb2NhbCgpO1xuICAgICAgICB9XG4gICAgICAgIHJlcyA9IG1vbWVudHNbMF07XG4gICAgICAgIGZvciAoaSA9IDE7IGkgPCBtb21lbnRzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBpZiAoIW1vbWVudHNbaV0uaXNWYWxpZCgpIHx8IG1vbWVudHNbaV1bZm5dKHJlcykpIHtcbiAgICAgICAgICAgICAgICByZXMgPSBtb21lbnRzW2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgfVxuXG4gICAgLy8gVE9ETzogVXNlIFtdLnNvcnQgaW5zdGVhZD9cbiAgICBmdW5jdGlvbiBtaW4oKSB7XG4gICAgICAgIHZhciBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDApO1xuXG4gICAgICAgIHJldHVybiBwaWNrQnkoJ2lzQmVmb3JlJywgYXJncyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWF4KCkge1xuICAgICAgICB2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTtcblxuICAgICAgICByZXR1cm4gcGlja0J5KCdpc0FmdGVyJywgYXJncyk7XG4gICAgfVxuXG4gICAgdmFyIG5vdyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIERhdGUubm93ID8gRGF0ZS5ub3coKSA6ICtuZXcgRGF0ZSgpO1xuICAgIH07XG5cbiAgICB2YXIgb3JkZXJpbmcgPSBbXG4gICAgICAgICd5ZWFyJyxcbiAgICAgICAgJ3F1YXJ0ZXInLFxuICAgICAgICAnbW9udGgnLFxuICAgICAgICAnd2VlaycsXG4gICAgICAgICdkYXknLFxuICAgICAgICAnaG91cicsXG4gICAgICAgICdtaW51dGUnLFxuICAgICAgICAnc2Vjb25kJyxcbiAgICAgICAgJ21pbGxpc2Vjb25kJyxcbiAgICBdO1xuXG4gICAgZnVuY3Rpb24gaXNEdXJhdGlvblZhbGlkKG0pIHtcbiAgICAgICAgdmFyIGtleSxcbiAgICAgICAgICAgIHVuaXRIYXNEZWNpbWFsID0gZmFsc2UsXG4gICAgICAgICAgICBpO1xuICAgICAgICBmb3IgKGtleSBpbiBtKSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgaGFzT3duUHJvcChtLCBrZXkpICYmXG4gICAgICAgICAgICAgICAgIShcbiAgICAgICAgICAgICAgICAgICAgaW5kZXhPZi5jYWxsKG9yZGVyaW5nLCBrZXkpICE9PSAtMSAmJlxuICAgICAgICAgICAgICAgICAgICAobVtrZXldID09IG51bGwgfHwgIWlzTmFOKG1ba2V5XSkpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChpID0gMDsgaSA8IG9yZGVyaW5nLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBpZiAobVtvcmRlcmluZ1tpXV0pIHtcbiAgICAgICAgICAgICAgICBpZiAodW5pdEhhc0RlY2ltYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBvbmx5IGFsbG93IG5vbi1pbnRlZ2VycyBmb3Igc21hbGxlc3QgdW5pdFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocGFyc2VGbG9hdChtW29yZGVyaW5nW2ldXSkgIT09IHRvSW50KG1bb3JkZXJpbmdbaV1dKSkge1xuICAgICAgICAgICAgICAgICAgICB1bml0SGFzRGVjaW1hbCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNWYWxpZCQxKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faXNWYWxpZDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVJbnZhbGlkJDEoKSB7XG4gICAgICAgIHJldHVybiBjcmVhdGVEdXJhdGlvbihOYU4pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIER1cmF0aW9uKGR1cmF0aW9uKSB7XG4gICAgICAgIHZhciBub3JtYWxpemVkSW5wdXQgPSBub3JtYWxpemVPYmplY3RVbml0cyhkdXJhdGlvbiksXG4gICAgICAgICAgICB5ZWFycyA9IG5vcm1hbGl6ZWRJbnB1dC55ZWFyIHx8IDAsXG4gICAgICAgICAgICBxdWFydGVycyA9IG5vcm1hbGl6ZWRJbnB1dC5xdWFydGVyIHx8IDAsXG4gICAgICAgICAgICBtb250aHMgPSBub3JtYWxpemVkSW5wdXQubW9udGggfHwgMCxcbiAgICAgICAgICAgIHdlZWtzID0gbm9ybWFsaXplZElucHV0LndlZWsgfHwgbm9ybWFsaXplZElucHV0Lmlzb1dlZWsgfHwgMCxcbiAgICAgICAgICAgIGRheXMgPSBub3JtYWxpemVkSW5wdXQuZGF5IHx8IDAsXG4gICAgICAgICAgICBob3VycyA9IG5vcm1hbGl6ZWRJbnB1dC5ob3VyIHx8IDAsXG4gICAgICAgICAgICBtaW51dGVzID0gbm9ybWFsaXplZElucHV0Lm1pbnV0ZSB8fCAwLFxuICAgICAgICAgICAgc2Vjb25kcyA9IG5vcm1hbGl6ZWRJbnB1dC5zZWNvbmQgfHwgMCxcbiAgICAgICAgICAgIG1pbGxpc2Vjb25kcyA9IG5vcm1hbGl6ZWRJbnB1dC5taWxsaXNlY29uZCB8fCAwO1xuXG4gICAgICAgIHRoaXMuX2lzVmFsaWQgPSBpc0R1cmF0aW9uVmFsaWQobm9ybWFsaXplZElucHV0KTtcblxuICAgICAgICAvLyByZXByZXNlbnRhdGlvbiBmb3IgZGF0ZUFkZFJlbW92ZVxuICAgICAgICB0aGlzLl9taWxsaXNlY29uZHMgPVxuICAgICAgICAgICAgK21pbGxpc2Vjb25kcyArXG4gICAgICAgICAgICBzZWNvbmRzICogMWUzICsgLy8gMTAwMFxuICAgICAgICAgICAgbWludXRlcyAqIDZlNCArIC8vIDEwMDAgKiA2MFxuICAgICAgICAgICAgaG91cnMgKiAxMDAwICogNjAgKiA2MDsgLy91c2luZyAxMDAwICogNjAgKiA2MCBpbnN0ZWFkIG9mIDM2ZTUgdG8gYXZvaWQgZmxvYXRpbmcgcG9pbnQgcm91bmRpbmcgZXJyb3JzIGh0dHBzOi8vZ2l0aHViLmNvbS9tb21lbnQvbW9tZW50L2lzc3Vlcy8yOTc4XG4gICAgICAgIC8vIEJlY2F1c2Ugb2YgZGF0ZUFkZFJlbW92ZSB0cmVhdHMgMjQgaG91cnMgYXMgZGlmZmVyZW50IGZyb20gYVxuICAgICAgICAvLyBkYXkgd2hlbiB3b3JraW5nIGFyb3VuZCBEU1QsIHdlIG5lZWQgdG8gc3RvcmUgdGhlbSBzZXBhcmF0ZWx5XG4gICAgICAgIHRoaXMuX2RheXMgPSArZGF5cyArIHdlZWtzICogNztcbiAgICAgICAgLy8gSXQgaXMgaW1wb3NzaWJsZSB0byB0cmFuc2xhdGUgbW9udGhzIGludG8gZGF5cyB3aXRob3V0IGtub3dpbmdcbiAgICAgICAgLy8gd2hpY2ggbW9udGhzIHlvdSBhcmUgYXJlIHRhbGtpbmcgYWJvdXQsIHNvIHdlIGhhdmUgdG8gc3RvcmVcbiAgICAgICAgLy8gaXQgc2VwYXJhdGVseS5cbiAgICAgICAgdGhpcy5fbW9udGhzID0gK21vbnRocyArIHF1YXJ0ZXJzICogMyArIHllYXJzICogMTI7XG5cbiAgICAgICAgdGhpcy5fZGF0YSA9IHt9O1xuXG4gICAgICAgIHRoaXMuX2xvY2FsZSA9IGdldExvY2FsZSgpO1xuXG4gICAgICAgIHRoaXMuX2J1YmJsZSgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzRHVyYXRpb24ob2JqKSB7XG4gICAgICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBEdXJhdGlvbjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhYnNSb3VuZChudW1iZXIpIHtcbiAgICAgICAgaWYgKG51bWJlciA8IDApIHtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKC0xICogbnVtYmVyKSAqIC0xO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQobnVtYmVyKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIGNvbXBhcmUgdHdvIGFycmF5cywgcmV0dXJuIHRoZSBudW1iZXIgb2YgZGlmZmVyZW5jZXNcbiAgICBmdW5jdGlvbiBjb21wYXJlQXJyYXlzKGFycmF5MSwgYXJyYXkyLCBkb250Q29udmVydCkge1xuICAgICAgICB2YXIgbGVuID0gTWF0aC5taW4oYXJyYXkxLmxlbmd0aCwgYXJyYXkyLmxlbmd0aCksXG4gICAgICAgICAgICBsZW5ndGhEaWZmID0gTWF0aC5hYnMoYXJyYXkxLmxlbmd0aCAtIGFycmF5Mi5sZW5ndGgpLFxuICAgICAgICAgICAgZGlmZnMgPSAwLFxuICAgICAgICAgICAgaTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgKGRvbnRDb252ZXJ0ICYmIGFycmF5MVtpXSAhPT0gYXJyYXkyW2ldKSB8fFxuICAgICAgICAgICAgICAgICghZG9udENvbnZlcnQgJiYgdG9JbnQoYXJyYXkxW2ldKSAhPT0gdG9JbnQoYXJyYXkyW2ldKSlcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGRpZmZzKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRpZmZzICsgbGVuZ3RoRGlmZjtcbiAgICB9XG5cbiAgICAvLyBGT1JNQVRUSU5HXG5cbiAgICBmdW5jdGlvbiBvZmZzZXQodG9rZW4sIHNlcGFyYXRvcikge1xuICAgICAgICBhZGRGb3JtYXRUb2tlbih0b2tlbiwgMCwgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG9mZnNldCA9IHRoaXMudXRjT2Zmc2V0KCksXG4gICAgICAgICAgICAgICAgc2lnbiA9ICcrJztcbiAgICAgICAgICAgIGlmIChvZmZzZXQgPCAwKSB7XG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gLW9mZnNldDtcbiAgICAgICAgICAgICAgICBzaWduID0gJy0nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICBzaWduICtcbiAgICAgICAgICAgICAgICB6ZXJvRmlsbCh+fihvZmZzZXQgLyA2MCksIDIpICtcbiAgICAgICAgICAgICAgICBzZXBhcmF0b3IgK1xuICAgICAgICAgICAgICAgIHplcm9GaWxsKH5+b2Zmc2V0ICUgNjAsIDIpXG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBvZmZzZXQoJ1onLCAnOicpO1xuICAgIG9mZnNldCgnWlonLCAnJyk7XG5cbiAgICAvLyBQQVJTSU5HXG5cbiAgICBhZGRSZWdleFRva2VuKCdaJywgbWF0Y2hTaG9ydE9mZnNldCk7XG4gICAgYWRkUmVnZXhUb2tlbignWlonLCBtYXRjaFNob3J0T2Zmc2V0KTtcbiAgICBhZGRQYXJzZVRva2VuKFsnWicsICdaWiddLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5LCBjb25maWcpIHtcbiAgICAgICAgY29uZmlnLl91c2VVVEMgPSB0cnVlO1xuICAgICAgICBjb25maWcuX3R6bSA9IG9mZnNldEZyb21TdHJpbmcobWF0Y2hTaG9ydE9mZnNldCwgaW5wdXQpO1xuICAgIH0pO1xuXG4gICAgLy8gSEVMUEVSU1xuXG4gICAgLy8gdGltZXpvbmUgY2h1bmtlclxuICAgIC8vICcrMTA6MDAnID4gWycxMCcsICAnMDAnXVxuICAgIC8vICctMTUzMCcgID4gWyctMTUnLCAnMzAnXVxuICAgIHZhciBjaHVua09mZnNldCA9IC8oW1xcK1xcLV18XFxkXFxkKS9naTtcblxuICAgIGZ1bmN0aW9uIG9mZnNldEZyb21TdHJpbmcobWF0Y2hlciwgc3RyaW5nKSB7XG4gICAgICAgIHZhciBtYXRjaGVzID0gKHN0cmluZyB8fCAnJykubWF0Y2gobWF0Y2hlciksXG4gICAgICAgICAgICBjaHVuayxcbiAgICAgICAgICAgIHBhcnRzLFxuICAgICAgICAgICAgbWludXRlcztcblxuICAgICAgICBpZiAobWF0Y2hlcyA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBjaHVuayA9IG1hdGNoZXNbbWF0Y2hlcy5sZW5ndGggLSAxXSB8fCBbXTtcbiAgICAgICAgcGFydHMgPSAoY2h1bmsgKyAnJykubWF0Y2goY2h1bmtPZmZzZXQpIHx8IFsnLScsIDAsIDBdO1xuICAgICAgICBtaW51dGVzID0gKyhwYXJ0c1sxXSAqIDYwKSArIHRvSW50KHBhcnRzWzJdKTtcblxuICAgICAgICByZXR1cm4gbWludXRlcyA9PT0gMCA/IDAgOiBwYXJ0c1swXSA9PT0gJysnID8gbWludXRlcyA6IC1taW51dGVzO1xuICAgIH1cblxuICAgIC8vIFJldHVybiBhIG1vbWVudCBmcm9tIGlucHV0LCB0aGF0IGlzIGxvY2FsL3V0Yy96b25lIGVxdWl2YWxlbnQgdG8gbW9kZWwuXG4gICAgZnVuY3Rpb24gY2xvbmVXaXRoT2Zmc2V0KGlucHV0LCBtb2RlbCkge1xuICAgICAgICB2YXIgcmVzLCBkaWZmO1xuICAgICAgICBpZiAobW9kZWwuX2lzVVRDKSB7XG4gICAgICAgICAgICByZXMgPSBtb2RlbC5jbG9uZSgpO1xuICAgICAgICAgICAgZGlmZiA9XG4gICAgICAgICAgICAgICAgKGlzTW9tZW50KGlucHV0KSB8fCBpc0RhdGUoaW5wdXQpXG4gICAgICAgICAgICAgICAgICAgID8gaW5wdXQudmFsdWVPZigpXG4gICAgICAgICAgICAgICAgICAgIDogY3JlYXRlTG9jYWwoaW5wdXQpLnZhbHVlT2YoKSkgLSByZXMudmFsdWVPZigpO1xuICAgICAgICAgICAgLy8gVXNlIGxvdy1sZXZlbCBhcGksIGJlY2F1c2UgdGhpcyBmbiBpcyBsb3ctbGV2ZWwgYXBpLlxuICAgICAgICAgICAgcmVzLl9kLnNldFRpbWUocmVzLl9kLnZhbHVlT2YoKSArIGRpZmYpO1xuICAgICAgICAgICAgaG9va3MudXBkYXRlT2Zmc2V0KHJlcywgZmFsc2UpO1xuICAgICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVMb2NhbChpbnB1dCkubG9jYWwoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldERhdGVPZmZzZXQobSkge1xuICAgICAgICAvLyBPbiBGaXJlZm94LjI0IERhdGUjZ2V0VGltZXpvbmVPZmZzZXQgcmV0dXJucyBhIGZsb2F0aW5nIHBvaW50LlxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vbW9tZW50L21vbWVudC9wdWxsLzE4NzFcbiAgICAgICAgcmV0dXJuIC1NYXRoLnJvdW5kKG0uX2QuZ2V0VGltZXpvbmVPZmZzZXQoKSk7XG4gICAgfVxuXG4gICAgLy8gSE9PS1NcblxuICAgIC8vIFRoaXMgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgd2hlbmV2ZXIgYSBtb21lbnQgaXMgbXV0YXRlZC5cbiAgICAvLyBJdCBpcyBpbnRlbmRlZCB0byBrZWVwIHRoZSBvZmZzZXQgaW4gc3luYyB3aXRoIHRoZSB0aW1lem9uZS5cbiAgICBob29rcy51cGRhdGVPZmZzZXQgPSBmdW5jdGlvbiAoKSB7fTtcblxuICAgIC8vIE1PTUVOVFNcblxuICAgIC8vIGtlZXBMb2NhbFRpbWUgPSB0cnVlIG1lYW5zIG9ubHkgY2hhbmdlIHRoZSB0aW1lem9uZSwgd2l0aG91dFxuICAgIC8vIGFmZmVjdGluZyB0aGUgbG9jYWwgaG91ci4gU28gNTozMToyNiArMDMwMCAtLVt1dGNPZmZzZXQoMiwgdHJ1ZSldLS0+XG4gICAgLy8gNTozMToyNiArMDIwMCBJdCBpcyBwb3NzaWJsZSB0aGF0IDU6MzE6MjYgZG9lc24ndCBleGlzdCB3aXRoIG9mZnNldFxuICAgIC8vICswMjAwLCBzbyB3ZSBhZGp1c3QgdGhlIHRpbWUgYXMgbmVlZGVkLCB0byBiZSB2YWxpZC5cbiAgICAvL1xuICAgIC8vIEtlZXBpbmcgdGhlIHRpbWUgYWN0dWFsbHkgYWRkcy9zdWJ0cmFjdHMgKG9uZSBob3VyKVxuICAgIC8vIGZyb20gdGhlIGFjdHVhbCByZXByZXNlbnRlZCB0aW1lLiBUaGF0IGlzIHdoeSB3ZSBjYWxsIHVwZGF0ZU9mZnNldFxuICAgIC8vIGEgc2Vjb25kIHRpbWUuIEluIGNhc2UgaXQgd2FudHMgdXMgdG8gY2hhbmdlIHRoZSBvZmZzZXQgYWdhaW5cbiAgICAvLyBfY2hhbmdlSW5Qcm9ncmVzcyA9PSB0cnVlIGNhc2UsIHRoZW4gd2UgaGF2ZSB0byBhZGp1c3QsIGJlY2F1c2VcbiAgICAvLyB0aGVyZSBpcyBubyBzdWNoIHRpbWUgaW4gdGhlIGdpdmVuIHRpbWV6b25lLlxuICAgIGZ1bmN0aW9uIGdldFNldE9mZnNldChpbnB1dCwga2VlcExvY2FsVGltZSwga2VlcE1pbnV0ZXMpIHtcbiAgICAgICAgdmFyIG9mZnNldCA9IHRoaXMuX29mZnNldCB8fCAwLFxuICAgICAgICAgICAgbG9jYWxBZGp1c3Q7XG4gICAgICAgIGlmICghdGhpcy5pc1ZhbGlkKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnB1dCAhPSBudWxsID8gdGhpcyA6IE5hTjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaW5wdXQgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBpbnB1dCA9IG9mZnNldEZyb21TdHJpbmcobWF0Y2hTaG9ydE9mZnNldCwgaW5wdXQpO1xuICAgICAgICAgICAgICAgIGlmIChpbnB1dCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKE1hdGguYWJzKGlucHV0KSA8IDE2ICYmICFrZWVwTWludXRlcykge1xuICAgICAgICAgICAgICAgIGlucHV0ID0gaW5wdXQgKiA2MDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5faXNVVEMgJiYga2VlcExvY2FsVGltZSkge1xuICAgICAgICAgICAgICAgIGxvY2FsQWRqdXN0ID0gZ2V0RGF0ZU9mZnNldCh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX29mZnNldCA9IGlucHV0O1xuICAgICAgICAgICAgdGhpcy5faXNVVEMgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKGxvY2FsQWRqdXN0ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZChsb2NhbEFkanVzdCwgJ20nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvZmZzZXQgIT09IGlucHV0KSB7XG4gICAgICAgICAgICAgICAgaWYgKCFrZWVwTG9jYWxUaW1lIHx8IHRoaXMuX2NoYW5nZUluUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkU3VidHJhY3QoXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLFxuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlRHVyYXRpb24oaW5wdXQgLSBvZmZzZXQsICdtJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLl9jaGFuZ2VJblByb2dyZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NoYW5nZUluUHJvZ3Jlc3MgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBob29rcy51cGRhdGVPZmZzZXQodGhpcywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NoYW5nZUluUHJvZ3Jlc3MgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzVVRDID8gb2Zmc2V0IDogZ2V0RGF0ZU9mZnNldCh0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFNldFpvbmUoaW5wdXQsIGtlZXBMb2NhbFRpbWUpIHtcbiAgICAgICAgaWYgKGlucHV0ICE9IG51bGwpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgaW5wdXQgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgaW5wdXQgPSAtaW5wdXQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMudXRjT2Zmc2V0KGlucHV0LCBrZWVwTG9jYWxUaW1lKTtcblxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gLXRoaXMudXRjT2Zmc2V0KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXRPZmZzZXRUb1VUQyhrZWVwTG9jYWxUaW1lKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnV0Y09mZnNldCgwLCBrZWVwTG9jYWxUaW1lKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXRPZmZzZXRUb0xvY2FsKGtlZXBMb2NhbFRpbWUpIHtcbiAgICAgICAgaWYgKHRoaXMuX2lzVVRDKSB7XG4gICAgICAgICAgICB0aGlzLnV0Y09mZnNldCgwLCBrZWVwTG9jYWxUaW1lKTtcbiAgICAgICAgICAgIHRoaXMuX2lzVVRDID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmIChrZWVwTG9jYWxUaW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdWJ0cmFjdChnZXREYXRlT2Zmc2V0KHRoaXMpLCAnbScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNldE9mZnNldFRvUGFyc2VkT2Zmc2V0KCkge1xuICAgICAgICBpZiAodGhpcy5fdHptICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMudXRjT2Zmc2V0KHRoaXMuX3R6bSwgZmFsc2UsIHRydWUpO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0aGlzLl9pID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdmFyIHRab25lID0gb2Zmc2V0RnJvbVN0cmluZyhtYXRjaE9mZnNldCwgdGhpcy5faSk7XG4gICAgICAgICAgICBpZiAodFpvbmUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMudXRjT2Zmc2V0KHRab25lKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy51dGNPZmZzZXQoMCwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaGFzQWxpZ25lZEhvdXJPZmZzZXQoaW5wdXQpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzVmFsaWQoKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlucHV0ID0gaW5wdXQgPyBjcmVhdGVMb2NhbChpbnB1dCkudXRjT2Zmc2V0KCkgOiAwO1xuXG4gICAgICAgIHJldHVybiAodGhpcy51dGNPZmZzZXQoKSAtIGlucHV0KSAlIDYwID09PSAwO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzRGF5bGlnaHRTYXZpbmdUaW1lKCkge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgdGhpcy51dGNPZmZzZXQoKSA+IHRoaXMuY2xvbmUoKS5tb250aCgwKS51dGNPZmZzZXQoKSB8fFxuICAgICAgICAgICAgdGhpcy51dGNPZmZzZXQoKSA+IHRoaXMuY2xvbmUoKS5tb250aCg1KS51dGNPZmZzZXQoKVxuICAgICAgICApO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzRGF5bGlnaHRTYXZpbmdUaW1lU2hpZnRlZCgpIHtcbiAgICAgICAgaWYgKCFpc1VuZGVmaW5lZCh0aGlzLl9pc0RTVFNoaWZ0ZWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5faXNEU1RTaGlmdGVkO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGMgPSB7fSxcbiAgICAgICAgICAgIG90aGVyO1xuXG4gICAgICAgIGNvcHlDb25maWcoYywgdGhpcyk7XG4gICAgICAgIGMgPSBwcmVwYXJlQ29uZmlnKGMpO1xuXG4gICAgICAgIGlmIChjLl9hKSB7XG4gICAgICAgICAgICBvdGhlciA9IGMuX2lzVVRDID8gY3JlYXRlVVRDKGMuX2EpIDogY3JlYXRlTG9jYWwoYy5fYSk7XG4gICAgICAgICAgICB0aGlzLl9pc0RTVFNoaWZ0ZWQgPVxuICAgICAgICAgICAgICAgIHRoaXMuaXNWYWxpZCgpICYmIGNvbXBhcmVBcnJheXMoYy5fYSwgb3RoZXIudG9BcnJheSgpKSA+IDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9pc0RTVFNoaWZ0ZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl9pc0RTVFNoaWZ0ZWQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNMb2NhbCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNWYWxpZCgpID8gIXRoaXMuX2lzVVRDIDogZmFsc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNVdGNPZmZzZXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzVmFsaWQoKSA/IHRoaXMuX2lzVVRDIDogZmFsc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNVdGMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzVmFsaWQoKSA/IHRoaXMuX2lzVVRDICYmIHRoaXMuX29mZnNldCA9PT0gMCA6IGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEFTUC5ORVQganNvbiBkYXRlIGZvcm1hdCByZWdleFxuICAgIHZhciBhc3BOZXRSZWdleCA9IC9eKC18XFwrKT8oPzooXFxkKilbLiBdKT8oXFxkKyk6KFxcZCspKD86OihcXGQrKShcXC5cXGQqKT8pPyQvLFxuICAgICAgICAvLyBmcm9tIGh0dHA6Ly9kb2NzLmNsb3N1cmUtbGlicmFyeS5nb29nbGVjb2RlLmNvbS9naXQvY2xvc3VyZV9nb29nX2RhdGVfZGF0ZS5qcy5zb3VyY2UuaHRtbFxuICAgICAgICAvLyBzb21ld2hhdCBtb3JlIGluIGxpbmUgd2l0aCA0LjQuMy4yIDIwMDQgc3BlYywgYnV0IGFsbG93cyBkZWNpbWFsIGFueXdoZXJlXG4gICAgICAgIC8vIGFuZCBmdXJ0aGVyIG1vZGlmaWVkIHRvIGFsbG93IGZvciBzdHJpbmdzIGNvbnRhaW5pbmcgYm90aCB3ZWVrIGFuZCBkYXlcbiAgICAgICAgaXNvUmVnZXggPSAvXigtfFxcKyk/UCg/OihbLStdP1swLTksLl0qKVkpPyg/OihbLStdP1swLTksLl0qKU0pPyg/OihbLStdP1swLTksLl0qKVcpPyg/OihbLStdP1swLTksLl0qKUQpPyg/OlQoPzooWy0rXT9bMC05LC5dKilIKT8oPzooWy0rXT9bMC05LC5dKilNKT8oPzooWy0rXT9bMC05LC5dKilTKT8pPyQvO1xuXG4gICAgZnVuY3Rpb24gY3JlYXRlRHVyYXRpb24oaW5wdXQsIGtleSkge1xuICAgICAgICB2YXIgZHVyYXRpb24gPSBpbnB1dCxcbiAgICAgICAgICAgIC8vIG1hdGNoaW5nIGFnYWluc3QgcmVnZXhwIGlzIGV4cGVuc2l2ZSwgZG8gaXQgb24gZGVtYW5kXG4gICAgICAgICAgICBtYXRjaCA9IG51bGwsXG4gICAgICAgICAgICBzaWduLFxuICAgICAgICAgICAgcmV0LFxuICAgICAgICAgICAgZGlmZlJlcztcblxuICAgICAgICBpZiAoaXNEdXJhdGlvbihpbnB1dCkpIHtcbiAgICAgICAgICAgIGR1cmF0aW9uID0ge1xuICAgICAgICAgICAgICAgIG1zOiBpbnB1dC5fbWlsbGlzZWNvbmRzLFxuICAgICAgICAgICAgICAgIGQ6IGlucHV0Ll9kYXlzLFxuICAgICAgICAgICAgICAgIE06IGlucHV0Ll9tb250aHMsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2UgaWYgKGlzTnVtYmVyKGlucHV0KSB8fCAhaXNOYU4oK2lucHV0KSkge1xuICAgICAgICAgICAgZHVyYXRpb24gPSB7fTtcbiAgICAgICAgICAgIGlmIChrZXkpIHtcbiAgICAgICAgICAgICAgICBkdXJhdGlvbltrZXldID0gK2lucHV0O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkdXJhdGlvbi5taWxsaXNlY29uZHMgPSAraW5wdXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoKG1hdGNoID0gYXNwTmV0UmVnZXguZXhlYyhpbnB1dCkpKSB7XG4gICAgICAgICAgICBzaWduID0gbWF0Y2hbMV0gPT09ICctJyA/IC0xIDogMTtcbiAgICAgICAgICAgIGR1cmF0aW9uID0ge1xuICAgICAgICAgICAgICAgIHk6IDAsXG4gICAgICAgICAgICAgICAgZDogdG9JbnQobWF0Y2hbREFURV0pICogc2lnbixcbiAgICAgICAgICAgICAgICBoOiB0b0ludChtYXRjaFtIT1VSXSkgKiBzaWduLFxuICAgICAgICAgICAgICAgIG06IHRvSW50KG1hdGNoW01JTlVURV0pICogc2lnbixcbiAgICAgICAgICAgICAgICBzOiB0b0ludChtYXRjaFtTRUNPTkRdKSAqIHNpZ24sXG4gICAgICAgICAgICAgICAgbXM6IHRvSW50KGFic1JvdW5kKG1hdGNoW01JTExJU0VDT05EXSAqIDEwMDApKSAqIHNpZ24sIC8vIHRoZSBtaWxsaXNlY29uZCBkZWNpbWFsIHBvaW50IGlzIGluY2x1ZGVkIGluIHRoZSBtYXRjaFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIGlmICgobWF0Y2ggPSBpc29SZWdleC5leGVjKGlucHV0KSkpIHtcbiAgICAgICAgICAgIHNpZ24gPSBtYXRjaFsxXSA9PT0gJy0nID8gLTEgOiAxO1xuICAgICAgICAgICAgZHVyYXRpb24gPSB7XG4gICAgICAgICAgICAgICAgeTogcGFyc2VJc28obWF0Y2hbMl0sIHNpZ24pLFxuICAgICAgICAgICAgICAgIE06IHBhcnNlSXNvKG1hdGNoWzNdLCBzaWduKSxcbiAgICAgICAgICAgICAgICB3OiBwYXJzZUlzbyhtYXRjaFs0XSwgc2lnbiksXG4gICAgICAgICAgICAgICAgZDogcGFyc2VJc28obWF0Y2hbNV0sIHNpZ24pLFxuICAgICAgICAgICAgICAgIGg6IHBhcnNlSXNvKG1hdGNoWzZdLCBzaWduKSxcbiAgICAgICAgICAgICAgICBtOiBwYXJzZUlzbyhtYXRjaFs3XSwgc2lnbiksXG4gICAgICAgICAgICAgICAgczogcGFyc2VJc28obWF0Y2hbOF0sIHNpZ24pLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIGlmIChkdXJhdGlvbiA9PSBudWxsKSB7XG4gICAgICAgICAgICAvLyBjaGVja3MgZm9yIG51bGwgb3IgdW5kZWZpbmVkXG4gICAgICAgICAgICBkdXJhdGlvbiA9IHt9O1xuICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgdHlwZW9mIGR1cmF0aW9uID09PSAnb2JqZWN0JyAmJlxuICAgICAgICAgICAgKCdmcm9tJyBpbiBkdXJhdGlvbiB8fCAndG8nIGluIGR1cmF0aW9uKVxuICAgICAgICApIHtcbiAgICAgICAgICAgIGRpZmZSZXMgPSBtb21lbnRzRGlmZmVyZW5jZShcbiAgICAgICAgICAgICAgICBjcmVhdGVMb2NhbChkdXJhdGlvbi5mcm9tKSxcbiAgICAgICAgICAgICAgICBjcmVhdGVMb2NhbChkdXJhdGlvbi50bylcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGR1cmF0aW9uID0ge307XG4gICAgICAgICAgICBkdXJhdGlvbi5tcyA9IGRpZmZSZXMubWlsbGlzZWNvbmRzO1xuICAgICAgICAgICAgZHVyYXRpb24uTSA9IGRpZmZSZXMubW9udGhzO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0ID0gbmV3IER1cmF0aW9uKGR1cmF0aW9uKTtcblxuICAgICAgICBpZiAoaXNEdXJhdGlvbihpbnB1dCkgJiYgaGFzT3duUHJvcChpbnB1dCwgJ19sb2NhbGUnKSkge1xuICAgICAgICAgICAgcmV0Ll9sb2NhbGUgPSBpbnB1dC5fbG9jYWxlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlzRHVyYXRpb24oaW5wdXQpICYmIGhhc093blByb3AoaW5wdXQsICdfaXNWYWxpZCcpKSB7XG4gICAgICAgICAgICByZXQuX2lzVmFsaWQgPSBpbnB1dC5faXNWYWxpZDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgfVxuXG4gICAgY3JlYXRlRHVyYXRpb24uZm4gPSBEdXJhdGlvbi5wcm90b3R5cGU7XG4gICAgY3JlYXRlRHVyYXRpb24uaW52YWxpZCA9IGNyZWF0ZUludmFsaWQkMTtcblxuICAgIGZ1bmN0aW9uIHBhcnNlSXNvKGlucCwgc2lnbikge1xuICAgICAgICAvLyBXZSdkIG5vcm1hbGx5IHVzZSB+fmlucCBmb3IgdGhpcywgYnV0IHVuZm9ydHVuYXRlbHkgaXQgYWxzb1xuICAgICAgICAvLyBjb252ZXJ0cyBmbG9hdHMgdG8gaW50cy5cbiAgICAgICAgLy8gaW5wIG1heSBiZSB1bmRlZmluZWQsIHNvIGNhcmVmdWwgY2FsbGluZyByZXBsYWNlIG9uIGl0LlxuICAgICAgICB2YXIgcmVzID0gaW5wICYmIHBhcnNlRmxvYXQoaW5wLnJlcGxhY2UoJywnLCAnLicpKTtcbiAgICAgICAgLy8gYXBwbHkgc2lnbiB3aGlsZSB3ZSdyZSBhdCBpdFxuICAgICAgICByZXR1cm4gKGlzTmFOKHJlcykgPyAwIDogcmVzKSAqIHNpZ247XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcG9zaXRpdmVNb21lbnRzRGlmZmVyZW5jZShiYXNlLCBvdGhlcikge1xuICAgICAgICB2YXIgcmVzID0ge307XG5cbiAgICAgICAgcmVzLm1vbnRocyA9XG4gICAgICAgICAgICBvdGhlci5tb250aCgpIC0gYmFzZS5tb250aCgpICsgKG90aGVyLnllYXIoKSAtIGJhc2UueWVhcigpKSAqIDEyO1xuICAgICAgICBpZiAoYmFzZS5jbG9uZSgpLmFkZChyZXMubW9udGhzLCAnTScpLmlzQWZ0ZXIob3RoZXIpKSB7XG4gICAgICAgICAgICAtLXJlcy5tb250aHM7XG4gICAgICAgIH1cblxuICAgICAgICByZXMubWlsbGlzZWNvbmRzID0gK290aGVyIC0gK2Jhc2UuY2xvbmUoKS5hZGQocmVzLm1vbnRocywgJ00nKTtcblxuICAgICAgICByZXR1cm4gcmVzO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1vbWVudHNEaWZmZXJlbmNlKGJhc2UsIG90aGVyKSB7XG4gICAgICAgIHZhciByZXM7XG4gICAgICAgIGlmICghKGJhc2UuaXNWYWxpZCgpICYmIG90aGVyLmlzVmFsaWQoKSkpIHtcbiAgICAgICAgICAgIHJldHVybiB7IG1pbGxpc2Vjb25kczogMCwgbW9udGhzOiAwIH07XG4gICAgICAgIH1cblxuICAgICAgICBvdGhlciA9IGNsb25lV2l0aE9mZnNldChvdGhlciwgYmFzZSk7XG4gICAgICAgIGlmIChiYXNlLmlzQmVmb3JlKG90aGVyKSkge1xuICAgICAgICAgICAgcmVzID0gcG9zaXRpdmVNb21lbnRzRGlmZmVyZW5jZShiYXNlLCBvdGhlcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXMgPSBwb3NpdGl2ZU1vbWVudHNEaWZmZXJlbmNlKG90aGVyLCBiYXNlKTtcbiAgICAgICAgICAgIHJlcy5taWxsaXNlY29uZHMgPSAtcmVzLm1pbGxpc2Vjb25kcztcbiAgICAgICAgICAgIHJlcy5tb250aHMgPSAtcmVzLm1vbnRocztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXM7XG4gICAgfVxuXG4gICAgLy8gVE9ETzogcmVtb3ZlICduYW1lJyBhcmcgYWZ0ZXIgZGVwcmVjYXRpb24gaXMgcmVtb3ZlZFxuICAgIGZ1bmN0aW9uIGNyZWF0ZUFkZGVyKGRpcmVjdGlvbiwgbmFtZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbCwgcGVyaW9kKSB7XG4gICAgICAgICAgICB2YXIgZHVyLCB0bXA7XG4gICAgICAgICAgICAvL2ludmVydCB0aGUgYXJndW1lbnRzLCBidXQgY29tcGxhaW4gYWJvdXQgaXRcbiAgICAgICAgICAgIGlmIChwZXJpb2QgIT09IG51bGwgJiYgIWlzTmFOKCtwZXJpb2QpKSB7XG4gICAgICAgICAgICAgICAgZGVwcmVjYXRlU2ltcGxlKFxuICAgICAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgICAgICAnbW9tZW50KCkuJyArXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lICtcbiAgICAgICAgICAgICAgICAgICAgICAgICcocGVyaW9kLCBudW1iZXIpIGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgbW9tZW50KCkuJyArXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lICtcbiAgICAgICAgICAgICAgICAgICAgICAgICcobnVtYmVyLCBwZXJpb2QpLiAnICtcbiAgICAgICAgICAgICAgICAgICAgICAgICdTZWUgaHR0cDovL21vbWVudGpzLmNvbS9ndWlkZXMvIy93YXJuaW5ncy9hZGQtaW52ZXJ0ZWQtcGFyYW0vIGZvciBtb3JlIGluZm8uJ1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgdG1wID0gdmFsO1xuICAgICAgICAgICAgICAgIHZhbCA9IHBlcmlvZDtcbiAgICAgICAgICAgICAgICBwZXJpb2QgPSB0bXA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGR1ciA9IGNyZWF0ZUR1cmF0aW9uKHZhbCwgcGVyaW9kKTtcbiAgICAgICAgICAgIGFkZFN1YnRyYWN0KHRoaXMsIGR1ciwgZGlyZWN0aW9uKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZFN1YnRyYWN0KG1vbSwgZHVyYXRpb24sIGlzQWRkaW5nLCB1cGRhdGVPZmZzZXQpIHtcbiAgICAgICAgdmFyIG1pbGxpc2Vjb25kcyA9IGR1cmF0aW9uLl9taWxsaXNlY29uZHMsXG4gICAgICAgICAgICBkYXlzID0gYWJzUm91bmQoZHVyYXRpb24uX2RheXMpLFxuICAgICAgICAgICAgbW9udGhzID0gYWJzUm91bmQoZHVyYXRpb24uX21vbnRocyk7XG5cbiAgICAgICAgaWYgKCFtb20uaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICAvLyBObyBvcFxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdXBkYXRlT2Zmc2V0ID0gdXBkYXRlT2Zmc2V0ID09IG51bGwgPyB0cnVlIDogdXBkYXRlT2Zmc2V0O1xuXG4gICAgICAgIGlmIChtb250aHMpIHtcbiAgICAgICAgICAgIHNldE1vbnRoKG1vbSwgZ2V0KG1vbSwgJ01vbnRoJykgKyBtb250aHMgKiBpc0FkZGluZyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRheXMpIHtcbiAgICAgICAgICAgIHNldCQxKG1vbSwgJ0RhdGUnLCBnZXQobW9tLCAnRGF0ZScpICsgZGF5cyAqIGlzQWRkaW5nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWlsbGlzZWNvbmRzKSB7XG4gICAgICAgICAgICBtb20uX2Quc2V0VGltZShtb20uX2QudmFsdWVPZigpICsgbWlsbGlzZWNvbmRzICogaXNBZGRpbmcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh1cGRhdGVPZmZzZXQpIHtcbiAgICAgICAgICAgIGhvb2tzLnVwZGF0ZU9mZnNldChtb20sIGRheXMgfHwgbW9udGhzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhciBhZGQgPSBjcmVhdGVBZGRlcigxLCAnYWRkJyksXG4gICAgICAgIHN1YnRyYWN0ID0gY3JlYXRlQWRkZXIoLTEsICdzdWJ0cmFjdCcpO1xuXG4gICAgZnVuY3Rpb24gaXNTdHJpbmcoaW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycgfHwgaW5wdXQgaW5zdGFuY2VvZiBTdHJpbmc7XG4gICAgfVxuXG4gICAgLy8gdHlwZSBNb21lbnRJbnB1dCA9IE1vbWVudCB8IERhdGUgfCBzdHJpbmcgfCBudW1iZXIgfCAobnVtYmVyIHwgc3RyaW5nKVtdIHwgTW9tZW50SW5wdXRPYmplY3QgfCB2b2lkOyAvLyBudWxsIHwgdW5kZWZpbmVkXG4gICAgZnVuY3Rpb24gaXNNb21lbnRJbnB1dChpbnB1dCkge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgaXNNb21lbnQoaW5wdXQpIHx8XG4gICAgICAgICAgICBpc0RhdGUoaW5wdXQpIHx8XG4gICAgICAgICAgICBpc1N0cmluZyhpbnB1dCkgfHxcbiAgICAgICAgICAgIGlzTnVtYmVyKGlucHV0KSB8fFxuICAgICAgICAgICAgaXNOdW1iZXJPclN0cmluZ0FycmF5KGlucHV0KSB8fFxuICAgICAgICAgICAgaXNNb21lbnRJbnB1dE9iamVjdChpbnB1dCkgfHxcbiAgICAgICAgICAgIGlucHV0ID09PSBudWxsIHx8XG4gICAgICAgICAgICBpbnB1dCA9PT0gdW5kZWZpbmVkXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNNb21lbnRJbnB1dE9iamVjdChpbnB1dCkge1xuICAgICAgICB2YXIgb2JqZWN0VGVzdCA9IGlzT2JqZWN0KGlucHV0KSAmJiAhaXNPYmplY3RFbXB0eShpbnB1dCksXG4gICAgICAgICAgICBwcm9wZXJ0eVRlc3QgPSBmYWxzZSxcbiAgICAgICAgICAgIHByb3BlcnRpZXMgPSBbXG4gICAgICAgICAgICAgICAgJ3llYXJzJyxcbiAgICAgICAgICAgICAgICAneWVhcicsXG4gICAgICAgICAgICAgICAgJ3knLFxuICAgICAgICAgICAgICAgICdtb250aHMnLFxuICAgICAgICAgICAgICAgICdtb250aCcsXG4gICAgICAgICAgICAgICAgJ00nLFxuICAgICAgICAgICAgICAgICdkYXlzJyxcbiAgICAgICAgICAgICAgICAnZGF5JyxcbiAgICAgICAgICAgICAgICAnZCcsXG4gICAgICAgICAgICAgICAgJ2RhdGVzJyxcbiAgICAgICAgICAgICAgICAnZGF0ZScsXG4gICAgICAgICAgICAgICAgJ0QnLFxuICAgICAgICAgICAgICAgICdob3VycycsXG4gICAgICAgICAgICAgICAgJ2hvdXInLFxuICAgICAgICAgICAgICAgICdoJyxcbiAgICAgICAgICAgICAgICAnbWludXRlcycsXG4gICAgICAgICAgICAgICAgJ21pbnV0ZScsXG4gICAgICAgICAgICAgICAgJ20nLFxuICAgICAgICAgICAgICAgICdzZWNvbmRzJyxcbiAgICAgICAgICAgICAgICAnc2Vjb25kJyxcbiAgICAgICAgICAgICAgICAncycsXG4gICAgICAgICAgICAgICAgJ21pbGxpc2Vjb25kcycsXG4gICAgICAgICAgICAgICAgJ21pbGxpc2Vjb25kJyxcbiAgICAgICAgICAgICAgICAnbXMnLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIGksXG4gICAgICAgICAgICBwcm9wZXJ0eTtcblxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcHJvcGVydGllcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgcHJvcGVydHkgPSBwcm9wZXJ0aWVzW2ldO1xuICAgICAgICAgICAgcHJvcGVydHlUZXN0ID0gcHJvcGVydHlUZXN0IHx8IGhhc093blByb3AoaW5wdXQsIHByb3BlcnR5KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBvYmplY3RUZXN0ICYmIHByb3BlcnR5VGVzdDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpc051bWJlck9yU3RyaW5nQXJyYXkoaW5wdXQpIHtcbiAgICAgICAgdmFyIGFycmF5VGVzdCA9IGlzQXJyYXkoaW5wdXQpLFxuICAgICAgICAgICAgZGF0YVR5cGVUZXN0ID0gZmFsc2U7XG4gICAgICAgIGlmIChhcnJheVRlc3QpIHtcbiAgICAgICAgICAgIGRhdGFUeXBlVGVzdCA9XG4gICAgICAgICAgICAgICAgaW5wdXQuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAhaXNOdW1iZXIoaXRlbSkgJiYgaXNTdHJpbmcoaW5wdXQpO1xuICAgICAgICAgICAgICAgIH0pLmxlbmd0aCA9PT0gMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXJyYXlUZXN0ICYmIGRhdGFUeXBlVGVzdDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpc0NhbGVuZGFyU3BlYyhpbnB1dCkge1xuICAgICAgICB2YXIgb2JqZWN0VGVzdCA9IGlzT2JqZWN0KGlucHV0KSAmJiAhaXNPYmplY3RFbXB0eShpbnB1dCksXG4gICAgICAgICAgICBwcm9wZXJ0eVRlc3QgPSBmYWxzZSxcbiAgICAgICAgICAgIHByb3BlcnRpZXMgPSBbXG4gICAgICAgICAgICAgICAgJ3NhbWVEYXknLFxuICAgICAgICAgICAgICAgICduZXh0RGF5JyxcbiAgICAgICAgICAgICAgICAnbGFzdERheScsXG4gICAgICAgICAgICAgICAgJ25leHRXZWVrJyxcbiAgICAgICAgICAgICAgICAnbGFzdFdlZWsnLFxuICAgICAgICAgICAgICAgICdzYW1lRWxzZScsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgaSxcbiAgICAgICAgICAgIHByb3BlcnR5O1xuXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBwcm9wZXJ0aWVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICBwcm9wZXJ0eSA9IHByb3BlcnRpZXNbaV07XG4gICAgICAgICAgICBwcm9wZXJ0eVRlc3QgPSBwcm9wZXJ0eVRlc3QgfHwgaGFzT3duUHJvcChpbnB1dCwgcHJvcGVydHkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG9iamVjdFRlc3QgJiYgcHJvcGVydHlUZXN0O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldENhbGVuZGFyRm9ybWF0KG15TW9tZW50LCBub3cpIHtcbiAgICAgICAgdmFyIGRpZmYgPSBteU1vbWVudC5kaWZmKG5vdywgJ2RheXMnLCB0cnVlKTtcbiAgICAgICAgcmV0dXJuIGRpZmYgPCAtNlxuICAgICAgICAgICAgPyAnc2FtZUVsc2UnXG4gICAgICAgICAgICA6IGRpZmYgPCAtMVxuICAgICAgICAgICAgPyAnbGFzdFdlZWsnXG4gICAgICAgICAgICA6IGRpZmYgPCAwXG4gICAgICAgICAgICA/ICdsYXN0RGF5J1xuICAgICAgICAgICAgOiBkaWZmIDwgMVxuICAgICAgICAgICAgPyAnc2FtZURheSdcbiAgICAgICAgICAgIDogZGlmZiA8IDJcbiAgICAgICAgICAgID8gJ25leHREYXknXG4gICAgICAgICAgICA6IGRpZmYgPCA3XG4gICAgICAgICAgICA/ICduZXh0V2VlaydcbiAgICAgICAgICAgIDogJ3NhbWVFbHNlJztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjYWxlbmRhciQxKHRpbWUsIGZvcm1hdHMpIHtcbiAgICAgICAgLy8gU3VwcG9ydCBmb3Igc2luZ2xlIHBhcmFtZXRlciwgZm9ybWF0cyBvbmx5IG92ZXJsb2FkIHRvIHRoZSBjYWxlbmRhciBmdW5jdGlvblxuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgaWYgKCFhcmd1bWVudHNbMF0pIHtcbiAgICAgICAgICAgICAgICB0aW1lID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGZvcm1hdHMgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzTW9tZW50SW5wdXQoYXJndW1lbnRzWzBdKSkge1xuICAgICAgICAgICAgICAgIHRpbWUgPSBhcmd1bWVudHNbMF07XG4gICAgICAgICAgICAgICAgZm9ybWF0cyA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNDYWxlbmRhclNwZWMoYXJndW1lbnRzWzBdKSkge1xuICAgICAgICAgICAgICAgIGZvcm1hdHMgPSBhcmd1bWVudHNbMF07XG4gICAgICAgICAgICAgICAgdGltZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBXZSB3YW50IHRvIGNvbXBhcmUgdGhlIHN0YXJ0IG9mIHRvZGF5LCB2cyB0aGlzLlxuICAgICAgICAvLyBHZXR0aW5nIHN0YXJ0LW9mLXRvZGF5IGRlcGVuZHMgb24gd2hldGhlciB3ZSdyZSBsb2NhbC91dGMvb2Zmc2V0IG9yIG5vdC5cbiAgICAgICAgdmFyIG5vdyA9IHRpbWUgfHwgY3JlYXRlTG9jYWwoKSxcbiAgICAgICAgICAgIHNvZCA9IGNsb25lV2l0aE9mZnNldChub3csIHRoaXMpLnN0YXJ0T2YoJ2RheScpLFxuICAgICAgICAgICAgZm9ybWF0ID0gaG9va3MuY2FsZW5kYXJGb3JtYXQodGhpcywgc29kKSB8fCAnc2FtZUVsc2UnLFxuICAgICAgICAgICAgb3V0cHV0ID1cbiAgICAgICAgICAgICAgICBmb3JtYXRzICYmXG4gICAgICAgICAgICAgICAgKGlzRnVuY3Rpb24oZm9ybWF0c1tmb3JtYXRdKVxuICAgICAgICAgICAgICAgICAgICA/IGZvcm1hdHNbZm9ybWF0XS5jYWxsKHRoaXMsIG5vdylcbiAgICAgICAgICAgICAgICAgICAgOiBmb3JtYXRzW2Zvcm1hdF0pO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmZvcm1hdChcbiAgICAgICAgICAgIG91dHB1dCB8fCB0aGlzLmxvY2FsZURhdGEoKS5jYWxlbmRhcihmb3JtYXQsIHRoaXMsIGNyZWF0ZUxvY2FsKG5vdykpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2xvbmUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgTW9tZW50KHRoaXMpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzQWZ0ZXIoaW5wdXQsIHVuaXRzKSB7XG4gICAgICAgIHZhciBsb2NhbElucHV0ID0gaXNNb21lbnQoaW5wdXQpID8gaW5wdXQgOiBjcmVhdGVMb2NhbChpbnB1dCk7XG4gICAgICAgIGlmICghKHRoaXMuaXNWYWxpZCgpICYmIGxvY2FsSW5wdXQuaXNWYWxpZCgpKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHVuaXRzID0gbm9ybWFsaXplVW5pdHModW5pdHMpIHx8ICdtaWxsaXNlY29uZCc7XG4gICAgICAgIGlmICh1bml0cyA9PT0gJ21pbGxpc2Vjb25kJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVPZigpID4gbG9jYWxJbnB1dC52YWx1ZU9mKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbG9jYWxJbnB1dC52YWx1ZU9mKCkgPCB0aGlzLmNsb25lKCkuc3RhcnRPZih1bml0cykudmFsdWVPZigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNCZWZvcmUoaW5wdXQsIHVuaXRzKSB7XG4gICAgICAgIHZhciBsb2NhbElucHV0ID0gaXNNb21lbnQoaW5wdXQpID8gaW5wdXQgOiBjcmVhdGVMb2NhbChpbnB1dCk7XG4gICAgICAgIGlmICghKHRoaXMuaXNWYWxpZCgpICYmIGxvY2FsSW5wdXQuaXNWYWxpZCgpKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHVuaXRzID0gbm9ybWFsaXplVW5pdHModW5pdHMpIHx8ICdtaWxsaXNlY29uZCc7XG4gICAgICAgIGlmICh1bml0cyA9PT0gJ21pbGxpc2Vjb25kJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVPZigpIDwgbG9jYWxJbnB1dC52YWx1ZU9mKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jbG9uZSgpLmVuZE9mKHVuaXRzKS52YWx1ZU9mKCkgPCBsb2NhbElucHV0LnZhbHVlT2YoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzQmV0d2Vlbihmcm9tLCB0bywgdW5pdHMsIGluY2x1c2l2aXR5KSB7XG4gICAgICAgIHZhciBsb2NhbEZyb20gPSBpc01vbWVudChmcm9tKSA/IGZyb20gOiBjcmVhdGVMb2NhbChmcm9tKSxcbiAgICAgICAgICAgIGxvY2FsVG8gPSBpc01vbWVudCh0bykgPyB0byA6IGNyZWF0ZUxvY2FsKHRvKTtcbiAgICAgICAgaWYgKCEodGhpcy5pc1ZhbGlkKCkgJiYgbG9jYWxGcm9tLmlzVmFsaWQoKSAmJiBsb2NhbFRvLmlzVmFsaWQoKSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpbmNsdXNpdml0eSA9IGluY2x1c2l2aXR5IHx8ICcoKSc7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAoaW5jbHVzaXZpdHlbMF0gPT09ICcoJ1xuICAgICAgICAgICAgICAgID8gdGhpcy5pc0FmdGVyKGxvY2FsRnJvbSwgdW5pdHMpXG4gICAgICAgICAgICAgICAgOiAhdGhpcy5pc0JlZm9yZShsb2NhbEZyb20sIHVuaXRzKSkgJiZcbiAgICAgICAgICAgIChpbmNsdXNpdml0eVsxXSA9PT0gJyknXG4gICAgICAgICAgICAgICAgPyB0aGlzLmlzQmVmb3JlKGxvY2FsVG8sIHVuaXRzKVxuICAgICAgICAgICAgICAgIDogIXRoaXMuaXNBZnRlcihsb2NhbFRvLCB1bml0cykpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNTYW1lKGlucHV0LCB1bml0cykge1xuICAgICAgICB2YXIgbG9jYWxJbnB1dCA9IGlzTW9tZW50KGlucHV0KSA/IGlucHV0IDogY3JlYXRlTG9jYWwoaW5wdXQpLFxuICAgICAgICAgICAgaW5wdXRNcztcbiAgICAgICAgaWYgKCEodGhpcy5pc1ZhbGlkKCkgJiYgbG9jYWxJbnB1dC5pc1ZhbGlkKCkpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdW5pdHMgPSBub3JtYWxpemVVbml0cyh1bml0cykgfHwgJ21pbGxpc2Vjb25kJztcbiAgICAgICAgaWYgKHVuaXRzID09PSAnbWlsbGlzZWNvbmQnKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy52YWx1ZU9mKCkgPT09IGxvY2FsSW5wdXQudmFsdWVPZigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaW5wdXRNcyA9IGxvY2FsSW5wdXQudmFsdWVPZigpO1xuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICB0aGlzLmNsb25lKCkuc3RhcnRPZih1bml0cykudmFsdWVPZigpIDw9IGlucHV0TXMgJiZcbiAgICAgICAgICAgICAgICBpbnB1dE1zIDw9IHRoaXMuY2xvbmUoKS5lbmRPZih1bml0cykudmFsdWVPZigpXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNTYW1lT3JBZnRlcihpbnB1dCwgdW5pdHMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNTYW1lKGlucHV0LCB1bml0cykgfHwgdGhpcy5pc0FmdGVyKGlucHV0LCB1bml0cyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNTYW1lT3JCZWZvcmUoaW5wdXQsIHVuaXRzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlzU2FtZShpbnB1dCwgdW5pdHMpIHx8IHRoaXMuaXNCZWZvcmUoaW5wdXQsIHVuaXRzKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkaWZmKGlucHV0LCB1bml0cywgYXNGbG9hdCkge1xuICAgICAgICB2YXIgdGhhdCwgem9uZURlbHRhLCBvdXRwdXQ7XG5cbiAgICAgICAgaWYgKCF0aGlzLmlzVmFsaWQoKSkge1xuICAgICAgICAgICAgcmV0dXJuIE5hTjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoYXQgPSBjbG9uZVdpdGhPZmZzZXQoaW5wdXQsIHRoaXMpO1xuXG4gICAgICAgIGlmICghdGhhdC5pc1ZhbGlkKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBOYU47XG4gICAgICAgIH1cblxuICAgICAgICB6b25lRGVsdGEgPSAodGhhdC51dGNPZmZzZXQoKSAtIHRoaXMudXRjT2Zmc2V0KCkpICogNmU0O1xuXG4gICAgICAgIHVuaXRzID0gbm9ybWFsaXplVW5pdHModW5pdHMpO1xuXG4gICAgICAgIHN3aXRjaCAodW5pdHMpIHtcbiAgICAgICAgICAgIGNhc2UgJ3llYXInOlxuICAgICAgICAgICAgICAgIG91dHB1dCA9IG1vbnRoRGlmZih0aGlzLCB0aGF0KSAvIDEyO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbW9udGgnOlxuICAgICAgICAgICAgICAgIG91dHB1dCA9IG1vbnRoRGlmZih0aGlzLCB0aGF0KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3F1YXJ0ZXInOlxuICAgICAgICAgICAgICAgIG91dHB1dCA9IG1vbnRoRGlmZih0aGlzLCB0aGF0KSAvIDM7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdzZWNvbmQnOlxuICAgICAgICAgICAgICAgIG91dHB1dCA9ICh0aGlzIC0gdGhhdCkgLyAxZTM7XG4gICAgICAgICAgICAgICAgYnJlYWs7IC8vIDEwMDBcbiAgICAgICAgICAgIGNhc2UgJ21pbnV0ZSc6XG4gICAgICAgICAgICAgICAgb3V0cHV0ID0gKHRoaXMgLSB0aGF0KSAvIDZlNDtcbiAgICAgICAgICAgICAgICBicmVhazsgLy8gMTAwMCAqIDYwXG4gICAgICAgICAgICBjYXNlICdob3VyJzpcbiAgICAgICAgICAgICAgICBvdXRwdXQgPSAodGhpcyAtIHRoYXQpIC8gMzZlNTtcbiAgICAgICAgICAgICAgICBicmVhazsgLy8gMTAwMCAqIDYwICogNjBcbiAgICAgICAgICAgIGNhc2UgJ2RheSc6XG4gICAgICAgICAgICAgICAgb3V0cHV0ID0gKHRoaXMgLSB0aGF0IC0gem9uZURlbHRhKSAvIDg2NGU1O1xuICAgICAgICAgICAgICAgIGJyZWFrOyAvLyAxMDAwICogNjAgKiA2MCAqIDI0LCBuZWdhdGUgZHN0XG4gICAgICAgICAgICBjYXNlICd3ZWVrJzpcbiAgICAgICAgICAgICAgICBvdXRwdXQgPSAodGhpcyAtIHRoYXQgLSB6b25lRGVsdGEpIC8gNjA0OGU1O1xuICAgICAgICAgICAgICAgIGJyZWFrOyAvLyAxMDAwICogNjAgKiA2MCAqIDI0ICogNywgbmVnYXRlIGRzdFxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBvdXRwdXQgPSB0aGlzIC0gdGhhdDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhc0Zsb2F0ID8gb3V0cHV0IDogYWJzRmxvb3Iob3V0cHV0KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtb250aERpZmYoYSwgYikge1xuICAgICAgICBpZiAoYS5kYXRlKCkgPCBiLmRhdGUoKSkge1xuICAgICAgICAgICAgLy8gZW5kLW9mLW1vbnRoIGNhbGN1bGF0aW9ucyB3b3JrIGNvcnJlY3Qgd2hlbiB0aGUgc3RhcnQgbW9udGggaGFzIG1vcmVcbiAgICAgICAgICAgIC8vIGRheXMgdGhhbiB0aGUgZW5kIG1vbnRoLlxuICAgICAgICAgICAgcmV0dXJuIC1tb250aERpZmYoYiwgYSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gZGlmZmVyZW5jZSBpbiBtb250aHNcbiAgICAgICAgdmFyIHdob2xlTW9udGhEaWZmID0gKGIueWVhcigpIC0gYS55ZWFyKCkpICogMTIgKyAoYi5tb250aCgpIC0gYS5tb250aCgpKSxcbiAgICAgICAgICAgIC8vIGIgaXMgaW4gKGFuY2hvciAtIDEgbW9udGgsIGFuY2hvciArIDEgbW9udGgpXG4gICAgICAgICAgICBhbmNob3IgPSBhLmNsb25lKCkuYWRkKHdob2xlTW9udGhEaWZmLCAnbW9udGhzJyksXG4gICAgICAgICAgICBhbmNob3IyLFxuICAgICAgICAgICAgYWRqdXN0O1xuXG4gICAgICAgIGlmIChiIC0gYW5jaG9yIDwgMCkge1xuICAgICAgICAgICAgYW5jaG9yMiA9IGEuY2xvbmUoKS5hZGQod2hvbGVNb250aERpZmYgLSAxLCAnbW9udGhzJyk7XG4gICAgICAgICAgICAvLyBsaW5lYXIgYWNyb3NzIHRoZSBtb250aFxuICAgICAgICAgICAgYWRqdXN0ID0gKGIgLSBhbmNob3IpIC8gKGFuY2hvciAtIGFuY2hvcjIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYW5jaG9yMiA9IGEuY2xvbmUoKS5hZGQod2hvbGVNb250aERpZmYgKyAxLCAnbW9udGhzJyk7XG4gICAgICAgICAgICAvLyBsaW5lYXIgYWNyb3NzIHRoZSBtb250aFxuICAgICAgICAgICAgYWRqdXN0ID0gKGIgLSBhbmNob3IpIC8gKGFuY2hvcjIgLSBhbmNob3IpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy9jaGVjayBmb3IgbmVnYXRpdmUgemVybywgcmV0dXJuIHplcm8gaWYgbmVnYXRpdmUgemVyb1xuICAgICAgICByZXR1cm4gLSh3aG9sZU1vbnRoRGlmZiArIGFkanVzdCkgfHwgMDtcbiAgICB9XG5cbiAgICBob29rcy5kZWZhdWx0Rm9ybWF0ID0gJ1lZWVktTU0tRERUSEg6bW06c3NaJztcbiAgICBob29rcy5kZWZhdWx0Rm9ybWF0VXRjID0gJ1lZWVktTU0tRERUSEg6bW06c3NbWl0nO1xuXG4gICAgZnVuY3Rpb24gdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lKCkubG9jYWxlKCdlbicpLmZvcm1hdCgnZGRkIE1NTSBERCBZWVlZIEhIOm1tOnNzIFtHTVRdWlonKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0b0lTT1N0cmluZyhrZWVwT2Zmc2V0KSB7XG4gICAgICAgIGlmICghdGhpcy5pc1ZhbGlkKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHZhciB1dGMgPSBrZWVwT2Zmc2V0ICE9PSB0cnVlLFxuICAgICAgICAgICAgbSA9IHV0YyA/IHRoaXMuY2xvbmUoKS51dGMoKSA6IHRoaXM7XG4gICAgICAgIGlmIChtLnllYXIoKSA8IDAgfHwgbS55ZWFyKCkgPiA5OTk5KSB7XG4gICAgICAgICAgICByZXR1cm4gZm9ybWF0TW9tZW50KFxuICAgICAgICAgICAgICAgIG0sXG4gICAgICAgICAgICAgICAgdXRjXG4gICAgICAgICAgICAgICAgICAgID8gJ1lZWVlZWS1NTS1ERFtUXUhIOm1tOnNzLlNTU1taXSdcbiAgICAgICAgICAgICAgICAgICAgOiAnWVlZWVlZLU1NLUREW1RdSEg6bW06c3MuU1NTWidcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzRnVuY3Rpb24oRGF0ZS5wcm90b3R5cGUudG9JU09TdHJpbmcpKSB7XG4gICAgICAgICAgICAvLyBuYXRpdmUgaW1wbGVtZW50YXRpb24gaXMgfjUweCBmYXN0ZXIsIHVzZSBpdCB3aGVuIHdlIGNhblxuICAgICAgICAgICAgaWYgKHV0Yykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRvRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSArIHRoaXMudXRjT2Zmc2V0KCkgKiA2MCAqIDEwMDApXG4gICAgICAgICAgICAgICAgICAgIC50b0lTT1N0cmluZygpXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCdaJywgZm9ybWF0TW9tZW50KG0sICdaJykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmb3JtYXRNb21lbnQoXG4gICAgICAgICAgICBtLFxuICAgICAgICAgICAgdXRjID8gJ1lZWVktTU0tRERbVF1ISDptbTpzcy5TU1NbWl0nIDogJ1lZWVktTU0tRERbVF1ISDptbTpzcy5TU1NaJ1xuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybiBhIGh1bWFuIHJlYWRhYmxlIHJlcHJlc2VudGF0aW9uIG9mIGEgbW9tZW50IHRoYXQgY2FuXG4gICAgICogYWxzbyBiZSBldmFsdWF0ZWQgdG8gZ2V0IGEgbmV3IG1vbWVudCB3aGljaCBpcyB0aGUgc2FtZVxuICAgICAqXG4gICAgICogQGxpbmsgaHR0cHM6Ly9ub2RlanMub3JnL2Rpc3QvbGF0ZXN0L2RvY3MvYXBpL3V0aWwuaHRtbCN1dGlsX2N1c3RvbV9pbnNwZWN0X2Z1bmN0aW9uX29uX29iamVjdHNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpbnNwZWN0KCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gJ21vbWVudC5pbnZhbGlkKC8qICcgKyB0aGlzLl9pICsgJyAqLyknO1xuICAgICAgICB9XG4gICAgICAgIHZhciBmdW5jID0gJ21vbWVudCcsXG4gICAgICAgICAgICB6b25lID0gJycsXG4gICAgICAgICAgICBwcmVmaXgsXG4gICAgICAgICAgICB5ZWFyLFxuICAgICAgICAgICAgZGF0ZXRpbWUsXG4gICAgICAgICAgICBzdWZmaXg7XG4gICAgICAgIGlmICghdGhpcy5pc0xvY2FsKCkpIHtcbiAgICAgICAgICAgIGZ1bmMgPSB0aGlzLnV0Y09mZnNldCgpID09PSAwID8gJ21vbWVudC51dGMnIDogJ21vbWVudC5wYXJzZVpvbmUnO1xuICAgICAgICAgICAgem9uZSA9ICdaJztcbiAgICAgICAgfVxuICAgICAgICBwcmVmaXggPSAnWycgKyBmdW5jICsgJyhcIl0nO1xuICAgICAgICB5ZWFyID0gMCA8PSB0aGlzLnllYXIoKSAmJiB0aGlzLnllYXIoKSA8PSA5OTk5ID8gJ1lZWVknIDogJ1lZWVlZWSc7XG4gICAgICAgIGRhdGV0aW1lID0gJy1NTS1ERFtUXUhIOm1tOnNzLlNTUyc7XG4gICAgICAgIHN1ZmZpeCA9IHpvbmUgKyAnW1wiKV0nO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmZvcm1hdChwcmVmaXggKyB5ZWFyICsgZGF0ZXRpbWUgKyBzdWZmaXgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGZvcm1hdChpbnB1dFN0cmluZykge1xuICAgICAgICBpZiAoIWlucHV0U3RyaW5nKSB7XG4gICAgICAgICAgICBpbnB1dFN0cmluZyA9IHRoaXMuaXNVdGMoKVxuICAgICAgICAgICAgICAgID8gaG9va3MuZGVmYXVsdEZvcm1hdFV0Y1xuICAgICAgICAgICAgICAgIDogaG9va3MuZGVmYXVsdEZvcm1hdDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgb3V0cHV0ID0gZm9ybWF0TW9tZW50KHRoaXMsIGlucHV0U3RyaW5nKTtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlRGF0YSgpLnBvc3Rmb3JtYXQob3V0cHV0KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBmcm9tKHRpbWUsIHdpdGhvdXRTdWZmaXgpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgdGhpcy5pc1ZhbGlkKCkgJiZcbiAgICAgICAgICAgICgoaXNNb21lbnQodGltZSkgJiYgdGltZS5pc1ZhbGlkKCkpIHx8IGNyZWF0ZUxvY2FsKHRpbWUpLmlzVmFsaWQoKSlcbiAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlRHVyYXRpb24oeyB0bzogdGhpcywgZnJvbTogdGltZSB9KVxuICAgICAgICAgICAgICAgIC5sb2NhbGUodGhpcy5sb2NhbGUoKSlcbiAgICAgICAgICAgICAgICAuaHVtYW5pemUoIXdpdGhvdXRTdWZmaXgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlRGF0YSgpLmludmFsaWREYXRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBmcm9tTm93KHdpdGhvdXRTdWZmaXgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZnJvbShjcmVhdGVMb2NhbCgpLCB3aXRob3V0U3VmZml4KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0byh0aW1lLCB3aXRob3V0U3VmZml4KSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIHRoaXMuaXNWYWxpZCgpICYmXG4gICAgICAgICAgICAoKGlzTW9tZW50KHRpbWUpICYmIHRpbWUuaXNWYWxpZCgpKSB8fCBjcmVhdGVMb2NhbCh0aW1lKS5pc1ZhbGlkKCkpXG4gICAgICAgICkge1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUR1cmF0aW9uKHsgZnJvbTogdGhpcywgdG86IHRpbWUgfSlcbiAgICAgICAgICAgICAgICAubG9jYWxlKHRoaXMubG9jYWxlKCkpXG4gICAgICAgICAgICAgICAgLmh1bWFuaXplKCF3aXRob3V0U3VmZml4KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxvY2FsZURhdGEoKS5pbnZhbGlkRGF0ZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdG9Ob3cod2l0aG91dFN1ZmZpeCkge1xuICAgICAgICByZXR1cm4gdGhpcy50byhjcmVhdGVMb2NhbCgpLCB3aXRob3V0U3VmZml4KTtcbiAgICB9XG5cbiAgICAvLyBJZiBwYXNzZWQgYSBsb2NhbGUga2V5LCBpdCB3aWxsIHNldCB0aGUgbG9jYWxlIGZvciB0aGlzXG4gICAgLy8gaW5zdGFuY2UuICBPdGhlcndpc2UsIGl0IHdpbGwgcmV0dXJuIHRoZSBsb2NhbGUgY29uZmlndXJhdGlvblxuICAgIC8vIHZhcmlhYmxlcyBmb3IgdGhpcyBpbnN0YW5jZS5cbiAgICBmdW5jdGlvbiBsb2NhbGUoa2V5KSB7XG4gICAgICAgIHZhciBuZXdMb2NhbGVEYXRhO1xuXG4gICAgICAgIGlmIChrZXkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xvY2FsZS5fYWJicjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5ld0xvY2FsZURhdGEgPSBnZXRMb2NhbGUoa2V5KTtcbiAgICAgICAgICAgIGlmIChuZXdMb2NhbGVEYXRhICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9sb2NhbGUgPSBuZXdMb2NhbGVEYXRhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgbGFuZyA9IGRlcHJlY2F0ZShcbiAgICAgICAgJ21vbWVudCgpLmxhbmcoKSBpcyBkZXByZWNhdGVkLiBJbnN0ZWFkLCB1c2UgbW9tZW50KCkubG9jYWxlRGF0YSgpIHRvIGdldCB0aGUgbGFuZ3VhZ2UgY29uZmlndXJhdGlvbi4gVXNlIG1vbWVudCgpLmxvY2FsZSgpIHRvIGNoYW5nZSBsYW5ndWFnZXMuJyxcbiAgICAgICAgZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgaWYgKGtleSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlRGF0YSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGUoa2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICk7XG5cbiAgICBmdW5jdGlvbiBsb2NhbGVEYXRhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbG9jYWxlO1xuICAgIH1cblxuICAgIHZhciBNU19QRVJfU0VDT05EID0gMTAwMCxcbiAgICAgICAgTVNfUEVSX01JTlVURSA9IDYwICogTVNfUEVSX1NFQ09ORCxcbiAgICAgICAgTVNfUEVSX0hPVVIgPSA2MCAqIE1TX1BFUl9NSU5VVEUsXG4gICAgICAgIE1TX1BFUl80MDBfWUVBUlMgPSAoMzY1ICogNDAwICsgOTcpICogMjQgKiBNU19QRVJfSE9VUjtcblxuICAgIC8vIGFjdHVhbCBtb2R1bG8gLSBoYW5kbGVzIG5lZ2F0aXZlIG51bWJlcnMgKGZvciBkYXRlcyBiZWZvcmUgMTk3MCk6XG4gICAgZnVuY3Rpb24gbW9kJDEoZGl2aWRlbmQsIGRpdmlzb3IpIHtcbiAgICAgICAgcmV0dXJuICgoZGl2aWRlbmQgJSBkaXZpc29yKSArIGRpdmlzb3IpICUgZGl2aXNvcjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsb2NhbFN0YXJ0T2ZEYXRlKHksIG0sIGQpIHtcbiAgICAgICAgLy8gdGhlIGRhdGUgY29uc3RydWN0b3IgcmVtYXBzIHllYXJzIDAtOTkgdG8gMTkwMC0xOTk5XG4gICAgICAgIGlmICh5IDwgMTAwICYmIHkgPj0gMCkge1xuICAgICAgICAgICAgLy8gcHJlc2VydmUgbGVhcCB5ZWFycyB1c2luZyBhIGZ1bGwgNDAwIHllYXIgY3ljbGUsIHRoZW4gcmVzZXRcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZSh5ICsgNDAwLCBtLCBkKSAtIE1TX1BFUl80MDBfWUVBUlM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoeSwgbSwgZCkudmFsdWVPZigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdXRjU3RhcnRPZkRhdGUoeSwgbSwgZCkge1xuICAgICAgICAvLyBEYXRlLlVUQyByZW1hcHMgeWVhcnMgMC05OSB0byAxOTAwLTE5OTlcbiAgICAgICAgaWYgKHkgPCAxMDAgJiYgeSA+PSAwKSB7XG4gICAgICAgICAgICAvLyBwcmVzZXJ2ZSBsZWFwIHllYXJzIHVzaW5nIGEgZnVsbCA0MDAgeWVhciBjeWNsZSwgdGhlbiByZXNldFxuICAgICAgICAgICAgcmV0dXJuIERhdGUuVVRDKHkgKyA0MDAsIG0sIGQpIC0gTVNfUEVSXzQwMF9ZRUFSUztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBEYXRlLlVUQyh5LCBtLCBkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN0YXJ0T2YodW5pdHMpIHtcbiAgICAgICAgdmFyIHRpbWUsIHN0YXJ0T2ZEYXRlO1xuICAgICAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHVuaXRzKTtcbiAgICAgICAgaWYgKHVuaXRzID09PSB1bmRlZmluZWQgfHwgdW5pdHMgPT09ICdtaWxsaXNlY29uZCcgfHwgIXRoaXMuaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuXG4gICAgICAgIHN0YXJ0T2ZEYXRlID0gdGhpcy5faXNVVEMgPyB1dGNTdGFydE9mRGF0ZSA6IGxvY2FsU3RhcnRPZkRhdGU7XG5cbiAgICAgICAgc3dpdGNoICh1bml0cykge1xuICAgICAgICAgICAgY2FzZSAneWVhcic6XG4gICAgICAgICAgICAgICAgdGltZSA9IHN0YXJ0T2ZEYXRlKHRoaXMueWVhcigpLCAwLCAxKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3F1YXJ0ZXInOlxuICAgICAgICAgICAgICAgIHRpbWUgPSBzdGFydE9mRGF0ZShcbiAgICAgICAgICAgICAgICAgICAgdGhpcy55ZWFyKCksXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW9udGgoKSAtICh0aGlzLm1vbnRoKCkgJSAzKSxcbiAgICAgICAgICAgICAgICAgICAgMVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdtb250aCc6XG4gICAgICAgICAgICAgICAgdGltZSA9IHN0YXJ0T2ZEYXRlKHRoaXMueWVhcigpLCB0aGlzLm1vbnRoKCksIDEpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgICAgICAgICAgdGltZSA9IHN0YXJ0T2ZEYXRlKFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnllYXIoKSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb250aCgpLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGUoKSAtIHRoaXMud2Vla2RheSgpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2lzb1dlZWsnOlxuICAgICAgICAgICAgICAgIHRpbWUgPSBzdGFydE9mRGF0ZShcbiAgICAgICAgICAgICAgICAgICAgdGhpcy55ZWFyKCksXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW9udGgoKSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRlKCkgLSAodGhpcy5pc29XZWVrZGF5KCkgLSAxKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdkYXknOlxuICAgICAgICAgICAgY2FzZSAnZGF0ZSc6XG4gICAgICAgICAgICAgICAgdGltZSA9IHN0YXJ0T2ZEYXRlKHRoaXMueWVhcigpLCB0aGlzLm1vbnRoKCksIHRoaXMuZGF0ZSgpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2hvdXInOlxuICAgICAgICAgICAgICAgIHRpbWUgPSB0aGlzLl9kLnZhbHVlT2YoKTtcbiAgICAgICAgICAgICAgICB0aW1lIC09IG1vZCQxKFxuICAgICAgICAgICAgICAgICAgICB0aW1lICsgKHRoaXMuX2lzVVRDID8gMCA6IHRoaXMudXRjT2Zmc2V0KCkgKiBNU19QRVJfTUlOVVRFKSxcbiAgICAgICAgICAgICAgICAgICAgTVNfUEVSX0hPVVJcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbWludXRlJzpcbiAgICAgICAgICAgICAgICB0aW1lID0gdGhpcy5fZC52YWx1ZU9mKCk7XG4gICAgICAgICAgICAgICAgdGltZSAtPSBtb2QkMSh0aW1lLCBNU19QRVJfTUlOVVRFKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3NlY29uZCc6XG4gICAgICAgICAgICAgICAgdGltZSA9IHRoaXMuX2QudmFsdWVPZigpO1xuICAgICAgICAgICAgICAgIHRpbWUgLT0gbW9kJDEodGltZSwgTVNfUEVSX1NFQ09ORCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9kLnNldFRpbWUodGltZSk7XG4gICAgICAgIGhvb2tzLnVwZGF0ZU9mZnNldCh0aGlzLCB0cnVlKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZW5kT2YodW5pdHMpIHtcbiAgICAgICAgdmFyIHRpbWUsIHN0YXJ0T2ZEYXRlO1xuICAgICAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHVuaXRzKTtcbiAgICAgICAgaWYgKHVuaXRzID09PSB1bmRlZmluZWQgfHwgdW5pdHMgPT09ICdtaWxsaXNlY29uZCcgfHwgIXRoaXMuaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuXG4gICAgICAgIHN0YXJ0T2ZEYXRlID0gdGhpcy5faXNVVEMgPyB1dGNTdGFydE9mRGF0ZSA6IGxvY2FsU3RhcnRPZkRhdGU7XG5cbiAgICAgICAgc3dpdGNoICh1bml0cykge1xuICAgICAgICAgICAgY2FzZSAneWVhcic6XG4gICAgICAgICAgICAgICAgdGltZSA9IHN0YXJ0T2ZEYXRlKHRoaXMueWVhcigpICsgMSwgMCwgMSkgLSAxO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAncXVhcnRlcic6XG4gICAgICAgICAgICAgICAgdGltZSA9XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0T2ZEYXRlKFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy55ZWFyKCksXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vbnRoKCkgLSAodGhpcy5tb250aCgpICUgMykgKyAzLFxuICAgICAgICAgICAgICAgICAgICAgICAgMVxuICAgICAgICAgICAgICAgICAgICApIC0gMTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgICAgICAgICB0aW1lID0gc3RhcnRPZkRhdGUodGhpcy55ZWFyKCksIHRoaXMubW9udGgoKSArIDEsIDEpIC0gMTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3dlZWsnOlxuICAgICAgICAgICAgICAgIHRpbWUgPVxuICAgICAgICAgICAgICAgICAgICBzdGFydE9mRGF0ZShcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueWVhcigpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb250aCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRlKCkgLSB0aGlzLndlZWtkYXkoKSArIDdcbiAgICAgICAgICAgICAgICAgICAgKSAtIDE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdpc29XZWVrJzpcbiAgICAgICAgICAgICAgICB0aW1lID1cbiAgICAgICAgICAgICAgICAgICAgc3RhcnRPZkRhdGUoXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnllYXIoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9udGgoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0ZSgpIC0gKHRoaXMuaXNvV2Vla2RheSgpIC0gMSkgKyA3XG4gICAgICAgICAgICAgICAgICAgICkgLSAxO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZGF5JzpcbiAgICAgICAgICAgIGNhc2UgJ2RhdGUnOlxuICAgICAgICAgICAgICAgIHRpbWUgPSBzdGFydE9mRGF0ZSh0aGlzLnllYXIoKSwgdGhpcy5tb250aCgpLCB0aGlzLmRhdGUoKSArIDEpIC0gMTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2hvdXInOlxuICAgICAgICAgICAgICAgIHRpbWUgPSB0aGlzLl9kLnZhbHVlT2YoKTtcbiAgICAgICAgICAgICAgICB0aW1lICs9XG4gICAgICAgICAgICAgICAgICAgIE1TX1BFUl9IT1VSIC1cbiAgICAgICAgICAgICAgICAgICAgbW9kJDEoXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lICsgKHRoaXMuX2lzVVRDID8gMCA6IHRoaXMudXRjT2Zmc2V0KCkgKiBNU19QRVJfTUlOVVRFKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIE1TX1BFUl9IT1VSXG4gICAgICAgICAgICAgICAgICAgICkgLVxuICAgICAgICAgICAgICAgICAgICAxO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbWludXRlJzpcbiAgICAgICAgICAgICAgICB0aW1lID0gdGhpcy5fZC52YWx1ZU9mKCk7XG4gICAgICAgICAgICAgICAgdGltZSArPSBNU19QRVJfTUlOVVRFIC0gbW9kJDEodGltZSwgTVNfUEVSX01JTlVURSkgLSAxO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnc2Vjb25kJzpcbiAgICAgICAgICAgICAgICB0aW1lID0gdGhpcy5fZC52YWx1ZU9mKCk7XG4gICAgICAgICAgICAgICAgdGltZSArPSBNU19QRVJfU0VDT05EIC0gbW9kJDEodGltZSwgTVNfUEVSX1NFQ09ORCkgLSAxO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fZC5zZXRUaW1lKHRpbWUpO1xuICAgICAgICBob29rcy51cGRhdGVPZmZzZXQodGhpcywgdHJ1ZSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHZhbHVlT2YoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kLnZhbHVlT2YoKSAtICh0aGlzLl9vZmZzZXQgfHwgMCkgKiA2MDAwMDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB1bml4KCkge1xuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcih0aGlzLnZhbHVlT2YoKSAvIDEwMDApO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHRvRGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHRoaXMudmFsdWVPZigpKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0b0FycmF5KCkge1xuICAgICAgICB2YXIgbSA9IHRoaXM7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBtLnllYXIoKSxcbiAgICAgICAgICAgIG0ubW9udGgoKSxcbiAgICAgICAgICAgIG0uZGF0ZSgpLFxuICAgICAgICAgICAgbS5ob3VyKCksXG4gICAgICAgICAgICBtLm1pbnV0ZSgpLFxuICAgICAgICAgICAgbS5zZWNvbmQoKSxcbiAgICAgICAgICAgIG0ubWlsbGlzZWNvbmQoKSxcbiAgICAgICAgXTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0b09iamVjdCgpIHtcbiAgICAgICAgdmFyIG0gPSB0aGlzO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgeWVhcnM6IG0ueWVhcigpLFxuICAgICAgICAgICAgbW9udGhzOiBtLm1vbnRoKCksXG4gICAgICAgICAgICBkYXRlOiBtLmRhdGUoKSxcbiAgICAgICAgICAgIGhvdXJzOiBtLmhvdXJzKCksXG4gICAgICAgICAgICBtaW51dGVzOiBtLm1pbnV0ZXMoKSxcbiAgICAgICAgICAgIHNlY29uZHM6IG0uc2Vjb25kcygpLFxuICAgICAgICAgICAgbWlsbGlzZWNvbmRzOiBtLm1pbGxpc2Vjb25kcygpLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHRvSlNPTigpIHtcbiAgICAgICAgLy8gbmV3IERhdGUoTmFOKS50b0pTT04oKSA9PT0gbnVsbFxuICAgICAgICByZXR1cm4gdGhpcy5pc1ZhbGlkKCkgPyB0aGlzLnRvSVNPU3RyaW5nKCkgOiBudWxsO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzVmFsaWQkMigpIHtcbiAgICAgICAgcmV0dXJuIGlzVmFsaWQodGhpcyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcGFyc2luZ0ZsYWdzKCkge1xuICAgICAgICByZXR1cm4gZXh0ZW5kKHt9LCBnZXRQYXJzaW5nRmxhZ3ModGhpcykpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGludmFsaWRBdCgpIHtcbiAgICAgICAgcmV0dXJuIGdldFBhcnNpbmdGbGFncyh0aGlzKS5vdmVyZmxvdztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGlvbkRhdGEoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpbnB1dDogdGhpcy5faSxcbiAgICAgICAgICAgIGZvcm1hdDogdGhpcy5fZixcbiAgICAgICAgICAgIGxvY2FsZTogdGhpcy5fbG9jYWxlLFxuICAgICAgICAgICAgaXNVVEM6IHRoaXMuX2lzVVRDLFxuICAgICAgICAgICAgc3RyaWN0OiB0aGlzLl9zdHJpY3QsXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgYWRkRm9ybWF0VG9rZW4oJ04nLCAwLCAwLCAnZXJhQWJicicpO1xuICAgIGFkZEZvcm1hdFRva2VuKCdOTicsIDAsIDAsICdlcmFBYmJyJyk7XG4gICAgYWRkRm9ybWF0VG9rZW4oJ05OTicsIDAsIDAsICdlcmFBYmJyJyk7XG4gICAgYWRkRm9ybWF0VG9rZW4oJ05OTk4nLCAwLCAwLCAnZXJhTmFtZScpO1xuICAgIGFkZEZvcm1hdFRva2VuKCdOTk5OTicsIDAsIDAsICdlcmFOYXJyb3cnKTtcblxuICAgIGFkZEZvcm1hdFRva2VuKCd5JywgWyd5JywgMV0sICd5bycsICdlcmFZZWFyJyk7XG4gICAgYWRkRm9ybWF0VG9rZW4oJ3knLCBbJ3l5JywgMl0sIDAsICdlcmFZZWFyJyk7XG4gICAgYWRkRm9ybWF0VG9rZW4oJ3knLCBbJ3l5eScsIDNdLCAwLCAnZXJhWWVhcicpO1xuICAgIGFkZEZvcm1hdFRva2VuKCd5JywgWyd5eXl5JywgNF0sIDAsICdlcmFZZWFyJyk7XG5cbiAgICBhZGRSZWdleFRva2VuKCdOJywgbWF0Y2hFcmFBYmJyKTtcbiAgICBhZGRSZWdleFRva2VuKCdOTicsIG1hdGNoRXJhQWJicik7XG4gICAgYWRkUmVnZXhUb2tlbignTk5OJywgbWF0Y2hFcmFBYmJyKTtcbiAgICBhZGRSZWdleFRva2VuKCdOTk5OJywgbWF0Y2hFcmFOYW1lKTtcbiAgICBhZGRSZWdleFRva2VuKCdOTk5OTicsIG1hdGNoRXJhTmFycm93KTtcblxuICAgIGFkZFBhcnNlVG9rZW4oWydOJywgJ05OJywgJ05OTicsICdOTk5OJywgJ05OTk5OJ10sIGZ1bmN0aW9uIChcbiAgICAgICAgaW5wdXQsXG4gICAgICAgIGFycmF5LFxuICAgICAgICBjb25maWcsXG4gICAgICAgIHRva2VuXG4gICAgKSB7XG4gICAgICAgIHZhciBlcmEgPSBjb25maWcuX2xvY2FsZS5lcmFzUGFyc2UoaW5wdXQsIHRva2VuLCBjb25maWcuX3N0cmljdCk7XG4gICAgICAgIGlmIChlcmEpIHtcbiAgICAgICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLmVyYSA9IGVyYTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLmludmFsaWRFcmEgPSBpbnB1dDtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgYWRkUmVnZXhUb2tlbigneScsIG1hdGNoVW5zaWduZWQpO1xuICAgIGFkZFJlZ2V4VG9rZW4oJ3l5JywgbWF0Y2hVbnNpZ25lZCk7XG4gICAgYWRkUmVnZXhUb2tlbigneXl5JywgbWF0Y2hVbnNpZ25lZCk7XG4gICAgYWRkUmVnZXhUb2tlbigneXl5eScsIG1hdGNoVW5zaWduZWQpO1xuICAgIGFkZFJlZ2V4VG9rZW4oJ3lvJywgbWF0Y2hFcmFZZWFyT3JkaW5hbCk7XG5cbiAgICBhZGRQYXJzZVRva2VuKFsneScsICd5eScsICd5eXknLCAneXl5eSddLCBZRUFSKTtcbiAgICBhZGRQYXJzZVRva2VuKFsneW8nXSwgZnVuY3Rpb24gKGlucHV0LCBhcnJheSwgY29uZmlnLCB0b2tlbikge1xuICAgICAgICB2YXIgbWF0Y2g7XG4gICAgICAgIGlmIChjb25maWcuX2xvY2FsZS5fZXJhWWVhck9yZGluYWxSZWdleCkge1xuICAgICAgICAgICAgbWF0Y2ggPSBpbnB1dC5tYXRjaChjb25maWcuX2xvY2FsZS5fZXJhWWVhck9yZGluYWxSZWdleCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29uZmlnLl9sb2NhbGUuZXJhWWVhck9yZGluYWxQYXJzZSkge1xuICAgICAgICAgICAgYXJyYXlbWUVBUl0gPSBjb25maWcuX2xvY2FsZS5lcmFZZWFyT3JkaW5hbFBhcnNlKGlucHV0LCBtYXRjaCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhcnJheVtZRUFSXSA9IHBhcnNlSW50KGlucHV0LCAxMCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIGxvY2FsZUVyYXMobSwgZm9ybWF0KSB7XG4gICAgICAgIHZhciBpLFxuICAgICAgICAgICAgbCxcbiAgICAgICAgICAgIGRhdGUsXG4gICAgICAgICAgICBlcmFzID0gdGhpcy5fZXJhcyB8fCBnZXRMb2NhbGUoJ2VuJykuX2VyYXM7XG4gICAgICAgIGZvciAoaSA9IDAsIGwgPSBlcmFzLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgZXJhc1tpXS5zaW5jZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgICAgIC8vIHRydW5jYXRlIHRpbWVcbiAgICAgICAgICAgICAgICAgICAgZGF0ZSA9IGhvb2tzKGVyYXNbaV0uc2luY2UpLnN0YXJ0T2YoJ2RheScpO1xuICAgICAgICAgICAgICAgICAgICBlcmFzW2ldLnNpbmNlID0gZGF0ZS52YWx1ZU9mKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBlcmFzW2ldLnVudGlsKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAndW5kZWZpbmVkJzpcbiAgICAgICAgICAgICAgICAgICAgZXJhc1tpXS51bnRpbCA9ICtJbmZpbml0eTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICAgICAgLy8gdHJ1bmNhdGUgdGltZVxuICAgICAgICAgICAgICAgICAgICBkYXRlID0gaG9va3MoZXJhc1tpXS51bnRpbCkuc3RhcnRPZignZGF5JykudmFsdWVPZigpO1xuICAgICAgICAgICAgICAgICAgICBlcmFzW2ldLnVudGlsID0gZGF0ZS52YWx1ZU9mKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlcmFzO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxvY2FsZUVyYXNQYXJzZShlcmFOYW1lLCBmb3JtYXQsIHN0cmljdCkge1xuICAgICAgICB2YXIgaSxcbiAgICAgICAgICAgIGwsXG4gICAgICAgICAgICBlcmFzID0gdGhpcy5lcmFzKCksXG4gICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgYWJicixcbiAgICAgICAgICAgIG5hcnJvdztcbiAgICAgICAgZXJhTmFtZSA9IGVyYU5hbWUudG9VcHBlckNhc2UoKTtcblxuICAgICAgICBmb3IgKGkgPSAwLCBsID0gZXJhcy5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbiAgICAgICAgICAgIG5hbWUgPSBlcmFzW2ldLm5hbWUudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIGFiYnIgPSBlcmFzW2ldLmFiYnIudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgIG5hcnJvdyA9IGVyYXNbaV0ubmFycm93LnRvVXBwZXJDYXNlKCk7XG5cbiAgICAgICAgICAgIGlmIChzdHJpY3QpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGZvcm1hdCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdOJzpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTk4nOlxuICAgICAgICAgICAgICAgICAgICBjYXNlICdOTk4nOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFiYnIgPT09IGVyYU5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJhc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ05OTk4nOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWUgPT09IGVyYU5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJhc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ05OTk5OJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuYXJyb3cgPT09IGVyYU5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJhc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoW25hbWUsIGFiYnIsIG5hcnJvd10uaW5kZXhPZihlcmFOYW1lKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVyYXNbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsb2NhbGVFcmFzQ29udmVydFllYXIoZXJhLCB5ZWFyKSB7XG4gICAgICAgIHZhciBkaXIgPSBlcmEuc2luY2UgPD0gZXJhLnVudGlsID8gKzEgOiAtMTtcbiAgICAgICAgaWYgKHllYXIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGhvb2tzKGVyYS5zaW5jZSkueWVhcigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGhvb2tzKGVyYS5zaW5jZSkueWVhcigpICsgKHllYXIgLSBlcmEub2Zmc2V0KSAqIGRpcjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldEVyYU5hbWUoKSB7XG4gICAgICAgIHZhciBpLFxuICAgICAgICAgICAgbCxcbiAgICAgICAgICAgIHZhbCxcbiAgICAgICAgICAgIGVyYXMgPSB0aGlzLmxvY2FsZURhdGEoKS5lcmFzKCk7XG4gICAgICAgIGZvciAoaSA9IDAsIGwgPSBlcmFzLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuICAgICAgICAgICAgLy8gdHJ1bmNhdGUgdGltZVxuICAgICAgICAgICAgdmFsID0gdGhpcy5jbG9uZSgpLnN0YXJ0T2YoJ2RheScpLnZhbHVlT2YoKTtcblxuICAgICAgICAgICAgaWYgKGVyYXNbaV0uc2luY2UgPD0gdmFsICYmIHZhbCA8PSBlcmFzW2ldLnVudGlsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVyYXNbaV0ubmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlcmFzW2ldLnVudGlsIDw9IHZhbCAmJiB2YWwgPD0gZXJhc1tpXS5zaW5jZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlcmFzW2ldLm5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gJyc7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0RXJhTmFycm93KCkge1xuICAgICAgICB2YXIgaSxcbiAgICAgICAgICAgIGwsXG4gICAgICAgICAgICB2YWwsXG4gICAgICAgICAgICBlcmFzID0gdGhpcy5sb2NhbGVEYXRhKCkuZXJhcygpO1xuICAgICAgICBmb3IgKGkgPSAwLCBsID0gZXJhcy5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbiAgICAgICAgICAgIC8vIHRydW5jYXRlIHRpbWVcbiAgICAgICAgICAgIHZhbCA9IHRoaXMuY2xvbmUoKS5zdGFydE9mKCdkYXknKS52YWx1ZU9mKCk7XG5cbiAgICAgICAgICAgIGlmIChlcmFzW2ldLnNpbmNlIDw9IHZhbCAmJiB2YWwgPD0gZXJhc1tpXS51bnRpbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlcmFzW2ldLm5hcnJvdztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlcmFzW2ldLnVudGlsIDw9IHZhbCAmJiB2YWwgPD0gZXJhc1tpXS5zaW5jZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlcmFzW2ldLm5hcnJvdztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAnJztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRFcmFBYmJyKCkge1xuICAgICAgICB2YXIgaSxcbiAgICAgICAgICAgIGwsXG4gICAgICAgICAgICB2YWwsXG4gICAgICAgICAgICBlcmFzID0gdGhpcy5sb2NhbGVEYXRhKCkuZXJhcygpO1xuICAgICAgICBmb3IgKGkgPSAwLCBsID0gZXJhcy5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbiAgICAgICAgICAgIC8vIHRydW5jYXRlIHRpbWVcbiAgICAgICAgICAgIHZhbCA9IHRoaXMuY2xvbmUoKS5zdGFydE9mKCdkYXknKS52YWx1ZU9mKCk7XG5cbiAgICAgICAgICAgIGlmIChlcmFzW2ldLnNpbmNlIDw9IHZhbCAmJiB2YWwgPD0gZXJhc1tpXS51bnRpbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlcmFzW2ldLmFiYnI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZXJhc1tpXS51bnRpbCA8PSB2YWwgJiYgdmFsIDw9IGVyYXNbaV0uc2luY2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZXJhc1tpXS5hYmJyO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldEVyYVllYXIoKSB7XG4gICAgICAgIHZhciBpLFxuICAgICAgICAgICAgbCxcbiAgICAgICAgICAgIGRpcixcbiAgICAgICAgICAgIHZhbCxcbiAgICAgICAgICAgIGVyYXMgPSB0aGlzLmxvY2FsZURhdGEoKS5lcmFzKCk7XG4gICAgICAgIGZvciAoaSA9IDAsIGwgPSBlcmFzLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuICAgICAgICAgICAgZGlyID0gZXJhc1tpXS5zaW5jZSA8PSBlcmFzW2ldLnVudGlsID8gKzEgOiAtMTtcblxuICAgICAgICAgICAgLy8gdHJ1bmNhdGUgdGltZVxuICAgICAgICAgICAgdmFsID0gdGhpcy5jbG9uZSgpLnN0YXJ0T2YoJ2RheScpLnZhbHVlT2YoKTtcblxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIChlcmFzW2ldLnNpbmNlIDw9IHZhbCAmJiB2YWwgPD0gZXJhc1tpXS51bnRpbCkgfHxcbiAgICAgICAgICAgICAgICAoZXJhc1tpXS51bnRpbCA8PSB2YWwgJiYgdmFsIDw9IGVyYXNbaV0uc2luY2UpXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgICAodGhpcy55ZWFyKCkgLSBob29rcyhlcmFzW2ldLnNpbmNlKS55ZWFyKCkpICogZGlyICtcbiAgICAgICAgICAgICAgICAgICAgZXJhc1tpXS5vZmZzZXRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMueWVhcigpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGVyYXNOYW1lUmVnZXgoaXNTdHJpY3QpIHtcbiAgICAgICAgaWYgKCFoYXNPd25Qcm9wKHRoaXMsICdfZXJhc05hbWVSZWdleCcpKSB7XG4gICAgICAgICAgICBjb21wdXRlRXJhc1BhcnNlLmNhbGwodGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGlzU3RyaWN0ID8gdGhpcy5fZXJhc05hbWVSZWdleCA6IHRoaXMuX2VyYXNSZWdleDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBlcmFzQWJiclJlZ2V4KGlzU3RyaWN0KSB7XG4gICAgICAgIGlmICghaGFzT3duUHJvcCh0aGlzLCAnX2VyYXNBYmJyUmVnZXgnKSkge1xuICAgICAgICAgICAgY29tcHV0ZUVyYXNQYXJzZS5jYWxsKHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpc1N0cmljdCA/IHRoaXMuX2VyYXNBYmJyUmVnZXggOiB0aGlzLl9lcmFzUmVnZXg7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZXJhc05hcnJvd1JlZ2V4KGlzU3RyaWN0KSB7XG4gICAgICAgIGlmICghaGFzT3duUHJvcCh0aGlzLCAnX2VyYXNOYXJyb3dSZWdleCcpKSB7XG4gICAgICAgICAgICBjb21wdXRlRXJhc1BhcnNlLmNhbGwodGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGlzU3RyaWN0ID8gdGhpcy5fZXJhc05hcnJvd1JlZ2V4IDogdGhpcy5fZXJhc1JlZ2V4O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1hdGNoRXJhQWJicihpc1N0cmljdCwgbG9jYWxlKSB7XG4gICAgICAgIHJldHVybiBsb2NhbGUuZXJhc0FiYnJSZWdleChpc1N0cmljdCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWF0Y2hFcmFOYW1lKGlzU3RyaWN0LCBsb2NhbGUpIHtcbiAgICAgICAgcmV0dXJuIGxvY2FsZS5lcmFzTmFtZVJlZ2V4KGlzU3RyaWN0KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtYXRjaEVyYU5hcnJvdyhpc1N0cmljdCwgbG9jYWxlKSB7XG4gICAgICAgIHJldHVybiBsb2NhbGUuZXJhc05hcnJvd1JlZ2V4KGlzU3RyaWN0KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtYXRjaEVyYVllYXJPcmRpbmFsKGlzU3RyaWN0LCBsb2NhbGUpIHtcbiAgICAgICAgcmV0dXJuIGxvY2FsZS5fZXJhWWVhck9yZGluYWxSZWdleCB8fCBtYXRjaFVuc2lnbmVkO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNvbXB1dGVFcmFzUGFyc2UoKSB7XG4gICAgICAgIHZhciBhYmJyUGllY2VzID0gW10sXG4gICAgICAgICAgICBuYW1lUGllY2VzID0gW10sXG4gICAgICAgICAgICBuYXJyb3dQaWVjZXMgPSBbXSxcbiAgICAgICAgICAgIG1peGVkUGllY2VzID0gW10sXG4gICAgICAgICAgICBpLFxuICAgICAgICAgICAgbCxcbiAgICAgICAgICAgIGVyYXMgPSB0aGlzLmVyYXMoKTtcblxuICAgICAgICBmb3IgKGkgPSAwLCBsID0gZXJhcy5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbiAgICAgICAgICAgIG5hbWVQaWVjZXMucHVzaChyZWdleEVzY2FwZShlcmFzW2ldLm5hbWUpKTtcbiAgICAgICAgICAgIGFiYnJQaWVjZXMucHVzaChyZWdleEVzY2FwZShlcmFzW2ldLmFiYnIpKTtcbiAgICAgICAgICAgIG5hcnJvd1BpZWNlcy5wdXNoKHJlZ2V4RXNjYXBlKGVyYXNbaV0ubmFycm93KSk7XG5cbiAgICAgICAgICAgIG1peGVkUGllY2VzLnB1c2gocmVnZXhFc2NhcGUoZXJhc1tpXS5uYW1lKSk7XG4gICAgICAgICAgICBtaXhlZFBpZWNlcy5wdXNoKHJlZ2V4RXNjYXBlKGVyYXNbaV0uYWJicikpO1xuICAgICAgICAgICAgbWl4ZWRQaWVjZXMucHVzaChyZWdleEVzY2FwZShlcmFzW2ldLm5hcnJvdykpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fZXJhc1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXignICsgbWl4ZWRQaWVjZXMuam9pbignfCcpICsgJyknLCAnaScpO1xuICAgICAgICB0aGlzLl9lcmFzTmFtZVJlZ2V4ID0gbmV3IFJlZ0V4cCgnXignICsgbmFtZVBpZWNlcy5qb2luKCd8JykgKyAnKScsICdpJyk7XG4gICAgICAgIHRoaXMuX2VyYXNBYmJyUmVnZXggPSBuZXcgUmVnRXhwKCdeKCcgKyBhYmJyUGllY2VzLmpvaW4oJ3wnKSArICcpJywgJ2knKTtcbiAgICAgICAgdGhpcy5fZXJhc05hcnJvd1JlZ2V4ID0gbmV3IFJlZ0V4cChcbiAgICAgICAgICAgICdeKCcgKyBuYXJyb3dQaWVjZXMuam9pbignfCcpICsgJyknLFxuICAgICAgICAgICAgJ2knXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gRk9STUFUVElOR1xuXG4gICAgYWRkRm9ybWF0VG9rZW4oMCwgWydnZycsIDJdLCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndlZWtZZWFyKCkgJSAxMDA7XG4gICAgfSk7XG5cbiAgICBhZGRGb3JtYXRUb2tlbigwLCBbJ0dHJywgMl0sIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNvV2Vla1llYXIoKSAlIDEwMDtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIGFkZFdlZWtZZWFyRm9ybWF0VG9rZW4odG9rZW4sIGdldHRlcikge1xuICAgICAgICBhZGRGb3JtYXRUb2tlbigwLCBbdG9rZW4sIHRva2VuLmxlbmd0aF0sIDAsIGdldHRlcik7XG4gICAgfVxuXG4gICAgYWRkV2Vla1llYXJGb3JtYXRUb2tlbignZ2dnZycsICd3ZWVrWWVhcicpO1xuICAgIGFkZFdlZWtZZWFyRm9ybWF0VG9rZW4oJ2dnZ2dnJywgJ3dlZWtZZWFyJyk7XG4gICAgYWRkV2Vla1llYXJGb3JtYXRUb2tlbignR0dHRycsICdpc29XZWVrWWVhcicpO1xuICAgIGFkZFdlZWtZZWFyRm9ybWF0VG9rZW4oJ0dHR0dHJywgJ2lzb1dlZWtZZWFyJyk7XG5cbiAgICAvLyBBTElBU0VTXG5cbiAgICBhZGRVbml0QWxpYXMoJ3dlZWtZZWFyJywgJ2dnJyk7XG4gICAgYWRkVW5pdEFsaWFzKCdpc29XZWVrWWVhcicsICdHRycpO1xuXG4gICAgLy8gUFJJT1JJVFlcblxuICAgIGFkZFVuaXRQcmlvcml0eSgnd2Vla1llYXInLCAxKTtcbiAgICBhZGRVbml0UHJpb3JpdHkoJ2lzb1dlZWtZZWFyJywgMSk7XG5cbiAgICAvLyBQQVJTSU5HXG5cbiAgICBhZGRSZWdleFRva2VuKCdHJywgbWF0Y2hTaWduZWQpO1xuICAgIGFkZFJlZ2V4VG9rZW4oJ2cnLCBtYXRjaFNpZ25lZCk7XG4gICAgYWRkUmVnZXhUb2tlbignR0cnLCBtYXRjaDF0bzIsIG1hdGNoMik7XG4gICAgYWRkUmVnZXhUb2tlbignZ2cnLCBtYXRjaDF0bzIsIG1hdGNoMik7XG4gICAgYWRkUmVnZXhUb2tlbignR0dHRycsIG1hdGNoMXRvNCwgbWF0Y2g0KTtcbiAgICBhZGRSZWdleFRva2VuKCdnZ2dnJywgbWF0Y2gxdG80LCBtYXRjaDQpO1xuICAgIGFkZFJlZ2V4VG9rZW4oJ0dHR0dHJywgbWF0Y2gxdG82LCBtYXRjaDYpO1xuICAgIGFkZFJlZ2V4VG9rZW4oJ2dnZ2dnJywgbWF0Y2gxdG82LCBtYXRjaDYpO1xuXG4gICAgYWRkV2Vla1BhcnNlVG9rZW4oWydnZ2dnJywgJ2dnZ2dnJywgJ0dHR0cnLCAnR0dHR0cnXSwgZnVuY3Rpb24gKFxuICAgICAgICBpbnB1dCxcbiAgICAgICAgd2VlayxcbiAgICAgICAgY29uZmlnLFxuICAgICAgICB0b2tlblxuICAgICkge1xuICAgICAgICB3ZWVrW3Rva2VuLnN1YnN0cigwLCAyKV0gPSB0b0ludChpbnB1dCk7XG4gICAgfSk7XG5cbiAgICBhZGRXZWVrUGFyc2VUb2tlbihbJ2dnJywgJ0dHJ10sIGZ1bmN0aW9uIChpbnB1dCwgd2VlaywgY29uZmlnLCB0b2tlbikge1xuICAgICAgICB3ZWVrW3Rva2VuXSA9IGhvb2tzLnBhcnNlVHdvRGlnaXRZZWFyKGlucHV0KTtcbiAgICB9KTtcblxuICAgIC8vIE1PTUVOVFNcblxuICAgIGZ1bmN0aW9uIGdldFNldFdlZWtZZWFyKGlucHV0KSB7XG4gICAgICAgIHJldHVybiBnZXRTZXRXZWVrWWVhckhlbHBlci5jYWxsKFxuICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgIGlucHV0LFxuICAgICAgICAgICAgdGhpcy53ZWVrKCksXG4gICAgICAgICAgICB0aGlzLndlZWtkYXkoKSxcbiAgICAgICAgICAgIHRoaXMubG9jYWxlRGF0YSgpLl93ZWVrLmRvdyxcbiAgICAgICAgICAgIHRoaXMubG9jYWxlRGF0YSgpLl93ZWVrLmRveVxuICAgICAgICApO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFNldElTT1dlZWtZZWFyKGlucHV0KSB7XG4gICAgICAgIHJldHVybiBnZXRTZXRXZWVrWWVhckhlbHBlci5jYWxsKFxuICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgIGlucHV0LFxuICAgICAgICAgICAgdGhpcy5pc29XZWVrKCksXG4gICAgICAgICAgICB0aGlzLmlzb1dlZWtkYXkoKSxcbiAgICAgICAgICAgIDEsXG4gICAgICAgICAgICA0XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0SVNPV2Vla3NJblllYXIoKSB7XG4gICAgICAgIHJldHVybiB3ZWVrc0luWWVhcih0aGlzLnllYXIoKSwgMSwgNCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0SVNPV2Vla3NJbklTT1dlZWtZZWFyKCkge1xuICAgICAgICByZXR1cm4gd2Vla3NJblllYXIodGhpcy5pc29XZWVrWWVhcigpLCAxLCA0KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRXZWVrc0luWWVhcigpIHtcbiAgICAgICAgdmFyIHdlZWtJbmZvID0gdGhpcy5sb2NhbGVEYXRhKCkuX3dlZWs7XG4gICAgICAgIHJldHVybiB3ZWVrc0luWWVhcih0aGlzLnllYXIoKSwgd2Vla0luZm8uZG93LCB3ZWVrSW5mby5kb3kpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFdlZWtzSW5XZWVrWWVhcigpIHtcbiAgICAgICAgdmFyIHdlZWtJbmZvID0gdGhpcy5sb2NhbGVEYXRhKCkuX3dlZWs7XG4gICAgICAgIHJldHVybiB3ZWVrc0luWWVhcih0aGlzLndlZWtZZWFyKCksIHdlZWtJbmZvLmRvdywgd2Vla0luZm8uZG95KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRTZXRXZWVrWWVhckhlbHBlcihpbnB1dCwgd2Vlaywgd2Vla2RheSwgZG93LCBkb3kpIHtcbiAgICAgICAgdmFyIHdlZWtzVGFyZ2V0O1xuICAgICAgICBpZiAoaW5wdXQgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHdlZWtPZlllYXIodGhpcywgZG93LCBkb3kpLnllYXI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB3ZWVrc1RhcmdldCA9IHdlZWtzSW5ZZWFyKGlucHV0LCBkb3csIGRveSk7XG4gICAgICAgICAgICBpZiAod2VlayA+IHdlZWtzVGFyZ2V0KSB7XG4gICAgICAgICAgICAgICAgd2VlayA9IHdlZWtzVGFyZ2V0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHNldFdlZWtBbGwuY2FsbCh0aGlzLCBpbnB1dCwgd2Vlaywgd2Vla2RheSwgZG93LCBkb3kpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0V2Vla0FsbCh3ZWVrWWVhciwgd2Vlaywgd2Vla2RheSwgZG93LCBkb3kpIHtcbiAgICAgICAgdmFyIGRheU9mWWVhckRhdGEgPSBkYXlPZlllYXJGcm9tV2Vla3Mod2Vla1llYXIsIHdlZWssIHdlZWtkYXksIGRvdywgZG95KSxcbiAgICAgICAgICAgIGRhdGUgPSBjcmVhdGVVVENEYXRlKGRheU9mWWVhckRhdGEueWVhciwgMCwgZGF5T2ZZZWFyRGF0YS5kYXlPZlllYXIpO1xuXG4gICAgICAgIHRoaXMueWVhcihkYXRlLmdldFVUQ0Z1bGxZZWFyKCkpO1xuICAgICAgICB0aGlzLm1vbnRoKGRhdGUuZ2V0VVRDTW9udGgoKSk7XG4gICAgICAgIHRoaXMuZGF0ZShkYXRlLmdldFVUQ0RhdGUoKSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8vIEZPUk1BVFRJTkdcblxuICAgIGFkZEZvcm1hdFRva2VuKCdRJywgMCwgJ1FvJywgJ3F1YXJ0ZXInKTtcblxuICAgIC8vIEFMSUFTRVNcblxuICAgIGFkZFVuaXRBbGlhcygncXVhcnRlcicsICdRJyk7XG5cbiAgICAvLyBQUklPUklUWVxuXG4gICAgYWRkVW5pdFByaW9yaXR5KCdxdWFydGVyJywgNyk7XG5cbiAgICAvLyBQQVJTSU5HXG5cbiAgICBhZGRSZWdleFRva2VuKCdRJywgbWF0Y2gxKTtcbiAgICBhZGRQYXJzZVRva2VuKCdRJywgZnVuY3Rpb24gKGlucHV0LCBhcnJheSkge1xuICAgICAgICBhcnJheVtNT05USF0gPSAodG9JbnQoaW5wdXQpIC0gMSkgKiAzO1xuICAgIH0pO1xuXG4gICAgLy8gTU9NRU5UU1xuXG4gICAgZnVuY3Rpb24gZ2V0U2V0UXVhcnRlcihpbnB1dCkge1xuICAgICAgICByZXR1cm4gaW5wdXQgPT0gbnVsbFxuICAgICAgICAgICAgPyBNYXRoLmNlaWwoKHRoaXMubW9udGgoKSArIDEpIC8gMylcbiAgICAgICAgICAgIDogdGhpcy5tb250aCgoaW5wdXQgLSAxKSAqIDMgKyAodGhpcy5tb250aCgpICUgMykpO1xuICAgIH1cblxuICAgIC8vIEZPUk1BVFRJTkdcblxuICAgIGFkZEZvcm1hdFRva2VuKCdEJywgWydERCcsIDJdLCAnRG8nLCAnZGF0ZScpO1xuXG4gICAgLy8gQUxJQVNFU1xuXG4gICAgYWRkVW5pdEFsaWFzKCdkYXRlJywgJ0QnKTtcblxuICAgIC8vIFBSSU9SSVRZXG4gICAgYWRkVW5pdFByaW9yaXR5KCdkYXRlJywgOSk7XG5cbiAgICAvLyBQQVJTSU5HXG5cbiAgICBhZGRSZWdleFRva2VuKCdEJywgbWF0Y2gxdG8yKTtcbiAgICBhZGRSZWdleFRva2VuKCdERCcsIG1hdGNoMXRvMiwgbWF0Y2gyKTtcbiAgICBhZGRSZWdleFRva2VuKCdEbycsIGZ1bmN0aW9uIChpc1N0cmljdCwgbG9jYWxlKSB7XG4gICAgICAgIC8vIFRPRE86IFJlbW92ZSBcIm9yZGluYWxQYXJzZVwiIGZhbGxiYWNrIGluIG5leHQgbWFqb3IgcmVsZWFzZS5cbiAgICAgICAgcmV0dXJuIGlzU3RyaWN0XG4gICAgICAgICAgICA/IGxvY2FsZS5fZGF5T2ZNb250aE9yZGluYWxQYXJzZSB8fCBsb2NhbGUuX29yZGluYWxQYXJzZVxuICAgICAgICAgICAgOiBsb2NhbGUuX2RheU9mTW9udGhPcmRpbmFsUGFyc2VMZW5pZW50O1xuICAgIH0pO1xuXG4gICAgYWRkUGFyc2VUb2tlbihbJ0QnLCAnREQnXSwgREFURSk7XG4gICAgYWRkUGFyc2VUb2tlbignRG8nLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5KSB7XG4gICAgICAgIGFycmF5W0RBVEVdID0gdG9JbnQoaW5wdXQubWF0Y2gobWF0Y2gxdG8yKVswXSk7XG4gICAgfSk7XG5cbiAgICAvLyBNT01FTlRTXG5cbiAgICB2YXIgZ2V0U2V0RGF5T2ZNb250aCA9IG1ha2VHZXRTZXQoJ0RhdGUnLCB0cnVlKTtcblxuICAgIC8vIEZPUk1BVFRJTkdcblxuICAgIGFkZEZvcm1hdFRva2VuKCdEREQnLCBbJ0REREQnLCAzXSwgJ0RERG8nLCAnZGF5T2ZZZWFyJyk7XG5cbiAgICAvLyBBTElBU0VTXG5cbiAgICBhZGRVbml0QWxpYXMoJ2RheU9mWWVhcicsICdEREQnKTtcblxuICAgIC8vIFBSSU9SSVRZXG4gICAgYWRkVW5pdFByaW9yaXR5KCdkYXlPZlllYXInLCA0KTtcblxuICAgIC8vIFBBUlNJTkdcblxuICAgIGFkZFJlZ2V4VG9rZW4oJ0RERCcsIG1hdGNoMXRvMyk7XG4gICAgYWRkUmVnZXhUb2tlbignRERERCcsIG1hdGNoMyk7XG4gICAgYWRkUGFyc2VUb2tlbihbJ0RERCcsICdEREREJ10sIGZ1bmN0aW9uIChpbnB1dCwgYXJyYXksIGNvbmZpZykge1xuICAgICAgICBjb25maWcuX2RheU9mWWVhciA9IHRvSW50KGlucHV0KTtcbiAgICB9KTtcblxuICAgIC8vIEhFTFBFUlNcblxuICAgIC8vIE1PTUVOVFNcblxuICAgIGZ1bmN0aW9uIGdldFNldERheU9mWWVhcihpbnB1dCkge1xuICAgICAgICB2YXIgZGF5T2ZZZWFyID1cbiAgICAgICAgICAgIE1hdGgucm91bmQoXG4gICAgICAgICAgICAgICAgKHRoaXMuY2xvbmUoKS5zdGFydE9mKCdkYXknKSAtIHRoaXMuY2xvbmUoKS5zdGFydE9mKCd5ZWFyJykpIC8gODY0ZTVcbiAgICAgICAgICAgICkgKyAxO1xuICAgICAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IGRheU9mWWVhciA6IHRoaXMuYWRkKGlucHV0IC0gZGF5T2ZZZWFyLCAnZCcpO1xuICAgIH1cblxuICAgIC8vIEZPUk1BVFRJTkdcblxuICAgIGFkZEZvcm1hdFRva2VuKCdtJywgWydtbScsIDJdLCAwLCAnbWludXRlJyk7XG5cbiAgICAvLyBBTElBU0VTXG5cbiAgICBhZGRVbml0QWxpYXMoJ21pbnV0ZScsICdtJyk7XG5cbiAgICAvLyBQUklPUklUWVxuXG4gICAgYWRkVW5pdFByaW9yaXR5KCdtaW51dGUnLCAxNCk7XG5cbiAgICAvLyBQQVJTSU5HXG5cbiAgICBhZGRSZWdleFRva2VuKCdtJywgbWF0Y2gxdG8yKTtcbiAgICBhZGRSZWdleFRva2VuKCdtbScsIG1hdGNoMXRvMiwgbWF0Y2gyKTtcbiAgICBhZGRQYXJzZVRva2VuKFsnbScsICdtbSddLCBNSU5VVEUpO1xuXG4gICAgLy8gTU9NRU5UU1xuXG4gICAgdmFyIGdldFNldE1pbnV0ZSA9IG1ha2VHZXRTZXQoJ01pbnV0ZXMnLCBmYWxzZSk7XG5cbiAgICAvLyBGT1JNQVRUSU5HXG5cbiAgICBhZGRGb3JtYXRUb2tlbigncycsIFsnc3MnLCAyXSwgMCwgJ3NlY29uZCcpO1xuXG4gICAgLy8gQUxJQVNFU1xuXG4gICAgYWRkVW5pdEFsaWFzKCdzZWNvbmQnLCAncycpO1xuXG4gICAgLy8gUFJJT1JJVFlcblxuICAgIGFkZFVuaXRQcmlvcml0eSgnc2Vjb25kJywgMTUpO1xuXG4gICAgLy8gUEFSU0lOR1xuXG4gICAgYWRkUmVnZXhUb2tlbigncycsIG1hdGNoMXRvMik7XG4gICAgYWRkUmVnZXhUb2tlbignc3MnLCBtYXRjaDF0bzIsIG1hdGNoMik7XG4gICAgYWRkUGFyc2VUb2tlbihbJ3MnLCAnc3MnXSwgU0VDT05EKTtcblxuICAgIC8vIE1PTUVOVFNcblxuICAgIHZhciBnZXRTZXRTZWNvbmQgPSBtYWtlR2V0U2V0KCdTZWNvbmRzJywgZmFsc2UpO1xuXG4gICAgLy8gRk9STUFUVElOR1xuXG4gICAgYWRkRm9ybWF0VG9rZW4oJ1MnLCAwLCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB+fih0aGlzLm1pbGxpc2Vjb25kKCkgLyAxMDApO1xuICAgIH0pO1xuXG4gICAgYWRkRm9ybWF0VG9rZW4oMCwgWydTUycsIDJdLCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB+fih0aGlzLm1pbGxpc2Vjb25kKCkgLyAxMCk7XG4gICAgfSk7XG5cbiAgICBhZGRGb3JtYXRUb2tlbigwLCBbJ1NTUycsIDNdLCAwLCAnbWlsbGlzZWNvbmQnKTtcbiAgICBhZGRGb3JtYXRUb2tlbigwLCBbJ1NTU1MnLCA0XSwgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5taWxsaXNlY29uZCgpICogMTA7XG4gICAgfSk7XG4gICAgYWRkRm9ybWF0VG9rZW4oMCwgWydTU1NTUycsIDVdLCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1pbGxpc2Vjb25kKCkgKiAxMDA7XG4gICAgfSk7XG4gICAgYWRkRm9ybWF0VG9rZW4oMCwgWydTU1NTU1MnLCA2XSwgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5taWxsaXNlY29uZCgpICogMTAwMDtcbiAgICB9KTtcbiAgICBhZGRGb3JtYXRUb2tlbigwLCBbJ1NTU1NTU1MnLCA3XSwgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5taWxsaXNlY29uZCgpICogMTAwMDA7XG4gICAgfSk7XG4gICAgYWRkRm9ybWF0VG9rZW4oMCwgWydTU1NTU1NTUycsIDhdLCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1pbGxpc2Vjb25kKCkgKiAxMDAwMDA7XG4gICAgfSk7XG4gICAgYWRkRm9ybWF0VG9rZW4oMCwgWydTU1NTU1NTU1MnLCA5XSwgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5taWxsaXNlY29uZCgpICogMTAwMDAwMDtcbiAgICB9KTtcblxuICAgIC8vIEFMSUFTRVNcblxuICAgIGFkZFVuaXRBbGlhcygnbWlsbGlzZWNvbmQnLCAnbXMnKTtcblxuICAgIC8vIFBSSU9SSVRZXG5cbiAgICBhZGRVbml0UHJpb3JpdHkoJ21pbGxpc2Vjb25kJywgMTYpO1xuXG4gICAgLy8gUEFSU0lOR1xuXG4gICAgYWRkUmVnZXhUb2tlbignUycsIG1hdGNoMXRvMywgbWF0Y2gxKTtcbiAgICBhZGRSZWdleFRva2VuKCdTUycsIG1hdGNoMXRvMywgbWF0Y2gyKTtcbiAgICBhZGRSZWdleFRva2VuKCdTU1MnLCBtYXRjaDF0bzMsIG1hdGNoMyk7XG5cbiAgICB2YXIgdG9rZW4sIGdldFNldE1pbGxpc2Vjb25kO1xuICAgIGZvciAodG9rZW4gPSAnU1NTUyc7IHRva2VuLmxlbmd0aCA8PSA5OyB0b2tlbiArPSAnUycpIHtcbiAgICAgICAgYWRkUmVnZXhUb2tlbih0b2tlbiwgbWF0Y2hVbnNpZ25lZCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcGFyc2VNcyhpbnB1dCwgYXJyYXkpIHtcbiAgICAgICAgYXJyYXlbTUlMTElTRUNPTkRdID0gdG9JbnQoKCcwLicgKyBpbnB1dCkgKiAxMDAwKTtcbiAgICB9XG5cbiAgICBmb3IgKHRva2VuID0gJ1MnOyB0b2tlbi5sZW5ndGggPD0gOTsgdG9rZW4gKz0gJ1MnKSB7XG4gICAgICAgIGFkZFBhcnNlVG9rZW4odG9rZW4sIHBhcnNlTXMpO1xuICAgIH1cblxuICAgIGdldFNldE1pbGxpc2Vjb25kID0gbWFrZUdldFNldCgnTWlsbGlzZWNvbmRzJywgZmFsc2UpO1xuXG4gICAgLy8gRk9STUFUVElOR1xuXG4gICAgYWRkRm9ybWF0VG9rZW4oJ3onLCAwLCAwLCAnem9uZUFiYnInKTtcbiAgICBhZGRGb3JtYXRUb2tlbignenonLCAwLCAwLCAnem9uZU5hbWUnKTtcblxuICAgIC8vIE1PTUVOVFNcblxuICAgIGZ1bmN0aW9uIGdldFpvbmVBYmJyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faXNVVEMgPyAnVVRDJyA6ICcnO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFpvbmVOYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faXNVVEMgPyAnQ29vcmRpbmF0ZWQgVW5pdmVyc2FsIFRpbWUnIDogJyc7XG4gICAgfVxuXG4gICAgdmFyIHByb3RvID0gTW9tZW50LnByb3RvdHlwZTtcblxuICAgIHByb3RvLmFkZCA9IGFkZDtcbiAgICBwcm90by5jYWxlbmRhciA9IGNhbGVuZGFyJDE7XG4gICAgcHJvdG8uY2xvbmUgPSBjbG9uZTtcbiAgICBwcm90by5kaWZmID0gZGlmZjtcbiAgICBwcm90by5lbmRPZiA9IGVuZE9mO1xuICAgIHByb3RvLmZvcm1hdCA9IGZvcm1hdDtcbiAgICBwcm90by5mcm9tID0gZnJvbTtcbiAgICBwcm90by5mcm9tTm93ID0gZnJvbU5vdztcbiAgICBwcm90by50byA9IHRvO1xuICAgIHByb3RvLnRvTm93ID0gdG9Ob3c7XG4gICAgcHJvdG8uZ2V0ID0gc3RyaW5nR2V0O1xuICAgIHByb3RvLmludmFsaWRBdCA9IGludmFsaWRBdDtcbiAgICBwcm90by5pc0FmdGVyID0gaXNBZnRlcjtcbiAgICBwcm90by5pc0JlZm9yZSA9IGlzQmVmb3JlO1xuICAgIHByb3RvLmlzQmV0d2VlbiA9IGlzQmV0d2VlbjtcbiAgICBwcm90by5pc1NhbWUgPSBpc1NhbWU7XG4gICAgcHJvdG8uaXNTYW1lT3JBZnRlciA9IGlzU2FtZU9yQWZ0ZXI7XG4gICAgcHJvdG8uaXNTYW1lT3JCZWZvcmUgPSBpc1NhbWVPckJlZm9yZTtcbiAgICBwcm90by5pc1ZhbGlkID0gaXNWYWxpZCQyO1xuICAgIHByb3RvLmxhbmcgPSBsYW5nO1xuICAgIHByb3RvLmxvY2FsZSA9IGxvY2FsZTtcbiAgICBwcm90by5sb2NhbGVEYXRhID0gbG9jYWxlRGF0YTtcbiAgICBwcm90by5tYXggPSBwcm90b3R5cGVNYXg7XG4gICAgcHJvdG8ubWluID0gcHJvdG90eXBlTWluO1xuICAgIHByb3RvLnBhcnNpbmdGbGFncyA9IHBhcnNpbmdGbGFncztcbiAgICBwcm90by5zZXQgPSBzdHJpbmdTZXQ7XG4gICAgcHJvdG8uc3RhcnRPZiA9IHN0YXJ0T2Y7XG4gICAgcHJvdG8uc3VidHJhY3QgPSBzdWJ0cmFjdDtcbiAgICBwcm90by50b0FycmF5ID0gdG9BcnJheTtcbiAgICBwcm90by50b09iamVjdCA9IHRvT2JqZWN0O1xuICAgIHByb3RvLnRvRGF0ZSA9IHRvRGF0ZTtcbiAgICBwcm90by50b0lTT1N0cmluZyA9IHRvSVNPU3RyaW5nO1xuICAgIHByb3RvLmluc3BlY3QgPSBpbnNwZWN0O1xuICAgIGlmICh0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wuZm9yICE9IG51bGwpIHtcbiAgICAgICAgcHJvdG9bU3ltYm9sLmZvcignbm9kZWpzLnV0aWwuaW5zcGVjdC5jdXN0b20nKV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gJ01vbWVudDwnICsgdGhpcy5mb3JtYXQoKSArICc+JztcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcHJvdG8udG9KU09OID0gdG9KU09OO1xuICAgIHByb3RvLnRvU3RyaW5nID0gdG9TdHJpbmc7XG4gICAgcHJvdG8udW5peCA9IHVuaXg7XG4gICAgcHJvdG8udmFsdWVPZiA9IHZhbHVlT2Y7XG4gICAgcHJvdG8uY3JlYXRpb25EYXRhID0gY3JlYXRpb25EYXRhO1xuICAgIHByb3RvLmVyYU5hbWUgPSBnZXRFcmFOYW1lO1xuICAgIHByb3RvLmVyYU5hcnJvdyA9IGdldEVyYU5hcnJvdztcbiAgICBwcm90by5lcmFBYmJyID0gZ2V0RXJhQWJicjtcbiAgICBwcm90by5lcmFZZWFyID0gZ2V0RXJhWWVhcjtcbiAgICBwcm90by55ZWFyID0gZ2V0U2V0WWVhcjtcbiAgICBwcm90by5pc0xlYXBZZWFyID0gZ2V0SXNMZWFwWWVhcjtcbiAgICBwcm90by53ZWVrWWVhciA9IGdldFNldFdlZWtZZWFyO1xuICAgIHByb3RvLmlzb1dlZWtZZWFyID0gZ2V0U2V0SVNPV2Vla1llYXI7XG4gICAgcHJvdG8ucXVhcnRlciA9IHByb3RvLnF1YXJ0ZXJzID0gZ2V0U2V0UXVhcnRlcjtcbiAgICBwcm90by5tb250aCA9IGdldFNldE1vbnRoO1xuICAgIHByb3RvLmRheXNJbk1vbnRoID0gZ2V0RGF5c0luTW9udGg7XG4gICAgcHJvdG8ud2VlayA9IHByb3RvLndlZWtzID0gZ2V0U2V0V2VlaztcbiAgICBwcm90by5pc29XZWVrID0gcHJvdG8uaXNvV2Vla3MgPSBnZXRTZXRJU09XZWVrO1xuICAgIHByb3RvLndlZWtzSW5ZZWFyID0gZ2V0V2Vla3NJblllYXI7XG4gICAgcHJvdG8ud2Vla3NJbldlZWtZZWFyID0gZ2V0V2Vla3NJbldlZWtZZWFyO1xuICAgIHByb3RvLmlzb1dlZWtzSW5ZZWFyID0gZ2V0SVNPV2Vla3NJblllYXI7XG4gICAgcHJvdG8uaXNvV2Vla3NJbklTT1dlZWtZZWFyID0gZ2V0SVNPV2Vla3NJbklTT1dlZWtZZWFyO1xuICAgIHByb3RvLmRhdGUgPSBnZXRTZXREYXlPZk1vbnRoO1xuICAgIHByb3RvLmRheSA9IHByb3RvLmRheXMgPSBnZXRTZXREYXlPZldlZWs7XG4gICAgcHJvdG8ud2Vla2RheSA9IGdldFNldExvY2FsZURheU9mV2VlaztcbiAgICBwcm90by5pc29XZWVrZGF5ID0gZ2V0U2V0SVNPRGF5T2ZXZWVrO1xuICAgIHByb3RvLmRheU9mWWVhciA9IGdldFNldERheU9mWWVhcjtcbiAgICBwcm90by5ob3VyID0gcHJvdG8uaG91cnMgPSBnZXRTZXRIb3VyO1xuICAgIHByb3RvLm1pbnV0ZSA9IHByb3RvLm1pbnV0ZXMgPSBnZXRTZXRNaW51dGU7XG4gICAgcHJvdG8uc2Vjb25kID0gcHJvdG8uc2Vjb25kcyA9IGdldFNldFNlY29uZDtcbiAgICBwcm90by5taWxsaXNlY29uZCA9IHByb3RvLm1pbGxpc2Vjb25kcyA9IGdldFNldE1pbGxpc2Vjb25kO1xuICAgIHByb3RvLnV0Y09mZnNldCA9IGdldFNldE9mZnNldDtcbiAgICBwcm90by51dGMgPSBzZXRPZmZzZXRUb1VUQztcbiAgICBwcm90by5sb2NhbCA9IHNldE9mZnNldFRvTG9jYWw7XG4gICAgcHJvdG8ucGFyc2Vab25lID0gc2V0T2Zmc2V0VG9QYXJzZWRPZmZzZXQ7XG4gICAgcHJvdG8uaGFzQWxpZ25lZEhvdXJPZmZzZXQgPSBoYXNBbGlnbmVkSG91ck9mZnNldDtcbiAgICBwcm90by5pc0RTVCA9IGlzRGF5bGlnaHRTYXZpbmdUaW1lO1xuICAgIHByb3RvLmlzTG9jYWwgPSBpc0xvY2FsO1xuICAgIHByb3RvLmlzVXRjT2Zmc2V0ID0gaXNVdGNPZmZzZXQ7XG4gICAgcHJvdG8uaXNVdGMgPSBpc1V0YztcbiAgICBwcm90by5pc1VUQyA9IGlzVXRjO1xuICAgIHByb3RvLnpvbmVBYmJyID0gZ2V0Wm9uZUFiYnI7XG4gICAgcHJvdG8uem9uZU5hbWUgPSBnZXRab25lTmFtZTtcbiAgICBwcm90by5kYXRlcyA9IGRlcHJlY2F0ZShcbiAgICAgICAgJ2RhdGVzIGFjY2Vzc29yIGlzIGRlcHJlY2F0ZWQuIFVzZSBkYXRlIGluc3RlYWQuJyxcbiAgICAgICAgZ2V0U2V0RGF5T2ZNb250aFxuICAgICk7XG4gICAgcHJvdG8ubW9udGhzID0gZGVwcmVjYXRlKFxuICAgICAgICAnbW9udGhzIGFjY2Vzc29yIGlzIGRlcHJlY2F0ZWQuIFVzZSBtb250aCBpbnN0ZWFkJyxcbiAgICAgICAgZ2V0U2V0TW9udGhcbiAgICApO1xuICAgIHByb3RvLnllYXJzID0gZGVwcmVjYXRlKFxuICAgICAgICAneWVhcnMgYWNjZXNzb3IgaXMgZGVwcmVjYXRlZC4gVXNlIHllYXIgaW5zdGVhZCcsXG4gICAgICAgIGdldFNldFllYXJcbiAgICApO1xuICAgIHByb3RvLnpvbmUgPSBkZXByZWNhdGUoXG4gICAgICAgICdtb21lbnQoKS56b25lIGlzIGRlcHJlY2F0ZWQsIHVzZSBtb21lbnQoKS51dGNPZmZzZXQgaW5zdGVhZC4gaHR0cDovL21vbWVudGpzLmNvbS9ndWlkZXMvIy93YXJuaW5ncy96b25lLycsXG4gICAgICAgIGdldFNldFpvbmVcbiAgICApO1xuICAgIHByb3RvLmlzRFNUU2hpZnRlZCA9IGRlcHJlY2F0ZShcbiAgICAgICAgJ2lzRFNUU2hpZnRlZCBpcyBkZXByZWNhdGVkLiBTZWUgaHR0cDovL21vbWVudGpzLmNvbS9ndWlkZXMvIy93YXJuaW5ncy9kc3Qtc2hpZnRlZC8gZm9yIG1vcmUgaW5mb3JtYXRpb24nLFxuICAgICAgICBpc0RheWxpZ2h0U2F2aW5nVGltZVNoaWZ0ZWRcbiAgICApO1xuXG4gICAgZnVuY3Rpb24gY3JlYXRlVW5peChpbnB1dCkge1xuICAgICAgICByZXR1cm4gY3JlYXRlTG9jYWwoaW5wdXQgKiAxMDAwKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVJblpvbmUoKSB7XG4gICAgICAgIHJldHVybiBjcmVhdGVMb2NhbC5hcHBseShudWxsLCBhcmd1bWVudHMpLnBhcnNlWm9uZSgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHByZVBhcnNlUG9zdEZvcm1hdChzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZztcbiAgICB9XG5cbiAgICB2YXIgcHJvdG8kMSA9IExvY2FsZS5wcm90b3R5cGU7XG5cbiAgICBwcm90byQxLmNhbGVuZGFyID0gY2FsZW5kYXI7XG4gICAgcHJvdG8kMS5sb25nRGF0ZUZvcm1hdCA9IGxvbmdEYXRlRm9ybWF0O1xuICAgIHByb3RvJDEuaW52YWxpZERhdGUgPSBpbnZhbGlkRGF0ZTtcbiAgICBwcm90byQxLm9yZGluYWwgPSBvcmRpbmFsO1xuICAgIHByb3RvJDEucHJlcGFyc2UgPSBwcmVQYXJzZVBvc3RGb3JtYXQ7XG4gICAgcHJvdG8kMS5wb3N0Zm9ybWF0ID0gcHJlUGFyc2VQb3N0Rm9ybWF0O1xuICAgIHByb3RvJDEucmVsYXRpdmVUaW1lID0gcmVsYXRpdmVUaW1lO1xuICAgIHByb3RvJDEucGFzdEZ1dHVyZSA9IHBhc3RGdXR1cmU7XG4gICAgcHJvdG8kMS5zZXQgPSBzZXQ7XG4gICAgcHJvdG8kMS5lcmFzID0gbG9jYWxlRXJhcztcbiAgICBwcm90byQxLmVyYXNQYXJzZSA9IGxvY2FsZUVyYXNQYXJzZTtcbiAgICBwcm90byQxLmVyYXNDb252ZXJ0WWVhciA9IGxvY2FsZUVyYXNDb252ZXJ0WWVhcjtcbiAgICBwcm90byQxLmVyYXNBYmJyUmVnZXggPSBlcmFzQWJiclJlZ2V4O1xuICAgIHByb3RvJDEuZXJhc05hbWVSZWdleCA9IGVyYXNOYW1lUmVnZXg7XG4gICAgcHJvdG8kMS5lcmFzTmFycm93UmVnZXggPSBlcmFzTmFycm93UmVnZXg7XG5cbiAgICBwcm90byQxLm1vbnRocyA9IGxvY2FsZU1vbnRocztcbiAgICBwcm90byQxLm1vbnRoc1Nob3J0ID0gbG9jYWxlTW9udGhzU2hvcnQ7XG4gICAgcHJvdG8kMS5tb250aHNQYXJzZSA9IGxvY2FsZU1vbnRoc1BhcnNlO1xuICAgIHByb3RvJDEubW9udGhzUmVnZXggPSBtb250aHNSZWdleDtcbiAgICBwcm90byQxLm1vbnRoc1Nob3J0UmVnZXggPSBtb250aHNTaG9ydFJlZ2V4O1xuICAgIHByb3RvJDEud2VlayA9IGxvY2FsZVdlZWs7XG4gICAgcHJvdG8kMS5maXJzdERheU9mWWVhciA9IGxvY2FsZUZpcnN0RGF5T2ZZZWFyO1xuICAgIHByb3RvJDEuZmlyc3REYXlPZldlZWsgPSBsb2NhbGVGaXJzdERheU9mV2VlaztcblxuICAgIHByb3RvJDEud2Vla2RheXMgPSBsb2NhbGVXZWVrZGF5cztcbiAgICBwcm90byQxLndlZWtkYXlzTWluID0gbG9jYWxlV2Vla2RheXNNaW47XG4gICAgcHJvdG8kMS53ZWVrZGF5c1Nob3J0ID0gbG9jYWxlV2Vla2RheXNTaG9ydDtcbiAgICBwcm90byQxLndlZWtkYXlzUGFyc2UgPSBsb2NhbGVXZWVrZGF5c1BhcnNlO1xuXG4gICAgcHJvdG8kMS53ZWVrZGF5c1JlZ2V4ID0gd2Vla2RheXNSZWdleDtcbiAgICBwcm90byQxLndlZWtkYXlzU2hvcnRSZWdleCA9IHdlZWtkYXlzU2hvcnRSZWdleDtcbiAgICBwcm90byQxLndlZWtkYXlzTWluUmVnZXggPSB3ZWVrZGF5c01pblJlZ2V4O1xuXG4gICAgcHJvdG8kMS5pc1BNID0gbG9jYWxlSXNQTTtcbiAgICBwcm90byQxLm1lcmlkaWVtID0gbG9jYWxlTWVyaWRpZW07XG5cbiAgICBmdW5jdGlvbiBnZXQkMShmb3JtYXQsIGluZGV4LCBmaWVsZCwgc2V0dGVyKSB7XG4gICAgICAgIHZhciBsb2NhbGUgPSBnZXRMb2NhbGUoKSxcbiAgICAgICAgICAgIHV0YyA9IGNyZWF0ZVVUQygpLnNldChzZXR0ZXIsIGluZGV4KTtcbiAgICAgICAgcmV0dXJuIGxvY2FsZVtmaWVsZF0odXRjLCBmb3JtYXQpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxpc3RNb250aHNJbXBsKGZvcm1hdCwgaW5kZXgsIGZpZWxkKSB7XG4gICAgICAgIGlmIChpc051bWJlcihmb3JtYXQpKSB7XG4gICAgICAgICAgICBpbmRleCA9IGZvcm1hdDtcbiAgICAgICAgICAgIGZvcm1hdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvcm1hdCA9IGZvcm1hdCB8fCAnJztcblxuICAgICAgICBpZiAoaW5kZXggIT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIGdldCQxKGZvcm1hdCwgaW5kZXgsIGZpZWxkLCAnbW9udGgnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBpLFxuICAgICAgICAgICAgb3V0ID0gW107XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCAxMjsgaSsrKSB7XG4gICAgICAgICAgICBvdXRbaV0gPSBnZXQkMShmb3JtYXQsIGksIGZpZWxkLCAnbW9udGgnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3V0O1xuICAgIH1cblxuICAgIC8vICgpXG4gICAgLy8gKDUpXG4gICAgLy8gKGZtdCwgNSlcbiAgICAvLyAoZm10KVxuICAgIC8vICh0cnVlKVxuICAgIC8vICh0cnVlLCA1KVxuICAgIC8vICh0cnVlLCBmbXQsIDUpXG4gICAgLy8gKHRydWUsIGZtdClcbiAgICBmdW5jdGlvbiBsaXN0V2Vla2RheXNJbXBsKGxvY2FsZVNvcnRlZCwgZm9ybWF0LCBpbmRleCwgZmllbGQpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBsb2NhbGVTb3J0ZWQgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgaWYgKGlzTnVtYmVyKGZvcm1hdCkpIHtcbiAgICAgICAgICAgICAgICBpbmRleCA9IGZvcm1hdDtcbiAgICAgICAgICAgICAgICBmb3JtYXQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZvcm1hdCA9IGZvcm1hdCB8fCAnJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvcm1hdCA9IGxvY2FsZVNvcnRlZDtcbiAgICAgICAgICAgIGluZGV4ID0gZm9ybWF0O1xuICAgICAgICAgICAgbG9jYWxlU29ydGVkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmIChpc051bWJlcihmb3JtYXQpKSB7XG4gICAgICAgICAgICAgICAgaW5kZXggPSBmb3JtYXQ7XG4gICAgICAgICAgICAgICAgZm9ybWF0ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3JtYXQgPSBmb3JtYXQgfHwgJyc7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbG9jYWxlID0gZ2V0TG9jYWxlKCksXG4gICAgICAgICAgICBzaGlmdCA9IGxvY2FsZVNvcnRlZCA/IGxvY2FsZS5fd2Vlay5kb3cgOiAwLFxuICAgICAgICAgICAgaSxcbiAgICAgICAgICAgIG91dCA9IFtdO1xuXG4gICAgICAgIGlmIChpbmRleCAhPSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0JDEoZm9ybWF0LCAoaW5kZXggKyBzaGlmdCkgJSA3LCBmaWVsZCwgJ2RheScpO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChpID0gMDsgaSA8IDc7IGkrKykge1xuICAgICAgICAgICAgb3V0W2ldID0gZ2V0JDEoZm9ybWF0LCAoaSArIHNoaWZ0KSAlIDcsIGZpZWxkLCAnZGF5Jyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsaXN0TW9udGhzKGZvcm1hdCwgaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIGxpc3RNb250aHNJbXBsKGZvcm1hdCwgaW5kZXgsICdtb250aHMnKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsaXN0TW9udGhzU2hvcnQoZm9ybWF0LCBpbmRleCkge1xuICAgICAgICByZXR1cm4gbGlzdE1vbnRoc0ltcGwoZm9ybWF0LCBpbmRleCwgJ21vbnRoc1Nob3J0Jyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbGlzdFdlZWtkYXlzKGxvY2FsZVNvcnRlZCwgZm9ybWF0LCBpbmRleCkge1xuICAgICAgICByZXR1cm4gbGlzdFdlZWtkYXlzSW1wbChsb2NhbGVTb3J0ZWQsIGZvcm1hdCwgaW5kZXgsICd3ZWVrZGF5cycpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxpc3RXZWVrZGF5c1Nob3J0KGxvY2FsZVNvcnRlZCwgZm9ybWF0LCBpbmRleCkge1xuICAgICAgICByZXR1cm4gbGlzdFdlZWtkYXlzSW1wbChsb2NhbGVTb3J0ZWQsIGZvcm1hdCwgaW5kZXgsICd3ZWVrZGF5c1Nob3J0Jyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbGlzdFdlZWtkYXlzTWluKGxvY2FsZVNvcnRlZCwgZm9ybWF0LCBpbmRleCkge1xuICAgICAgICByZXR1cm4gbGlzdFdlZWtkYXlzSW1wbChsb2NhbGVTb3J0ZWQsIGZvcm1hdCwgaW5kZXgsICd3ZWVrZGF5c01pbicpO1xuICAgIH1cblxuICAgIGdldFNldEdsb2JhbExvY2FsZSgnZW4nLCB7XG4gICAgICAgIGVyYXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzaW5jZTogJzAwMDEtMDEtMDEnLFxuICAgICAgICAgICAgICAgIHVudGlsOiArSW5maW5pdHksXG4gICAgICAgICAgICAgICAgb2Zmc2V0OiAxLFxuICAgICAgICAgICAgICAgIG5hbWU6ICdBbm5vIERvbWluaScsXG4gICAgICAgICAgICAgICAgbmFycm93OiAnQUQnLFxuICAgICAgICAgICAgICAgIGFiYnI6ICdBRCcsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHNpbmNlOiAnMDAwMC0xMi0zMScsXG4gICAgICAgICAgICAgICAgdW50aWw6IC1JbmZpbml0eSxcbiAgICAgICAgICAgICAgICBvZmZzZXQ6IDEsXG4gICAgICAgICAgICAgICAgbmFtZTogJ0JlZm9yZSBDaHJpc3QnLFxuICAgICAgICAgICAgICAgIG5hcnJvdzogJ0JDJyxcbiAgICAgICAgICAgICAgICBhYmJyOiAnQkMnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgZGF5T2ZNb250aE9yZGluYWxQYXJzZTogL1xcZHsxLDJ9KHRofHN0fG5kfHJkKS8sXG4gICAgICAgIG9yZGluYWw6IGZ1bmN0aW9uIChudW1iZXIpIHtcbiAgICAgICAgICAgIHZhciBiID0gbnVtYmVyICUgMTAsXG4gICAgICAgICAgICAgICAgb3V0cHV0ID1cbiAgICAgICAgICAgICAgICAgICAgdG9JbnQoKG51bWJlciAlIDEwMCkgLyAxMCkgPT09IDFcbiAgICAgICAgICAgICAgICAgICAgICAgID8gJ3RoJ1xuICAgICAgICAgICAgICAgICAgICAgICAgOiBiID09PSAxXG4gICAgICAgICAgICAgICAgICAgICAgICA/ICdzdCdcbiAgICAgICAgICAgICAgICAgICAgICAgIDogYiA9PT0gMlxuICAgICAgICAgICAgICAgICAgICAgICAgPyAnbmQnXG4gICAgICAgICAgICAgICAgICAgICAgICA6IGIgPT09IDNcbiAgICAgICAgICAgICAgICAgICAgICAgID8gJ3JkJ1xuICAgICAgICAgICAgICAgICAgICAgICAgOiAndGgnO1xuICAgICAgICAgICAgcmV0dXJuIG51bWJlciArIG91dHB1dDtcbiAgICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFNpZGUgZWZmZWN0IGltcG9ydHNcblxuICAgIGhvb2tzLmxhbmcgPSBkZXByZWNhdGUoXG4gICAgICAgICdtb21lbnQubGFuZyBpcyBkZXByZWNhdGVkLiBVc2UgbW9tZW50LmxvY2FsZSBpbnN0ZWFkLicsXG4gICAgICAgIGdldFNldEdsb2JhbExvY2FsZVxuICAgICk7XG4gICAgaG9va3MubGFuZ0RhdGEgPSBkZXByZWNhdGUoXG4gICAgICAgICdtb21lbnQubGFuZ0RhdGEgaXMgZGVwcmVjYXRlZC4gVXNlIG1vbWVudC5sb2NhbGVEYXRhIGluc3RlYWQuJyxcbiAgICAgICAgZ2V0TG9jYWxlXG4gICAgKTtcblxuICAgIHZhciBtYXRoQWJzID0gTWF0aC5hYnM7XG5cbiAgICBmdW5jdGlvbiBhYnMoKSB7XG4gICAgICAgIHZhciBkYXRhID0gdGhpcy5fZGF0YTtcblxuICAgICAgICB0aGlzLl9taWxsaXNlY29uZHMgPSBtYXRoQWJzKHRoaXMuX21pbGxpc2Vjb25kcyk7XG4gICAgICAgIHRoaXMuX2RheXMgPSBtYXRoQWJzKHRoaXMuX2RheXMpO1xuICAgICAgICB0aGlzLl9tb250aHMgPSBtYXRoQWJzKHRoaXMuX21vbnRocyk7XG5cbiAgICAgICAgZGF0YS5taWxsaXNlY29uZHMgPSBtYXRoQWJzKGRhdGEubWlsbGlzZWNvbmRzKTtcbiAgICAgICAgZGF0YS5zZWNvbmRzID0gbWF0aEFicyhkYXRhLnNlY29uZHMpO1xuICAgICAgICBkYXRhLm1pbnV0ZXMgPSBtYXRoQWJzKGRhdGEubWludXRlcyk7XG4gICAgICAgIGRhdGEuaG91cnMgPSBtYXRoQWJzKGRhdGEuaG91cnMpO1xuICAgICAgICBkYXRhLm1vbnRocyA9IG1hdGhBYnMoZGF0YS5tb250aHMpO1xuICAgICAgICBkYXRhLnllYXJzID0gbWF0aEFicyhkYXRhLnllYXJzKTtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhZGRTdWJ0cmFjdCQxKGR1cmF0aW9uLCBpbnB1dCwgdmFsdWUsIGRpcmVjdGlvbikge1xuICAgICAgICB2YXIgb3RoZXIgPSBjcmVhdGVEdXJhdGlvbihpbnB1dCwgdmFsdWUpO1xuXG4gICAgICAgIGR1cmF0aW9uLl9taWxsaXNlY29uZHMgKz0gZGlyZWN0aW9uICogb3RoZXIuX21pbGxpc2Vjb25kcztcbiAgICAgICAgZHVyYXRpb24uX2RheXMgKz0gZGlyZWN0aW9uICogb3RoZXIuX2RheXM7XG4gICAgICAgIGR1cmF0aW9uLl9tb250aHMgKz0gZGlyZWN0aW9uICogb3RoZXIuX21vbnRocztcblxuICAgICAgICByZXR1cm4gZHVyYXRpb24uX2J1YmJsZSgpO1xuICAgIH1cblxuICAgIC8vIHN1cHBvcnRzIG9ubHkgMi4wLXN0eWxlIGFkZCgxLCAncycpIG9yIGFkZChkdXJhdGlvbilcbiAgICBmdW5jdGlvbiBhZGQkMShpbnB1dCwgdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIGFkZFN1YnRyYWN0JDEodGhpcywgaW5wdXQsIHZhbHVlLCAxKTtcbiAgICB9XG5cbiAgICAvLyBzdXBwb3J0cyBvbmx5IDIuMC1zdHlsZSBzdWJ0cmFjdCgxLCAncycpIG9yIHN1YnRyYWN0KGR1cmF0aW9uKVxuICAgIGZ1bmN0aW9uIHN1YnRyYWN0JDEoaW5wdXQsIHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBhZGRTdWJ0cmFjdCQxKHRoaXMsIGlucHV0LCB2YWx1ZSwgLTEpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFic0NlaWwobnVtYmVyKSB7XG4gICAgICAgIGlmIChudW1iZXIgPCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihudW1iZXIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIE1hdGguY2VpbChudW1iZXIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYnViYmxlKCkge1xuICAgICAgICB2YXIgbWlsbGlzZWNvbmRzID0gdGhpcy5fbWlsbGlzZWNvbmRzLFxuICAgICAgICAgICAgZGF5cyA9IHRoaXMuX2RheXMsXG4gICAgICAgICAgICBtb250aHMgPSB0aGlzLl9tb250aHMsXG4gICAgICAgICAgICBkYXRhID0gdGhpcy5fZGF0YSxcbiAgICAgICAgICAgIHNlY29uZHMsXG4gICAgICAgICAgICBtaW51dGVzLFxuICAgICAgICAgICAgaG91cnMsXG4gICAgICAgICAgICB5ZWFycyxcbiAgICAgICAgICAgIG1vbnRoc0Zyb21EYXlzO1xuXG4gICAgICAgIC8vIGlmIHdlIGhhdmUgYSBtaXggb2YgcG9zaXRpdmUgYW5kIG5lZ2F0aXZlIHZhbHVlcywgYnViYmxlIGRvd24gZmlyc3RcbiAgICAgICAgLy8gY2hlY2s6IGh0dHBzOi8vZ2l0aHViLmNvbS9tb21lbnQvbW9tZW50L2lzc3Vlcy8yMTY2XG4gICAgICAgIGlmIChcbiAgICAgICAgICAgICEoXG4gICAgICAgICAgICAgICAgKG1pbGxpc2Vjb25kcyA+PSAwICYmIGRheXMgPj0gMCAmJiBtb250aHMgPj0gMCkgfHxcbiAgICAgICAgICAgICAgICAobWlsbGlzZWNvbmRzIDw9IDAgJiYgZGF5cyA8PSAwICYmIG1vbnRocyA8PSAwKVxuICAgICAgICAgICAgKVxuICAgICAgICApIHtcbiAgICAgICAgICAgIG1pbGxpc2Vjb25kcyArPSBhYnNDZWlsKG1vbnRoc1RvRGF5cyhtb250aHMpICsgZGF5cykgKiA4NjRlNTtcbiAgICAgICAgICAgIGRheXMgPSAwO1xuICAgICAgICAgICAgbW9udGhzID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgY29kZSBidWJibGVzIHVwIHZhbHVlcywgc2VlIHRoZSB0ZXN0cyBmb3JcbiAgICAgICAgLy8gZXhhbXBsZXMgb2Ygd2hhdCB0aGF0IG1lYW5zLlxuICAgICAgICBkYXRhLm1pbGxpc2Vjb25kcyA9IG1pbGxpc2Vjb25kcyAlIDEwMDA7XG5cbiAgICAgICAgc2Vjb25kcyA9IGFic0Zsb29yKG1pbGxpc2Vjb25kcyAvIDEwMDApO1xuICAgICAgICBkYXRhLnNlY29uZHMgPSBzZWNvbmRzICUgNjA7XG5cbiAgICAgICAgbWludXRlcyA9IGFic0Zsb29yKHNlY29uZHMgLyA2MCk7XG4gICAgICAgIGRhdGEubWludXRlcyA9IG1pbnV0ZXMgJSA2MDtcblxuICAgICAgICBob3VycyA9IGFic0Zsb29yKG1pbnV0ZXMgLyA2MCk7XG4gICAgICAgIGRhdGEuaG91cnMgPSBob3VycyAlIDI0O1xuXG4gICAgICAgIGRheXMgKz0gYWJzRmxvb3IoaG91cnMgLyAyNCk7XG5cbiAgICAgICAgLy8gY29udmVydCBkYXlzIHRvIG1vbnRoc1xuICAgICAgICBtb250aHNGcm9tRGF5cyA9IGFic0Zsb29yKGRheXNUb01vbnRocyhkYXlzKSk7XG4gICAgICAgIG1vbnRocyArPSBtb250aHNGcm9tRGF5cztcbiAgICAgICAgZGF5cyAtPSBhYnNDZWlsKG1vbnRoc1RvRGF5cyhtb250aHNGcm9tRGF5cykpO1xuXG4gICAgICAgIC8vIDEyIG1vbnRocyAtPiAxIHllYXJcbiAgICAgICAgeWVhcnMgPSBhYnNGbG9vcihtb250aHMgLyAxMik7XG4gICAgICAgIG1vbnRocyAlPSAxMjtcblxuICAgICAgICBkYXRhLmRheXMgPSBkYXlzO1xuICAgICAgICBkYXRhLm1vbnRocyA9IG1vbnRocztcbiAgICAgICAgZGF0YS55ZWFycyA9IHllYXJzO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRheXNUb01vbnRocyhkYXlzKSB7XG4gICAgICAgIC8vIDQwMCB5ZWFycyBoYXZlIDE0NjA5NyBkYXlzICh0YWtpbmcgaW50byBhY2NvdW50IGxlYXAgeWVhciBydWxlcylcbiAgICAgICAgLy8gNDAwIHllYXJzIGhhdmUgMTIgbW9udGhzID09PSA0ODAwXG4gICAgICAgIHJldHVybiAoZGF5cyAqIDQ4MDApIC8gMTQ2MDk3O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1vbnRoc1RvRGF5cyhtb250aHMpIHtcbiAgICAgICAgLy8gdGhlIHJldmVyc2Ugb2YgZGF5c1RvTW9udGhzXG4gICAgICAgIHJldHVybiAobW9udGhzICogMTQ2MDk3KSAvIDQ4MDA7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYXModW5pdHMpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzVmFsaWQoKSkge1xuICAgICAgICAgICAgcmV0dXJuIE5hTjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZGF5cyxcbiAgICAgICAgICAgIG1vbnRocyxcbiAgICAgICAgICAgIG1pbGxpc2Vjb25kcyA9IHRoaXMuX21pbGxpc2Vjb25kcztcblxuICAgICAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHVuaXRzKTtcblxuICAgICAgICBpZiAodW5pdHMgPT09ICdtb250aCcgfHwgdW5pdHMgPT09ICdxdWFydGVyJyB8fCB1bml0cyA9PT0gJ3llYXInKSB7XG4gICAgICAgICAgICBkYXlzID0gdGhpcy5fZGF5cyArIG1pbGxpc2Vjb25kcyAvIDg2NGU1O1xuICAgICAgICAgICAgbW9udGhzID0gdGhpcy5fbW9udGhzICsgZGF5c1RvTW9udGhzKGRheXMpO1xuICAgICAgICAgICAgc3dpdGNoICh1bml0cykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ21vbnRoJzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vbnRocztcbiAgICAgICAgICAgICAgICBjYXNlICdxdWFydGVyJzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vbnRocyAvIDM7XG4gICAgICAgICAgICAgICAgY2FzZSAneWVhcic6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtb250aHMgLyAxMjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGhhbmRsZSBtaWxsaXNlY29uZHMgc2VwYXJhdGVseSBiZWNhdXNlIG9mIGZsb2F0aW5nIHBvaW50IG1hdGggZXJyb3JzIChpc3N1ZSAjMTg2NylcbiAgICAgICAgICAgIGRheXMgPSB0aGlzLl9kYXlzICsgTWF0aC5yb3VuZChtb250aHNUb0RheXModGhpcy5fbW9udGhzKSk7XG4gICAgICAgICAgICBzd2l0Y2ggKHVuaXRzKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnd2Vlayc6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXlzIC8gNyArIG1pbGxpc2Vjb25kcyAvIDYwNDhlNTtcbiAgICAgICAgICAgICAgICBjYXNlICdkYXknOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF5cyArIG1pbGxpc2Vjb25kcyAvIDg2NGU1O1xuICAgICAgICAgICAgICAgIGNhc2UgJ2hvdXInOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF5cyAqIDI0ICsgbWlsbGlzZWNvbmRzIC8gMzZlNTtcbiAgICAgICAgICAgICAgICBjYXNlICdtaW51dGUnOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF5cyAqIDE0NDAgKyBtaWxsaXNlY29uZHMgLyA2ZTQ7XG4gICAgICAgICAgICAgICAgY2FzZSAnc2Vjb25kJzpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRheXMgKiA4NjQwMCArIG1pbGxpc2Vjb25kcyAvIDEwMDA7XG4gICAgICAgICAgICAgICAgLy8gTWF0aC5mbG9vciBwcmV2ZW50cyBmbG9hdGluZyBwb2ludCBtYXRoIGVycm9ycyBoZXJlXG4gICAgICAgICAgICAgICAgY2FzZSAnbWlsbGlzZWNvbmQnOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihkYXlzICogODY0ZTUpICsgbWlsbGlzZWNvbmRzO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biB1bml0ICcgKyB1bml0cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBUT0RPOiBVc2UgdGhpcy5hcygnbXMnKT9cbiAgICBmdW5jdGlvbiB2YWx1ZU9mJDEoKSB7XG4gICAgICAgIGlmICghdGhpcy5pc1ZhbGlkKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBOYU47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIHRoaXMuX21pbGxpc2Vjb25kcyArXG4gICAgICAgICAgICB0aGlzLl9kYXlzICogODY0ZTUgK1xuICAgICAgICAgICAgKHRoaXMuX21vbnRocyAlIDEyKSAqIDI1OTJlNiArXG4gICAgICAgICAgICB0b0ludCh0aGlzLl9tb250aHMgLyAxMikgKiAzMTUzNmU2XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWFrZUFzKGFsaWFzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hcyhhbGlhcyk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgdmFyIGFzTWlsbGlzZWNvbmRzID0gbWFrZUFzKCdtcycpLFxuICAgICAgICBhc1NlY29uZHMgPSBtYWtlQXMoJ3MnKSxcbiAgICAgICAgYXNNaW51dGVzID0gbWFrZUFzKCdtJyksXG4gICAgICAgIGFzSG91cnMgPSBtYWtlQXMoJ2gnKSxcbiAgICAgICAgYXNEYXlzID0gbWFrZUFzKCdkJyksXG4gICAgICAgIGFzV2Vla3MgPSBtYWtlQXMoJ3cnKSxcbiAgICAgICAgYXNNb250aHMgPSBtYWtlQXMoJ00nKSxcbiAgICAgICAgYXNRdWFydGVycyA9IG1ha2VBcygnUScpLFxuICAgICAgICBhc1llYXJzID0gbWFrZUFzKCd5Jyk7XG5cbiAgICBmdW5jdGlvbiBjbG9uZSQxKCkge1xuICAgICAgICByZXR1cm4gY3JlYXRlRHVyYXRpb24odGhpcyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0JDIodW5pdHMpIHtcbiAgICAgICAgdW5pdHMgPSBub3JtYWxpemVVbml0cyh1bml0cyk7XG4gICAgICAgIHJldHVybiB0aGlzLmlzVmFsaWQoKSA/IHRoaXNbdW5pdHMgKyAncyddKCkgOiBOYU47XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWFrZUdldHRlcihuYW1lKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pc1ZhbGlkKCkgPyB0aGlzLl9kYXRhW25hbWVdIDogTmFOO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIHZhciBtaWxsaXNlY29uZHMgPSBtYWtlR2V0dGVyKCdtaWxsaXNlY29uZHMnKSxcbiAgICAgICAgc2Vjb25kcyA9IG1ha2VHZXR0ZXIoJ3NlY29uZHMnKSxcbiAgICAgICAgbWludXRlcyA9IG1ha2VHZXR0ZXIoJ21pbnV0ZXMnKSxcbiAgICAgICAgaG91cnMgPSBtYWtlR2V0dGVyKCdob3VycycpLFxuICAgICAgICBkYXlzID0gbWFrZUdldHRlcignZGF5cycpLFxuICAgICAgICBtb250aHMgPSBtYWtlR2V0dGVyKCdtb250aHMnKSxcbiAgICAgICAgeWVhcnMgPSBtYWtlR2V0dGVyKCd5ZWFycycpO1xuXG4gICAgZnVuY3Rpb24gd2Vla3MoKSB7XG4gICAgICAgIHJldHVybiBhYnNGbG9vcih0aGlzLmRheXMoKSAvIDcpO1xuICAgIH1cblxuICAgIHZhciByb3VuZCA9IE1hdGgucm91bmQsXG4gICAgICAgIHRocmVzaG9sZHMgPSB7XG4gICAgICAgICAgICBzczogNDQsIC8vIGEgZmV3IHNlY29uZHMgdG8gc2Vjb25kc1xuICAgICAgICAgICAgczogNDUsIC8vIHNlY29uZHMgdG8gbWludXRlXG4gICAgICAgICAgICBtOiA0NSwgLy8gbWludXRlcyB0byBob3VyXG4gICAgICAgICAgICBoOiAyMiwgLy8gaG91cnMgdG8gZGF5XG4gICAgICAgICAgICBkOiAyNiwgLy8gZGF5cyB0byBtb250aC93ZWVrXG4gICAgICAgICAgICB3OiBudWxsLCAvLyB3ZWVrcyB0byBtb250aFxuICAgICAgICAgICAgTTogMTEsIC8vIG1vbnRocyB0byB5ZWFyXG4gICAgICAgIH07XG5cbiAgICAvLyBoZWxwZXIgZnVuY3Rpb24gZm9yIG1vbWVudC5mbi5mcm9tLCBtb21lbnQuZm4uZnJvbU5vdywgYW5kIG1vbWVudC5kdXJhdGlvbi5mbi5odW1hbml6ZVxuICAgIGZ1bmN0aW9uIHN1YnN0aXR1dGVUaW1lQWdvKHN0cmluZywgbnVtYmVyLCB3aXRob3V0U3VmZml4LCBpc0Z1dHVyZSwgbG9jYWxlKSB7XG4gICAgICAgIHJldHVybiBsb2NhbGUucmVsYXRpdmVUaW1lKG51bWJlciB8fCAxLCAhIXdpdGhvdXRTdWZmaXgsIHN0cmluZywgaXNGdXR1cmUpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlbGF0aXZlVGltZSQxKHBvc05lZ0R1cmF0aW9uLCB3aXRob3V0U3VmZml4LCB0aHJlc2hvbGRzLCBsb2NhbGUpIHtcbiAgICAgICAgdmFyIGR1cmF0aW9uID0gY3JlYXRlRHVyYXRpb24ocG9zTmVnRHVyYXRpb24pLmFicygpLFxuICAgICAgICAgICAgc2Vjb25kcyA9IHJvdW5kKGR1cmF0aW9uLmFzKCdzJykpLFxuICAgICAgICAgICAgbWludXRlcyA9IHJvdW5kKGR1cmF0aW9uLmFzKCdtJykpLFxuICAgICAgICAgICAgaG91cnMgPSByb3VuZChkdXJhdGlvbi5hcygnaCcpKSxcbiAgICAgICAgICAgIGRheXMgPSByb3VuZChkdXJhdGlvbi5hcygnZCcpKSxcbiAgICAgICAgICAgIG1vbnRocyA9IHJvdW5kKGR1cmF0aW9uLmFzKCdNJykpLFxuICAgICAgICAgICAgd2Vla3MgPSByb3VuZChkdXJhdGlvbi5hcygndycpKSxcbiAgICAgICAgICAgIHllYXJzID0gcm91bmQoZHVyYXRpb24uYXMoJ3knKSksXG4gICAgICAgICAgICBhID1cbiAgICAgICAgICAgICAgICAoc2Vjb25kcyA8PSB0aHJlc2hvbGRzLnNzICYmIFsncycsIHNlY29uZHNdKSB8fFxuICAgICAgICAgICAgICAgIChzZWNvbmRzIDwgdGhyZXNob2xkcy5zICYmIFsnc3MnLCBzZWNvbmRzXSkgfHxcbiAgICAgICAgICAgICAgICAobWludXRlcyA8PSAxICYmIFsnbSddKSB8fFxuICAgICAgICAgICAgICAgIChtaW51dGVzIDwgdGhyZXNob2xkcy5tICYmIFsnbW0nLCBtaW51dGVzXSkgfHxcbiAgICAgICAgICAgICAgICAoaG91cnMgPD0gMSAmJiBbJ2gnXSkgfHxcbiAgICAgICAgICAgICAgICAoaG91cnMgPCB0aHJlc2hvbGRzLmggJiYgWydoaCcsIGhvdXJzXSkgfHxcbiAgICAgICAgICAgICAgICAoZGF5cyA8PSAxICYmIFsnZCddKSB8fFxuICAgICAgICAgICAgICAgIChkYXlzIDwgdGhyZXNob2xkcy5kICYmIFsnZGQnLCBkYXlzXSk7XG5cbiAgICAgICAgaWYgKHRocmVzaG9sZHMudyAhPSBudWxsKSB7XG4gICAgICAgICAgICBhID1cbiAgICAgICAgICAgICAgICBhIHx8XG4gICAgICAgICAgICAgICAgKHdlZWtzIDw9IDEgJiYgWyd3J10pIHx8XG4gICAgICAgICAgICAgICAgKHdlZWtzIDwgdGhyZXNob2xkcy53ICYmIFsnd3cnLCB3ZWVrc10pO1xuICAgICAgICB9XG4gICAgICAgIGEgPSBhIHx8XG4gICAgICAgICAgICAobW9udGhzIDw9IDEgJiYgWydNJ10pIHx8XG4gICAgICAgICAgICAobW9udGhzIDwgdGhyZXNob2xkcy5NICYmIFsnTU0nLCBtb250aHNdKSB8fFxuICAgICAgICAgICAgKHllYXJzIDw9IDEgJiYgWyd5J10pIHx8IFsneXknLCB5ZWFyc107XG5cbiAgICAgICAgYVsyXSA9IHdpdGhvdXRTdWZmaXg7XG4gICAgICAgIGFbM10gPSArcG9zTmVnRHVyYXRpb24gPiAwO1xuICAgICAgICBhWzRdID0gbG9jYWxlO1xuICAgICAgICByZXR1cm4gc3Vic3RpdHV0ZVRpbWVBZ28uYXBwbHkobnVsbCwgYSk7XG4gICAgfVxuXG4gICAgLy8gVGhpcyBmdW5jdGlvbiBhbGxvd3MgeW91IHRvIHNldCB0aGUgcm91bmRpbmcgZnVuY3Rpb24gZm9yIHJlbGF0aXZlIHRpbWUgc3RyaW5nc1xuICAgIGZ1bmN0aW9uIGdldFNldFJlbGF0aXZlVGltZVJvdW5kaW5nKHJvdW5kaW5nRnVuY3Rpb24pIHtcbiAgICAgICAgaWYgKHJvdW5kaW5nRnVuY3Rpb24gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHJvdW5kO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygcm91bmRpbmdGdW5jdGlvbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgcm91bmQgPSByb3VuZGluZ0Z1bmN0aW9uO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIFRoaXMgZnVuY3Rpb24gYWxsb3dzIHlvdSB0byBzZXQgYSB0aHJlc2hvbGQgZm9yIHJlbGF0aXZlIHRpbWUgc3RyaW5nc1xuICAgIGZ1bmN0aW9uIGdldFNldFJlbGF0aXZlVGltZVRocmVzaG9sZCh0aHJlc2hvbGQsIGxpbWl0KSB7XG4gICAgICAgIGlmICh0aHJlc2hvbGRzW3RocmVzaG9sZF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsaW1pdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhyZXNob2xkc1t0aHJlc2hvbGRdO1xuICAgICAgICB9XG4gICAgICAgIHRocmVzaG9sZHNbdGhyZXNob2xkXSA9IGxpbWl0O1xuICAgICAgICBpZiAodGhyZXNob2xkID09PSAncycpIHtcbiAgICAgICAgICAgIHRocmVzaG9sZHMuc3MgPSBsaW1pdCAtIDE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaHVtYW5pemUoYXJnV2l0aFN1ZmZpeCwgYXJnVGhyZXNob2xkcykge1xuICAgICAgICBpZiAoIXRoaXMuaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVEYXRhKCkuaW52YWxpZERhdGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciB3aXRoU3VmZml4ID0gZmFsc2UsXG4gICAgICAgICAgICB0aCA9IHRocmVzaG9sZHMsXG4gICAgICAgICAgICBsb2NhbGUsXG4gICAgICAgICAgICBvdXRwdXQ7XG5cbiAgICAgICAgaWYgKHR5cGVvZiBhcmdXaXRoU3VmZml4ID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgYXJnVGhyZXNob2xkcyA9IGFyZ1dpdGhTdWZmaXg7XG4gICAgICAgICAgICBhcmdXaXRoU3VmZml4ID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBhcmdXaXRoU3VmZml4ID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIHdpdGhTdWZmaXggPSBhcmdXaXRoU3VmZml4O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgYXJnVGhyZXNob2xkcyA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIHRoID0gT2JqZWN0LmFzc2lnbih7fSwgdGhyZXNob2xkcywgYXJnVGhyZXNob2xkcyk7XG4gICAgICAgICAgICBpZiAoYXJnVGhyZXNob2xkcy5zICE9IG51bGwgJiYgYXJnVGhyZXNob2xkcy5zcyA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGguc3MgPSBhcmdUaHJlc2hvbGRzLnMgLSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbG9jYWxlID0gdGhpcy5sb2NhbGVEYXRhKCk7XG4gICAgICAgIG91dHB1dCA9IHJlbGF0aXZlVGltZSQxKHRoaXMsICF3aXRoU3VmZml4LCB0aCwgbG9jYWxlKTtcblxuICAgICAgICBpZiAod2l0aFN1ZmZpeCkge1xuICAgICAgICAgICAgb3V0cHV0ID0gbG9jYWxlLnBhc3RGdXR1cmUoK3RoaXMsIG91dHB1dCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbG9jYWxlLnBvc3Rmb3JtYXQob3V0cHV0KTtcbiAgICB9XG5cbiAgICB2YXIgYWJzJDEgPSBNYXRoLmFicztcblxuICAgIGZ1bmN0aW9uIHNpZ24oeCkge1xuICAgICAgICByZXR1cm4gKHggPiAwKSAtICh4IDwgMCkgfHwgK3g7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdG9JU09TdHJpbmckMSgpIHtcbiAgICAgICAgLy8gZm9yIElTTyBzdHJpbmdzIHdlIGRvIG5vdCB1c2UgdGhlIG5vcm1hbCBidWJibGluZyBydWxlczpcbiAgICAgICAgLy8gICogbWlsbGlzZWNvbmRzIGJ1YmJsZSB1cCB1bnRpbCB0aGV5IGJlY29tZSBob3Vyc1xuICAgICAgICAvLyAgKiBkYXlzIGRvIG5vdCBidWJibGUgYXQgYWxsXG4gICAgICAgIC8vICAqIG1vbnRocyBidWJibGUgdXAgdW50aWwgdGhleSBiZWNvbWUgeWVhcnNcbiAgICAgICAgLy8gVGhpcyBpcyBiZWNhdXNlIHRoZXJlIGlzIG5vIGNvbnRleHQtZnJlZSBjb252ZXJzaW9uIGJldHdlZW4gaG91cnMgYW5kIGRheXNcbiAgICAgICAgLy8gKHRoaW5rIG9mIGNsb2NrIGNoYW5nZXMpXG4gICAgICAgIC8vIGFuZCBhbHNvIG5vdCBiZXR3ZWVuIGRheXMgYW5kIG1vbnRocyAoMjgtMzEgZGF5cyBwZXIgbW9udGgpXG4gICAgICAgIGlmICghdGhpcy5pc1ZhbGlkKCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxvY2FsZURhdGEoKS5pbnZhbGlkRGF0ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHNlY29uZHMgPSBhYnMkMSh0aGlzLl9taWxsaXNlY29uZHMpIC8gMTAwMCxcbiAgICAgICAgICAgIGRheXMgPSBhYnMkMSh0aGlzLl9kYXlzKSxcbiAgICAgICAgICAgIG1vbnRocyA9IGFicyQxKHRoaXMuX21vbnRocyksXG4gICAgICAgICAgICBtaW51dGVzLFxuICAgICAgICAgICAgaG91cnMsXG4gICAgICAgICAgICB5ZWFycyxcbiAgICAgICAgICAgIHMsXG4gICAgICAgICAgICB0b3RhbCA9IHRoaXMuYXNTZWNvbmRzKCksXG4gICAgICAgICAgICB0b3RhbFNpZ24sXG4gICAgICAgICAgICB5bVNpZ24sXG4gICAgICAgICAgICBkYXlzU2lnbixcbiAgICAgICAgICAgIGhtc1NpZ247XG5cbiAgICAgICAgaWYgKCF0b3RhbCkge1xuICAgICAgICAgICAgLy8gdGhpcyBpcyB0aGUgc2FtZSBhcyBDIydzIChOb2RhKSBhbmQgcHl0aG9uIChpc29kYXRlKS4uLlxuICAgICAgICAgICAgLy8gYnV0IG5vdCBvdGhlciBKUyAoZ29vZy5kYXRlKVxuICAgICAgICAgICAgcmV0dXJuICdQMEQnO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gMzYwMCBzZWNvbmRzIC0+IDYwIG1pbnV0ZXMgLT4gMSBob3VyXG4gICAgICAgIG1pbnV0ZXMgPSBhYnNGbG9vcihzZWNvbmRzIC8gNjApO1xuICAgICAgICBob3VycyA9IGFic0Zsb29yKG1pbnV0ZXMgLyA2MCk7XG4gICAgICAgIHNlY29uZHMgJT0gNjA7XG4gICAgICAgIG1pbnV0ZXMgJT0gNjA7XG5cbiAgICAgICAgLy8gMTIgbW9udGhzIC0+IDEgeWVhclxuICAgICAgICB5ZWFycyA9IGFic0Zsb29yKG1vbnRocyAvIDEyKTtcbiAgICAgICAgbW9udGhzICU9IDEyO1xuXG4gICAgICAgIC8vIGluc3BpcmVkIGJ5IGh0dHBzOi8vZ2l0aHViLmNvbS9kb3JkaWxsZS9tb21lbnQtaXNvZHVyYXRpb24vYmxvYi9tYXN0ZXIvbW9tZW50Lmlzb2R1cmF0aW9uLmpzXG4gICAgICAgIHMgPSBzZWNvbmRzID8gc2Vjb25kcy50b0ZpeGVkKDMpLnJlcGxhY2UoL1xcLj8wKyQvLCAnJykgOiAnJztcblxuICAgICAgICB0b3RhbFNpZ24gPSB0b3RhbCA8IDAgPyAnLScgOiAnJztcbiAgICAgICAgeW1TaWduID0gc2lnbih0aGlzLl9tb250aHMpICE9PSBzaWduKHRvdGFsKSA/ICctJyA6ICcnO1xuICAgICAgICBkYXlzU2lnbiA9IHNpZ24odGhpcy5fZGF5cykgIT09IHNpZ24odG90YWwpID8gJy0nIDogJyc7XG4gICAgICAgIGhtc1NpZ24gPSBzaWduKHRoaXMuX21pbGxpc2Vjb25kcykgIT09IHNpZ24odG90YWwpID8gJy0nIDogJyc7XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIHRvdGFsU2lnbiArXG4gICAgICAgICAgICAnUCcgK1xuICAgICAgICAgICAgKHllYXJzID8geW1TaWduICsgeWVhcnMgKyAnWScgOiAnJykgK1xuICAgICAgICAgICAgKG1vbnRocyA/IHltU2lnbiArIG1vbnRocyArICdNJyA6ICcnKSArXG4gICAgICAgICAgICAoZGF5cyA/IGRheXNTaWduICsgZGF5cyArICdEJyA6ICcnKSArXG4gICAgICAgICAgICAoaG91cnMgfHwgbWludXRlcyB8fCBzZWNvbmRzID8gJ1QnIDogJycpICtcbiAgICAgICAgICAgIChob3VycyA/IGhtc1NpZ24gKyBob3VycyArICdIJyA6ICcnKSArXG4gICAgICAgICAgICAobWludXRlcyA/IGhtc1NpZ24gKyBtaW51dGVzICsgJ00nIDogJycpICtcbiAgICAgICAgICAgIChzZWNvbmRzID8gaG1zU2lnbiArIHMgKyAnUycgOiAnJylcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICB2YXIgcHJvdG8kMiA9IER1cmF0aW9uLnByb3RvdHlwZTtcblxuICAgIHByb3RvJDIuaXNWYWxpZCA9IGlzVmFsaWQkMTtcbiAgICBwcm90byQyLmFicyA9IGFicztcbiAgICBwcm90byQyLmFkZCA9IGFkZCQxO1xuICAgIHByb3RvJDIuc3VidHJhY3QgPSBzdWJ0cmFjdCQxO1xuICAgIHByb3RvJDIuYXMgPSBhcztcbiAgICBwcm90byQyLmFzTWlsbGlzZWNvbmRzID0gYXNNaWxsaXNlY29uZHM7XG4gICAgcHJvdG8kMi5hc1NlY29uZHMgPSBhc1NlY29uZHM7XG4gICAgcHJvdG8kMi5hc01pbnV0ZXMgPSBhc01pbnV0ZXM7XG4gICAgcHJvdG8kMi5hc0hvdXJzID0gYXNIb3VycztcbiAgICBwcm90byQyLmFzRGF5cyA9IGFzRGF5cztcbiAgICBwcm90byQyLmFzV2Vla3MgPSBhc1dlZWtzO1xuICAgIHByb3RvJDIuYXNNb250aHMgPSBhc01vbnRocztcbiAgICBwcm90byQyLmFzUXVhcnRlcnMgPSBhc1F1YXJ0ZXJzO1xuICAgIHByb3RvJDIuYXNZZWFycyA9IGFzWWVhcnM7XG4gICAgcHJvdG8kMi52YWx1ZU9mID0gdmFsdWVPZiQxO1xuICAgIHByb3RvJDIuX2J1YmJsZSA9IGJ1YmJsZTtcbiAgICBwcm90byQyLmNsb25lID0gY2xvbmUkMTtcbiAgICBwcm90byQyLmdldCA9IGdldCQyO1xuICAgIHByb3RvJDIubWlsbGlzZWNvbmRzID0gbWlsbGlzZWNvbmRzO1xuICAgIHByb3RvJDIuc2Vjb25kcyA9IHNlY29uZHM7XG4gICAgcHJvdG8kMi5taW51dGVzID0gbWludXRlcztcbiAgICBwcm90byQyLmhvdXJzID0gaG91cnM7XG4gICAgcHJvdG8kMi5kYXlzID0gZGF5cztcbiAgICBwcm90byQyLndlZWtzID0gd2Vla3M7XG4gICAgcHJvdG8kMi5tb250aHMgPSBtb250aHM7XG4gICAgcHJvdG8kMi55ZWFycyA9IHllYXJzO1xuICAgIHByb3RvJDIuaHVtYW5pemUgPSBodW1hbml6ZTtcbiAgICBwcm90byQyLnRvSVNPU3RyaW5nID0gdG9JU09TdHJpbmckMTtcbiAgICBwcm90byQyLnRvU3RyaW5nID0gdG9JU09TdHJpbmckMTtcbiAgICBwcm90byQyLnRvSlNPTiA9IHRvSVNPU3RyaW5nJDE7XG4gICAgcHJvdG8kMi5sb2NhbGUgPSBsb2NhbGU7XG4gICAgcHJvdG8kMi5sb2NhbGVEYXRhID0gbG9jYWxlRGF0YTtcblxuICAgIHByb3RvJDIudG9Jc29TdHJpbmcgPSBkZXByZWNhdGUoXG4gICAgICAgICd0b0lzb1N0cmluZygpIGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgdG9JU09TdHJpbmcoKSBpbnN0ZWFkIChub3RpY2UgdGhlIGNhcGl0YWxzKScsXG4gICAgICAgIHRvSVNPU3RyaW5nJDFcbiAgICApO1xuICAgIHByb3RvJDIubGFuZyA9IGxhbmc7XG5cbiAgICAvLyBGT1JNQVRUSU5HXG5cbiAgICBhZGRGb3JtYXRUb2tlbignWCcsIDAsIDAsICd1bml4Jyk7XG4gICAgYWRkRm9ybWF0VG9rZW4oJ3gnLCAwLCAwLCAndmFsdWVPZicpO1xuXG4gICAgLy8gUEFSU0lOR1xuXG4gICAgYWRkUmVnZXhUb2tlbigneCcsIG1hdGNoU2lnbmVkKTtcbiAgICBhZGRSZWdleFRva2VuKCdYJywgbWF0Y2hUaW1lc3RhbXApO1xuICAgIGFkZFBhcnNlVG9rZW4oJ1gnLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5LCBjb25maWcpIHtcbiAgICAgICAgY29uZmlnLl9kID0gbmV3IERhdGUocGFyc2VGbG9hdChpbnB1dCkgKiAxMDAwKTtcbiAgICB9KTtcbiAgICBhZGRQYXJzZVRva2VuKCd4JywgZnVuY3Rpb24gKGlucHV0LCBhcnJheSwgY29uZmlnKSB7XG4gICAgICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKHRvSW50KGlucHV0KSk7XG4gICAgfSk7XG5cbiAgICAvLyEgbW9tZW50LmpzXG5cbiAgICBob29rcy52ZXJzaW9uID0gJzIuMjkuMSc7XG5cbiAgICBzZXRIb29rQ2FsbGJhY2soY3JlYXRlTG9jYWwpO1xuXG4gICAgaG9va3MuZm4gPSBwcm90bztcbiAgICBob29rcy5taW4gPSBtaW47XG4gICAgaG9va3MubWF4ID0gbWF4O1xuICAgIGhvb2tzLm5vdyA9IG5vdztcbiAgICBob29rcy51dGMgPSBjcmVhdGVVVEM7XG4gICAgaG9va3MudW5peCA9IGNyZWF0ZVVuaXg7XG4gICAgaG9va3MubW9udGhzID0gbGlzdE1vbnRocztcbiAgICBob29rcy5pc0RhdGUgPSBpc0RhdGU7XG4gICAgaG9va3MubG9jYWxlID0gZ2V0U2V0R2xvYmFsTG9jYWxlO1xuICAgIGhvb2tzLmludmFsaWQgPSBjcmVhdGVJbnZhbGlkO1xuICAgIGhvb2tzLmR1cmF0aW9uID0gY3JlYXRlRHVyYXRpb247XG4gICAgaG9va3MuaXNNb21lbnQgPSBpc01vbWVudDtcbiAgICBob29rcy53ZWVrZGF5cyA9IGxpc3RXZWVrZGF5cztcbiAgICBob29rcy5wYXJzZVpvbmUgPSBjcmVhdGVJblpvbmU7XG4gICAgaG9va3MubG9jYWxlRGF0YSA9IGdldExvY2FsZTtcbiAgICBob29rcy5pc0R1cmF0aW9uID0gaXNEdXJhdGlvbjtcbiAgICBob29rcy5tb250aHNTaG9ydCA9IGxpc3RNb250aHNTaG9ydDtcbiAgICBob29rcy53ZWVrZGF5c01pbiA9IGxpc3RXZWVrZGF5c01pbjtcbiAgICBob29rcy5kZWZpbmVMb2NhbGUgPSBkZWZpbmVMb2NhbGU7XG4gICAgaG9va3MudXBkYXRlTG9jYWxlID0gdXBkYXRlTG9jYWxlO1xuICAgIGhvb2tzLmxvY2FsZXMgPSBsaXN0TG9jYWxlcztcbiAgICBob29rcy53ZWVrZGF5c1Nob3J0ID0gbGlzdFdlZWtkYXlzU2hvcnQ7XG4gICAgaG9va3Mubm9ybWFsaXplVW5pdHMgPSBub3JtYWxpemVVbml0cztcbiAgICBob29rcy5yZWxhdGl2ZVRpbWVSb3VuZGluZyA9IGdldFNldFJlbGF0aXZlVGltZVJvdW5kaW5nO1xuICAgIGhvb2tzLnJlbGF0aXZlVGltZVRocmVzaG9sZCA9IGdldFNldFJlbGF0aXZlVGltZVRocmVzaG9sZDtcbiAgICBob29rcy5jYWxlbmRhckZvcm1hdCA9IGdldENhbGVuZGFyRm9ybWF0O1xuICAgIGhvb2tzLnByb3RvdHlwZSA9IHByb3RvO1xuXG4gICAgLy8gY3VycmVudGx5IEhUTUw1IGlucHV0IHR5cGUgb25seSBzdXBwb3J0cyAyNC1ob3VyIGZvcm1hdHNcbiAgICBob29rcy5IVE1MNV9GTVQgPSB7XG4gICAgICAgIERBVEVUSU1FX0xPQ0FMOiAnWVlZWS1NTS1ERFRISDptbScsIC8vIDxpbnB1dCB0eXBlPVwiZGF0ZXRpbWUtbG9jYWxcIiAvPlxuICAgICAgICBEQVRFVElNRV9MT0NBTF9TRUNPTkRTOiAnWVlZWS1NTS1ERFRISDptbTpzcycsIC8vIDxpbnB1dCB0eXBlPVwiZGF0ZXRpbWUtbG9jYWxcIiBzdGVwPVwiMVwiIC8+XG4gICAgICAgIERBVEVUSU1FX0xPQ0FMX01TOiAnWVlZWS1NTS1ERFRISDptbTpzcy5TU1MnLCAvLyA8aW5wdXQgdHlwZT1cImRhdGV0aW1lLWxvY2FsXCIgc3RlcD1cIjAuMDAxXCIgLz5cbiAgICAgICAgREFURTogJ1lZWVktTU0tREQnLCAvLyA8aW5wdXQgdHlwZT1cImRhdGVcIiAvPlxuICAgICAgICBUSU1FOiAnSEg6bW0nLCAvLyA8aW5wdXQgdHlwZT1cInRpbWVcIiAvPlxuICAgICAgICBUSU1FX1NFQ09ORFM6ICdISDptbTpzcycsIC8vIDxpbnB1dCB0eXBlPVwidGltZVwiIHN0ZXA9XCIxXCIgLz5cbiAgICAgICAgVElNRV9NUzogJ0hIOm1tOnNzLlNTUycsIC8vIDxpbnB1dCB0eXBlPVwidGltZVwiIHN0ZXA9XCIwLjAwMVwiIC8+XG4gICAgICAgIFdFRUs6ICdHR0dHLVtXXVdXJywgLy8gPGlucHV0IHR5cGU9XCJ3ZWVrXCIgLz5cbiAgICAgICAgTU9OVEg6ICdZWVlZLU1NJywgLy8gPGlucHV0IHR5cGU9XCJtb250aFwiIC8+XG4gICAgfTtcblxuICAgIHJldHVybiBob29rcztcblxufSkpKTtcbiIsIi8vIHNoaW0gZm9yIHVzaW5nIHByb2Nlc3MgaW4gYnJvd3NlclxudmFyIHByb2Nlc3MgPSBtb2R1bGUuZXhwb3J0cyA9IHt9O1xuXG4vLyBjYWNoZWQgZnJvbSB3aGF0ZXZlciBnbG9iYWwgaXMgcHJlc2VudCBzbyB0aGF0IHRlc3QgcnVubmVycyB0aGF0IHN0dWIgaXRcbi8vIGRvbid0IGJyZWFrIHRoaW5ncy4gIEJ1dCB3ZSBuZWVkIHRvIHdyYXAgaXQgaW4gYSB0cnkgY2F0Y2ggaW4gY2FzZSBpdCBpc1xuLy8gd3JhcHBlZCBpbiBzdHJpY3QgbW9kZSBjb2RlIHdoaWNoIGRvZXNuJ3QgZGVmaW5lIGFueSBnbG9iYWxzLiAgSXQncyBpbnNpZGUgYVxuLy8gZnVuY3Rpb24gYmVjYXVzZSB0cnkvY2F0Y2hlcyBkZW9wdGltaXplIGluIGNlcnRhaW4gZW5naW5lcy5cblxudmFyIGNhY2hlZFNldFRpbWVvdXQ7XG52YXIgY2FjaGVkQ2xlYXJUaW1lb3V0O1xuXG5mdW5jdGlvbiBkZWZhdWx0U2V0VGltb3V0KCkge1xuICAgIHRocm93IG5ldyBFcnJvcignc2V0VGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZCcpO1xufVxuZnVuY3Rpb24gZGVmYXVsdENsZWFyVGltZW91dCAoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQnKTtcbn1cbihmdW5jdGlvbiAoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKHR5cGVvZiBzZXRUaW1lb3V0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gc2V0VGltZW91dDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBkZWZhdWx0U2V0VGltb3V0O1xuICAgICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjYWNoZWRTZXRUaW1lb3V0ID0gZGVmYXVsdFNldFRpbW91dDtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKHR5cGVvZiBjbGVhclRpbWVvdXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGNsZWFyVGltZW91dDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGRlZmF1bHRDbGVhclRpbWVvdXQ7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNhY2hlZENsZWFyVGltZW91dCA9IGRlZmF1bHRDbGVhclRpbWVvdXQ7XG4gICAgfVxufSAoKSlcbmZ1bmN0aW9uIHJ1blRpbWVvdXQoZnVuKSB7XG4gICAgaWYgKGNhY2hlZFNldFRpbWVvdXQgPT09IHNldFRpbWVvdXQpIHtcbiAgICAgICAgLy9ub3JtYWwgZW52aXJvbWVudHMgaW4gc2FuZSBzaXR1YXRpb25zXG4gICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1biwgMCk7XG4gICAgfVxuICAgIC8vIGlmIHNldFRpbWVvdXQgd2Fzbid0IGF2YWlsYWJsZSBidXQgd2FzIGxhdHRlciBkZWZpbmVkXG4gICAgaWYgKChjYWNoZWRTZXRUaW1lb3V0ID09PSBkZWZhdWx0U2V0VGltb3V0IHx8ICFjYWNoZWRTZXRUaW1lb3V0KSAmJiBzZXRUaW1lb3V0KSB7XG4gICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBzZXRUaW1lb3V0O1xuICAgICAgICByZXR1cm4gc2V0VGltZW91dChmdW4sIDApO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICAvLyB3aGVuIHdoZW4gc29tZWJvZHkgaGFzIHNjcmV3ZWQgd2l0aCBzZXRUaW1lb3V0IGJ1dCBubyBJLkUuIG1hZGRuZXNzXG4gICAgICAgIHJldHVybiBjYWNoZWRTZXRUaW1lb3V0KGZ1biwgMCk7XG4gICAgfSBjYXRjaChlKXtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFdoZW4gd2UgYXJlIGluIEkuRS4gYnV0IHRoZSBzY3JpcHQgaGFzIGJlZW4gZXZhbGVkIHNvIEkuRS4gZG9lc24ndCB0cnVzdCB0aGUgZ2xvYmFsIG9iamVjdCB3aGVuIGNhbGxlZCBub3JtYWxseVxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQuY2FsbChudWxsLCBmdW4sIDApO1xuICAgICAgICB9IGNhdGNoKGUpe1xuICAgICAgICAgICAgLy8gc2FtZSBhcyBhYm92ZSBidXQgd2hlbiBpdCdzIGEgdmVyc2lvbiBvZiBJLkUuIHRoYXQgbXVzdCBoYXZlIHRoZSBnbG9iYWwgb2JqZWN0IGZvciAndGhpcycsIGhvcGZ1bGx5IG91ciBjb250ZXh0IGNvcnJlY3Qgb3RoZXJ3aXNlIGl0IHdpbGwgdGhyb3cgYSBnbG9iYWwgZXJyb3JcbiAgICAgICAgICAgIHJldHVybiBjYWNoZWRTZXRUaW1lb3V0LmNhbGwodGhpcywgZnVuLCAwKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG59XG5mdW5jdGlvbiBydW5DbGVhclRpbWVvdXQobWFya2VyKSB7XG4gICAgaWYgKGNhY2hlZENsZWFyVGltZW91dCA9PT0gY2xlYXJUaW1lb3V0KSB7XG4gICAgICAgIC8vbm9ybWFsIGVudmlyb21lbnRzIGluIHNhbmUgc2l0dWF0aW9uc1xuICAgICAgICByZXR1cm4gY2xlYXJUaW1lb3V0KG1hcmtlcik7XG4gICAgfVxuICAgIC8vIGlmIGNsZWFyVGltZW91dCB3YXNuJ3QgYXZhaWxhYmxlIGJ1dCB3YXMgbGF0dGVyIGRlZmluZWRcbiAgICBpZiAoKGNhY2hlZENsZWFyVGltZW91dCA9PT0gZGVmYXVsdENsZWFyVGltZW91dCB8fCAhY2FjaGVkQ2xlYXJUaW1lb3V0KSAmJiBjbGVhclRpbWVvdXQpIHtcbiAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gY2xlYXJUaW1lb3V0O1xuICAgICAgICByZXR1cm4gY2xlYXJUaW1lb3V0KG1hcmtlcik7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIC8vIHdoZW4gd2hlbiBzb21lYm9keSBoYXMgc2NyZXdlZCB3aXRoIHNldFRpbWVvdXQgYnV0IG5vIEkuRS4gbWFkZG5lc3NcbiAgICAgICAgcmV0dXJuIGNhY2hlZENsZWFyVGltZW91dChtYXJrZXIpO1xuICAgIH0gY2F0Y2ggKGUpe1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gV2hlbiB3ZSBhcmUgaW4gSS5FLiBidXQgdGhlIHNjcmlwdCBoYXMgYmVlbiBldmFsZWQgc28gSS5FLiBkb2Vzbid0ICB0cnVzdCB0aGUgZ2xvYmFsIG9iamVjdCB3aGVuIGNhbGxlZCBub3JtYWxseVxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZENsZWFyVGltZW91dC5jYWxsKG51bGwsIG1hcmtlcik7XG4gICAgICAgIH0gY2F0Y2ggKGUpe1xuICAgICAgICAgICAgLy8gc2FtZSBhcyBhYm92ZSBidXQgd2hlbiBpdCdzIGEgdmVyc2lvbiBvZiBJLkUuIHRoYXQgbXVzdCBoYXZlIHRoZSBnbG9iYWwgb2JqZWN0IGZvciAndGhpcycsIGhvcGZ1bGx5IG91ciBjb250ZXh0IGNvcnJlY3Qgb3RoZXJ3aXNlIGl0IHdpbGwgdGhyb3cgYSBnbG9iYWwgZXJyb3IuXG4gICAgICAgICAgICAvLyBTb21lIHZlcnNpb25zIG9mIEkuRS4gaGF2ZSBkaWZmZXJlbnQgcnVsZXMgZm9yIGNsZWFyVGltZW91dCB2cyBzZXRUaW1lb3V0XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0LmNhbGwodGhpcywgbWFya2VyKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG5cbn1cbnZhciBxdWV1ZSA9IFtdO1xudmFyIGRyYWluaW5nID0gZmFsc2U7XG52YXIgY3VycmVudFF1ZXVlO1xudmFyIHF1ZXVlSW5kZXggPSAtMTtcblxuZnVuY3Rpb24gY2xlYW5VcE5leHRUaWNrKCkge1xuICAgIGlmICghZHJhaW5pbmcgfHwgIWN1cnJlbnRRdWV1ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGRyYWluaW5nID0gZmFsc2U7XG4gICAgaWYgKGN1cnJlbnRRdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgcXVldWUgPSBjdXJyZW50UXVldWUuY29uY2F0KHF1ZXVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBxdWV1ZUluZGV4ID0gLTE7XG4gICAgfVxuICAgIGlmIChxdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgZHJhaW5RdWV1ZSgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZHJhaW5RdWV1ZSgpIHtcbiAgICBpZiAoZHJhaW5pbmcpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgdGltZW91dCA9IHJ1blRpbWVvdXQoY2xlYW5VcE5leHRUaWNrKTtcbiAgICBkcmFpbmluZyA9IHRydWU7XG5cbiAgICB2YXIgbGVuID0gcXVldWUubGVuZ3RoO1xuICAgIHdoaWxlKGxlbikge1xuICAgICAgICBjdXJyZW50UXVldWUgPSBxdWV1ZTtcbiAgICAgICAgcXVldWUgPSBbXTtcbiAgICAgICAgd2hpbGUgKCsrcXVldWVJbmRleCA8IGxlbikge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRRdWV1ZSkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRRdWV1ZVtxdWV1ZUluZGV4XS5ydW4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBxdWV1ZUluZGV4ID0gLTE7XG4gICAgICAgIGxlbiA9IHF1ZXVlLmxlbmd0aDtcbiAgICB9XG4gICAgY3VycmVudFF1ZXVlID0gbnVsbDtcbiAgICBkcmFpbmluZyA9IGZhbHNlO1xuICAgIHJ1bkNsZWFyVGltZW91dCh0aW1lb3V0KTtcbn1cblxucHJvY2Vzcy5uZXh0VGljayA9IGZ1bmN0aW9uIChmdW4pIHtcbiAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBxdWV1ZS5wdXNoKG5ldyBJdGVtKGZ1biwgYXJncykpO1xuICAgIGlmIChxdWV1ZS5sZW5ndGggPT09IDEgJiYgIWRyYWluaW5nKSB7XG4gICAgICAgIHJ1blRpbWVvdXQoZHJhaW5RdWV1ZSk7XG4gICAgfVxufTtcblxuLy8gdjggbGlrZXMgcHJlZGljdGlibGUgb2JqZWN0c1xuZnVuY3Rpb24gSXRlbShmdW4sIGFycmF5KSB7XG4gICAgdGhpcy5mdW4gPSBmdW47XG4gICAgdGhpcy5hcnJheSA9IGFycmF5O1xufVxuSXRlbS5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZnVuLmFwcGx5KG51bGwsIHRoaXMuYXJyYXkpO1xufTtcbnByb2Nlc3MudGl0bGUgPSAnYnJvd3Nlcic7XG5wcm9jZXNzLmJyb3dzZXIgPSB0cnVlO1xucHJvY2Vzcy5lbnYgPSB7fTtcbnByb2Nlc3MuYXJndiA9IFtdO1xucHJvY2Vzcy52ZXJzaW9uID0gJyc7IC8vIGVtcHR5IHN0cmluZyB0byBhdm9pZCByZWdleHAgaXNzdWVzXG5wcm9jZXNzLnZlcnNpb25zID0ge307XG5cbmZ1bmN0aW9uIG5vb3AoKSB7fVxuXG5wcm9jZXNzLm9uID0gbm9vcDtcbnByb2Nlc3MuYWRkTGlzdGVuZXIgPSBub29wO1xucHJvY2Vzcy5vbmNlID0gbm9vcDtcbnByb2Nlc3Mub2ZmID0gbm9vcDtcbnByb2Nlc3MucmVtb3ZlTGlzdGVuZXIgPSBub29wO1xucHJvY2Vzcy5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBub29wO1xucHJvY2Vzcy5lbWl0ID0gbm9vcDtcbnByb2Nlc3MucHJlcGVuZExpc3RlbmVyID0gbm9vcDtcbnByb2Nlc3MucHJlcGVuZE9uY2VMaXN0ZW5lciA9IG5vb3A7XG5cbnByb2Nlc3MubGlzdGVuZXJzID0gZnVuY3Rpb24gKG5hbWUpIHsgcmV0dXJuIFtdIH1cblxucHJvY2Vzcy5iaW5kaW5nID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkJyk7XG59O1xuXG5wcm9jZXNzLmN3ZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICcvJyB9O1xucHJvY2Vzcy5jaGRpciA9IGZ1bmN0aW9uIChkaXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3Byb2Nlc3MuY2hkaXIgaXMgbm90IHN1cHBvcnRlZCcpO1xufTtcbnByb2Nlc3MudW1hc2sgPSBmdW5jdGlvbigpIHsgcmV0dXJuIDA7IH07XG4iLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQXBwID0gdm9pZCAwO1xudmFyIHJlY29yZF8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL3JlY29yZFwiKTtcbnZhciBsaW5rXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vbGliL2NvbnRlbnQvbGlua1wiKTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vbGliL3V0aWxcIik7XG52YXIgYXBwXzEgPSByZXF1aXJlKFwiLi93bWwvYXBwXCIpO1xudmFyIHBhZ2VzXzEgPSByZXF1aXJlKFwiLi9wYWdlc1wiKTtcbnZhciBwYWdlczJQYWdlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdG1wID0gcmVjb3JkXzEuZ3JvdXAocGFnZXNfMS5wYWdlcywgZnVuY3Rpb24gKF8sIGspIHsgcmV0dXJuIGsuc3BsaXQoJ18nKVswXTsgfSk7XG4gICAgZm9yICh2YXIgc2VjIGluIHRtcClcbiAgICAgICAgaWYgKHRtcC5oYXNPd25Qcm9wZXJ0eShzZWMpKSB7XG4gICAgICAgICAgICB2YXIgbmV3U2VjID0ge307XG4gICAgICAgICAgICBmb3IgKHZhciBuYW1lXzEgaW4gdG1wW3NlY10pXG4gICAgICAgICAgICAgICAgaWYgKHRtcFtzZWNdLmhhc093blByb3BlcnR5KG5hbWVfMSkpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3U2VjW25hbWVfMS5zcGxpdCgnXycpWzFdXSA9IHRtcFtzZWNdW25hbWVfMV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgdG1wW3NlY10gPSBuZXdTZWM7XG4gICAgICAgIH1cbiAgICByZXR1cm4gdG1wO1xufTtcbnZhciBwYWdlczJNb2R1bGVzID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiByZWNvcmRfMS5yZWR1Y2UocGFnZXNfMS5wYWdlcywge30sIGZ1bmN0aW9uIChwLCBjLCBrKSB7XG4gICAgICAgIHBbay5zcGxpdCgnXycpWzFdXSA9IGM7XG4gICAgICAgIHJldHVybiBwO1xuICAgIH0pO1xufTtcbi8qKlxuICogQXBwIGRpc3BsYXlpbmcgYWxsIHRoZSB3bWwgd2lkZ2V0cy5cbiAqL1xudmFyIEFwcCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBBcHAocm9vdCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnJvb3QgPSByb290O1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgYXBwXzEuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy5jb250ZW50ID0gW107XG4gICAgICAgIHRoaXMucGFnZSA9ICcnO1xuICAgICAgICB0aGlzLnBhZ2VzID0gcGFnZXMyUGFnZXMoKTtcbiAgICAgICAgdGhpcy5tb2R1bGVzID0gcGFnZXMyTW9kdWxlcygpO1xuICAgICAgICB0aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIGlkOiB7XG4gICAgICAgICAgICAgICAgbGF5b3V0OiAnbGF5b3V0J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogbmF2aWdhdGUgaXMgY2FsbGVkIHdoZW4gdGhlIHVzZXIgY2xpY2tzIG9uIGFcbiAgICAgICAgICogbmF2aWdhdGlvbiBsaW5rLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5uYXZpZ2F0ZSA9IGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgdmFyIG5hbWUgPSBfYS5uYW1lO1xuICAgICAgICAgICAgX3RoaXMucGFnZSA9IG5hbWU7XG4gICAgICAgICAgICBpZiAoX3RoaXMubW9kdWxlcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xuICAgICAgICAgICAgICAgIF90aGlzLmNvbnRlbnQgPSBbX3RoaXMubW9kdWxlc1tuYW1lXS52aWV3LnJlbmRlcigpXTtcbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3LmludmFsaWRhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIHRvZ2dsZURyYXdlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50b2dnbGVEcmF3ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB1dGlsXzEuZ2V0QnlJZChfdGhpcy52aWV3LCBfdGhpcy52YWx1ZXMuaWQubGF5b3V0KVxuICAgICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudG9nZ2xlKCk7IH0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBydW4gdGhlIGFwcGxpY2F0aW9uLlxuICAgICAqL1xuICAgIEFwcC5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcm9vdCA9IHRoaXMucm9vdDtcbiAgICAgICAgd2hpbGUgKHJvb3QubGFzdENoaWxkKVxuICAgICAgICAgICAgcm9vdC5yZW1vdmVDaGlsZChyb290Lmxhc3RDaGlsZCk7XG4gICAgICAgIHJvb3QuYXBwZW5kQ2hpbGQodGhpcy52aWV3LnJlbmRlcigpKTtcbiAgICAgICAgdmFyIHBhdGggPSB3aW5kb3cubG9jYXRpb24uaGFzaC5zcGxpdCgnIycpWzFdO1xuICAgICAgICBwYXRoID0gcGF0aCA/IHBhdGguc3BsaXQoJy8nKS5qb2luKCcnKSA6ICcnO1xuICAgICAgICB0aGlzLm5hdmlnYXRlKG5ldyBsaW5rXzEuTGlua0NsaWNrZWRFdmVudChwYXRoLCBwYXRoKSk7XG4gICAgfTtcbiAgICBBcHAubWFpbiA9IGZ1bmN0aW9uIChyb290KSB7XG4gICAgICAgIHJldHVybiBuZXcgQXBwKHJvb3QpO1xuICAgIH07XG4gICAgcmV0dXJuIEFwcDtcbn0oKSk7XG5leHBvcnRzLkFwcCA9IEFwcDtcbkFwcC5tYWluKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHAnKSkucnVuKCk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnJlc3VsdHMgPSB2b2lkIDA7XG5leHBvcnRzLnJlc3VsdHMgPSBbXG4gICAgeyBsYWJlbDogJ0FzdXMnLCB2YWx1ZTogJ0FzdXMnIH0sXG4gICAgeyBsYWJlbDogJ01TSScsIHZhbHVlOiAnTVNJJyB9LFxuICAgIHsgbGFiZWw6ICdHaWdhYnl0ZScsIHZhbHVlOiAnR2lnYWJ5dGUnIH0sXG4gICAgeyBsYWJlbDogJ0dpZ2FzJywgdmFsdWU6ICdHaWdhcycgfSxcbiAgICB7IGxhYmVsOiAnQXN1c1RlaycsIHZhbHVlOiAnQXN1c1RlaycgfSxcbiAgICB7IGxhYmVsOiAnQXN1c3VnYScsIHZhbHVlOiAnQXN1c3VnYScgfSxcbiAgICB7IGxhYmVsOiAnUXVhbGNvbW0nLCB2YWx1ZTogJ1F1YWxjb21tJyB9LFxuICAgIHsgbGFiZWw6ICdRdWFsaXRhdGl2ZScsIHZhbHVlOiAnUXVhbGl0YXR2ZScgfSxcbiAgICB7IGxhYmVsOiAnS2lycGFsYW5pXFwncycsIHZhbHVlOiAnS2lycGFsYW5pXFwncycgfSxcbiAgICB7IGxhYmVsOiAnQXN1bmRlcicsIHZhbHVlOiAnQXN1bmRlcicgfVxuXTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXJlc3VsdHMuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkVtYmVkUGFnZSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9lbWJlZFwiKTtcbnZhciBFbWJlZFBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRW1iZWRQYWdlKCkge1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBqb2pvOiAnaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvMWJicjV0TXVTbmMnLFxuICAgICAgICAgICAgd2luOiAnaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvaXRnU3lQeGZxb0UnLFxuICAgICAgICAgICAgbWF4OiAnaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvOXJyelFTYms5aEknLFxuICAgICAgICAgICAgYWxsb3c6ICdhY2NlbGVyb21ldGVyOyBhdXRvcGxheTsgZW5jcnlwdGVkLW1lZGlhOyBneXJvc2NvcGU7ICcgK1xuICAgICAgICAgICAgICAgICdwaWN0dXJlLWluLXBpY3R1cmUnXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBFbWJlZFBhZ2U7XG59KCkpO1xuZXhwb3J0cy5FbWJlZFBhZ2UgPSBFbWJlZFBhZ2U7XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgRW1iZWRQYWdlKCk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG52YXIgZ3JpZF8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9sYXlvdXQvZ3JpZFwiKTtcbjtcbnZhciBlbWJlZF8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250ZW50L2VtYmVkXCIpO1xuO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdoMScsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0VtYmVkJylcbiAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuR3JpZExheW91dCh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuUm93KHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuQ29sdW1uKHsgd3c6IHsgJ3NwYW4nOiA0IH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGVtYmVkXzEuRW1iZWQoeyB3dzogeyAnY2xhc3NOYW1lJzogJy1hc3BlY3QtcmF0aW8tMTZ4OScgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdpZnJhbWUnLCB7ICdzcmMnOiBfX2NvbnRleHQudmFsdWVzLmpvam8sICdhbGxvdyc6IF9fY29udGV4dC52YWx1ZXMuYWxsb3cgfSwgW10pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ2NsYXNzTmFtZSc6ICctYXNwZWN0LXJhdGlvLTE2eDknIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdzcGFuJzogNCB9IH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLkNvbHVtbih7IHd3OiB7ICdzcGFuJzogNCB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBlbWJlZF8xLkVtYmVkKHsgd3c6IHsgJ2NsYXNzTmFtZSc6ICctYXNwZWN0LXJhdGlvLTR4MycgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdpZnJhbWUnLCB7ICdzcmMnOiBfX2NvbnRleHQudmFsdWVzLndpbiwgJ2FsbG93JzogX19jb250ZXh0LnZhbHVlcy5hbGxvdyB9LCBbXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnY2xhc3NOYW1lJzogJy1hc3BlY3QtcmF0aW8tNHgzJyB9IH0pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnc3Bhbic6IDQgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGdyaWRfMS5Db2x1bW4oeyB3dzogeyAnc3Bhbic6IDQgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZW1iZWRfMS5FbWJlZCh7IHd3OiB7ICdjbGFzc05hbWUnOiAnLWFzcGVjdC1yYXRpby0xNng5JyB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2lmcmFtZScsIHsgJ3NyYyc6IF9fY29udGV4dC52YWx1ZXMubWF4LCAnYWxsb3cnOiBfX2NvbnRleHQudmFsdWVzLmFsbG93IH0sIFtdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdjbGFzc05hbWUnOiAnLWFzcGVjdC1yYXRpby0xNng5JyB9IH0pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnc3Bhbic6IDQgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgXSksIHt9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWVtYmVkLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NZWRpYURlc2NyaXB0aW9uUGFnZSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9tZWRpYS1kZXNjcmlwdGlvblwiKTtcbnZhciBNZWRpYURlc2NyaXB0aW9uUGFnZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNZWRpYURlc2NyaXB0aW9uUGFnZSgpIHtcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4odGhpcyk7XG4gICAgICAgIHRoaXMudmFsdWVzID0ge307XG4gICAgfVxuICAgIHJldHVybiBNZWRpYURlc2NyaXB0aW9uUGFnZTtcbn0oKSk7XG5leHBvcnRzLk1lZGlhRGVzY3JpcHRpb25QYWdlID0gTWVkaWFEZXNjcmlwdGlvblBhZ2U7XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgTWVkaWFEZXNjcmlwdGlvblBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBtZWRpYV9kZXNjcmlwdGlvbl8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250ZW50L21lZGlhLWRlc2NyaXB0aW9uXCIpO1xuO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdoMScsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ01lZGlhIERlc2NyaXB0aW9uJylcbiAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBtZWRpYV9kZXNjcmlwdGlvbl8xLk1lZGlhRGVzY3JpcHRpb24oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbWVkaWFfZGVzY3JpcHRpb25fMS5NZWRpYSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2ltZycsIHsgJ2FsdCc6ICdwbGFjZWhvbGRlcicsICdzcmMnOiAnaHR0cHM6Ly92aWEucGxhY2Vob2xkZXIuY29tLzE0MHgxMDAnIH0sIFtdKVxuICAgICAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBtZWRpYV9kZXNjcmlwdGlvbl8xLkRlc2NyaXB0aW9uKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnaDQnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0Rlc2NyaXB0aW9uJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0xvY2F0ZWQgYXQgdGhlIHNpZGUgcmVsYXRlZCB0byB0aGUgaW1hZ2Ugb24gdGhlIGxlZnQuJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICBdKSwge30pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bWVkaWEtZGVzY3JpcHRpb24uanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk92ZXJsYXlQYWdlID0gdm9pZCAwO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL292ZXJsYXlcIik7XG52YXIgT3ZlcmxheVBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gT3ZlcmxheVBhZ2UoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMudmlldyA9IG5ldyB2aWV3cy5NYWluKHRoaXMpO1xuICAgICAgICB0aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgbU8gPSBfdGhpcy52aWV3LmZpbmRCeUlkKCdvdmVybGF5Jyk7XG4gICAgICAgICAgICAgICAgaWYgKG1PLmlzSnVzdCgpKVxuICAgICAgICAgICAgICAgICAgICBtTy5nZXQoKS5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gT3ZlcmxheVBhZ2U7XG59KCkpO1xuZXhwb3J0cy5PdmVybGF5UGFnZSA9IE92ZXJsYXlQYWdlO1xuZXhwb3J0cy5kZWZhdWx0ID0gbmV3IE92ZXJsYXlQYWdlKCk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG52YXIgb3ZlcmxheV8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250ZW50L292ZXJsYXlcIik7XG47XG52YXIgZGVtb18xID0gcmVxdWlyZShcIi4uLy4uLy4uL3dpZGdldHMvZGVtb1wiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gxJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnT3ZlcmxheScpXG4gICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgb3ZlcmxheV8xLk92ZXJsYXkoeyB3bWw6IHsgJ2lkJzogJ292ZXJsYXknIH0sIHd3OiB7ICdvbkNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5vbkNsaWNrIH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiAnb3ZlcmxheScgfSwgd3c6IHsgJ29uQ2xpY2snOiBfX2NvbnRleHQudmFsdWVzLm9uQ2xpY2sgfSB9KVxuICAgICAgICAgICAgXSksIHt9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW92ZXJsYXkuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlRhZ1BhZ2UgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvdGFnXCIpO1xudmFyIHN0eWxlXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vbGliL2NvbnRlbnQvc3R5bGVcIik7XG52YXIgVGFnUGFnZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBUYWdQYWdlKCkge1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBjYXBpdGFsaXplOiBmdW5jdGlvbiAocykgeyByZXR1cm4gXCJcIiArIHNbMF0udG9VcHBlckNhc2UoKSArIHMuc2xpY2UoMSk7IH0sXG4gICAgICAgICAgICBzdHlsZXM6IFtcbiAgICAgICAgICAgICAgICBzdHlsZV8xLlN0eWxlLkRlZmF1bHQsXG4gICAgICAgICAgICAgICAgc3R5bGVfMS5TdHlsZS5QcmltYXJ5LFxuICAgICAgICAgICAgICAgIHN0eWxlXzEuU3R5bGUuU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBzdHlsZV8xLlN0eWxlLkluZm8sXG4gICAgICAgICAgICAgICAgc3R5bGVfMS5TdHlsZS5XYXJuaW5nLFxuICAgICAgICAgICAgICAgIHN0eWxlXzEuU3R5bGUuRXJyb3JcbiAgICAgICAgICAgIF1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIFRhZ1BhZ2U7XG59KCkpO1xuZXhwb3J0cy5UYWdQYWdlID0gVGFnUGFnZTtcbmV4cG9ydHMuZGVmYXVsdCA9IG5ldyBUYWdQYWdlKCk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciB0YWdfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvY29udGVudC90YWdcIik7XG47XG52YXIgZGVtb18xID0gcmVxdWlyZShcIi4uLy4uLy4uL3dpZGdldHMvZGVtb1wiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gxJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1RhZycpXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBfX3NwcmVhZEFycmF5cyhbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnaDInLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1N0eWxlcycpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICBdLCBfX2ZvckluKF9fY29udGV4dC52YWx1ZXMuc3R5bGVzLCBmdW5jdGlvbiAodiwgXyQkaSwgXyQkYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWdfMS5UYWcoeyB3dzogeyAnc3R5bGUnOiB2LCAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMuY2FwaXRhbGl6ZSh2KSB9IH0sIFtdKSwgeyB3dzogeyAnc3R5bGUnOiB2LCAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMuY2FwaXRhbGl6ZSh2KSB9IH0pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtdKTsgfSkpKVxuICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD10YWcuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlRodW1ibmFpbFBhZ2UgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvdGh1bWJuYWlsXCIpO1xudmFyIFRodW1ibmFpbFBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVGh1bWJuYWlsUGFnZSgpIHtcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4odGhpcyk7XG4gICAgICAgIHRoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgeyByZXR1cm4gYWxlcnQoJ1lvdSBjbGlja2VkIGl0IScpOyB9XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBUaHVtYm5haWxQYWdlO1xufSgpKTtcbmV4cG9ydHMuVGh1bWJuYWlsUGFnZSA9IFRodW1ibmFpbFBhZ2U7XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgVGh1bWJuYWlsUGFnZSgpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIHRodW1ibmFpbF8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250ZW50L3RodW1ibmFpbFwiKTtcbjtcbnZhciBncmlkXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2xheW91dC9ncmlkXCIpO1xuO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdoMScsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1RodW1ibmFpbCcpXG4gICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLkdyaWRMYXlvdXQoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLlJvdyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLkNvbHVtbih7IHd3OiB7ICdzcGFuJzogNCB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0aHVtYm5haWxfMS5UaHVtYm5haWwoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2ltZycsIHsgJ2FsdCc6ICdwbGFjZWhvbGRlcicsICdzcmMnOiAnaHR0cHM6Ly92aWEucGxhY2Vob2xkZXIuY29tLzE3MXgxODAnLCAnc3R5bGUnOiAnd2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTtkaXNwbGF5OmJsb2NrJyB9LCBbXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnc3Bhbic6IDQgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGdyaWRfMS5Db2x1bW4oeyB3dzogeyAnc3Bhbic6IDQgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGh1bWJuYWlsXzEuVGh1bWJuYWlsKHsgd3c6IHsgJ29uQ2xpY2snOiBfX2NvbnRleHQudmFsdWVzLm9uQ2xpY2sgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdpbWcnLCB7ICdhbHQnOiAncGxhY2Vob2xkZXInLCAnc3JjJzogJ2h0dHBzOi8vdmlhLnBsYWNlaG9sZGVyLmNvbS8xNzF4MTgwJywgJ3N0eWxlJzogJ3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7ZGlzcGxheTpibG9jaycgfSwgW10pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ29uQ2xpY2snOiBfX2NvbnRleHQudmFsdWVzLm9uQ2xpY2sgfSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ3NwYW4nOiA0IH0gfSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuQ29sdW1uKHsgd3c6IHsgJ3NwYW4nOiA0IH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRodW1ibmFpbF8xLlRodW1ibmFpbCh7IHd3OiB7ICdocmVmJzogJyMnIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnaW1nJywgeyAnYWx0JzogJ3BsYWNlaG9sZGVyJywgJ3NyYyc6ICdodHRwczovL3ZpYS5wbGFjZWhvbGRlci5jb20vMTcxeDE4MCcsICdzdHlsZSc6ICd3aWR0aDoxMDAlO2hlaWdodDoxMDAlO2Rpc3BsYXk6YmxvY2snIH0sIFtdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdocmVmJzogJyMnIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdzcGFuJzogNCB9IH0pXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGdyaWRfMS5Sb3coe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGdyaWRfMS5Db2x1bW4oeyB3dzogeyAnc3Bhbic6IDQgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGh1bWJuYWlsXzEuVGh1bWJuYWlsKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdpbWcnLCB7ICdhbHQnOiAncGxhY2Vob2xkZXInLCAnc3JjJzogJ2h0dHBzOi8vdmlhLnBsYWNlaG9sZGVyLmNvbS8xNzF4MTgwJywgJ3N0eWxlJzogJ3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7ZGlzcGxheTpibG9jaycgfSwgW10pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0aHVtYm5haWxfMS5DYXB0aW9uKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnaDQnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0NhcHRpb24nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnRGVzY3JpYmVzIHRoZSB0aHVtYm5haWwgaW4gbWlub3IgZGV0YWlsLicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ3NwYW4nOiA0IH0gfSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuQ29sdW1uKHsgd3c6IHsgJ3NwYW4nOiA0IH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRodW1ibmFpbF8xLlRodW1ibmFpbCh7IHd3OiB7ICdvbkNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5vbkNsaWNrIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnaW1nJywgeyAnYWx0JzogJ3BsYWNlaG9sZGVyJywgJ3NyYyc6ICdodHRwczovL3ZpYS5wbGFjZWhvbGRlci5jb20vMTcxeDE4MCcsICdzdHlsZSc6ICd3aWR0aDoxMDAlO2hlaWdodDoxMDAlO2Rpc3BsYXk6YmxvY2snIH0sIFtdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGh1bWJuYWlsXzEuQ2FwdGlvbih7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2g0Jywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdDYXB0aW9uJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0Rlc2NyaWJlcyB0aGUgdGh1bWJuYWlsIGluIG1pbm9yIGRldGFpbC4nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdvbkNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5vbkNsaWNrIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdzcGFuJzogNCB9IH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLkNvbHVtbih7IHd3OiB7ICdzcGFuJzogNCB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0aHVtYm5haWxfMS5UaHVtYm5haWwoeyB3dzogeyAnaHJlZic6ICcjJyB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2ltZycsIHsgJ2FsdCc6ICdwbGFjZWhvbGRlcicsICdzcmMnOiAnaHR0cHM6Ly92aWEucGxhY2Vob2xkZXIuY29tLzE3MXgxODAnLCAnc3R5bGUnOiAnd2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTtkaXNwbGF5OmJsb2NrJyB9LCBbXSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRodW1ibmFpbF8xLkNhcHRpb24oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdoNCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnQ2FwdGlvbicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdEZXNjcmliZXMgdGhlIHRodW1ibmFpbCBpbiBtaW5vciBkZXRhaWwuJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnaHJlZic6ICcjJyB9IH0pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnc3Bhbic6IDQgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgXSksIHt9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXRodW1ibmFpbC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQnV0dG9uR3JvdXBQYWdlID0gdm9pZCAwO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL2J1dHRvbi1ncm91cFwiKTtcbnZhciBCdXR0b25Hcm91cFBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQnV0dG9uR3JvdXBQYWdlKCkge1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICB9XG4gICAgcmV0dXJuIEJ1dHRvbkdyb3VwUGFnZTtcbn0oKSk7XG5leHBvcnRzLkJ1dHRvbkdyb3VwUGFnZSA9IEJ1dHRvbkdyb3VwUGFnZTtcbmV4cG9ydHMuZGVmYXVsdCA9IG5ldyBCdXR0b25Hcm91cFBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xudmFyIGJ1dHRvbl8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL2J1dHRvblwiKTtcbjtcbnZhciBidXR0b25fZ3JvdXBfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvY29udHJvbC9idXR0b24tZ3JvdXBcIik7XG47XG52YXIgZHJvcF9kb3duXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2NvbnRyb2wvZHJvcC1kb3duXCIpO1xuO1xudmFyIG1lbnVfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvbWVudS9tZW51XCIpO1xuO1xudmFyIGl0ZW1fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvbWVudS9pdGVtXCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGJ1dHRvbl9ncm91cF8xLkJ1dHRvbkdyb3VwKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBidXR0b25fMS5CdXR0b24oeyB3dzogeyAndGV4dCc6ICdvbmUnIH0gfSwgW10pLCB7IHd3OiB7ICd0ZXh0JzogJ29uZScgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGJ1dHRvbl8xLkJ1dHRvbih7IHd3OiB7ICd0ZXh0JzogJ3R3bycsICdhY3RpdmUnOiB0cnVlIH0gfSwgW10pLCB7IHd3OiB7ICd0ZXh0JzogJ3R3bycsICdhY3RpdmUnOiB0cnVlIH0gfSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBidXR0b25fMS5CdXR0b24oeyB3dzogeyAndGV4dCc6ICdmb3VyJyB9IH0sIFtdKSwgeyB3dzogeyAndGV4dCc6ICdmb3VyJyB9IH0pXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGJ1dHRvbl9ncm91cF8xLkJ1dHRvbkdyb3VwKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBidXR0b25fMS5CdXR0b24oeyB3dzogeyAndGV4dCc6ICdvbmUnIH0gfSwgW10pLCB7IHd3OiB7ICd0ZXh0JzogJ29uZScgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGJ1dHRvbl8xLkJ1dHRvbih7IHd3OiB7ICd0ZXh0JzogJ3R3bycgfSB9LCBbXSksIHsgd3c6IHsgJ3RleHQnOiAndHdvJyB9IH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgYnV0dG9uXzEuQnV0dG9uKHsgd3c6IHsgJ3RleHQnOiAnZm91cicgfSB9LCBbXSksIHsgd3c6IHsgJ3RleHQnOiAnZm91cicgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBidXR0b25fZ3JvdXBfMS5CdXR0b25Hcm91cCh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgYnV0dG9uXzEuQnV0dG9uKHsgd3c6IHsgJ3RleHQnOiAnb25lJyB9IH0sIFtdKSwgeyB3dzogeyAndGV4dCc6ICdvbmUnIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgYnV0dG9uX2dyb3VwXzEuQnV0dG9uR3JvdXAoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGJ1dHRvbl8xLkJ1dHRvbih7IHd3OiB7ICd0ZXh0JzogJ29uZScgfSB9LCBbXSksIHsgd3c6IHsgJ3RleHQnOiAnb25lJyB9IH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZHJvcF9kb3duXzEuRHJvcERvd24oeyB3dzogeyAnYnV0dG9uVGV4dCc6ICd0d28nIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IG1lbnVfMS5NZW51KHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGl0ZW1fMS5JdGVtKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnYScsIHsgJ2hyZWYnOiAnIycgfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0xpbmsnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaXRlbV8xLkl0ZW0oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdhJywgeyAnaHJlZic6ICcjJyB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnTGluaycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBpdGVtXzEuSXRlbSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2EnLCB7ICdocmVmJzogJyMnIH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdMaW5rJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnYnV0dG9uVGV4dCc6ICd0d28nIH0gfSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBidXR0b25fMS5CdXR0b24oeyB3dzogeyAndGV4dCc6ICd0aHJlZScgfSB9LCBbXSksIHsgd3c6IHsgJ3RleHQnOiAndGhyZWUnIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICBdKSwge30pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YnV0dG9uLWdyb3VwLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5CdXR0b25TZWxlY3RQYWdlID0gdm9pZCAwO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL2J1dHRvbi1zZWxlY3RcIik7XG52YXIgQnV0dG9uU2VsZWN0UGFnZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBCdXR0b25TZWxlY3RQYWdlKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBvcHRpb25zOiBbXG4gICAgICAgICAgICAgICAgeyB0ZXh0OiAnQXN1cycsIHZhbHVlOiAnQXN1cycgfSxcbiAgICAgICAgICAgICAgICB7IHRleHQ6ICdNU0knLCB2YWx1ZTogJ01TSScgfSxcbiAgICAgICAgICAgICAgICB7IHRleHQ6ICdHaWdhYnl0ZScsIHZhbHVlOiAnR2lnYWJ5dGUnIH1cbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB2YWx1ZTogJ01TSScsXG4gICAgICAgICAgICB2YWx1ZXM6IFsnTVNJJ11cbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5vbkNoYW5nZSA9IGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gX2EudmFsdWUsIG5hbWUgPSBfYS5uYW1lO1xuICAgICAgICAgICAgX3RoaXNcbiAgICAgICAgICAgICAgICAudmlld1xuICAgICAgICAgICAgICAgIC5maW5kQnlJZChuYW1lICsgXCItY29udGVudFwiKVxuICAgICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoZS5sYXN0Q2hpbGQpXG4gICAgICAgICAgICAgICAgICAgIGUucmVtb3ZlQ2hpbGQoZS5sYXN0Q2hpbGQpO1xuICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoU3RyaW5nKHZhbHVlKSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMub25DaGFuZ2VNdWx0aSA9IGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gX2EudmFsdWUsIG5hbWUgPSBfYS5uYW1lO1xuICAgICAgICAgICAgX3RoaXNcbiAgICAgICAgICAgICAgICAudmlld1xuICAgICAgICAgICAgICAgIC5maW5kQnlJZChuYW1lICsgXCItY29udGVudFwiKVxuICAgICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoZS5sYXN0Q2hpbGQpXG4gICAgICAgICAgICAgICAgICAgIGUucmVtb3ZlQ2hpbGQoZS5sYXN0Q2hpbGQpO1xuICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoU3RyaW5nKHZhbHVlKSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBCdXR0b25TZWxlY3RQYWdlO1xufSgpKTtcbmV4cG9ydHMuQnV0dG9uU2VsZWN0UGFnZSA9IEJ1dHRvblNlbGVjdFBhZ2U7XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgQnV0dG9uU2VsZWN0UGFnZSgpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG52YXIgYnV0dG9uX3NlbGVjdF8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL2J1dHRvbi1zZWxlY3RcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1lvdSBzZWxlY3RlZDogJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnYicsIHsgd21sOiB7ICdpZCc6ICdzZWxlY3QtY29udGVudCcgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnKE5vbmUpJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnLicpXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBidXR0b25fc2VsZWN0XzEuQnV0dG9uU2VsZWN0KHsgd21sOiB7ICdpZCc6ICdzZWxlY3QnIH0sIHd3OiB7ICduYW1lJzogJ3NlbGVjdCcsICdvcHRpb25zJzogX19jb250ZXh0LnZhbHVlcy5vcHRpb25zLCAndmFsdWUnOiBfX2NvbnRleHQudmFsdWVzLnZhbHVlLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQub25DaGFuZ2UgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6ICdzZWxlY3QnIH0sIHd3OiB7ICduYW1lJzogJ3NlbGVjdCcsICdvcHRpb25zJzogX19jb250ZXh0LnZhbHVlcy5vcHRpb25zLCAndmFsdWUnOiBfX2NvbnRleHQudmFsdWVzLnZhbHVlLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQub25DaGFuZ2UgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnWW91IGNhbiBhbHNvIHVzZSBNdWx0aUJ1dHRvblNlbGVjdCBpbnN0ZWFkOiAnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdiJywgeyB3bWw6IHsgJ2lkJzogJ211bHRpLWNvbnRlbnQnIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJyhOb25lKScpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJy4nKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgYnV0dG9uX3NlbGVjdF8xLk11bHRpQnV0dG9uU2VsZWN0KHsgd21sOiB7ICdpZCc6ICdtdWx0aScgfSwgd3c6IHsgJ25hbWUnOiAnbXVsdGknLCAnb3B0aW9ucyc6IF9fY29udGV4dC52YWx1ZXMub3B0aW9ucywgJ3ZhbHVlJzogX19jb250ZXh0LnZhbHVlcy52YWx1ZXMsICdvbkNoYW5nZSc6IF9fY29udGV4dC5vbkNoYW5nZU11bHRpIH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiAnbXVsdGknIH0sIHd3OiB7ICduYW1lJzogJ211bHRpJywgJ29wdGlvbnMnOiBfX2NvbnRleHQudmFsdWVzLm9wdGlvbnMsICd2YWx1ZSc6IF9fY29udGV4dC52YWx1ZXMudmFsdWVzLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQub25DaGFuZ2VNdWx0aSB9IH0pXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgXSksIHt9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWJ1dHRvbi1zZWxlY3QuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkJ1dHRvblBhZ2UgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvYnV0dG9uXCIpO1xudmFyIHN0eWxlXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vbGliL2NvbnRlbnQvc3R5bGVcIik7XG52YXIgc2l6ZV8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uL2xpYi9jb250ZW50L3NpemVcIik7XG52YXIgQnV0dG9uUGFnZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBCdXR0b25QYWdlKCkge1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBjYXBpdGFsaXplOiBmdW5jdGlvbiAocykgeyByZXR1cm4gXCJcIiArIHNbMF0udG9VcHBlckNhc2UoKSArIHMuc2xpY2UoMSk7IH0sXG4gICAgICAgICAgICBzdHlsZXM6IFtcbiAgICAgICAgICAgICAgICBzdHlsZV8xLlN0eWxlLkRlZmF1bHQsXG4gICAgICAgICAgICAgICAgc3R5bGVfMS5TdHlsZS5QcmltYXJ5LFxuICAgICAgICAgICAgICAgIHN0eWxlXzEuU3R5bGUuU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBzdHlsZV8xLlN0eWxlLkluZm8sXG4gICAgICAgICAgICAgICAgc3R5bGVfMS5TdHlsZS5XYXJuaW5nLFxuICAgICAgICAgICAgICAgIHN0eWxlXzEuU3R5bGUuRXJyb3JcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBzaXplczogW1xuICAgICAgICAgICAgICAgIHNpemVfMS5TaXplLkV4dHJhU21hbGwsXG4gICAgICAgICAgICAgICAgc2l6ZV8xLlNpemUuU21hbGwsXG4gICAgICAgICAgICAgICAgc2l6ZV8xLlNpemUuTWVkaXVtLFxuICAgICAgICAgICAgICAgIHNpemVfMS5TaXplLkxhcmdlLFxuICAgICAgICAgICAgICAgIHNpemVfMS5TaXplLkV4dHJhTGFyZ2VcbiAgICAgICAgICAgIF1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIEJ1dHRvblBhZ2U7XG59KCkpO1xuZXhwb3J0cy5CdXR0b25QYWdlID0gQnV0dG9uUGFnZTtcbmV4cG9ydHMuZGVmYXVsdCA9IG5ldyBCdXR0b25QYWdlKCk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xudmFyIGJ1dHRvbl8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL2J1dHRvblwiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gxJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0J1dHRvbnMnKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgX19zcHJlYWRBcnJheXMoW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gyJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdTdHlsZScpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICBdLCBfX2ZvckluKF9fY29udGV4dC52YWx1ZXMuc3R5bGVzLCBmdW5jdGlvbiAodiwgXyQkaSwgXyQkYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBidXR0b25fMS5CdXR0b24oeyB3dzogeyAnbmFtZSc6IHYsICdzdHlsZSc6IHYsICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5jYXBpdGFsaXplKHYpIH0gfSwgW10pLCB7IHd3OiB7ICduYW1lJzogdiwgJ3N0eWxlJzogdiwgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmNhcGl0YWxpemUodikgfSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHsgcmV0dXJuIChbXSk7IH0pKSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBfX3NwcmVhZEFycmF5cyhbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdoMicsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdPdXRsaW5lJylcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICBdLCBfX2ZvckluKF9fY29udGV4dC52YWx1ZXMuc3R5bGVzLCBmdW5jdGlvbiAoc3R5bGUsIF8kJGksIF8kJGFsbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGJ1dHRvbl8xLkJ1dHRvbih7IHd3OiB7ICdzdHlsZSc6IHN0eWxlLCAnb3V0bGluZSc6IHRydWUsICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5jYXBpdGFsaXplKHN0eWxlKSB9IH0sIFtdKSwgeyB3dzogeyAnc3R5bGUnOiBzdHlsZSwgJ291dGxpbmUnOiB0cnVlLCAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMuY2FwaXRhbGl6ZShzdHlsZSkgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7IHJldHVybiAoW10pOyB9KSkpLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgX19zcHJlYWRBcnJheXMoW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gyJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdBY3RpdmUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgXSwgX19mb3JJbihfX2NvbnRleHQudmFsdWVzLnN0eWxlcywgZnVuY3Rpb24gKHYsIF8kJGksIF8kJGFsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgYnV0dG9uXzEuQnV0dG9uKHsgd3c6IHsgJ25hbWUnOiB2LCAnYWN0aXZlJzogdHJ1ZSwgJ3N0eWxlJzogdiwgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmNhcGl0YWxpemUodikgfSB9LCBbXSksIHsgd3c6IHsgJ25hbWUnOiB2LCAnYWN0aXZlJzogdHJ1ZSwgJ3N0eWxlJzogdiwgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmNhcGl0YWxpemUodikgfSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHsgcmV0dXJuIChbXSk7IH0pKSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIF9fc3ByZWFkQXJyYXlzKFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdoMicsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnRGlzYWJsZWQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgXSwgX19mb3JJbihfX2NvbnRleHQudmFsdWVzLnN0eWxlcywgZnVuY3Rpb24gKHYsIF8kJGksIF8kJGFsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgYnV0dG9uXzEuQnV0dG9uKHsgd3c6IHsgJ25hbWUnOiB2LCAnZGlzYWJsZWQnOiB0cnVlLCAnc3R5bGUnOiB2LCAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMuY2FwaXRhbGl6ZSh2KSB9IH0sIFtdKSwgeyB3dzogeyAnbmFtZSc6IHYsICdkaXNhYmxlZCc6IHRydWUsICdzdHlsZSc6IHYsICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5jYXBpdGFsaXplKHYpIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7IHJldHVybiAoW10pOyB9KSkpXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgX19zcHJlYWRBcnJheXMoW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnaDInLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnU2l6ZScpXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSwgX19mb3JJbihfX2NvbnRleHQudmFsdWVzLnN0eWxlcywgZnVuY3Rpb24gKHN0eWxlLCBfJCRpLCBfJCRhbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBfX3NwcmVhZEFycmF5cyhfX2ZvckluKF9fY29udGV4dC52YWx1ZXMuc2l6ZXMsIGZ1bmN0aW9uIChzaXplLCBfJCRpLCBfJCRhbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgYnV0dG9uXzEuQnV0dG9uKHsgd3c6IHsgJ25hbWUnOiBzaXplLCAnc3R5bGUnOiBzdHlsZSwgJ3NpemUnOiBzaXplLCAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMuY2FwaXRhbGl6ZShzaXplKSB9IH0sIFtdKSwgeyB3dzogeyAnbmFtZSc6IHNpemUsICdzdHlsZSc6IHN0eWxlLCAnc2l6ZSc6IHNpemUsICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5jYXBpdGFsaXplKHNpemUpIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHsgcmV0dXJuIChbXSk7IH0pKSlcbiAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtdKTsgfSkpKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBfX3NwcmVhZEFycmF5cyhbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdoMicsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdCbG9jaycpXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSwgX19mb3JJbihfX2NvbnRleHQudmFsdWVzLnN0eWxlcywgZnVuY3Rpb24gKHN0eWxlLCBfJCRpLCBfJCRhbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBidXR0b25fMS5CdXR0b24oeyB3dzogeyAnc3R5bGUnOiBzdHlsZSwgJ2Jsb2NrJzogdHJ1ZSwgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmNhcGl0YWxpemUoc3R5bGUpIH0gfSwgW10pLCB7IHd3OiB7ICdzdHlsZSc6IHN0eWxlLCAnYmxvY2snOiB0cnVlLCAndGV4dCc6IF9fY29udGV4dC52YWx1ZXMuY2FwaXRhbGl6ZShzdHlsZSkgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7IHJldHVybiAoW10pOyB9KSkpLCB7fSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1idXR0b24uanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNoZWNrYm94UGFnZSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9jaGVja2JveFwiKTtcbnZhciBDaGVja2JveFBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQ2hlY2tib3hQYWdlKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHRydWU7XG4gICAgICAgIHRoaXMub25DaGFuZ2UgPSBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IF9hLnZhbHVlO1xuICAgICAgICAgICAgX3RoaXMudmlldy5maW5kQnlJZCgnY29udGVudCcpXG4gICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIHdoaWxlIChlLmZpcnN0Q2hpbGQpXG4gICAgICAgICAgICAgICAgICAgIGUucmVtb3ZlQ2hpbGQoZS5maXJzdENoaWxkKTtcbiAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHZhbHVlID09PSB0cnVlID9cbiAgICAgICAgICAgICAgICAgICAgJ29uJyA6XG4gICAgICAgICAgICAgICAgICAgICh2YWx1ZSA9PT0gZmFsc2UgPyAnb2ZmJyA6ICdlcnJvcicpKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIENoZWNrYm94UGFnZTtcbn0oKSk7XG5leHBvcnRzLkNoZWNrYm94UGFnZSA9IENoZWNrYm94UGFnZTtcbmV4cG9ydHMuZGVmYXVsdCA9IG5ldyBDaGVja2JveFBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xudmFyIGNoZWNrYm94XzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2NvbnRyb2wvY2hlY2tib3hcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnVGhlIGNoZWNrYm94IGlzICcpLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnYicsIHsgd21sOiB7ICdpZCc6ICdjb250ZW50JyB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ3VudG91Y2hlZCcpXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcuJylcbiAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGNoZWNrYm94XzEuQ2hlY2tib3goeyB3dzogeyAnbmFtZSc6ICdjaGVja2JveCcsICdvbkNoYW5nZSc6IF9fY29udGV4dC5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3dzogeyAnbmFtZSc6ICdjaGVja2JveCcsICdvbkNoYW5nZSc6IF9fY29udGV4dC5vbkNoYW5nZSB9IH0pXG4gICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jaGVja2JveC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMub25DaGFuZ2UgPSBleHBvcnRzLkRhdGVGaWVsZFBhZ2UgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvZGF0ZS1maWVsZFwiKTtcbnZhciBkYXRlX2ZpZWxkXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vbGliL2NvbnRyb2wvZGF0ZS1maWVsZFwiKTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vbGliL3V0aWxcIik7XG52YXIgRGF0ZUZpZWxkUGFnZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBEYXRlRmllbGRQYWdlKCkge1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBmb3JtYXRzOiB7XG4gICAgICAgICAgICAgICAgaXNvOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnaXNvJyxcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ2lzbycsXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnSVNPODYwMScsXG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdDogZGF0ZV9maWVsZF8xLkZvcm1hdC5JU084NjAxLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnSVNPODYwMSBkYXRlJyxcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U6IGV4cG9ydHMub25DaGFuZ2UodGhpcylcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbW1vbjoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ2NvbW1vbicsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICdjb21tb24nLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0NvbW9uJyxcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBkYXRlX2ZpZWxkXzEuRm9ybWF0LkNPTU1PTixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ0NvbW1vbiBkYXRlJyxcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U6IGV4cG9ydHMub25DaGFuZ2UodGhpcylcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHVzOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAndXMnLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiAndXMnLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ1VTJyxcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBkYXRlX2ZpZWxkXzEuRm9ybWF0LlVTQSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ1VTIGRhdGUnLFxuICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogZXhwb3J0cy5vbkNoYW5nZSh0aGlzKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdGF0ZXM6IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnc3VjY2VzcycsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICdzdWNjZXNzJyxcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdTdWNjZXNzJyxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogJ1N1Y2Nlc3MgZGF0ZScsXG4gICAgICAgICAgICAgICAgICAgIHdhcm5pbmc6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgYmxvY2s6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogZXhwb3J0cy5vbkNoYW5nZSh0aGlzKVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgd2FybmluZzoge1xuICAgICAgICAgICAgICAgICAgICBpZDogJ3dhcm5pbmcnLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnd2FybmluZycsXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnV2FybmluZycsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgd2FybmluZzogJ1dhcm5pbmcgZGF0ZScsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIGJsb2NrOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U6IGV4cG9ydHMub25DaGFuZ2UodGhpcylcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0Vycm9yJyxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB3YXJuaW5nOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiAnRXJyb3IgZGF0ZScsXG4gICAgICAgICAgICAgICAgICAgIGJsb2NrOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U6IGV4cG9ydHMub25DaGFuZ2UodGhpcylcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGJsb2NrOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiAnYmxvY2snLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnYmxvY2snLFxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ0Jsb2NrJyxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB3YXJuaW5nOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIGJsb2NrOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogZXhwb3J0cy5vbkNoYW5nZSh0aGlzKVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBEYXRlRmllbGRQYWdlO1xufSgpKTtcbmV4cG9ydHMuRGF0ZUZpZWxkUGFnZSA9IERhdGVGaWVsZFBhZ2U7XG5leHBvcnRzLm9uQ2hhbmdlID0gZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGZ1bmN0aW9uIChfYSkge1xuICAgIHZhciBuYW1lID0gX2EubmFtZSwgdmFsdWUgPSBfYS52YWx1ZTtcbiAgICB2YXIgbURhdGUgPSB1dGlsXzEuZ2V0QnlJZChkLnZpZXcsIG5hbWUpO1xuICAgIGlmIChtRGF0ZS5pc0p1c3QoKSkge1xuICAgICAgICB2YXIgZF8xID0gbURhdGUuZ2V0KCk7XG4gICAgICAgIGRfMS5zZXRNZXNzYWdlKFwiVGhlIGRhdGUgaXMgXCIgKyB2YWx1ZSArIFwiLlwiKTtcbiAgICB9XG59OyB9O1xuZXhwb3J0cy5kZWZhdWx0ID0gbmV3IERhdGVGaWVsZFBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG52YXIgZGF0ZV9maWVsZF8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL2RhdGUtZmllbGRcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgX19zcHJlYWRBcnJheXMoX19mb3JPZihfX2NvbnRleHQudmFsdWVzLmZvcm1hdHMsIGZ1bmN0aW9uIChzcGVjLCBfJCRrLCBfJCRhbGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkYXRlX2ZpZWxkXzEuRGF0ZUZpZWxkKHsgd21sOiB7ICdpZCc6IHNwZWMuaWQgfSwgd3c6IHsgJ25hbWUnOiBzcGVjLm5hbWUsICdsYWJlbCc6IHNwZWMubGFiZWwsICdmb3JtYXQnOiBzcGVjLmZvcm1hdCwgJ21lc3NhZ2UnOiBzcGVjLm1lc3NhZ2UsICdvbkNoYW5nZSc6IHNwZWMub25DaGFuZ2UgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IHNwZWMuaWQgfSwgd3c6IHsgJ25hbWUnOiBzcGVjLm5hbWUsICdsYWJlbCc6IHNwZWMubGFiZWwsICdmb3JtYXQnOiBzcGVjLmZvcm1hdCwgJ21lc3NhZ2UnOiBzcGVjLm1lc3NhZ2UsICdvbkNoYW5nZSc6IHNwZWMub25DaGFuZ2UgfSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtdKTsgfSksIF9fZm9yT2YoX19jb250ZXh0LnZhbHVlcy5zdGF0ZXMsIGZ1bmN0aW9uIChzcGVjLCBfJCRrLCBfJCRhbGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkYXRlX2ZpZWxkXzEuRGF0ZUZpZWxkKHsgd21sOiB7ICdpZCc6IHNwZWMuaWQgfSwgd3c6IHsgJ25hbWUnOiBzcGVjLm5hbWUsICdsYWJlbCc6IHNwZWMubGFiZWwsICdzdWNjZXNzJzogc3BlYy5zdWNjZXNzLCAnd2FybmluZyc6IHNwZWMud2FybmluZywgJ2Vycm9yJzogc3BlYy5lcnJvciwgJ2Jsb2NrJzogc3BlYy5ibG9jaywgJ29uQ2hhbmdlJzogc3BlYy5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3bWw6IHsgJ2lkJzogc3BlYy5pZCB9LCB3dzogeyAnbmFtZSc6IHNwZWMubmFtZSwgJ2xhYmVsJzogc3BlYy5sYWJlbCwgJ3N1Y2Nlc3MnOiBzcGVjLnN1Y2Nlc3MsICd3YXJuaW5nJzogc3BlYy53YXJuaW5nLCAnZXJyb3InOiBzcGVjLmVycm9yLCAnYmxvY2snOiBzcGVjLmJsb2NrLCAnb25DaGFuZ2UnOiBzcGVjLm9uQ2hhbmdlIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHsgcmV0dXJuIChbXSk7IH0pKSksIHt9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRhdGUtZmllbGQuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkRpc3BsYXlGaWVsZFBhZ2UgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvZGlzcGxheS1maWVsZFwiKTtcbnZhciBzdHlsZV8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uL2xpYi9jb250ZW50L3N0eWxlXCIpO1xudmFyIGdldFN0eWxlcyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFtcbiAgICBzdHlsZV8xLlN0eWxlLkRlZmF1bHQsXG4gICAgc3R5bGVfMS5TdHlsZS5QcmltYXJ5LFxuICAgIHN0eWxlXzEuU3R5bGUuU3VjY2VzcyxcbiAgICBzdHlsZV8xLlN0eWxlLkluZm8sXG4gICAgc3R5bGVfMS5TdHlsZS5XYXJuaW5nLFxuICAgIHN0eWxlXzEuU3R5bGUuRXJyb3Jcbl07IH07XG52YXIgRGlzcGxheUZpZWxkUGFnZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBEaXNwbGF5RmllbGRQYWdlKCkge1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBjYXBpdGFsaXplOiBmdW5jdGlvbiAocykgeyByZXR1cm4gXCJcIiArIHNbMF0udG9VcHBlckNhc2UoKSArIHMuc2xpY2UoMSk7IH0sXG4gICAgICAgICAgICBzdHlsZXM6IGdldFN0eWxlcygpXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBEaXNwbGF5RmllbGRQYWdlO1xufSgpKTtcbmV4cG9ydHMuRGlzcGxheUZpZWxkUGFnZSA9IERpc3BsYXlGaWVsZFBhZ2U7XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgRGlzcGxheUZpZWxkUGFnZSgpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGRpc3BsYXlfZmllbGRfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvY29udHJvbC9kaXNwbGF5LWZpZWxkXCIpO1xuO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRpc3BsYXlfZmllbGRfMS5EaXNwbGF5RmllbGQoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJyBJdCB3YXMgYSBjaG9pY2UuJylcbiAgICAgICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGlzcGxheV9maWVsZF8xLkRpc3BsYXlGaWVsZCh7IHd3OiB7ICdkaXNhYmxlZCc6IHRydWUgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdEaXNhYmxlZCcpXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdkaXNhYmxlZCc6IHRydWUgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1kaXNwbGF5LWZpZWxkLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Ecm9wRG93blBhZ2UgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvZHJvcC1kb3duXCIpO1xudmFyIERyb3BEb3duUGFnZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBEcm9wRG93blBhZ2UoKSB7XG4gICAgICAgIHRoaXMudmlldyA9IG5ldyB2aWV3cy5NYWluKHRoaXMpO1xuICAgICAgICB0aGlzLm9uQ2xpY2sgPSBmdW5jdGlvbiAobXNnKSB7IHJldHVybiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgYWxlcnQobXNnKTtcbiAgICAgICAgfTsgfTtcbiAgICB9XG4gICAgcmV0dXJuIERyb3BEb3duUGFnZTtcbn0oKSk7XG5leHBvcnRzLkRyb3BEb3duUGFnZSA9IERyb3BEb3duUGFnZTtcbmV4cG9ydHMuZGVmYXVsdCA9IG5ldyBEcm9wRG93blBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xudmFyIGRyb3BfZG93bl8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL2Ryb3AtZG93blwiKTtcbjtcbnZhciBtZW51XzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL21lbnUvbWVudVwiKTtcbjtcbnZhciBpdGVtXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL21lbnUvaXRlbVwiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkcm9wX2Rvd25fMS5Ecm9wRG93bih7IHd3OiB7ICdidXR0b25UZXh0JzogJ0NsaWNrIE1lJyB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IG1lbnVfMS5NZW51KHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaXRlbV8xLkl0ZW0oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2EnLCB7ICdocmVmJzogJyMnLCAnb25jbGljayc6IF9fY29udGV4dC5vbkNsaWNrKCdZb3UgY2xpY2tlZCBvbmUnKSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdPbmUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaXRlbV8xLkl0ZW0oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2EnLCB7ICdocmVmJzogJyMnLCAnb25jbGljayc6IF9fY29udGV4dC5vbkNsaWNrKCdZb3UgY2xpY2tlZCB0d28nKSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdUd28nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaXRlbV8xLkl0ZW0oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2EnLCB7ICdocmVmJzogJyMnLCAnb25jbGljayc6IF9fY29udGV4dC5vbkNsaWNrKCdZb3UgY2xpY2tlZCB0aHJlZScpIH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1RocmVlJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdidXR0b25UZXh0JzogJ0NsaWNrIE1lJyB9IH0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkcm9wX2Rvd25fMS5Ecm9wRG93bih7IHd3OiB7ICdidXR0b25UZXh0JzogJ01lIFRvbycsICdhdXRvQ2xvc2UnOiBmYWxzZSB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdoMScsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnQW55IGZsb3cgY29udGVudCBjYW4gZ28gaGVyZSEnKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ2J1dHRvblRleHQnOiAnTWUgVG9vJywgJ2F1dG9DbG9zZSc6IGZhbHNlIH0gfSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRyb3BfZG93bl8xLkRyb3BEb3duKHsgd3c6IHsgJ2J1dHRvblRleHQnOiAnQ2FuXFwndCB0b3VjaCB0aGlzIScsICdkaXNhYmxlZCc6IHRydWUgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnWW91IHdpbGwgbmV2ZXIgc2VlIHRoaXMhJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdidXR0b25UZXh0JzogJ0NhblxcJ3QgdG91Y2ggdGhpcyEnLCAnZGlzYWJsZWQnOiB0cnVlIH0gfSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRyb3BfZG93bl8xLkRyb3BEb3duKHsgd3c6IHsgJ2J1dHRvblRleHQnOiAnSSBhbSBhbiBhbmNob3InLCAnYW5jaG9yJzogdHJ1ZSB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdiJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdDb250ZW50JylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdidXR0b25UZXh0JzogJ0kgYW0gYW4gYW5jaG9yJywgJ2FuY2hvcic6IHRydWUgfSB9KVxuICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICBdKSwge30pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZHJvcC1kb3duLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Ecm9wTGlzdEZpZWxkUGFnZSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9kcm9wLWxpc3QtZmllbGRcIik7XG52YXIgcmVzdWx0c18xID0gcmVxdWlyZShcIi4uLy4uL2ZpeHR1cmVzL2RhdGEvcmVzdWx0c1wiKTtcbnZhciBvcHRpb25zID0gcmVzdWx0c18xLnJlc3VsdHM7XG52YXIgRHJvcExpc3RGaWVsZFBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRHJvcExpc3RGaWVsZFBhZ2UoKSB7XG4gICAgICAgIHRoaXMudmlldyA9IG5ldyB2aWV3cy5NYWluKHRoaXMpO1xuICAgICAgICB0aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIG5vcm1hbDoge1xuICAgICAgICAgICAgICAgIGlkOiAnbm9ybWFsJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnbm9ybWFsJyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ05vcm1hbCcsXG4gICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogcmVzdWx0c18xLnJlc3VsdHNbMl0udmFsdWUsXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IGRvQ2hhbmdlKHRoaXMpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VjY2Vzczoge1xuICAgICAgICAgICAgICAgIGlkOiAnc3VjY2VzcycsXG4gICAgICAgICAgICAgICAgbmFtZTogJ3N1Y2Nlc3MnLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnU3VjY2VzcycsXG4gICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnVGhpcyBoYXMgYSBzdWNjZXNzIG1lc3NhZ2UuJyxcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogZG9DaGFuZ2UodGhpcylcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3YXJuaW5nOiB7XG4gICAgICAgICAgICAgICAgaWQ6ICd3YXJuaW5nJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnd2FybmluZycsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdXYXJuaW5nJyxcbiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdUaGlzIGhhcyBhIHdhcm5pbmcgbWVzc2FnZS4nLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBkb0NoYW5nZSh0aGlzKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgbmFtZTogJ2Vycm9yJyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ0Vycm9yJyxcbiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdUaGlzIGhhcyBhIGVycm9yIG1lc3NhZ2UuJyxcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogZG9DaGFuZ2UodGhpcylcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBEcm9wTGlzdEZpZWxkUGFnZTtcbn0oKSk7XG5leHBvcnRzLkRyb3BMaXN0RmllbGRQYWdlID0gRHJvcExpc3RGaWVsZFBhZ2U7XG52YXIgZG9DaGFuZ2UgPSBmdW5jdGlvbiAocGFnZSkgeyByZXR1cm4gZnVuY3Rpb24gKF9hKSB7XG4gICAgdmFyIG5hbWUgPSBfYS5uYW1lLCB2YWx1ZSA9IF9hLnZhbHVlO1xuICAgIHJldHVybiBwYWdlXG4gICAgICAgIC52aWV3XG4gICAgICAgIC5maW5kQnlJZChuYW1lKVxuICAgICAgICAubWFwKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYWxlcnQoXCJTZWxlY3RlZDogXCIgKyBuYW1lICsgXCI9XCIgKyB2YWx1ZSk7XG4gICAgfSk7XG59OyB9O1xuZXhwb3J0cy5kZWZhdWx0ID0gbmV3IERyb3BMaXN0RmllbGRQYWdlKCk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG52YXIgZGVtb18xID0gcmVxdWlyZShcIi4uLy4uLy4uL3dpZGdldHMvZGVtb1wiKTtcbjtcbnZhciBkcm9wX2xpc3RfZmllbGRfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvY29udHJvbC9kcm9wLWxpc3QtZmllbGRcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdiJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ05vcm1hbCcpXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkcm9wX2xpc3RfZmllbGRfMS5Ecm9wTGlzdEZpZWxkKHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm5hbWUgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5uYW1lLCAndmFsdWUnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC52YWx1ZSwgJ29wdGlvbnMnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vcHRpb25zLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwubmFtZSB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm5hbWUsICd2YWx1ZSc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLnZhbHVlLCAnb3B0aW9ucyc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm9wdGlvbnMsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm9uQ2hhbmdlIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdiJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1N1Y2Nlc3MnKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZHJvcF9saXN0X2ZpZWxkXzEuRHJvcExpc3RGaWVsZCh7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3MuaWQgfSwgd3c6IHsgJ2NsYXNzTmFtZSc6ICctc3VjY2VzcycsICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLm5hbWUsICdvcHRpb25zJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLm9wdGlvbnMsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLmlkIH0sIHd3OiB7ICdjbGFzc05hbWUnOiAnLXN1Y2Nlc3MnLCAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5uYW1lLCAnb3B0aW9ucyc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5vcHRpb25zLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3Mub25DaGFuZ2UgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2InLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnV2FybmluZycpXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkcm9wX2xpc3RfZmllbGRfMS5Ecm9wTGlzdEZpZWxkKHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5pZCB9LCB3dzogeyAnY2xhc3NOYW1lJzogJy13YXJuaW5nJywgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcubmFtZSwgJ29wdGlvbnMnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcub3B0aW9ucywgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLm9uQ2hhbmdlIH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcuaWQgfSwgd3c6IHsgJ2NsYXNzTmFtZSc6ICctd2FybmluZycsICduYW1lJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLm5hbWUsICdvcHRpb25zJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLm9wdGlvbnMsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5vbkNoYW5nZSB9IH0pXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnYicsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdFcnJvcicpXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkcm9wX2xpc3RfZmllbGRfMS5Ecm9wTGlzdEZpZWxkKHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IuaWQgfSwgd3c6IHsgJ2NsYXNzTmFtZSc6ICctZXJyb3InLCAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IubmFtZSwgJ29wdGlvbnMnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLm9wdGlvbnMsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3Iub25DaGFuZ2UgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IuaWQgfSwgd3c6IHsgJ2NsYXNzTmFtZSc6ICctZXJyb3InLCAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IubmFtZSwgJ29wdGlvbnMnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLm9wdGlvbnMsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3Iub25DaGFuZ2UgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2InLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnRGlzYWJsZWQnKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZHJvcF9saXN0X2ZpZWxkXzEuRHJvcExpc3RGaWVsZCh7IHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwubmFtZSwgJ3ZhbHVlJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwudmFsdWUsICdvcHRpb25zJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwub3B0aW9ucywgJ2Rpc2FibGVkJzogdHJ1ZSwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwub25DaGFuZ2UgfSB9LCBbXSksIHsgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5uYW1lLCAndmFsdWUnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC52YWx1ZSwgJ29wdGlvbnMnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vcHRpb25zLCAnZGlzYWJsZWQnOiB0cnVlLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vbkNoYW5nZSB9IH0pXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgXSksIHt9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRyb3AtbGlzdC1maWVsZC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRHJvcExpc3RQYWdlID0gdm9pZCAwO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL2Ryb3AtbGlzdFwiKTtcbnZhciByZXN1bHRzXzEgPSByZXF1aXJlKFwiLi4vLi4vZml4dHVyZXMvZGF0YS9yZXN1bHRzXCIpO1xudmFyIG9wdGlvbnMgPSByZXN1bHRzXzEucmVzdWx0cztcbnZhciBEcm9wTGlzdFBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRHJvcExpc3RQYWdlKCkge1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBub3JtYWw6IHtcbiAgICAgICAgICAgICAgICBpZDogJ25vcm1hbCcsXG4gICAgICAgICAgICAgICAgbmFtZTogJ25vcm1hbCcsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdOb3JtYWwnLFxuICAgICAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHJlc3VsdHNfMS5yZXN1bHRzWzJdLnZhbHVlLFxuICAgICAgICAgICAgICAgIG9uU2VsZWN0OiBkb1NlbGVjdCh0aGlzKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGJsb2NrOiB7XG4gICAgICAgICAgICAgICAgaWQ6ICdibG9jaycsXG4gICAgICAgICAgICAgICAgbmFtZTogJ2Jsb2NrJyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ0Jsb2NrJyxcbiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zLFxuICAgICAgICAgICAgICAgIG9uU2VsZWN0OiBkb1NlbGVjdCh0aGlzKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHtcbiAgICAgICAgICAgICAgICBpZDogJ3N1Y2Nlc3MnLFxuICAgICAgICAgICAgICAgIG5hbWU6ICdzdWNjZXNzJyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ1N1Y2Nlc3MnLFxuICAgICAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1RoaXMgaGFzIGEgc3VjY2VzcyBtZXNzYWdlLicsXG4gICAgICAgICAgICAgICAgb25TZWxlY3Q6IGRvU2VsZWN0KHRoaXMpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgd2FybmluZzoge1xuICAgICAgICAgICAgICAgIGlkOiAnd2FybmluZycsXG4gICAgICAgICAgICAgICAgbmFtZTogJ3dhcm5pbmcnLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnV2FybmluZycsXG4gICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnVGhpcyBoYXMgYSB3YXJuaW5nIG1lc3NhZ2UuJyxcbiAgICAgICAgICAgICAgICBvblNlbGVjdDogZG9TZWxlY3QodGhpcylcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgICAgIGlkOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgIG5hbWU6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdFcnJvcicsXG4gICAgICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnVGhpcyBoYXMgYSBlcnJvciBtZXNzYWdlLicsXG4gICAgICAgICAgICAgICAgb25TZWxlY3Q6IGRvU2VsZWN0KHRoaXMpXG4gICAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gRHJvcExpc3RQYWdlO1xufSgpKTtcbmV4cG9ydHMuRHJvcExpc3RQYWdlID0gRHJvcExpc3RQYWdlO1xudmFyIGRvU2VsZWN0ID0gZnVuY3Rpb24gKHBhZ2UpIHsgcmV0dXJuIGZ1bmN0aW9uIChfYSkge1xuICAgIHZhciBuYW1lID0gX2EubmFtZSwgdmFsdWUgPSBfYS52YWx1ZTtcbiAgICByZXR1cm4gcGFnZVxuICAgICAgICAudmlld1xuICAgICAgICAuZmluZEJ5SWQobmFtZSlcbiAgICAgICAgLm1hcChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGFsZXJ0KFwiU2VsZWN0ZWQ6IFwiICsgbmFtZSArIFwiPVwiICsgdmFsdWUpO1xuICAgIH0pO1xufTsgfTtcbmV4cG9ydHMuZGVmYXVsdCA9IG5ldyBEcm9wTGlzdFBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xudmFyIGRyb3BfbGlzdF8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL2Ryb3AtbGlzdFwiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2InLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnTm9ybWFsJylcbiAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRyb3BfbGlzdF8xLkRyb3BMaXN0KHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm5hbWUgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5uYW1lLCAndmFsdWUnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC52YWx1ZSwgJ29wdGlvbnMnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vcHRpb25zLCAnb25TZWxlY3QnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vblNlbGVjdCB9IH0sIFtdKSwgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwubmFtZSB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm5hbWUsICd2YWx1ZSc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLnZhbHVlLCAnb3B0aW9ucyc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm9wdGlvbnMsICdvblNlbGVjdCc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm9uU2VsZWN0IH0gfSlcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdiJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1N1Y2Nlc3MnKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZHJvcF9saXN0XzEuRHJvcExpc3QoeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLmlkIH0sIHd3OiB7ICdjbGFzc05hbWUnOiAnLXN1Y2Nlc3MnLCAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5uYW1lLCAnb3B0aW9ucyc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5vcHRpb25zLCAnb25TZWxlY3QnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3Mub25TZWxlY3QgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5pZCB9LCB3dzogeyAnY2xhc3NOYW1lJzogJy1zdWNjZXNzJywgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3MubmFtZSwgJ29wdGlvbnMnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3Mub3B0aW9ucywgJ29uU2VsZWN0JzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLm9uU2VsZWN0IH0gfSlcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdiJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1dhcm5pbmcnKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZHJvcF9saXN0XzEuRHJvcExpc3QoeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLmlkIH0sIHd3OiB7ICdjbGFzc05hbWUnOiAnLXdhcm5pbmcnLCAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5uYW1lLCAnb3B0aW9ucyc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5vcHRpb25zLCAnb25TZWxlY3QnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcub25TZWxlY3QgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5pZCB9LCB3dzogeyAnY2xhc3NOYW1lJzogJy13YXJuaW5nJywgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcubmFtZSwgJ29wdGlvbnMnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcub3B0aW9ucywgJ29uU2VsZWN0JzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLm9uU2VsZWN0IH0gfSlcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdiJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0Vycm9yJylcbiAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRyb3BfbGlzdF8xLkRyb3BMaXN0KHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IuaWQgfSwgd3c6IHsgJ2NsYXNzTmFtZSc6ICctZXJyb3InLCAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IubmFtZSwgJ29wdGlvbnMnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLm9wdGlvbnMsICdvblNlbGVjdCc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3Iub25TZWxlY3QgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IuaWQgfSwgd3c6IHsgJ2NsYXNzTmFtZSc6ICctZXJyb3InLCAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IubmFtZSwgJ29wdGlvbnMnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLm9wdGlvbnMsICdvblNlbGVjdCc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3Iub25TZWxlY3QgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2InLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0Rpc2FibGVkJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZHJvcF9saXN0XzEuRHJvcExpc3QoeyB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm5hbWUsICdkaXNhYmxlZCc6IHRydWUsICdvblNlbGVjdCc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm9uU2VsZWN0IH0gfSwgW10pLCB7IHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwubmFtZSwgJ2Rpc2FibGVkJzogdHJ1ZSwgJ29uU2VsZWN0JzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwub25TZWxlY3QgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2InLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0Jsb2NrJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZHJvcF9saXN0XzEuRHJvcExpc3QoeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5ibG9jay5pZCB9LCB3dzogeyAnY2xhc3NOYW1lJzogJy1ibG9jaycsICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5ibG9jay5uYW1lLCAnYmxvY2snOiB0cnVlLCAnb25TZWxlY3QnOiBfX2NvbnRleHQudmFsdWVzLmJsb2NrLm9uU2VsZWN0IH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmJsb2NrLmlkIH0sIHd3OiB7ICdjbGFzc05hbWUnOiAnLWJsb2NrJywgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmJsb2NrLm5hbWUsICdibG9jayc6IHRydWUsICdvblNlbGVjdCc6IF9fY29udGV4dC52YWx1ZXMuYmxvY2sub25TZWxlY3QgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1kcm9wLWxpc3QuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkZpbGVVcGxvYWRTdXJmYWNlUGFnZSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9maWxlLXVwbG9hZC1zdXJmYWNlXCIpO1xudmFyIEZpbGVVcGxvYWRTdXJmYWNlUGFnZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBGaWxlVXBsb2FkU3VyZmFjZVBhZ2UoKSB7XG4gICAgICAgIHRoaXMudmlldyA9IG5ldyB2aWV3cy5NYWluKHRoaXMpO1xuICAgICAgICB0aGlzLnZhbHVlcyA9IHt9O1xuICAgIH1cbiAgICByZXR1cm4gRmlsZVVwbG9hZFN1cmZhY2VQYWdlO1xufSgpKTtcbmV4cG9ydHMuRmlsZVVwbG9hZFN1cmZhY2VQYWdlID0gRmlsZVVwbG9hZFN1cmZhY2VQYWdlO1xuZXhwb3J0cy5kZWZhdWx0ID0gbmV3IEZpbGVVcGxvYWRTdXJmYWNlUGFnZSgpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG52YXIgZmlsZV91cGxvYWRfc3VyZmFjZV8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL2ZpbGUtdXBsb2FkLXN1cmZhY2VcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGZpbGVfdXBsb2FkX3N1cmZhY2VfMS5GaWxlVXBsb2FkU3VyZmFjZSh7fSwgW10pLCB7fSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1maWxlLXVwbG9hZC1zdXJmYWNlLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5JbnB1dEdyb3VwUGFnZSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9pbnB1dC1ncm91cFwiKTtcbnZhciByZXN1bHRzXzEgPSByZXF1aXJlKFwiLi4vLi4vZml4dHVyZXMvZGF0YS9yZXN1bHRzXCIpO1xudmFyIElucHV0R3JvdXBQYWdlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIElucHV0R3JvdXBQYWdlKCkge1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBkcm9wTGlzdDogeyBvcHRpb25zOiByZXN1bHRzXzEucmVzdWx0cyB9XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBJbnB1dEdyb3VwUGFnZTtcbn0oKSk7XG5leHBvcnRzLklucHV0R3JvdXBQYWdlID0gSW5wdXRHcm91cFBhZ2U7XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgSW5wdXRHcm91cFBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciB0ZXh0X2lucHV0XzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2NvbnRyb2wvdGV4dC1pbnB1dFwiKTtcbjtcbnZhciBpbnB1dF9ncm91cF8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL2lucHV0LWdyb3VwXCIpO1xuO1xudmFyIGNoZWNrYm94XzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2NvbnRyb2wvY2hlY2tib3hcIik7XG47XG52YXIgYnV0dG9uXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2NvbnRyb2wvYnV0dG9uXCIpO1xuO1xudmFyIGRyb3BfZG93bl8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL2Ryb3AtZG93blwiKTtcbjtcbnZhciBkcm9wX2xpc3RfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvY29udHJvbC9kcm9wLWxpc3RcIik7XG47XG52YXIgbWVudV8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9tZW51L21lbnVcIik7XG47XG52YXIgaXRlbV8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9tZW51L2l0ZW1cIik7XG47XG52YXIgZGVtb18xID0gcmVxdWlyZShcIi4uLy4uLy4uL3dpZGdldHMvZGVtb1wiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaW5wdXRfZ3JvdXBfMS5JbnB1dEdyb3VwKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaW5wdXRfZ3JvdXBfMS5BZGRPbih7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdodHRwJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRleHRfaW5wdXRfMS5UZXh0SW5wdXQoe30sIFtdKSwge30pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBpbnB1dF9ncm91cF8xLklucHV0R3JvdXAoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0ZXh0X2lucHV0XzEuVGV4dElucHV0KHt9LCBbXSksIHt9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBpbnB1dF9ncm91cF8xLkFkZE9uKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJy5jb20nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGlucHV0X2dyb3VwXzEuSW5wdXRHcm91cCh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGlucHV0X2dyb3VwXzEuQWRkT24oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgY2hlY2tib3hfMS5DaGVja2JveCh7fSwgW10pLCB7fSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRleHRfaW5wdXRfMS5UZXh0SW5wdXQoe30sIFtdKSwge30pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBpbnB1dF9ncm91cF8xLklucHV0R3JvdXAoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0ZXh0X2lucHV0XzEuVGV4dElucHV0KHt9LCBbXSksIHt9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBpbnB1dF9ncm91cF8xLkFkZE9uKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGNoZWNrYm94XzEuQ2hlY2tib3goe30sIFtdKSwge30pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaW5wdXRfZ3JvdXBfMS5JbnB1dEdyb3VwKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaW5wdXRfZ3JvdXBfMS5BZGRPbih7ICdidXR0b24nOiB0cnVlIH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgYnV0dG9uXzEuQnV0dG9uKHsgd3c6IHsgJ3RleHQnOiAnRmluZCcgfSB9LCBbXSksIHsgd3c6IHsgJ3RleHQnOiAnRmluZCcgfSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7ICdidXR0b24nOiB0cnVlIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRleHRfaW5wdXRfMS5UZXh0SW5wdXQoe30sIFtdKSwge30pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBpbnB1dF9ncm91cF8xLklucHV0R3JvdXAoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0ZXh0X2lucHV0XzEuVGV4dElucHV0KHt9LCBbXSksIHt9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBpbnB1dF9ncm91cF8xLkFkZE9uKHsgJ2J1dHRvbic6IHRydWUgfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBidXR0b25fMS5CdXR0b24oeyB3dzogeyAndGV4dCc6ICdGaW5kJyB9IH0sIFtdKSwgeyB3dzogeyAndGV4dCc6ICdGaW5kJyB9IH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSksIHsgJ2J1dHRvbic6IHRydWUgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGlucHV0X2dyb3VwXzEuSW5wdXRHcm91cCh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGlucHV0X2dyb3VwXzEuQWRkT24oeyAnYnV0dG9uJzogdHJ1ZSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRyb3BfZG93bl8xLkRyb3BEb3duKHsgd3c6IHsgJ2J1dHRvblRleHQnOiAnQ2xpY2sgTWUnIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbWVudV8xLk1lbnUoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBpdGVtXzEuSXRlbSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnYScsIHsgJ2hyZWYnOiAnIycgfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnT25lJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGl0ZW1fMS5JdGVtKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdhJywgeyAnaHJlZic6ICcjJyB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdUd28nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaXRlbV8xLkl0ZW0oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2EnLCB7ICdocmVmJzogJyMnIH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1RocmVlJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdidXR0b25UZXh0JzogJ0NsaWNrIE1lJyB9IH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSksIHsgJ2J1dHRvbic6IHRydWUgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGV4dF9pbnB1dF8xLlRleHRJbnB1dCh7fSwgW10pLCB7fSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGlucHV0X2dyb3VwXzEuSW5wdXRHcm91cCh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRleHRfaW5wdXRfMS5UZXh0SW5wdXQoe30sIFtdKSwge30pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGlucHV0X2dyb3VwXzEuQWRkT24oeyAnYnV0dG9uJzogdHJ1ZSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRyb3BfZG93bl8xLkRyb3BEb3duKHsgd3c6IHsgJ2J1dHRvblRleHQnOiAnQ2xpY2sgTWUnIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbWVudV8xLk1lbnUoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBpdGVtXzEuSXRlbSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnYScsIHsgJ2hyZWYnOiAnIycgfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnT25lJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGl0ZW1fMS5JdGVtKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdhJywgeyAnaHJlZic6ICcjJyB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdUd28nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaXRlbV8xLkl0ZW0oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2EnLCB7ICdocmVmJzogJyMnIH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1RocmVlJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdidXR0b25UZXh0JzogJ0NsaWNrIE1lJyB9IH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSksIHsgJ2J1dHRvbic6IHRydWUgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGlucHV0X2dyb3VwXzEuSW5wdXRHcm91cCh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGlucHV0X2dyb3VwXzEuQWRkT24oeyAnYnV0dG9uJzogdHJ1ZSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRyb3BfbGlzdF8xLkRyb3BMaXN0KHsgd3c6IHsgJ29wdGlvbnMnOiBfX2NvbnRleHQudmFsdWVzLmRyb3BMaXN0Lm9wdGlvbnMgfSB9LCBbXSksIHsgd3c6IHsgJ29wdGlvbnMnOiBfX2NvbnRleHQudmFsdWVzLmRyb3BMaXN0Lm9wdGlvbnMgfSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7ICdidXR0b24nOiB0cnVlIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRleHRfaW5wdXRfMS5UZXh0SW5wdXQoe30sIFtdKSwge30pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgXSksIHt9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWlucHV0LWdyb3VwLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NdWx0aVNlbGVjdFBhZ2UgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvbXVsdGktc2VsZWN0XCIpO1xudmFyIHJlc3VsdHNfMSA9IHJlcXVpcmUoXCIuLi8uLi9maXh0dXJlcy9kYXRhL3Jlc3VsdHNcIik7XG52YXIgTXVsdGlTZWxlY3RQYWdlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE11bHRpU2VsZWN0UGFnZSgpIHtcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4odGhpcyk7XG4gICAgICAgIHRoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgbm9ybWFsOiB7XG4gICAgICAgICAgICAgICAgaWQ6ICdub3JtYWwnLFxuICAgICAgICAgICAgICAgIG5hbWU6ICdub3JtYWwnLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnTm9ybWFsJyxcbiAgICAgICAgICAgICAgICBzdHJpbmdpZmllcjogZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIudmFsdWU7IH0sXG4gICAgICAgICAgICAgICAgb25TZWFyY2g6IG9uU2VhcmNoKHRoaXMpLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBvbkNoYW5nZSh0aGlzKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWNjZXNzOiB7XG4gICAgICAgICAgICAgICAgaWQ6ICdzdWNjZXNzJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnc3VjY2VzcycsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdTdWNjZXNzJyxcbiAgICAgICAgICAgICAgICBzdHJpbmdpZmllcjogZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIudmFsdWU7IH0sXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1RoaXMgaGFzIGEgc3VjY2VzcyBtZXNzYWdlLicsXG4gICAgICAgICAgICAgICAgb25TZWFyY2g6IG9uU2VhcmNoKHRoaXMpLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBvbkNoYW5nZSh0aGlzKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3YXJuaW5nOiB7XG4gICAgICAgICAgICAgICAgaWQ6ICd3YXJuaW5nJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnd2FybmluZycsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdXYXJuaW5nJyxcbiAgICAgICAgICAgICAgICBzdHJpbmdpZmllcjogZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIudmFsdWU7IH0sXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1RoaXMgaGFzIGEgd2FybmluZyBtZXNzYWdlLicsXG4gICAgICAgICAgICAgICAgb25TZWFyY2g6IG9uU2VhcmNoKHRoaXMpLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBvbkNoYW5nZSh0aGlzKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgICAgIGlkOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgIG5hbWU6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdFcnJvcicsXG4gICAgICAgICAgICAgICAgc3RyaW5naWZpZXI6IGZ1bmN0aW9uIChyKSB7IHJldHVybiByLnZhbHVlOyB9LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdUaGlzIGhhcyBhIGVycm9yIG1lc3NhZ2UuJyxcbiAgICAgICAgICAgICAgICBvblNlYXJjaDogb25TZWFyY2godGhpcyksXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IG9uQ2hhbmdlKHRoaXMpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGJsb2NrOiB7XG4gICAgICAgICAgICAgICAgaWQ6ICdibG9jaycsXG4gICAgICAgICAgICAgICAgbmFtZTogJ2Jsb2NrJyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ0Jsb2NrJyxcbiAgICAgICAgICAgICAgICBzdHJpbmdpZmllcjogZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIudmFsdWU7IH0sXG4gICAgICAgICAgICAgICAgb25TZWFyY2g6IG9uU2VhcmNoKHRoaXMpLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBvbkNoYW5nZSh0aGlzKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbml0OiB7XG4gICAgICAgICAgICAgICAgaWQ6ICdpbml0JyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnaW5pdCcsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdJbml0JyxcbiAgICAgICAgICAgICAgICB2YWx1ZTogcmVzdWx0c18xLnJlc3VsdHMsXG4gICAgICAgICAgICAgICAgc3RyaW5naWZpZXI6IGZ1bmN0aW9uIChyKSB7IHJldHVybiByLnZhbHVlOyB9LFxuICAgICAgICAgICAgICAgIG9uU2VhcmNoOiBvblNlYXJjaCh0aGlzKSxcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogb25DaGFuZ2UodGhpcyksXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBNdWx0aVNlbGVjdFBhZ2U7XG59KCkpO1xuZXhwb3J0cy5NdWx0aVNlbGVjdFBhZ2UgPSBNdWx0aVNlbGVjdFBhZ2U7XG52YXIgb25TZWFyY2ggPSBmdW5jdGlvbiAocGFnZSkgeyByZXR1cm4gZnVuY3Rpb24gKF9hKSB7XG4gICAgdmFyIG5hbWUgPSBfYS5uYW1lLCB2YWx1ZSA9IF9hLnZhbHVlO1xuICAgIHJldHVybiBwYWdlXG4gICAgICAgIC52aWV3XG4gICAgICAgIC5maW5kQnlJZChuYW1lKVxuICAgICAgICAubWFwKGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHZhciBoaXQgPSByZXN1bHRzXzEucmVzdWx0cy5maWx0ZXIoZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHJldHVybiBjLnZhbHVlLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aCh2YWx1ZSkgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgICBzLnVwZGF0ZShoaXQpO1xuICAgIH0pO1xufTsgfTtcbnZhciBvbkNoYW5nZSA9IGZ1bmN0aW9uIChwYWdlKSB7IHJldHVybiBmdW5jdGlvbiAoX2EpIHtcbiAgICB2YXIgbmFtZSA9IF9hLm5hbWUsIHZhbHVlID0gX2EudmFsdWU7XG4gICAgcmV0dXJuIHBhZ2VcbiAgICAgICAgLnZpZXdcbiAgICAgICAgLmZpbmRCeUlkKG5hbWUpXG4gICAgICAgIC5tYXAoZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgdC5zZXRNZXNzYWdlKFwiQ291bnQ6IFwiICsgdmFsdWUubGVuZ3RoKTtcbiAgICB9KTtcbn07IH07XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgTXVsdGlTZWxlY3RQYWdlKCk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG52YXIgZGVtb18xID0gcmVxdWlyZShcIi4uLy4uLy4uL3dpZGdldHMvZGVtb1wiKTtcbjtcbnZhciBtdWx0aV9zZWxlY3RfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvY29udHJvbC9tdWx0aS1zZWxlY3RcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IG11bHRpX3NlbGVjdF8xLk11bHRpU2VsZWN0KHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLmlkIH0sIHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwubGFiZWwsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwub25DaGFuZ2UgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLmlkIH0sIHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwubGFiZWwsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwub25DaGFuZ2UgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbXVsdGlfc2VsZWN0XzEuTXVsdGlTZWxlY3QoeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLmlkIH0sIHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLm5hbWUsICdsYWJlbCc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5sYWJlbCwgJ3N1Y2Nlc3MnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3MubWVzc2FnZSwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3Mub25TZWFyY2gsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLmlkIH0sIHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLm5hbWUsICdsYWJlbCc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5sYWJlbCwgJ3N1Y2Nlc3MnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3MubWVzc2FnZSwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3Mub25TZWFyY2gsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5vbkNoYW5nZSB9IH0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBtdWx0aV9zZWxlY3RfMS5NdWx0aVNlbGVjdCh7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLmxhYmVsLCAnd2FybmluZyc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5tZXNzYWdlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcuc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLm9uQ2hhbmdlIH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLmxhYmVsLCAnd2FybmluZyc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5tZXNzYWdlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcuc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLm9uQ2hhbmdlIH0gfSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IG11bHRpX3NlbGVjdF8xLk11bHRpU2VsZWN0KHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLm5hbWUsICdsYWJlbCc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IubGFiZWwsICdlcnJvcic6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IubWVzc2FnZSwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5pZCB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5sYWJlbCwgJ2Vycm9yJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5tZXNzYWdlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLm9uQ2hhbmdlIH0gfSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IG11bHRpX3NlbGVjdF8xLk11bHRpU2VsZWN0KHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuYmxvY2suaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmJsb2NrLm5hbWUsICdsYWJlbCc6IF9fY29udGV4dC52YWx1ZXMuYmxvY2subGFiZWwsICdibG9jayc6IHRydWUsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMuYmxvY2suc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMuYmxvY2sub25TZWFyY2gsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMuYmxvY2sub25DaGFuZ2UgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuYmxvY2suaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmJsb2NrLm5hbWUsICdsYWJlbCc6IF9fY29udGV4dC52YWx1ZXMuYmxvY2subGFiZWwsICdibG9jayc6IHRydWUsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMuYmxvY2suc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMuYmxvY2sub25TZWFyY2gsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMuYmxvY2sub25DaGFuZ2UgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbXVsdGlfc2VsZWN0XzEuTXVsdGlTZWxlY3QoeyB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm5hbWUsICdsYWJlbCc6ICdEaXNhYmxlZCcsICdkaXNhYmxlZCc6IHRydWUsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm5hbWUsICdsYWJlbCc6ICdEaXNhYmxlZCcsICdkaXNhYmxlZCc6IHRydWUsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vbkNoYW5nZSB9IH0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBtdWx0aV9zZWxlY3RfMS5NdWx0aVNlbGVjdCh7IHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5pbml0Lm5hbWUsICdsYWJlbCc6ICdJbml0aWFsaXplZCcsICd2YWx1ZSc6IF9fY29udGV4dC52YWx1ZXMuaW5pdC52YWx1ZSwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5pbml0LnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLmluaXQub25TZWFyY2gsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMuaW5pdC5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuaW5pdC5uYW1lLCAnbGFiZWwnOiAnSW5pdGlhbGl6ZWQnLCAndmFsdWUnOiBfX2NvbnRleHQudmFsdWVzLmluaXQudmFsdWUsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMuaW5pdC5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5pbml0Lm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLmluaXQub25DaGFuZ2UgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tdWx0aS1zZWxlY3QuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlBhZ2luYXRvclBhZ2UgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvcGFnaW5hdG9yXCIpO1xudmFyIHNjZW5lcyA9IFtcbiAgICAnUGFnZSAxJyxcbiAgICAnUGFnZSAyJyxcbiAgICAnUGFnZSAzJyxcbiAgICAnUGFnZSA0JyxcbiAgICAnUGFnZSA1JyxcbiAgICAnUGFnZSA2JyxcbiAgICAnUGFnZSA3JyxcbiAgICAnUGFnZSA4JyxcbiAgICAnUGFnZSA5JyxcbiAgICAnUGFnZSAxMCdcbl07XG52YXIgUGFnaW5hdG9yUGFnZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBQYWdpbmF0b3JQYWdlKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBtZXNzYWdlOiBzY2VuZXNbMF0sXG4gICAgICAgICAgICBjdXJyZW50OiAxLFxuICAgICAgICAgICAgdG90YWw6IHNjZW5lcy5sZW5ndGgsXG4gICAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy52YWx1ZXMubWVzc2FnZSA9IHNjZW5lc1tlLnZhbHVlIC0gMV07XG4gICAgICAgICAgICAgICAgX3RoaXMudmFsdWVzLmN1cnJlbnQgPSBlLnZhbHVlO1xuICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuaW52YWxpZGF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gUGFnaW5hdG9yUGFnZTtcbn0oKSk7XG5leHBvcnRzLlBhZ2luYXRvclBhZ2UgPSBQYWdpbmF0b3JQYWdlO1xuZXhwb3J0cy5kZWZhdWx0ID0gbmV3IFBhZ2luYXRvclBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xudmFyIHBhZ2luYXRvcl8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL3BhZ2luYXRvclwiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgcGFnaW5hdG9yXzEuUGFnaW5hdG9yKHsgd3c6IHsgJ3RvdGFsJzogX19jb250ZXh0LnZhbHVlcy50b3RhbCwgJ2N1cnJlbnQnOiBfX2NvbnRleHQudmFsdWVzLmN1cnJlbnQsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMub25DaGFuZ2UgfSB9LCBbXSksIHsgd3c6IHsgJ3RvdGFsJzogX19jb250ZXh0LnZhbHVlcy50b3RhbCwgJ2N1cnJlbnQnOiBfX2NvbnRleHQudmFsdWVzLmN1cnJlbnQsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMub25DaGFuZ2UgfSB9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIHRleHQoX19jb250ZXh0LnZhbHVlcy5tZXNzYWdlKVxuICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICBdKSwge30pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnaW5hdG9yLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5TZWFyY2hQYWdlID0gdm9pZCAwO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL3NlYXJjaFwiKTtcbnZhciByZXN1bHRzXzEgPSByZXF1aXJlKFwiLi4vLi4vZml4dHVyZXMvZGF0YS9yZXN1bHRzXCIpO1xudmFyIFNlYXJjaFBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gU2VhcmNoUGFnZSgpIHtcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4odGhpcyk7XG4gICAgICAgIHRoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgaWQ6ICdzZWFyY2gnLFxuICAgICAgICAgICAgbmFtZTogJ3NlYXJjaCcsXG4gICAgICAgICAgICBpZDI6ICdzZWFyY2gyJyxcbiAgICAgICAgICAgIG5hbWUyOiAnc2VhcmNoMicsXG4gICAgICAgICAgICBzdHJpbmdpZmllcjogZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIudmFsdWU7IH0sXG4gICAgICAgICAgICBvblNlYXJjaDogb25TZWFyY2godGhpcyksXG4gICAgICAgICAgICBvblNlbGVjdDogb25TZWxlY3QsXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBTZWFyY2hQYWdlO1xufSgpKTtcbmV4cG9ydHMuU2VhcmNoUGFnZSA9IFNlYXJjaFBhZ2U7XG52YXIgb25TZWFyY2ggPSBmdW5jdGlvbiAocGFnZSkgeyByZXR1cm4gZnVuY3Rpb24gKF9hKSB7XG4gICAgdmFyIG5hbWUgPSBfYS5uYW1lLCB2YWx1ZSA9IF9hLnZhbHVlO1xuICAgIHJldHVybiBwYWdlXG4gICAgICAgIC52aWV3XG4gICAgICAgIC5maW5kQnlJZChuYW1lKVxuICAgICAgICAubWFwKGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHZhciBoaXQgPSByZXN1bHRzXzEucmVzdWx0cy5maWx0ZXIoZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHJldHVybiBjLnZhbHVlLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aCh2YWx1ZS50b0xvd2VyQ2FzZSgpKSA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHMudXBkYXRlKGhpdCk7XG4gICAgfSk7XG59OyB9O1xudmFyIG9uU2VsZWN0ID0gZnVuY3Rpb24gKF9hKSB7XG4gICAgdmFyIHZhbHVlID0gX2EudmFsdWU7XG4gICAgcmV0dXJuIGFsZXJ0KFwiU2VsZWN0ZWQgXFxcIlwiICsgdmFsdWUudmFsdWUgKyBcIlxcXCJcIik7XG59O1xuZXhwb3J0cy5kZWZhdWx0ID0gbmV3IFNlYXJjaFBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xudmFyIHNlYXJjaF8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL3NlYXJjaFwiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgc2VhcmNoXzEuU2VhcmNoKHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLm5hbWUsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMuc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMub25TZWFyY2gsICdvblNlbGVjdCc6IF9fY29udGV4dC52YWx1ZXMub25TZWxlY3QgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLm5hbWUsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMuc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMub25TZWFyY2gsICdvblNlbGVjdCc6IF9fY29udGV4dC52YWx1ZXMub25TZWxlY3QgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgc2VhcmNoXzEuU2VhcmNoKHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQyIH0sIHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5uYW1lMiwgJ2Jsb2NrJzogdHJ1ZSwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5vblNlYXJjaCwgJ29uU2VsZWN0JzogX19jb250ZXh0LnZhbHVlcy5vblNlbGVjdCB9IH0sIFtdKSwgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5pZDIgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLm5hbWUyLCAnYmxvY2snOiB0cnVlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLm9uU2VhcmNoLCAnb25TZWxlY3QnOiBfX2NvbnRleHQudmFsdWVzLm9uU2VsZWN0IH0gfSlcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdoMicsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcgRGlzYWJsZWQgJylcbiAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHNlYXJjaF8xLlNlYXJjaCh7IHd3OiB7ICdkaXNhYmxlZCc6IHRydWUsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMuc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMub25TZWFyY2gsICdvblNlbGVjdCc6IF9fY29udGV4dC52YWx1ZXMub25TZWxlY3QgfSB9LCBbXSksIHsgd3c6IHsgJ2Rpc2FibGVkJzogdHJ1ZSwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5vblNlYXJjaCwgJ29uU2VsZWN0JzogX19jb250ZXh0LnZhbHVlcy5vblNlbGVjdCB9IH0pXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgXSksIHt9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNlYXJjaC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuU2VsZWN0UGFnZSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9zZWxlY3RcIik7XG52YXIgcmVzdWx0c18xID0gcmVxdWlyZShcIi4uLy4uL2ZpeHR1cmVzL2RhdGEvcmVzdWx0c1wiKTtcbnZhciBTZWxlY3RQYWdlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFNlbGVjdFBhZ2UoKSB7XG4gICAgICAgIHRoaXMudmlldyA9IG5ldyB2aWV3cy5NYWluKHRoaXMpO1xuICAgICAgICB0aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIG5vcm1hbDoge1xuICAgICAgICAgICAgICAgIGlkOiAnbm9ybWFsJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnbm9ybWFsJyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ05vcm1hbCcsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHJlc3VsdHNfMS5yZXN1bHRzWzJdLFxuICAgICAgICAgICAgICAgIHN0cmluZ2lmaWVyOiBmdW5jdGlvbiAocikgeyByZXR1cm4gci52YWx1ZTsgfSxcbiAgICAgICAgICAgICAgICBvblNlYXJjaDogZG9TZWFyY2godGhpcyksXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IGRvQ2hhbmdlKHRoaXMpLFxuICAgICAgICAgICAgICAgIG9uVW5zZXQ6IGRvVW5zZXQodGhpcylcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBibG9jazoge1xuICAgICAgICAgICAgICAgIGlkOiAnYmxvY2snLFxuICAgICAgICAgICAgICAgIG5hbWU6ICdibG9jaycsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdCbG9jaycsXG4gICAgICAgICAgICAgICAgc3RyaW5naWZpZXI6IGZ1bmN0aW9uIChyKSB7IHJldHVybiByLnZhbHVlOyB9LFxuICAgICAgICAgICAgICAgIG9uU2VhcmNoOiBkb1NlYXJjaCh0aGlzKSxcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogZG9DaGFuZ2UodGhpcyksXG4gICAgICAgICAgICAgICAgb25VbnNldDogZG9VbnNldCh0aGlzKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHtcbiAgICAgICAgICAgICAgICBpZDogJ3N1Y2Nlc3MnLFxuICAgICAgICAgICAgICAgIG5hbWU6ICdzdWNjZXNzJyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ1N1Y2Nlc3MnLFxuICAgICAgICAgICAgICAgIHN0cmluZ2lmaWVyOiBmdW5jdGlvbiAocikgeyByZXR1cm4gci52YWx1ZTsgfSxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnVGhpcyBoYXMgYSBzdWNjZXNzIG1lc3NhZ2UuJyxcbiAgICAgICAgICAgICAgICBvblNlYXJjaDogZG9TZWFyY2godGhpcyksXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IGRvQ2hhbmdlKHRoaXMpLFxuICAgICAgICAgICAgICAgIG9uVW5zZXQ6IGRvVW5zZXQodGhpcylcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3YXJuaW5nOiB7XG4gICAgICAgICAgICAgICAgaWQ6ICd3YXJuaW5nJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnd2FybmluZycsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdXYXJuaW5nJyxcbiAgICAgICAgICAgICAgICBzdHJpbmdpZmllcjogZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIudmFsdWU7IH0sXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1RoaXMgaGFzIGEgd2FybmluZyBtZXNzYWdlLicsXG4gICAgICAgICAgICAgICAgb25TZWFyY2g6IGRvU2VhcmNoKHRoaXMpLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBkb0NoYW5nZSh0aGlzKSxcbiAgICAgICAgICAgICAgICBvblVuc2V0OiBkb1Vuc2V0KHRoaXMpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgICAgICBpZDogJ2Vycm9yJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnRXJyb3InLFxuICAgICAgICAgICAgICAgIHN0cmluZ2lmaWVyOiBmdW5jdGlvbiAocikgeyByZXR1cm4gci52YWx1ZTsgfSxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnVGhpcyBoYXMgYSBlcnJvciBtZXNzYWdlLicsXG4gICAgICAgICAgICAgICAgb25TZWFyY2g6IGRvU2VhcmNoKHRoaXMpLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBkb0NoYW5nZSh0aGlzKSxcbiAgICAgICAgICAgICAgICBvblVuc2V0OiBkb1Vuc2V0KHRoaXMpXG4gICAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gU2VsZWN0UGFnZTtcbn0oKSk7XG5leHBvcnRzLlNlbGVjdFBhZ2UgPSBTZWxlY3RQYWdlO1xudmFyIGRvU2VhcmNoID0gZnVuY3Rpb24gKHBhZ2UpIHsgcmV0dXJuIGZ1bmN0aW9uIChfYSkge1xuICAgIHZhciBuYW1lID0gX2EubmFtZSwgdmFsdWUgPSBfYS52YWx1ZTtcbiAgICByZXR1cm4gcGFnZVxuICAgICAgICAudmlld1xuICAgICAgICAuZmluZEJ5SWQobmFtZSlcbiAgICAgICAgLm1hcChmdW5jdGlvbiAocykge1xuICAgICAgICB2YXIgaGl0ID0gcmVzdWx0c18xLnJlc3VsdHMuZmlsdGVyKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICByZXR1cm4gYy52YWx1ZS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgodmFsdWUpID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgICAgcy51cGRhdGUoaGl0KTtcbiAgICB9KTtcbn07IH07XG52YXIgZG9DaGFuZ2UgPSBmdW5jdGlvbiAocGFnZSkgeyByZXR1cm4gZnVuY3Rpb24gKF9hKSB7XG4gICAgdmFyIG5hbWUgPSBfYS5uYW1lLCB2YWx1ZSA9IF9hLnZhbHVlO1xuICAgIHJldHVybiBwYWdlXG4gICAgICAgIC52aWV3XG4gICAgICAgIC5maW5kQnlJZChuYW1lKVxuICAgICAgICAubWFwKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHQuc2V0TWVzc2FnZShcIlNlbGVjdGVkOiBcIiArIHZhbHVlLnZhbHVlKTtcbiAgICB9KTtcbn07IH07XG52YXIgZG9VbnNldCA9IGZ1bmN0aW9uIChwYWdlKSB7IHJldHVybiBmdW5jdGlvbiAoX2EpIHtcbiAgICB2YXIgbmFtZSA9IF9hLm5hbWU7XG4gICAgcmV0dXJuIHBhZ2VcbiAgICAgICAgLnZpZXdcbiAgICAgICAgLmZpbmRCeUlkKG5hbWUpXG4gICAgICAgIC5tYXAoZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgdC5zZXRNZXNzYWdlKCcnKTtcbiAgICB9KTtcbn07IH07XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgU2VsZWN0UGFnZSgpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG52YXIgc2VsZWN0XzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2NvbnRyb2wvc2VsZWN0XCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBzZWxlY3RfMS5TZWxlY3QoeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5uYW1lLCAnbGFiZWwnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5sYWJlbCwgJ3ZhbHVlJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwudmFsdWUsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwub25DaGFuZ2UgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLmlkIH0sIHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwubGFiZWwsICd2YWx1ZSc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLnZhbHVlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwub25TZWFyY2gsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm9uQ2hhbmdlIH0gfSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHNlbGVjdF8xLlNlbGVjdCh7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3MuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3MubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLmxhYmVsLCAnc3VjY2Vzcyc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5tZXNzYWdlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3Muc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLm9uQ2hhbmdlIH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3MuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3MubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLmxhYmVsLCAnc3VjY2Vzcyc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5tZXNzYWdlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3Muc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLm9uQ2hhbmdlIH0gfSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHNlbGVjdF8xLlNlbGVjdCh7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLmxhYmVsLCAnd2FybmluZyc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5tZXNzYWdlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcuc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLm9uQ2hhbmdlIH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLmxhYmVsLCAnd2FybmluZyc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5tZXNzYWdlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcuc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLm9uQ2hhbmdlIH0gfSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHNlbGVjdF8xLlNlbGVjdCh7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLmlkIH0sIHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5uYW1lLCAnbGFiZWwnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLmxhYmVsLCAnZXJyb3InOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLm1lc3NhZ2UsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMuZXJyb3Iuc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3Iub25TZWFyY2gsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3Iub25DaGFuZ2UgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLm5hbWUsICdsYWJlbCc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IubGFiZWwsICdlcnJvcic6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IubWVzc2FnZSwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5vbkNoYW5nZSB9IH0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBzZWxlY3RfMS5TZWxlY3QoeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5ibG9jay5pZCB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuYmxvY2submFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy5ibG9jay5sYWJlbCwgJ2Jsb2NrJzogdHJ1ZSwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5ibG9jay5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5ibG9jay5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5ibG9jay5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5ibG9jay5pZCB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuYmxvY2submFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy5ibG9jay5sYWJlbCwgJ2Jsb2NrJzogdHJ1ZSwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5ibG9jay5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5ibG9jay5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5ibG9jay5vbkNoYW5nZSB9IH0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBzZWxlY3RfMS5TZWxlY3QoeyB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm5hbWUsICdsYWJlbCc6ICdEaXNhYmxlZCcsICdkaXNhYmxlZCc6IHRydWUsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwub25DaGFuZ2UgfSB9LCBbXSksIHsgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5uYW1lLCAnbGFiZWwnOiAnRGlzYWJsZWQnLCAnZGlzYWJsZWQnOiB0cnVlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwub25TZWFyY2gsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm9uQ2hhbmdlIH0gfSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHNlbGVjdF8xLlNlbGVjdCh7IHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwubmFtZSwgJ2xhYmVsJzogJ0Rpc2FibGVkIHdpdGggdmFsdWUnLCAndmFsdWUnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC52YWx1ZSwgJ2Rpc2FibGVkJzogdHJ1ZSwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwuc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm5hbWUsICdsYWJlbCc6ICdEaXNhYmxlZCB3aXRoIHZhbHVlJywgJ3ZhbHVlJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwudmFsdWUsICdkaXNhYmxlZCc6IHRydWUsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwub25DaGFuZ2UgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zZWxlY3QuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlN0YWNrU2VsZWN0UGFnZSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9zdGFjay1zZWxlY3RcIik7XG52YXIgcmVzdWx0c18xID0gcmVxdWlyZShcIi4uLy4uL2ZpeHR1cmVzL2RhdGEvcmVzdWx0c1wiKTtcbnZhciBTdGFja1NlbGVjdFBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gU3RhY2tTZWxlY3RQYWdlKCkge1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBhc2M6IHtcbiAgICAgICAgICAgICAgICBpZDogJ2FzYycsXG4gICAgICAgICAgICAgICAgbmFtZTogJ2FzYycsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdBc2NlbmRpbmcnLFxuICAgICAgICAgICAgICAgIHZhbHVlOiByZXN1bHRzXzEucmVzdWx0c1syXSxcbiAgICAgICAgICAgICAgICBzdHJpbmdpZmllcjogZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIudmFsdWU7IH0sXG4gICAgICAgICAgICAgICAgb25TZWFyY2g6IG9uU2VhcmNoKHRoaXMpLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBvbkNoYW5nZSh0aGlzKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZXNjOiB7XG4gICAgICAgICAgICAgICAgaWQ6ICdkZXNjJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnZGVzYycsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdEZXNjZW5kaW5nJyxcbiAgICAgICAgICAgICAgICBzdHJpbmdpZmllcjogZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIudmFsdWU7IH0sXG4gICAgICAgICAgICAgICAgb25TZWFyY2g6IG9uU2VhcmNoKHRoaXMpLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBvbkNoYW5nZSh0aGlzKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWNjZXNzOiB7XG4gICAgICAgICAgICAgICAgaWQ6ICdzdWNjZXNzJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnc3VjY2VzcycsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdTdWNjZXNzJyxcbiAgICAgICAgICAgICAgICBzdHJpbmdpZmllcjogZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIudmFsdWU7IH0sXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1RoaXMgaGFzIGEgc3VjY2VzcyBtZXNzYWdlLicsXG4gICAgICAgICAgICAgICAgb25TZWFyY2g6IG9uU2VhcmNoKHRoaXMpLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBvbkNoYW5nZSh0aGlzKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3YXJuaW5nOiB7XG4gICAgICAgICAgICAgICAgaWQ6ICd3YXJuaW5nJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnd2FybmluZycsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdXYXJuaW5nJyxcbiAgICAgICAgICAgICAgICBzdHJpbmdpZmllcjogZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIudmFsdWU7IH0sXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1RoaXMgaGFzIGEgd2FybmluZyBtZXNzYWdlLicsXG4gICAgICAgICAgICAgICAgb25TZWFyY2g6IG9uU2VhcmNoKHRoaXMpLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBvbkNoYW5nZSh0aGlzKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgICAgIGlkOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgIG5hbWU6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdFcnJvcicsXG4gICAgICAgICAgICAgICAgc3RyaW5naWZpZXI6IGZ1bmN0aW9uIChyKSB7IHJldHVybiByLnZhbHVlOyB9LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdUaGlzIGhhcyBhIGVycm9yIG1lc3NhZ2UuJyxcbiAgICAgICAgICAgICAgICBvblNlYXJjaDogb25TZWFyY2godGhpcyksXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IG9uQ2hhbmdlKHRoaXMpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIFN0YWNrU2VsZWN0UGFnZTtcbn0oKSk7XG5leHBvcnRzLlN0YWNrU2VsZWN0UGFnZSA9IFN0YWNrU2VsZWN0UGFnZTtcbnZhciBvblNlYXJjaCA9IGZ1bmN0aW9uIChwYWdlKSB7IHJldHVybiBmdW5jdGlvbiAoX2EpIHtcbiAgICB2YXIgbmFtZSA9IF9hLm5hbWUsIHZhbHVlID0gX2EudmFsdWU7XG4gICAgcmV0dXJuIHBhZ2VcbiAgICAgICAgLnZpZXdcbiAgICAgICAgLmZpbmRCeUlkKG5hbWUpXG4gICAgICAgIC5tYXAoZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgdmFyIGhpdCA9IHJlc3VsdHNfMS5yZXN1bHRzLmZpbHRlcihmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgcmV0dXJuIGMudmFsdWUudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKHZhbHVlKSA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHMudXBkYXRlKGhpdCk7XG4gICAgfSk7XG59OyB9O1xudmFyIG9uQ2hhbmdlID0gZnVuY3Rpb24gKHBhZ2UpIHsgcmV0dXJuIGZ1bmN0aW9uIChfYSkge1xuICAgIHZhciBuYW1lID0gX2EubmFtZSwgdmFsdWUgPSBfYS52YWx1ZTtcbiAgICByZXR1cm4gcGFnZVxuICAgICAgICAudmlld1xuICAgICAgICAuZmluZEJ5SWQobmFtZSlcbiAgICAgICAgLm1hcChmdW5jdGlvbiAodCkge1xuICAgICAgICB0LnNldE1lc3NhZ2UoXCJDb3VudDogXCIgKyB2YWx1ZS5sZW5ndGgpO1xuICAgIH0pO1xufTsgfTtcbmV4cG9ydHMuZGVmYXVsdCA9IG5ldyBTdGFja1NlbGVjdFBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xudmFyIHN0YWNrX3NlbGVjdF8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL3N0YWNrLXNlbGVjdFwiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgc3RhY2tfc2VsZWN0XzEuU3RhY2tTZWxlY3QoeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5hc2MuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmFzYy5uYW1lLCAnbGFiZWwnOiBfX2NvbnRleHQudmFsdWVzLmFzYy5sYWJlbCwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5hc2Muc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMuYXNjLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLmFzYy5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5hc2MuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmFzYy5uYW1lLCAnbGFiZWwnOiBfX2NvbnRleHQudmFsdWVzLmFzYy5sYWJlbCwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5hc2Muc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMuYXNjLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLmFzYy5vbkNoYW5nZSB9IH0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBzdGFja19zZWxlY3RfMS5TdGFja1NlbGVjdCh7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmRlc2MuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmRlc2MubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy5kZXNjLmxhYmVsLCAnZGlyJzogLTEsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMuZGVzYy5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5kZXNjLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLmRlc2Mub25DaGFuZ2UgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuZGVzYy5pZCB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuZGVzYy5uYW1lLCAnbGFiZWwnOiBfX2NvbnRleHQudmFsdWVzLmRlc2MubGFiZWwsICdkaXInOiAtMSwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5kZXNjLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLmRlc2Mub25TZWFyY2gsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMuZGVzYy5vbkNoYW5nZSB9IH0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBzdGFja19zZWxlY3RfMS5TdGFja1NlbGVjdCh7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3MuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3MubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLmxhYmVsLCAnc3VjY2Vzcyc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5tZXNzYWdlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3Muc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLm9uQ2hhbmdlIH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3MuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3MubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLmxhYmVsLCAnc3VjY2Vzcyc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5tZXNzYWdlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3Muc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLm9uQ2hhbmdlIH0gfSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHN0YWNrX3NlbGVjdF8xLlN0YWNrU2VsZWN0KHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5pZCB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5uYW1lLCAnbGFiZWwnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcubGFiZWwsICd3YXJuaW5nJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLm1lc3NhZ2UsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcub25DaGFuZ2UgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5pZCB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5uYW1lLCAnbGFiZWwnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcubGFiZWwsICd3YXJuaW5nJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLm1lc3NhZ2UsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcub25DaGFuZ2UgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgc3RhY2tfc2VsZWN0XzEuU3RhY2tTZWxlY3QoeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5pZCB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5sYWJlbCwgJ2Vycm9yJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5tZXNzYWdlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLm9uQ2hhbmdlIH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLmlkIH0sIHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5uYW1lLCAnbGFiZWwnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLmxhYmVsLCAnZXJyb3InOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLm1lc3NhZ2UsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMuZXJyb3Iuc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3Iub25TZWFyY2gsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3Iub25DaGFuZ2UgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgc3RhY2tfc2VsZWN0XzEuU3RhY2tTZWxlY3QoeyB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuYXNjLm5hbWUsICdsYWJlbCc6ICdEaXNhYmxlZCcsICdkaXNhYmxlZCc6IHRydWUsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMuYXNjLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLmFzYy5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5hc2Mub25DaGFuZ2UgfSB9LCBbXSksIHsgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmFzYy5uYW1lLCAnbGFiZWwnOiAnRGlzYWJsZWQnLCAnZGlzYWJsZWQnOiB0cnVlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLmFzYy5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5hc2Mub25TZWFyY2gsICdvbkNoYW5nZSc6IF9fY29udGV4dC52YWx1ZXMuYXNjLm9uQ2hhbmdlIH0gfSlcbiAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICBdKSwge30pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c3RhY2stc2VsZWN0LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5TdGFja1BhZ2UgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvc3RhY2tcIik7XG52YXIgX2dldFZhbHVlcyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFtcbiAgICB7IGxhYmVsOiAnQXN1cycsIHZhbHVlOiAnQXN1cycgfSxcbiAgICB7IGxhYmVsOiAnTVNJJywgdmFsdWU6ICdNU0knIH0sXG4gICAgeyBsYWJlbDogJ01TSScsIHZhbHVlOiAnTVNJJyB9LFxuICAgIHsgbGFiZWw6ICdHaWdhYnl0ZScsIHZhbHVlOiAnR2lnYWJ5dGUnIH1cbl07IH07XG52YXIgX2dldFRleHQgPSBmdW5jdGlvbiAobSkge1xuICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShtLm1hcChmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgdmFyIGxhYmVsID0gX2EubGFiZWw7XG4gICAgICAgIHJldHVybiBsYWJlbDtcbiAgICB9KS5qb2luKCcsJykpO1xufTtcbnZhciBTdGFja1BhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gU3RhY2tQYWdlKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICB2YWx1ZXM6IF9nZXRWYWx1ZXMoKSxcbiAgICAgICAgICAgIHRleHQ6IF9nZXRUZXh0KF9nZXRWYWx1ZXMoKSksXG4gICAgICAgICAgICBkZWNvcmF0b3I6IGZ1bmN0aW9uIChtKSB7IHJldHVybiBtLmxhYmVsOyB9XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMub25DaGFuZ2UgPSBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IF9hLnZhbHVlO1xuICAgICAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgICAgICBfdGhpcy52YWx1ZXMudmFsdWVzID0gX2dldFZhbHVlcygpO1xuICAgICAgICAgICAgX3RoaXMudmFsdWVzLnRleHQgPSBfZ2V0VGV4dChfdGhpcy52YWx1ZXMudmFsdWVzKTtcbiAgICAgICAgICAgIF90aGlzLnZpZXcuaW52YWxpZGF0ZSgpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gU3RhY2tQYWdlO1xufSgpKTtcbmV4cG9ydHMuU3RhY2tQYWdlID0gU3RhY2tQYWdlO1xuZXhwb3J0cy5kZWZhdWx0ID0gbmV3IFN0YWNrUGFnZSgpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG52YXIgc3RhY2tfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvY29udHJvbC9zdGFja1wiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdNZW1iZXJzOiAnKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2InLCB7IHdtbDogeyAnaWQnOiAnc2VsZWN0ZWQnIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19jb250ZXh0LnZhbHVlcy50ZXh0XG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcuJylcbiAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHN0YWNrXzEuU3RhY2soeyB3dzogeyAnbmFtZSc6ICdzdGFjaycsICd2YWx1ZSc6IF9fY29udGV4dC52YWx1ZXMudmFsdWVzLCAnZGVjb3JhdG9yJzogX19jb250ZXh0LnZhbHVlcy5kZWNvcmF0b3IsICdvbkNoYW5nZSc6IF9fY29udGV4dC5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3dzogeyAnbmFtZSc6ICdzdGFjaycsICd2YWx1ZSc6IF9fY29udGV4dC52YWx1ZXMudmFsdWVzLCAnZGVjb3JhdG9yJzogX19jb250ZXh0LnZhbHVlcy5kZWNvcmF0b3IsICdvbkNoYW5nZSc6IF9fY29udGV4dC5vbkNoYW5nZSB9IH0pXG4gICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdEaXNhYmxlZCcpXG4gICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBzdGFja18xLlN0YWNrKHsgd3c6IHsgJ25hbWUnOiAnc3RhY2snLCAndmFsdWUnOiBfX2NvbnRleHQudmFsdWVzLnZhbHVlcywgJ2Rpc2FibGVkJzogdHJ1ZSwgJ2RlY29yYXRvcic6IF9fY29udGV4dC52YWx1ZXMuZGVjb3JhdG9yLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQub25DaGFuZ2UgfSB9LCBbXSksIHsgd3c6IHsgJ25hbWUnOiAnc3RhY2snLCAndmFsdWUnOiBfX2NvbnRleHQudmFsdWVzLnZhbHVlcywgJ2Rpc2FibGVkJzogdHJ1ZSwgJ2RlY29yYXRvcic6IF9fY29udGV4dC52YWx1ZXMuZGVjb3JhdG9yLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQub25DaGFuZ2UgfSB9KVxuICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICBdKSwge30pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c3RhY2suanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlN3aXRjaFBhZ2UgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvc3dpdGNoXCIpO1xudmFyIFN3aXRjaFBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gU3dpdGNoUGFnZSgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4odGhpcyk7XG4gICAgICAgIHRoaXMudmFsdWUgPSB0cnVlO1xuICAgICAgICB0aGlzLm9uQ2hhbmdlID0gZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBfYS52YWx1ZTtcbiAgICAgICAgICAgIF90aGlzLnZpZXcuZmluZEJ5SWQoJ2NvbnRlbnQnKVxuICAgICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoZS5maXJzdENoaWxkKVxuICAgICAgICAgICAgICAgICAgICBlLnJlbW92ZUNoaWxkKGUuZmlyc3RDaGlsZCk7XG4gICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh2YWx1ZSA9PT0gdHJ1ZSA/XG4gICAgICAgICAgICAgICAgICAgICdvbicgOlxuICAgICAgICAgICAgICAgICAgICAodmFsdWUgPT09IGZhbHNlID8gJ29mZicgOiAnZXJyb3InKSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBTd2l0Y2hQYWdlO1xufSgpKTtcbmV4cG9ydHMuU3dpdGNoUGFnZSA9IFN3aXRjaFBhZ2U7XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgU3dpdGNoUGFnZSgpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG52YXIgc3dpdGNoXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2NvbnRyb2wvc3dpdGNoXCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdUaGUgc3dpdGNoIGlzIGFscmVhZHkgc2V0LicpXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBzd2l0Y2hfMS5Td2l0Y2goeyB3dzogeyAnbmFtZSc6ICdzd2l0Y2gnLCAndmFsdWUnOiB0cnVlIH0gfSwgW10pLCB7IHd3OiB7ICduYW1lJzogJ3N3aXRjaCcsICd2YWx1ZSc6IHRydWUgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnVGhlIHN3aXRjaCBpcyAnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdiJywgeyB3bWw6IHsgJ2lkJzogJ2NvbnRlbnQnIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ3VudG91Y2hlZCcpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJy4nKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgc3dpdGNoXzEuU3dpdGNoKHsgd3c6IHsgJ25hbWUnOiAnc3dpdGNoJywgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlIH0gfSwgW10pLCB7IHd3OiB7ICduYW1lJzogJ3N3aXRjaCcsICdvbkNoYW5nZSc6IF9fY29udGV4dC5vbkNoYW5nZSB9IH0pXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgXSksIHt9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXN3aXRjaC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuVGFiQmFyUGFnZSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC90YWItYmFyXCIpO1xudmFyIFRhYkJhclBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVGFiQmFyUGFnZSgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4odGhpcyk7XG4gICAgICAgIHRoaXMudGFiID0gJ0ZpcnN0JztcbiAgICAgICAgdGhpcy5jb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0ZpcnN0IFRhYicpO1xuICAgICAgICB0aGlzLmNsaWNrZWQgPSBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgIHZhciBuYW1lID0gX2EubmFtZTtcbiAgICAgICAgICAgIF90aGlzLnRhYiA9IG5hbWU7XG4gICAgICAgICAgICBfdGhpcy5jb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobmFtZSArIFwiIFRhYlwiKTtcbiAgICAgICAgICAgIF90aGlzLnZpZXcuaW52YWxpZGF0ZSgpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gVGFiQmFyUGFnZTtcbn0oKSk7XG5leHBvcnRzLlRhYkJhclBhZ2UgPSBUYWJCYXJQYWdlO1xuZXhwb3J0cy5kZWZhdWx0ID0gbmV3IFRhYkJhclBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xudmFyIHRhYl9iYXJfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvY29udHJvbC90YWItYmFyXCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWJfYmFyXzEuVGFiQmFyKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWJfYmFyXzEuVGFiKHsgd3c6IHsgJ2FjdGl2ZSc6IChfX2NvbnRleHQudGFiID09PSAnRmlyc3QnKSwgJ3RleHQnOiAnRmlyc3QnLCAnbmFtZSc6ICdGaXJzdCcsICdvbkNsaWNrJzogX19jb250ZXh0LmNsaWNrZWQgfSB9LCBbXSksIHsgd3c6IHsgJ2FjdGl2ZSc6IChfX2NvbnRleHQudGFiID09PSAnRmlyc3QnKSwgJ3RleHQnOiAnRmlyc3QnLCAnbmFtZSc6ICdGaXJzdCcsICdvbkNsaWNrJzogX19jb250ZXh0LmNsaWNrZWQgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYl9iYXJfMS5UYWIoeyB3dzogeyAnYWN0aXZlJzogKF9fY29udGV4dC50YWIgPT09ICdTZWNvbmQnKSwgJ3RleHQnOiAnU2Vjb25kJywgJ25hbWUnOiAnU2Vjb25kJywgJ29uQ2xpY2snOiBfX2NvbnRleHQuY2xpY2tlZCB9IH0sIFtdKSwgeyB3dzogeyAnYWN0aXZlJzogKF9fY29udGV4dC50YWIgPT09ICdTZWNvbmQnKSwgJ3RleHQnOiAnU2Vjb25kJywgJ25hbWUnOiAnU2Vjb25kJywgJ29uQ2xpY2snOiBfX2NvbnRleHQuY2xpY2tlZCB9IH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFiX2Jhcl8xLlRhYih7IHd3OiB7ICdhY3RpdmUnOiAoX19jb250ZXh0LnRhYiA9PT0gJ1RoaXJkJyksICd0ZXh0JzogJ1RoaXJkJywgJ25hbWUnOiAnVGhpcmQnLCAnb25DbGljayc6IF9fY29udGV4dC5jbGlja2VkIH0gfSwgW10pLCB7IHd3OiB7ICdhY3RpdmUnOiAoX19jb250ZXh0LnRhYiA9PT0gJ1RoaXJkJyksICd0ZXh0JzogJ1RoaXJkJywgJ25hbWUnOiAnVGhpcmQnLCAnb25DbGljayc6IF9fY29udGV4dC5jbGlja2VkIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFiX2Jhcl8xLlRhYkJhcih7IHd3OiB7ICdqdXN0aWZ5JzogdHJ1ZSB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYl9iYXJfMS5UYWIoeyB3dzogeyAnYWN0aXZlJzogKF9fY29udGV4dC50YWIgPT09ICdGaXJzdCcpLCAndGV4dCc6ICdGaXJzdCcsICduYW1lJzogJ0ZpcnN0JywgJ29uQ2xpY2snOiBfX2NvbnRleHQuY2xpY2tlZCB9IH0sIFtdKSwgeyB3dzogeyAnYWN0aXZlJzogKF9fY29udGV4dC50YWIgPT09ICdGaXJzdCcpLCAndGV4dCc6ICdGaXJzdCcsICduYW1lJzogJ0ZpcnN0JywgJ29uQ2xpY2snOiBfX2NvbnRleHQuY2xpY2tlZCB9IH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFiX2Jhcl8xLlRhYih7IHd3OiB7ICdhY3RpdmUnOiAoX19jb250ZXh0LnRhYiA9PT0gJ1NlY29uZCcpLCAndGV4dCc6ICdTZWNvbmQnLCAnbmFtZSc6ICdTZWNvbmQnLCAnb25DbGljayc6IF9fY29udGV4dC5jbGlja2VkIH0gfSwgW10pLCB7IHd3OiB7ICdhY3RpdmUnOiAoX19jb250ZXh0LnRhYiA9PT0gJ1NlY29uZCcpLCAndGV4dCc6ICdTZWNvbmQnLCAnbmFtZSc6ICdTZWNvbmQnLCAnb25DbGljayc6IF9fY29udGV4dC5jbGlja2VkIH0gfSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWJfYmFyXzEuVGFiKHsgd3c6IHsgJ2FjdGl2ZSc6IChfX2NvbnRleHQudGFiID09PSAnVGhpcmQnKSwgJ3RleHQnOiAnVGhpcmQnLCAnbmFtZSc6ICdUaGlyZCcsICdvbkNsaWNrJzogX19jb250ZXh0LmNsaWNrZWQgfSB9LCBbXSksIHsgd3c6IHsgJ2FjdGl2ZSc6IChfX2NvbnRleHQudGFiID09PSAnVGhpcmQnKSwgJ3RleHQnOiAnVGhpcmQnLCAnbmFtZSc6ICdUaGlyZCcsICdvbkNsaWNrJzogX19jb250ZXh0LmNsaWNrZWQgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnanVzdGlmeSc6IHRydWUgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7IHdtbDogeyAnaWQnOiAnY29udGVudCcgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2NvbnRleHQuY29udGVudFxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD10YWItYmFyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5UYWdQYWdlID0gdm9pZCAwO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL3RhZ1wiKTtcbnZhciBzdHlsZV8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uL2xpYi9jb250ZW50L3N0eWxlXCIpO1xudmFyIGdldFN0eWxlcyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFtcbiAgICBzdHlsZV8xLlN0eWxlLkRlZmF1bHQsXG4gICAgc3R5bGVfMS5TdHlsZS5QcmltYXJ5LFxuICAgIHN0eWxlXzEuU3R5bGUuU3VjY2VzcyxcbiAgICBzdHlsZV8xLlN0eWxlLkluZm8sXG4gICAgc3R5bGVfMS5TdHlsZS5XYXJuaW5nLFxuICAgIHN0eWxlXzEuU3R5bGUuRXJyb3Jcbl07IH07XG52YXIgVGFnUGFnZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBUYWdQYWdlKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBjYXBpdGFsaXplOiBmdW5jdGlvbiAocykgeyByZXR1cm4gXCJcIiArIHNbMF0udG9VcHBlckNhc2UoKSArIHMuc2xpY2UoMSk7IH0sXG4gICAgICAgICAgICBzdHlsZXM6IGdldFN0eWxlcygpLFxuICAgICAgICAgICAgb25EaXNtaXNzOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIHZhciBpZHggPSBfdGhpcy52YWx1ZXMuc3R5bGVzLmluZGV4T2YoZS5uYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAoaWR4ID4gLTEpXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnZhbHVlcy5zdHlsZXMuc3BsaWNlKGlkeCwgMSk7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLnZhbHVlcy5zdHlsZXMubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgICAgICAgICBfdGhpcy52YWx1ZXMuc3R5bGVzID0gZ2V0U3R5bGVzKCk7XG4gICAgICAgICAgICAgICAgX3RoaXMudmlldy5pbnZhbGlkYXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBUYWdQYWdlO1xufSgpKTtcbmV4cG9ydHMuVGFnUGFnZSA9IFRhZ1BhZ2U7XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgVGFnUGFnZSgpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheXMgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXlzKSB8fCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7XG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcbiAgICAgICAgICAgIHJba10gPSBhW2pdO1xuICAgIHJldHVybiByO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG52YXIgdGFnXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2NvbnRyb2wvdGFnXCIpO1xuO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdoMScsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdUYWcnKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgX19zcHJlYWRBcnJheXMoW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gyJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdTdHlsZXMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgXSwgX19mb3JJbihfX2NvbnRleHQudmFsdWVzLnN0eWxlcywgZnVuY3Rpb24gKHYsIF8kJGksIF8kJGFsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFnXzEuVGFnKHsgd3c6IHsgJ3N0eWxlJzogdiwgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmNhcGl0YWxpemUodiksICduYW1lJzogdiwgJ29uRGlzbWlzcyc6IF9fY29udGV4dC52YWx1ZXMub25EaXNtaXNzIH0gfSwgW10pLCB7IHd3OiB7ICdzdHlsZSc6IHYsICd0ZXh0JzogX19jb250ZXh0LnZhbHVlcy5jYXBpdGFsaXplKHYpLCAnbmFtZSc6IHYsICdvbkRpc21pc3MnOiBfX2NvbnRleHQudmFsdWVzLm9uRGlzbWlzcyB9IH0pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtdKTsgfSkpKVxuICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD10YWcuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlRleHRGaWVsZFBhZ2UgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvdGV4dC1maWVsZFwiKTtcbnZhciBmZWVkYmFja18xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL2ZlZWRiYWNrXCIpO1xudmFyIFRleHRGaWVsZFBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVGV4dEZpZWxkUGFnZSgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5pZCA9ICd0ZXh0JztcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4odGhpcyk7XG4gICAgICAgIHRoaXMub25DaGFuZ2UgPSBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgIHZhciBuYW1lID0gX2EubmFtZSwgdmFsdWUgPSBfYS52YWx1ZTtcbiAgICAgICAgICAgIHZhciBtYXliZUZpZWxkID0gX3RoaXMudmlldy5maW5kQnlJZChuYW1lKTtcbiAgICAgICAgICAgIGlmIChtYXliZUZpZWxkLmlzSnVzdCgpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSBtYXliZUZpZWxkLmdldCgpO1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbmV1dHJhbCc6XG4gICAgICAgICAgICAgICAgICAgICAgICB0LnNldFZhbGlkYXRpb25TdGF0ZShmZWVkYmFja18xLlZhbGlkYXRpb25TdGF0ZS5OZXV0cmFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdlcnJvcic6XG4gICAgICAgICAgICAgICAgICAgICAgICB0LnNldFZhbGlkYXRpb25TdGF0ZShmZWVkYmFja18xLlZhbGlkYXRpb25TdGF0ZS5FcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc3VjY2Vzcyc6XG4gICAgICAgICAgICAgICAgICAgICAgICB0LnNldFZhbGlkYXRpb25TdGF0ZShmZWVkYmFja18xLlZhbGlkYXRpb25TdGF0ZS5TdWNjZXNzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICd3YXJuaW5nJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHQuc2V0VmFsaWRhdGlvblN0YXRlKGZlZWRiYWNrXzEuVmFsaWRhdGlvblN0YXRlLldhcm5pbmcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdC5zZXRNZXNzYWdlKFwiTWVzc2FnZTogXCIgKyB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBUZXh0RmllbGRQYWdlO1xufSgpKTtcbmV4cG9ydHMuVGV4dEZpZWxkUGFnZSA9IFRleHRGaWVsZFBhZ2U7XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgVGV4dEZpZWxkUGFnZSgpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG52YXIgdGV4dF9maWVsZF8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL3RleHQtZmllbGRcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1RoZSB2YWx1ZSBvZiB0aGUgaW5wdXQgaXM6JylcbiAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdiJywgeyB3bWw6IHsgJ2lkJzogJ2NvbnRlbnQnIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ05vdGhpbmcnKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRleHRfZmllbGRfMS5UZXh0RmllbGQoeyB3bWw6IHsgJ2lkJzogJ3RleHQnIH0sIHd3OiB7ICduYW1lJzogJ3RleHQnLCAnbWVzc2FnZSc6ICdUaGlzIGlzIHRoZSBoZWxwIG1lc3NhZ2UnLCAnZm9jdXMnOiB0cnVlLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQub25DaGFuZ2UgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6ICd0ZXh0JyB9LCB3dzogeyAnbmFtZSc6ICd0ZXh0JywgJ21lc3NhZ2UnOiAnVGhpcyBpcyB0aGUgaGVscCBtZXNzYWdlJywgJ2ZvY3VzJzogdHJ1ZSwgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdzdHJvbmcnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1N1Y2Nlc3MnKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRleHRfZmllbGRfMS5UZXh0RmllbGQoeyB3bWw6IHsgJ2lkJzogJ3N1Y2Nlc3MnIH0sIHd3OiB7ICduYW1lJzogJ3N1Y2Nlc3MnLCAnbGFiZWwnOiAnVGhpcyBpcyBhIHN1Y2Nlc3MgbGFiZWwnLCAnc3VjY2Vzcyc6ICdUaGlzIHRleHRmaWVsZCBoYXMgYSBzdWNjZXNzJywgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlIH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiAnc3VjY2VzcycgfSwgd3c6IHsgJ25hbWUnOiAnc3VjY2VzcycsICdsYWJlbCc6ICdUaGlzIGlzIGEgc3VjY2VzcyBsYWJlbCcsICdzdWNjZXNzJzogJ1RoaXMgdGV4dGZpZWxkIGhhcyBhIHN1Y2Nlc3MnLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQub25DaGFuZ2UgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3N0cm9uZycsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnV2FybmluZycpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGV4dF9maWVsZF8xLlRleHRGaWVsZCh7IHdtbDogeyAnaWQnOiAnd2FybmluZycgfSwgd3c6IHsgJ25hbWUnOiAnd2FybmluZycsICdsYWJlbCc6ICdUaGlzIGlzIGEgd2FybmluZyBsYWJlbCcsICd3YXJuaW5nJzogJ1RoaXMgdGV4dGZpZWxkIGhhcyBhIHdhcm5pbmcuJywgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlIH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiAnd2FybmluZycgfSwgd3c6IHsgJ25hbWUnOiAnd2FybmluZycsICdsYWJlbCc6ICdUaGlzIGlzIGEgd2FybmluZyBsYWJlbCcsICd3YXJuaW5nJzogJ1RoaXMgdGV4dGZpZWxkIGhhcyBhIHdhcm5pbmcuJywgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdzdHJvbmcnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0Vycm9yJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0ZXh0X2ZpZWxkXzEuVGV4dEZpZWxkKHsgd21sOiB7ICdpZCc6ICdlcnJvcicgfSwgd3c6IHsgJ25hbWUnOiAnZXJyb3InLCAnbGFiZWwnOiAnVGhpcyBpcyBhbiBlcnJvciBsYWJlbCcsICdlcnJvcic6ICdUaGlzIHRleHRmaWVsZCBoYXMgYW4gZXJyb3IuJywgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlIH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiAnZXJyb3InIH0sIHd3OiB7ICduYW1lJzogJ2Vycm9yJywgJ2xhYmVsJzogJ1RoaXMgaXMgYW4gZXJyb3IgbGFiZWwnLCAnZXJyb3InOiAnVGhpcyB0ZXh0ZmllbGQgaGFzIGFuIGVycm9yLicsICdvbkNoYW5nZSc6IF9fY29udGV4dC5vbkNoYW5nZSB9IH0pXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdUaGUgb25lIHVzZXMgcm93cyB0byByZW5kZXIgYSB0ZXh0IGFyZWE6JylcbiAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRleHRfZmllbGRfMS5UZXh0RmllbGQoeyB3bWw6IHsgJ2lkJzogJ2FyZWEnIH0sIHd3OiB7ICduYW1lJzogJ2FyZWEnLCAncm93cyc6IDUsICdsYWJlbCc6ICdUaGlzIGlzIGEgdGV4dGFyZWEgbGFiZWwnLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQub25DaGFuZ2UgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6ICdhcmVhJyB9LCB3dzogeyAnbmFtZSc6ICdhcmVhJywgJ3Jvd3MnOiA1LCAnbGFiZWwnOiAnVGhpcyBpcyBhIHRleHRhcmVhIGxhYmVsJywgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICBdKSwge30pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dGV4dC1maWVsZC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuVGV4dElucHV0UGFnZSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC90ZXh0LWlucHV0XCIpO1xudmFyIHNpemVfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi9saWIvY29udGVudC9zaXplXCIpO1xudmFyIFRleHRJbnB1dFBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVGV4dElucHV0UGFnZSgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4odGhpcyk7XG4gICAgICAgIHRoaXMuc2l6ZXMgPSBbXG4gICAgICAgICAgICBzaXplXzEuU2l6ZS5FeHRyYVNtYWxsLFxuICAgICAgICAgICAgc2l6ZV8xLlNpemUuU21hbGwsXG4gICAgICAgICAgICBzaXplXzEuU2l6ZS5NZWRpdW0sXG4gICAgICAgICAgICBzaXplXzEuU2l6ZS5MYXJnZSxcbiAgICAgICAgICAgIHNpemVfMS5TaXplLkV4dHJhTGFyZ2VcbiAgICAgICAgXTtcbiAgICAgICAgdGhpcy5jb250ZW50ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ3RoaXMnKTsgfTtcbiAgICAgICAgdGhpcy5vbkNoYW5nZSA9IGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gX2EudmFsdWU7XG4gICAgICAgICAgICBfdGhpc1xuICAgICAgICAgICAgICAgIC52aWV3XG4gICAgICAgICAgICAgICAgLmZpbmRCeUlkKCd0eHQnKVxuICAgICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGgpIHsgcmV0dXJuIGguaW5uZXJIVE1MID0gdmFsdWU7IH0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gVGV4dElucHV0UGFnZTtcbn0oKSk7XG5leHBvcnRzLlRleHRJbnB1dFBhZ2UgPSBUZXh0SW5wdXRQYWdlO1xuZXhwb3J0cy5kZWZhdWx0ID0gbmV3IFRleHRJbnB1dFBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIHRleHRfaW5wdXRfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvY29udHJvbC90ZXh0LWlucHV0XCIpO1xuO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1xcdTAwMGEgICAgICBUaGlzIGlzIGEgdGV4dCBpbnB1dDogXFx1MDAwYSAgICAgICcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGV4dF9pbnB1dF8xLlRleHRJbnB1dCh7IHd3OiB7ICdtYXRjaCc6ICdbYS16QS1aXScsICdsZW5ndGgnOiAyMCwgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlIH0gfSwgW10pLCB7IHd3OiB7ICdtYXRjaCc6ICdbYS16QS1aXScsICdsZW5ndGgnOiAyMCwgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlIH0gfSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcuXFx1MDAwYSAgICAnKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnQXMgeW91IHR5cGUgJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnYicsIHsgd21sOiB7ICdpZCc6ICd0eHQnIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ3RoaXMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcgY2hhbmdlcywgYnV0IG9ubHkgZm9yIGxldHRlcnMuICgyMCknKVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIF9fc3ByZWFkQXJyYXlzKF9fZm9ySW4oX19jb250ZXh0LnNpemVzLCBmdW5jdGlvbiAodiwgXyQkaSwgXyQkYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1xcdTAwMGEgICAgICAgIFNpemUgJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoKHYgKyAnIG5ldXRyYWw6ICcpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0ZXh0X2lucHV0XzEuVGV4dElucHV0KHsgd3c6IHsgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlLCAnc2l6ZSc6IHYgfSB9LCBbXSksIHsgd3c6IHsgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlLCAnc2l6ZSc6IHYgfSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnXFx1MDAwYSAgICAgICAgU2l6ZSAnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgodiArICcgZXJyb3I6ICcpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0ZXh0X2lucHV0XzEuVGV4dElucHV0KHsgd3c6IHsgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlLCAnc2l6ZSc6IHYsICdjbGFzc05hbWUnOiAnLWVycm9yJyB9IH0sIFtdKSwgeyB3dzogeyAnb25DaGFuZ2UnOiBfX2NvbnRleHQub25DaGFuZ2UsICdzaXplJzogdiwgJ2NsYXNzTmFtZSc6ICctZXJyb3InIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1xcdTAwMGEgICAgICAgIFNpemUgJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoKHYgKyAnIHdhcm5pbmc6ICcpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0ZXh0X2lucHV0XzEuVGV4dElucHV0KHsgd3c6IHsgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlLCAnc2l6ZSc6IHYsICdjbGFzc05hbWUnOiAnLXdhcm5pbmcnIH0gfSwgW10pLCB7IHd3OiB7ICdvbkNoYW5nZSc6IF9fY29udGV4dC5vbkNoYW5nZSwgJ3NpemUnOiB2LCAnY2xhc3NOYW1lJzogJy13YXJuaW5nJyB9IH0pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdcXHUwMDBhICAgICAgICBTaXplICcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCh2ICsgJyBzdWNjZXNzOiAnKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGV4dF9pbnB1dF8xLlRleHRJbnB1dCh7IHd3OiB7ICdvbkNoYW5nZSc6IF9fY29udGV4dC5vbkNoYW5nZSwgJ3NpemUnOiB2LCAnY2xhc3NOYW1lJzogJy1zdWNjZXNzJyB9IH0sIFtdKSwgeyB3dzogeyAnb25DaGFuZ2UnOiBfX2NvbnRleHQub25DaGFuZ2UsICdzaXplJzogdiwgJ2NsYXNzTmFtZSc6ICctc3VjY2VzcycgfSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtdKTsgfSkpKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1xcdTAwMGEgICAgICBCbG9jazpcXHUwMDBhICAgICAgJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0ZXh0X2lucHV0XzEuVGV4dElucHV0KHsgd3c6IHsgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlLCAnYmxvY2snOiB0cnVlIH0gfSwgW10pLCB7IHd3OiB7ICdvbkNoYW5nZSc6IF9fY29udGV4dC5vbkNoYW5nZSwgJ2Jsb2NrJzogdHJ1ZSB9IH0pXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJyBUZXh0YXJlYTogJylcbiAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgX19zcHJlYWRBcnJheXMoX19mb3JJbihfX2NvbnRleHQuc2l6ZXMsIGZ1bmN0aW9uICh2LCBfJCRpLCBfJCRhbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnXFx1MDAwYSAgICAgICAgU2l6ZSAnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgodiArICcgbmV1dHJhbDogJykpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRleHRfaW5wdXRfMS5UZXh0SW5wdXQoeyB3dzogeyAnb25DaGFuZ2UnOiBfX2NvbnRleHQub25DaGFuZ2UsICdyb3dzJzogNSwgJ3NpemUnOiB2IH0gfSwgW10pLCB7IHd3OiB7ICdvbkNoYW5nZSc6IF9fY29udGV4dC5vbkNoYW5nZSwgJ3Jvd3MnOiA1LCAnc2l6ZSc6IHYgfSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnXFx1MDAwYSAgICAgICAgU2l6ZSAnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgodiArICcgZXJyb3I6ICcpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0ZXh0X2lucHV0XzEuVGV4dElucHV0KHsgd3c6IHsgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlLCAnc2l6ZSc6IHYsICdyb3dzJzogNSwgJ2NsYXNzTmFtZSc6ICctZXJyb3InIH0gfSwgW10pLCB7IHd3OiB7ICdvbkNoYW5nZSc6IF9fY29udGV4dC5vbkNoYW5nZSwgJ3NpemUnOiB2LCAncm93cyc6IDUsICdjbGFzc05hbWUnOiAnLWVycm9yJyB9IH0pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdcXHUwMDBhICAgICAgICBTaXplICcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCh2ICsgJyB3YXJuaW5nOiAnKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGV4dF9pbnB1dF8xLlRleHRJbnB1dCh7IHd3OiB7ICdvbkNoYW5nZSc6IF9fY29udGV4dC5vbkNoYW5nZSwgJ3NpemUnOiB2LCAncm93cyc6IDUsICdjbGFzc05hbWUnOiAnLXdhcm5pbmcnIH0gfSwgW10pLCB7IHd3OiB7ICdvbkNoYW5nZSc6IF9fY29udGV4dC5vbkNoYW5nZSwgJ3NpemUnOiB2LCAncm93cyc6IDUsICdjbGFzc05hbWUnOiAnLXdhcm5pbmcnIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1xcdTAwMGEgICAgICAgIFNpemUgJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoKHYgKyAnIHN1Y2Nlc3M6ICcpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0ZXh0X2lucHV0XzEuVGV4dElucHV0KHsgd3c6IHsgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlLCAnc2l6ZSc6IHYsICdyb3dzJzogNSwgJ2NsYXNzTmFtZSc6ICctc3VjY2VzcycgfSB9LCBbXSksIHsgd3c6IHsgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlLCAnc2l6ZSc6IHYsICdyb3dzJzogNSwgJ2NsYXNzTmFtZSc6ICctc3VjY2VzcycgfSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gKFtdKTsgfSkpKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1xcdTAwMGEgICAgICBCbG9jazpcXHUwMDBhICAgICAgJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0ZXh0X2lucHV0XzEuVGV4dElucHV0KHsgd3c6IHsgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlLCAnYmxvY2snOiB0cnVlLCAncm93cyc6IDUgfSB9LCBbXSksIHsgd3c6IHsgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlLCAnYmxvY2snOiB0cnVlLCAncm93cyc6IDUgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnXFx1MDAwYSAgICAgIEF1dG9mb2N1c2VkOlxcdTAwMGEgICAgICAnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRleHRfaW5wdXRfMS5UZXh0SW5wdXQoeyB3dzogeyAnb25DaGFuZ2UnOiBfX2NvbnRleHQub25DaGFuZ2UsICdmb2N1cyc6IHRydWUgfSB9LCBbXSksIHsgd3c6IHsgJ29uQ2hhbmdlJzogX19jb250ZXh0Lm9uQ2hhbmdlLCAnZm9jdXMnOiB0cnVlIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICBdKSwge30pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dGV4dC1pbnB1dC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuVG9vbGJhclBhZ2UgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvdG9vbGJhclwiKTtcbnZhciBUb29sYmFyUGFnZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBUb29sYmFyUGFnZSgpIHtcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4odGhpcyk7XG4gICAgfVxuICAgIHJldHVybiBUb29sYmFyUGFnZTtcbn0oKSk7XG5leHBvcnRzLlRvb2xiYXJQYWdlID0gVG9vbGJhclBhZ2U7XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgVG9vbGJhclBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xudmFyIGJ1dHRvbl8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL2J1dHRvblwiKTtcbjtcbnZhciBidXR0b25fZ3JvdXBfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvY29udHJvbC9idXR0b24tZ3JvdXBcIik7XG47XG52YXIgdG9vbGJhcl8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL3Rvb2xiYXJcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRvb2xiYXJfMS5Ub29sYmFyKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGJ1dHRvbl9ncm91cF8xLkJ1dHRvbkdyb3VwKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBidXR0b25fMS5CdXR0b24oeyB3dzogeyAndGV4dCc6ICdvbmUnIH0gfSwgW10pLCB7IHd3OiB7ICd0ZXh0JzogJ29uZScgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGJ1dHRvbl8xLkJ1dHRvbih7IHd3OiB7ICd0ZXh0JzogJ3R3bycgfSB9LCBbXSksIHsgd3c6IHsgJ3RleHQnOiAndHdvJyB9IH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgYnV0dG9uXzEuQnV0dG9uKHsgd3c6IHsgJ3RleHQnOiAndGhyZWUnIH0gfSwgW10pLCB7IHd3OiB7ICd0ZXh0JzogJ3RocmVlJyB9IH0pXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGJ1dHRvbl9ncm91cF8xLkJ1dHRvbkdyb3VwKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBidXR0b25fMS5CdXR0b24oeyB3dzogeyAndGV4dCc6ICdmb3VyJyB9IH0sIFtdKSwgeyB3dzogeyAndGV4dCc6ICdmb3VyJyB9IH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgYnV0dG9uXzEuQnV0dG9uKHsgd3c6IHsgJ3RleHQnOiAnZml2ZScsICdhY3RpdmUnOiB0cnVlIH0gfSwgW10pLCB7IHd3OiB7ICd0ZXh0JzogJ2ZpdmUnLCAnYWN0aXZlJzogdHJ1ZSB9IH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgYnV0dG9uXzEuQnV0dG9uKHsgd3c6IHsgJ3RleHQnOiAnc2l4JyB9IH0sIFtdKSwgeyB3dzogeyAndGV4dCc6ICdzaXgnIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgYnV0dG9uX2dyb3VwXzEuQnV0dG9uR3JvdXAoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGJ1dHRvbl8xLkJ1dHRvbih7IHd3OiB7ICd0ZXh0JzogJ3NldmVuJyB9IH0sIFtdKSwgeyB3dzogeyAndGV4dCc6ICdzZXZlbicgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGJ1dHRvbl8xLkJ1dHRvbih7IHd3OiB7ICd0ZXh0JzogJ2VpZ2h0JywgJ2FjdGl2ZSc6IHRydWUgfSB9LCBbXSksIHsgd3c6IHsgJ3RleHQnOiAnZWlnaHQnLCAnYWN0aXZlJzogdHJ1ZSB9IH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgYnV0dG9uXzEuQnV0dG9uKHsgd3c6IHsgJ3RleHQnOiAnOScgfSB9LCBbXSksIHsgd3c6IHsgJ3RleHQnOiAnOScgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgXSksIHt9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXRvb2xiYXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLlR5cGVhaGVhZFBhZ2UgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvdHlwZWFoZWFkXCIpO1xudmFyIHJlc3VsdHMgPSBbXG4gICAgeyBsYWJlbDogJ0FzdXMnLCB2YWx1ZTogJ0FzdXMnIH0sXG4gICAgeyBsYWJlbDogJ01TSScsIHZhbHVlOiAnTVNJJyB9LFxuICAgIHsgbGFiZWw6ICdHaWdhYnl0ZScsIHZhbHVlOiAnR2lnYWJ5dGUnIH0sXG4gICAgeyBsYWJlbDogJ0dpZ2FzJywgdmFsdWU6ICdHaWdhcycgfSxcbiAgICB7IGxhYmVsOiAnQXN1c1RlaycsIHZhbHVlOiAnQXN1c1RlaycgfSxcbiAgICB7IGxhYmVsOiAnQXN1c3VnYScsIHZhbHVlOiAnQXN1c3VnYScgfSxcbiAgICB7IGxhYmVsOiAnUXVhbGNvbW0nLCB2YWx1ZTogJ1F1YWxjb21tJyB9LFxuICAgIHsgbGFiZWw6ICdRdWFsaXRhdGl2ZScsIHZhbHVlOiAnUXVhbGl0YXR2ZScgfSxcbiAgICB7IGxhYmVsOiAnS2lycGFsYW5pXFwncycsIHZhbHVlOiAnS2lycGFsYW5pXFwncycgfSxcbiAgICB7IGxhYmVsOiAnQXN1bmRlcicsIHZhbHVlOiAnQXN1bmRlcicgfVxuXTtcbnZhciBUeXBlYWhlYWRQYWdlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFR5cGVhaGVhZFBhZ2UoKSB7XG4gICAgICAgIHRoaXMudmlldyA9IG5ldyB2aWV3cy5NYWluKHRoaXMpO1xuICAgICAgICB0aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIG5vcm1hbDoge1xuICAgICAgICAgICAgICAgIGlkOiAnbm9ybWFsJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnbm9ybWFsJyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ05vcm1hbCcsXG4gICAgICAgICAgICAgICAgdmFsdWU6ICdOb3JtYWwnLFxuICAgICAgICAgICAgICAgIHN0cmluZ2lmaWVyOiBmdW5jdGlvbiAocikgeyByZXR1cm4gci52YWx1ZTsgfSxcbiAgICAgICAgICAgICAgICBvblNlYXJjaDogZG9TZWFyY2godGhpcyksXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IGRvQ2hhbmdlKHRoaXMpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYmxvY2s6IHtcbiAgICAgICAgICAgICAgICBpZDogJ2Jsb2NrJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnYmxvY2snLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnQmxvY2snLFxuICAgICAgICAgICAgICAgIHN0cmluZ2lmaWVyOiBmdW5jdGlvbiAocikgeyByZXR1cm4gci52YWx1ZTsgfSxcbiAgICAgICAgICAgICAgICBvblNlYXJjaDogZG9TZWFyY2godGhpcyksXG4gICAgICAgICAgICAgICAgb25DaGFuZ2U6IGRvQ2hhbmdlKHRoaXMpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VjY2Vzczoge1xuICAgICAgICAgICAgICAgIGlkOiAnc3VjY2VzcycsXG4gICAgICAgICAgICAgICAgbmFtZTogJ3N1Y2Nlc3MnLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnU3VjY2VzcycsXG4gICAgICAgICAgICAgICAgc3RyaW5naWZpZXI6IGZ1bmN0aW9uIChyKSB7IHJldHVybiByLnZhbHVlOyB9LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdUaGlzIGhhcyBhIHN1Y2Nlc3MgbWVzc2FnZS4nLFxuICAgICAgICAgICAgICAgIG9uU2VhcmNoOiBkb1NlYXJjaCh0aGlzKSxcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogZG9DaGFuZ2UodGhpcylcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3YXJuaW5nOiB7XG4gICAgICAgICAgICAgICAgaWQ6ICd3YXJuaW5nJyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnd2FybmluZycsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICdXYXJuaW5nJyxcbiAgICAgICAgICAgICAgICBzdHJpbmdpZmllcjogZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIudmFsdWU7IH0sXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1RoaXMgaGFzIGEgd2FybmluZyBtZXNzYWdlLicsXG4gICAgICAgICAgICAgICAgb25TZWFyY2g6IGRvU2VhcmNoKHRoaXMpLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBkb0NoYW5nZSh0aGlzKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgbmFtZTogJ2Vycm9yJyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJ0Vycm9yJyxcbiAgICAgICAgICAgICAgICBzdHJpbmdpZmllcjogZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIudmFsdWU7IH0sXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1RoaXMgaGFzIGEgZXJyb3IgbWVzc2FnZS4nLFxuICAgICAgICAgICAgICAgIG9uU2VhcmNoOiBkb1NlYXJjaCh0aGlzKSxcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogZG9DaGFuZ2UodGhpcylcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBUeXBlYWhlYWRQYWdlO1xufSgpKTtcbmV4cG9ydHMuVHlwZWFoZWFkUGFnZSA9IFR5cGVhaGVhZFBhZ2U7XG52YXIgZG9TZWFyY2ggPSBmdW5jdGlvbiAocGFnZSkgeyByZXR1cm4gZnVuY3Rpb24gKF9hKSB7XG4gICAgdmFyIG5hbWUgPSBfYS5uYW1lLCB2YWx1ZSA9IF9hLnZhbHVlO1xuICAgIHJldHVybiBwYWdlXG4gICAgICAgIC52aWV3XG4gICAgICAgIC5maW5kQnlJZChuYW1lKVxuICAgICAgICAubWFwKGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHZhciBoaXQgPSByZXN1bHRzLmZpbHRlcihmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgcmV0dXJuIGMudmFsdWUudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKHZhbHVlKSA/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHMudXBkYXRlKGhpdCk7XG4gICAgfSk7XG59OyB9O1xudmFyIGRvQ2hhbmdlID0gZnVuY3Rpb24gKHBhZ2UpIHsgcmV0dXJuIGZ1bmN0aW9uIChfYSkge1xuICAgIHZhciBuYW1lID0gX2EubmFtZSwgdmFsdWUgPSBfYS52YWx1ZTtcbiAgICByZXR1cm4gcGFnZVxuICAgICAgICAudmlld1xuICAgICAgICAuZmluZEJ5SWQobmFtZSlcbiAgICAgICAgLm1hcChmdW5jdGlvbiAodCkge1xuICAgICAgICB0LnNldE1lc3NhZ2UoXCJTZWxlY3RlZDogXCIgKyB2YWx1ZSk7XG4gICAgfSk7XG59OyB9O1xuZXhwb3J0cy5kZWZhdWx0ID0gbmV3IFR5cGVhaGVhZFBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xudmFyIHR5cGVhaGVhZF8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL3R5cGVhaGVhZFwiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdHlwZWFoZWFkXzEuVHlwZWFoZWFkKHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLmlkIH0sIHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwubGFiZWwsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwub25DaGFuZ2UgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLmlkIH0sIHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwubGFiZWwsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwub25DaGFuZ2UgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdHlwZWFoZWFkXzEuVHlwZWFoZWFkKHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5pZCB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5uYW1lLCAnbGFiZWwnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3MubGFiZWwsICdzdWNjZXNzJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLm1lc3NhZ2UsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3Mub25DaGFuZ2UgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5pZCB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5uYW1lLCAnbGFiZWwnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3MubGFiZWwsICdzdWNjZXNzJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLm1lc3NhZ2UsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMuc3VjY2Vzcy5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5zdWNjZXNzLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLnN1Y2Nlc3Mub25DaGFuZ2UgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdHlwZWFoZWFkXzEuVHlwZWFoZWFkKHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5pZCB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5uYW1lLCAnbGFiZWwnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcubGFiZWwsICd3YXJuaW5nJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLm1lc3NhZ2UsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcub25DaGFuZ2UgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5pZCB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5uYW1lLCAnbGFiZWwnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcubGFiZWwsICd3YXJuaW5nJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLm1lc3NhZ2UsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMud2FybmluZy5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy53YXJuaW5nLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLndhcm5pbmcub25DaGFuZ2UgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdHlwZWFoZWFkXzEuVHlwZWFoZWFkKHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IuaWQgfSwgd3c6IHsgJ25hbWUnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLm5hbWUsICdsYWJlbCc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IubGFiZWwsICdlcnJvcic6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IubWVzc2FnZSwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5zdHJpbmdpZmllciwgJ29uU2VhcmNoJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3bWw6IHsgJ2lkJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5pZCB9LCB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMuZXJyb3IubmFtZSwgJ2xhYmVsJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5sYWJlbCwgJ2Vycm9yJzogX19jb250ZXh0LnZhbHVlcy5lcnJvci5tZXNzYWdlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLmVycm9yLm9uQ2hhbmdlIH0gfSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHR5cGVhaGVhZF8xLlR5cGVhaGVhZCh7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmJsb2NrLmlkIH0sIHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5ibG9jay5uYW1lLCAnbGFiZWwnOiBfX2NvbnRleHQudmFsdWVzLmJsb2NrLmxhYmVsLCAnYmxvY2snOiB0cnVlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLmJsb2NrLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLmJsb2NrLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLmJsb2NrLm9uQ2hhbmdlIH0gfSwgW10pLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmJsb2NrLmlkIH0sIHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5ibG9jay5uYW1lLCAnbGFiZWwnOiBfX2NvbnRleHQudmFsdWVzLmJsb2NrLmxhYmVsLCAnYmxvY2snOiB0cnVlLCAnc3RyaW5naWZpZXInOiBfX2NvbnRleHQudmFsdWVzLmJsb2NrLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLmJsb2NrLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLmJsb2NrLm9uQ2hhbmdlIH0gfSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHR5cGVhaGVhZF8xLlR5cGVhaGVhZCh7IHd3OiB7ICduYW1lJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwubmFtZSwgJ2xhYmVsJzogJ0Rpc2FibGVkJywgJ2Rpc2FibGVkJzogdHJ1ZSwgJ3N0cmluZ2lmaWVyJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwuc3RyaW5naWZpZXIsICdvblNlYXJjaCc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm9uU2VhcmNoLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3dzogeyAnbmFtZSc6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLm5hbWUsICdsYWJlbCc6ICdEaXNhYmxlZCcsICdkaXNhYmxlZCc6IHRydWUsICdzdHJpbmdpZmllcic6IF9fY29udGV4dC52YWx1ZXMubm9ybWFsLnN0cmluZ2lmaWVyLCAnb25TZWFyY2gnOiBfX2NvbnRleHQudmFsdWVzLm5vcm1hbC5vblNlYXJjaCwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5ub3JtYWwub25DaGFuZ2UgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD10eXBlYWhlYWQuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnVzZXJzID0gdm9pZCAwO1xuZXhwb3J0cy51c2VycyA9IFtcbiAgICB7XG4gICAgICAgIFwiX2lkXCI6IFwiNTlmMTMzNGNjYzIxZmY3MjhjZjdmM2NlXCIsXG4gICAgICAgIFwiaW5kZXhcIjogMCxcbiAgICAgICAgXCJndWlkXCI6IFwiZmQ5NGNkNTItZTdmMS00NGFiLWE3NGYtMDU2MDRlZWU0NmRkXCIsXG4gICAgICAgIFwiaXNBY3RpdmVcIjogZmFsc2UsXG4gICAgICAgIFwiYmFsYW5jZVwiOiBcIiQyLDg0OS45M1wiLFxuICAgICAgICBcInBpY3R1cmVcIjogXCJodHRwOi8vcGxhY2Vob2xkLml0LzMyeDMyXCIsXG4gICAgICAgIFwiYWdlXCI6IDM0LFxuICAgICAgICBcImV5ZUNvbG9yXCI6IFwiZ3JlZW5cIixcbiAgICAgICAgXCJuYW1lXCI6IFwiSm9obnMgTGV3aXNcIixcbiAgICAgICAgXCJnZW5kZXJcIjogXCJmZW1hbGVcIixcbiAgICAgICAgXCJjb21wYW55XCI6IFwiUFJPRkxFWFwiLFxuICAgICAgICBcImVtYWlsXCI6IFwiam9obnNsZXdpc0Bwcm9mbGV4LmNvbVwiLFxuICAgICAgICBcInBob25lXCI6IFwiKzEgKDkyNSkgNDA5LTM0MDBcIixcbiAgICAgICAgXCJhZGRyZXNzXCI6IFwiODc0IEdyb3ZlIFN0cmVldCwgRWRnZXdhdGVyLCBHZW9yZ2lhLCA4MTEyXCIsXG4gICAgICAgIFwiYWJvdXRcIjogXCJFeCBlc3NlIGRvbG9yZSBldCBzaW50IHNpbnQgcHJvaWRlbnQgbm9zdHJ1ZCB1dCBvZmZpY2lhLiBEbyBudWxsYSBtb2xsaXQgZG9sb3JlIHV0IGF1dGUgZXhjZXB0ZXVyIGRlc2VydW50IGxhYm9yaXMgdXQgcHJvaWRlbnQuIFVsbGFtY28gZXN0IGRlc2VydW50IGV4IGNvbW1vZG8gdmVuaWFtIGR1aXMgZWxpdCBleGNlcHRldXIgdmVsaXQgdWxsYW1jbyBkZXNlcnVudCBjdWxwYSBkbyBlc3QuXFxyXFxuXCIsXG4gICAgICAgIFwicmVnaXN0ZXJlZFwiOiBcIjIwMTUtMDItMjJUMTA6MjU6MzIgKzA0OjAwXCIsXG4gICAgICAgIFwibGF0aXR1ZGVcIjogNTYuMjc4ODYyLFxuICAgICAgICBcImxvbmdpdHVkZVwiOiAtNzkuNDU5MTAxLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJsYWJvcmVcIixcbiAgICAgICAgICAgIFwicHJvaWRlbnRcIixcbiAgICAgICAgICAgIFwiYWxpcXVhXCIsXG4gICAgICAgICAgICBcImFtZXRcIixcbiAgICAgICAgICAgIFwiYW1ldFwiLFxuICAgICAgICAgICAgXCJvZmZpY2lhXCIsXG4gICAgICAgICAgICBcImVuaW1cIlxuICAgICAgICBdLFxuICAgICAgICBcImZyaWVuZHNcIjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwiaWRcIjogMCxcbiAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJNYXNvbiBOb2JsZVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwiaWRcIjogMSxcbiAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJDb2ZmZXkgTWVuZGV6XCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgXCJpZFwiOiAyLFxuICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkRpb25uZSBDb2xlXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgXCJncmVldGluZ1wiOiBcIkhlbGxvLCBKb2hucyBMZXdpcyEgWW91IGhhdmUgNSB1bnJlYWQgbWVzc2FnZXMuXCIsXG4gICAgICAgIFwiZmF2b3JpdGVGcnVpdFwiOiBcImJhbmFuYVwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiX2lkXCI6IFwiNTlmMTMzNGMwOWRjMWJjZGM1NzMyNDkxXCIsXG4gICAgICAgIFwiaW5kZXhcIjogMSxcbiAgICAgICAgXCJndWlkXCI6IFwiMzMyNTU5OTUtMDQzMS00MjcxLTk4NzYtMzdlYWJjMTE3YTdiXCIsXG4gICAgICAgIFwiaXNBY3RpdmVcIjogZmFsc2UsXG4gICAgICAgIFwiYmFsYW5jZVwiOiBcIiQyLDE2Ny40MFwiLFxuICAgICAgICBcInBpY3R1cmVcIjogXCJodHRwOi8vcGxhY2Vob2xkLml0LzMyeDMyXCIsXG4gICAgICAgIFwiYWdlXCI6IDIzLFxuICAgICAgICBcImV5ZUNvbG9yXCI6IFwiYmx1ZVwiLFxuICAgICAgICBcIm5hbWVcIjogXCJXaWxsaWFtc29uIEdyZWdvcnlcIixcbiAgICAgICAgXCJnZW5kZXJcIjogXCJ1bmRlZmluZWRcIixcbiAgICAgICAgXCJjb21wYW55XCI6IFwiTkVUQUdZXCIsXG4gICAgICAgIFwiZW1haWxcIjogXCJ3aWxsaWFtc29uZ3JlZ29yeUBuZXRhZ3kuY29tXCIsXG4gICAgICAgIFwicGhvbmVcIjogXCIrMSAoOTEwKSA0NjItMzkxOFwiLFxuICAgICAgICBcImFkZHJlc3NcIjogXCIxNTggU2VkZ3dpY2sgU3RyZWV0LCBHbGFzZ293LCBVdGFoLCA1NDk4XCIsXG4gICAgICAgIFwiYWJvdXRcIjogXCJFeGNlcHRldXIgc2l0IG5pc2kgZXQgdmVsaXQuIExhYm9yaXMgbWluaW0gaWQgZHVpcyBhZCBxdWkgY3VwaWRhdGF0LiBFc3QgTG9yZW0gcXVpcyBkdWlzIExvcmVtIGxhYm9yaXMgdmVsaXQgbGFib3JpcyBub24gZXhjZXB0ZXVyIGV0IHZlbGl0IHZvbHVwdGF0ZSBxdWkuIERvbG9yZSBxdWkgYW5pbSBleGVyY2l0YXRpb24gdmVuaWFtIGluY2lkaWR1bnQgbGFib3JpcyBsYWJvcmUuIElkIG1pbmltIGxhYm9yZSBhbWV0IHN1bnQgZXhjZXB0ZXVyIHRlbXBvciBwcm9pZGVudC5cXHJcXG5cIixcbiAgICAgICAgXCJyZWdpc3RlcmVkXCI6IFwiMjAxNi0wNC0yNVQwNDoyNToyNCArMDQ6MDBcIixcbiAgICAgICAgXCJsYXRpdHVkZVwiOiA1NC40NTc4MzMsXG4gICAgICAgIFwibG9uZ2l0dWRlXCI6IDEyMi44MDM3NjUsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcInRlbXBvclwiLFxuICAgICAgICAgICAgXCJleGVyY2l0YXRpb25cIixcbiAgICAgICAgICAgIFwiZXRcIixcbiAgICAgICAgICAgIFwiZWxpdFwiLFxuICAgICAgICAgICAgXCJleFwiLFxuICAgICAgICAgICAgXCJjaWxsdW1cIixcbiAgICAgICAgICAgIFwibGFib3Jpc1wiXG4gICAgICAgIF0sXG4gICAgICAgIFwiZnJpZW5kc1wiOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgXCJpZFwiOiAwLFxuICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIk5hdmFycm8gUmVldmVzXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgXCJpZFwiOiAxLFxuICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIlN0YW50b24gVmluY2VudFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwiaWRcIjogMixcbiAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJBbGV4aXMgR3V6bWFuXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgXCJncmVldGluZ1wiOiBcIkhlbGxvLCBXaWxsaWFtc29uIEdyZWdvcnkhIFlvdSBoYXZlIDEgdW5yZWFkIG1lc3NhZ2VzLlwiLFxuICAgICAgICBcImZhdm9yaXRlRnJ1aXRcIjogXCJhcHBsZVwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiX2lkXCI6IFwiNTlmMTMzNGM5ZDc5OTc4OWJjNDk0YTNjXCIsXG4gICAgICAgIFwiaW5kZXhcIjogMixcbiAgICAgICAgXCJndWlkXCI6IFwiMTU4ZmZhNWQtMTVkYS00YTlmLWExZGEtMGE0OGI3NmI4MjI2XCIsXG4gICAgICAgIFwiaXNBY3RpdmVcIjogZmFsc2UsXG4gICAgICAgIFwiYmFsYW5jZVwiOiBcIiQxLDI4OS4zNVwiLFxuICAgICAgICBcInBpY3R1cmVcIjogXCJodHRwOi8vcGxhY2Vob2xkLml0LzMyeDMyXCIsXG4gICAgICAgIFwiYWdlXCI6IDMzLFxuICAgICAgICBcImV5ZUNvbG9yXCI6IFwiZ3JlZW5cIixcbiAgICAgICAgXCJuYW1lXCI6IFwiRGFsdG9uIEhvdXNlXCIsXG4gICAgICAgIFwiZ2VuZGVyXCI6IFwibWFsZVwiLFxuICAgICAgICBcImNvbXBhbnlcIjogXCJFWUVXQVhcIixcbiAgICAgICAgXCJlbWFpbFwiOiBcImRhbHRvbmhvdXNlQGV5ZXdheC5jb21cIixcbiAgICAgICAgXCJwaG9uZVwiOiBcIisxICg5NTkpIDU1MC0yMjYzXCIsXG4gICAgICAgIFwiYWRkcmVzc1wiOiBcIjExNiBIb3dhcmQgQXZlbnVlLCBSb3NzbW9yZSwgTmV3IFlvcmssIDYzMDJcIixcbiAgICAgICAgXCJhYm91dFwiOiBcIkVsaXQgZXUgaXBzdW0gcGFyaWF0dXIgZHVpcyBtb2xsaXQgZXggcXVpcy4gQW1ldCBudWxsYSBleGVyY2l0YXRpb24gbGFib3JpcyBtaW5pbSBmdWdpYXQgdGVtcG9yIGluIGFsaXF1YSBuaXNpIG5vc3RydWQgYXV0ZS4gRHVpcyBtaW5pbSBlc3NlIGlydXJlIGlydXJlIGZ1Z2lhdCBzaXQgbnVsbGEgZXQgdGVtcG9yIG5pc2kgY2lsbHVtIHByb2lkZW50IGlkIGFkaXBpc2ljaW5nLiBFdSBlbGl0IG1hZ25hIExvcmVtIGlydXJlIGxhYm9yZS4gQWxpcXVpcCBpZCBzaW50IHZlbmlhbSBhZGlwaXNpY2luZy4gQW1ldCBlaXVzbW9kIG1vbGxpdCByZXByZWhlbmRlcml0IHJlcHJlaGVuZGVyaXQgZG9sb3JlLlxcclxcblwiLFxuICAgICAgICBcInJlZ2lzdGVyZWRcIjogXCIyMDE3LTAyLTI4VDA4OjUzOjAwICswNDowMFwiLFxuICAgICAgICBcImxhdGl0dWRlXCI6IC0yNS42Nzk3NzQsXG4gICAgICAgIFwibG9uZ2l0dWRlXCI6IDI5LjM3NDc4MSxcbiAgICAgICAgXCJ0YWdzXCI6IFtcbiAgICAgICAgICAgIFwicXVpXCIsXG4gICAgICAgICAgICBcImNpbGx1bVwiLFxuICAgICAgICAgICAgXCJhbmltXCIsXG4gICAgICAgICAgICBcImlydXJlXCIsXG4gICAgICAgICAgICBcIm5vblwiLFxuICAgICAgICAgICAgXCJjb21tb2RvXCIsXG4gICAgICAgICAgICBcImRlc2VydW50XCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJmcmllbmRzXCI6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBcImlkXCI6IDAsXG4gICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiQ2FybWVsYSBXaWxjb3hcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBcImlkXCI6IDEsXG4gICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiRWxiYSBHYXJ6YVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwiaWRcIjogMixcbiAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJHYXJyaXNvbiBDaHVyY2hcIlxuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBcImdyZWV0aW5nXCI6IFwiSGVsbG8sIERhbHRvbiBIb3VzZSEgWW91IGhhdmUgMSB1bnJlYWQgbWVzc2FnZXMuXCIsXG4gICAgICAgIFwiZmF2b3JpdGVGcnVpdFwiOiBcImFwcGxlXCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgXCJfaWRcIjogXCI1OWYxMzM0Y2QxNTE4YzNhNDRkNjlmZmZcIixcbiAgICAgICAgXCJpbmRleFwiOiAzLFxuICAgICAgICBcImd1aWRcIjogXCI1MTA5YmM1MC05YThlLTQxODQtYWJhMC02NzQwZGMwMGI2MDZcIixcbiAgICAgICAgXCJpc0FjdGl2ZVwiOiB0cnVlLFxuICAgICAgICBcImJhbGFuY2VcIjogXCIkMyw4OTEuODNcIixcbiAgICAgICAgXCJwaWN0dXJlXCI6IFwiaHR0cDovL3BsYWNlaG9sZC5pdC8zMngzMlwiLFxuICAgICAgICBcImFnZVwiOiAyMixcbiAgICAgICAgXCJleWVDb2xvclwiOiBcImJsdWVcIixcbiAgICAgICAgXCJuYW1lXCI6IFwiUmF5IFdpbGtpbnNcIixcbiAgICAgICAgXCJnZW5kZXJcIjogXCJtYWxlXCIsXG4gICAgICAgIFwiY29tcGFueVwiOiBcIkVYUE9TQVwiLFxuICAgICAgICBcImVtYWlsXCI6IFwicmF5d2lsa2luc0BleHBvc2EuY29tXCIsXG4gICAgICAgIFwicGhvbmVcIjogXCIrMSAoODEyKSA0MTQtMzI1OFwiLFxuICAgICAgICBcImFkZHJlc3NcIjogXCI4MzcgQmVkZm9yZCBBdmVudWUsIEhhcmxlaWdoLCBTb3V0aCBDYXJvbGluYSwgMjMyM1wiLFxuICAgICAgICBcImFib3V0XCI6IFwiRXN0IGFtZXQgcXVpcyBldSBwcm9pZGVudCBpcHN1bSB2ZW5pYW0gc2l0LiBJcnVyZSBsYWJvcmUgYWQgY29uc2VjdGV0dXIgdWxsYW1jbyBzaXQgaXBzdW0gcHJvaWRlbnQuIEFkIHBhcmlhdHVyIGlydXJlIG5pc2kgaXJ1cmUgY29tbW9kbyBhbGlxdWlwIG5pc2kgZXUgYW5pbSBpcnVyZSBkb2xvciBkb2xvciB2ZW5pYW0gcXVpcy5cXHJcXG5cIixcbiAgICAgICAgXCJyZWdpc3RlcmVkXCI6IFwiMjAxNS0wOS0xN1QwNDo1Mjo0MiArMDQ6MDBcIixcbiAgICAgICAgXCJsYXRpdHVkZVwiOiAzNC4zNTQ4MDEsXG4gICAgICAgIFwibG9uZ2l0dWRlXCI6IC0xNjguMzAzOTUyLFxuICAgICAgICBcInRhZ3NcIjogW1xuICAgICAgICAgICAgXCJuaXNpXCIsXG4gICAgICAgICAgICBcImxhYm9yaXNcIixcbiAgICAgICAgICAgIFwiaW5jaWRpZHVudFwiLFxuICAgICAgICAgICAgXCJhbWV0XCIsXG4gICAgICAgICAgICBcImF1dGVcIixcbiAgICAgICAgICAgIFwicXVpc1wiLFxuICAgICAgICAgICAgXCJtb2xsaXRcIlxuICAgICAgICBdLFxuICAgICAgICBcImZyaWVuZHNcIjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwiaWRcIjogMCxcbiAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJPbGl2aWEgUnVzc29cIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBcImlkXCI6IDEsXG4gICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiUml0YSBUeWxlclwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIFwiaWRcIjogMixcbiAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJMb3JpZSBXYWxrZXJcIlxuICAgICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBcImdyZWV0aW5nXCI6IFwiSGVsbG8sIFJheSBXaWxraW5zISBZb3UgaGF2ZSAxIHVucmVhZCBtZXNzYWdlcy5cIixcbiAgICAgICAgXCJmYXZvcml0ZUZydWl0XCI6IFwic3RyYXdiZXJyeVwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIFwiX2lkXCI6IFwiNTlmMTMzNGM2OTAxYmRhMDAzZTUyZmE2XCIsXG4gICAgICAgIFwiaW5kZXhcIjogNCxcbiAgICAgICAgXCJndWlkXCI6IFwiMGFiMzM0NzctYjE1Mi00YjEyLWFmMzUtZjViOTI1NGQ1YzJhXCIsXG4gICAgICAgIFwiaXNBY3RpdmVcIjogdHJ1ZSxcbiAgICAgICAgXCJiYWxhbmNlXCI6IFwiJDMsNzMwLjcxXCIsXG4gICAgICAgIFwicGljdHVyZVwiOiBcImh0dHA6Ly9wbGFjZWhvbGQuaXQvMzJ4MzJcIixcbiAgICAgICAgXCJhZ2VcIjogMjcsXG4gICAgICAgIFwiZXllQ29sb3JcIjogXCJicm93blwiLFxuICAgICAgICBcIm5hbWVcIjogXCJNYWRkZW4gSGF0ZmllbGRcIixcbiAgICAgICAgXCJnZW5kZXJcIjogXCJtYWxlXCIsXG4gICAgICAgIFwiY29tcGFueVwiOiBcIlpPR0FLXCIsXG4gICAgICAgIFwiZW1haWxcIjogXCJtYWRkZW5oYXRmaWVsZEB6b2dhay5jb21cIixcbiAgICAgICAgXCJwaG9uZVwiOiBcIisxICg4MzIpIDU1Mi0yMjk0XCIsXG4gICAgICAgIFwiYWRkcmVzc1wiOiBcIjUzMCBDbGVybW9udCBBdmVudWUsIEJldGhwYWdlLCBWaXJnaW4gSXNsYW5kcywgNTYwN1wiLFxuICAgICAgICBcImFib3V0XCI6IFwiQ29tbW9kbyB0ZW1wb3IgYW5pbSB0ZW1wb3IgZGVzZXJ1bnQgbGFib3JpcyBxdWkgZXUgcmVwcmVoZW5kZXJpdCBjb25zZXF1YXQuIE5vbiBsYWJvcnVtIHVsbGFtY28gcXVpIHByb2lkZW50LiBFc3QgY3VwaWRhdGF0IGRvIGRvbG9yIGV4Y2VwdGV1ciBlc3Qgbm9zdHJ1ZCBsYWJvcnVtLiBFdSBleGNlcHRldXIgZXggY29tbW9kbyBhbGlxdWlwIGFkaXBpc2ljaW5nIGV4Y2VwdGV1ci4gRXQgcmVwcmVoZW5kZXJpdCBsYWJvcmlzIHJlcHJlaGVuZGVyaXQgYXV0ZSB1dCBleGNlcHRldXIgZGVzZXJ1bnQgbm9zdHJ1ZCB2ZWxpdC4gVWxsYW1jbyBlc3Qgc2l0IGZ1Z2lhdCBpcnVyZSBhbGlxdWEgYWxpcXVpcCBwcm9pZGVudC4gVm9sdXB0YXRlIGFkIGN1bHBhIGRvbG9yIGlkIGVuaW0gdGVtcG9yIGxhYm9ydW0uXFxyXFxuXCIsXG4gICAgICAgIFwicmVnaXN0ZXJlZFwiOiBcIjIwMTYtMDQtMTBUMDM6Mzc6MTcgKzA0OjAwXCIsXG4gICAgICAgIFwibGF0aXR1ZGVcIjogODAuODg4ODc2LFxuICAgICAgICBcImxvbmdpdHVkZVwiOiAxMTcuODQzMzcsXG4gICAgICAgIFwidGFnc1wiOiBbXG4gICAgICAgICAgICBcIm9jY2FlY2F0XCIsXG4gICAgICAgICAgICBcIm5pc2lcIixcbiAgICAgICAgICAgIFwiZXN0XCIsXG4gICAgICAgICAgICBcImFkXCIsXG4gICAgICAgICAgICBcIm5vc3RydWRcIixcbiAgICAgICAgICAgIFwiZXVcIixcbiAgICAgICAgICAgIFwiZG9sb3JlXCJcbiAgICAgICAgXSxcbiAgICAgICAgXCJmcmllbmRzXCI6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBcImlkXCI6IDAsXG4gICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiVmluY2VudCBHYXlcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBcImlkXCI6IDEsXG4gICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiUm9zYXJpbyBGb3JiZXNcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBcImlkXCI6IDIsXG4gICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiQmF4dGVyIEdyZWVuXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgXCJncmVldGluZ1wiOiBcIkhlbGxvLCBNYWRkZW4gSGF0ZmllbGQhIFlvdSBoYXZlIDQgdW5yZWFkIG1lc3NhZ2VzLlwiLFxuICAgICAgICBcImZhdm9yaXRlRnJ1aXRcIjogXCJiYW5hbmFcIlxuICAgIH1cbl07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1kYXRhLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5EYXRhVGFibGVQYWdlID0gdm9pZCAwO1xudmFyIHRhYmxlXzEgPSByZXF1aXJlKFwiLi93bWwvdGFibGVcIik7XG52YXIgZGF0YV8xID0gcmVxdWlyZShcIi4vZGF0YVwiKTtcbnZhciB1dGlsXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vbGliL3V0aWxcIik7XG52YXIgY29sdW1ucyA9IFtcbiAgICB7IG5hbWU6ICdpbmRleCcsIGhlYWRpbmc6ICcjJywgc29ydDogJ3llcycgfSxcbiAgICB7IG5hbWU6ICduYW1lJywgaGVhZGluZzogJ05hbWUnLCBzb3J0OiAneWVzJyB9LFxuICAgIHsgbmFtZTogJ2dlbmRlcicsIGhlYWRpbmc6ICdHZW5kZXInLCBzb3J0OiAneWVzJyB9LFxuICAgIHsgbmFtZTogJ2VtYWlsJywgaGVhZGluZzogJ0VtYWlsJywgc29ydDogJ3llcycgfSxcbiAgICB7IG5hbWU6ICdiYWxhbmNlJywgaGVhZGluZzogJ0JhbGFuY2UnLCBzb3J0OiAneWVzJyB9LFxuXTtcbnZhciBEYXRhVGFibGVQYWdlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIERhdGFUYWJsZVBhZ2UoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMudmlldyA9IG5ldyB0YWJsZV8xLk1haW4odGhpcyk7XG4gICAgICAgIHRoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgaWQ6ICd0YWJsZScsXG4gICAgICAgICAgICB1c2VyczogZGF0YV8xLnVzZXJzLFxuICAgICAgICAgICAgY29sdW1uczogY29sdW1ucyxcbiAgICAgICAgICAgIG9uQ2VsbENsaWNrZWQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1EVCA9IHV0aWxfMS5nZXRCeUlkKF90aGlzLnZpZXcsIF90aGlzLnZhbHVlcy5pZCk7XG4gICAgICAgICAgICAgICAgaWYgKG1EVC5pc05vdGhpbmcoKSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHZhciBkdCA9IG1EVC5nZXQoKTtcbiAgICAgICAgICAgICAgICBkdC5nZXRDZWxsKGUuY29sdW1uLCBlLnJvdykuY2VsbHMuZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgICAgICAgICBjLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdyZWQnO1xuICAgICAgICAgICAgICAgICAgICBjLnN0eWxlLmNvbG9yID0gJyNmZmYnO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gRGF0YVRhYmxlUGFnZTtcbn0oKSk7XG5leHBvcnRzLkRhdGFUYWJsZVBhZ2UgPSBEYXRhVGFibGVQYWdlO1xuZXhwb3J0cy5kZWZhdWx0ID0gbmV3IERhdGFUYWJsZVBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xudmFyIHRhYmxlXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2RhdGEvdGFibGVcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdoMycsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0RhdGEgVGFibGUnKVxuICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuRGF0YVRhYmxlKHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQgfSwgd3c6IHsgJ3NvcnRhYmxlJzogdHJ1ZSwgJ29uQ2VsbENsaWNrZWQnOiBfX2NvbnRleHQudmFsdWVzLm9uQ2VsbENsaWNrZWQsICdkYXRhJzogX19jb250ZXh0LnZhbHVlcy51c2VycywgJ2NvbHVtbnMnOiBfX2NvbnRleHQudmFsdWVzLmNvbHVtbnMgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6IF9fY29udGV4dC52YWx1ZXMuaWQgfSwgd3c6IHsgJ3NvcnRhYmxlJzogdHJ1ZSwgJ29uQ2VsbENsaWNrZWQnOiBfX2NvbnRleHQudmFsdWVzLm9uQ2VsbENsaWNrZWQsICdkYXRhJzogX19jb250ZXh0LnZhbHVlcy51c2VycywgJ2NvbHVtbnMnOiBfX2NvbnRleHQudmFsdWVzLmNvbHVtbnMgfSB9KVxuICAgICAgICAgICAgXSksIHt9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXRhYmxlLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Qcm9wZXJ0eUxpc3RQYWdlID0gdm9pZCAwO1xudmFyIHByb3BlcnR5X2xpc3RfMSA9IHJlcXVpcmUoXCIuL3dtbC9wcm9wZXJ0eS1saXN0XCIpO1xudmFyIGRhdGEgPSB7XG4gICAgbmFtZTogJ0xvbmRvbiBCZXRhJyxcbiAgICBhZ2U6ICczNycsXG4gICAgYmFsYW5jZTogJzUwMDAnXG59O1xudmFyIG1vbmV5ID0gZnVuY3Rpb24gKHMpIHsgcmV0dXJuIFwiJFwiICsgczsgfTtcbnZhciBkYXRhRnJhZ21lbnQgPSBmdW5jdGlvbiAoYykgeyByZXR1cm4gbmV3IHByb3BlcnR5X2xpc3RfMS5Cb2xkRGF0YVZpZXcoYyk7IH07XG52YXIgZmllbGRzID0gW1xuICAgIHsgbmFtZTogJ25hbWUnLCBoZWFkaW5nOiAnTmFtZScsIGRhdGFGcmFnbWVudDogZGF0YUZyYWdtZW50IH0sXG4gICAgeyBuYW1lOiAnYWdlJywgaGVhZGluZzogJ2FnZScgfSxcbiAgICB7IG5hbWU6ICdiYWxhbmNlJywgaGVhZGluZzogJ0JhbGFuY2UnLCBmb3JtYXQ6IG1vbmV5IH1cbl07XG52YXIgUHJvcGVydHlMaXN0UGFnZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBQcm9wZXJ0eUxpc3RQYWdlKCkge1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgcHJvcGVydHlfbGlzdF8xLk1haW4odGhpcyk7XG4gICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XG4gICAgICAgIHRoaXMuZmllbGRzID0gZmllbGRzO1xuICAgIH1cbiAgICByZXR1cm4gUHJvcGVydHlMaXN0UGFnZTtcbn0oKSk7XG5leHBvcnRzLlByb3BlcnR5TGlzdFBhZ2UgPSBQcm9wZXJ0eUxpc3RQYWdlO1xuZXhwb3J0cy5kZWZhdWx0ID0gbmV3IFByb3BlcnR5TGlzdFBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gZXhwb3J0cy5Cb2xkRGF0YVZpZXcgPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIHByb3BlcnR5X2xpc3RfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvZGF0YS9wcm9wZXJ0eS1saXN0XCIpO1xuO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIEJvbGREYXRhVmlldyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBCb2xkRGF0YVZpZXcoX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLm5vZGUoJ2InLCB7fSwgW1xuICAgICAgICAgICAgICAgIHRleHQoX19jb250ZXh0LmRhdGEpXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgQm9sZERhdGFWaWV3LnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgQm9sZERhdGFWaWV3LnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIEJvbGREYXRhVmlldy5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIEJvbGREYXRhVmlldy5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBCb2xkRGF0YVZpZXcucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIEJvbGREYXRhVmlldy5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBCb2xkRGF0YVZpZXcucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIEJvbGREYXRhVmlldy5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBCb2xkRGF0YVZpZXc7XG59KCkpO1xuZXhwb3J0cy5Cb2xkRGF0YVZpZXcgPSBCb2xkRGF0YVZpZXc7XG47XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgcHJvcGVydHlfbGlzdF8xLlByb3BlcnR5TGlzdCh7IHd3OiB7ICdmaWVsZHMnOiBfX2NvbnRleHQuZmllbGRzLCAnZGF0YSc6IF9fY29udGV4dC5kYXRhIH0gfSwgW10pLCB7IHd3OiB7ICdmaWVsZHMnOiBfX2NvbnRleHQuZmllbGRzLCAnZGF0YSc6IF9fY29udGV4dC5kYXRhIH0gfSlcbiAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICBdKSwge30pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cHJvcGVydHktbGlzdC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuQWxlcnRQYWdlID0gdm9pZCAwO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL2FsZXJ0XCIpO1xudmFyIHN0eWxlXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vbGliL2NvbnRlbnQvc3R5bGVcIik7XG52YXIgQWxlcnRQYWdlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEFsZXJ0UGFnZSgpIHtcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4odGhpcyk7XG4gICAgICAgIHRoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgY2FwaXRhbGl6ZTogZnVuY3Rpb24gKHMpIHsgcmV0dXJuIFwiXCIgKyBzWzBdLnRvVXBwZXJDYXNlKCkgKyBzLnNsaWNlKDEpOyB9LFxuICAgICAgICAgICAgbWVzc2FnZTogJ1RoaXMgaXMgYW4gYWxlcnQnLFxuICAgICAgICAgICAgc3R5bGVzOiBbXG4gICAgICAgICAgICAgICAgc3R5bGVfMS5TdHlsZS5EZWZhdWx0LFxuICAgICAgICAgICAgICAgIHN0eWxlXzEuU3R5bGUuUHJpbWFyeSxcbiAgICAgICAgICAgICAgICBzdHlsZV8xLlN0eWxlLlN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgc3R5bGVfMS5TdHlsZS5JbmZvLFxuICAgICAgICAgICAgICAgIHN0eWxlXzEuU3R5bGUuV2FybmluZyxcbiAgICAgICAgICAgICAgICBzdHlsZV8xLlN0eWxlLkVycm9yXG4gICAgICAgICAgICBdXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBBbGVydFBhZ2U7XG59KCkpO1xuZXhwb3J0cy5BbGVydFBhZ2UgPSBBbGVydFBhZ2U7XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgQWxlcnRQYWdlKCk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBhbGVydF8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9kaWFsb2cvYWxlcnRcIik7XG47XG52YXIgZGVtb18xID0gcmVxdWlyZShcIi4uLy4uLy4uL3dpZGdldHMvZGVtb1wiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gxJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0FsZXJ0cycpXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBfX3NwcmVhZEFycmF5cyhbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnaDInLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1N0eWxlcycpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICBdLCBfX2ZvckluKF9fY29udGV4dC52YWx1ZXMuc3R5bGVzLCBmdW5jdGlvbiAodiwgXyQkaSwgXyQkYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBhbGVydF8xLkFsZXJ0KHsgd3c6IHsgJ3N0eWxlJzogdiwgJ2Nsb3NhYmxlJzogdHJ1ZSwgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmNhcGl0YWxpemUodikgfSB9LCBbXSksIHsgd3c6IHsgJ3N0eWxlJzogdiwgJ2Nsb3NhYmxlJzogdHJ1ZSwgJ3RleHQnOiBfX2NvbnRleHQudmFsdWVzLmNhcGl0YWxpemUodikgfSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHsgcmV0dXJuIChbXSk7IH0pKSlcbiAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICBdKSwge30pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YWxlcnQuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNvbmZpcm1QYWdlID0gdm9pZCAwO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL2NvbmZpcm1cIik7XG52YXIgQ29uZmlybVBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQ29uZmlybVBhZ2UoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMudmlldyA9IG5ldyB2aWV3cy5NYWluKHRoaXMpO1xuICAgICAgICB0aGlzLnYgPSBuZXcgdmlld3MuT3Blbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICB0aXRsZTogJ0NvbmZpcm0gYSBtZXNzYWdlJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdXb3VsZCB5b3UgbGlrZSB0byBjb25maXJtIHRoaXMgbWVzc2FnZT8nLFxuICAgICAgICAgICAgb25ZZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBhbGVydCgnTWVzc2FnZSBjb25maXJtZWQhJyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25ObzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGFsZXJ0KCdNZXNzYWdlIHJlamVjdGVkIScpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9wZW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKF90aGlzLnYucmVuZGVyKCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMudi5maW5kQnlJZCgnb3BlbicpXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKG0pIHsgcmV0dXJuIG0uY2xvc2UoKTsgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBDb25maXJtUGFnZTtcbn0oKSk7XG5leHBvcnRzLkNvbmZpcm1QYWdlID0gQ29uZmlybVBhZ2U7XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgQ29uZmlybVBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5PcGVuID0gZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBjb25maXJtXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2RpYWxvZy9jb25maXJtXCIpO1xuO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdoMScsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0NvbmZpcm0nKVxuICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2J1dHRvbicsIHsgJ29uY2xpY2snOiBfX2NvbnRleHQudmFsdWVzLm9wZW4gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnT3BlbicpXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG47XG52YXIgT3BlbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBPcGVuKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGNvbmZpcm1fMS5Db25maXJtKHsgd21sOiB7ICdpZCc6ICdvcGVuJyB9LCB3dzogeyAndGl0bGUnOiBfX2NvbnRleHQudmFsdWVzLnRpdGxlLCAnb25Obyc6IF9fY29udGV4dC52YWx1ZXMub25ObywgJ29uWWVzJzogX19jb250ZXh0LnZhbHVlcy5vblllcyB9IH0sIFtcbiAgICAgICAgICAgICAgICB0ZXh0KF9fY29udGV4dC52YWx1ZXMubWVzc2FnZSlcbiAgICAgICAgICAgIF0pLCB7IHdtbDogeyAnaWQnOiAnb3BlbicgfSwgd3c6IHsgJ3RpdGxlJzogX19jb250ZXh0LnZhbHVlcy50aXRsZSwgJ29uTm8nOiBfX2NvbnRleHQudmFsdWVzLm9uTm8sICdvblllcyc6IF9fY29udGV4dC52YWx1ZXMub25ZZXMgfSB9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgT3Blbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE9wZW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgT3Blbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE9wZW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgT3Blbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgT3Blbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBPcGVuLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBPcGVuLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE9wZW47XG59KCkpO1xuZXhwb3J0cy5PcGVuID0gT3Blbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNvbmZpcm0uanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkluZm9ybVBhZ2UgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvaW5mb3JtXCIpO1xudmFyIEluZm9ybVBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gSW5mb3JtUGFnZSgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4odGhpcyk7XG4gICAgICAgIHRoaXMudiA9IG5ldyB2aWV3cy5PcGVuKHRoaXMpO1xuICAgICAgICB0aGlzLnZhbHVlcyA9IHtcbiAgICAgICAgICAgIHRpdGxlOiAnU29tZXRoaW5nIGhhcHBlbmVkJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdaaW5nISBTb21ldGhpbmcgeW91IGhhcHBlbmVkIScsXG4gICAgICAgICAgICBvbkNsb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoJ0J1aCBCeWUnKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcGVuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChfdGhpcy52LnJlbmRlcigpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF90aGlzLnYuZmluZEJ5SWQoJ29wZW4nKVxuICAgICAgICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChtKSB7IHJldHVybiBtLmNsb3NlKCk7IH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gSW5mb3JtUGFnZTtcbn0oKSk7XG5leHBvcnRzLkluZm9ybVBhZ2UgPSBJbmZvcm1QYWdlO1xuZXhwb3J0cy5kZWZhdWx0ID0gbmV3IEluZm9ybVBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5PcGVuID0gZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBpbmZvcm1fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvZGlhbG9nL2luZm9ybVwiKTtcbjtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnaDEnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdJbmZvcm0nKVxuICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2J1dHRvbicsIHsgJ29uY2xpY2snOiBfX2NvbnRleHQudmFsdWVzLm9wZW4gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnT3BlbicpXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG47XG52YXIgT3BlbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBPcGVuKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGluZm9ybV8xLkluZm9ybSh7IHdtbDogeyAnaWQnOiAnb3BlbicgfSwgd3c6IHsgJ3RpdGxlJzogX19jb250ZXh0LnZhbHVlcy50aXRsZSwgJ29uQ2xvc2UnOiBfX2NvbnRleHQudmFsdWVzLm9uQ2xvc2UgfSB9LCBbXG4gICAgICAgICAgICAgICAgdGV4dChfX2NvbnRleHQudmFsdWVzLm1lc3NhZ2UpXG4gICAgICAgICAgICBdKSwgeyB3bWw6IHsgJ2lkJzogJ29wZW4nIH0sIHd3OiB7ICd0aXRsZSc6IF9fY29udGV4dC52YWx1ZXMudGl0bGUsICdvbkNsb3NlJzogX19jb250ZXh0LnZhbHVlcy5vbkNsb3NlIH0gfSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE9wZW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBPcGVuLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE9wZW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBPcGVuLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE9wZW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE9wZW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgT3Blbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgT3Blbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBPcGVuO1xufSgpKTtcbmV4cG9ydHMuT3BlbiA9IE9wZW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmZvcm0uanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1vZGFsUGFnZSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9tb2RhbFwiKTtcbnZhciBNb2RhbFBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTW9kYWxQYWdlKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52ID0gbmV3IHZpZXdzLk9wZW4odGhpcyk7XG4gICAgICAgIHRoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgb3BlbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoX3RoaXMudi5yZW5kZXIoKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy52LmZpbmRCeUlkKCdvcGVuJylcbiAgICAgICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAobSkgeyByZXR1cm4gbS5jbG9zZSgpOyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIE1vZGFsUGFnZTtcbn0oKSk7XG5leHBvcnRzLk1vZGFsUGFnZSA9IE1vZGFsUGFnZTtcbmV4cG9ydHMuZGVmYXVsdCA9IG5ldyBNb2RhbFBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5PcGVuID0gZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBtb2RhbF8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9kaWFsb2cvbW9kYWxcIik7XG47XG52YXIgZGVtb18xID0gcmVxdWlyZShcIi4uLy4uLy4uL3dpZGdldHMvZGVtb1wiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gxJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnTW9kYWxzJylcbiAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdidXR0b24nLCB7ICdvbmNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5vcGVuIH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ09wZW4nKVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICBdKSwge30pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuO1xudmFyIE9wZW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gT3BlbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBtb2RhbF8xLk1vZGFsKHsgd21sOiB7ICdpZCc6ICdvcGVuJyB9IH0sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBtb2RhbF8xLk1vZGFsSGVhZGVyKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ09wZW4nKVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbW9kYWxfMS5Nb2RhbEJvZHkoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnQ2xpY2sgdGhpcyAnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdidXR0b24nLCB7ICdvbmNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5jbG9zZSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnYnV0dG9uJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnIHRvIGNsb3NlLicpXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBtb2RhbF8xLk1vZGFsRm9vdGVyKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdidXR0b24nLCB7ICdvbmNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5jbG9zZSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdjYW5jZWwnKVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgIF0pLCB7IHdtbDogeyAnaWQnOiAnb3BlbicgfSB9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgT3Blbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE9wZW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgT3Blbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE9wZW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgT3Blbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgT3Blbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBPcGVuLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBPcGVuLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE9wZW47XG59KCkpO1xuZXhwb3J0cy5PcGVuID0gT3Blbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1vZGFsLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5Qcm9tcHRQYWdlID0gdm9pZCAwO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL3Byb21wdFwiKTtcbnZhciBQcm9tcHRQYWdlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFByb21wdFBhZ2UoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMudmlldyA9IG5ldyB2aWV3cy5NYWluKHRoaXMpO1xuICAgICAgICB0aGlzLnYgPSBuZXcgdmlld3MuT3Blbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICB2YWx1ZTogJ0NsaWNrIHRoZSBidXR0b24gYmVsbG93IHRvIGNoYW5nZSB0aGlzIHRleHQuJyxcbiAgICAgICAgICAgIHRpdGxlOiAnQ2hhbmdlIHRoZSB0ZXh0JyxcbiAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gX3RoaXMudmFsdWVzLnZhbHVlID0gZS52YWx1ZTsgfSxcbiAgICAgICAgICAgIG9uU2F2ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF90aGlzLnZpZXcuaW52YWxpZGF0ZSgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uQ2FuY2VsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb3BlbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoX3RoaXMudi5yZW5kZXIoKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy52LmZpbmRCeUlkKCdvcGVuJylcbiAgICAgICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAobSkgeyByZXR1cm4gbS5jbG9zZSgpOyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIFByb21wdFBhZ2U7XG59KCkpO1xuZXhwb3J0cy5Qcm9tcHRQYWdlID0gUHJvbXB0UGFnZTtcbmV4cG9ydHMuZGVmYXVsdCA9IG5ldyBQcm9tcHRQYWdlKCk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuT3BlbiA9IGV4cG9ydHMuTWFpbiA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG52YXIgdGV4dF9maWVsZF8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250cm9sL3RleHQtZmllbGRcIik7XG47XG52YXIgcHJvbXB0XzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2RpYWxvZy9wcm9tcHRcIik7XG47XG52YXIgZGVtb18xID0gcmVxdWlyZShcIi4uLy4uLy4uL3dpZGdldHMvZGVtb1wiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gxJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnUHJvbXB0JylcbiAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIHRleHQoX19jb250ZXh0LnZhbHVlcy52YWx1ZSlcbiAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdidXR0b24nLCB7ICdvbmNsaWNrJzogX19jb250ZXh0LnZhbHVlcy5vcGVuIH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ09wZW4nKVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICBdKSwge30pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuO1xudmFyIE9wZW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gT3BlbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBwcm9tcHRfMS5Qcm9tcHQoeyB3bWw6IHsgJ2lkJzogJ29wZW4nIH0sIHd3OiB7ICd0aXRsZSc6IF9fY29udGV4dC52YWx1ZXMudGl0bGUsICdvblNhdmUnOiBfX2NvbnRleHQudmFsdWVzLm9uU2F2ZSwgJ29uQ2FuY2VsJzogX19jb250ZXh0LnZhbHVlcy5vbkNhbmNlbCB9IH0sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0ZXh0X2ZpZWxkXzEuVGV4dEZpZWxkKHsgd3c6IHsgJ3ZhbHVlJzogX19jb250ZXh0LnZhbHVlcy52YWx1ZSwgJ29uQ2hhbmdlJzogX19jb250ZXh0LnZhbHVlcy5vbkNoYW5nZSB9IH0sIFtdKSwgeyB3dzogeyAndmFsdWUnOiBfX2NvbnRleHQudmFsdWVzLnZhbHVlLCAnb25DaGFuZ2UnOiBfX2NvbnRleHQudmFsdWVzLm9uQ2hhbmdlIH0gfSlcbiAgICAgICAgICAgIF0pLCB7IHdtbDogeyAnaWQnOiAnb3BlbicgfSwgd3c6IHsgJ3RpdGxlJzogX19jb250ZXh0LnZhbHVlcy50aXRsZSwgJ29uU2F2ZSc6IF9fY29udGV4dC52YWx1ZXMub25TYXZlLCAnb25DYW5jZWwnOiBfX2NvbnRleHQudmFsdWVzLm9uQ2FuY2VsIH0gfSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE9wZW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBPcGVuLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE9wZW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBPcGVuLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE9wZW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE9wZW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgT3Blbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgT3Blbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBPcGVuO1xufSgpKTtcbmV4cG9ydHMuT3BlbiA9IE9wZW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1wcm9tcHQuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNhbGxvdXRQYWdlID0gdm9pZCAwO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL2NhbGxvdXRcIik7XG52YXIgc3R5bGVfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi9saWIvY29udGVudC9zdHlsZVwiKTtcbnZhciBDYWxsb3V0UGFnZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDYWxsb3V0UGFnZSgpIHtcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4odGhpcyk7XG4gICAgICAgIHRoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgY2FwaXRhbGl6ZTogZnVuY3Rpb24gKHMpIHsgcmV0dXJuIFwiXCIgKyBzWzBdLnRvVXBwZXJDYXNlKCkgKyBzLnNsaWNlKDEpOyB9LFxuICAgICAgICAgICAgc3R5bGVzOiBbXG4gICAgICAgICAgICAgICAgc3R5bGVfMS5TdHlsZS5EZWZhdWx0LFxuICAgICAgICAgICAgICAgIHN0eWxlXzEuU3R5bGUuUHJpbWFyeSxcbiAgICAgICAgICAgICAgICBzdHlsZV8xLlN0eWxlLlN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgc3R5bGVfMS5TdHlsZS5JbmZvLFxuICAgICAgICAgICAgICAgIHN0eWxlXzEuU3R5bGUuV2FybmluZyxcbiAgICAgICAgICAgICAgICBzdHlsZV8xLlN0eWxlLkVycm9yXG4gICAgICAgICAgICBdXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBDYWxsb3V0UGFnZTtcbn0oKSk7XG5leHBvcnRzLkNhbGxvdXRQYWdlID0gQ2FsbG91dFBhZ2U7XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgQ2FsbG91dFBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGNhbGxvdXRfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvbGF5b3V0L2NhbGxvdXRcIik7XG47XG52YXIgZGVtb18xID0gcmVxdWlyZShcIi4uLy4uLy4uL3dpZGdldHMvZGVtb1wiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gxJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0NhbGxvdXQnKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgX19zcHJlYWRBcnJheXMoW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gyJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdTdHlsZXMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgXSwgX19mb3JJbihfX2NvbnRleHQudmFsdWVzLnN0eWxlcywgZnVuY3Rpb24gKHYsIF8kJGksIF8kJGFsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgY2FsbG91dF8xLkNhbGxvdXQoeyB3dzogeyAnc3R5bGUnOiB2IH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdcXHUwMDBhXFx1MDAwYSAgICAgICAgICAgIFRoaXMgaXMgYSBjYWxsb3V0IHdpdGggc3R5bGUgb24gZGlzcGxheS5cXHUwMDBhXFx1MDAwYSAgICAgICAgICAnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdzdHlsZSc6IHYgfSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHsgcmV0dXJuIChbXSk7IH0pKSlcbiAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICBdKSwge30pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2FsbG91dC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuRGVzY3JpcHRpb25MaXN0UGFnZSA9IHZvaWQgMDtcbnZhciBkZXNjcmlwdGlvbl9saXN0XzEgPSByZXF1aXJlKFwiLi93bWwvZGVzY3JpcHRpb24tbGlzdFwiKTtcbnZhciBEZXNjcmlwdGlvbkxpc3RQYWdlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIERlc2NyaXB0aW9uTGlzdFBhZ2UoKSB7XG4gICAgICAgIHRoaXMudmlldyA9IG5ldyBkZXNjcmlwdGlvbl9saXN0XzEuTWFpbih0aGlzKTtcbiAgICB9XG4gICAgcmV0dXJuIERlc2NyaXB0aW9uTGlzdFBhZ2U7XG59KCkpO1xuZXhwb3J0cy5EZXNjcmlwdGlvbkxpc3RQYWdlID0gRGVzY3JpcHRpb25MaXN0UGFnZTtcbmV4cG9ydHMuZGVmYXVsdCA9IG5ldyBEZXNjcmlwdGlvbkxpc3RQYWdlKCk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWFpbiA9IHZvaWQgMDtcbnZhciBfX2RvY3VtZW50ID0gcmVxdWlyZShcIkBxdWVuay93bWwvbGliL2RvbVwiKTtcbi8vQHRzLWlnbm9yZTogNjE5MlxudmFyIG1heWJlXzEgPSByZXF1aXJlKFwiQHF1ZW5rL25vbmkvbGliL2RhdGEvbWF5YmVcIik7XG52YXIgZGVtb18xID0gcmVxdWlyZShcIi4uLy4uLy4uL3dpZGdldHMvZGVtb1wiKTtcbjtcbnZhciBkZXNjcmlwdGlvbl9saXN0XzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2xheW91dC9kZXNjcmlwdGlvbi1saXN0XCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZXNjcmlwdGlvbl9saXN0XzEuRGVzY3JpcHRpb25MaXN0KHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZXNjcmlwdGlvbl9saXN0XzEuVGl0bGUoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdQaG9uZScpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVzY3JpcHRpb25fbGlzdF8xLkRhdGEoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCc2Mzg1NTMyJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZXNjcmlwdGlvbl9saXN0XzEuVGl0bGUoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdFbWFpbCcpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVzY3JpcHRpb25fbGlzdF8xLkRhdGEoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdoZWxAbG8uY29tJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZXNjcmlwdGlvbl9saXN0XzEuVGl0bGUoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdXZWJzaXRlJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZXNjcmlwdGlvbl9saXN0XzEuRGF0YSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ2V4YW1wbGUuY29tJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVzY3JpcHRpb25fbGlzdF8xLkRlc2NyaXB0aW9uTGlzdCh7IHd3OiB7ICdob3Jpem9udGFsJzogdHJ1ZSB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlc2NyaXB0aW9uX2xpc3RfMS5UaXRsZSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1Bob25lJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZXNjcmlwdGlvbl9saXN0XzEuRGF0YSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJzYzODU1MzInKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlc2NyaXB0aW9uX2xpc3RfMS5UaXRsZSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0VtYWlsJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZXNjcmlwdGlvbl9saXN0XzEuRGF0YSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ2hlbEBsby5jb20nKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlc2NyaXB0aW9uX2xpc3RfMS5UaXRsZSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1dlYnNpdGUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlc2NyaXB0aW9uX2xpc3RfMS5EYXRhKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnZXhhbXBsZS5jb20nKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnaG9yaXpvbnRhbCc6IHRydWUgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1kZXNjcmlwdGlvbi1saXN0LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5HcmlkTGF5b3V0UGFnZSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9ncmlkXCIpO1xudmFyIEdyaWRMYXlvdXRQYWdlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEdyaWRMYXlvdXRQYWdlKCkge1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICByb290OiB7XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZ3JpZC1sYXlvdXQtZXhhbXBsZSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIEdyaWRMYXlvdXRQYWdlO1xufSgpKTtcbmV4cG9ydHMuR3JpZExheW91dFBhZ2UgPSBHcmlkTGF5b3V0UGFnZTtcbmV4cG9ydHMuZGVmYXVsdCA9IG5ldyBHcmlkTGF5b3V0UGFnZSgpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGdyaWRfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvbGF5b3V0L2dyaWRcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuR3JpZExheW91dCh7IHd3OiB7ICdjbGFzc05hbWUnOiBfX2NvbnRleHQudmFsdWVzLnJvb3QuY2xhc3NOYW1lIH0gfSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGdyaWRfMS5Sb3coe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLkNvbHVtbih7IHd3OiB7ICdzcGFuJzogMSB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1NwYW4gMScpXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdzcGFuJzogMSB9IH0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuQ29sdW1uKHsgd3c6IHsgJ3NwYW4nOiAxIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnU3BhbiAxJylcbiAgICAgICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ3NwYW4nOiAxIH0gfSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGdyaWRfMS5Db2x1bW4oeyB3dzogeyAnc3Bhbic6IDEgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdTcGFuIDEnKVxuICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnc3Bhbic6IDEgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLkNvbHVtbih7IHd3OiB7ICdzcGFuJzogMSB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1NwYW4gMScpXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdzcGFuJzogMSB9IH0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuQ29sdW1uKHsgd3c6IHsgJ3NwYW4nOiAxIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnU3BhbiAxJylcbiAgICAgICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ3NwYW4nOiAxIH0gfSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGdyaWRfMS5Db2x1bW4oeyB3dzogeyAnc3Bhbic6IDEgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdTcGFuIDEnKVxuICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnc3Bhbic6IDEgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLkNvbHVtbih7IHd3OiB7ICdzcGFuJzogMSB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1NwYW4gMScpXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdzcGFuJzogMSB9IH0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuQ29sdW1uKHsgd3c6IHsgJ3NwYW4nOiAxIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnU3BhbiAxJylcbiAgICAgICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ3NwYW4nOiAxIH0gfSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGdyaWRfMS5Db2x1bW4oeyB3dzogeyAnc3Bhbic6IDEgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdTcGFuIDEnKVxuICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnc3Bhbic6IDEgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLkNvbHVtbih7IHd3OiB7ICdzcGFuJzogMSB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1NwYW4gMScpXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdzcGFuJzogMSB9IH0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuQ29sdW1uKHsgd3c6IHsgJ3NwYW4nOiAxIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnU3BhbiAxJylcbiAgICAgICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ3NwYW4nOiAxIH0gfSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGdyaWRfMS5Db2x1bW4oeyB3dzogeyAnc3Bhbic6IDEgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdTcGFuIDEnKVxuICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnc3Bhbic6IDEgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLlJvdyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuQ29sdW1uKHsgd3c6IHsgJ3NwYW4nOiA4IH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnU3BhbiA4JylcbiAgICAgICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ3NwYW4nOiA4IH0gfSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGdyaWRfMS5Db2x1bW4oeyB3dzogeyAnc3Bhbic6IDQgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdTcGFuIDQnKVxuICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnc3Bhbic6IDQgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLlJvdyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuQ29sdW1uKHsgd3c6IHsgJ3NwYW4nOiA0IH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnU3BhbiA0JylcbiAgICAgICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ3NwYW4nOiA0IH0gfSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGdyaWRfMS5Db2x1bW4oeyB3dzogeyAnc3Bhbic6IDQgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdTcGFuIDQnKVxuICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnc3Bhbic6IDQgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLkNvbHVtbih7IHd3OiB7ICdzcGFuJzogNCB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1NwYW4gNCcpXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdzcGFuJzogNCB9IH0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuUm93KHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGdyaWRfMS5Db2x1bW4oeyB3dzogeyAnc3Bhbic6IDYgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdTcGFuIDYnKVxuICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnc3Bhbic6IDYgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLkNvbHVtbih7IHd3OiB7ICdzcGFuJzogNiB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1NwYW4gNicpXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdzcGFuJzogNiB9IH0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuUm93KHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGdyaWRfMS5Db2x1bW4oeyB3dzogeyAnc3Bhbic6IDYgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdTcGFuIDYnKVxuICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnc3Bhbic6IDYgfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLkNvbHVtbih7IHd3OiB7ICdzcGFuJzogNiB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1NwYW4gNicpXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdzcGFuJzogNiB9IH0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuQ29sdW1uKHsgd3c6IHsgJ3NwYW4nOiA2IH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnU3BhbiA2JylcbiAgICAgICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ3NwYW4nOiA2IH0gfSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGdyaWRfMS5Db2x1bW4oeyB3dzogeyAnc3Bhbic6IDYgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdTcGFuIDYnKVxuICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnc3Bhbic6IDYgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLlJvdyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuQ29sdW1uKHsgd3c6IHsgJ3NwYW4nOiAxMiB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1NwYW4gMTInKVxuICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnc3Bhbic6IDEyIH0gfSlcbiAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICBdKSwgeyB3dzogeyAnY2xhc3NOYW1lJzogX19jb250ZXh0LnZhbHVlcy5yb290LmNsYXNzTmFtZSB9IH0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Z3JpZC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuSG9yaXpvbnRhbExheW91dFBhZ2UgPSB2b2lkIDA7XG52YXIgdmlld3MgPSByZXF1aXJlKFwiLi93bWwvaG9yaXpvbnRhbFwiKTtcbnZhciBIb3Jpem9udGFsTGF5b3V0UGFnZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBIb3Jpem9udGFsTGF5b3V0UGFnZSgpIHtcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IHZpZXdzLk1haW4odGhpcyk7XG4gICAgfVxuICAgIHJldHVybiBIb3Jpem9udGFsTGF5b3V0UGFnZTtcbn0oKSk7XG5leHBvcnRzLkhvcml6b250YWxMYXlvdXRQYWdlID0gSG9yaXpvbnRhbExheW91dFBhZ2U7XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgSG9yaXpvbnRhbExheW91dFBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xudmFyIGhvcml6b250YWxfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvbGF5b3V0L2hvcml6b250YWxcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGhvcml6b250YWxfMS5Ib3Jpem9udGFsTGF5b3V0KHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgndGV4dGFyZWEnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0FyZWEgMScpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCd0ZXh0YXJlYScsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnQXJlYSAyJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3RleHRhcmVhJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdBcmVhIDMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaG9yaXpvbnRhbF8xLkhvcml6b250YWxMYXlvdXQoeyB3dzogeyAnb3JpZW50YXRpb24nOiBob3Jpem9udGFsXzEuSG9yaXpvbnRhbExheW91dE9yaWVudGF0aW9uLkxlZnQgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdcXHUwMDBhICAgICAgVGhpcyBpcyBvcmllbnRlZCB0byB0aGUgbGVmdC5cXHUwMDBhICAgICcpXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdvcmllbnRhdGlvbic6IGhvcml6b250YWxfMS5Ib3Jpem9udGFsTGF5b3V0T3JpZW50YXRpb24uTGVmdCB9IH0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBob3Jpem9udGFsXzEuSG9yaXpvbnRhbExheW91dCh7IHd3OiB7ICdvcmllbnRhdGlvbic6IGhvcml6b250YWxfMS5Ib3Jpem9udGFsTGF5b3V0T3JpZW50YXRpb24uUmlnaHQgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdcXHUwMDBhICAgICAgVGhpcyBpcyBvcmllbnRlZCB0byB0aGUgcmlnaHQuXFx1MDAwYSAgICAnKVxuICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnb3JpZW50YXRpb24nOiBob3Jpem9udGFsXzEuSG9yaXpvbnRhbExheW91dE9yaWVudGF0aW9uLlJpZ2h0IH0gfSlcbiAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICBdKSwge30pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aG9yaXpvbnRhbC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTGlzdExheW91dFBhZ2UgPSB2b2lkIDA7XG52YXIgbGlzdF8xID0gcmVxdWlyZShcIi4vd21sL2xpc3RcIik7XG52YXIgTGlzdExheW91dFBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTGlzdExheW91dFBhZ2UoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMudmlldyA9IG5ldyBsaXN0XzEuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy5pdGVtcyA9IHtcbiAgICAgICAgICAgICdUaGlzIGlzIHRoZSBmaXJzdCBpdGVtLic6IGZhbHNlLFxuICAgICAgICAgICAgJ1RoaXMgaXMgdGhlIHNlY29uZCBpdGVtLic6IHRydWUsXG4gICAgICAgICAgICAnVGhpcyBpcyB0aGUgdGhpcmQgaXRlbS4nOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNsaWNrID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzXG4gICAgICAgICAgICAgICAgLnZpZXdcbiAgICAgICAgICAgICAgICAuZmluZEJ5SWQoa2V5KVxuICAgICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGwpIHsgcmV0dXJuIGwudG9nZ2xlQWN0aXZlKCk7IH0pXG4gICAgICAgICAgICAgICAgLm9ySnVzdChmdW5jdGlvbiAoKSB7IHJldHVybiBhbGVydChcIkNhbm5vdCBmaW5kIGVsZW1lbnQgYnkgaWQgXFxcIlwiICsga2V5ICsgXCJcXFwiIVwiKTsgfSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBMaXN0TGF5b3V0UGFnZTtcbn0oKSk7XG5leHBvcnRzLkxpc3RMYXlvdXRQYWdlID0gTGlzdExheW91dFBhZ2U7XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgTGlzdExheW91dFBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG52YXIgbGlzdF8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9sYXlvdXQvbGlzdFwiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbGlzdF8xLkxpc3RMYXlvdXQoe30sIF9fc3ByZWFkQXJyYXlzKF9fZm9yT2YoX19jb250ZXh0Lml0ZW1zLCBmdW5jdGlvbiAoeWVzLCBrZXksIF8kJGFsbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGxpc3RfMS5MaXN0TGF5b3V0SXRlbSh7IHdtbDogeyAnaWQnOiBrZXkgfSwgd3c6IHsgJ25hbWUnOiBrZXksICdhY3RpdmUnOiB5ZXMsICdvbkNsaWNrJzogX19jb250ZXh0LmNsaWNrIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoa2V5KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSwgeyB3bWw6IHsgJ2lkJzoga2V5IH0sIHd3OiB7ICduYW1lJzoga2V5LCAnYWN0aXZlJzogeWVzLCAnb25DbGljayc6IF9fY29udGV4dC5jbGljayB9IH0pXG4gICAgICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHsgcmV0dXJuIChbXSk7IH0pKSksIHt9KVxuICAgICAgICAgICAgXSksIHt9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxpc3QuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1ldGVyUGFnZSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC9tZXRlclwiKTtcbnZhciBNZXRlclBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWV0ZXJQYWdlKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7XG4gICAgICAgICAgICBtZXNzYWdlOiAnVGhpcyBpcyBhbiBhbGVydCcsXG4gICAgICAgICAgICBiYXJzOiBbXG4gICAgICAgICAgICAgICAgeyB2YWx1ZTogMTAsIGNvbG9yOiAncmVkJyB9LFxuICAgICAgICAgICAgICAgIHsgdmFsdWU6IDUwLCBjb2xvcjogJ2dyZWVuJyB9LFxuICAgICAgICAgICAgICAgIHsgdmFsdWU6IDQwLCBjb2xvcjogJ2JsdWUnIH1cbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBpbmM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgbSA9IF90aGlzLnZpZXcuZmluZEJ5SWQoJ3NpbmdsZScpO1xuICAgICAgICAgICAgICAgIGlmIChtLmlzSnVzdCgpKVxuICAgICAgICAgICAgICAgICAgICBtLmdldCgpLmluY3JlYXNlKDEwKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZWM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgbSA9IF90aGlzLnZpZXcuZmluZEJ5SWQoJ3NpbmdsZScpO1xuICAgICAgICAgICAgICAgIGlmIChtLmlzSnVzdCgpKVxuICAgICAgICAgICAgICAgICAgICBtLmdldCgpLmRlY3JlYXNlKDEwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIE1ldGVyUGFnZTtcbn0oKSk7XG5leHBvcnRzLk1ldGVyUGFnZSA9IE1ldGVyUGFnZTtcbmV4cG9ydHMuZGVmYXVsdCA9IG5ldyBNZXRlclBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIG1ldGVyXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2xheW91dC9tZXRlclwiKTtcbjtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnaDEnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdNZXRlcicpXG4gICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gyJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1NpbmdsZScpXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnYnV0dG9uJywgeyAnb25jbGljayc6IF9fY29udGV4dC52YWx1ZXMuZGVjIH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCctJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2J1dHRvbicsIHsgJ29uY2xpY2snOiBfX2NvbnRleHQudmFsdWVzLmluYyB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnKycpXG4gICAgICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbWV0ZXJfMS5NZXRlcih7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbWV0ZXJfMS5NZXRlckJhcih7IHdtbDogeyAnaWQnOiAnc2luZ2xlJyB9LCB3dzogeyAndmFsdWUnOiA3NSwgJ2NvbG9yJzogJ3llbGxvdycgfSB9LCBbXSksIHsgd21sOiB7ICdpZCc6ICdzaW5nbGUnIH0sIHd3OiB7ICd2YWx1ZSc6IDc1LCAnY29sb3InOiAneWVsbG93JyB9IH0pXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdoMicsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnQ29tYmluZWQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBtZXRlcl8xLk1ldGVyKHt9LCBfX3NwcmVhZEFycmF5cyhfX2ZvckluKF9fY29udGV4dC52YWx1ZXMuYmFycywgZnVuY3Rpb24gKHYsIF8kJGksIF8kJGFsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBtZXRlcl8xLk1ldGVyQmFyKHsgd3c6IHsgJ3ZhbHVlJzogdi52YWx1ZSwgJ2NvbG9yJzogdi5jb2xvciB9IH0sIFtdKSwgeyB3dzogeyAndmFsdWUnOiB2LnZhbHVlLCAnY29sb3InOiB2LmNvbG9yIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHsgcmV0dXJuIChbXSk7IH0pKSksIHt9KVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tZXRlci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuUGFuZWxQYWdlID0gdm9pZCAwO1xudmFyIHBhbmVsXzEgPSByZXF1aXJlKFwiLi93bWwvcGFuZWxcIik7XG52YXIgUGFuZWxQYWdlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFBhbmVsUGFnZSgpIHtcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IHBhbmVsXzEuTWFpbih0aGlzKTtcbiAgICB9XG4gICAgcmV0dXJuIFBhbmVsUGFnZTtcbn0oKSk7XG5leHBvcnRzLlBhbmVsUGFnZSA9IFBhbmVsUGFnZTtcbmV4cG9ydHMuZGVmYXVsdCA9IG5ldyBQYW5lbFBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGdyaWRfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvbGF5b3V0L2dyaWRcIik7XG47XG52YXIgcGFuZWxfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvbGF5b3V0L3BhbmVsXCIpO1xuO1xudmFyIHN0eWxlXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2NvbnRlbnQvc3R5bGVcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuR3JpZExheW91dCh7fSwgX19zcHJlYWRBcnJheXMoX19mb3JJbihzdHlsZV8xLnN0eWxlcywgZnVuY3Rpb24gKHN0eWxlLCBfJCRpLCBfJCRhbGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLlJvdyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLkNvbHVtbih7IHd3OiB7ICdzcGFuJzogNCB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBwYW5lbF8xLlBhbmVsKHsgd3c6IHsgJ3N0eWxlJzogc3R5bGUgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHBhbmVsXzEuUGFuZWxCb2R5KHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdcXHUwMDBhICAgICAgICAgICAgUGFuZWxCb2R5IG9ubHkuXFx1MDAwYSAgICAgICAgICAnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ3N0eWxlJzogc3R5bGUgfSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ3NwYW4nOiA0IH0gfSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuQ29sdW1uKHsgd3c6IHsgJ3NwYW4nOiA0IH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHBhbmVsXzEuUGFuZWwoeyB3dzogeyAnc3R5bGUnOiBzdHlsZSB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgcGFuZWxfMS5QYW5lbEhlYWRlcih7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnXFx1MDAwYSAgICAgICAgICAgIFdpdGggUGFuZWxIZWFkZXJcXHUwMDBhICAgICAgICAgICcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHBhbmVsXzEuUGFuZWxCb2R5KHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdcXHUwMDBhICAgICAgICAgICAgTG9yZW0gaW1wc3VtIGRpbGl1bSBuZXQgc2V0LlxcdTAwMGEgICAgICAgICAgJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdzdHlsZSc6IHN0eWxlIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdzcGFuJzogNCB9IH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZ3JpZF8xLkNvbHVtbih7IHd3OiB7ICdzcGFuJzogNCB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBwYW5lbF8xLlBhbmVsKHsgd3c6IHsgJ3N0eWxlJzogc3R5bGUgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHBhbmVsXzEuUGFuZWxIZWFkZXIoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1dpdGggUGFuZWxGb290ZXInKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBwYW5lbF8xLlBhbmVsQm9keSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnTG9yZW0gaW1wc3VtIGRpbGl1bSBuZXQgc2V0LicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHBhbmVsXzEuUGFuZWxGb290ZXIoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ01laCBmb290LicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnc3R5bGUnOiBzdHlsZSB9IH0pXG4gICAgICAgICAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAnc3Bhbic6IDQgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7IHJldHVybiAoW10pOyB9KSkpLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYW5lbC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuVGFiTGF5b3V0UGFnZSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC90YWJcIik7XG52YXIgVGFiTGF5b3V0UGFnZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBUYWJMYXlvdXRQYWdlKCkge1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy50YWJzID0ge1xuICAgICAgICAgICAgZmlyc3Q6IHtcbiAgICAgICAgICAgICAgICB0ZXh0OiAnRmlyc3QnLFxuICAgICAgICAgICAgICAgIGNvbnRlbnRGdW46IHZpZXdzLmZpcnN0VGFiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2Vjb25kOiB7XG4gICAgICAgICAgICAgICAgdGV4dDogJ1NlY29uZCcsXG4gICAgICAgICAgICAgICAgY29udGVudEZ1bjogdmlld3Muc2Vjb25kVGFiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGhpcmQ6IHtcbiAgICAgICAgICAgICAgICB0ZXh0OiAnVGhpcmQnLFxuICAgICAgICAgICAgICAgIGNvbnRlbnRGdW46IHZpZXdzLnRoaXJkVGFiXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBUYWJMYXlvdXRQYWdlO1xufSgpKTtcbmV4cG9ydHMuVGFiTGF5b3V0UGFnZSA9IFRhYkxheW91dFBhZ2U7XG5leHBvcnRzLmRlZmF1bHQgPSBuZXcgVGFiTGF5b3V0UGFnZSgpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSBleHBvcnRzLnRoaXJkVGFiID0gZXhwb3J0cy5zZWNvbmRUYWIgPSBleHBvcnRzLmZpcnN0VGFiID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xudmFyIHRhYl8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9sYXlvdXQvdGFiXCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbmV4cG9ydHMuZmlyc3RUYWIgPSBmdW5jdGlvbiAoXykgeyByZXR1cm4gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgIHJldHVybiBbXG4gICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0NsaWNrIGEgdGFiIHRvIGNoYW5nZSBjb250ZW50LicpXG4gICAgICAgIF0pXG4gICAgXTtcbn07IH07XG47XG5leHBvcnRzLnNlY29uZFRhYiA9IGZ1bmN0aW9uIChfKSB7IHJldHVybiBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnU2Vjb25kIHRhYi4nKVxuICAgICAgICBdKVxuICAgIF07XG59OyB9O1xuO1xuZXhwb3J0cy50aGlyZFRhYiA9IGZ1bmN0aW9uIChfKSB7IHJldHVybiBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnVGhpcmQgdGFiLicpXG4gICAgICAgIF0pXG4gICAgXTtcbn07IH07XG47XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFiXzEuVGFiTGF5b3V0KHsgd3c6IHsgJ3RhYnMnOiBfX2NvbnRleHQudGFicywgJ2FjdGl2ZSc6ICdmaXJzdCcgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdwJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0NsaWNrIGEgdGFiIHRvIGNoYW5nZSBjb250ZW50LicpXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ3RhYnMnOiBfX2NvbnRleHQudGFicywgJ2FjdGl2ZSc6ICdmaXJzdCcgfSB9KVxuICAgICAgICAgICAgXSksIHt9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXRhYi5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuVGFibGVMYXlvdXRQYWdlID0gdm9pZCAwO1xudmFyIHRhYmxlXzEgPSByZXF1aXJlKFwiLi93bWwvdGFibGVcIik7XG52YXIgVGFibGVMYXlvdXRQYWdlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFRhYmxlTGF5b3V0UGFnZSgpIHtcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IHRhYmxlXzEuTWFpbih0aGlzKTtcbiAgICB9XG4gICAgcmV0dXJuIFRhYmxlTGF5b3V0UGFnZTtcbn0oKSk7XG5leHBvcnRzLlRhYmxlTGF5b3V0UGFnZSA9IFRhYmxlTGF5b3V0UGFnZTtcbmV4cG9ydHMuZGVmYXVsdCA9IG5ldyBUYWJsZUxheW91dFBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSBleHBvcnRzLmNvbnRlbnQgPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG52YXIgdGFibGVfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvbGF5b3V0L3RhYmxlXCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbmV4cG9ydHMuY29udGVudCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICByZXR1cm4gW1xuICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWJsZV8xLlRhYmxlSGVhZGVyKHt9LCBbXG4gICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWJsZV8xLlRhYmxlUm93KHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFibGVfMS5UYWJsZUhlYWRpbmcoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnTmFtZScpXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWJsZV8xLlRhYmxlSGVhZGluZyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdFbWFpbCcpXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWJsZV8xLlRhYmxlSGVhZGluZyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdCYWxhbmNlJylcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVIZWFkaW5nKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1VzZXJuYW1lJylcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVIZWFkaW5nKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1N0YXR1cycpXG4gICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICBdKSwge30pLFxuICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWJsZV8xLlRhYmxlQm9keSh7fSwgW1xuICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFibGVfMS5UYWJsZVJvdyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVDZWxsKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0xlbmd0aCBXaXNlJylcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVDZWxsKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ2x3QHRoZWVtYWlscGxhY2UuY29tJylcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVDZWxsKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJyQ1MDAwJylcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVDZWxsKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ2x3JylcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVDZWxsKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0FjdGl2ZScpXG4gICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVSb3coe30sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWJsZV8xLlRhYmxlQ2VsbCh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdGaXJzdCBDaGFuY2UnKVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFibGVfMS5UYWJsZUNlbGwoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnZmNoYWNuZUBsaXZlLnR0JylcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVDZWxsKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJyQxLjAwJylcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVDZWxsKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ2NoYW5jZScpXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWJsZV8xLlRhYmxlQ2VsbCh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdJbmFjdGl2ZScpXG4gICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVSb3coe30sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWJsZV8xLlRhYmxlQ2VsbCh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdEdSBQZWFyJylcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVDZWxsKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ2R1cGVhckBnbWFpbC5jb20nKVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFibGVfMS5UYWJsZUNlbGwoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJDEwLDAwMC4wMCcpXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWJsZV8xLlRhYmxlQ2VsbCh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdwZWFyYm95JylcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVDZWxsKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0FjdGl2ZScpXG4gICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVSb3coe30sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWJsZV8xLlRhYmxlQ2VsbCh7IHd3OiB7ICdyb3dzcGFuJzogMiwgJ2NvbHNwYW4nOiA1IH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdUaGlzIHNwYW5zIDIgcm93cyA1IGNvbHVtbnMuJylcbiAgICAgICAgICAgICAgICBdKSwgeyB3dzogeyAncm93c3Bhbic6IDIsICdjb2xzcGFuJzogNSB9IH0pXG4gICAgICAgICAgICBdKSwge30pXG4gICAgICAgIF0pLCB7fSksXG4gICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVGb290ZXIoe30sIFtcbiAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVSb3coe30sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWJsZV8xLlRhYmxlQ2VsbCh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcxJylcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVDZWxsKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJzInKVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFibGVfMS5UYWJsZUNlbGwoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnMycpXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB0YWJsZV8xLlRhYmxlQ2VsbCh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCc0JylcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVDZWxsKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJzUnKVxuICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgXSksIHt9KVxuICAgIF07XG59OyB9O1xuO1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdoMycsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdOb3JtYWwnKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFibGVfMS5UYWJsZUxheW91dCh7fSwgX19zcHJlYWRBcnJheXMoKGV4cG9ydHMuY29udGVudCgpKF9fdGhpcykpKSksIHt9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gzJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJyBBbHRlcm5hdGUnKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFibGVfMS5UYWJsZUxheW91dCh7IHd3OiB7ICdhbHRlcm5hdGUnOiB0cnVlIH0gfSwgX19zcHJlYWRBcnJheXMoKGV4cG9ydHMuY29udGVudCgpKF9fdGhpcykpKSksIHsgd3c6IHsgJ2FsdGVybmF0ZSc6IHRydWUgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gzJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0JvcmRlcmVkJylcbiAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVMYXlvdXQoeyB3dzogeyAnYm9yZGVyZWQnOiB0cnVlIH0gfSwgX19zcHJlYWRBcnJheXMoKGV4cG9ydHMuY29udGVudCgpKF9fdGhpcykpKSksIHsgd3c6IHsgJ2JvcmRlcmVkJzogdHJ1ZSB9IH0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnaDMnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnSG92ZXJhYmxlJylcbiAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVMYXlvdXQoeyB3dzogeyAnaG92ZXJhYmxlJzogdHJ1ZSB9IH0sIF9fc3ByZWFkQXJyYXlzKChleHBvcnRzLmNvbnRlbnQoKShfX3RoaXMpKSkpLCB7IHd3OiB7ICdob3ZlcmFibGUnOiB0cnVlIH0gfSlcbiAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy5ub2RlKCdoMycsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdDb21wYWN0JylcbiAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IHRhYmxlXzEuVGFibGVMYXlvdXQoeyB3dzogeyAnY29tcGFjdCc6IHRydWUgfSB9LCBfX3NwcmVhZEFycmF5cygoZXhwb3J0cy5jb250ZW50KCkoX190aGlzKSkpKSwgeyB3dzogeyAnY29tcGFjdCc6IHRydWUgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFibGVfMS5UYWJsZVdpbmRvdyh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgdGFibGVfMS5UYWJsZUxheW91dCh7fSwgX19zcHJlYWRBcnJheXMoKGV4cG9ydHMuY29udGVudCgpKF9fdGhpcykpKSksIHt9KVxuICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgXSksIHt9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXRhYmxlLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5XZWxsUGFnZSA9IHZvaWQgMDtcbnZhciB2aWV3cyA9IHJlcXVpcmUoXCIuL3dtbC93ZWxsXCIpO1xudmFyIFdlbGxQYWdlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFdlbGxQYWdlKCkge1xuICAgICAgICB0aGlzLnZpZXcgPSBuZXcgdmlld3MuTWFpbih0aGlzKTtcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB7fTtcbiAgICB9XG4gICAgcmV0dXJuIFdlbGxQYWdlO1xufSgpKTtcbmV4cG9ydHMuV2VsbFBhZ2UgPSBXZWxsUGFnZTtcbmV4cG9ydHMuZGVmYXVsdCA9IG5ldyBXZWxsUGFnZSgpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIHdlbGxfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi8uLi8uLi9saWIvbGF5b3V0L3dlbGxcIik7XG47XG52YXIgZGVtb18xID0gcmVxdWlyZShcIi4uLy4uLy4uL3dpZGdldHMvZGVtb1wiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gxJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1dlbGwnKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgd2VsbF8xLldlbGwoe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdUaGlzIGlzIGluIGEgd2VsbC4nKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ3AnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgd2VsbF8xLldlbGwoeyB3dzogeyAnY2xhc3NOYW1lJzogJy1zbWFsbCcgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnVGhpcyBpcyBhIHNtYWxsIHdlbGwuJylcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdjbGFzc05hbWUnOiAnLXNtYWxsJyB9IH0pXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgncCcsIHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyB3ZWxsXzEuV2VsbCh7IHd3OiB7ICdjbGFzc05hbWUnOiAnLWxhcmdlJyB9IH0sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdUaGlzIGlzIGEgc21hbGwgd2VsbC4nKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ2NsYXNzTmFtZSc6ICctbGFyZ2UnIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICBdKSwge30pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9d2VsbC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuTWVudVBhZ2UgPSB2b2lkIDA7XG52YXIgbWVudV8xID0gcmVxdWlyZShcIi4vd21sL21lbnVcIik7XG52YXIgTWVudVBhZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWVudVBhZ2UoKSB7XG4gICAgICAgIHRoaXMudmlldyA9IG5ldyBtZW51XzEuTWFpbih0aGlzKTtcbiAgICB9XG4gICAgcmV0dXJuIE1lbnVQYWdlO1xufSgpKTtcbmV4cG9ydHMuTWVudVBhZ2UgPSBNZW51UGFnZTtcbmV4cG9ydHMuZGVmYXVsdCA9IG5ldyBNZW51UGFnZSgpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGRlbW9fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi93aWRnZXRzL2RlbW9cIik7XG47XG52YXIgbWVudV8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9tZW51L21lbnVcIik7XG47XG52YXIgaXRlbV8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9tZW51L2l0ZW1cIik7XG47XG52YXIgbGlua18xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9jb250ZW50L2xpbmtcIik7XG47XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE1haW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWFpbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBkZW1vXzEuRGVtbyh7fSwgW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IG1lbnVfMS5NZW51KHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGl0ZW1fMS5JdGVtKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMubm9kZSgnaDYnLCB7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ01lbnUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaXRlbV8xLkl0ZW0oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGxpbmtfMS5MaW5rKHsgd3c6IHsgJ2Rpc2FibGVkJzogdHJ1ZSwgJ3RleHQnOiAnQmFjaycgfSB9LCBbXSksIHsgd3c6IHsgJ2Rpc2FibGVkJzogdHJ1ZSwgJ3RleHQnOiAnQmFjaycgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKSwge30pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBpdGVtXzEuSXRlbSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbGlua18xLkxpbmsoeyB3dzogeyAnZGlzYWJsZWQnOiB0cnVlLCAndGV4dCc6ICdSZWZyZXNoJyB9IH0sIFtdKSwgeyB3dzogeyAnZGlzYWJsZWQnOiB0cnVlLCAndGV4dCc6ICdSZWZyZXNoJyB9IH0pXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGl0ZW1fMS5JdGVtKHsgd3c6IHsgJ2RpdmlkZXInOiB0cnVlIH0gfSwgW10pLCB7IHd3OiB7ICdkaXZpZGVyJzogdHJ1ZSB9IH0pLFxuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBpdGVtXzEuSXRlbSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2EnLCB7ICdocmVmJzogJyMvbWVudScgfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1F1aXQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tZW51LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5OYXZQYWdlID0gdm9pZCAwO1xudmFyIG5hdl8xID0gcmVxdWlyZShcIi4vd21sL25hdlwiKTtcbnZhciBOYXZQYWdlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE5hdlBhZ2UoKSB7XG4gICAgICAgIHRoaXMudmlldyA9IG5ldyBuYXZfMS5NYWluKHRoaXMpO1xuICAgIH1cbiAgICByZXR1cm4gTmF2UGFnZTtcbn0oKSk7XG5leHBvcnRzLk5hdlBhZ2UgPSBOYXZQYWdlO1xuZXhwb3J0cy5kZWZhdWx0ID0gbmV3IE5hdlBhZ2UoKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBkZW1vXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vd2lkZ2V0cy9kZW1vXCIpO1xuO1xudmFyIG5hdl8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uLy4uLy4uL2xpYi9tZW51L25hdlwiKTtcbjtcbnZhciBpdGVtXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL21lbnUvaXRlbVwiKTtcbjtcbnZhciBsaW5rXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2NvbnRlbnQvbGlua1wiKTtcbjtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRlbW9fMS5EZW1vKHt9LCBbXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gzJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1RoaXMgaXMgYSBob3Jpem9udGFsIG5hdi4nKVxuICAgICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbmF2XzEuTmF2KHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBpdGVtXzEuSXRlbSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGxpbmtfMS5MaW5rKHsgd3c6IHsgJ3RleHQnOiAnSG9tZScgfSB9LCBbXSksIHsgd3c6IHsgJ3RleHQnOiAnSG9tZScgfSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGl0ZW1fMS5JdGVtKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbGlua18xLkxpbmsoeyB3dzogeyAnZGlzYWJsZWQnOiB0cnVlLCAndGV4dCc6ICdVc2VycycgfSB9LCBbXSksIHsgd3c6IHsgJ2Rpc2FibGVkJzogdHJ1ZSwgJ3RleHQnOiAnVXNlcnMnIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBpdGVtXzEuSXRlbSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGxpbmtfMS5MaW5rKHsgd3c6IHsgJ3RleHQnOiAnTG9nb3V0JyB9IH0sIFtdKSwgeyB3dzogeyAndGV4dCc6ICdMb2dvdXQnIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgZGVtb18xLkRlbW8oe30sIFtcbiAgICAgICAgICAgICAgICAgICAgX190aGlzLm5vZGUoJ2gzJywge30sIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ1RoaXMgaXMgYSB2ZXJ0aWNhbCBuYXYuJylcbiAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IG5hdl8xLk5hdih7IHd3OiB7ICd2ZXJ0aWNhbCc6IHRydWUgfSB9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBpdGVtXzEuSXRlbSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGxpbmtfMS5MaW5rKHsgd3c6IHsgJ3RleHQnOiAnSG9tZScgfSB9LCBbXSksIHsgd3c6IHsgJ3RleHQnOiAnSG9tZScgfSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGl0ZW1fMS5JdGVtKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbGlua18xLkxpbmsoeyB3dzogeyAnZGlzYWJsZWQnOiB0cnVlLCAndGV4dCc6ICdVc2VycycgfSB9LCBbXSksIHsgd3c6IHsgJ2Rpc2FibGVkJzogdHJ1ZSwgJ3RleHQnOiAnVXNlcnMnIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSksXG4gICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBpdGVtXzEuSXRlbSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGxpbmtfMS5MaW5rKHsgd3c6IHsgJ3RleHQnOiAnTG9nb3V0JyB9IH0sIFtdKSwgeyB3dzogeyAndGV4dCc6ICdMb2dvdXQnIH0gfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgICAgICAgICAgXSksIHsgd3c6IHsgJ3ZlcnRpY2FsJzogdHJ1ZSB9IH0pXG4gICAgICAgICAgICAgICAgXSksIHt9KVxuICAgICAgICAgICAgXSksIHt9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE1haW47XG59KCkpO1xuZXhwb3J0cy5NYWluID0gTWFpbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW5hdi5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucGFnZXMgPSB2b2lkIDA7XG5leHBvcnRzLnBhZ2VzID0ge1xuICAgICdjb250ZW50X2VtYmVkJzogcmVxdWlyZSgnLi9wYWdlL2NvbnRlbnRfZW1iZWQnKS5kZWZhdWx0LFxuICAgICdjb250ZW50X21lZGlhLWRlc2NyaXB0aW9uJzogcmVxdWlyZSgnLi9wYWdlL2NvbnRlbnRfbWVkaWEtZGVzY3JpcHRpb24nKS5kZWZhdWx0LFxuICAgICdjb250ZW50X292ZXJsYXknOiByZXF1aXJlKCcuL3BhZ2UvY29udGVudF9vdmVybGF5JykuZGVmYXVsdCxcbiAgICAnY29udGVudF90YWcnOiByZXF1aXJlKCcuL3BhZ2UvY29udGVudF90YWcnKS5kZWZhdWx0LFxuICAgICdjb250ZW50X3RodW1ibmFpbCc6IHJlcXVpcmUoJy4vcGFnZS9jb250ZW50X3RodW1ibmFpbCcpLmRlZmF1bHQsXG4gICAgJ2NvbnRyb2xfYnV0dG9uJzogcmVxdWlyZSgnLi9wYWdlL2NvbnRyb2xfYnV0dG9uJykuZGVmYXVsdCxcbiAgICAnY29udHJvbF9idXR0b24tZ3JvdXAnOiByZXF1aXJlKCcuL3BhZ2UvY29udHJvbF9idXR0b24tZ3JvdXAnKS5kZWZhdWx0LFxuICAgICdjb250cm9sX2J1dHRvbi1zZWxlY3QnOiByZXF1aXJlKCcuL3BhZ2UvY29udHJvbF9idXR0b24tc2VsZWN0JykuZGVmYXVsdCxcbiAgICAnY29udHJvbF9jaGVja2JveCc6IHJlcXVpcmUoJy4vcGFnZS9jb250cm9sX2NoZWNrYm94JykuZGVmYXVsdCxcbiAgICAnY29udHJvbF9kYXRlLWZpZWxkJzogcmVxdWlyZSgnLi9wYWdlL2NvbnRyb2xfZGF0ZS1maWVsZCcpLmRlZmF1bHQsXG4gICAgJ2NvbnRyb2xfZGlzcGxheS1maWVsZCc6IHJlcXVpcmUoJy4vcGFnZS9jb250cm9sX2Rpc3BsYXktZmllbGQnKS5kZWZhdWx0LFxuICAgICdjb250cm9sX2Ryb3AtZG93bic6IHJlcXVpcmUoJy4vcGFnZS9jb250cm9sX2Ryb3AtZG93bicpLmRlZmF1bHQsXG4gICAgJ2NvbnRyb2xfZHJvcC1saXN0JzogcmVxdWlyZSgnLi9wYWdlL2NvbnRyb2xfZHJvcC1saXN0JykuZGVmYXVsdCxcbiAgICAnY29udHJvbF9kcm9wLWxpc3QtZmllbGQnOiByZXF1aXJlKCcuL3BhZ2UvY29udHJvbF9kcm9wLWxpc3QtZmllbGQnKS5kZWZhdWx0LFxuICAgICdjb250cm9sX2ZpbGUtdXBsb2FkLXN1cmZhY2UnOiByZXF1aXJlKCcuL3BhZ2UvY29udHJvbF9maWxlLXVwbG9hZC1zdXJmYWNlJykuZGVmYXVsdCxcbiAgICAnY29udHJvbF9pbnB1dC1ncm91cCc6IHJlcXVpcmUoJy4vcGFnZS9jb250cm9sX2lucHV0LWdyb3VwJykuZGVmYXVsdCxcbiAgICAnY29udHJvbF9tdWx0aS1zZWxlY3QnOiByZXF1aXJlKCcuL3BhZ2UvY29udHJvbF9tdWx0aS1zZWxlY3QnKS5kZWZhdWx0LFxuICAgICdjb250cm9sX3BhZ2luYXRvcic6IHJlcXVpcmUoJy4vcGFnZS9jb250cm9sX3BhZ2luYXRvcicpLmRlZmF1bHQsXG4gICAgJ2NvbnRyb2xfc2VhcmNoJzogcmVxdWlyZSgnLi9wYWdlL2NvbnRyb2xfc2VhcmNoJykuZGVmYXVsdCxcbiAgICAnY29udHJvbF9zZWxlY3QnOiByZXF1aXJlKCcuL3BhZ2UvY29udHJvbF9zZWxlY3QnKS5kZWZhdWx0LFxuICAgICdjb250cm9sX3N0YWNrJzogcmVxdWlyZSgnLi9wYWdlL2NvbnRyb2xfc3RhY2snKS5kZWZhdWx0LFxuICAgICdjb250cm9sX3N0YWNrLXNlbGVjdCc6IHJlcXVpcmUoJy4vcGFnZS9jb250cm9sX3N0YWNrLXNlbGVjdCcpLmRlZmF1bHQsXG4gICAgJ2NvbnRyb2xfc3dpdGNoJzogcmVxdWlyZSgnLi9wYWdlL2NvbnRyb2xfc3dpdGNoJykuZGVmYXVsdCxcbiAgICAnY29udHJvbF90YWItYmFyJzogcmVxdWlyZSgnLi9wYWdlL2NvbnRyb2xfdGFiLWJhcicpLmRlZmF1bHQsXG4gICAgJ2NvbnRyb2xfdGFnLWNvbnRyb2wnOiByZXF1aXJlKCcuL3BhZ2UvY29udHJvbF90YWctY29udHJvbCcpLmRlZmF1bHQsXG4gICAgJ2NvbnRyb2xfdGV4dC1maWVsZCc6IHJlcXVpcmUoJy4vcGFnZS9jb250cm9sX3RleHQtZmllbGQnKS5kZWZhdWx0LFxuICAgICdjb250cm9sX3RleHQtaW5wdXQnOiByZXF1aXJlKCcuL3BhZ2UvY29udHJvbF90ZXh0LWlucHV0JykuZGVmYXVsdCxcbiAgICAnY29udHJvbF90b29sYmFyJzogcmVxdWlyZSgnLi9wYWdlL2NvbnRyb2xfdG9vbGJhcicpLmRlZmF1bHQsXG4gICAgJ2NvbnRyb2xfdHlwZWFoZWFkJzogcmVxdWlyZSgnLi9wYWdlL2NvbnRyb2xfdHlwZWFoZWFkJykuZGVmYXVsdCxcbiAgICAnZGF0YV9kYXRhLXRhYmxlJzogcmVxdWlyZSgnLi9wYWdlL2RhdGFfZGF0YS10YWJsZScpLmRlZmF1bHQsXG4gICAgJ2RhdGFfcHJvcGVydHktbGlzdCc6IHJlcXVpcmUoJy4vcGFnZS9kYXRhX3Byb3BlcnR5LWxpc3QnKS5kZWZhdWx0LFxuICAgICdkaWFsb2dfYWxlcnQnOiByZXF1aXJlKCcuL3BhZ2UvZGlhbG9nX2FsZXJ0JykuZGVmYXVsdCxcbiAgICAnZGlhbG9nX2NvbmZpcm0nOiByZXF1aXJlKCcuL3BhZ2UvZGlhbG9nX2NvbmZpcm0nKS5kZWZhdWx0LFxuICAgICdkaWFsb2dfaW5mb3JtJzogcmVxdWlyZSgnLi9wYWdlL2RpYWxvZ19pbmZvcm0nKS5kZWZhdWx0LFxuICAgICdkaWFsb2dfbW9kYWwnOiByZXF1aXJlKCcuL3BhZ2UvZGlhbG9nX21vZGFsJykuZGVmYXVsdCxcbiAgICAnZGlhbG9nX3Byb21wdCc6IHJlcXVpcmUoJy4vcGFnZS9kaWFsb2dfcHJvbXB0JykuZGVmYXVsdCxcbiAgICAnbGF5b3V0X2NhbGxvdXQnOiByZXF1aXJlKCcuL3BhZ2UvbGF5b3V0X2NhbGxvdXQnKS5kZWZhdWx0LFxuICAgICdsYXlvdXRfZGVzY3JpcHRpb24tbGlzdCc6IHJlcXVpcmUoJy4vcGFnZS9sYXlvdXRfZGVzY3JpcHRpb24tbGlzdCcpLmRlZmF1bHQsXG4gICAgJ2xheW91dF9ncmlkJzogcmVxdWlyZSgnLi9wYWdlL2xheW91dF9ncmlkJykuZGVmYXVsdCxcbiAgICAnbGF5b3V0X2hvcml6b250YWwnOiByZXF1aXJlKCcuL3BhZ2UvbGF5b3V0X2hvcml6b250YWwnKS5kZWZhdWx0LFxuICAgICdsYXlvdXRfbGlzdCc6IHJlcXVpcmUoJy4vcGFnZS9sYXlvdXRfbGlzdCcpLmRlZmF1bHQsXG4gICAgJ2xheW91dF9tZXRlcic6IHJlcXVpcmUoJy4vcGFnZS9sYXlvdXRfbWV0ZXInKS5kZWZhdWx0LFxuICAgICdsYXlvdXRfcGFuZWwnOiByZXF1aXJlKCcuL3BhZ2UvbGF5b3V0X3BhbmVsJykuZGVmYXVsdCxcbiAgICAnbGF5b3V0X3RhYic6IHJlcXVpcmUoJy4vcGFnZS9sYXlvdXRfdGFiJykuZGVmYXVsdCxcbiAgICAnbGF5b3V0X3RhYmxlJzogcmVxdWlyZSgnLi9wYWdlL2xheW91dF90YWJsZScpLmRlZmF1bHQsXG4gICAgJ2xheW91dF93ZWxsJzogcmVxdWlyZSgnLi9wYWdlL2xheW91dF93ZWxsJykuZGVmYXVsdCxcbiAgICAnbWVudV9tZW51JzogcmVxdWlyZSgnLi9wYWdlL21lbnVfbWVudScpLmRlZmF1bHQsXG4gICAgJ21lbnVfbmF2JzogcmVxdWlyZSgnLi9wYWdlL21lbnVfbmF2JykuZGVmYXVsdCxcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5EZW1vID0gdm9pZCAwO1xudmFyIHdtbCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sXCIpO1xudmFyIHZpZXdzID0gcmVxdWlyZShcIi4vd21sL2RlbW9cIik7XG52YXIgRGVtbyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoRGVtbywgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBEZW1vKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMudmlldyA9IG5ldyB2aWV3cy5NYWluKF90aGlzKTtcbiAgICAgICAgX3RoaXMudmFsdWVzID0ge1xuICAgICAgICAgICAgc2l6ZTogX3RoaXMuYXR0cnMuc2l6ZSxcbiAgICAgICAgICAgIG9mZnNldDogX3RoaXMuYXR0cnMub2Zmc2V0XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIERlbW87XG59KHdtbC5Db21wb25lbnQpKTtcbmV4cG9ydHMuRGVtbyA9IERlbW87XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5NYWluID0gdm9pZCAwO1xudmFyIF9fZG9jdW1lbnQgPSByZXF1aXJlKFwiQHF1ZW5rL3dtbC9saWIvZG9tXCIpO1xuLy9AdHMtaWdub3JlOiA2MTkyXG52YXIgbWF5YmVfMSA9IHJlcXVpcmUoXCJAcXVlbmsvbm9uaS9saWIvZGF0YS9tYXliZVwiKTtcbnZhciBncmlkXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vLi4vLi4vbGliL2xheW91dC9ncmlkXCIpO1xuO1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2lmID0gZnVuY3Rpb24gKF9fZXhwciwgX19jb25zZXEsIF9fYWx0KSB7XG4gICAgcmV0dXJuIChfX2V4cHIpID8gX19jb25zZXEoKSA6IF9fYWx0ID8gX19hbHQoKSA6IFtdO1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JJbiA9IGZ1bmN0aW9uIChsaXN0LCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgICByZXQgPSByZXQuY29uY2F0KGYobGlzdFtpXSwgaSwgbGlzdCkpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2Zvck9mID0gZnVuY3Rpb24gKG8sIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gbylcbiAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoa2V5KSlcbiAgICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoZigobylba2V5XSwga2V5LCBvKSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB0ZXh0ID0gX19kb2N1bWVudC50ZXh0O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdW5zYWZlID0gX19kb2N1bWVudC51bnNhZmU7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciBpc1NldCA9IGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT0gbnVsbDsgfTtcbnZhciBNYWluID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE1haW4oX19jb250ZXh0KSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMuZ3JvdXBzID0ge307XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBmdW5jdGlvbiAoX190aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gX190aGlzLndpZGdldChuZXcgZ3JpZF8xLkdyaWRMYXlvdXQoe30sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBncmlkXzEuUm93KHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGdyaWRfMS5Db2x1bW4oeyB3dzogeyAnc3Bhbic6IF9fY29udGV4dC52YWx1ZXMuc2l6ZSB9IH0sIF9fc3ByZWFkQXJyYXlzKChfX2NvbnRleHQuY2hpbGRyZW4pKSksIHsgd3c6IHsgJ3NwYW4nOiBfX2NvbnRleHQudmFsdWVzLnNpemUgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgIF0pLCB7fSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIE1haW4ucHJvdG90eXBlLnJlZ2lzdGVyVmlldyA9IGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIHRoaXMudmlld3MucHVzaCh2KTtcbiAgICAgICAgcmV0dXJuIHY7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChlLCBhdHRycykge1xuICAgICAgICB2YXIgYXR0cnNNYXAgPSBhdHRycztcbiAgICAgICAgaWYgKGF0dHJzTWFwLndtbCkge1xuICAgICAgICAgICAgdmFyIF9hID0gYXR0cnNNYXAud21sLCBpZCA9IF9hLmlkLCBncm91cCA9IF9hLmdyb3VwO1xuICAgICAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pZHMuaGFzT3duUHJvcGVydHkoaWQpKVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEdXBsaWNhdGUgaWQgJ1wiICsgaWQgKyBcIicgZGV0ZWN0ZWQhXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaWRzW2lkXSA9IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ3JvdXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXSA9IHRoaXMuZ3JvdXBzW2dyb3VwXSB8fCBbXTtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0ucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLm5vZGUgPSBmdW5jdGlvbiAodGFnLCBhdHRycywgY2hpbGRyZW4pIHtcbiAgICAgICAgdmFyIGUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICAgICAgT2JqZWN0LmtleXMoYXR0cnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlID0gYXR0cnNba2V5XTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvL3ByZXZlbnQgc2V0dGluZyB0aGluZ3MgbGlrZSBkaXNhYmxlZD0nJ1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gJycpXG4gICAgICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFfX2RvY3VtZW50LmlzQnJvd3NlciAmJlxuICAgICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgX19kb2N1bWVudC5XTUxET01UZXh0KSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBjKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICB2YXIgdG4gPSBfX2RvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnICsgYyk7XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQodG4pO1xuICAgICAgICAgICAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgICAgICAgICAgICAgIGUuYXBwZW5kQ2hpbGQoYyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW4gbm90IGFkb3B0IGNoaWxkIFwiICsgYyArIFwiIG9mIHR5cGUgXCIgKyB0eXBlb2YgYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKGUsIGF0dHJzKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS53aWRnZXQgPSBmdW5jdGlvbiAodywgYXR0cnMpIHtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih3LCBhdHRycyk7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5wdXNoKHcpO1xuICAgICAgICByZXR1cm4gdy5yZW5kZXIoKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIHZhciBtVyA9IG1heWJlXzEuZnJvbU51bGxhYmxlKHRoaXMuaWRzW2lkXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlJZChpZCk7XG4gICAgICAgIH0sIG1XKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmZpbmRCeUdyb3VwID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIG1Hcm91cCA9IG1heWJlXzEuZnJvbUFycmF5KHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KG5hbWUpID9cbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzW25hbWVdIDpcbiAgICAgICAgICAgIFtdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUdyb3VwKG5hbWUpO1xuICAgICAgICB9LCBtR3JvdXApO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUuaW52YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgICAgIHZhciBwYXJlbnQgPSB0cmVlLnBhcmVudE5vZGU7XG4gICAgICAgIGlmICh0cmVlID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS53YXJuKCdpbnZhbGlkYXRlKCk6ICcgKyAnTWlzc2luZyBET00gdHJlZSEnKTtcbiAgICAgICAgaWYgKHRyZWUucGFyZW50Tm9kZSA9PSBudWxsKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkYXRlKCk6IGNhbm5vdCBpbnZhbGlkYXRlIHRoaXMgdmlldywgaXQgaGFzIG5vIHBhcmVudCBub2RlIScpO1xuICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRoaXMucmVuZGVyKCksIHRyZWUpO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW1vdmVkKCk7IH0pO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSB0aGlzLnRlbXBsYXRlKHRoaXMpO1xuICAgICAgICB0aGlzLmlkc1sncm9vdCddID0gKHRoaXMuaWRzWydyb290J10pID9cbiAgICAgICAgICAgIHRoaXMuaWRzWydyb290J10gOlxuICAgICAgICAgICAgdGhpcy50cmVlO1xuICAgICAgICB0aGlzLndpZGdldHMuZm9yRWFjaChmdW5jdGlvbiAodykgeyByZXR1cm4gdy5yZW5kZXJlZCgpOyB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJlZTtcbiAgICB9O1xuICAgIHJldHVybiBNYWluO1xufSgpKTtcbmV4cG9ydHMuTWFpbiA9IE1haW47XG4vLyMgc291cmNlTWFwcGluZ1VSTD1kZW1vLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk1haW4gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xudmFyIGRyYXdlcl8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uL2xpYi9sYXlvdXQvZHJhd2VyXCIpO1xuO1xudmFyIGFjdGlvbl9iYXJfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi9saWIvbGF5b3V0L2FjdGlvbi1iYXJcIik7XG47XG47XG52YXIgbGlua18xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uL2xpYi9jb250ZW50L2xpbmtcIik7XG47XG52YXIgbWVudV9pY29uXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vbGliL2NvbnRlbnQvbWVudS1pY29uXCIpO1xuO1xudmFyIG1haW5fMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi9saWIvbGF5b3V0L21haW5cIik7XG47XG52YXIgbmF2aWdhdGlvbl8xID0gcmVxdWlyZShcIi4vbmF2aWdhdGlvblwiKTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19pZiA9IGZ1bmN0aW9uIChfX2V4cHIsIF9fY29uc2VxLCBfX2FsdCkge1xuICAgIHJldHVybiAoX19leHByKSA/IF9fY29uc2VxKCkgOiBfX2FsdCA/IF9fYWx0KCkgOiBbXTtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9ySW4gPSBmdW5jdGlvbiAobGlzdCwgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKGxpc3RbaV0sIGksIGxpc3QpKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vQHRzLWlnbm9yZTo2MTkyXG52YXIgX19mb3JPZiA9IGZ1bmN0aW9uIChvLCBmLCBhbHQpIHtcbiAgICB2YXIgcmV0ID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG8pXG4gICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICByZXQgPSByZXQuY29uY2F0KGYoKG8pW2tleV0sIGtleSwgbykpO1xuICAgIHJldHVybiByZXQubGVuZ3RoID09PSAwID8gYWx0KCkgOiByZXQ7XG59O1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgdGV4dCA9IF9fZG9jdW1lbnQudGV4dDtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHVuc2FmZSA9IF9fZG9jdW1lbnQudW5zYWZlO1xuLy8gQHRzLWlnbm9yZSA2MTkyXG52YXIgaXNTZXQgPSBmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlICE9IG51bGw7IH07XG52YXIgTWFpbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKF9fY29udGV4dCkge1xuICAgICAgICB0aGlzLmlkcyA9IHt9O1xuICAgICAgICB0aGlzLmdyb3VwcyA9IHt9O1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnRyZWUgPSBfX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICB0aGlzLnRlbXBsYXRlID0gZnVuY3Rpb24gKF9fdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIF9fdGhpcy53aWRnZXQobmV3IGRyYXdlcl8xLkRyYXdlckxheW91dCh7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLmxheW91dCB9LCB3dzogeyAnZHJhd2VyQ29udGVudCc6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5yZWdpc3RlclZpZXcoKG5ldyBuYXZpZ2F0aW9uXzEuTmF2aWdhdGlvbihfX2NvbnRleHQpKSkucmVuZGVyKClcbiAgICAgICAgICAgICAgICAgICAgXSB9IH0sIFtcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBhY3Rpb25fYmFyXzEuQWN0aW9uQmFyKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGxpbmtfMS5MaW5rKHsgd3c6IHsgJ29uQ2xpY2snOiBfX2NvbnRleHQudG9nZ2xlRHJhd2VyIH0gfSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgbWVudV9pY29uXzEuTWVudUljb24oe30sIFtdKSwge30pXG4gICAgICAgICAgICAgICAgICAgIF0pLCB7IHd3OiB7ICdvbkNsaWNrJzogX19jb250ZXh0LnRvZ2dsZURyYXdlciB9IH0pXG4gICAgICAgICAgICAgICAgXSksIHt9KSxcbiAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBtYWluXzEuTWFpbkxheW91dCh7fSwgX19zcHJlYWRBcnJheXMoKF9fY29udGV4dC5jb250ZW50KSkpLCB7fSlcbiAgICAgICAgICAgIF0pLCB7IHdtbDogeyAnaWQnOiBfX2NvbnRleHQudmFsdWVzLmlkLmxheW91dCB9LCB3dzogeyAnZHJhd2VyQ29udGVudCc6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy5yZWdpc3RlclZpZXcoKG5ldyBuYXZpZ2F0aW9uXzEuTmF2aWdhdGlvbihfX2NvbnRleHQpKSkucmVuZGVyKClcbiAgICAgICAgICAgICAgICAgICAgXSB9IH0pO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBNYWluLnByb3RvdHlwZS5yZWdpc3RlclZpZXcgPSBmdW5jdGlvbiAodikge1xuICAgICAgICB0aGlzLnZpZXdzLnB1c2godik7XG4gICAgICAgIHJldHVybiB2O1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoZSwgYXR0cnMpIHtcbiAgICAgICAgdmFyIGF0dHJzTWFwID0gYXR0cnM7XG4gICAgICAgIGlmIChhdHRyc01hcC53bWwpIHtcbiAgICAgICAgICAgIHZhciBfYSA9IGF0dHJzTWFwLndtbCwgaWQgPSBfYS5pZCwgZ3JvdXAgPSBfYS5ncm91cDtcbiAgICAgICAgICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaWRzLmhhc093blByb3BlcnR5KGlkKSlcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRHVwbGljYXRlIGlkICdcIiArIGlkICsgXCInIGRldGVjdGVkIVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlkc1tpZF0gPSBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cF0gPSB0aGlzLmdyb3Vwc1tncm91cF0gfHwgW107XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdLnB1c2goZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5ub2RlID0gZnVuY3Rpb24gKHRhZywgYXR0cnMsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7XG4gICAgICAgIE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzW2tleV07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgZVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgLy9wcmV2ZW50IHNldHRpbmcgdGhpbmdzIGxpa2UgZGlzYWJsZWQ9JydcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT09ICcnKVxuICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICghX19kb2N1bWVudC5pc0Jyb3dzZXIgJiZcbiAgICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIF9fZG9jdW1lbnQuV01MRE9NVGV4dCkge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgYykge1xuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgICAgICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRuID0gX19kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyArIGMpO1xuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKHRuKTtcbiAgICAgICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgICAgICBlLmFwcGVuZENoaWxkKGMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2FuIG5vdCBhZG9wdCBjaGlsZCBcIiArIGMgKyBcIiBvZiB0eXBlIFwiICsgdHlwZW9mIGMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihlLCBhdHRycyk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTWFpbi5wcm90b3R5cGUud2lkZ2V0ID0gZnVuY3Rpb24gKHcsIGF0dHJzKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodywgYXR0cnMpO1xuICAgICAgICB0aGlzLndpZGdldHMucHVzaCh3KTtcbiAgICAgICAgcmV0dXJuIHcucmVuZGVyKCk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICB2YXIgbVcgPSBtYXliZV8xLmZyb21OdWxsYWJsZSh0aGlzLmlkc1tpZF0pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5SWQoaWQpO1xuICAgICAgICB9LCBtVyk7XG4gICAgfTtcbiAgICBNYWluLnByb3RvdHlwZS5maW5kQnlHcm91cCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBtR3JvdXAgPSBtYXliZV8xLmZyb21BcnJheSh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSA/XG4gICAgICAgICAgICB0aGlzLmdyb3Vwc1tuYW1lXSA6XG4gICAgICAgICAgICBbXSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdzLnJlZHVjZShmdW5jdGlvbiAocCwgYykge1xuICAgICAgICAgICAgcmV0dXJuIHAuaXNKdXN0KCkgPyBwIDogYy5maW5kQnlHcm91cChuYW1lKTtcbiAgICAgICAgfSwgbUdyb3VwKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLmludmFsaWRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgICAgICB2YXIgcGFyZW50ID0gdHJlZS5wYXJlbnROb2RlO1xuICAgICAgICBpZiAodHJlZSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybignaW52YWxpZGF0ZSgpOiAnICsgJ01pc3NpbmcgRE9NIHRyZWUhJyk7XG4gICAgICAgIGlmICh0cmVlLnBhcmVudE5vZGUgPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZGF0ZSgpOiBjYW5ub3QgaW52YWxpZGF0ZSB0aGlzIHZpZXcsIGl0IGhhcyBubyBwYXJlbnQgbm9kZSEnKTtcbiAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnJlbmRlcigpLCB0cmVlKTtcbiAgICB9O1xuICAgIE1haW4ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVtb3ZlZCgpOyB9KTtcbiAgICAgICAgdGhpcy53aWRnZXRzID0gW107XG4gICAgICAgIHRoaXMudmlld3MgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gdGhpcy50ZW1wbGF0ZSh0aGlzKTtcbiAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA9ICh0aGlzLmlkc1sncm9vdCddKSA/XG4gICAgICAgICAgICB0aGlzLmlkc1sncm9vdCddIDpcbiAgICAgICAgICAgIHRoaXMudHJlZTtcbiAgICAgICAgdGhpcy53aWRnZXRzLmZvckVhY2goZnVuY3Rpb24gKHcpIHsgcmV0dXJuIHcucmVuZGVyZWQoKTsgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyZWU7XG4gICAgfTtcbiAgICByZXR1cm4gTWFpbjtcbn0oKSk7XG5leHBvcnRzLk1haW4gPSBNYWluO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcbiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcbiAgICByZXR1cm4gcjtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLk5hdmlnYXRpb24gPSB2b2lkIDA7XG52YXIgX19kb2N1bWVudCA9IHJlcXVpcmUoXCJAcXVlbmsvd21sL2xpYi9kb21cIik7XG4vL0B0cy1pZ25vcmU6IDYxOTJcbnZhciBtYXliZV8xID0gcmVxdWlyZShcIkBxdWVuay9ub25pL2xpYi9kYXRhL21heWJlXCIpO1xuO1xudmFyIG5hdl8xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uL2xpYi9tZW51L25hdlwiKTtcbjtcbnZhciBpdGVtXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vLi4vbGliL21lbnUvaXRlbVwiKTtcbjtcbnZhciBoZWFkZXJfMSA9IHJlcXVpcmUoXCIuLi8uLi8uLi8uLi9saWIvbWVudS9oZWFkZXJcIik7XG47XG52YXIgbGlua18xID0gcmVxdWlyZShcIi4uLy4uLy4uLy4uL2xpYi9jb250ZW50L2xpbmtcIik7XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9faWYgPSBmdW5jdGlvbiAoX19leHByLCBfX2NvbnNlcSwgX19hbHQpIHtcbiAgICByZXR1cm4gKF9fZXhwcikgPyBfX2NvbnNlcSgpIDogX19hbHQgPyBfX2FsdCgpIDogW107XG59O1xuLy9AdHMtaWdub3JlOjYxOTJcbnZhciBfX2ZvckluID0gZnVuY3Rpb24gKGxpc3QsIGYsIGFsdCkge1xuICAgIHZhciByZXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIHJldCA9IHJldC5jb25jYXQoZihsaXN0W2ldLCBpLCBsaXN0KSk7XG4gICAgcmV0dXJuIHJldC5sZW5ndGggPT09IDAgPyBhbHQoKSA6IHJldDtcbn07XG4vL0B0cy1pZ25vcmU6NjE5MlxudmFyIF9fZm9yT2YgPSBmdW5jdGlvbiAobywgZiwgYWx0KSB7XG4gICAgdmFyIHJldCA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvKVxuICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eShrZXkpKVxuICAgICAgICAgICAgcmV0ID0gcmV0LmNvbmNhdChmKChvKVtrZXldLCBrZXksIG8pKTtcbiAgICByZXR1cm4gcmV0Lmxlbmd0aCA9PT0gMCA/IGFsdCgpIDogcmV0O1xufTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIHRleHQgPSBfX2RvY3VtZW50LnRleHQ7XG4vLyBAdHMtaWdub3JlIDYxOTJcbnZhciB1bnNhZmUgPSBfX2RvY3VtZW50LnVuc2FmZTtcbi8vIEB0cy1pZ25vcmUgNjE5MlxudmFyIGlzU2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPSBudWxsOyB9O1xudmFyIE5hdmlnYXRpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTmF2aWdhdGlvbihfX2NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5pZHMgPSB7fTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTtcbiAgICAgICAgdGhpcy52aWV3cyA9IFtdO1xuICAgICAgICB0aGlzLndpZGdldHMgPSBbXTtcbiAgICAgICAgdGhpcy50cmVlID0gX19kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGZ1bmN0aW9uIChfX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBfX3RoaXMud2lkZ2V0KG5ldyBuYXZfMS5OYXYoeyB3dzogeyAndmVydGljYWwnOiB0cnVlIH0gfSwgX19zcHJlYWRBcnJheXMoW1xuICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGl0ZW1fMS5JdGVtKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGxpbmtfMS5MaW5rKHsgd21sOiB7ICdncm91cCc6ICdsaW5rcycgfSwgd3c6IHsgJ2FjdGl2ZSc6IChfX2NvbnRleHQucGFnZSA9PT0gJ2hvbWUnKSwgJ25hbWUnOiAnaG9tZScsICdocmVmJzogJyMnLCAnb25DbGljayc6IF9fY29udGV4dC5uYXZpZ2F0ZSwgJ3RleHQnOiAnSG9tZScgfSB9LCBbXSksIHsgd21sOiB7ICdncm91cCc6ICdsaW5rcycgfSwgd3c6IHsgJ2FjdGl2ZSc6IChfX2NvbnRleHQucGFnZSA9PT0gJ2hvbWUnKSwgJ25hbWUnOiAnaG9tZScsICdocmVmJzogJyMnLCAnb25DbGljayc6IF9fY29udGV4dC5uYXZpZ2F0ZSwgJ3RleHQnOiAnSG9tZScgfSB9KVxuICAgICAgICAgICAgICAgIF0pLCB7fSlcbiAgICAgICAgICAgIF0sIF9fZm9yT2YoX19jb250ZXh0LnBhZ2VzLCBmdW5jdGlvbiAoaXRlbXMsIHNlY3Rpb24sIF8kJGFsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAoW1xuICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBpdGVtXzEuSXRlbSh7fSwgW1xuICAgICAgICAgICAgICAgICAgICAgICAgX190aGlzLndpZGdldChuZXcgaGVhZGVyXzEuTWVudUhlYWRlcih7IHd3OiB7ICd0ZXh0Jzogc2VjdGlvbiB9IH0sIFtdKSwgeyB3dzogeyAndGV4dCc6IHNlY3Rpb24gfSB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IG5hdl8xLk5hdih7IHd3OiB7ICd2ZXJ0aWNhbCc6IHRydWUgfSB9LCBfX3NwcmVhZEFycmF5cyhfX2Zvck9mKGl0ZW1zLCBmdW5jdGlvbiAoXywgbmFtZSwgXyQkYWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fdGhpcy53aWRnZXQobmV3IGl0ZW1fMS5JdGVtKHt9LCBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX3RoaXMud2lkZ2V0KG5ldyBsaW5rXzEuTGluayh7IHdtbDogeyAnZ3JvdXAnOiAnbGlua3MnIH0sIHd3OiB7ICduYW1lJzogbmFtZSwgJ2hyZWYnOiAoJyMvJyArIG5hbWUpLCAnb25DbGljayc6IF9fY29udGV4dC5uYXZpZ2F0ZSwgJ2FjdGl2ZSc6IChfX2NvbnRleHQucGFnZSA9PT0gbmFtZSksICd0ZXh0JzogbmFtZSB9IH0sIFtdKSwgeyB3bWw6IHsgJ2dyb3VwJzogJ2xpbmtzJyB9LCB3dzogeyAnbmFtZSc6IG5hbWUsICdocmVmJzogKCcjLycgKyBuYW1lKSwgJ29uQ2xpY2snOiBfX2NvbnRleHQubmF2aWdhdGUsICdhY3RpdmUnOiAoX19jb250ZXh0LnBhZ2UgPT09IG5hbWUpLCAndGV4dCc6IG5hbWUgfSB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7IHJldHVybiAoW10pOyB9KSkpLCB7IHd3OiB7ICd2ZXJ0aWNhbCc6IHRydWUgfSB9KVxuICAgICAgICAgICAgICAgICAgICBdKSwge30pXG4gICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7IHJldHVybiAoW10pOyB9KSkpLCB7IHd3OiB7ICd2ZXJ0aWNhbCc6IHRydWUgfSB9KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgTmF2aWdhdGlvbi5wcm90b3R5cGUucmVnaXN0ZXJWaWV3ID0gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgdGhpcy52aWV3cy5wdXNoKHYpO1xuICAgICAgICByZXR1cm4gdjtcbiAgICB9O1xuICAgIE5hdmlnYXRpb24ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGUsIGF0dHJzKSB7XG4gICAgICAgIHZhciBhdHRyc01hcCA9IGF0dHJzO1xuICAgICAgICBpZiAoYXR0cnNNYXAud21sKSB7XG4gICAgICAgICAgICB2YXIgX2EgPSBhdHRyc01hcC53bWwsIGlkID0gX2EuaWQsIGdyb3VwID0gX2EuZ3JvdXA7XG4gICAgICAgICAgICBpZiAoaWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlkcy5oYXNPd25Qcm9wZXJ0eShpZCkpXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkR1cGxpY2F0ZSBpZCAnXCIgKyBpZCArIFwiJyBkZXRlY3RlZCFcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5pZHNbaWRdID0gZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChncm91cCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBdID0gdGhpcy5ncm91cHNbZ3JvdXBdIHx8IFtdO1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwXS5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH07XG4gICAgTmF2aWdhdGlvbi5wcm90b3R5cGUubm9kZSA9IGZ1bmN0aW9uICh0YWcsIGF0dHJzLCBjaGlsZHJlbikge1xuICAgICAgICB2YXIgZSA9IF9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICAgICAgICBPYmplY3Qua2V5cyhhdHRycykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBhdHRyc1trZXldO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIC8vcHJldmVudCBzZXR0aW5nIHRoaW5ncyBsaWtlIGRpc2FibGVkPScnXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSAnJylcbiAgICAgICAgICAgICAgICAgICAgZS5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIGUuc2V0QXR0cmlidXRlKGtleSwgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIV9fZG9jdW1lbnQuaXNCcm93c2VyICYmXG4gICAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBfX2RvY3VtZW50LldNTERPTVRleHQpIHtcbiAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGMpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6XG4gICAgICAgICAgICAgICAgICAgIHZhciB0biA9IF9fZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycgKyBjKTtcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZCh0bik7XG4gICAgICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgICAgICAgICAgICAgZS5hcHBlbmRDaGlsZChjKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbiBub3QgYWRvcHQgY2hpbGQgXCIgKyBjICsgXCIgb2YgdHlwZSBcIiArIHR5cGVvZiBjKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoZSwgYXR0cnMpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIE5hdmlnYXRpb24ucHJvdG90eXBlLndpZGdldCA9IGZ1bmN0aW9uICh3LCBhdHRycykge1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHcsIGF0dHJzKTtcbiAgICAgICAgdGhpcy53aWRnZXRzLnB1c2godyk7XG4gICAgICAgIHJldHVybiB3LnJlbmRlcigpO1xuICAgIH07XG4gICAgTmF2aWdhdGlvbi5wcm90b3R5cGUuZmluZEJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgdmFyIG1XID0gbWF5YmVfMS5mcm9tTnVsbGFibGUodGhpcy5pZHNbaWRdKTtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld3MucmVkdWNlKGZ1bmN0aW9uIChwLCBjKSB7XG4gICAgICAgICAgICByZXR1cm4gcC5pc0p1c3QoKSA/IHAgOiBjLmZpbmRCeUlkKGlkKTtcbiAgICAgICAgfSwgbVcpO1xuICAgIH07XG4gICAgTmF2aWdhdGlvbi5wcm90b3R5cGUuZmluZEJ5R3JvdXAgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICB2YXIgbUdyb3VwID0gbWF5YmVfMS5mcm9tQXJyYXkodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobmFtZSkgP1xuICAgICAgICAgICAgdGhpcy5ncm91cHNbbmFtZV0gOlxuICAgICAgICAgICAgW10pO1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3cy5yZWR1Y2UoZnVuY3Rpb24gKHAsIGMpIHtcbiAgICAgICAgICAgIHJldHVybiBwLmlzSnVzdCgpID8gcCA6IGMuZmluZEJ5R3JvdXAobmFtZSk7XG4gICAgICAgIH0sIG1Hcm91cCk7XG4gICAgfTtcbiAgICBOYXZpZ2F0aW9uLnByb3RvdHlwZS5pbnZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdHJlZSA9IHRoaXMudHJlZTtcbiAgICAgICAgdmFyIHBhcmVudCA9IHRyZWUucGFyZW50Tm9kZTtcbiAgICAgICAgaWYgKHRyZWUgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oJ2ludmFsaWRhdGUoKTogJyArICdNaXNzaW5nIERPTSB0cmVlIScpO1xuICAgICAgICBpZiAodHJlZS5wYXJlbnROb2RlID09IG51bGwpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWRhdGUoKTogY2Fubm90IGludmFsaWRhdGUgdGhpcyB2aWV3LCBpdCBoYXMgbm8gcGFyZW50IG5vZGUhJyk7XG4gICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5yZW5kZXIoKSwgdHJlZSk7XG4gICAgfTtcbiAgICBOYXZpZ2F0aW9uLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaWRzID0ge307XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbW92ZWQoKTsgfSk7XG4gICAgICAgIHRoaXMud2lkZ2V0cyA9IFtdO1xuICAgICAgICB0aGlzLnZpZXdzID0gW107XG4gICAgICAgIHRoaXMudHJlZSA9IHRoaXMudGVtcGxhdGUodGhpcyk7XG4gICAgICAgIHRoaXMuaWRzWydyb290J10gPSAodGhpcy5pZHNbJ3Jvb3QnXSkgP1xuICAgICAgICAgICAgdGhpcy5pZHNbJ3Jvb3QnXSA6XG4gICAgICAgICAgICB0aGlzLnRyZWU7XG4gICAgICAgIHRoaXMud2lkZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uICh3KSB7IHJldHVybiB3LnJlbmRlcmVkKCk7IH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50cmVlO1xuICAgIH07XG4gICAgcmV0dXJuIE5hdmlnYXRpb247XG59KCkpO1xuZXhwb3J0cy5OYXZpZ2F0aW9uID0gTmF2aWdhdGlvbjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW5hdmlnYXRpb24uanMubWFwIl19
