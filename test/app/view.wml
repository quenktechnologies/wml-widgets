import {DrawerLayout, ActionArea, MainView, MenuButton, Button, ButtonGroup} from '@quenk/wml-widgets/lib/components'
import {Container, Column, Row} from '@quenk/wml-widgets/lib/components'
import {Table} from '@quenk/wml-widgets/lib/components'
import {Panel, PanelHeader, PanelBody, PanelFooter} from '@quenk/wml-widgets/lib/components'
import {Modal, ModalHeader, ModalBody, ModalFooter} from '@quenk/wml-widgets/lib/components'
import {Input, Select, Switch} from '@quenk/wml-widgets/lib/components'
import {Next} from './app'

{% view CreateDialog  %}

  <Modal wml:id="modal">

    <ModalHeader ww:onClose={{=>this.dialog.ids.modal.close()}}>
      Create record
    </ModalHeader>
      
    <ModalBody>

      <Input 
      ww:id="name" 
      ww:label="Name"
      ww:onInput={{\e:Event=>(this.next.name = (e.target as HTMLInputElement).value)}} />

      <Input 
      ww:id="amount"
      ww:label="Amount"
      ww:warn="Don't over do it!"
      ww:type="number"
      ww:onInput={{\e:Event=>(this.next.amount = Number((e.target as HTMLInputElement).value))}} />

      <Select
        ww:id="status"
        ww:label="Status"
        ww:options={{['paid', 'overdue', 'history']}}
        ww:onInput={{\e:Event=>(this.next.status = (e.target as HTMLInputElement).value)}} />

      <span> Receive Notifications? </span>
        
      <Switch
        ww:onChange={{\e:Event=>(e.target as HTMLInputElement).value?this.next.watchers.push(1):null}}/>

    </ModalBody>

    <ModalFooter>

      <Button
        wml:id="cancelButton"
        ww:text="Cancel"
        ww:onClick={{=>this.dialog.ids.modal.close()}}/>

      <Button
        wml:id="saveButton"
        ww:style="-danger"
        ww:text="Save"
        ww:class="-right"
        ww:onClick={{this::save}}/>

    </ModalFooter>

  </Modal>  

{% endview %}

{% macro navigation %}

  <p>This is in the drawer</p>

{% endmacro %}

{% macro content %}

    <ActionArea wml:id="actions">

      <MenuButton ww:onClick={{this::toggleDrawer}}/>

        <ButtonGroup ww:class="-right">

          <Button
            wml:id="disabledButton"
            ww:style="-default"
            ww:text="Disabled"
            ww:disabled={{true}}/>

          <Button
            wml:id="createButton"
            ww:style="-danger"
            ww:text="Create"
            ww:onClick={{this::create}}/>

        </ButtonGroup>

    </ActionArea>

    <MainView wml:id="main">

      <Container>

        <Row>

          <Column>

            <Panel ww:style="-info">

              <PanelHeader>Details</PanelHeader>

              <PanelBody>Records:</PanelBody>

              <Table
                ww:fields={{this.fields}}
                ww:data={{this.records}}
                ww:model={{this.tableModel}}/>

              <PanelFooter>
                {{this.records.reduce(\p:number,c:Next=>(p + c.amount), 0)}}
              </PanelFooter>

            </Panel>

      </Column>

    </Row>

  </Container>

  </MainView>

{% endmacro %}

<DrawerLayout 
  wml:id="layout"
  ww:drawer={{navigation}}
  ww:content={{content.bind(this)}} />
