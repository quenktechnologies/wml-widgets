import {DrawerLayout, ActionArea, MainView, MenuButton, Button} from '@quenk/wml-widgets/lib/components'
import {Container, Column, Row} from '@quenk/wml-widgets/lib/components'
import {Table} from '@quenk/wml-widgets/lib/components'
import {Panel, PanelHeader, PanelBody, PanelFooter} from '@quenk/wml-widgets/lib/components'
import {Modal, ModalHeader, ModalBody, ModalFooter} from '@quenk/wml-widgets/lib/components'
import {Input, Select, Switch} from '@quenk/wml-widgets/lib/components'

{% view CreateDialog  %}

  <Modal wml:id="modal">

    <ModalHeader ww:onClose={{\_=>this.dialog.ids.modal.close()}}>
      Create record
    </ModalHeader>
      
    <ModalBody>

      <Input 
      ww:id="name" 
      ww:label="Name"
      ww:onInput={{\e=>(this.next.name = e.target.value)}} />

      <Input 
      ww:id="amount"
      ww:label="Amount"
      ww:type="number"
      ww:onInput={{\e=>(this.next.amount = Number(e.target.value))}} />

      <Select
        ww:id="status"
        ww:label="Status"
        ww:options={{['paid', 'overdue', 'history']}}
        ww:onInput={{\e=>(this.next.status = e.target.value)}} />

      <span> Receive Notifications? </span>
        
      <Switch
        ww:onChange={{\e=>e.target.value?this.next.watchers.push(1):null}}/>

    </ModalBody>

    <ModalFooter>

      <Button
        wml:id="cancelButton"
        ww:text="Cancel"
        ww:onClick={{\e=>this.dialog.ids.modal.close()}}/>

      <Button
        wml:id="saveButton"
        ww:style="-danger"
        ww:text="Save"
        ww:class="-right"
        ww:onClick={{this::save}}/>

    </ModalFooter>

  </Modal>  

{% endview %}

{% macro navigation %}

  <p>This is in the drawer</p>

{% endmacro %}

{% macro content %}

    <ActionArea wml:id="actions">

      <MenuButton ww:onClick={{this::toggleDrawer}}/>

      <Button
        wml:id="createButton"
        ww:style="-danger"
        ww:text="Create"
        ww:class="-right"
        ww:onClick={{this::create}}/>

    </ActionArea>

    <MainView wml:id="main">

      <Container>

        <Row>

          <Column>

            <Panel ww:style="-info">

              <PanelHeader>Details</PanelHeader>

              <PanelBody>Records:</PanelBody>

              <Table
                ww:fields={{this.fields}}
                ww:data={{this.records}}
                ww:model={{this.tableModel}}/>

              <PanelFooter>
                {{this.records.reduce(\p,c=>(p + c.amount), 0)}}
              </PanelFooter>

            </Panel>

      </Column>

    </Row>

  </Container>

  </MainView>

{% endmacro %}

<DrawerLayout 
  wml:id="layout"
  ww:navigation={{navigation}}
  ww:content={{\v=>content.call(this, v)}} />
